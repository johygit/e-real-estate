(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+9CB":function(e,t,n){"use strict";var i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]};e.exports={isLikelyAacData:function(e){return e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)},parseId3TagSize:function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&e[t+5])>>4?n+20:n+10},parseAdtsSize:function(e,t){return 6144&e[t+3]|e[t+4]<<3|(224&e[t+5])>>5},parseType:function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255===e[t]&&240==(246&e[t+1]))return i[(60&e[t+2])>>>2];t++}return null},parseAacTimestamp:function(e){var t,n,i;t=10,64&e[5]&&(t+=4,t+=r(e.subarray(10,14)));do{if((n=r(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){i=e.subarray(t+10,t+n+10);for(var o=0;o<i.byteLength;o++)if(0===i[o]){if("com.apple.streaming.transportStreamTimestamp"===unescape(function(e,t,n){var i,r="";for(i=0;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r}(i,0,o))){var a=i.subarray(o+1),s=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;return(s*=4)+(3&a[7])}break}}t+=10,t+=n}while(t<e.byteLength);return null}}},"+X0y":function(e,t){var n={"":!0,up:!0};function i(e){return"number"==typeof e&&e>=0&&e<=100}e.exports=function(){var e=100,t=3,r=0,o=100,a=0,s=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!i(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!i(e))throw new Error("RegionAnchorX must be between 0 and 100.");o=e}},regionAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!i(e))throw new Error("RegionAnchorY must be between 0 and 100.");r=e}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!i(e))throw new Error("ViewportAnchorY must be between 0 and 100.");s=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!i(e))throw new Error("ViewportAnchorX must be between 0 and 100.");a=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var t=function(e){return"string"==typeof e&&!!n[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");l=t}}})}},0:function(e,t,n){e.exports=n("zUnb")},"0CSc":function(e,t,n){"use strict";var i=n("IdCN"),r=Object.prototype.toString,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){if(!i(t))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=n),"[object Array]"===r.call(e)?function(e,t,n){for(var i=0,r=e.length;i<r;i++)o.call(e,i)&&(null==n?t(e[i],i,e):t.call(n,e[i],i,e))}(e,t,a):"string"==typeof e?function(e,t,n){for(var i=0,r=e.length;i<r;i++)null==n?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)}(e,t,a):function(e,t,n){for(var i in e)o.call(e,i)&&(null==n?t(e[i],i,e):t.call(n,e[i],i,e))}(e,t,a)}},"0CxO":function(e,t){var n=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function i(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function r(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function o(){this.values=n(null)}function a(e,t,n,i){var r=i?e.split(i):[e];for(var o in r)if("string"==typeof r[o]){var a=r[o].split(n);2===a.length&&t(a[0],a[1])}}function s(e,t,n){var s=e;function l(){var t=r(e);if(null===t)throw new i(i.Errors.BadTimeStamp,"Malformed timestamp: "+s);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=l(),c(),"--\x3e"!==e.substr(0,3))throw new i(i.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);e=e.substr(3),c(),t.endTime=l(),c(),function(e,t){var i=new o;a(e,function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),a=o[0];i.integer(e,a),i.percent(e,a)&&i.set("snapToLines",!1),i.alt(e,a,["auto"]),2===o.length&&i.alt("lineAlign",o[1],["start","middle","end"]);break;case"position":o=t.split(","),i.percent(e,o[0]),2===o.length&&i.alt("positionAlign",o[1],["start","middle","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","middle","end","left","right"])}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical",""),t.line=i.get("line","auto"),t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align","middle"),t.position=i.get("position",{start:0,left:0,middle:50,end:100,right:100},t.align),t.positionAlign=i.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}(e,t)}(i.prototype=n(Error.prototype)).constructor=i,i.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var l={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"\u200e","&rlm;":"\u200f","&nbsp;":"\xa0"},c={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},u={v:"title",lang:"lang"},h={rt:"ruby"};function d(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]*>?)?/);return t=t.substr((e=n[1]?n[1]:n[2]).length),e}function i(e){return l[e]}function o(e){for(;v=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)e=e.replace(v[0],i);return e}function a(e,t){return!h[t.localName]||h[t.localName]===e.localName}function s(t,n){var i=c[t];if(!i)return null;var r=e.document.createElement(i);r.localName=i;var o=u[t];return o&&n&&(r[o]=n.trim()),r}for(var d,f=e.document.createElement("div"),p=f,g=[];null!==(d=n());)if("<"!==d[0])p.appendChild(e.document.createTextNode(o(d)));else{if("/"===d[1]){g.length&&g[g.length-1]===d.substr(2).replace(">","")&&(g.pop(),p=p.parentNode);continue}var m,_=r(d.substr(1,d.length-2));if(_){m=e.document.createProcessingInstruction("timestamp",_),p.appendChild(m);continue}var v=d.match(/^<([^.\s\/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!v)continue;if(!(m=s(v[1],v[3])))continue;if(!a(p,m))continue;v[2]&&(m.className=v[2].substr(1).replace("."," ")),g.push(v[1]),p.appendChild(m),p=m}return f}var f=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function p(e){for(var t=0;t<f.length;t++){var n=f[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function g(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function r(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var o=n.match(/^.*(\n|\r)/);return o?(e.length=0,o[0]):n}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);n=r(t);)for(var o=0;o<n.length;o++)if(p(n.charCodeAt(o)))return"rtl";return"ltr"}function m(){}function _(e,t,n){m.call(this),this.cue=t,this.cueDiv=d(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:g(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":r=t.position;break;case"middle":r=t.position-t.size/2;break;case"end":r=t.position-t.size}this.applyStyles(""===t.vertical?{left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}:{top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function v(e){var t,n,i,r;if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var o=(o=e.div.childNodes)&&(o=o[0])&&o.getClientRects&&o.getClientRects();e=e.div.getBoundingClientRect(),t=o?Math.max(o[0]&&o[0].height||0,e.height/o.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function b(e,t,n,i){var r=new v(t),o=t.cue,a=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}(o),s=[];if(o.snapToLines){var l;switch(o.vertical){case"":s=["+y","-y"],l="height";break;case"rl":s=["+x","-x"],l="width";break;case"lr":s=["-x","+x"],l="width"}var c=r.lineHeight,u=c*Math.round(a),h=n[l]+c,d=s[0];Math.abs(u)>h&&(u=u<0?-1:1,u*=Math.ceil(h/c)*c),a<0&&(u+=""===o.vertical?n.height:n.width,s=s.reverse()),r.move(d,u)}else{var f=r.lineHeight/n.height*100;switch(o.lineAlign){case"middle":a-=f/2;break;case"end":a-=f}switch(o.vertical){case"":t.applyStyles({top:t.formatStyle(a,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(a,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(a,"%")})}s=["+y","-x","+x","-y"],r=new v(t)}var p=function(e,t){for(var r,o=new v(e),a=1,s=0;s<t.length;s++){for(;e.overlapsOppositeAxis(n,t[s])||e.within(n)&&e.overlapsAny(i);)e.move(t[s]);if(e.within(n))return e;var l=e.intersectPercentage(n);a>l&&(r=new v(e),a=l),e=new v(o)}return r||o}(r,s);t.move(p.toCSSCompatValues(n))}function y(){}m.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},m.prototype.formatStyle=function(e,t){return 0===e?0:e+t},(_.prototype=n(m.prototype)).constructor=_,v.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},v.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},v.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},v.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},v.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},v.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},v.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},v.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n}},y.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},y.convertCueToDOMTree=function(e,t){return e&&t?d(e,t):null},y.processCues=function(e,t,n){if(!e||!t||!n)return null;for(;n.firstChild;)n.removeChild(n.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",n.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var r=[],o=v.getSimpleBoxPosition(i),a={font:Math.round(.05*o.height*100)/100+"px sans-serif"};!function(){for(var n,s,l=0;l<t.length;l++)n=new _(e,s=t[l],a),i.appendChild(n.div),b(0,n,o,r),s.displayState=n.div,r.push(v.getSimpleBoxPosition(n))}()}else for(var s=0;s<t.length;s++)i.appendChild(t[s].displayState)},(y.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(e){if(!(e instanceof i))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t,n=this;function l(){for(var e=n.buffer,t=0;t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var i=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,n.buffer=e.substr(t),i}e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));try{var c;if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var u=(c=l()).match(/^WEBVTT([ \t].*)?$/);if(!u||!u[0])throw new i(i.Errors.BadSignature);n.state="HEADER"}for(var h=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(h?h=!1:c=l(),n.state){case"HEADER":/:/.test(c)?(t=c).match(/X-TIMESTAMP-MAP/)?a(t,function(e,t){switch(e){case"X-TIMESTAMP-MAP":i=t,s=new o,a(i,function(e,t){switch(e){case"MPEGT":s.integer(e+"S",t);break;case"LOCA":s.set(e+"L",r(t))}},/[^\d]:/,/,/),n.ontimestampmap&&n.ontimestampmap({MPEGTS:s.get("MPEGTS"),LOCAL:s.get("LOCAL")})}var i,s},/=/):a(t,function(e,t){switch(e){case"Region":!function(e){var t=new o;if(a(e,function(e,n){switch(e){case"id":t.set(e,n);break;case"width":t.percent(e,n);break;case"lines":t.integer(e,n);break;case"regionanchor":case"viewportanchor":var i=n.split(",");if(2!==i.length)break;var r=new o;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;t.set(e+"X",r.get("x")),t.set(e+"Y",r.get("y"));break;case"scroll":t.alt(e,n,["up"])}},/=/,/\s/),t.has("id")){var i=new(n.vttjs.VTTRegion||n.window.VTTRegion);i.width=t.get("width",100),i.lines=t.get("lines",3),i.regionAnchorX=t.get("regionanchorX",0),i.regionAnchorY=t.get("regionanchorY",100),i.viewportAnchorX=t.get("viewportanchorX",0),i.viewportAnchorY=t.get("viewportanchorY",100),i.scroll=t.get("scroll",""),n.onregion&&n.onregion(i),n.regionList.push({id:t.get("id"),region:i})}}(t)}},/:/):c||(n.state="ID");continue;case"NOTE":c||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(c)){n.state="NOTE";break}if(!c)continue;if(n.cue=new(n.vttjs.VTTCue||n.window.VTTCue)(0,0,""),n.state="CUE",-1===c.indexOf("--\x3e")){n.cue.id=c;continue}case"CUE":try{s(c,n.cue,n.regionList)}catch(f){n.reportOrThrowError(f),n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var d=-1!==c.indexOf("--\x3e");if(!c||d&&(h=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=c;continue;case"BADCUE":c||(n.state="ID");continue}}}catch(f){n.reportOrThrowError(f),"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new i(i.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}},e.exports=y},"0Tbm":function(e,t,n){var i,r,o,a,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,e.exports=s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=s.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):t;var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var l=r.exec(a.path);a.netLoc=l[1],a.path=l[2]}a.netLoc&&!a.path&&(a.path="/");var c={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var u=a.path,h=u.substring(0,u.lastIndexOf("/")+1)+o.path;c.path=s.normalizePath(h)}else c.path=a.path,o.params||(c.params=a.params,o.query||(c.query=a.query));return null===c.path&&(c.path=n.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(c)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}}},1:function(e,t){},"1KsK":function(e,t,n){"use strict";var i=Object.prototype.toString;e.exports=function(e){var t=i.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===i.call(e.callee)),n}},"1seS":function(e,t,n){"use strict";var i=Array.prototype.slice,r=n("1KsK"),o=Object.keys,a=o?function(e){return o(e)}:n("sYn3"),s=Object.keys;a.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return r(e)?s(i.call(e)):s(e)}):Object.keys=a,Object.keys||a},e.exports=a},"3D7k":function(e,t,n){"use strict";var i=n("rnXk"),r=n("JW/Y").handleRollover,o={};o.ts=n("Qj6V"),o.aac=n("+9CB");var a=function(e,t,n){for(var i,r,a,s,l=0,c=188,u=!1;c<=e.byteLength;)if(71!==e[l]||71!==e[c]&&c!==e.byteLength)l++,c++;else{switch(i=e.subarray(l,c),o.ts.parseType(i,t.pid)){case"pes":r=o.ts.parsePesType(i,t.table),a=o.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&a&&(s=o.ts.parsePesTime(i))&&(s.type="audio",n.audio.push(s),u=!0)}if(u)break;l+=188,c+=188}for(l=(c=e.byteLength)-188,u=!1;l>=0;)if(71!==e[l]||71!==e[c]&&c!==e.byteLength)l--,c--;else{switch(i=e.subarray(l,c),o.ts.parseType(i,t.pid)){case"pes":r=o.ts.parsePesType(i,t.table),a=o.ts.parsePayloadUnitStartIndicator(i),"audio"===r&&a&&(s=o.ts.parsePesTime(i))&&(s.type="audio",n.audio.push(s),u=!0)}if(u)break;l-=188,c-=188}},s=function(e,t,n){for(var i,r,a,s,l,c,u,h=0,d=188,f=!1,p={data:[],size:0};d<e.byteLength;)if(71!==e[h]||71!==e[d])h++,d++;else{switch(i=e.subarray(h,d),o.ts.parseType(i,t.pid)){case"pes":if(r=o.ts.parsePesType(i,t.table),a=o.ts.parsePayloadUnitStartIndicator(i),"video"===r&&(a&&!f&&(s=o.ts.parsePesTime(i))&&(s.type="video",n.video.push(s),f=!0),!n.firstKeyFrame)){if(a&&0!==p.size){for(l=new Uint8Array(p.size),c=0;p.data.length;)u=p.data.shift(),l.set(u,c),c+=u.byteLength;if(o.ts.videoPacketContainsKeyFrame(l)){var g=o.ts.parsePesTime(l);g?(n.firstKeyFrame=g,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(i),p.size+=i.byteLength}}if(f&&n.firstKeyFrame)break;h+=188,d+=188}for(h=(d=e.byteLength)-188,f=!1;h>=0;)if(71!==e[h]||71!==e[d])h--,d--;else{switch(i=e.subarray(h,d),o.ts.parseType(i,t.pid)){case"pes":r=o.ts.parsePesType(i,t.table),a=o.ts.parsePayloadUnitStartIndicator(i),"video"===r&&a&&(s=o.ts.parsePesTime(i))&&(s.type="video",n.video.push(s),f=!0)}if(f)break;h-=188,d-=188}};e.exports={inspect:function(e,t){var n;return(n=o.aac.isLikelyAacData(e)?function(e){for(var t,n=!1,i=0,r=null,a=null,s=0,l=0;e.length-l>=3;){switch(o.aac.parseType(e,l)){case"timed-metadata":if(e.length-l<10){n=!0;break}if((s=o.aac.parseId3TagSize(e,l))>e.length){n=!0;break}null===a&&(t=e.subarray(l,l+s),a=o.aac.parseAacTimestamp(t)),l+=s;break;case"audio":if(e.length-l<7){n=!0;break}if((s=o.aac.parseAdtsSize(e,l))>e.length){n=!0;break}null===r&&(t=e.subarray(l,l+s),r=o.aac.parseSampleRate(t)),i++,l+=s;break;default:l++}if(n)return null}if(null===r||null===a)return null;var c=9e4/r;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*i*c,pts:a+1024*i*c}]}}(e):function(e){var t={pid:null,table:null},n={};for(var r in function(e,t){for(var n,i=0,r=188;r<e.byteLength;)if(71!==e[i]||71!==e[r])i++,r++;else{switch(n=e.subarray(i,r),o.ts.parseType(n,t.pid)){case"pat":t.pid||(t.pid=o.ts.parsePat(n));break;case"pmt":t.table||(t.table=o.ts.parsePmt(n))}if(t.pid&&t.table)return;i+=188,r+=188}}(e,t),t.table)if(t.table.hasOwnProperty(r))switch(t.table[r]){case i.H264_STREAM_TYPE:n.video=[],s(e,t,n),0===n.video.length&&delete n.video;break;case i.ADTS_STREAM_TYPE:n.audio=[],a(e,t,n),0===n.audio.length&&delete n.audio}return n}(e))&&(n.audio||n.video)?(function(e,t){if(e.audio&&e.audio.length){var n=t;void 0===n&&(n=e.audio[0].dts),e.audio.forEach(function(e){e.dts=r(e.dts,n),e.pts=r(e.pts,n),e.dtsTime=e.dts/9e4,e.ptsTime=e.pts/9e4})}if(e.video&&e.video.length){var i=t;if(void 0===i&&(i=e.video[0].dts),e.video.forEach(function(e){e.dts=r(e.dts,i),e.pts=r(e.pts,i),e.dtsTime=e.dts/9e4,e.ptsTime=e.pts/9e4}),e.firstKeyFrame){var o=e.firstKeyFrame;o.dts=r(o.dts,i),o.pts=r(o.pts,i),o.dtsTime=o.dts/9e4,o.ptsTime=o.dts/9e4}}}(n,t),n):null},parseAudioPes_:a}},"3G1x":function(e,t,n){"use strict";e.exports={parseSei:function(e){for(var t=0,n={payloadType:-1,payloadSize:0},i=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)i+=255,t++;for(i+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!n.payload&&4===i){n.payloadType=i,n.payloadSize=r,n.payload=e.subarray(t,t+r);break}t+=r,i=0,r=0}return n},parseUserData:function(e){return 181!==e.payload[0]?null:49!=(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},parseCaptionPackets:function(e,t){var n,i,r,o,a=[];if(!(64&t[0]))return a;for(i=31&t[0],n=0;n<i;n++)o={type:3&t[2+(r=3*n)],pts:e},4&t[r+2]&&(o.ccData=t[r+3]<<8|t[r+4],a.push(o));return a},discardEmulationPreventionBytes:function(e){for(var t,n,i=e.byteLength,r=[],o=1;o<i-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===r[0]&&(a++,r.shift()),n[o]=e[a];return n},USER_DATA_REGISTERED_ITU_T_T35:4}},"3zPy":function(e,t){function n(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return a[e];var n,o=String(e);return(n=i[o.toLowerCase()])?n:(n=r[o.toLowerCase()])||(1===o.length?o.charCodeAt(0):void 0)}n.isEventKey=function(e,t){if(e&&"object"==typeof e){var n=e.which||e.keyCode||e.charCode;if(null==n)return!1;if("string"==typeof t){var o;if(o=i[t.toLowerCase()])return o===n;if(o=r[t.toLowerCase()])return o===n}else if("number"==typeof t)return t===n;return!1}};var i=(t=e.exports=n).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=t.aliases={windows:91,"\u21e7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(o=97;o<123;o++)i[String.fromCharCode(o)]=o-32;for(var o=48;o<58;o++)i[o-48]=o;for(o=1;o<13;o++)i["f"+o]=o+111;for(o=0;o<10;o++)i["numpad "+o]=o+96;var a=t.names=t.title={};for(o in i)a[i[o]]=o;for(var s in r)i[s]=r[s]},"6ayh":function(e,t,n){"use strict";var i=Object.getOwnPropertyDescriptor?function(){return Object.getOwnPropertyDescriptor(arguments,"callee").get}():function(){throw new TypeError},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,o=Object.getPrototypeOf||function(e){return e.__proto__},a="undefined"==typeof Uint8Array?void 0:o(Uint8Array),s={"$ %Array%":Array,"$ %ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"$ %ArrayBufferPrototype%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer.prototype,"$ %ArrayIteratorPrototype%":r?o([][Symbol.iterator]()):void 0,"$ %ArrayPrototype%":Array.prototype,"$ %ArrayProto_entries%":Array.prototype.entries,"$ %ArrayProto_forEach%":Array.prototype.forEach,"$ %ArrayProto_keys%":Array.prototype.keys,"$ %ArrayProto_values%":Array.prototype.values,"$ %AsyncFromSyncIteratorPrototype%":void 0,"$ %AsyncFunction%":void 0,"$ %AsyncFunctionPrototype%":void 0,"$ %AsyncGenerator%":void 0,"$ %AsyncGeneratorFunction%":void 0,"$ %AsyncGeneratorPrototype%":void 0,"$ %AsyncIteratorPrototype%":void 0,"$ %Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"$ %Boolean%":Boolean,"$ %BooleanPrototype%":Boolean.prototype,"$ %DataView%":"undefined"==typeof DataView?void 0:DataView,"$ %DataViewPrototype%":"undefined"==typeof DataView?void 0:DataView.prototype,"$ %Date%":Date,"$ %DatePrototype%":Date.prototype,"$ %decodeURI%":decodeURI,"$ %decodeURIComponent%":decodeURIComponent,"$ %encodeURI%":encodeURI,"$ %encodeURIComponent%":encodeURIComponent,"$ %Error%":Error,"$ %ErrorPrototype%":Error.prototype,"$ %eval%":eval,"$ %EvalError%":EvalError,"$ %EvalErrorPrototype%":EvalError.prototype,"$ %Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"$ %Float32ArrayPrototype%":"undefined"==typeof Float32Array?void 0:Float32Array.prototype,"$ %Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"$ %Float64ArrayPrototype%":"undefined"==typeof Float64Array?void 0:Float64Array.prototype,"$ %Function%":Function,"$ %FunctionPrototype%":Function.prototype,"$ %Generator%":void 0,"$ %GeneratorFunction%":void 0,"$ %GeneratorPrototype%":void 0,"$ %Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"$ %Int8ArrayPrototype%":"undefined"==typeof Int8Array?void 0:Int8Array.prototype,"$ %Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"$ %Int16ArrayPrototype%":"undefined"==typeof Int16Array?void 0:Int8Array.prototype,"$ %Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"$ %Int32ArrayPrototype%":"undefined"==typeof Int32Array?void 0:Int32Array.prototype,"$ %isFinite%":isFinite,"$ %isNaN%":isNaN,"$ %IteratorPrototype%":r?o(o([][Symbol.iterator]())):void 0,"$ %JSON%":JSON,"$ %JSONParse%":JSON.parse,"$ %Map%":"undefined"==typeof Map?void 0:Map,"$ %MapIteratorPrototype%":"undefined"!=typeof Map&&r?o((new Map)[Symbol.iterator]()):void 0,"$ %MapPrototype%":"undefined"==typeof Map?void 0:Map.prototype,"$ %Math%":Math,"$ %Number%":Number,"$ %NumberPrototype%":Number.prototype,"$ %Object%":Object,"$ %ObjectPrototype%":Object.prototype,"$ %ObjProto_toString%":Object.prototype.toString,"$ %ObjProto_valueOf%":Object.prototype.valueOf,"$ %parseFloat%":parseFloat,"$ %parseInt%":parseInt,"$ %Promise%":"undefined"==typeof Promise?void 0:Promise,"$ %PromisePrototype%":"undefined"==typeof Promise?void 0:Promise.prototype,"$ %PromiseProto_then%":"undefined"==typeof Promise?void 0:Promise.prototype.then,"$ %Promise_all%":"undefined"==typeof Promise?void 0:Promise.all,"$ %Promise_reject%":"undefined"==typeof Promise?void 0:Promise.reject,"$ %Promise_resolve%":"undefined"==typeof Promise?void 0:Promise.resolve,"$ %Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"$ %RangeError%":RangeError,"$ %RangeErrorPrototype%":RangeError.prototype,"$ %ReferenceError%":ReferenceError,"$ %ReferenceErrorPrototype%":ReferenceError.prototype,"$ %Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"$ %RegExp%":RegExp,"$ %RegExpPrototype%":RegExp.prototype,"$ %Set%":"undefined"==typeof Set?void 0:Set,"$ %SetIteratorPrototype%":"undefined"!=typeof Set&&r?o((new Set)[Symbol.iterator]()):void 0,"$ %SetPrototype%":"undefined"==typeof Set?void 0:Set.prototype,"$ %SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"$ %SharedArrayBufferPrototype%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer.prototype,"$ %String%":String,"$ %StringIteratorPrototype%":r?o(""[Symbol.iterator]()):void 0,"$ %StringPrototype%":String.prototype,"$ %Symbol%":r?Symbol:void 0,"$ %SymbolPrototype%":r?Symbol.prototype:void 0,"$ %SyntaxError%":SyntaxError,"$ %SyntaxErrorPrototype%":SyntaxError.prototype,"$ %ThrowTypeError%":i,"$ %TypedArray%":a,"$ %TypedArrayPrototype%":a?a.prototype:void 0,"$ %TypeError%":TypeError,"$ %TypeErrorPrototype%":TypeError.prototype,"$ %Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"$ %Uint8ArrayPrototype%":"undefined"==typeof Uint8Array?void 0:Uint8Array.prototype,"$ %Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"$ %Uint8ClampedArrayPrototype%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray.prototype,"$ %Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"$ %Uint16ArrayPrototype%":"undefined"==typeof Uint16Array?void 0:Uint16Array.prototype,"$ %Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"$ %Uint32ArrayPrototype%":"undefined"==typeof Uint32Array?void 0:Uint32Array.prototype,"$ %URIError%":URIError,"$ %URIErrorPrototype%":URIError.prototype,"$ %WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"$ %WeakMapPrototype%":"undefined"==typeof WeakMap?void 0:WeakMap.prototype,"$ %WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet,"$ %WeakSetPrototype%":"undefined"==typeof WeakSet?void 0:WeakSet.prototype};e.exports=function(e,t){if(arguments.length>1&&"boolean"!=typeof t)throw new TypeError('"allowMissing" argument must be a boolean');var n="$ "+e;if(!(n in s))throw new SyntaxError("intrinsic "+e+" does not exist!");if(void 0===s[n]&&!t)throw new TypeError("intrinsic "+e+" exists, but is not available. Please file an issue!");return s[n]}},"7ZPM":function(e,t){e.exports={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=i,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/9e4,n=Math.floor(n)),n},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts=void 0===e.minSegmentPts?t.pts:Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts=void 0===e.maxSegmentPts?t.pts:Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts=void 0===e.minSegmentDts?t.dts:Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts=void 0===e.maxSegmentDts?t.dts:Math.max(e.maxSegmentDts,t.dts))}}},"7sdD":function(e,t,n){"use strict";var i=n("vgmO"),r=n("g2LC"),o=n("ZESv"),a=n("U6jy");function s(e,t,n){var i=e;return r(t)?(n=t,"string"==typeof e&&(i={uri:e})):i=a(t,{uri:e}),i.callback=n,i}function l(e,t,n){return c(t=s(e,t,n))}function c(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,i,r){t||(t=!0,e.callback(n,i,r))};function i(){var e=void 0;if(e=u.response?u.response:u.responseText||function(e){return"document"===e.responseType?e.responseXML:""!==e.responseType||e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName?null:e.responseXML}(u),_)try{e=JSON.parse(e)}catch(t){}return e}function r(e){return clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,v)}function a(){if(!c){var t;clearTimeout(h);var r=v,a=null;return 0!==(t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status)?(r={body:i(),statusCode:t,method:f,headers:{},url:d,rawRequest:u},u.getAllResponseHeaders&&(r.headers=o(u.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),n(a,r,r.body)}}var s,c,u=e.xhr||null;u||(u=e.cors||e.useXDR?new l.XDomainRequest:new l.XMLHttpRequest);var h,d=u.url=e.uri||e.url,f=u.method=e.method||"GET",p=e.body||e.data,g=u.headers=e.headers||{},m=!!e.sync,_=!1,v={body:void 0,headers:{},statusCode:0,method:f,url:d,rawRequest:u};if("json"in e&&!1!==e.json&&(_=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==f&&"HEAD"!==f&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),p=JSON.stringify(!0===e.json?p:e.json))),u.onreadystatechange=function(){4===u.readyState&&setTimeout(a,0)},u.onload=a,u.onerror=r,u.onprogress=function(){},u.onabort=function(){c=!0},u.ontimeout=r,u.open(f,d,!m,e.username,e.password),m||(u.withCredentials=!!e.withCredentials),!m&&e.timeout>0&&(h=setTimeout(function(){if(!c){c=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}},e.timeout)),u.setRequestHeader)for(s in g)g.hasOwnProperty(s)&&u.setRequestHeader(s,g[s]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(p||null),u}e.exports=l,l.XMLHttpRequest=i.XMLHttpRequest||function(){},l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:i.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){l["delete"===e?"del":e]=function(t,n,i){return(n=s(t,n,i)).method=e.toUpperCase(),c(n)}})},"7zRj":function(e,t,n){var i,r="undefined"!=typeof global?global:"undefined"!=typeof window?window:{},o=n(1);"undefined"!=typeof document?i=document:(i=r["__GLOBAL_DOCUMENT_CACHE@4"])||(i=r["__GLOBAL_DOCUMENT_CACHE@4"]=o),e.exports=i},"82c2":function(e,t,n){"use strict";var i=n("1seS"),r="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,a=Array.prototype.concat,s=Object.defineProperty,l=s&&function(){var e={};try{for(var t in s(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(n){return!1}}(),c=function(e,t,n,i){var r;t in e&&("function"!=typeof(r=i)||"[object Function]"!==o.call(r)||!i())||(l?s(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n)},u=function(e,t){var n=arguments.length>2?arguments[2]:{},o=i(t);r&&(o=a.call(o,Object.getOwnPropertySymbols(t)));for(var s=0;s<o.length;s+=1)c(e,o[s],t[o[s]],n[o[s]])};u.supportsDescriptors=!!l,e.exports=u},D3zA:function(e,t,n){"use strict";var i=n("aI7X");e.exports=Function.prototype.bind||i},DqJA:function(e,t,n){"use strict";var i,r,o,a=n("QykG"),s=n("Tmm6"),l=n("rnXk"),c=n("JW/Y").TimestampRolloverStream,u=n("rnXk");(i=function(){var e=new Uint8Array(188),t=0;i.prototype.init.call(this),this.push=function(n){var i,r=0,o=188;for(t?((i=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),i.set(n,t),t=0):i=n;o<i.byteLength;)71!==i[r]||71!==i[o]?(r++,o++):(this.trigger("data",i.subarray(r,o)),r+=188,o+=188);r<i.byteLength&&(e.set(i.subarray(r),0),t=i.byteLength-r)},this.flush=function(){188===t&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")}}).prototype=new a,(r=function(){var e,t,n,i;r.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var r=0;i.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===i.type?t(e.subarray(r),i):n(e.subarray(r),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},n=function(e,t){var n,r;if(1&e[5]){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<n;){var o=e[r],a=(31&e[r+1])<<8|e[r+2];o===l.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=a:o===l.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=a:o===l.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][a]=o),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=i.programMapTable}},this.push=function(t){var n={},i=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(i+=t[i]+1),0===n.pid)n.type="pat",e(t.subarray(i),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(i),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,n]):this.processPes_(t,i,n)},this.processPes_=function(e,t,n){n.streamType=n.pid===this.programMapTable.video?l.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?l.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new a,r.STREAM_TYPES={h264:27,adts:15},(o=function(){var e=this,t={data:[],size:0},n={data:[],size:0},i={data:[],size:0},r=function(t,n,i){var r,o,a=new Uint8Array(t.size),s={type:n},l=0,c=0;if(t.data.length&&!(t.size<9)){for(s.trackId=t.data[0].pid,l=0;l<t.data.length;l++)a.set((o=t.data[l]).data,c),c+=o.data.byteLength;var u,h,d;(h=s).packetLength=6+((u=a)[4]<<8|u[5]),h.dataAlignmentIndicator=0!=(4&u[6]),192&(d=u[7])&&(h.pts=(14&u[9])<<27|(255&u[10])<<20|(254&u[11])<<12|(255&u[12])<<5|(254&u[13])>>>3,h.pts*=4,h.pts+=(6&u[13])>>>1,h.dts=h.pts,64&d&&(h.dts=(14&u[14])<<27|(255&u[15])<<20|(254&u[16])<<12|(255&u[17])<<5|(254&u[18])>>>3,h.dts*=4,h.dts+=(6&u[18])>>>1)),h.data=u.subarray(9+u[8]),r="video"===n||s.packetLength<=t.size,(i||r)&&(t.size=0,t.data.length=0),r&&e.trigger("data",s)}};o.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,a;switch(o.streamType){case l.H264_STREAM_TYPE:case u.H264_STREAM_TYPE:e=t,a="video";break;case l.ADTS_STREAM_TYPE:e=n,a="audio";break;case l.METADATA_STREAM_TYPE:e=i,a="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&r(e,a,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},n=o.programMapTable;null!==n.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.video,codec:"avc",type:"video"}),null!==n.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[o.type]()},this.flush=function(){r(t,"video"),r(n,"audio"),r(i,"timed-metadata"),this.trigger("done")}}).prototype=new a;var h={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:i,TransportParseStream:r,ElementaryStream:o,TimestampRolloverStream:c,CaptionStream:s.CaptionStream,Cea608Stream:s.Cea608Stream,MetadataStream:n("W8Ai")};for(var d in l)l.hasOwnProperty(d)&&(h[d]=l[d]);e.exports=h},DwGB:function(e,t,n){"use strict";var i=n("6ayh"),r=i("%Object%"),o=i("%TypeError%"),a=i("%String%"),s=n("xG2L"),l=n("IFfy"),c=n("xhJ2"),u=n("WXWk"),h=n("u1Mj"),d=n("IdCN"),f=n("Lxf3"),p=n("oNNP");e.exports={ToPrimitive:f,ToBoolean:function(e){return!!e},ToNumber:function(e){return+e},ToInteger:function(e){var t=this.ToNumber(e);return l(t)?0:0!==t&&c(t)?u(t)*Math.floor(Math.abs(t)):t},ToInt32:function(e){return this.ToNumber(e)>>0},ToUint32:function(e){return this.ToNumber(e)>>>0},ToUint16:function(e){var t=this.ToNumber(e);if(l(t)||0===t||!c(t))return 0;var n=u(t)*Math.floor(Math.abs(t));return h(n,65536)},ToString:function(e){return a(e)},ToObject:function(e){return this.CheckObjectCoercible(e),r(e)},CheckObjectCoercible:function(e,t){if(null==e)throw new o(t||"Cannot call method on "+e);return e},IsCallable:d,SameValue:function(e,t){return e===t?0!==e||1/e==1/t:l(e)&&l(t)},Type:function(e){return null===e?"Null":void 0===e?"Undefined":"function"==typeof e||"object"==typeof e?"Object":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":"string"==typeof e?"String":void 0},IsPropertyDescriptor:function(e){if("Object"!==this.Type(e))return!1;var t={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var n in e)if(p(e,n)&&!t[n])return!1;var i=p(e,"[[Value]]"),r=p(e,"[[Get]]")||p(e,"[[Set]]");if(i&&r)throw new o("Property Descriptors may not be both accessor and data descriptors");return!0},IsAccessorDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!p(e,"[[Get]]")&&!p(e,"[[Set]]")))},IsDataDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!(!p(e,"[[Value]]")&&!p(e,"[[Writable]]")))},IsGenericDescriptor:function(e){return void 0!==e&&(s(this,"Property Descriptor","Desc",e),!this.IsAccessorDescriptor(e)&&!this.IsDataDescriptor(e))},FromPropertyDescriptor:function(e){if(void 0===e)return e;if(s(this,"Property Descriptor","Desc",e),this.IsDataDescriptor(e))return{value:e["[[Value]]"],writable:!!e["[[Writable]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};if(this.IsAccessorDescriptor(e))return{get:e["[[Get]]"],set:e["[[Set]]"],enumerable:!!e["[[Enumerable]]"],configurable:!!e["[[Configurable]]"]};throw new o("FromPropertyDescriptor must be called with a fully populated Property Descriptor")},ToPropertyDescriptor:function(e){if("Object"!==this.Type(e))throw new o("ToPropertyDescriptor requires an object");var t={};if(p(e,"enumerable")&&(t["[[Enumerable]]"]=this.ToBoolean(e.enumerable)),p(e,"configurable")&&(t["[[Configurable]]"]=this.ToBoolean(e.configurable)),p(e,"value")&&(t["[[Value]]"]=e.value),p(e,"writable")&&(t["[[Writable]]"]=this.ToBoolean(e.writable)),p(e,"get")){var n=e.get;if(void 0!==n&&!this.IsCallable(n))throw new TypeError("getter must be a function");t["[[Get]]"]=n}if(p(e,"set")){var i=e.set;if(void 0!==i&&!this.IsCallable(i))throw new o("setter must be a function");t["[[Set]]"]=i}if((p(t,"[[Get]]")||p(t,"[[Set]]"))&&(p(t,"[[Value]]")||p(t,"[[Writable]]")))throw new o("Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");return t}}},E6OW:function(e,t,n){var i=n("fhC+"),r=n("NsZL");e.exports={prefixWithSilence:function(e,t,n,o){var a,s,l,c,u=0,h=0,d=0;if(t.length&&(a=r.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(9e4/(e.samplerate/1024)),n&&o&&(u=a-Math.max(n,o),d=(h=Math.floor(u/s))*s),!(h<1||d>45e3))){for((l=i[e.samplerate])||(l=t[0].data),c=0;c<h;c++)t.splice(c,0,{data:l});e.baseMediaDecodeTime-=Math.floor(r.videoTsToAudioTs(d,e.samplerate))}},trimAdtsFramesByEarliestDts:function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},generateSampleTable:function(e){var t,n=[];for(t=0;t<e.length;t++)n.push({size:e[t].data.byteLength,duration:1024});return n},concatenateFrameData:function(e){var t,n,i=0,r=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)r.set((n=e[t]).data,i),i+=n.data.byteLength;return r}}},"G3+v":function(e,t,n){"use strict";var i=n("Vi6U");e.exports=function(){return String.prototype.trim&&"\u200b"==="\u200b".trim()?String.prototype.trim:i}},G43f:function(e,t){function n(e){return e.replace(/\n\r?\s*/g,"")}e.exports=function(e){for(var t="",i=0;i<arguments.length;i++)t+=n(e[i])+(arguments[i+1]||"");return t}},GUp9:function(e,t,n){"use strict";var i,r,o,a,s,l,c,u,h,d,f,p,g,m,_,v,b,y,T,E,x,C,S,A,P,R,M,O,w,I,D,L,k,N,F,B,U,V,G,z,j=Math.pow(2,32)-1;!function(){var e;if(C={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in C)C.hasOwnProperty(e)&&(C[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);S=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),P=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),M=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),O={video:R,audio:M},D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]),L=new Uint8Array([0,0,0,0,0,0,0,0]),k=L,N=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=L,w=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),i=function(e){var t,n,i=[],r=0;for(t=1;t<arguments.length;t++)i.push(arguments[t]);for(t=i.length;t--;)r+=i[t].byteLength;for(n=new Uint8Array(r+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,r=8;t<i.length;t++)n.set(i[t],r),r+=i[t].byteLength;return n},r=function(){return i(C.dinf,i(C.dref,D))},o=function(e){return i(C.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},_=function(e){return i(C.hdlr,O[e])},m=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),i(C.mdhd,t)},g=function(e){return i(C.mdia,m(e),_(e.type),l(e))},s=function(e){return i(C.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},l=function(e){return i(C.minf,"video"===e.type?i(C.vmhd,w):i(C.smhd,I),r(),b(e))},c=function(e,t){for(var n=[],r=t.length;r--;)n[r]=T(t[r]);return i.apply(null,[C.moof,s(e)].concat(n))},u=function(e){for(var t=e.length,n=[];t--;)n[t]=f(e[t]);return i.apply(null,[C.moov,d(4294967295)].concat(n).concat(h(e)))},h=function(e){for(var t=e.length,n=[];t--;)n[t]=E(e[t]);return i.apply(null,[C.mvex].concat(n))},d=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i(C.mvhd,t)},v=function(e){var t,n,r=e.samples||[],o=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)o[n+4]=(t=r[n].flags).dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return i(C.sdtp,o)},b=function(e){return i(C.stbl,y(e),i(C.stts,F),i(C.stsc,k),i(C.stsz,N),i(C.stco,L))},y=function(e){return i(C.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?B(e):U(e))},B=function(e){var t,n=e.sps||[],r=e.pps||[],o=[],a=[];for(t=0;t<n.length;t++)o.push((65280&n[t].byteLength)>>>8),o.push(255&n[t].byteLength),o=o.concat(Array.prototype.slice.call(n[t]));for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));return i(C.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i(C.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([n.length]).concat(o).concat([r.length]).concat(a))),i(C.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},U=function(e){return i(C.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),o(e))},p=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return i(C.tkhd,t)},T=function(e){var t,n,r,o,a,s;return t=i(C.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(e.baseMediaDecodeTime/(j+1)),s=Math.floor(e.baseMediaDecodeTime%(j+1)),n=i(C.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),"audio"===e.type?(r=x(e,92),i(C.traf,t,n,r)):(o=v(e),r=x(e,o.length+92),i(C.traf,t,n,r,o))},f=function(e){return e.duration=e.duration||4294967295,i(C.trak,p(e),g(e))},E=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),i(C.trex,t)},z=function(e,t){var n=0,i=0,r=0,o=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(o=8)),[0,0,n|i|r|o,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},G=function(e,t){var n,r,o,a;for(n=z(r=e.samples||[],t+=20+16*r.length),a=0;a<r.length;a++)n=n.concat([(4278190080&(o=r[a]).duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size,o.flags.isLeading<<2|o.flags.dependsOn,o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,61440&o.flags.degradationPriority,15&o.flags.degradationPriority,(4278190080&o.compositionTimeOffset)>>>24,(16711680&o.compositionTimeOffset)>>>16,(65280&o.compositionTimeOffset)>>>8,255&o.compositionTimeOffset]);return i(C.trun,new Uint8Array(n))},V=function(e,t){var n,r,o,a;for(n=z(r=e.samples||[],t+=20+8*r.length),a=0;a<r.length;a++)n=n.concat([(4278190080&(o=r[a]).duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size]);return i(C.trun,new Uint8Array(n))},x=function(e,t){return"audio"===e.type?V(e,t):G(e,t)},e.exports={ftyp:a=function(){return i(C.ftyp,S,A,S,P)},mdat:function(e){return i(C.mdat,e)},moof:c,moov:u,initSegment:function(e){var t,n=a(),i=u(e);return(t=new Uint8Array(n.byteLength+i.byteLength)).set(n),t.set(i,n.byteLength),t}}},IFfy:function(e,t){e.exports=Number.isNaN||function(e){return e!=e}},IdCN:function(e,t,n){"use strict";var i=Function.prototype.toString,r=/^\s*class\b/,o=function(e){try{var t=i.call(e);return r.test(t)}catch(n){return!1}},a=Object.prototype.toString,s="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(s)return function(e){try{return!o(e)&&(i.call(e),!0)}catch(t){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},"JW/Y":function(e,t,n){"use strict";var i=n("QykG"),r=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},o=function(e){var t,n;o.prototype.init.call(this),this.type_=e,this.push=function(e){e.type===this.type_&&(void 0===n&&(n=e.dts),e.dts=r(e.dts,n),e.pts=r(e.pts,n),t=e.dts,this.trigger("data",e))},this.flush=function(){n=t,this.trigger("done")},this.discontinuity=function(){n=void 0,t=void 0}};o.prototype=new i,e.exports={TimestampRolloverStream:o,handleRollover:r}},K4wu:function(e,t,n){var i=n("vgmO"),r=e.exports={WebVTT:n("0CxO"),VTTCue:n("sDzi"),VTTRegion:n("+X0y")};i.vttjs=r,i.WebVTT=r.WebVTT;var o=r.VTTCue,a=r.VTTRegion,s=i.VTTCue,l=i.VTTRegion;r.shim=function(){i.VTTCue=o,i.VTTRegion=a},r.restore=function(){i.VTTCue=s,i.VTTRegion=l},i.VTTCue||r.shim()},KAYj:function(e,t,n){"use strict";var i,r,o,a,s,l=n("f+Ey").toUnsigned;o=function(e){return i(e,["moov","trak"]).reduce(function(e,t){var n,r,o,a;return(n=i(t,["tkhd"])[0])?(o=l(n[r=0===n[0]?12:20]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3]),(a=i(t,["mdia","mdhd"])[0])?(e[o]=l(a[r=0===a[0]?12:20]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]),e):null):null},{})},a=function(e,t){var n,r,o;return n=i(t,["moof","traf"]),r=[].concat.apply([],n.map(function(t){return i(t,["tfhd"]).map(function(n){var r,o;return r=l(n[4]<<24|n[5]<<16|n[6]<<8|n[7]),o=e[r]||9e4,(i(t,["tfdt"]).map(function(e){var t,n;return t=e[0],n=l(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(n*=Math.pow(2,32),n+=l(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),n})[0]||1/0)/o})})),o=Math.min.apply(null,r),isFinite(o)?o:0},s=function(e){var t=i(e,["moov","trak"]),n=[];return t.forEach(function(e){var t=i(e,["mdia","hdlr"]),o=i(e,["tkhd"]);t.forEach(function(e,t){var i,a,s,l=r(e.subarray(8,12)),c=o[t];"vide"===l&&(a=(i=new DataView(c.buffer,c.byteOffset,c.byteLength)).getUint8(0),s=i.getUint32(0===a?12:20),n.push(s))})}),n},e.exports={findBox:i=function(e,t){var n,o,a,s,c,u=[];if(!t.length)return null;for(n=0;n<e.byteLength;)o=l(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=r(e.subarray(n+4,n+8)),s=o>1?n+o:e.byteLength,a===t[0]&&(1===t.length?u.push(e.subarray(n+8,s)):(c=i(e.subarray(n+8,s),t.slice(1))).length&&(u=u.concat(c))),n=s;return u},parseType:r=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),(t+=String.fromCharCode(e[2]))+String.fromCharCode(e[3])},timescale:o,startTime:a,videoTrackIds:s}},KOUu:function(e,t,n){e.exports={generator:n("GUp9"),probe:n("KAYj"),Transmuxer:n("MAqa").Transmuxer,AudioSegmentStream:n("MAqa").AudioSegmentStream,VideoSegmentStream:n("MAqa").VideoSegmentStream,CaptionParser:n("qOD0")}},Lp8T:function(e,t){var n=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n};e.exports={groupNalsIntoFrames:function(e){var t,n,i=[],r=[];for(i.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(i.length&&(i.duration=n.dts-i.dts,r.push(i)),(i=[n]).byteLength=n.data.byteLength,i.pts=n.pts,i.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(i.keyFrame=!0),i.duration=n.dts-i.dts,i.byteLength+=n.data.byteLength,i.push(n));return r.length&&(!i.duration||i.duration<=0)&&(i.duration=r[r.length-1].duration),r.push(i),r},groupFramesIntoGops:function(e){var t,n,i=[],r=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(i.length&&(r.push(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration),(i=[n]).nalCount=n.length,i.byteLength=n.byteLength,i.pts=n.pts,i.dts=n.dts,i.duration=n.duration):(i.duration+=n.duration,i.nalCount+=n.length,i.byteLength+=n.byteLength,i.push(n));return r.length&&i.duration<=0&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration,r.push(i),r},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var i,r,o,a,s=t||0,l=[];for(i=0;i<e.length;i++)for(a=e[i],r=0;r<a.length;r++)s+=(o=n(a[r],s)).size,l.push(o);return l},concatenateNalData:function(e){var t,n,i,r,o,a,s=0,l=new Uint8Array(e.byteLength+4*e.nalCount),c=new DataView(l.buffer);for(t=0;t<e.length;t++)for(r=e[t],n=0;n<r.length;n++)for(o=r[n],i=0;i<o.length;i++)c.setUint32(s,(a=o[i]).data.byteLength),l.set(a.data,s+=4),s+=a.data.byteLength;return l}}},Lxf3:function(e,t,n){"use strict";var i=Object.prototype.toString,r=n("Teho"),o=n("IdCN"),a=function(e){var t;if((t=arguments.length>1?arguments[1]:"[object Date]"===i.call(e)?String:Number)===String||t===Number){var n,a,s=t===String?["toString","valueOf"]:["valueOf","toString"];for(a=0;a<s.length;++a)if(o(e[s[a]])&&(n=e[s[a]](),r(n)))return n;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")};e.exports=function(e){return r(e)?e:arguments.length>1?a(e,arguments[1]):a(e)}},MAqa:function(e,t,n){"use strict";var i,r,o,a,s=n("QykG"),l=n("GUp9"),c=n("Lp8T"),u=n("E6OW"),h=n("7ZPM"),d=n("DqJA"),f=n("T88H"),p=n("YxoY").H264Stream,g=n("nVYC"),m=n("+9CB").isLikelyAacData,_=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],v=["width","height","profileIdc","levelIdc","profileCompatibility"],b=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},y=function(e,t,n,i,r,o){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(i-t),pts:e+(r-n)},prependedContentDuration:o,baseMediaDecodeTime:e}};(r=function(e,t){var n=[],i=0,o=0,a=0,s=1/0;t=t||{},r.prototype.init.call(this),this.push=function(t){h.collectDtsInfo(e,t),e&&_.forEach(function(n){e[n]=t[n]}),n.push(t)},this.setEarliestDts=function(t){o=t-e.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){a=e},this.flush=function(){var r,c,d,f;0!==n.length?(r=u.trimAdtsFramesByEarliestDts(n,e,o),e.baseMediaDecodeTime=h.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),u.prefixWithSilence(e,r,a,s),e.samples=u.generateSampleTable(r),d=l.mdat(u.concatenateFrameData(r)),n=[],c=l.moof(i,[e]),f=new Uint8Array(c.byteLength+d.byteLength),i++,f.set(c),f.set(d,c.byteLength),h.clearDtsInfo(e),this.trigger("data",{track:e,boxes:f}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")}}).prototype=new s,(i=function(e,t){var n,r,o=0,a=[],s=[];t=t||{},i.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){h.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],v.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),a.push(t)},this.flush=function(){for(var n,i,r,u,d,f,p,g,m=0;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(n=c.groupNalsIntoFrames(a),(r=c.groupFramesIntoGops(n))[0][0].keyFrame||((i=this.getGopForFusion_(a[0],e))?(m=i.duration,r.unshift(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.pts=i.pts,r.dts=i.dts,r.duration+=i.duration):r=c.extendFirstKeyFrame(r)),s.length){var _;if(!(_=t.alignGopsAtEnd?this.alignGopsAtEnd_(r):this.alignGopsAtStart_(r)))return this.gopCache_.unshift({gop:r.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");h.clearDtsInfo(e),r=_}h.collectDtsInfo(e,r),e.samples=c.generateSampleTable(r),d=l.mdat(c.concatenateNalData(r)),e.baseMediaDecodeTime=h.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",r.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),this.trigger("segmentTimingInfo",y(e.baseMediaDecodeTime,(p=r[0]).dts,p.pts,(g=r[r.length-1]).dts+g.duration,g.pts+g.duration,m)),this.gopCache_.unshift({gop:r.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),u=l.moof(o,[e]),f=new Uint8Array(u.byteLength+d.byteLength),o++,f.set(u),f.set(d,u.byteLength),this.trigger("data",{track:e,boxes:f}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){h.clearDtsInfo(e),n=void 0,r=void 0},this.getGopForFusion_=function(t){var n,i,r,o,a,s=1/0;for(a=0;a<this.gopCache_.length;a++)r=(o=this.gopCache_[a]).gop,e.pps&&b(e.pps[0],o.pps[0])&&e.sps&&b(e.sps[0],o.sps[0])&&(r.dts<e.timelineStartInfo.dts||(n=t.dts-r.dts-r.duration)>=-1e4&&n<=45e3&&(!i||s>n)&&(i=o,s=n));return i?i.gop:null},this.alignGopsAtStart_=function(e){var t,n,i,r,o,a,l,c;for(o=e.byteLength,a=e.nalCount,l=e.duration,t=n=0;t<s.length&&n<e.length&&(i=s[t]).pts!==(r=e[n]).pts;)r.pts>i.pts?t++:(n++,o-=r.byteLength,a-=r.nalCount,l-=r.duration);return 0===n?e:n===e.length?null:((c=e.slice(n)).byteLength=o,c.duration=l,c.nalCount=a,c.pts=c[0].pts,c.dts=c[0].dts,c)},this.alignGopsAtEnd_=function(e){var t,n,i,r,o,a,l;for(t=s.length-1,n=e.length-1,o=null,a=!1;t>=0&&n>=0;){if((i=s[t]).pts===(r=e[n]).pts){a=!0;break}i.pts>r.pts?t--:(t===s.length-1&&(o=n),n--)}if(!a&&null===o)return null;if(0===(l=a?n:o))return e;var c=e.slice(l),u=c.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return c.byteLength=u.byteLength,c.duration=u.duration,c.nalCount=u.nalCount,c.pts=c[0].pts,c.dts=c[0].dts,c},this.alignGopsWith=function(e){s=e}}).prototype=new s,(a=function(e,t){this.numberOfTracks=0,this.metadataStream=t,this.remuxTracks=void 0===(e=e||{}).remux||!!e.remux,"boolean"==typeof e.keepOriginalTimestamps&&(this.keepOriginalTimestamps=e.keepOriginalTimestamps),this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,a.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBoxes.push(e.boxes),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track),void("audio"===e.track.type&&(this.audioTrack=e.track)))}}).prototype=new s,a.prototype.flush=function(e){var t,n,i,r,o=0,a={captions:[],captionStreams:{},metadata:[],info:{}},s=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,v.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,_.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),a.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,i=l.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(i.byteLength),a.initSegment.set(i),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],o),o+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=t.startPts,this.keepOriginalTimestamps||(t.startTime-=s),t.startTime/=9e4,t.endTime=t.endPts,this.keepOriginalTimestamps||(t.endTime-=s),t.endTime/=9e4,a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(n=this.pendingMetadata[r]).cueTime=n.pts,this.keepOriginalTimestamps||(n.cueTime-=s),n.cueTime/=9e4,a.metadata.push(n);a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(o=function(e){var t,n,s=this,l=!0;o.prototype.init.call(this),this.baseMediaDecodeTime=(e=e||{}).baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t,t.type="aac",t.metadataStream=new d.MetadataStream,t.aacStream=new g,t.audioTimestampRolloverStream=new d.TimestampRolloverStream("audio"),t.timedMetadataTimestampRolloverStream=new d.TimestampRolloverStream("timed-metadata"),t.adtsStream=new f,t.coalesceStream=new a(e,t.metadataStream),t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)}),t.aacStream.on("data",function(i){"timed-metadata"!==i.type||t.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:s.baseMediaDecodeTime},codec:"adts",type:"audio"},t.coalesceStream.numberOfTracks++,t.audioSegmentStream=new r(n,e),t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream))}),t.coalesceStream.on("data",this.trigger.bind(this,"data")),t.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var o={};this.transmuxPipeline_=o,o.type="ts",o.metadataStream=new d.MetadataStream,o.packetStream=new d.TransportPacketStream,o.parseStream=new d.TransportParseStream,o.elementaryStream=new d.ElementaryStream,o.videoTimestampRolloverStream=new d.TimestampRolloverStream("video"),o.audioTimestampRolloverStream=new d.TimestampRolloverStream("audio"),o.timedMetadataTimestampRolloverStream=new d.TimestampRolloverStream("timed-metadata"),o.adtsStream=new f,o.h264Stream=new p,o.captionStream=new d.CaptionStream,o.coalesceStream=new a(e,o.metadataStream),o.headOfPipeline=o.packetStream,o.packetStream.pipe(o.parseStream).pipe(o.elementaryStream),o.elementaryStream.pipe(o.videoTimestampRolloverStream).pipe(o.h264Stream),o.elementaryStream.pipe(o.audioTimestampRolloverStream).pipe(o.adtsStream),o.elementaryStream.pipe(o.timedMetadataTimestampRolloverStream).pipe(o.metadataStream).pipe(o.coalesceStream),o.h264Stream.pipe(o.captionStream).pipe(o.coalesceStream),o.elementaryStream.on("data",function(a){var l;if("metadata"===a.type){for(l=a.tracks.length;l--;)t||"video"!==a.tracks[l].type?n||"audio"!==a.tracks[l].type||((n=a.tracks[l]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime):(t=a.tracks[l]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime;t&&!o.videoSegmentStream&&(o.coalesceStream.numberOfTracks++,o.videoSegmentStream=new i(t,e),o.videoSegmentStream.on("timelineStartInfo",function(e){n&&(n.timelineStartInfo=e,o.audioSegmentStream.setEarliestDts(e.dts))}),o.videoSegmentStream.on("processedGopsInfo",s.trigger.bind(s,"gopInfo")),o.videoSegmentStream.on("segmentTimingInfo",s.trigger.bind(s,"videoSegmentTimingInfo")),o.videoSegmentStream.on("baseMediaDecodeTime",function(e){n&&o.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),o.h264Stream.pipe(o.videoSegmentStream).pipe(o.coalesceStream)),n&&!o.audioSegmentStream&&(o.coalesceStream.numberOfTracks++,o.audioSegmentStream=new r(n,e),o.adtsStream.pipe(o.audioSegmentStream).pipe(o.coalesceStream))}}),o.coalesceStream.on("data",this.trigger.bind(this,"data")),o.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(i){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=i),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,h.clearDtsInfo(n),e.keepOriginalTimestamps||(n.timelineStartInfo.baseMediaDecodeTime=i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[],r.videoTimestampRolloverStream.discontinuity()),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,h.clearDtsInfo(t),r.captionStream.reset(),e.keepOriginalTimestamps||(t.timelineStartInfo.baseMediaDecodeTime=i)),r.timedMetadataTimestampRolloverStream&&r.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(e){if(l){var t=m(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),l=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){l=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new s,e.exports={Transmuxer:o,VideoSegmentStream:i,AudioSegmentStream:r,AUDIO_PROPERTIES:_,VIDEO_PROPERTIES:v,generateVideoSegmentTimingInfo:y}},MkAJ:function(e,t,n){"use strict";e.exports=function(e){var t=e.byteLength,n=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var r=e.byteLength-t,o=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");o.set(e.subarray(r,r+a)),n=new DataView(o.buffer).getUint32(0),i=8*a,t-=a},this.skipBits=function(e){var r;i>e?(n<<=e,i-=e):(e-=i,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),n<<=e,i-=e)},this.readBits=function(e){var r=Math.min(i,e),o=n>>>32-r;return(i-=r)>0?n<<=r:t>0&&this.loadWord(),(r=e-r)>0?o<<r|this.readBits(r):o},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(0!=(n&2147483648>>>e))return n<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()}},NsZL:function(e,t){var n,i,r,o,a,s;a=function(e,t){return n(o(e,t))},s=function(e,t){return i(r(e),t)},e.exports={secondsToVideoTs:n=function(e){return 9e4*e},secondsToAudioTs:i=function(e,t){return e*t},videoTsToSeconds:r=function(e){return e/9e4},audioTsToSeconds:o=function(e,t){return e/t},audioTsToVideoTs:a,videoTsToAudioTs:s}},Qj6V:function(e,t,n){"use strict";var i=n("rnXk"),r=function(e){var t=31&e[1];return(t<<=8)|e[2]},o=function(e){return!!(64&e[1])},a=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},s=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};e.exports={parseType:function(e,t){var n=r(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},parsePat:function(e){var t=o(e),n=4+a(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},parsePmt:function(e){var t={},n=o(e),i=4+a(e);if(n&&(i+=e[i]+1),1&e[i+5]){var r;r=3+((15&e[i+1])<<8|e[i+2])-4;for(var s=12+((15&e[i+10])<<8|e[i+11]);s<r;){var l=i+s;t[(31&e[l+1])<<8|e[l+2]]=e[l],s+=5+((15&e[l+3])<<8|e[l+4])}return t}},parsePayloadUnitStartIndicator:o,parsePesType:function(e,t){switch(t[r(e)]){case i.H264_STREAM_TYPE:return"video";case i.ADTS_STREAM_TYPE:return"audio";case i.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(e){if(!o(e))return null;var t=4+a(e);if(t>=e.byteLength)return null;var n,i=null;return 192&(n=e[t+7])&&((i={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,i.pts*=4,i.pts+=(6&e[t+13])>>>1,i.dts=i.pts,64&n&&(i.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,i.dts*=4,i.dts+=(6&e[t+18])>>>1)),i},videoPacketContainsKeyFrame:function(e){for(var t=4+a(e),n=e.subarray(t),i=0,r=0,o=!1;r<n.byteLength-3;r++)if(1===n[r+2]){i=r+5;break}for(;i<n.byteLength;)switch(n[i]){case 0:if(0!==n[i-1]){i+=2;break}if(0!==n[i-2]){i++;break}r+3!==i-2&&"slice_layer_without_partitioning_rbsp_idr"===s(31&n[r+3])&&(o=!0);do{i++}while(1!==n[i]&&i<n.length);r=i-2,i+=3;break;case 1:if(0!==n[i-1]||0!==n[i-2]){i+=3;break}"slice_layer_without_partitioning_rbsp_idr"===s(31&n[r+3])&&(o=!0),r=i-2,i+=3;break;default:i+=3}return n=n.subarray(r),i-=r,r=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===s(31&n[r+3])&&(o=!0),o}}},QykG:function(e,t,n){"use strict";var i=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var i;return!!e[t]&&(i=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(i,1),i>-1)},this.trigger=function(t){var n,i,r,o;if(n=e[t])if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(o=[],i=arguments.length,i=1;i<arguments.length;++i)o.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,o)}},this.dispose=function(){e={}}}};i.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},i.prototype.push=function(e){this.trigger("data",e)},i.prototype.flush=function(e){this.trigger("done",e)},e.exports=i},T88H:function(e,t,n){"use strict";var i,r=n("QykG"),o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(i=function(){var e;i.prototype.init.call(this),this.push=function(t){var n,i,r,a,s=0,l=0;if("audio"===t.type)for(e?(i=e,(e=new Uint8Array(i.byteLength+t.data.byteLength)).set(i),e.set(t.data,i.byteLength)):e=t.data;s+5<e.length;)if(255===e[s]&&240==(246&e[s+1])){if(e.byteLength<(n=s+((3&e[s+3])<<11|e[s+4]<<3|(224&e[s+5])>>5)))return;if(this.trigger("data",{pts:t.pts+l*(a=9e4*(r=1024*(1+(3&e[s+6])))/o[(60&e[s+2])>>>2]),dts:t.dts+l*a,sampleCount:r,audioobjecttype:1+(e[s+2]>>>6&3),channelcount:(1&e[s+2])<<2|(192&e[s+3])>>>6,samplerate:o[(60&e[s+2])>>>2],samplingfrequencyindex:(60&e[s+2])>>>2,samplesize:16,data:e.subarray(s+7+2*(1&~e[s+1]),n)}),e.byteLength===n)return void(e=void 0);l++,e=e.subarray(n)}else s++},this.flush=function(){this.trigger("done")}}).prototype=new r,e.exports=i},Teho:function(e,t){e.exports=function(e){return null===e||"function"!=typeof e&&"object"!=typeof e}},Tmm6:function(e,t,n){"use strict";var i=n("QykG"),r=n("3G1x"),o=function(){o.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new u(0,0),new u(0,1),new u(1,0),new u(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("done",this.trigger.bind(this,"done"))},this)};o.prototype=new i,o.prototype.push=function(e){var t,n,i;if("sei_rbsp"===e.nalUnitType&&(t=r.parseSei(e.escapedRBSP)).payloadType===r.USER_DATA_REGISTERED_ITU_T_T35&&(n=r.parseUserData(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=r.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},o.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.ccStreams_.forEach(function(e){e.flush()},this)):this.ccStreams_.forEach(function(e){e.flush()},this)},o.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},o.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},o.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},o.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},o.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)};var a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},s=function(e){return null===e?"":(e=a[e]||e,String.fromCharCode(e))},l=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],c=function(){for(var e=[],t=15;t--;)e.push("");return e},u=function(e,t){u.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,i,r,o;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=c();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=c();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=c()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,r))o=s((i=(3&i)<<8)|r),this[this.mode_](e.pts,o),this.column_++;else if(this.isExtCharacter(i,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),o=s((i=(3&i)<<8)|r),this[this.mode_](e.pts,o),this.column_++;else if(this.isMidRowCode(i,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&r)&&this.addFormatting(e.pts,["i"]),1==(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,r))this.column_+=3&r;else if(this.isPAC(i,r)){var a=l.indexOf(7968&t);"rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===r&&(r=null),o=s(i),o+=s(r),this[this.mode_](e.pts,o),this.column_+=o.length)}else this.lastControlCode_=null}};u.prototype=new i,u.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){try{return e.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},u.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=c(),this.nonDisplayed_=c(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},u.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},u.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},u.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},u.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},u.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},u.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},u.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},u.prototype.isNormalChar=function(e){return e>=32&&e<=127},u.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=c(),this.displayed_=c()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},u.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,n)},u.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},u.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_];this.nonDisplayed_[this.row_]=n+=t},u.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_];this.displayed_[this.row_]=n+=t},u.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},u.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_];this.displayed_[this.row_]=n+=t},e.exports={CaptionStream:o,Cea608Stream:u}},U6jy:function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)n.call(i,r)&&(e[r]=i[r])}return e};var n=Object.prototype.hasOwnProperty},Vi6U:function(e,t,n){"use strict";var i=n("D3zA"),r=n("DwGB"),o=i.call(Function.call,String.prototype.replace),a=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,s=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=r.ToString(r.CheckObjectCoercible(this));return o(o(e,a,""),s,"")}},W8Ai:function(e,t,n){"use strict";var i,r=n("QykG"),o=n("rnXk"),a=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},s=function(e,t,n){return decodeURIComponent(a(e,t,n))},l=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},c={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=s(e.data,1,t),e.value=s(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=s(e.data,1,t),e.url=s(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=unescape(a(e.data,0,t));break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(i=function(e){var t,n={debug:!(!e||!e.debug),descriptor:e&&e.descriptor},r=0,a=[],s=0;if(i.prototype.init.call(this),this.dispatchType=o.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,i,o,u,h;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,a.length=0),0===a.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))n.debug&&console.log("Skipping unrecognized metadata packet");else if(a.push(e),s+=e.data.byteLength,1===a.length&&(r=l(e.data.subarray(6,10)),r+=10),!(s<r)){for(t={data:new Uint8Array(r),frames:[],pts:a[0].pts,dts:a[0].dts},h=0;h<r;)t.data.set(a[0].data.subarray(0,r-h),h),h+=a[0].data.byteLength,s-=a[0].data.byteLength,a.shift();i=10,64&t.data[5]&&(i+=4,i+=l(t.data.subarray(10,14)),r-=l(t.data.subarray(16,20)));do{if((o=l(t.data.subarray(i+4,i+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((u={id:String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]),data:t.data.subarray(i+10,i+o+10)}).key=u.id,c[u.id]&&(c[u.id](u),"com.apple.streaming.transportStreamTimestamp"===u.owner)){var d=u.data,f=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;f*=4,u.timeStamp=f+=3&d[7],void 0===t.pts&&void 0===t.dts&&(t.pts=u.timeStamp,t.dts=u.timeStamp),this.trigger("timestamp",u)}t.frames.push(u),i+=10,i+=o}while(i<r);this.trigger("data",t)}}}).prototype=new r,e.exports=i},WXWk:function(e,t){e.exports=function(e){return e>=0?1:-1}},YxoY:function(e,t,n){"use strict";var i,r,o,a=n("QykG"),s=n("MkAJ");(r=function(){var e,t,n=0;r.prototype.init.call(this),this.push=function(i){var r;for(t?((r=new Uint8Array(t.byteLength+i.data.byteLength)).set(t),r.set(i.data,t.byteLength),t=r):t=i.data;n<t.byteLength-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<t.byteLength;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<t.length);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")}}).prototype=new a,o={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(i=function(){var e,t,n,a,l,c,u,h=new r;i.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,a=e.dts,h.push(e))},h.on("data",function(i){var r={trackId:t,pts:n,dts:a,data:i};switch(31&i[0]){case 5:r.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:r.nalUnitType="sei_rbsp",r.escapedRBSP=l(i.subarray(1));break;case 7:r.nalUnitType="seq_parameter_set_rbsp",r.escapedRBSP=l(i.subarray(1)),r.config=c(r.escapedRBSP);break;case 8:r.nalUnitType="pic_parameter_set_rbsp";break;case 9:r.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",r)}),h.on("done",function(){e.trigger("done")}),this.flush=function(){h.flush()},u=function(e,t){var n,i=8,r=8;for(n=0;n<e;n++)0!==r&&(r=(i+t.readExpGolomb()+256)%256),i=0===r?i:r},l=function(e){for(var t,n,i=e.byteLength,r=[],o=1;o<i-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===r[0]&&(a++,r.shift()),n[o]=e[a];return n},c=function(e){var t,n,i,r,a,l,c,h,d,f,p,g,m,_=0,v=0,b=0,y=0,T=1;if(n=(t=new s(e)).readUnsignedByte(),r=t.readUnsignedByte(),i=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),o[n]&&(3===(a=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(p=3!==a?8:12,m=0;m<p;m++)t.readBoolean()&&u(m<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(l=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===l)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),c=t.readUnsignedExpGolomb(),m=0;m<c;m++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),h=t.readUnsignedExpGolomb(),d=t.readUnsignedExpGolomb(),0===(f=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(_=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb(),b=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:g=[1,1];break;case 2:g=[12,11];break;case 3:g=[10,11];break;case 4:g=[16,11];break;case 5:g=[40,33];break;case 6:g=[24,11];break;case 7:g=[20,11];break;case 8:g=[32,11];break;case 9:g=[80,33];break;case 10:g=[18,11];break;case 11:g=[15,11];break;case 12:g=[64,33];break;case 13:g=[160,99];break;case 14:g=[4,3];break;case 15:g=[3,2];break;case 16:g=[2,1];break;case 255:g=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}g&&(T=g[0]/g[1])}return{profileIdc:n,levelIdc:i,profileCompatibility:r,width:Math.ceil((16*(h+1)-2*_-2*v)*T),height:(2-f)*(d+1)*16-2*b-2*y}}}).prototype=new a,e.exports={H264Stream:i,NalByteStream:r}},Yzuk:function(e,t,n){"undefined"!=typeof self?self:"undefined"!=typeof global&&global,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,(function(t){return e[t]}).bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=129)}([function(e,t,n){"use strict";n.d(t,"u",function(){return a}),n.d(t,"v",function(){return s}),n.d(t,"h",function(){return l}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return u}),n.d(t,"w",function(){return h}),n.d(t,"x",function(){return d}),n.d(t,"y",function(){return f}),n.d(t,"r",function(){return p}),n.d(t,"q",function(){return g}),n.d(t,"j",function(){return m}),n.d(t,"n",function(){return _}),n.d(t,"z",function(){return v}),n.d(t,"i",function(){return b}),n.d(t,"s",function(){return i}),n.d(t,"c",function(){return T}),n.d(t,"d",function(){return E}),n.d(t,"k",function(){return y}),n.d(t,"a",function(){return x}),n.d(t,"b",function(){return C}),n.d(t,"l",function(){return S}),n.d(t,"m",function(){return A}),n.d(t,"g",function(){return P}),n.d(t,"p",function(){return R}),n.d(t,"o",function(){return M}),n.d(t,"t",function(){return O});var i,r=n(34),o=n(12),a=1/2.2,s=2.2,l=.001,c=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.r=e,this.g=t,this.b=n}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var e=this.r||0;return 397*(e=397*e^(this.g||0))^(this.b||0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.toColor4=function(e){return void 0===e&&(e=1),new u(this.r,this.g,this.b,e)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,n){return this.r===e&&this.g===t&&this.b===n},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=1),n.r=o.a.Clamp(this.r,e,t),n.g=o.a.Clamp(this.g,e,t),n.b=o.a.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,n){return this.r=e,this.g=t,this.b=n,this},e.prototype.set=function(e,t,n){return this.copyFromFloats(e,t,n)},e.prototype.toHexString=function(){var e=255*this.g|0,t=255*this.b|0;return"#"+o.a.ToHex(255*this.r|0)+o.a.ToHex(e)+o.a.ToHex(t)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,s),e.g=Math.pow(this.g,s),e.b=Math.pow(this.b,s),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,a),e.g=Math.pow(this.g,a),e.b=Math.pow(this.b,a),this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16);return e.FromInts(n,i,r)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2])},e.FromInts=function(t,n,i){return new e(t/255,n/255,i/255)},e.Lerp=function(t,n,i){var r=new e(0,0,0);return e.LerpToRef(t,n,i,r),r},e.LerpToRef=function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!0,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),u=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.r=e,this.g=t,this.b=n,this.a=i}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=1),n.r=o.a.Clamp(this.r,e,t),n.g=o.a.Clamp(this.g,e,t),n.b=o.a.Clamp(this.b,e,t),n.a=o.a.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=this.r||0;return 397*(e=397*(e=397*e^(this.g||0))^(this.b||0))^(this.a||0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,n,i){return this.r=e,this.g=t,this.b=n,this.a=i,this},e.prototype.set=function(e,t,n,i){return this.copyFromFloats(e,t,n,i)},e.prototype.toHexString=function(){var e=255*this.g|0,t=255*this.b|0,n=255*this.a|0;return"#"+o.a.ToHex(255*this.r|0)+o.a.ToHex(e)+o.a.ToHex(t)+o.a.ToHex(n)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,s),e.g=Math.pow(this.g,s),e.b=Math.pow(this.b,s),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,a),e.g=Math.pow(this.g,a),e.b=Math.pow(this.b,a),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new e(0,0,0,0);var n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),o=parseInt(t.substring(7,9),16);return e.FromInts(n,i,r,o)},e.Lerp=function(t,n,i){var r=new e(0,0,0,0);return e.LerpToRef(t,n,i,r),r},e.LerpToRef=function(e,t,n,i){i.r=e.r+(t.r-e.r)*n,i.g=e.g+(t.g-e.g)*n,i.b=e.b+(t.b-e.b)*n,i.a=e.a+(t.a-e.a)*n},e.FromColor3=function(t,n){return void 0===n&&(n=1),new e(t.r,t.g,t.b,n)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromInts=function(t,n,i,r){return new e(t/255,n/255,i/255,r/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var n=[],i=0;i<e.length;i+=3){var r=i/3*4;n[r]=e[i],n[r+1]=e[i+1],n[r+2]=e[i+2],n[r+3]=1}return n}return e},e}(),h=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,n){return new e(this.x*t,this.y*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var n=new e(0,0);return this.scaleToRef(t,n),n},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1])},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1]},e.CatmullRom=function(t,n,i,r,o){var a=o*o,s=o*a;return new e(.5*(2*n.x+(-t.x+i.x)*o+(2*t.x-5*n.x+4*i.x-r.x)*a+(3*n.x-t.x-3*i.x+r.x)*s),.5*(2*n.y+(-t.y+i.y)*o+(2*t.y-5*n.y+4*i.y-r.y)*a+(3*n.y-t.y-3*i.y+r.y)*s))},e.Clamp=function(t,n,i){var r=t.x;r=(r=r>i.x?i.x:r)<n.x?n.x:r;var o=t.y;return new e(r,o=(o=o>i.y?i.y:o)<n.y?n.y:o)},e.Hermite=function(t,n,i,r,o){var a=o*o,s=o*a,l=2*s-3*a+1,c=-2*s+3*a,u=s-2*a+o,h=s-a;return new e(t.x*l+i.x*c+n.x*u+r.x*h,t.y*l+i.y*c+n.y*u+r.y*h)},e.Lerp=function(t,n,i){return new e(t.x+(n.x-t.x)*i,t.y+(n.y-t.y)*i)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(e){var t=e.clone();return t.normalize(),t},e.Minimize=function(t,n){return new e(t.x<n.x?t.x:n.x,t.y<n.y?t.y:n.y)},e.Maximize=function(t,n){return new e(t.x>n.x?t.x:n.x,t.y>n.y?t.y:n.y)},e.Transform=function(t,n){var i=e.Zero();return e.TransformToRef(t,n,i),i},e.TransformToRef=function(e,t,n){var i=t.m,r=e.x*i[1]+e.y*i[5]+i[13];n.x=e.x*i[0]+e.y*i[4]+i[12],n.y=r},e.PointInTriangle=function(e,t,n,i){var r=.5*(-n.y*i.x+t.y*(-n.x+i.x)+t.x*(n.y-i.y)+n.x*i.y),o=r<0?-1:1,a=(t.y*i.x-t.x*i.y+(i.y-t.y)*e.x+(t.x-i.x)*e.y)*o,s=(t.x*n.y-t.y*n.x+(t.y-n.y)*e.x+(n.x-t.x)*e.y)*o;return a>0&&s>0&&a+s<2*r*o},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.DistanceOfPointFromSegment=function(t,n,i){var r=e.DistanceSquared(n,i);if(0===r)return e.Distance(t,n);var o=i.subtract(n),a=Math.max(0,Math.min(1,e.Dot(t.subtract(n),o)/r)),s=n.add(o.multiplyByFloats(a,a));return e.Distance(t,s)},e}(),d=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var e=this.x||0;return 397*(e=397*e^(this.y||0))^(this.z||0)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},e.prototype.toQuaternion=function(){return g.RotationYawPitchRoll(this.y,this.x,this.z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.addInPlaceFromFloats=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this.x+e.x,this.y+e.y,this.z+e.z)},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e.x,e.y,e.z,t)},e.prototype.subtractFromFloats=function(t,n,i){return new e(this.x-t,this.y-n,this.z-i)},e.prototype.subtractFromFloatsToRef=function(e,t,n,i){return i.copyFromFloats(this.x-e,this.y-t,this.z-n)},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)},e.prototype.equalsToFloats=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e.x,e.y,e.z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.x,this.y*e.y,this.z*e.z)},e.prototype.multiplyByFloats=function(t,n,i){return new e(this.x*t,this.y*n,this.z*i)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this.x/e.x,this.y/e.y,this.z/e.z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,n){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),n<this.z&&(this.z=n),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,n){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),n>this.z&&(this.z=n),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this.x),n=Math.abs(this.y);if(!o.a.WithinEpsilon(t,n,e))return!0;var i=Math.abs(this.z);return!o.a.WithinEpsilon(t,i,e)||!o.a.WithinEpsilon(n,i,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var n=Math.abs(this.z);return e!==n||t!==n},enumerable:!0,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())?this:(w.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(n,i){t[n]=w.Vector3[0][e[i]]}),this)},e.prototype.rotateByQuaternionToRef=function(t,n){return t.toRotationMatrix(w.Matrix[0]),e.TransformCoordinatesToRef(this,w.Matrix[0],n),n},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,n){return this.subtractToRef(t,w.Vector3[0]),w.Vector3[0].rotateByQuaternionToRef(e,w.Vector3[0]),t.addToRef(w.Vector3[0],n),n},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e.x,e.y,e.z)},e.prototype.copyFromFloats=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},e.prototype.set=function(e,t,n){return this.copyFromFloats(e,t,n)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,n,i,r){var o=e.Dot(t,i)-r;return o/(o-(e.Dot(n,i)-r))},e.GetAngleBetweenVectors=function(t,n,i){var r=t.normalizeToRef(w.Vector3[1]),o=n.normalizeToRef(w.Vector3[2]),a=e.Dot(r,o),s=w.Vector3[3];return e.CrossToRef(r,o,s),e.Dot(s,i)>0?Math.acos(a):-Math.acos(a)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2])},e.FromFloatArray=function(t,n){return e.FromArray(t,n)},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1],n.z=e[t+2]},e.FromFloatArrayToRef=function(t,n,i){return e.FromArrayToRef(t,n,i)},e.FromFloatsToRef=function(e,t,n,i){i.copyFromFloats(e,t,n)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!0,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(){return new e(0,0,1)},e.Backward=function(){return new e(0,0,-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,n){var i=e.Zero();return e.TransformCoordinatesToRef(t,n,i),i},e.TransformCoordinatesToRef=function(t,n,i){e.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,n,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,n,i,r){var o=i.m,a=e*o[1]+t*o[5]+n*o[9]+o[13],s=e*o[2]+t*o[6]+n*o[10]+o[14],l=1/(e*o[3]+t*o[7]+n*o[11]+o[15]);r.x=(e*o[0]+t*o[4]+n*o[8]+o[12])*l,r.y=a*l,r.z=s*l},e.TransformNormal=function(t,n){var i=e.Zero();return e.TransformNormalToRef(t,n,i),i},e.TransformNormalToRef=function(e,t,n){this.TransformNormalFromFloatsToRef(e.x,e.y,e.z,t,n)},e.TransformNormalFromFloatsToRef=function(e,t,n,i,r){var o=i.m;r.x=e*o[0]+t*o[4]+n*o[8],r.y=e*o[1]+t*o[5]+n*o[9],r.z=e*o[2]+t*o[6]+n*o[10]},e.CatmullRom=function(t,n,i,r,o){var a=o*o,s=o*a;return new e(.5*(2*n.x+(-t.x+i.x)*o+(2*t.x-5*n.x+4*i.x-r.x)*a+(3*n.x-t.x-3*i.x+r.x)*s),.5*(2*n.y+(-t.y+i.y)*o+(2*t.y-5*n.y+4*i.y-r.y)*a+(3*n.y-t.y-3*i.y+r.y)*s),.5*(2*n.z+(-t.z+i.z)*o+(2*t.z-5*n.z+4*i.z-r.z)*a+(3*n.z-t.z-3*i.z+r.z)*s))},e.Clamp=function(t,n,i){var r=new e;return e.ClampToRef(t,n,i,r),r},e.ClampToRef=function(e,t,n,i){var r=e.x;r=(r=r>n.x?n.x:r)<t.x?t.x:r;var o=e.y;o=(o=o>n.y?n.y:o)<t.y?t.y:o;var a=e.z;a=(a=a>n.z?n.z:a)<t.z?t.z:a,i.copyFromFloats(r,o,a)},e.Hermite=function(t,n,i,r,o){var a=o*o,s=o*a,l=2*s-3*a+1,c=-2*s+3*a,u=s-2*a+o,h=s-a;return new e(t.x*l+i.x*c+n.x*u+r.x*h,t.y*l+i.y*c+n.y*u+r.y*h,t.z*l+i.z*c+n.z*u+r.z*h)},e.Lerp=function(t,n,i){var r=new e(0,0,0);return e.LerpToRef(t,n,i,r),r},e.LerpToRef=function(e,t,n,i){i.x=e.x+(t.x-e.x)*n,i.y=e.y+(t.y-e.y)*n,i.z=e.z+(t.z-e.z)*n},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.Cross=function(t,n){var i=e.Zero();return e.CrossToRef(t,n,i),i},e.CrossToRef=function(e,t,n){n.copyFromFloats(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},e.Normalize=function(t){var n=e.Zero();return e.NormalizeToRef(t,n),n},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,n,i,r){var o=r.width,a=r.height,s=w.Matrix[1];m.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,r.x+o/2,a/2+r.y,.5,1,s);var l=w.Matrix[0];return n.multiplyToRef(i,l),l.multiplyToRef(s,l),e.TransformCoordinates(t,l)},e._UnprojectFromInvertedMatrixToRef=function(t,n,i){e.TransformCoordinatesToRef(t,n,i);var r=n.m,a=t.x*r[3]+t.y*r[7]+t.z*r[11]+r[15];o.a.WithinEpsilon(a,1)&&i.scaleInPlace(1/a)},e.UnprojectFromTransform=function(t,n,i,r,o){var a=w.Matrix[0];r.multiplyToRef(o,a),a.invert(),t.x=t.x/n*2-1,t.y=-(t.y/i*2-1);var s=new e;return e._UnprojectFromInvertedMatrixToRef(t,a,s),s},e.Unproject=function(t,n,i,r,o,a){var s=e.Zero();return e.UnprojectToRef(t,n,i,r,o,a,s),s},e.UnprojectToRef=function(t,n,i,r,o,a,s){e.UnprojectFloatsToRef(t.x,t.y,t.z,n,i,r,o,a,s)},e.UnprojectFloatsToRef=function(t,n,i,r,o,a,s,l,c){var u=w.Matrix[0];a.multiplyToRef(s,u),u.multiplyToRef(l,u),u.invert();var h=w.Vector3[0];h.x=t/r*2-1,h.y=-(n/o*2-1),h.z=2*i-1,e._UnprojectFromInvertedMatrixToRef(h,u,c)},e.Minimize=function(e,t){var n=e.clone();return n.minimizeInPlace(t),n},e.Maximize=function(e,t){var n=e.clone();return n.maximizeInPlace(t),n},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.RotationFromAxis=function(t,n,i){var r=e.Zero();return e.RotationFromAxisToRef(t,n,i,r),r},e.RotationFromAxisToRef=function(e,t,n,i){var r=w.Quaternion[0];g.RotationQuaternionFromAxisToRef(e,t,n,r),r.toEulerAnglesToRef(i)},e._UpReadOnly=e.Up(),e}(),f=function(){function e(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var e=this.x||0;return 397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,n,i,r){return new e(this.x-t,this.y-n,this.z-i,this.w-r)},e.prototype.subtractFromFloatsToRef=function(e,t,n,i,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-n,r.w=this.w-i,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)&&o.a.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,n,i,r){return new e(this.x*t,this.y*n,this.z*i,this.w*r)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new d(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},e.prototype.set=function(e,t,n,i){return this.copyFromFloats(e,t,n,i)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,n){return n||(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3]},e.FromFloatArrayToRef=function(t,n,i){e.FromArrayToRef(t,n,i)},e.FromFloatsToRef=function(e,t,n,i,r){r.x=e,r.y=t,r.z=n,r.w=i},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var n=e.Zero();return e.NormalizeToRef(t,n),n},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){var n=e.clone();return n.minimizeInPlace(t),n},e.Maximize=function(e,t){var n=e.clone();return n.maximizeInPlace(t),n},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,o=e.w-t.w;return n*n+i*i+r*r+o*o},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.TransformNormal=function(t,n){var i=e.Zero();return e.TransformNormalToRef(t,n,i),i},e.TransformNormalToRef=function(e,t,n){var i=t.m,r=e.x*i[1]+e.y*i[5]+e.z*i[9],o=e.x*i[2]+e.y*i[6]+e.z*i[10];n.x=e.x*i[0]+e.y*i[4]+e.z*i[8],n.y=r,n.z=o,n.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,n,i,r,o){var a=r.m;o.x=e*a[0]+t*a[4]+n*a[8],o.y=e*a[1]+t*a[5]+n*a[9],o.z=e*a[2]+t*a[6]+n*a[10],o.w=i},e.FromVector3=function(t,n){return void 0===n&&(n=0),new e(t.x,t.y,t.z,n)},e}(),p=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,n){return new e(this.width*t,this.height*n)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&this.width===e.width&&this.height===e.height},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,n,i){return new e(t.width+(n.width-t.width)*i,t.height+(n.height-t.height)*i)},e}(),g=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=this.x||0;return 397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},e.prototype.set=function(e,t,n,i){return this.copyFromFloats(e,t,n,i)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.multiply=function(t){var n=new e(0,0,0,1);return this.multiplyToRef(t,n),n},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=d.Zero();return this.toEulerAnglesToRef(t),t},e.prototype.toEulerAnglesToRef=function(e){var t=this.z,n=this.x,i=this.y,r=this.w,o=r*r,a=t*t,s=n*n,l=i*i,c=i*t-n*r;return c<-.4999999?(e.y=2*Math.atan2(i,r),e.x=Math.PI/2,e.z=0):c>.4999999?(e.y=2*Math.atan2(i,r),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(n*i+t*r),-a-s+l+o),e.x=Math.asin(-2*(t*i-n*r)),e.y=Math.atan2(2*(t*n+i*r),a-s-l+o)),this},e.prototype.toRotationMatrix=function(e){return m.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var n=new e;return e.FromRotationMatrixToRef(t,n),n},e.FromRotationMatrixToRef=function(e,t){var n,i=e.m,r=i[0],o=i[4],a=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10],f=r+l+d;f>0?(n=.5/Math.sqrt(f+1),t.w=.25/n,t.x=(h-c)*n,t.y=(a-u)*n,t.z=(s-o)*n):r>l&&r>d?(n=2*Math.sqrt(1+r-l-d),t.w=(h-c)/n,t.x=.25*n,t.y=(o+s)/n,t.z=(a+u)/n):l>d?(n=2*Math.sqrt(1+l-r-d),t.w=(a-u)/n,t.x=(o+s)/n,t.y=.25*n,t.z=(c+h)/n):(n=2*Math.sqrt(1+d-r-l),t.w=(s-o)/n,t.x=(a+u)/n,t.y=(c+h)/n,t.z=.25*n)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.AreClose=function(t,n){return e.Dot(t,n)>=0},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.InverseToRef=function(e,t){return t.set(-e.x,-e.y,-e.z,e.w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},e.RotationAxis=function(t,n){return e.RotationAxisToRef(t,n,new e)},e.RotationAxisToRef=function(e,t,n){var i=Math.sin(t/2);return e.normalize(),n.w=Math.cos(t/2),n.x=e.x*i,n.y=e.y*i,n.z=e.z*i,n},e.FromArray=function(t,n){return n||(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromEulerAngles=function(t,n,i){var r=new e;return e.RotationYawPitchRollToRef(n,t,i,r),r},e.FromEulerAnglesToRef=function(t,n,i,r){return e.RotationYawPitchRollToRef(n,t,i,r),r},e.FromEulerVector=function(t){var n=new e;return e.RotationYawPitchRollToRef(t.y,t.x,t.z,n),n},e.FromEulerVectorToRef=function(t,n){return e.RotationYawPitchRollToRef(t.y,t.x,t.z,n),n},e.RotationYawPitchRoll=function(t,n,i){var r=new e;return e.RotationYawPitchRollToRef(t,n,i,r),r},e.RotationYawPitchRollToRef=function(e,t,n,i){var r=.5*n,o=.5*t,a=.5*e,s=Math.sin(r),l=Math.cos(r),c=Math.sin(o),u=Math.cos(o),h=Math.sin(a),d=Math.cos(a);i.x=d*c*l+h*u*s,i.y=h*u*l-d*c*s,i.z=d*u*s-h*c*l,i.w=d*u*l+h*c*s},e.RotationAlphaBetaGamma=function(t,n,i){var r=new e;return e.RotationAlphaBetaGammaToRef(t,n,i,r),r},e.RotationAlphaBetaGammaToRef=function(e,t,n,i){var r=.5*(n+e),o=.5*(n-e),a=.5*t;i.x=Math.cos(o)*Math.sin(a),i.y=Math.sin(o)*Math.sin(a),i.z=Math.sin(r)*Math.cos(a),i.w=Math.cos(r)*Math.cos(a)},e.RotationQuaternionFromAxis=function(t,n,i){var r=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,n,i,r),r},e.RotationQuaternionFromAxisToRef=function(t,n,i,r){var o=w.Matrix[0];m.FromXYZAxesToRef(t.normalize(),n.normalize(),i.normalize(),o),e.FromRotationMatrixToRef(o,r)},e.Slerp=function(t,n,i){var r=e.Identity();return e.SlerpToRef(t,n,i,r),r},e.SlerpToRef=function(e,t,n,i){var r,o,a=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,s=!1;if(a<0&&(s=!0,a=-a),a>.999999)o=1-n,r=s?-n:n;else{var l=Math.acos(a),c=1/Math.sin(l);o=Math.sin((1-n)*l)*c,r=s?-Math.sin(n*l)*c:Math.sin(n*l)*c}i.x=o*e.x+r*t.x,i.y=o*e.y+r*t.y,i.z=o*e.z+r*t.z,i.w=o*e.w+r*t.w},e.Hermite=function(t,n,i,r,o){var a=o*o,s=o*a,l=2*s-3*a+1,c=-2*s+3*a,u=s-2*a+o,h=s-a;return new e(t.x*l+i.x*c+n.x*u+r.x*h,t.y*l+i.y*c+n.y*u+r.y*h,t.z*l+i.z*c+n.z*u+r.z*h,t.w*l+i.w*c+n.w*u+r.w*h)},e}(),m=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=!0),this.updateFlag=e._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||i,this._isIdentityDirty=!this._isIdentity&&n,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._isIdentity3x2=1===this._m[0]&&1===this._m[5]&&1===this._m[15]&&0===this._m[1]&&0===this._m[2]&&0===this._m[3]&&0===this._m[4]&&0===this._m[6]&&0===this._m[7]&&0===this._m[8]&&0===this._m[9]&&0===this._m[10]&&0===this._m[11]&&0===this._m[12]&&0===this._m[13]&&0===this._m[14]),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[4],n=e[5],i=e[6],r=e[7],o=e[8],a=e[9],s=e[10],l=e[11],c=e[12],u=e[13],h=e[14],d=e[15],f=s*d-h*l,p=a*d-u*l,g=a*h-u*s,m=o*d-c*l,_=o*h-s*c,v=o*u-c*a;return e[0]*+(n*f-i*p+r*g)+e[1]*-(t*f-i*m+r*_)+e[2]*+(t*p-n*m+r*v)+e[3]*-(t*g-n*_+i*v)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var n=new e;return this.addToRef(t,n),n},e.prototype.addToRef=function(e,t){for(var n=this._m,i=t._m,r=e.m,o=0;o<16;o++)i[o]=n[o]+r[o];return t._markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,n=e.m,i=0;i<16;i++)t[i]+=n[i];return this._markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var n=this._m,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],f=n[10],p=n[11],g=n[12],m=n[13],_=n[14],v=n[15],b=f*v-_*p,y=d*v-m*p,T=d*_-m*f,E=h*v-g*p,x=h*_-f*g,C=h*m-g*d,S=+(l*b-c*y+u*T),A=-(s*b-c*E+u*x),P=+(s*y-l*E+u*C),R=-(s*T-l*x+c*C),M=i*S+r*A+o*P+a*R;if(0===M)return t.copyFrom(this),this;var O=1/M,w=c*v-_*u,I=l*v-m*u,D=l*_-m*c,L=s*v-g*u,k=s*_-g*c,N=s*m-g*l,F=c*p-f*u,B=l*p-d*u,U=l*f-d*c,V=s*p-h*u,G=s*f-h*c,z=s*d-h*l;return e.FromValuesToRef(S*O,-(r*b-o*y+a*T)*O,+(r*w-o*I+a*D)*O,-(r*F-o*B+a*U)*O,A*O,+(i*b-o*E+a*x)*O,-(i*w-o*L+a*k)*O,+(i*F-o*V+a*G)*O,P*O,-(i*y-r*E+a*C)*O,+(i*I-r*L+a*N)*O,-(i*B-r*V+a*z)*O,R*O,+(i*T-r*x+o*C)*O,-(i*D-r*k+o*N)*O,+(i*U-r*G+o*z)*O,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,n){return this._m[12]=e,this._m[13]=t,this._m[14]=n,this._markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,n){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=n,this._markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e.x,e.y,e.z)},e.prototype.getTranslation=function(){return new d(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var n=new e;return this.multiplyToRef(t,n),n},e.prototype.copyFrom=function(e){return e.copyToArray(this._m),this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)e[t+n]=this._m[n];return this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated(),this)},e.prototype.multiplyToArray=function(e,t,n){var i=this._m,r=e.m,o=i[0],a=i[1],s=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],f=i[8],p=i[9],g=i[10],m=i[11],_=i[12],v=i[13],b=i[14],y=i[15],T=r[0],E=r[1],x=r[2],C=r[3],S=r[4],A=r[5],P=r[6],R=r[7],M=r[8],O=r[9],w=r[10],I=r[11],D=r[12],L=r[13],k=r[14],N=r[15];return t[n]=o*T+a*S+s*M+l*D,t[n+1]=o*E+a*A+s*O+l*L,t[n+2]=o*x+a*P+s*w+l*k,t[n+3]=o*C+a*R+s*I+l*N,t[n+4]=c*T+u*S+h*M+d*D,t[n+5]=c*E+u*A+h*O+d*L,t[n+6]=c*x+u*P+h*w+d*k,t[n+7]=c*C+u*R+h*I+d*N,t[n+8]=f*T+p*S+g*M+m*D,t[n+9]=f*E+p*A+g*O+m*L,t[n+10]=f*x+p*P+g*w+m*k,t[n+11]=f*C+p*R+g*I+m*N,t[n+12]=_*T+v*S+b*M+y*D,t[n+13]=_*E+v*A+b*O+y*L,t[n+14]=_*x+v*P+b*w+y*k,t[n+15]=_*C+v*R+b*I+y*N,this},e.prototype.equals=function(e){if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var t=this.m,n=e.m;return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=this._m[0]||0,t=1;t<16;t++)e=397*e^(this._m[t]||0);return e},e.prototype.decompose=function(t,n,i){if(this._isIdentity)return i&&i.setAll(0),t&&t.setAll(1),n&&n.copyFromFloats(0,0,0,1),!0;var r=this._m;if(i&&i.copyFromFloats(r[12],r[13],r[14]),(t=t||w.Vector3[0]).x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),t.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),t.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),this.determinant()<=0&&(t.y*=-1),0===t.x||0===t.y||0===t.z)return n&&n.copyFromFloats(0,0,0,1),!1;if(n){var o=1/t.x,a=1/t.y,s=1/t.z;e.FromValuesToRef(r[0]*o,r[1]*o,r[2]*o,0,r[4]*a,r[5]*a,r[6]*a,0,r[8]*s,r[9]*s,r[10]*s,0,0,0,0,1,w.Matrix[0]),g.FromRotationMatrixToRef(w.Matrix[0],n)}return!0},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new f(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,n,i,r){if(e<0||e>3)return this;var o=4*e;return this._m[o+0]=t,this._m[o+1]=n,this._m[o+2]=i,this._m[o+3]=r,this._markAsUpdated(),this},e.prototype.scale=function(t){var n=new e;return this.scaleToRef(t,n),n},e.prototype.scaleToRef=function(e,t){for(var n=0;n<16;n++)t._m[n]=this._m[n]*e;return t._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var n=0;n<16;n++)t._m[n]+=this._m[n]*e;return t._markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var n=w.Matrix[0];this.invertToRef(n),n.transposeToRef(t);var i=t._m;e.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var n=w.Vector3[0];if(!this.decompose(n))return e.IdentityToRef(t),this;var i=this._m,r=1/n.x,o=1/n.y,a=1/n.z;return e.FromValuesToRef(i[0]*r,i[1]*r,i[2]*r,0,i[4]*o,i[5]*o,i[6]*o,0,i[8]*a,i[9]*a,i[10]*a,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},e.FromArray=function(t,n){void 0===n&&(n=0);var i=new e;return e.FromArrayToRef(t,n,i),i},e.FromArrayToRef=function(e,t,n){for(var i=0;i<16;i++)n._m[i]=e[i+t];n._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,n,i){for(var r=0;r<16;r++)i._m[r]=e[r+t]*n;i._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!0,configurable:!0}),e.FromValuesToRef=function(e,t,n,i,r,o,a,s,l,c,u,h,d,f,p,g,m){var _=m._m;_[0]=e,_[1]=t,_[2]=n,_[3]=i,_[4]=r,_[5]=o,_[6]=a,_[7]=s,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=d,_[13]=f,_[14]=p,_[15]=g,m._markAsUpdated()},e.FromValues=function(t,n,i,r,o,a,s,l,c,u,h,d,f,p,g,m){var _=new e,v=_._m;return v[0]=t,v[1]=n,v[2]=i,v[3]=r,v[4]=o,v[5]=a,v[6]=s,v[7]=l,v[8]=c,v[9]=u,v[10]=h,v[11]=d,v[12]=f,v[13]=p,v[14]=g,v[15]=m,_._markAsUpdated(),_},e.Compose=function(t,n,i){var r=new e;return e.ComposeToRef(t,n,i,r),r},e.ComposeToRef=function(e,t,n,i){var r=i._m,o=t.x,a=t.y,s=t.z,l=t.w,c=o+o,u=a+a,h=s+s,d=o*c,f=o*u,p=o*h,g=a*u,m=a*h,_=s*h,v=l*c,b=l*u,y=l*h,T=e.x,E=e.y,x=e.z;r[0]=(1-(g+_))*T,r[1]=(f+y)*T,r[2]=(p-b)*T,r[3]=0,r[4]=(f-y)*E,r[5]=(1-(d+_))*E,r[6]=(m+v)*E,r[7]=0,r[8]=(p+b)*x,r[9]=(m-v)*x,r[10]=(1-(d+g))*x,r[11]=0,r[12]=n.x,r[13]=n.y,r[14]=n.z,r[15]=1,i._markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var n=new e;return e.RotationXToRef(t,n),n},e.Invert=function(t){var n=new e;return t.invertToRef(n),n},e.RotationXToRef=function(t,n){var i=Math.sin(t),r=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,r,i,0,0,-i,r,0,0,0,0,1,n),n._updateIdentityStatus(1===r&&0===i)},e.RotationY=function(t){var n=new e;return e.RotationYToRef(t,n),n},e.RotationYToRef=function(t,n){var i=Math.sin(t),r=Math.cos(t);e.FromValuesToRef(r,0,-i,0,0,1,0,0,i,0,r,0,0,0,0,1,n),n._updateIdentityStatus(1===r&&0===i)},e.RotationZ=function(t){var n=new e;return e.RotationZToRef(t,n),n},e.RotationZToRef=function(t,n){var i=Math.sin(t),r=Math.cos(t);e.FromValuesToRef(r,i,0,0,-i,r,0,0,0,0,1,0,0,0,0,1,n),n._updateIdentityStatus(1===r&&0===i)},e.RotationAxis=function(t,n){var i=new e;return e.RotationAxisToRef(t,n,i),i},e.RotationAxisToRef=function(e,t,n){var i=Math.sin(-t),r=Math.cos(-t),o=1-r;e.normalize();var a=n._m;a[0]=e.x*e.x*o+r,a[1]=e.x*e.y*o-e.z*i,a[2]=e.x*e.z*o+e.y*i,a[3]=0,a[4]=e.y*e.x*o+e.z*i,a[5]=e.y*e.y*o+r,a[6]=e.y*e.z*o-e.x*i,a[7]=0,a[8]=e.z*e.x*o-e.y*i,a[9]=e.z*e.y*o+e.x*i,a[10]=e.z*e.z*o+r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n._markAsUpdated()},e.RotationAlignToRef=function(e,t,n){var i=d.Cross(t,e),r=d.Dot(t,e),o=1/(1+r),a=n._m;a[0]=i.x*i.x*o+r,a[1]=i.y*i.x*o-i.z,a[2]=i.z*i.x*o+i.y,a[3]=0,a[4]=i.x*i.y*o+i.z,a[5]=i.y*i.y*o+r,a[6]=i.z*i.y*o-i.x,a[7]=0,a[8]=i.x*i.z*o-i.y,a[9]=i.y*i.z*o+i.x,a[10]=i.z*i.z*o+r,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n._markAsUpdated()},e.RotationYawPitchRoll=function(t,n,i){var r=new e;return e.RotationYawPitchRollToRef(t,n,i,r),r},e.RotationYawPitchRollToRef=function(e,t,n,i){g.RotationYawPitchRollToRef(e,t,n,w.Quaternion[0]),w.Quaternion[0].toRotationMatrix(i)},e.Scaling=function(t,n,i){var r=new e;return e.ScalingToRef(t,n,i,r),r},e.ScalingToRef=function(t,n,i,r){e.FromValuesToRef(t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1,r),r._updateIdentityStatus(1===t&&1===n&&1===i)},e.Translation=function(t,n,i){var r=new e;return e.TranslationToRef(t,n,i,r),r},e.TranslationToRef=function(t,n,i,r){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,n,i,1,r),r._updateIdentityStatus(0===t&&0===n&&0===i)},e.Lerp=function(t,n,i){var r=new e;return e.LerpToRef(t,n,i,r),r},e.LerpToRef=function(e,t,n,i){for(var r=i._m,o=e.m,a=t.m,s=0;s<16;s++)r[s]=o[s]*(1-n)+a[s]*n;i._markAsUpdated()},e.DecomposeLerp=function(t,n,i){var r=new e;return e.DecomposeLerpToRef(t,n,i,r),r},e.DecomposeLerpToRef=function(t,n,i,r){var o=w.Vector3[0],a=w.Quaternion[0],s=w.Vector3[1];t.decompose(o,a,s);var l=w.Vector3[2],c=w.Quaternion[1],u=w.Vector3[3];n.decompose(l,c,u);var h=w.Vector3[4];d.LerpToRef(o,l,i,h);var f=w.Quaternion[2];g.SlerpToRef(a,c,i,f);var p=w.Vector3[5];d.LerpToRef(s,u,i,p),e.ComposeToRef(h,f,p,r)},e.LookAtLH=function(t,n,i){var r=new e;return e.LookAtLHToRef(t,n,i,r),r},e.LookAtLHToRef=function(t,n,i,r){var o=w.Vector3[0],a=w.Vector3[1],s=w.Vector3[2];n.subtractToRef(t,s),s.normalize(),d.CrossToRef(i,s,o);var l=o.lengthSquared();0===l?o.x=1:o.normalizeFromLength(Math.sqrt(l)),d.CrossToRef(s,o,a),a.normalize();var c=-d.Dot(o,t),u=-d.Dot(a,t),h=-d.Dot(s,t);e.FromValuesToRef(o.x,a.x,s.x,0,o.y,a.y,s.y,0,o.z,a.z,s.z,0,c,u,h,1,r)},e.LookAtRH=function(t,n,i){var r=new e;return e.LookAtRHToRef(t,n,i,r),r},e.LookAtRHToRef=function(t,n,i,r){var o=w.Vector3[0],a=w.Vector3[1],s=w.Vector3[2];t.subtractToRef(n,s),s.normalize(),d.CrossToRef(i,s,o);var l=o.lengthSquared();0===l?o.x=1:o.normalizeFromLength(Math.sqrt(l)),d.CrossToRef(s,o,a),a.normalize();var c=-d.Dot(o,t),u=-d.Dot(a,t),h=-d.Dot(s,t);e.FromValuesToRef(o.x,a.x,s.x,0,o.y,a.y,s.y,0,o.z,a.z,s.z,0,c,u,h,1,r)},e.OrthoLH=function(t,n,i,r){var o=new e;return e.OrthoLHToRef(t,n,i,r,o),o},e.OrthoLHToRef=function(t,n,i,r,o){var a=2/t,s=2/n,l=2/(r-i),c=-(r+i)/(r-i);e.FromValuesToRef(a,0,0,0,0,s,0,0,0,0,l,0,0,0,c,1,o),o._updateIdentityStatus(1===a&&1===s&&1===l&&0===c)},e.OrthoOffCenterLH=function(t,n,i,r,o,a){var s=new e;return e.OrthoOffCenterLHToRef(t,n,i,r,o,a,s),s},e.OrthoOffCenterLHToRef=function(t,n,i,r,o,a,s){e.FromValuesToRef(2/(n-t),0,0,0,0,2/(r-i),0,0,0,0,2/(a-o),0,(t+n)/(t-n),(r+i)/(i-r),-(a+o)/(a-o),1,s),s._markAsUpdated()},e.OrthoOffCenterRH=function(t,n,i,r,o,a){var s=new e;return e.OrthoOffCenterRHToRef(t,n,i,r,o,a,s),s},e.OrthoOffCenterRHToRef=function(t,n,i,r,o,a,s){e.OrthoOffCenterLHToRef(t,n,i,r,o,a,s),s._m[10]*=-1},e.PerspectiveLH=function(t,n,i,r){var o=new e;return e.FromValuesToRef(2*i/t,0,0,0,0,2*i/n,0,0,0,0,(r+i)/(r-i),1,0,0,-2*r*i/(r-i),0,o),o._updateIdentityStatus(!1),o},e.PerspectiveFovLH=function(t,n,i,r){var o=new e;return e.PerspectiveFovLHToRef(t,n,i,r,o),o},e.PerspectiveFovLHToRef=function(t,n,i,r,o,a){void 0===a&&(a=!0);var s=i,l=r,c=1/Math.tan(.5*t);e.FromValuesToRef(a?c/n:c,0,0,0,0,a?c:c*n,0,0,0,0,(l+s)/(l-s),1,0,0,-2*l*s/(l-s),0,o),o._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,n,i,r){var o=new e;return e.PerspectiveFovRHToRef(t,n,i,r,o),o},e.PerspectiveFovRHToRef=function(t,n,i,r,o,a){void 0===a&&(a=!0);var s=i,l=r,c=1/Math.tan(.5*t);e.FromValuesToRef(a?c/n:c,0,0,0,0,a?c:c*n,0,0,0,0,-(l+s)/(l-s),-1,0,0,-2*l*s/(l-s),0,o),o._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,n,i,r){void 0===r&&(r=!1);var o=r?-1:1,a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),u=2/(l+c),h=2/(a+s),d=i._m;d[0]=u,d[1]=d[2]=d[3]=d[4]=0,d[5]=h,d[6]=d[7]=0,d[8]=(l-c)*u*.5,d[9]=-(a-s)*h*.5,d[10]=-n/(t-n),d[11]=1*o,d[12]=d[13]=d[15]=0,d[14]=-2*n*t/(n-t),i._markAsUpdated()},e.GetFinalMatrix=function(t,n,i,r,o,a){var s=t.width,l=t.height,c=e.FromValues(s/2,0,0,0,0,-l/2,0,0,0,0,a-o,0,t.x+s/2,l/2+t.y,o,1),u=w.Matrix[0];return n.multiplyToRef(i,u),u.multiplyToRef(r,u),u.multiply(c)},e.GetAsMatrix2x2=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[4],t[5]])},e.GetAsMatrix3x3=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]])},e.Transpose=function(t){var n=new e;return e.TransposeToRef(t,n),n},e.TransposeToRef=function(e,t){var n=t._m,i=e.m;n[0]=i[0],n[1]=i[4],n[2]=i[8],n[3]=i[12],n[4]=i[1],n[5]=i[5],n[6]=i[9],n[7]=i[13],n[8]=i[2],n[9]=i[6],n[10]=i[10],n[11]=i[14],n[12]=i[3],n[13]=i[7],n[14]=i[11],n[15]=i[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var n=new e;return e.ReflectionToRef(t,n),n},e.ReflectionToRef=function(t,n){t.normalize();var i=t.normal.x,r=t.normal.y,o=t.normal.z,a=-2*i,s=-2*r,l=-2*o;e.FromValuesToRef(a*i+1,s*i,l*i,0,a*r,s*r+1,l*r,0,a*o,s*o,l*o+1,0,a*t.d,s*t.d,l*t.d,1,n)},e.FromXYZAxesToRef=function(t,n,i,r){e.FromValuesToRef(t.x,t.y,t.z,0,n.x,n.y,n.z,0,i.x,i.y,i.z,0,0,0,0,1,r)},e.FromQuaternionToRef=function(e,t){var n=e.x*e.x,i=e.y*e.y,r=e.z*e.z,o=e.x*e.y,a=e.z*e.w,s=e.z*e.x,l=e.y*e.w,c=e.y*e.z,u=e.x*e.w;t._m[0]=1-2*(i+r),t._m[1]=2*(o+a),t._m[2]=2*(s-l),t._m[3]=0,t._m[4]=2*(o-a),t._m[5]=1-2*(r+n),t._m[6]=2*(c+u),t._m[7]=0,t._m[8]=2*(s+l),t._m[9]=2*(c-u),t._m[10]=1-2*(i+n),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}(),_=function(){function e(e,t,n,i){this.normal=new d(e,t,n),this.d=i}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(this.d||0)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var n=w.Matrix[0];m.TransposeToRef(t,n);var i=n.m,r=this.normal.x,o=this.normal.y,a=this.normal.z,s=this.d;return new e(r*i[0]+o*i[1]+a*i[2]+s*i[3],r*i[4]+o*i[5]+a*i[6]+s*i[7],r*i[8]+o*i[9]+a*i[10]+s*i[11],r*i[12]+o*i[13]+a*i[14]+s*i[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,n){var i,r=t.x-e.x,o=t.y-e.y,a=t.z-e.z,s=n.x-e.x,l=n.y-e.y,c=n.z-e.z,u=o*c-a*l,h=a*s-r*c,d=r*l-o*s,f=Math.sqrt(u*u+h*h+d*d);return this.normal.x=u*(i=0!==f?1/f:0),this.normal.y=h*i,this.normal.z=d*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return d.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return d.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,n,i){var r=new e(0,0,0,0);return r.copyFromPoints(t,n,i),r},e.FromPositionAndNormal=function(t,n){var i=new e(0,0,0,0);return n.normalize(),i.normal=n,i.d=-(n.x*t.x+n.y*t.y+n.z*t.z),i},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,n){var i=-(t.x*e.x+t.y*e.y+t.z*e.z);return d.Dot(n,t)+i},e}(),v=function(){function e(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}return e.prototype.toGlobal=function(t,n){return new e(this.x*t,this.y*n,this.width*t,this.height*n)},e.prototype.toGlobalToRef=function(e,t,n){return n.x=this.x*e,n.y=this.y*t,n.width=this.width*e,n.height=this.height*t,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}(),b=function(){function e(){}return e.GetPlanes=function(t){for(var n=[],i=0;i<6;i++)n.push(new _(0,0,0,0));return e.GetPlanesToRef(t,n),n},e.GetNearPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[2],t.normal.y=n[7]+n[6],t.normal.z=n[11]+n[10],t.d=n[15]+n[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[2],t.normal.y=n[7]-n[6],t.normal.z=n[11]-n[10],t.d=n[15]-n[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[0],t.normal.y=n[7]+n[4],t.normal.z=n[11]+n[8],t.d=n[15]+n[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[0],t.normal.y=n[7]-n[4],t.normal.z=n[11]-n[8],t.d=n[15]-n[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[1],t.normal.y=n[7]-n[5],t.normal.z=n[11]-n[9],t.d=n[15]-n[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[1],t.normal.y=n[7]+n[5],t.normal.z=n[11]+n[9],t.d=n[15]+n[13],t.normalize()},e.GetPlanesToRef=function(t,n){e.GetNearPlaneToRef(t,n[0]),e.GetFarPlaneToRef(t,n[1]),e.GetLeftPlaneToRef(t,n[2]),e.GetRightPlaneToRef(t,n[3]),e.GetTopPlaneToRef(t,n[4]),e.GetBottomPlaneToRef(t,n[5])},e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(i||(i={}));var y,T=function(){function e(){}return e.X=new d(1,0,0),e.Y=new d(0,1,0),e.Z=new d(0,0,1),e}(),E=function(){function e(){}return e.Interpolate=function(e,t,n,i,r){for(var o=1-3*i+3*t,a=3*i-6*t,s=3*t,l=e,c=0;c<5;c++){var u=l*l;l-=1/(3*o*u+2*a*l+s)*(o*(u*l)+a*u+s*l-e),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*n+3*(1-l)*Math.pow(l,2)*r+Math.pow(l,3)},e}();!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(y||(y={}));var x=function(){function e(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(t,n){var i=n.subtract(t);return new e(Math.atan2(i.y,i.x))},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}(),C=function(e,t,n){this.startPoint=e,this.midPoint=t,this.endPoint=n;var i=Math.pow(t.x,2)+Math.pow(t.y,2),r=(Math.pow(e.x,2)+Math.pow(e.y,2)-i)/2,o=(i-Math.pow(n.x,2)-Math.pow(n.y,2))/2,a=(e.x-t.x)*(t.y-n.y)-(t.x-n.x)*(e.y-t.y);this.centerPoint=new h((r*(t.y-n.y)-o*(e.y-t.y))/a,((e.x-t.x)*o-(t.x-n.x)*r)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var s=this.startAngle.degrees(),l=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-s>180&&(l-=360),l-s<-180&&(l+=360),c-l>180&&(c-=360),c-l<-180&&(c+=360),this.orientation=l-s<0?y.CW:y.CCW,this.angle=x.FromDegrees(this.orientation===y.CW?s-c:c-s)},S=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new h(e,t))}return e.prototype.addLineTo=function(e,t){if(this.closed)return this;var n=new h(e,t),i=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(i).length(),this},e.prototype.addArcTo=function(e,t,n,i,r){if(void 0===r&&(r=36),this.closed)return this;var o=this._points[this._points.length-1],a=new h(e,t),s=new h(n,i),l=new C(o,a,s),c=l.angle.radians()/r;l.orientation===y.CW&&(c*=-1);for(var u=l.startAngle.radians()+c,d=0;d<r;d++){var f=Math.cos(u)*l.radius+l.centerPoint.x,p=Math.sin(u)*l.radius+l.centerPoint.y;this.addLineTo(f,p),u+=c}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;return this.closed||(e+=this._points[0].subtract(this._points[this._points.length-1]).length()),e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(e<0||e>1)return h.Zero();for(var t=e*this.length(),n=0,i=0;i<this._points.length;i++){var r=this._points[i],o=this._points[(i+1)%this._points.length].subtract(r),a=o.length()+n;if(t>=n&&t<=a){var s=o.normalize(),l=t-n;return new h(r.x+s.x*l,r.y+s.y*l)}n=a}return h.Zero()},e.StartingAt=function(t,n){return new e(t,n)},e}(),A=function(){function e(e,t,n){void 0===t&&(t=null),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var i=0;i<e.length;i++)this._curve[i]=e[i].clone();this._raw=n||!1,this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){void 0===t&&(t=null);for(var n=0;n<e.length;n++)this._curve[n].x=e[n].x,this._curve[n].y=e[n].y,this._curve[n].z=e[n].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._raw||this._tangents[t-1].normalize();var n,i,r,o=this._tangents[0],a=this._normalVector(o,e);this._normals[0]=a,this._raw||this._normals[0].normalize(),this._binormals[0]=d.Cross(o,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var s=1;s<t;s++)n=this._getLastNonNullVector(s),s<t-1&&(i=this._getFirstNonNullVector(s),this._tangents[s]=n.add(i),this._tangents[s].normalize()),this._distances[s]=this._distances[s-1]+n.length(),this._normals[s]=d.Cross(this._binormals[s-1],r=this._tangents[s]),this._raw||this._normals[s].normalize(),this._binormals[s]=d.Cross(r,this._normals[s]),this._raw||this._binormals[s].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,n=this._curve[e+t].subtract(this._curve[e]);0===n.length()&&e+t+1<this._curve.length;)n=this._curve[e+ ++t].subtract(this._curve[e]);return n},e.prototype._getLastNonNullVector=function(e){for(var t=1,n=this._curve[e].subtract(this._curve[e-t]);0===n.length()&&e>t+1;)n=this._curve[e].subtract(this._curve[e-++t]);return n},e.prototype._normalVector=function(e,t){var n,i,r=e.length();return 0===r&&(r=1),null==t?(i=o.a.WithinEpsilon(Math.abs(e.y)/r,1,l)?o.a.WithinEpsilon(Math.abs(e.x)/r,1,l)?o.a.WithinEpsilon(Math.abs(e.z)/r,1,l)?d.Zero():new d(0,0,1):new d(1,0,0):new d(0,-1,0),n=d.Cross(e,i)):(n=d.Cross(e,t),d.CrossToRef(n,e,n)),n.normalize(),n},e}(),P=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,n,i,r){r=r>2?r:3;for(var o=new Array,a=function(e,t,n,i){return(1-e)*(1-e)*t+2*e*(1-e)*n+e*e*i},s=0;s<=r;s++)o.push(new d(a(s/r,t.x,n.x,i.x),a(s/r,t.y,n.y,i.y),a(s/r,t.z,n.z,i.z)));return new e(o)},e.CreateCubicBezier=function(t,n,i,r,o){o=o>3?o:4;for(var a=new Array,s=function(e,t,n,i,r){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*n+3*e*e*(1-e)*i+e*e*e*r},l=0;l<=o;l++)a.push(new d(s(l/o,t.x,n.x,i.x,r.x),s(l/o,t.y,n.y,i.y,r.y),s(l/o,t.z,n.z,i.z,r.z)));return new e(a)},e.CreateHermiteSpline=function(t,n,i,r,o){for(var a=new Array,s=1/o,l=0;l<=o;l++)a.push(d.Hermite(t,n,i,r,l*s));return new e(a)},e.CreateCatmullRomSpline=function(t,n,i){var r=new Array,o=1/n,a=0;if(i){for(var s=t.length,l=0;l<s;l++){a=0;for(var c=0;c<n;c++)r.push(d.CatmullRom(t[l%s],t[(l+1)%s],t[(l+2)%s],t[(l+3)%s],a)),a+=o}r.push(r[0])}else{var u=new Array;for(u.push(t[0].clone()),Array.prototype.push.apply(u,t),u.push(t[t.length-1].clone()),l=0;l<u.length-3;l++)for(a=0,c=0;c<n;c++)r.push(d.CatmullRom(u[l],u[l+1],u[l+2],u[l+3],a)),a+=o;r.push(d.CatmullRom(u[--l],u[l+1],u[l+2],u[l+3],a))}return new e(r)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var n=this._points[this._points.length-1],i=this._points.slice(),r=t.getPoints(),o=1;o<r.length;o++)i.push(r[o].subtract(r[0]).add(n));return new e(i)},e.prototype._computeLength=function(e){for(var t=0,n=1;n<e.length;n++)t+=e[n].subtract(e[n-1]).length();return t},e}(),R=function(){function e(e,t){void 0===e&&(e=d.Zero()),void 0===t&&(t=d.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}(),M=function(){function e(e,t,n){void 0===e&&(e=d.Zero()),void 0===t&&(t=d.Up()),void 0===n&&(n=h.Zero()),this.position=e,this.normal=t,this.uv=n}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}(),O=function(){function e(){}return e.Color3=r.a.BuildArray(3,c.Black),e.Color4=r.a.BuildArray(3,function(){return new u(0,0,0,0)}),e.Vector2=r.a.BuildArray(3,h.Zero),e.Vector3=r.a.BuildArray(13,d.Zero),e.Vector4=r.a.BuildArray(3,f.Zero),e.Quaternion=r.a.BuildArray(2,g.Zero),e.Matrix=r.a.BuildArray(8,m.Identity),e}(),w=function(){function e(){}return e.Vector3=r.a.BuildArray(6,d.Zero),e.Matrix=r.a.BuildArray(2,m.Identity),e.Quaternion=r.a.BuildArray(3,g.Zero),e}()},function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"e",function(){return l});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})}function l(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}},function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"m",function(){return f}),n.d(t,"e",function(){return p}),n.d(t,"h",function(){return g}),n.d(t,"n",function(){return m}),n.d(t,"o",function(){return _}),n.d(t,"k",function(){return v}),n.d(t,"g",function(){return b}),n.d(t,"f",function(){return y}),n.d(t,"i",function(){return T}),n.d(t,"l",function(){return E}),n.d(t,"j",function(){return x}),n.d(t,"d",function(){return C}),n.d(t,"a",function(){return S});var i=n(29),r=n(0),o=n(19),a={},s={},l=function(e,t,n){var r=e();i.a&&i.a.AddTagsTo(r,t.tags);var o=c(r);for(var a in o){var s=t[a];if(null!=s&&"uniqueId"!==a)switch(o[a].type){case 0:case 6:case 11:r[a]=s;break;case 1:r[a]=n||s.isRenderTarget?s:s.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[a]=n?s:s.clone()}}return r};function c(e){var t=e.getClassName();if(s[t])return s[t];s[t]={};for(var n=s[t],i=e,r=t;r;){var o=a[r];for(var l in o)n[l]=o[l];var c=void 0,u=!1;do{if(!(c=Object.getPrototypeOf(i)).getClassName){u=!0;break}if(c.getClassName()!==r)break;i=c}while(c);if(u)break;r=c.getClassName(),i=c}return n}function u(e,t){return function(n,i){var r=function(e){var t=n.getClassName();return a[t]||(a[t]={}),a[t]}();r[i]||(r[i]={type:e,sourceName:t})}}function h(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(n,i){var r=t||"_"+i;Object.defineProperty(n,i,{get:function(){return this[r]},set:function(t){this[r]!==t&&(this[r]=t,n[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function d(e){return u(0,e)}function f(e){return u(1,e)}function p(e){return u(2,e)}function g(e){return u(3,e)}function m(e){return u(4,e)}function _(e){return u(5,e)}function v(e){return u(6,e)}function b(e){return u(7,e)}function y(e){return u(8,e)}function T(e){return u(9,e)}function E(e){return u(10,e)}function x(e){return u(12,e)}function C(e){return u(11,e)}var S=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var n=0;n<e.animations.length;n++)t.animations.push(e.animations[n].serialize())}},e.Serialize=function(e,t){t||(t={}),i.a&&(t.tags=i.a.GetTags(e));var n=c(e);for(var r in n){var o=n[r],a=o.sourceName||r,s=e[r];if(null!=s)switch(o.type){case 0:t[a]=s;break;case 1:t[a]=s.serialize();break;case 2:t[a]=s.asArray();break;case 3:t[a]=s.serialize();break;case 4:case 5:t[a]=s.asArray();break;case 6:t[a]=s.id;break;case 7:t[a]=s.serialize();break;case 8:t[a]=s.asArray();break;case 9:t[a]=s.serialize();break;case 10:t[a]=s.asArray();break;case 11:t[a]=s.id;case 12:t[a]=s.asArray()}}return t},e.Parse=function(t,n,o,a){void 0===a&&(a=null);var s=t();a||(a=""),i.a&&i.a.AddTagsTo(s,n.tags);var l=c(s);for(var u in l){var h=l[u],d=n[h.sourceName||u];if(null!=d){var f=s;switch(h.type){case 0:f[u]=d;break;case 1:o&&(f[u]=e._TextureParser(d,o,a));break;case 2:f[u]=r.e.FromArray(d);break;case 3:f[u]=e._FresnelParametersParser(d);break;case 4:f[u]=r.w.FromArray(d);break;case 5:f[u]=r.x.FromArray(d);break;case 6:o&&(f[u]=o.getLastMeshByID(d));break;case 7:f[u]=e._ColorCurvesParser(d);break;case 8:f[u]=r.f.FromArray(d);break;case 9:f[u]=e._ImageProcessingConfigurationParser(d);break;case 10:f[u]=r.q.FromArray(d);break;case 11:o&&(f[u]=o.getCameraByID(d));case 12:f[u]=r.j.FromArray(d)}}}return s},e.Clone=function(e,t){return l(e,t,!1)},e.Instanciate=function(e,t){return l(e,t,!0)},e._ImageProcessingConfigurationParser=function(e){throw o.a.WarnImport("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw o.a.WarnImport("FresnelParameters")},e._ColorCurvesParser=function(e){throw o.a.WarnImport("ColorCurves")},e._TextureParser=function(e,t,n){throw o.a.WarnImport("Texture")},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_AllDirtyFlag=31,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r});var i=function(){function e(e,t,n,i,r,o,a){void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),this._engine=e.getScene?e.getScene().getEngine():e,this._updatable=n,this._instanced=o,this._data=t,this.byteStride=a?i:i*Float32Array.BYTES_PER_ELEMENT,r||this.create()}return e.prototype.createVertexBuffer=function(e,t,n,i,o,a){void 0===a&&(a=!1);var s=a?t:t*Float32Array.BYTES_PER_ELEMENT,l=i?a?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new r(this._engine,this,e,this._updatable,!0,l,void 0===o?this._instanced:o,s,n,void 0,void 0,!0)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,n,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=null)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),r=function(){function e(t,n,r,o,a,s,l,c,u,h,d,f){if(void 0===d&&(d=!1),void 0===f&&(f=!1),n instanceof i?(this._buffer=n,this._ownsBuffer=!1):(this._buffer=new i(t,n,o,s,a,l,f),this._ownsBuffer=!0),this._kind=r,null==h){var p=this.getData();this.type=e.FLOAT,p instanceof Int8Array?this.type=e.BYTE:p instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:p instanceof Int16Array?this.type=e.SHORT:p instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:p instanceof Int32Array?this.type=e.INT:p instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=h;var g=e.GetTypeByteLength(this.type);f?(this._size=u||(s?s/g:e.DeduceStride(r)),this.byteStride=s||this._buffer.byteStride||this._size*g,this.byteOffset=c||0):(this._size=u||s||e.DeduceStride(r),this.byteStride=s?s*g:this._buffer.byteStride||this._size*g,this.byteOffset=(c||0)*g),this.normalized=d,this._instanced=void 0!==l&&l,this._instanceDivisor=l?1:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,n){void 0===n&&(n=!1),this._buffer.updateDirectly(e,t,void 0,n)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,n){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,n)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,n,i,r,o,a,s,l){if(t instanceof Array)for(var c=n/4,u=i/4,h=0;h<a;h+=r){for(var d=0;d<r;d++)l(t[c+d],h+d);c+=u}else{var f=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),p=e.GetTypeByteLength(o);for(h=0;h<a;h+=r){var g=n;for(d=0;d<r;d++)l(e._GetFloatValue(f,o,g,s),h+d),g+=p;n+=i}}},e._GetFloatValue=function(t,n,i,r){switch(n){case e.BYTE:var o=t.getInt8(i);return r&&(o=Math.max(o/127,-1)),o;case e.UNSIGNED_BYTE:return o=t.getUint8(i),r&&(o/=255),o;case e.SHORT:return o=t.getInt16(i,!0),r&&(o=Math.max(o/16383,-1)),o;case e.UNSIGNED_SHORT:return o=t.getUint16(i,!0),r&&(o/=65535),o;case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type "+n)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}()},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return l}),n.d(t,"a",function(){return c});var i=n(8),r=n(3),o=n(35),a=n(6),s=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},e.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var n=this._mesh.getScene(),i=0;i<n.meshes.length;i++){var r=n.meshes[i];if(r.material&&r.computeBonesUsingShaders&&0!==r.numBoneInfluencers)if(r.material.getEffect()===t)r.computeBonesUsingShaders=!1;else if(r.subMeshes)for(var o=0,a=r.subMeshes;o<a.length;o++)if(a[o].effect===t){r.computeBonesUsingShaders=!1;break}}}else{var s=this._defines[this._currentRank];if(s)for(i=0;i<s.length;i++)e=e.replace("#define "+s[i],"");this._currentRank++}return e},e}(),l=function(){},c=function(){function e(t,n,r,o,a,s,l,c,u,h){var d,f,p=this;if(void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new i.c,this.onErrorObservable=new i.c,this._onBindObservable=null,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=t,n.attributes){var g=n;if(this._engine=r,this._attributesNames=g.attributes,this._uniformsNames=g.uniformsNames.concat(g.samplers),this._samplerList=g.samplers.slice(),this.defines=g.defines,this.onError=g.onError,this.onCompiled=g.onCompiled,this._fallbacks=g.fallbacks,this._indexParameters=g.indexParameters,this._transformFeedbackVaryings=g.transformFeedbackVaryings,g.uniformBuffersNames)for(var m=0;m<g.uniformBuffersNames.length;m++)this._uniformBuffersNames[g.uniformBuffersNames[m]]=m}else this._engine=a,this.defines=null==s?"":s,this._uniformsNames=r.concat(o),this._samplerList=o?o.slice():[],this._attributesNames=n,this.onError=u,this.onCompiled=c,this._indexParameters=h,this._fallbacks=l;this.uniqueId=e._uniqueIdSeed++,t.vertexElement?(d=document.getElementById(t.vertexElement))||(d=t.vertexElement):d=t.vertex||t,t.fragmentElement?(f=document.getElementById(t.fragmentElement))||(f=t.fragmentElement):f=t.fragment||t,this._loadVertexShader(d,function(e){p._processIncludes(e,function(e){p._processShaderConversion(e,!1,function(e){p._loadFragmentShader(f,function(n){p._processIncludes(n,function(n){p._processShaderConversion(n,!0,function(n){if(t){var i=t.fragmentElement||t.fragment||t;p._vertexSourceCode="#define SHADER_NAME vertex:"+(t.vertexElement||t.vertex||t)+"\n"+e,p._fragmentSourceCode="#define SHADER_NAME fragment:"+i+"\n"+n}else p._vertexSourceCode=e,p._fragmentSourceCode=n;p._prepareEffect()})})})})})})}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new i.c),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add(function(t){e(t)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){t._checkIsReady()},16))},e.prototype._checkIsReady=function(){var e=this;this.isReady()||setTimeout(function(){e._checkIsReady()},16)},e.prototype._loadVertexShader=function(t,n){var i;o.a.IsWindowObjectExist()&&t instanceof HTMLElement?n(o.a.GetDOMTextContent(t)):"base64:"!==t.substr(0,7)?e.ShadersStore[t+"VertexShader"]?n(e.ShadersStore[t+"VertexShader"]):(i="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(i+".vertex.fx",n)):n(window.atob(t.substr(7)))},e.prototype._loadFragmentShader=function(t,n){var i;o.a.IsWindowObjectExist()&&t instanceof HTMLElement?n(o.a.GetDOMTextContent(t)):"base64:"!==t.substr(0,7)?e.ShadersStore[t+"PixelShader"]?n(e.ShadersStore[t+"PixelShader"]):e.ShadersStore[t+"FragmentShader"]?n(e.ShadersStore[t+"FragmentShader"]):(i="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(i+".fragment.fx",n)):n(window.atob(t.substr(7)))},e.prototype._dumpShadersSource=function(e,t,n){var i=(this._engine.webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"")+(n?n+"\n":"");t=i+t;var r=2,o=/\n/gm,s="\n1\t"+(e=i+e).replace(o,function(){return"\n"+r+++"\t"});r=2;var l="\n1\t"+t.replace(o,function(){return"\n"+r+++"\t"});this.name.vertexElement?(a.a.Error("Vertex shader: "+this.name.vertexElement+s),a.a.Error("Fragment shader: "+this.name.fragmentElement+l)):this.name.vertex?(a.a.Error("Vertex shader: "+this.name.vertex+s),a.a.Error("Fragment shader: "+this.name.fragment+l)):(a.a.Error("Vertex shader: "+this.name+s),a.a.Error("Fragment shader: "+this.name+l))},e.prototype._processShaderConversion=function(e,t,n){var i=this._processPrecision(e);if(1!=this._engine.webGLVersion)if(-1===i.indexOf("#version 3")){var r=-1!==i.search(/#extension.+GL_EXT_draw_buffers.+require/),o=i.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");o=(o=(o=(o=o.replace(/varying(?![\n\r])\s/g,t?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in")).replace(/texture2D\s*\(/g,"texture("),t&&(o=(o=(o=(o=(o=(o=(o=o.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r?"":"out vec4 glFragColor;\n")+"void main(")),-1!==this.defines.indexOf("#define MULTIVIEW\n")&&!t&&(o="#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+o),n(o)}else n(i.replace("#version 300 es",""));else n(i)},e.prototype._processIncludes=function(t,n){for(var i=this,r=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=r.exec(t),a=new String(t);null!=o;){var s=o[1];if(-1!==s.indexOf("__decl__")&&(s=s.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(s=(s=s.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),s+="Declaration"),!e.IncludesShadersStore[s])return void this._engine._loadFile(e.ShadersRepository+"ShadersInclude/"+s+".fx",function(t){e.IncludesShadersStore[s]=t,i._processIncludes(a,n)});var l=e.IncludesShadersStore[s];if(o[2])for(var c=o[3].split(","),u=0;u<c.length;u+=2){var h=new RegExp(c[u],"g");l=l.replace(h,c[u+1])}if(o[4]){var d=o[5];if(-1!==d.indexOf("..")){var f=d.split(".."),p=parseInt(f[0]),g=parseInt(f[1]),m=l.slice(0);l="",isNaN(g)&&(g=this._indexParameters[f[1]]);for(var _=p;_<g;_++)this._engine.supportsUniformBuffers||(m=m.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l+=m.replace(/\{X\}/g,_.toString())+"\n"}else this._engine.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),l=l.replace(/\{X\}/g,d)}a=a.replace(o[0],l),o=r.exec(t)}n(a)},e.prototype._processPrecision=function(e){var t=this._engine._shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=t?"precision highp float;\n"+e:"precision mediump float;\n"+e:t||(e=e.replace("precision highp float","precision mediump float")),e},e.prototype._rebuildProgram=function(e,t,n,i){var o=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){for(var e=o.getEngine().scenes,t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(r.a.MATERIAL_AllDirtyFlag);o._pipelineContext._handlesSpectorRebuildCallback(n)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,n=this.defines,i=this._fallbacks;this._valueCache={};var r=this._pipelineContext;try{var o=this._engine;this._pipelineContext=o.createPipelineContext();var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?o._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,s,null,this._transformFeedbackVaryings):o._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,s,n,this._transformFeedbackVaryings),o._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(o.supportsUniformBuffers)for(var n in e._uniformBuffersNames)e.bindUniformBlock(n,e._uniformBuffersNames[n]);var i;for(o.getUniforms(e._pipelineContext,e._uniformsNames).forEach(function(t,n){e._uniforms[e._uniformsNames[n]]=t}),e._attributes=o.getAttributes(e._pipelineContext,t),i=0;i<e._samplerList.length;i++)null==e.getUniform(e._samplerList[i])&&(e._samplerList.splice(i,1),i--);e._samplerList.forEach(function(t,n){e._samplers[t]=n}),o.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),r&&e.getEngine()._deletePipelineContext(r)}),this._pipelineContext.isAsync&&this._checkIsReady()}catch(e){this._compilationError=e.message,a.a.Error("Unable to compile effect:"),a.a.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),a.a.Error("Attributes: "+t.map(function(e){return" "+e})),a.a.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),i&&i.isMoreFallbacks?(a.a.Error("Trying next fallback."),this.defines=i.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var n=e+"Ex";if(-1===this._samplerList.indexOf(n))for(var i=this._samplers[e],r=1;r<t.length;r++)this._samplerList.splice(i+r,0,n),this._samplers[n]=i+r;this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var n=this._valueCache[e],i=t.updateFlag;return(void 0===n||n!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,n){var i=this._valueCache[e];if(!i)return this._valueCache[e]=i=[t,n],!0;var r=!1;return i[0]!==t&&(i[0]=t,r=!0),i[1]!==n&&(i[1]=n,r=!0),r},e.prototype._cacheFloat3=function(e,t,n,i){var r=this._valueCache[e];if(!r)return this._valueCache[e]=r=[t,n,i],!0;var o=!1;return r[0]!==t&&(r[0]=t,o=!0),r[1]!==n&&(r[1]=n,o=!0),r[2]!==i&&(r[2]=i,o=!0),o},e.prototype._cacheFloat4=function(e,t,n,i,r){var o=this._valueCache[e];if(!o)return this._valueCache[e]=o=[t,n,i,r],!0;var a=!1;return o[0]!==t&&(o[0]=t,a=!0),o[1]!==n&&(o[1]=n,a=!0),o[2]!==i&&(o[2]=i,a=!0),o[3]!==r&&(o[3]=r,a=!0),a},e.prototype.bindUniformBuffer=function(t,n){var i=this._uniformBuffersNames[n];void 0!==i&&e._baseCache[i]!==t&&(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t),this)},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrix(this._uniforms[e],t),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t),this)},e.prototype.setBool=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setBool(this._uniforms[e],t?1:0),this)},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},e.prototype.setFloat2=function(e,t,n){return this._cacheFloat2(e,t,n)&&this._engine.setFloat2(this._uniforms[e],t,n),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},e.prototype.setFloat3=function(e,t,n,i){return this._cacheFloat3(e,t,n,i)&&this._engine.setFloat3(this._uniforms[e],t,n,i),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},e.prototype.setFloat4=function(e,t,n,i,r){return this._cacheFloat4(e,t,n,i,r)&&this._engine.setFloat4(this._uniforms[e],t,n,i,r),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setColor3(this._uniforms[e],t),this},e.prototype.setColor4=function(e,t,n){return this._cacheFloat4(e,t.r,t.g,t.b,n)&&this._engine.setColor4(this._uniforms[e],t,n),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setDirectColor4(this._uniforms[e],t),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,n,i){n&&(e.ShadersStore[t+"PixelShader"]=n),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},n=new Date;return"["+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var n=e._FormatMessage(t);console.log("BJS - "+n),e._AddLogEntry("<div style='color:white'>"+n+"</div><br>")},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var n=e._FormatMessage(t);console.warn("BJS - "+n),e._AddLogEntry("<div style='color:orange'>"+n+"</div><br>")},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var n=e._FormatMessage(t);console.error("BJS - "+n),e._AddLogEntry("<div style='color:red'>"+n+"</div><br>")},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){e.Log=(t&e.MessageLogLevel)===e.MessageLogLevel?e._LogEnabled:e._LogDisabled,e.Warn=(t&e.WarningLogLevel)===e.WarningLogLevel?e._WarnEnabled:e._WarnDisabled,e.Error=(t&e.ErrorLogLevel)===e.ErrorLogLevel?e._ErrorEnabled:e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(2),o=n(8),a=n(9),s=n(0),l=n(44),c=n(3),u=n(22),h=n(19),d=function(e){function t(n,i,r,s,l,u,h,d,f,p){void 0===r&&(r=!1),void 0===s&&(s=!0),void 0===l&&(l=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=!1);var g=e.call(this,i)||this;if(g.url=null,g.uOffset=0,g.vOffset=0,g.uScale=1,g.vScale=1,g.uAng=0,g.vAng=0,g.wAng=0,g.uRotationCenter=.5,g.vRotationCenter=.5,g.wRotationCenter=.5,g.inspectableCustomProperties=null,g._noMipmap=!1,g._invertY=!1,g._rowGenerationMatrix=null,g._cachedTextureMatrix=null,g._projectionModeMatrix=null,g._t0=null,g._t1=null,g._t2=null,g._cachedUOffset=-1,g._cachedVOffset=-1,g._cachedUScale=0,g._cachedVScale=0,g._cachedUAng=-1,g._cachedVAng=-1,g._cachedWAng=-1,g._cachedProjectionMatrixId=-1,g._cachedCoordinatesMode=-1,g._initialSamplingMode=t.BILINEAR_SAMPLINGMODE,g._buffer=null,g._deleteBuffer=!1,g._format=null,g._delayedOnLoad=null,g._delayedOnError=null,g.onLoadObservable=new o.c,g._isBlocking=!0,g.name=n||"",g.url=n,g._noMipmap=r,g._invertY=s,g._initialSamplingMode=l,g._buffer=d,g._deleteBuffer=f,p&&(g._format=p),!(i=g.getScene()))return g;i.getEngine().onBeforeTextureInitObservable.notifyObservers(g);var m=function(){g._texture&&g._texture._invertVScale&&(g.vScale=-1),g.onLoadObservable.hasObservers()&&g.onLoadObservable.notifyObservers(g),u&&u(),!g.isBlocking&&i&&i.resetCachedMaterial()};return g.url?(g._texture=g._getFromCache(g.url,r,l,s),g._texture?g._texture.isReady?a.h.SetImmediate(function(){return m()}):g._texture.onLoadedObservable.add(m):i.useDelayedTextureLoading?(g.delayLoadState=c.a.DELAYLOADSTATE_NOTLOADED,g._delayedOnLoad=m,g._delayedOnError=h):(g._texture=i.getEngine().createTexture(g.url,r,s,i,l,m,h,g._buffer,void 0,g._format),f&&delete g._buffer),g):(g._delayedOnLoad=m,g._delayedOnError=h,g)}return i.d(t,e),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),t.prototype.updateURL=function(e,t,n){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(c.a.MATERIAL_TextureDirtyFlag)),this.url=e,this._buffer=t,this.delayLoadState=c.a.DELAYLOADSTATE_NOTLOADED,n&&(this._delayedOnLoad=n),this.delayLoad()},t.prototype.delayLoad=function(){if(this.delayLoadState===c.a.DELAYLOADSTATE_NOTLOADED){var e=this.getScene();e&&(this.delayLoadState=c.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?a.h.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(e,t,n,i){e*=this.uScale,t*=this.vScale,s.x.TransformCoordinatesFromFloatsToRef(e-=this.uRotationCenter*this.uScale,t-=this.vRotationCenter*this.vScale,n-=this.wRotationCenter,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this.uScale+this.uOffset,i.y+=this.vRotationCenter*this.vScale+this.vOffset,i.z+=this.wRotationCenter},t.prototype.getTextureMatrix=function(){var e=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=s.j.Zero(),this._rowGenerationMatrix=new s.j,this._t0=s.x.Zero(),this._t1=s.x.Zero(),this._t2=s.x.Zero()),s.j.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),s.j.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var t=this.getScene();return t?(t.markAllMaterialsAsDirty(c.a.MATERIAL_TextureDirtyFlag,function(t){return t.hasTexture(e)}),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var e=this,n=this.getScene();if(!n)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===n.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=s.j.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=s.j.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:s.j.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:s.j.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var i=n.getProjectionMatrix();this._cachedProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:s.j.IdentityToRef(this._cachedTextureMatrix)}return n.markAllMaterialsAsDirty(c.a.MATERIAL_TextureDirtyFlag,function(t){return-1!==t.getActiveTextures().indexOf(e)}),this._cachedTextureMatrix},t.prototype.clone=function(){var e=this;return r.a.Clone(function(){return new t(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(t.base64String=this._buffer,t.name=t.name.replace("data:","")),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(e,n,i){if(e.customType){var o=a.h.Instantiate(e.customType).Parse(e,n,i);return e.samplingMode&&o.updateSamplingMode&&o._samplingMode&&o._samplingMode!==e.samplingMode&&o.updateSamplingMode(e.samplingMode),o}if(e.isCube&&!e.isRenderTarget)return t._CubeTextureParser(e,n,i);if(!e.name&&!e.isRenderTarget)return null;var l=r.a.Parse(function(){var r,o=!0;if(e.noMipmap&&(o=!1),e.mirrorPlane){var a=t._CreateMirror(e.name,e.renderTargetSize,n,o);return a._waitingRenderList=e.renderList,a.mirrorPlane=s.n.FromArray(e.mirrorPlane),a}if(e.isRenderTarget){var l=null;if(e.isCube){if(n.reflectionProbes)for(var c=0;c<n.reflectionProbes.length;c++){var u=n.reflectionProbes[c];if(u.name===e.name)return u.cubeTexture}}else(l=t._CreateRenderTargetTexture(e.name,e.renderTargetSize,n,o))._waitingRenderList=e.renderList;return l}if(e.base64String)r=t.CreateFromBase64String(e.base64String,e.name,n,!o);else{var h=i+e.name;t.UseSerializedUrlIfAny&&e.url&&(h=e.url),r=new t(h,n,!o,e.invertY)}return r},e,n);if(e.samplingMode){var c=e.samplingMode;l&&l.samplingMode!==c&&l.updateSamplingMode(c)}if(l&&e.animations)for(var h=0;h<e.animations.length;h++){var d=e.animations[h],f=u.a.GetClass("BABYLON.Animation");f&&l.animations.push(f.Parse(d))}return l},t.CreateFromBase64String=function(e,n,i,r,o,a,s,l,u){return void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=c.a.TEXTUREFORMAT_RGBA),new t("data:"+n,i,r,o,a,s,l,e,!1,u)},t.LoadFromDataString=function(e,n,i,r,o,a,s,l,u,h){return void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===s&&(s=t.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===u&&(u=null),void 0===h&&(h=c.a.TEXTUREFORMAT_RGBA),"data:"!==e.substr(0,5)&&(e="data:"+e),new t(e,i,o,a,s,l,u,n,r,h)},t._CubeTextureParser=function(e,t,n){throw h.a.WarnImport("CubeTexture")},t._CreateMirror=function(e,t,n,i){throw h.a.WarnImport("MirrorTexture")},t._CreateRenderTargetTexture=function(e,t,n,i){throw h.a.WarnImport("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=c.a.TEXTURE_NEAREST_SAMPLINGMODE,t.NEAREST_NEAREST_MIPLINEAR=c.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.BILINEAR_SAMPLINGMODE=c.a.TEXTURE_BILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPNEAREST=c.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TRILINEAR_SAMPLINGMODE=c.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPLINEAR=c.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.NEAREST_NEAREST_MIPNEAREST=c.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.NEAREST_LINEAR_MIPNEAREST=c.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.NEAREST_LINEAR_MIPLINEAR=c.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.NEAREST_LINEAR=c.a.TEXTURE_NEAREST_LINEAR,t.NEAREST_NEAREST=c.a.TEXTURE_NEAREST_NEAREST,t.LINEAR_NEAREST_MIPNEAREST=c.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.LINEAR_NEAREST_MIPLINEAR=c.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.LINEAR_LINEAR=c.a.TEXTURE_LINEAR_LINEAR,t.LINEAR_NEAREST=c.a.TEXTURE_LINEAR_NEAREST,t.EXPLICIT_MODE=c.a.TEXTURE_EXPLICIT_MODE,t.SPHERICAL_MODE=c.a.TEXTURE_SPHERICAL_MODE,t.PLANAR_MODE=c.a.TEXTURE_PLANAR_MODE,t.CUBIC_MODE=c.a.TEXTURE_CUBIC_MODE,t.PROJECTION_MODE=c.a.TEXTURE_PROJECTION_MODE,t.SKYBOX_MODE=c.a.TEXTURE_SKYBOX_MODE,t.INVCUBIC_MODE=c.a.TEXTURE_INVCUBIC_MODE,t.EQUIRECTANGULAR_MODE=c.a.TEXTURE_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MODE=c.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=c.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.CLAMP_ADDRESSMODE=c.a.TEXTURE_CLAMP_ADDRESSMODE,t.WRAP_ADDRESSMODE=c.a.TEXTURE_WRAP_ADDRESSMODE,t.MIRROR_ADDRESSMODE=c.a.TEXTURE_MIRROR_ADDRESSMODE,t.UseSerializedUrlIfAny=!1,i.c([Object(r.c)()],t.prototype,"url",void 0),i.c([Object(r.c)()],t.prototype,"uOffset",void 0),i.c([Object(r.c)()],t.prototype,"vOffset",void 0),i.c([Object(r.c)()],t.prototype,"uScale",void 0),i.c([Object(r.c)()],t.prototype,"vScale",void 0),i.c([Object(r.c)()],t.prototype,"uAng",void 0),i.c([Object(r.c)()],t.prototype,"vAng",void 0),i.c([Object(r.c)()],t.prototype,"wAng",void 0),i.c([Object(r.c)()],t.prototype,"uRotationCenter",void 0),i.c([Object(r.c)()],t.prototype,"vRotationCenter",void 0),i.c([Object(r.c)()],t.prototype,"wRotationCenter",void 0),i.c([Object(r.c)()],t.prototype,"isBlocking",null),t}(l.a);r.a._TextureParser=d.Parse},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var i=function(){function e(e,t,n,i){void 0===t&&(t=!1),this.initalize(e,t,n,i)}return e.prototype.initalize=function(e,t,n,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=n,this.currentTarget=i,this},e}(),r=function(e,t,n){void 0===n&&(n=null),this.callback=e,this.mask=t,this.scope=n,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},o=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,n,i,r){void 0===i&&(i=-1),void 0===r&&(r=null);var o=new e;o._observers=new Array,o._observables=t;for(var a=0,s=t;a<s.length;a++){var l=s[a].add(n,i,!1,r);l&&o._observers.push(l)}return o},e}(),a=function(){function e(e){this._observers=new Array,this._eventState=new i(0),e&&(this._onObserverAdded=e)}return e.prototype.add=function(e,t,n,i,o){if(void 0===t&&(t=-1),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===o&&(o=!1),!e)return null;var a=new r(e,t,i);return a.unregisterOnNextCall=o,n?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var n=0;n<this._observers.length;n++)if(this._observers[n].callback===e&&(!t||t===this._observers[n].scope))return this._deferUnregister(this._observers[n]),!0;return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,n,i){if(void 0===t&&(t=-1),!this._observers.length)return!0;var r=this._eventState;r.mask=t,r.target=n,r.currentTarget=i,r.skipNextObservers=!1,r.lastReturnValue=e;for(var o=0,a=this._observers;o<a.length;o++){var s=a[o];if(!s._willBeUnregistered&&(s.mask&t&&(r.lastReturnValue=s.scope?s.callback.apply(s.scope,[e,r]):s.callback(e,r),s.unregisterOnNextCall&&this._deferUnregister(s)),r.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,n,i){var r=this;void 0===t&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var a=this._eventState;return a.mask=t,a.target=n,a.currentTarget=i,a.skipNextObservers=!1,this._observers.forEach(function(n){a.skipNextObservers||n._willBeUnregistered||n.mask&t&&(o=o.then(n.scope?function(t){return a.lastReturnValue=t,n.callback.apply(n.scope,[e,a])}:function(t){return a.lastReturnValue=t,n.callback(e,a)}),n.unregisterOnNextCall&&r._deferUnregister(n))}),o.then(function(){return e})},e.prototype.notifyObserver=function(e,t,n){void 0===n&&(n=-1);var i=this._eventState;i.mask=n,i.skipNextObservers=!1,e.callback(t,i)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,n=this._observers;t<n.length;t++){var i=n[t];if(i.mask&e||i.mask===e)return!0}return!1},e}()},function(e,t,n){"use strict";n.d(t,"c",function(){return m}),n.d(t,"b",function(){return _}),n.d(t,"d",function(){return v}),n.d(t,"e",function(){return b}),n.d(t,"g",function(){return y}),n.d(t,"h",function(){return T}),n.d(t,"f",function(){return E}),n.d(t,"i",function(){return x}),n.d(t,"a",function(){return C});var i=n(1),r=n(0),o=n(12),a=n(8),s=n(59),l=n(3),c=n(35),u=n(6),h=n(22),d=n(32),f=n(47),p=n(19),g=n(60),m=function(){function e(){}return e.prototype.getColorToRef=function(e){this.color2?r.f.LerpToRef(this.color1,this.color2,Math.random(),e):e.copyFrom(this.color1)},e}(),_=function(){},v=function(){function e(){}return e.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:o.a.Lerp(this.factor1,this.factor2,Math.random())},e}(),b=function(e){function t(n,i){var r=e.call(this,n)||this;return r.request=i,r.name="LoadFileError",t._setPrototypeOf(r,t.prototype),r}return i.d(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),y=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(n,i,r){return 0!==i.status||r>=e||-1!==n.indexOf("file:")?-1:Math.pow(2,r)*t}},e}(),T=function(){function e(){}return e.FetchToRef=function(e,t,n,i,r,o){var a=4*((Math.abs(e)*n%n|0)+(Math.abs(t)*i%i|0)*n);o.r=r[a]/255,o.g=r[a+1]/255,o.b=r[a+2]/255,o.a=r[a+3]/255},e.Mix=function(e,t,n){return e*(1-n)+t*n},e.Instantiate=function(t){if(e.RegisteredExternalClasses&&e.RegisteredExternalClasses[t])return e.RegisteredExternalClasses[t];var n=h.a.GetClass(t);if(n)return n;u.a.Warn(t+" not found, you may have missed an import.");for(var i=t.split("."),r=window||this,o=0,a=i.length;o<a;o++)r=r[i[o]];return"function"!=typeof r?null:r},e.Slice=function(e,t,n){return e.slice?e.slice(t,n):Array.prototype.slice.call(e,t,n)},e.SetImmediate=function(e){c.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},e.FloatRound=function(t){return Math.fround?Math.fround(t):e._tmpFloatArray[0]=t},e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var n=e.CeilingPOT(t),i=e.FloorPOT(t);return n-t>t-i?i:n},e.GetExponentOfTwo=function(t,n,i){var r;switch(void 0===i&&(i=l.a.SCALEMODE_NEAREST),i){case l.a.SCALEMODE_FLOOR:r=e.FloorPOT(t);break;case l.a.SCALEMODE_NEAREST:r=e.NearestPOT(t);break;case l.a.SCALEMODE_CEILING:default:r=e.CeilingPOT(t)}return Math.min(r,n)},e.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},e.GetFolderPath=function(e,t){void 0===t&&(t=!1);var n=e.lastIndexOf("/");return n<0?t?e:"":e.substring(0,n+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.EncodeArrayBufferTobase64=function(e){for(var t,n,i,r,o,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0,h=new Uint8Array(e);u<h.length;)r=(t=h[u++])>>2,o=(3&t)<<4|(n=u<h.length?h[u++]:Number.NaN)>>4,a=(15&n)<<2|(i=u<h.length?h[u++]:Number.NaN)>>6,s=63&i,isNaN(n)?a=s=64:isNaN(i)&&(s=64),c+=l.charAt(r)+l.charAt(o)+l.charAt(a)+l.charAt(s);return"data:image/png;base64,"+c},e.ExtractMinAndMaxIndexed=function(e,t,n,i,o){void 0===o&&(o=null);for(var a=new r.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new r.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=n;l<n+i;l++){var c=3*t[l],u=e[c],h=e[c+1],d=e[c+2];a.minimizeInPlaceFromFloats(u,h,d),s.maximizeInPlaceFromFloats(u,h,d)}return o&&(a.x-=a.x*o.x+o.y,a.y-=a.y*o.x+o.y,a.z-=a.z*o.x+o.y,s.x+=s.x*o.x+o.y,s.y+=s.y*o.x+o.y,s.z+=s.z*o.x+o.y),{minimum:a,maximum:s}},e.ExtractMinAndMax=function(e,t,n,i,o){void 0===i&&(i=null);var a=new r.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new r.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);o||(o=3);for(var l=t,c=t*o;l<t+n;l++,c+=o){var u=e[c],h=e[c+1],d=e[c+2];a.minimizeInPlaceFromFloats(u,h,d),s.maximizeInPlaceFromFloats(u,h,d)}return i&&(a.x-=a.x*i.x+i.y,a.y-=a.y*i.x+i.y,a.z-=a.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:a,maximum:s}},e.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(){var e="pointer";return!c.a.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},e.QueueNewFrame=function(e,t){return c.a.IsWindowObjectExist()?(t||(t=window),t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):setTimeout(e,16)},e.RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},e.ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},e.SetCorsBehavior=function(t,n){if((!t||0!==t.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||e.CorsBehavior instanceof String)n.crossOrigin=e.CorsBehavior;else{var i=e.CorsBehavior(t);i&&(n.crossOrigin=i)}},e.CleanUrl=function(e){return e.replace(/#/gm,"%23")},e.LoadImage=function(t,n,i,r){var o,a=!1;t instanceof ArrayBuffer?(o=URL.createObjectURL(new Blob([t])),a=!0):t instanceof Blob?(o=URL.createObjectURL(t),a=!0):(o=e.CleanUrl(t),o=e.PreprocessUrl(t));var l=new Image;e.SetCorsBehavior(o,l);var c=function(){l.removeEventListener("load",c),l.removeEventListener("error",h),n(l),a&&l.src&&URL.revokeObjectURL(l.src)},h=function(e){l.removeEventListener("load",c),l.removeEventListener("error",h),u.a.Error("Error while trying to load image: "+t),i&&i("Error while trying to load image: "+t,e),a&&l.src&&URL.revokeObjectURL(l.src)};l.addEventListener("load",c),l.addEventListener("error",h);var d=function(){l.src=o};if("data:"!==o.substr(0,5)&&r&&r.enableTexturesOffline)r.open(function(){r&&r.loadImage(o,l)},d);else{if(-1!==o.indexOf("file:")){var f=decodeURIComponent(o.substring(5).toLowerCase());if(s.a.FilesToLoad[f]){try{var p;try{p=URL.createObjectURL(s.a.FilesToLoad[f])}catch(e){p=URL.createObjectURL(s.a.FilesToLoad[f])}l.src=p,a=!0}catch(e){l.src=""}return l}}d()}return l},e.LoadFile=function(t,n,i,r,o,l){if(t=e.CleanUrl(t),-1!==(t=e.PreprocessUrl(t)).indexOf("file:")){var u=decodeURIComponent(t.substring(5).toLowerCase());if(s.a.FilesToLoad[u])return e.ReadFile(s.a.FilesToLoad[u],n,i,o)}var h=e.BaseUrl+t,d=!1,f={onCompleteObservable:new a.c,abort:function(){return d=!0}},p=function(){var t=new g.a,r=null;f.abort=function(){d=!0,t.readyState!==(XMLHttpRequest.DONE||4)&&t.abort(),null!==r&&(clearTimeout(r),r=null)};var a=function(s){t.open("GET",h),o&&(t.responseType="arraybuffer"),i&&t.addEventListener("progress",i);var u=function(){t.removeEventListener("loadend",u),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};t.addEventListener("loadend",u);var p=function(){if(!d&&t.readyState===(XMLHttpRequest.DONE||4)){if(t.removeEventListener("readystatechange",p),t.status>=200&&t.status<300||0===t.status&&(!c.a.IsWindowObjectExist()||e.IsFileURL()))return void n(o?t.response:t.responseText,t.responseURL);var i=e.DefaultRetryStrategy;if(i){var f=i(h,t,s);if(-1!==f)return t.removeEventListener("loadend",u),t=new g.a,void(r=setTimeout(function(){return a(s+1)},f))}var m=new b("Error status: "+t.status+" "+t.statusText+" - Unable to load "+h,t);if(!l)throw m;l(t,m)}};t.addEventListener("readystatechange",p),t.send()};a(0)};if(r&&r.enableSceneOffline){var m=function(e){e&&e.status>400?l&&l(e):d||p()};r.open(function(){d||r&&r.loadFile(t,function(e){d||n(e),f.onCompleteObservable.notifyObservers(f)},i?function(e){d||i(e)}:void 0,m,o)},m)}else p();return f},e.LoadScript=function(e,t,n,i){if(c.a.IsWindowObjectExist()){var r=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),i&&(o.id=i),o.onload=function(){t&&t()},o.onerror=function(t){n&&n("Unable to load script '"+e+"'",t)},r.appendChild(o)}},e.LoadScriptAsync=function(e,t){return new Promise(function(n,i){if(c.a.IsWindowObjectExist()){var r=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),t&&(o.id=t),o.onload=function(){n(!0)},o.onerror=function(e){n(!1)},r.appendChild(o)}else n(!1)})},e.ReadFileAsDataURL=function(e,t,n){var i=new FileReader,r={onCompleteObservable:new a.c,abort:function(){return i.abort()}};return i.onloadend=function(e){r.onCompleteObservable.notifyObservers(r)},i.onload=function(e){t(e.target.result)},i.onprogress=n,i.readAsDataURL(e),r},e.ReadFile=function(e,t,n,i){var r=new FileReader,o={onCompleteObservable:new a.c,abort:function(){return r.abort()}};return r.onloadend=function(e){return o.onCompleteObservable.notifyObservers(o)},r.onerror=function(n){u.a.Log("Error while reading file: "+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},r.onload=function(e){t(e.target.result)},n&&(r.onprogress=n),i?r.readAsArrayBuffer(e):r.readAsText(e),o},e.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},e.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},e.CheckExtends=function(e,t,n){t.minimizeInPlace(e),n.maximizeInPlace(e)},e.DeepCopy=function(e,t,n,i){d.a.DeepCopy(e,t,n,i)},e.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var n=e[t];window.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch(e){}}},e.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var n=e[t];window.removeEventListener(n.name,n.handler);try{window.parent&&window.parent.removeEventListener(n.name,n.handler)}catch(e){}}},e.DumpFramebuffer=function(t,n,i,r,o,a){void 0===o&&(o="image/png");for(var s=4*t,l=n/2,c=i.readPixels(0,0,t,n),u=0;u<l;u++)for(var h=0;h<s;h++){var d=h+u*s,f=h+(n-u-1)*s,p=c[d];c[d]=c[f],c[f]=p}e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=n;var g=e._ScreenshotCanvas.getContext("2d");if(g){var m=g.createImageData(t,n);m.data.set(c),g.putImageData(m,0,0),e.EncodeScreenshotCanvasData(r,o,a)}},e.ToBlob=function(e,t,n){void 0===n&&(n="image/png"),e.toBlob||(e.toBlob=function(e,t,n){var i=this;setTimeout(function(){for(var r=atob(i.toDataURL(t,n).split(",")[1]),o=r.length,a=new Uint8Array(o),s=0;s<o;s++)a[s]=r.charCodeAt(s);e(new Blob([a]))})}),e.toBlob(function(e){t(e)},n)},e.EncodeScreenshotCanvasData=function(t,n,i){void 0===n&&(n="image/png"),t?t(e._ScreenshotCanvas.toDataURL(n)):this.ToBlob(e._ScreenshotCanvas,function(t){if("download"in document.createElement("a")){if(!i){var n=new Date,r=(n.getFullYear()+"-"+(n.getMonth()+1)).slice(2)+"-"+n.getDate()+"_"+n.getHours()+"-"+("0"+n.getMinutes()).slice(-2);i="screenshot_"+r+".png"}e.Download(t,i)}else{var o=URL.createObjectURL(t),a=window.open("");if(!a)return;var s=a.document.createElement("img");s.onload=function(){URL.revokeObjectURL(o)},s.src=o,a.document.body.appendChild(s)}},n)},e.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var n=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=n,i.download=t,i.addEventListener("click",function(){i.parentElement&&i.parentElement.removeChild(i)}),i.click(),window.URL.revokeObjectURL(n)}},e.CreateScreenshot=function(e,t,n,i,r){throw void 0===r&&(r="image/png"),p.a.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(e,t,n,i,r,o,a,s){throw void 0===r&&(r="image/png"),void 0===o&&(o=1),void 0===a&&(a=!1),p.a.WarnImport("ScreenshotTools")},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},e.DecodeBase64=function(e){for(var t=atob(e.split(",")[1]),n=t.length,i=new Uint8Array(new ArrayBuffer(n)),r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer},e.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(e,"errorsCount",{get:function(){return u.a.errorsCount},enumerable:!0,configurable:!0}),e.Log=function(e){u.a.Log(e)},e.Warn=function(e){u.a.Warn(e)},e.Error=function(e){u.a.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return u.a.LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){u.a.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){u.a.LogLevels=e},enumerable:!0,configurable:!0}),e.IsFileURL=function(){return"file:"===location.protocol},Object.defineProperty(e,"PerformanceLogLevel",{set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,t){},e._EndPerformanceCounterDisabled=function(e,t){},e._StartUserMark=function(t,n){if(void 0===n&&(n=!0),!e._performance){if(!c.a.IsWindowObjectExist())return;e._performance=window.performance}n&&e._performance.mark&&e._performance.mark(t+"-Begin")},e._EndUserMark=function(t,n){void 0===n&&(n=!0),n&&e._performance.mark&&(e._performance.mark(t+"-End"),e._performance.measure(t,t+"-Begin",t+"-End"))},e._StartPerformanceConsole=function(t,n){void 0===n&&(n=!0),n&&(e._StartUserMark(t,n),console.time&&console.time(t))},e._EndPerformanceConsole=function(t,n){void 0===n&&(n=!0),n&&(e._EndUserMark(t,n),console.time&&console.timeEnd(t))},Object.defineProperty(e,"Now",{get:function(){return f.a.Now},enumerable:!0,configurable:!0}),e.GetClassName=function(e,t){void 0===t&&(t=!1);var n=null;return!t&&e.getClassName?n=e.getClassName():(e instanceof Object&&(n=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),n||(n=typeof e)),n},e.First=function(e,t){for(var n=0,i=e;n<i.length;n++){var r=i[n];if(t(r))return r}return null},e.getFullClassName=function(e,t){void 0===t&&(t=!1);var n=null,i=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var r=t?e:Object.getPrototypeOf(e);n=r.constructor.__bjsclassName__,i=r.constructor.__bjsmoduleName__}n||(n=typeof e)}return n?(null!=i?i+".":"")+n:null},e.DelayAsync=function(e){return new Promise(function(t){setTimeout(function(){t()},e)})},e.GetCurrentGradient=function(e,t,n){for(var i=0;i<t.length-1;i++){var r=t[i],o=t[i+1];if(e>=r.gradient&&e<=o.gradient)return void n(r,o,(e-r.gradient)/(o.gradient-r.gradient))}var a=t.length-1;n(t[a],t[a],1)},e.BaseUrl="",e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=g.a.CustomRequestHeaders,e.DefaultRetryStrategy=y.ExponentialBackoff(),e.CorsBehavior="anonymous",e.UseFallbackTexture=!0,e.RegisteredExternalClasses={},e.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",e._tmpFloatArray=new Float32Array(1),e.GetDOMTextContent=c.a.GetDOMTextContent,e.PreprocessUrl=function(e){return e},e.NoneLogLevel=u.a.NoneLogLevel,e.MessageLogLevel=u.a.MessageLogLevel,e.WarningLogLevel=u.a.WarningLogLevel,e.ErrorLogLevel=u.a.ErrorLogLevel,e.AllLogLevel=u.a.AllLogLevel,e.IsWindowObjectExist=c.a.IsWindowObjectExist,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}(),E=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,n){e.Enabled&&(this._current+=t,n&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=f.a.Now)},e.prototype.endMonitoring=function(t){void 0===t&&(t=!0),e.Enabled&&(t&&this.fetchNewFrame(),this._current=f.a.Now-this._startMonitoringTime,t&&this._fetchResult())},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=f.a.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();function x(e,t){return function(n){n.__bjsclassName__=e,n.__bjsmoduleName__=null!=t?t:null}}var C=function(){function e(e,t,n,i){void 0===i&&(i=0),this.iterations=e,this.index=i-1,this._done=!1,this._fn=t,this._successCallback=n}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,n,i,r){void 0===r&&(r=0);var o=new e(t,n,i,r);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,n,i,r,o,a){return void 0===a&&(a=0),e.Run(Math.ceil(t/n),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var r=0;r<n;++r){var a=e.index*n+r;if(a>=t)break;if(i(a),o&&o()){e.breakLoop();break}}e.executeNext()},a)},r)},e}()},function(e,t,n){"use strict";n.d(t,"d",function(){return C}),n.d(t,"a",function(){return S}),n.d(t,"c",function(){return A}),n.d(t,"b",function(){return P});var i=n(1),r=n(8),o=n(105),a=n(61),s=n(106),l=n(9),c=n(0),u=n(12),h=n(5),d=n(20),f=n(26),p=n(94),g=n(3),m=n(35),_=n(6),v=n(23),b=n(92),y=n(19),T=n(107),E=n(73),x=function(){},C=function(){},S=function(){},A=function(){},P=function(){function e(t,n,i,a){var u=this;void 0===a&&(a=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.onNewSceneAddedObservable=new r.c,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new r.c,this.onCanvasBlurObservable=new r.c,this.onCanvasFocusObservable=new r.c,this.onCanvasPointerOutObservable=new r.c,this.onBeforeTextureInitObservable=new r.c,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new r.c,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new r.c,this.onBeforeShaderCompilationObservable=new r.c,this.onAfterShaderCompilationObservable=new r.c,this._windowIsBackground=!1,this._webGLVersion=1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._colorWrite=!0,this._drawCalls=new l.f,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new r.c,this.onContextRestoredObservable=new r.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new o.a,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._depthCullingState=new p.b,this._stencilState=new p.c,this._alphaState=new p.a,this._alphaMode=e.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new c.y(0,0,0,0),this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},s.a.Apply();var h=null;if(e.Instances.push(this),t){if(i=i||{},t.getContext){if(this._renderingCanvas=h=t,null!=n&&(i.antialias=n),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=i.deterministicLockstep,this._lockstepMaxSteps=i.lockstepMaxSteps,this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent)for(var d=navigator.userAgent,f=0,g=e.ExceptionList;f<g.length;f++){var v=g[f],b=v.targets;if(new RegExp(v.key).test(d)){if(v.capture&&v.captureConstraint){var y=v.captureConstraint,T=new RegExp(v.capture).exec(d);if(T&&T.length>0&&parseInt(T[T.length-1])>=y)continue}for(var E=0,C=b;E<C.length;E++)switch(C[E]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(!i.disableWebGL2Support)try{this._gl=h.getContext("webgl2",i)||h.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!h)throw new Error("The provided canvas is null or undefined.");try{this._gl=h.getContext("webgl",i)||h.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._onCanvasFocus=function(){u.onCanvasFocusObservable.notifyObservers(u)},this._onCanvasBlur=function(){u.onCanvasBlurObservable.notifyObservers(u)},h.addEventListener("focus",this._onCanvasFocus),h.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){u.disablePerformanceMonitorInBackground&&u._performanceMonitor.disable(),u._windowIsBackground=!0},this._onFocus=function(){u.disablePerformanceMonitorInBackground&&u._performanceMonitor.enable(),u._windowIsBackground=!1},this._onCanvasPointerOut=function(e){u.onCanvasPointerOutObservable.notifyObservers(e)},m.a.IsWindowObjectExist()&&(window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus)),h.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),u._contextWasLost=!0,_.a.Warn("WebGL context lost."),u.onContextLostObservable.notifyObservers(u)},this._onContextRestored=function(){setTimeout(function(){u._initGLContext(),u._rebuildEffects(),u._rebuildInternalTextures(),u._rebuildBuffers(),u.wipeCaches(!0),_.a.Warn("WebGL context successfully restored."),u.onContextRestoredObservable.notifyObservers(u),u._contextWasLost=!1},0)},h.addEventListener("webglcontextlost",this._onContextLost,!1),h.addEventListener("webglcontextrestored",this._onContextRestored,!1)),i.doNotHandleTouchAction||this._disableTouchAction()}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var S=this._gl.getContextAttributes();S&&(i.stencil=S.stencil)}void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var A=m.a.IsWindowObjectExist()&&window.devicePixelRatio||1;if(this._hardwareScalingLevel=a?1/Math.min(i.limitDeviceRatio||A,A):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),h){var P=document;this._onFullscreenChange=function(){void 0!==P.fullscreen?u.isFullscreen=P.fullscreen:void 0!==P.mozFullScreen?u.isFullscreen=P.mozFullScreen:void 0!==P.webkitIsFullScreen?u.isFullscreen=P.webkitIsFullScreen:void 0!==P.msIsFullScreen&&(u.isFullscreen=P.msIsFullScreen),u.isFullscreen&&u._pointerLockRequested&&h&&(h.requestPointerLock=h.requestPointerLock||h.msRequestPointerLock||h.mozRequestPointerLock||h.webkitRequestPointerLock,h.requestPointerLock&&h.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){u.isPointerLock=P.mozPointerLockElement===h||P.webkitPointerLockElement===h||P.msPointerLockElement===h||P.pointerLockElement===h},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._connectVREvents(h,P)}!e.audioEngine&&i.audioEngine&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(this.getRenderingCanvas()));for(var R=0;R<this._caps.maxVertexAttribs;R++)this._currentBufferPointers[R]=new x;this._prepareVRComponent(),i.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+e.Version+" - "+this.description),this.enableOfflineSupport=void 0!==e.OfflineProviderFactory}}return Object.defineProperty(e,"Instances",{get:function(){return v.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedEngine",{get:function(){return v.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return v.a.LastCreatedScene},enumerable:!0,configurable:!0}),e.MarkAllMaterialsAsDirty=function(t,n){for(var i=0;i<e.Instances.length;i++)for(var r=e.Instances[i],o=0;o<r.scenes.length;o++)r.scenes[o].markAllMaterialsAsDirty(t,n)},Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return h.a.ShadersRepository},set:function(e){h.a.ShadersRepository=e},enumerable:!0,configurable:!0}),e.DefaultLoadingScreenFactory=function(e){throw y.a.WarnImport("LoadingScreen")},Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var t=new Uint8Array(4);this._emptyCubeTexture=this.createRawCubeTexture([t,t,t,t,t,t],1,e.TEXTUREFORMAT_RGBA,e.TEXTURETYPE_UNSIGNED_INT,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype.initWebVR=function(){throw y.a.WarnImport("WebVRCamera")},e.prototype._prepareVRComponent=function(){},e.prototype._connectVREvents=function(e,t){},e.prototype._submitVRFrame=function(){},e.prototype.disableVR=function(){},e.prototype.isVRPresenting=function(){return!1},e.prototype._requestVRFrame=function(){},e.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();h.a.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var n=t[e];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}for(var i=0,r=this._uniformBuffers;i<r.length;i++)r[i]._rebuild()},e.prototype._initGLContext=function(){this._caps=new A,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._caps.multiview=this._gl.getExtension("OVR_multiview2"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var n=0;n<16;n++)this._gl["COLOR_ATTACHMENT"+n+"_WEBGL"]=t["COLOR_ATTACHMENT"+n+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var r=this._gl.getExtension("OES_vertex_array_object");null!=r?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=r.createVertexArrayOES.bind(r),this._gl.bindVertexArray=r.bindVertexArrayOES.bind(r),this._gl.deleteVertexArray=r.deleteVertexArrayOES.bind(r)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),s=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&s&&(this._caps.highPrecisionShaderSupported=0!==a.precision&&0!==s.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},e.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var n=e.viewport;return this.getRenderWidth(t)*n.width/(this.getRenderHeight(t)*n.height)},e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},e.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},e.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},e.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},e.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},e.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},e.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},e.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},e.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},e.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},e.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},e.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},e.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},e.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},e.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},e.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=l.h.QueueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=l.h.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=l.h.QueueNewFrame(this._bindedRenderFunction)))},e.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},e.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&l.h.RequestFullscreen(this._renderingCanvas))},e.prototype.exitFullscreen=function(){this.isFullscreen&&l.h.ExitFullscreen()},e.prototype.clear=function(e,t,n,i){void 0===i&&(i=!1),this.applyStates();var r=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),r|=this._gl.COLOR_BUFFER_BIT),n&&(this._gl.clearDepth(1),r|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),r|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(r)},e.prototype.scissorClear=function(e,t,n,i,r){this.enableScissor(e,t,n,i),this.clear(r,!0,!0,!0),this.disableScissor()},e.prototype.enableScissor=function(e,t,n,i){var r=this._gl;r.enable(r.SCISSOR_TEST),r.scissor(e,t,n,i)},e.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},e.prototype._viewport=function(e,t,n,i){e===this._viewportCached.x&&t===this._viewportCached.y&&n===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=n,this._viewportCached.w=i,this._gl.viewport(e,t,n,i))},e.prototype.setViewport=function(e,t,n){var i=t||this.getRenderWidth(),r=n||this.getRenderHeight(),o=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(o*i,a*r,i*e.width,r*e.height)},e.prototype.setDirectViewport=function(e,t,n,i){var r=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,n,i),r},e.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},e.prototype.resize=function(){if(!this.isVRPresenting()){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},e.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var n=0;n<this.scenes.length;n++)for(var i=this.scenes[n],r=0;r<i.cameras.length;r++)i.cameras[r]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},e.prototype.bindFramebuffer=function(e,t,n,i,r,o,a){void 0===a&&(a=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var s=this._gl;e.isCube&&(void 0===t&&(t=0),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,a),o&&s.framebufferTexture2D(s.FRAMEBUFFER,o._generateStencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,o._webGLTexture,a)),this._cachedViewport&&!r?this.setViewport(this._cachedViewport,n,i):(n||(n=e.width,a&&(n/=Math.pow(2,a))),i||(i=e.height,a&&(i/=Math.pow(2,a))),this._viewport(0,0,n,i)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;e._MSAAFramebuffer&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),n&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),n()),this._bindUnboundFramebuffer(null)},e.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var n=new E.a(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},e.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var n=new E.a(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},e.prototype.updateUniformBuffer=function(e,t,n,i){this.bindUniformBuffer(e),void 0===n&&(n=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(n,n+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(n,n+i)),this.bindUniformBuffer(null)},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");var n=new E.a(t);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");var n=new E.a(t);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.updateDynamicIndexBuffer=function(e,t,n){var i;void 0===n&&(n=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},e.prototype.updateDynamicVertexBuffer=function(e,t,n,i){this.bindArrayBuffer(e),void 0===n&&(n=0),void 0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(n,n+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,n,i):new Uint8Array(t.buffer,t.byteOffset+n,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var n,i=this._gl.createBuffer(),r=new E.a(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);var o=!1;if(e instanceof Uint16Array)n=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)n=e,o=!0;else{for(var a=0;a<e.length;a++)if(e[a]>65535){o=!0;break}n=o?new Uint32Array(e):new Uint16Array(e)}else n=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=o,r},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},e.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},e.prototype.bindUniformBlock=function(e,t,n){var i=e.program,r=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,r,n)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,n,i,r,o,a){var s=this._currentBufferPointers[t],l=!1;s.active?(s.buffer!==e&&(s.buffer=e,l=!0),s.size!==n&&(s.size=n,l=!0),s.type!==i&&(s.type=i,l=!0),s.normalized!==r&&(s.normalized=r,l=!0),s.stride!==o&&(s.stride=o,l=!0),s.offset!==a&&(s.offset=a,l=!0)):(l=!0,s.active=!0,s.index=t,s.size=n,s.type=i,s.normalized=r,s.stride=o,s.offset=a,s.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,n,i,r,o,a))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<n.length;i++){var r=t.getAttributeLocation(i);if(r>=0){var o=e[n[i]];if(!o)continue;this._gl.enableVertexAttribArray(r),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[r]=!0);var a=o.getBuffer();a&&(this._vertexAttribPointer(a,r,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(r,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(r),this._currentInstanceBuffers.push(a))))}}},e.prototype.recordVertexArrayObject=function(e,t,n){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,n,i,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r;var o=r.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,s=0;s<o;s++)if(s<n.length){var l=r.getAttributeLocation(s);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,n[s],this._gl.FLOAT,!1,i,a)),a+=4*n[s]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,n){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===n||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._bindVertexBuffersAttributes(e,n)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,n=this._currentInstanceLocations.length;t<n;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i)),this._gl.vertexAttribDivisor(this._currentInstanceLocations[t],0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e.underlyingResource),!0)},e.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var n=new E.a(t);return n.capacity=e,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),n},e.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},e.prototype.updateAndBindInstancesBuffer=function(e,t,n){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==n[0].index){for(var i=0,r=0;r<n.length;r++)i+=4*(o=n[r]).attributeSize;for(r=0;r<n.length;r++){var o=n[r];this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attribyteType||this._gl.FLOAT,o.normalized||!1,i,o.offset),this._gl.vertexAttribDivisor(o.index,1),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}}else for(var a=0;a<4;a++){var s=n[a];this._vertexAttribArraysEnabled[s]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,16*a),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}},e.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},e.prototype.draw=function(e,t,n,i){this.drawElementsType(e?d.a.TriangleFillMode:d.a.WireFrameFillMode,t,n,i)},e.prototype.drawPointClouds=function(e,t,n){this.drawArraysType(d.a.PointFillMode,e,t,n)},e.prototype.drawUnIndexed=function(e,t,n,i){this.drawArraysType(e?d.a.TriangleFillMode:d.a.WireFrameFillMode,t,n,i)},e.prototype.drawElementsType=function(e,t,n,i){this.applyStates(),this._drawCalls.addCount(1,!1);var r=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(r,n,o,t*a,i):this._gl.drawElements(r,n,o,t*a)},e.prototype.drawArraysType=function(e,t,n,i){this.applyStates(),this._drawCalls.addCount(1,!1);var r=this._drawMode(e);i?this._gl.drawArraysInstanced(r,t,n,i):this._gl.drawArrays(r,t,n)},e.prototype._drawMode=function(e){switch(e){case d.a.TriangleFillMode:return this._gl.TRIANGLES;case d.a.PointFillMode:return this._gl.POINTS;case d.a.WireFrameFillMode:return this._gl.LINES;case d.a.PointListDrawMode:return this._gl.POINTS;case d.a.LineListDrawMode:return this._gl.LINES;case d.a.LineLoopDrawMode:return this._gl.LINE_LOOP;case d.a.LineStripDrawMode:return this._gl.LINE_STRIP;case d.a.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case d.a.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,n,i,r,o,a,s,l){var c=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(r||t.defines);if(this._compiledEffects[c]){var u=this._compiledEffects[c];return a&&u.isReady()&&a(u),u}var d=new h.a(e,t,n,i,this,r,o,a,s,l);return d._key=c,this._compiledEffects[c]=d,d},e.prototype._compileShader=function(e,t,n,i){return this._compileRawShader(i+(n?n+"\n":"")+e,t)},e.prototype._compileRawShader=function(e,t){var n=this._gl,i=n.createShader("vertex"===t?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");return n.shaderSource(i,e),n.compileShader(i),i},e.prototype.createRawShaderProgram=function(e,t,n,i,r){void 0===r&&(r=null),i=i||this._gl;var o=this._compileRawShader(t,"vertex"),a=this._compileRawShader(n,"fragment");return this._createShaderProgram(e,o,a,i,r)},e.prototype.createShaderProgram=function(e,t,n,i,r,o){void 0===o&&(o=null),r=r||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",s=this._compileShader(t,"vertex",i,a),l=this._compileShader(n,"fragment",i,a),c=this._createShaderProgram(e,s,l,r,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),c},e.prototype.createPipelineContext=function(){var e=new T.a;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,n,i,r){void 0===r&&(r=null);var o=i.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");if(i.attachShader(o,t),i.attachShader(o,n),this.webGLVersion>1&&r){var a=this.createTransformFeedback();this.bindTransformFeedback(a),this.setTranformFeedbackVaryings(o,r),e.transformFeedback=a}return i.linkProgram(o),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||this._finalizePipelineContext(e),o},e.prototype._finalizePipelineContext=function(e){var t=e.context,n=e.vertexShader,i=e.fragmentShader,r=e.program;if(!t.getProgramParameter(r,t.LINK_STATUS)){var o,a;if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(n)))throw new Error(o);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(i)))throw new Error(o);if(a=t.getProgramInfoLog(r))throw new Error(a)}if(this.validateShaderPrograms&&(t.validateProgram(r),!t.getProgramParameter(r,t.VALIDATE_STATUS)&&(a=t.getProgramInfoLog(r))))throw new Error(a);t.deleteShader(n),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,n,i,r,o,a){var s=e;s.program=i?this.createRawShaderProgram(s,t,n,void 0,a):this.createShaderProgram(s,t,n,o,void 0,a),s.program.__SPECTOR_rebuildProgram=r},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){e.isParallelCompiled?e.onCompiled=t:t()},e.prototype.getUniforms=function(e,t){for(var n=new Array,i=e,r=0;r<t.length;r++)n.push(this._gl.getUniformLocation(i.program,t[r]));return n},e.prototype.getAttributes=function(e,t){for(var n=[],i=e,r=0;r<t.length;r++)try{n.push(this._gl.getAttribLocation(i.program,t[r]))}catch(e){n.push(-1)}return n},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},e.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},e.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},e.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},e.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},e.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},e.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},e.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},e.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},e.prototype.setFloat2=function(e,t,n){e&&this._gl.uniform2f(e,t,n)},e.prototype.setFloat3=function(e,t,n,i){e&&this._gl.uniform3f(e,t,n,i)},e.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat4=function(e,t,n,i,r){e&&this._gl.uniform4f(e,t,n,i,r)},e.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},e.prototype.setColor4=function(e,t,n){e&&this._gl.uniform4f(e,t.r,t.g,t.b,n)},e.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},e.prototype.setState=function(e,t,n,i){void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||n)&&(this._depthCullingState.cull=e);var r=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==r||n)&&(this._depthCullingState.cullFace=r),this.setZOffset(t);var o=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==o||n)&&(this._depthCullingState.frontFace=o)},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},e.prototype.getZOffset=function(){return this._depthCullingState.zOffset},e.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},e.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},e.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},e.prototype.getColorWrite=function(){return this._colorWrite},e.prototype.setAlphaConstants=function(e,t,n,i){this._alphaState.setAlphaBlendConstants(e,t,n,i)},e.prototype.setAlphaMode=function(t,n){if(void 0===n&&(n=!1),this._alphaMode!==t){switch(t){case e.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case e.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}n||this.setDepthWrite(t===e.ALPHA_DISABLE),this._alphaMode=t}},e.prototype.getAlphaMode=function(){return this._alphaMode},e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},e.prototype.setTextureFormatToUse=function(e){for(var t=0,n=this.texturesSupported.length;t<n;t++)for(var i=0,r=e.length;i<r;i++)if(this._texturesSupported[t]===e[i].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},e.prototype._getSamplingParameters=function(t,n){var i=this._gl,r=i.NEAREST,o=i.NEAREST;switch(t){case e.TEXTURE_BILINEAR_SAMPLINGMODE:r=i.LINEAR,o=n?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case e.TEXTURE_TRILINEAR_SAMPLINGMODE:r=i.LINEAR,o=n?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case e.TEXTURE_NEAREST_SAMPLINGMODE:r=i.NEAREST,o=n?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case e.TEXTURE_NEAREST_NEAREST_MIPNEAREST:r=i.NEAREST,o=n?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case e.TEXTURE_NEAREST_LINEAR_MIPNEAREST:r=i.NEAREST,o=n?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR_MIPLINEAR:r=i.NEAREST,o=n?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR:r=i.NEAREST,o=i.LINEAR;break;case e.TEXTURE_NEAREST_NEAREST:r=i.NEAREST,o=i.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPNEAREST:r=i.LINEAR,o=n?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPLINEAR:r=i.LINEAR,o=n?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case e.TEXTURE_LINEAR_LINEAR:r=i.LINEAR,o=i.LINEAR;break;case e.TEXTURE_LINEAR_NEAREST:r=i.LINEAR,o=i.NEAREST}return{min:o,mag:r}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,n,i,r,o,a,s,c,u,h,d,p){var g=this;void 0===o&&(o=e.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===p&&(p=[]);for(var m=String(t),_="data:"===m.substr(0,5),v="blob:"===m.substr(0,5),b=_&&-1!==m.indexOf(";base64,"),y=u||new f.a(this,f.a.DATASOURCE_URL),T=m.lastIndexOf("."),E=d||(T>-1?m.substring(T).toLowerCase():""),x=null,C=0,S=e._TextureLoaders;C<S.length;C++){var A=S[C];if(-1===p.indexOf(A)&&A.canLoad(E,this._textureFormatInUse,u,b,!!c)){x=A;break}}x&&(m=x.transformUrl(m,this._textureFormatInUse)),r&&r._addPendingData(y),y.url=m,y.generateMipMaps=!n,y.samplingMode=o,y.invertY=i,this._doNotHandleContextLost||(y._buffer=c);var P=null;a&&!u&&(P=y.onLoadedObservable.add(a)),u||this._internalTexturesCache.push(y);var R=function(e,i){r&&r._removePendingData(y);var a=!1;x&&x.getFallbackTextureUrl(m,g._textureFormatInUse)&&(a=!0,p.push(x),l.h.Warn(x.constructor.name+" failed when trying to load "+y.url+", falling back to the next supported loader"),g.createTexture(t,n,y.invertY,r,o,null,null,c,y,void 0,void 0,p)),a||(P&&y.onLoadedObservable.remove(P),l.h.UseFallbackTexture&&g.createTexture(l.h.fallbackTexture,n,y.invertY,r,o,null,null,c,y)),s&&s(e||"Unknown error",i)};if(x){var M=function(e){x.loadData(e,y,function(e,t,n,i,a,s){s?R("TextureLoader failed to load data"):g._prepareWebGLTexture(y,r,e,t,y.invertY,!n,i,function(){return a(),!1},o)})};c?M(c):this._loadFile(m,M,void 0,r?r.offlineProvider:void 0,!0,function(e,t){R("Unable to load "+t)})}else{var O=function(t){v&&!g._doNotHandleContextLost&&(y._buffer=t),g._prepareWebGLTexture(y,r,t.width,t.height,y.invertY,n,!1,function(n,i,o){var a=g._gl,s=t.width===n&&t.height===i,l=h?g._getInternalFormat(h):".jpg"===E?a.RGB:a.RGBA;if(s)return a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,t),!1;var c=g._caps.maxTextureSize;if(t.width>c||t.height>c||null===e._RescalePostProcessFactory)return g._prepareWorkingCanvas(),!(!g._workingCanvas||!g._workingContext||(g._workingCanvas.width=n,g._workingCanvas.height=i,g._workingContext.drawImage(t,0,0,t.width,t.height,0,0,n,i),a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,g._workingCanvas),y.width=n,y.height=i,1));var u=new f.a(g,f.a.DATASOURCE_TEMP);return g._bindTextureDirectly(a.TEXTURE_2D,u,!0),a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),g._rescaleTexture(u,y,r,l,function(){g._releaseTexture(u),g._bindTextureDirectly(a.TEXTURE_2D,y,!0),o()}),!0},o)};!_||b?c instanceof HTMLImageElement?O(c):l.h.LoadImage(m,O,R,r?r.offlineProvider:null):"string"==typeof c||c instanceof ArrayBuffer||c instanceof Blob?l.h.LoadImage(c,O,R,r?r.offlineProvider:null):O(c)}return y},e.prototype._rescaleTexture=function(t,n,i,r,o){var a=this,s=this.createRenderTargetTexture({width:n.width,height:n.height},{generateMipMaps:!1,type:e.TEXTURETYPE_UNSIGNED_INT,samplingMode:e.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){a._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=i;e||(e=a.scenes[a.scenes.length-1]),e.postProcessManager.directRender([a._rescalePostProcess],s,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,n,!0),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,r,0,0,n.width,n.height,0),a.unBindFramebuffer(s),a._releaseTexture(s),o&&o()})},e.prototype.createRawTexture=function(t,n,i,r,o,a,s,l,c){throw void 0===l&&(l=null),void 0===c&&(c=e.TEXTURETYPE_UNSIGNED_INT),y.a.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype.createDynamicTexture=function(e,t,n,i){var r=new f.a(this,f.a.DATASOURCE_DYNAMIC);return r.baseWidth=e,r.baseHeight=t,n&&(e=this.needPOTTextures?l.h.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?l.h.GetExponentOfTwo(t,this._caps.maxTextureSize):t),r.width=e,r.height=t,r.isReady=!1,r.generateMipMaps=n,r.samplingMode=i,this.updateTextureSamplingMode(i,r),this._internalTexturesCache.push(r),r},e.prototype.updateTextureSamplingMode=function(e,t){var n=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},e.prototype.updateDynamicTexture=function(e,t,n,i,r,o){if(void 0===i&&(i=!1),void 0===o&&(o=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,o),this._unpackFlipY(n),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var a=r?this._getInternalFormat(r):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},e.prototype.updateVideoTexture=function(e,t,n){if(e&&!e._isDisabled){var i=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!n);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._videoTextureSupported=0===this._gl.getError()),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var r=e._workingCanvas.getContext("2d");if(!r)throw new Error("Unable to get 2d context");e._workingContext=r,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),i||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}},e.prototype.updateTextureComparisonFunction=function(t,n){if(1!==this.webGLVersion){var i=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===n?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,e.LEQUAL),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,n),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===n?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,e.LEQUAL),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=n}else _.a.Error("WebGL 1 does not support texture comparison.")},e.prototype._setupDepthStencilTexture=function(t,n,i,r,o){var a=n.width||n,s=n.height||n;t.baseWidth=a,t.baseHeight=s,t.width=a,t.height=s,t.isReady=!0,t.samples=1,t.generateMipMaps=!1,t._generateDepthBuffer=!0,t._generateStencilBuffer=i,t.samplingMode=r?e.TEXTURE_BILINEAR_SAMPLINGMODE:e.TEXTURE_NEAREST_SAMPLINGMODE,t.type=e.TEXTURETYPE_UNSIGNED_INT,t._comparisonFunction=o;var l=this._gl,c=t.isCube?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D,u=this._getSamplingParameters(t.samplingMode,!1);l.texParameteri(c,l.TEXTURE_MAG_FILTER,u.mag),l.texParameteri(c,l.TEXTURE_MIN_FILTER,u.min),l.texParameteri(c,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(c,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),0===o?(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,e.LEQUAL),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,o),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},e.prototype.createDepthStencilTexture=function(e,t){return t.isCube?this._createDepthStencilCubeTexture(e.width||e,t):this._createDepthStencilTexture(e,t)},e.prototype._createDepthStencilTexture=function(e,t){var n=new f.a(this,f.a.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return _.a.Error("Depth texture is not supported by your browser or hardware."),n;var r=i.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),o=this._gl;return this._bindTextureDirectly(o.TEXTURE_2D,n,!0),this._setupDepthStencilTexture(n,e,r.generateStencil,r.bilinearFiltering,r.comparisonFunction),this.webGLVersion>1?r.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH24_STENCIL8,n.width,n.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT24,n.width,n.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null):r.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_STENCIL,n.width,n.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT,n.width,n.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null),this._bindTextureDirectly(o.TEXTURE_2D,null),n},e.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var n=this._gl,i=e.depthStencilTexture;this._bindUnboundFramebuffer(t._framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,i._generateStencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,i.isCube?n.TEXTURE_CUBE_MAP_POSITIVE_X:n.TEXTURE_2D,i._webGLTexture,0),this._bindUnboundFramebuffer(null)}},e.prototype.createRenderTargetTexture=function(t,n){var i=new b.a;void 0!==n&&"object"==typeof n?(i.generateMipMaps=n.generateMipMaps,i.generateDepthBuffer=void 0===n.generateDepthBuffer||n.generateDepthBuffer,i.generateStencilBuffer=i.generateDepthBuffer&&n.generateStencilBuffer,i.type=void 0===n.type?e.TEXTURETYPE_UNSIGNED_INT:n.type,i.samplingMode=void 0===n.samplingMode?e.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,i.format=void 0===n.format?e.TEXTUREFORMAT_RGBA:n.format):(i.generateMipMaps=n,i.generateDepthBuffer=!0,i.generateStencilBuffer=!1,i.type=e.TEXTURETYPE_UNSIGNED_INT,i.samplingMode=e.TEXTURE_TRILINEAR_SAMPLINGMODE,i.format=e.TEXTUREFORMAT_RGBA),(i.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(i.type!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=e.TEXTURE_NEAREST_SAMPLINGMODE);var r=this._gl,o=new f.a(this,f.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(r.TEXTURE_2D,o,!0);var a=t.width||t,s=t.height||t,l=this._getSamplingParameters(i.samplingMode,!!i.generateMipMaps);i.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(i.type=e.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,l.mag),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,l.min),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),a,s,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);var c=this._currentFramebuffer,u=r.createFramebuffer();return this._bindUnboundFramebuffer(u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o._webGLTexture,0),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!i.generateStencilBuffer,i.generateDepthBuffer,a,s),i.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),this._bindUnboundFramebuffer(c),o._framebuffer=u,o.baseWidth=a,o.baseHeight=s,o.width=a,o.height=s,o.isReady=!0,o.samples=1,o.generateMipMaps=!!i.generateMipMaps,o.samplingMode=i.samplingMode,o.type=i.type,o.format=i.format,o._generateDepthBuffer=i.generateDepthBuffer,o._generateStencilBuffer=!!i.generateStencilBuffer,this._internalTexturesCache.push(o),o},e.prototype._setupFramebufferDepthAttachments=function(e,t,n,i,r){void 0===r&&(r=1);var o=null,a=this._gl;return e?(o=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,o),r>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,a.DEPTH24_STENCIL8,n,i):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,n,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,o)):t&&(o=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,o),r>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,a.DEPTH_COMPONENT16,n,i):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,n,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o)),o},e.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var n=this._gl;if(t=Math.min(t,n.getParameter(n.MAX_SAMPLES)),e._depthStencilBuffer&&(n.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(n.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(n.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var i=n.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=i,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var r=n.createRenderbuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,r),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r),e._MSAARenderBuffer=r}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),n.bindRenderbuffer(n.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),t},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,n,i,r,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var s=this._gl,l=s.TEXTURE_2D;e.isCube&&(l=s.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(l,a,t,n,i,0,r)},e.prototype._uploadDataToTextureDirectly=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=this._gl,o=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,a);this._unpackFlipY(e.invertY);var l=r.TEXTURE_2D;e.isCube&&(l=r.TEXTURE_CUBE_MAP_POSITIVE_X+n);var c=Math.round(u.a.Log2(e.width)),h=Math.round(u.a.Log2(e.height)),d=Math.pow(2,Math.max(c-i,0)),f=Math.pow(2,Math.max(h-i,0));r.texImage2D(l,i,s,d,f,0,a,o,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=this._gl,o=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,n,i),this._bindTextureDirectly(o,null,!0)},e.prototype._uploadImageToTexture=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=this._gl,o=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,a),l=e.isCube?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);var c=r.TEXTURE_2D;e.isCube&&(c=r.TEXTURE_CUBE_MAP_POSITIVE_X+n),r.texImage2D(c,i,s,a,o,t),this._bindTextureDirectly(l,null,!0)},e.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},e.prototype.createRawCubeTexture=function(e,t,n,i,r,o,a,s){throw void 0===s&&(s=null),y.a.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(t,n,i,r,o,a,s,l,c,u){throw void 0===c&&(c=null),void 0===u&&(u=e.TEXTURETYPE_UNSIGNED_INT),y.a.WarnImport("Engine.RawTexture")},e.prototype._prepareWebGLTextureContinuation=function(e,t,n,i,r){var o=this._gl;if(o){var a=this._getSamplingParameters(r,!n);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,a.min),n||i||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,n,i,r,o,a,s,c,u){var h=this;void 0===u&&(u=e.TEXTURE_TRILINEAR_SAMPLINGMODE);var d=this.getCaps().maxTextureSize,f=Math.min(d,this.needPOTTextures?l.h.GetExponentOfTwo(i,d):i),p=Math.min(d,this.needPOTTextures?l.h.GetExponentOfTwo(r,d):r),g=this._gl;g&&(t._webGLTexture?(this._bindTextureDirectly(g.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=i,t.baseHeight=r,t.width=f,t.height=p,t.isReady=!0,c(f,p,function(){h._prepareWebGLTextureContinuation(t,n,a,s,u)})||this._prepareWebGLTextureContinuation(t,n,a,s,u)):n&&n._removePendingData(t))},e.prototype._convertRGBtoRGBATextureData=function(t,n,i,r){var o;o=r===e.TEXTURETYPE_FLOAT?new Float32Array(n*i*4):new Uint32Array(n*i*4);for(var a=0;a<n;a++)for(var s=0;s<i;s++){var l=3*(s*n+a),c=4*(s*n+a);o[c+0]=t[l+0],o[c+1]=t[l+1],o[c+2]=t[l+2],o[c+3]=1}return o},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var n=this._internalTexturesCache.indexOf(e);-1!==n&&this._internalTexturesCache.splice(n,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),this.scenes.forEach(function(t){t.postProcesses.forEach(function(t){t._outputTexture==e&&(t._outputTexture=null)}),t.cameras.forEach(function(t){t._postProcesses.forEach(function(t){t&&t._outputTexture==e&&(t._outputTexture=null)})})})},e.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this.setProgram(t.program);for(var n=e.getSamplers(),i=0;i<n.length;i++){var r=e.getUniform(n[i]);r&&(this._boundUniforms[i]=r)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var r=!1,o=t&&t._associatedChannel>-1;return n&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),this._gl.bindTexture(e,t&&t.isMultiview?t?t._colorTextureArray:null:t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):n&&(r=!0,this._activateCurrentTexture()),o&&!n&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),r},e.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},e.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},e.prototype.setTexture=function(e,t,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,n))},e.prototype.setDepthStencilTexture=function(e,t,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),n&&n.depthStencilTexture?this._setTexture(e,n,!1,!0):this._setTexture(e,null))},e.prototype._bindSamplerUniformToChannel=function(e,t){var n=this._boundUniforms[e];n._currentState!==t&&(this._gl.uniform1i(n,t),n._currentState=t)},e.prototype._getTextureWrapMode=function(t){switch(t){case e.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case e.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case e.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(t,n,i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!1),!n)return null!=this._boundTexturesCache[t]&&(this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(n.video)this._activeChannel=t,n.update();else if(n.delayLoadState===e.DELAYLOADSTATE_NOTLOADED)return n.delayLoad(),!1;var o;o=r?n.depthStencilTexture:n.isReady()?n.getInternalTexture():n.isCube?this.emptyCubeTexture:n.is3D?this.emptyTexture3D:this.emptyTexture,!i&&o&&(o._associatedChannel=t);var a=!0;if(this._boundTexturesCache[t]===o&&(i||this._bindSamplerUniformToChannel(o._associatedChannel,t),a=!1),this._activeChannel=t,o&&o.isMultiview)a&&this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,o,i);else if(o&&o.is3D)a&&this._bindTextureDirectly(this._gl.TEXTURE_3D,o,i),o&&o._cachedWrapU!==n.wrapU&&(o._cachedWrapU=n.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(n.wrapU),o)),o&&o._cachedWrapV!==n.wrapV&&(o._cachedWrapV=n.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(n.wrapV),o)),o&&o._cachedWrapR!==n.wrapR&&(o._cachedWrapR=n.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n.wrapR),o)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,n);else if(o&&o.isCube){if(a&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o,i),o._cachedCoordinatesMode!==n.coordinatesMode){o._cachedCoordinatesMode=n.coordinatesMode;var s=n.coordinatesMode!==e.TEXTURE_CUBIC_MODE&&n.coordinatesMode!==e.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s,o),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,n)}else a&&this._bindTextureDirectly(this._gl.TEXTURE_2D,o,i),o&&o._cachedWrapU!==n.wrapU&&(o._cachedWrapU=n.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(n.wrapU),o)),o&&o._cachedWrapV!==n.wrapV&&(o._cachedWrapV=n.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(n.wrapV),o)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,n);return!0},e.prototype.setTextureArray=function(e,t,n){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===n.length||(this._textureUnits=new Int32Array(n.length));for(var i=0;i<n.length;i++){var r=n[i].getInternalTexture();r?(this._textureUnits[e+i]=e+i,r._associatedChannel=e+i):this._textureUnits[e+i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<n.length;o++)this._setTexture(this._textureUnits[o],n[o],!0)}},e.prototype._setAnisotropicLevel=function(t,n){var i=n.getInternalTexture();if(i){var r=this._caps.textureAnisotropicFilterExtension,o=n.anisotropicFilteringLevel;i.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&i.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&i.samplingMode!==e.TEXTURE_LINEAR_LINEAR&&(o=1),r&&i._cachedAnisotropicFilteringLevel!==o&&(this._setTextureParameterFloat(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o,this._caps.maxAnisotropy),i),i._cachedAnisotropicFilteringLevel=o)}},e.prototype._setTextureParameterFloat=function(e,t,n,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,n)},e.prototype._setTextureParameterInteger=function(e,t,n,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,n)},e.prototype.readPixels=function(e,t,n,i){var r=new Uint8Array(i*n*4);return this._gl.readPixels(e,t,n,i,this._gl.RGBA,this._gl.UNSIGNED_BYTE,r),r},e.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new a.a),this._externalData.add(e,t)},e.prototype.getExternalData=function(e){return this._externalData||(this._externalData=new a.a),this._externalData.get(e)},e.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new a.a),this._externalData.getOrAddWithFactory(e,t)},e.prototype.removeExternalData=function(e){return this._externalData||(this._externalData=new a.a),this._externalData.remove(e)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===e.Instances.length&&e.audioEngine&&e.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),m.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange));var t=e.Instances.indexOf(this);t>=0&&e.Instances.splice(t,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),h.a.ResetCache();for(var n=0,i=this._activeRequests;n<i.length;n++)i[n].abort()},e.prototype.displayLoadingUI=function(){if(m.a.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},e.prototype.hideLoadingUI=function(){if(m.a.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},e.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},e.prototype.getError=function(){return this._gl.getError()},e.prototype.getFps=function(){return this._fps},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},e.prototype._readTexturePixels=function(e,t,n,i,r,o){void 0===i&&(i=-1),void 0===r&&(r=0),void 0===o&&(o=null);var a=this._gl;if(!this._dummyFramebuffer){var s=a.createFramebuffer();if(!s)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=s}a.bindFramebuffer(a.FRAMEBUFFER,this._dummyFramebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,i>-1?a.TEXTURE_CUBE_MAP_POSITIVE_X+i:a.TEXTURE_2D,e._webGLTexture,r);var l=void 0!==e.type?this._getWebGLTextureType(e.type):a.UNSIGNED_BYTE;switch(l){case a.UNSIGNED_BYTE:o||(o=new Uint8Array(4*t*n)),l=a.UNSIGNED_BYTE;break;default:o||(o=new Float32Array(4*t*n)),l=a.FLOAT}return a.readPixels(0,0,t,n,a.RGBA,l,o),a.bindFramebuffer(a.FRAMEBUFFER,this._currentFramebuffer),o},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_FLOAT)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_HALF_FLOAT)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var n=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((n=(n=n&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),n=n&&t.getError()===t.NO_ERROR),n){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,s=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,a,s,l),n=n&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(r),t.bindFramebuffer(t.FRAMEBUFFER,null);!n&&t.getError()!==t.NO_ERROR;);return n},e.prototype._getWebGLTextureType=function(t){if(1===this._webGLVersion){switch(t){case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(t){case e.TEXTURETYPE_BYTE:return this._gl.BYTE;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case e.TEXTURETYPE_SHORT:return this._gl.SHORT;case e.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case e.TEXTURETYPE_INT:return this._gl.INT;case e.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case e.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(t){var n=this._gl.RGBA;switch(t){case e.TEXTUREFORMAT_ALPHA:n=this._gl.ALPHA;break;case e.TEXTUREFORMAT_LUMINANCE:n=this._gl.LUMINANCE;break;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:n=this._gl.LUMINANCE_ALPHA;break;case e.TEXTUREFORMAT_RED:n=this._gl.RED;break;case e.TEXTUREFORMAT_RG:n=this._gl.RG;break;case e.TEXTUREFORMAT_RGB:n=this._gl.RGB;break;case e.TEXTUREFORMAT_RGBA:n=this._gl.RGBA}if(this._webGLVersion>1)switch(t){case e.TEXTUREFORMAT_RED_INTEGER:n=this._gl.RED_INTEGER;break;case e.TEXTUREFORMAT_RG_INTEGER:n=this._gl.RG_INTEGER;break;case e.TEXTUREFORMAT_RGB_INTEGER:n=this._gl.RGB_INTEGER;break;case e.TEXTUREFORMAT_RGBA_INTEGER:n=this._gl.RGBA_INTEGER}return n},e.prototype._getRGBABufferInternalSizedFormat=function(t,n){if(1===this._webGLVersion){if(void 0!==n)switch(n){case e.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case e.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(t){case e.TEXTURETYPE_BYTE:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case e.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case e.TEXTURETYPE_UNSIGNED_BYTE:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R8;case e.TEXTUREFORMAT_RG:return this._gl.RG8;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8;case e.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case e.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case e.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case e.TEXTURETYPE_SHORT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case e.TEXTURETYPE_UNSIGNED_SHORT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case e.TEXTURETYPE_INT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case e.TEXTURETYPE_UNSIGNED_INTEGER:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case e.TEXTURETYPE_FLOAT:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R32F;case e.TEXTUREFORMAT_RG:return this._gl.RG32F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case e.TEXTURETYPE_HALF_FLOAT:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R16F;case e.TEXTUREFORMAT_RG:return this._gl.RG16F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(n){case e.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(t){return t===e.TEXTURETYPE_FLOAT?this._gl.RGBA32F:t===e.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(e,t,n,i,r,o){var a=this,s=l.h.LoadFile(e,t,n,i,r,o);return this._activeRequests.push(s),s.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),s},e.prototype._loadFileAsync=function(e,t,n){var i=this;return new Promise(function(r,o){i._loadFile(e,function(e){r(e)},void 0,t,n,function(e,t){o(t)})})},e.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.ALPHA_DISABLE=g.a.ALPHA_DISABLE,e.ALPHA_ADD=g.a.ALPHA_ADD,e.ALPHA_COMBINE=g.a.ALPHA_COMBINE,e.ALPHA_SUBTRACT=g.a.ALPHA_SUBTRACT,e.ALPHA_MULTIPLY=g.a.ALPHA_MULTIPLY,e.ALPHA_MAXIMIZED=g.a.ALPHA_MAXIMIZED,e.ALPHA_ONEONE=g.a.ALPHA_ONEONE,e.ALPHA_PREMULTIPLIED=g.a.ALPHA_PREMULTIPLIED,e.ALPHA_PREMULTIPLIED_PORTERDUFF=g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,e.ALPHA_INTERPOLATE=g.a.ALPHA_INTERPOLATE,e.ALPHA_SCREENMODE=g.a.ALPHA_SCREENMODE,e.DELAYLOADSTATE_NONE=g.a.DELAYLOADSTATE_NONE,e.DELAYLOADSTATE_LOADED=g.a.DELAYLOADSTATE_LOADED,e.DELAYLOADSTATE_LOADING=g.a.DELAYLOADSTATE_LOADING,e.DELAYLOADSTATE_NOTLOADED=g.a.DELAYLOADSTATE_NOTLOADED,e.NEVER=g.a.NEVER,e.ALWAYS=g.a.ALWAYS,e.LESS=g.a.LESS,e.EQUAL=g.a.EQUAL,e.LEQUAL=g.a.LEQUAL,e.GREATER=g.a.GREATER,e.GEQUAL=g.a.GEQUAL,e.NOTEQUAL=g.a.NOTEQUAL,e.KEEP=g.a.KEEP,e.REPLACE=g.a.REPLACE,e.INCR=g.a.INCR,e.DECR=g.a.DECR,e.INVERT=g.a.INVERT,e.INCR_WRAP=g.a.INCR_WRAP,e.DECR_WRAP=g.a.DECR_WRAP,e.TEXTURE_CLAMP_ADDRESSMODE=g.a.TEXTURE_CLAMP_ADDRESSMODE,e.TEXTURE_WRAP_ADDRESSMODE=g.a.TEXTURE_WRAP_ADDRESSMODE,e.TEXTURE_MIRROR_ADDRESSMODE=g.a.TEXTURE_MIRROR_ADDRESSMODE,e.TEXTUREFORMAT_ALPHA=g.a.TEXTUREFORMAT_ALPHA,e.TEXTUREFORMAT_LUMINANCE=g.a.TEXTUREFORMAT_LUMINANCE,e.TEXTUREFORMAT_LUMINANCE_ALPHA=g.a.TEXTUREFORMAT_LUMINANCE_ALPHA,e.TEXTUREFORMAT_RGB=g.a.TEXTUREFORMAT_RGB,e.TEXTUREFORMAT_RGBA=g.a.TEXTUREFORMAT_RGBA,e.TEXTUREFORMAT_RED=g.a.TEXTUREFORMAT_RED,e.TEXTUREFORMAT_R=g.a.TEXTUREFORMAT_R,e.TEXTUREFORMAT_RG=g.a.TEXTUREFORMAT_RG,e.TEXTUREFORMAT_RED_INTEGER=g.a.TEXTUREFORMAT_RED_INTEGER,e.TEXTUREFORMAT_R_INTEGER=g.a.TEXTUREFORMAT_R_INTEGER,e.TEXTUREFORMAT_RG_INTEGER=g.a.TEXTUREFORMAT_RG_INTEGER,e.TEXTUREFORMAT_RGB_INTEGER=g.a.TEXTUREFORMAT_RGB_INTEGER,e.TEXTUREFORMAT_RGBA_INTEGER=g.a.TEXTUREFORMAT_RGBA_INTEGER,e.TEXTURETYPE_UNSIGNED_BYTE=g.a.TEXTURETYPE_UNSIGNED_BYTE,e.TEXTURETYPE_UNSIGNED_INT=g.a.TEXTURETYPE_UNSIGNED_INT,e.TEXTURETYPE_FLOAT=g.a.TEXTURETYPE_FLOAT,e.TEXTURETYPE_HALF_FLOAT=g.a.TEXTURETYPE_HALF_FLOAT,e.TEXTURETYPE_BYTE=g.a.TEXTURETYPE_BYTE,e.TEXTURETYPE_SHORT=g.a.TEXTURETYPE_SHORT,e.TEXTURETYPE_UNSIGNED_SHORT=g.a.TEXTURETYPE_UNSIGNED_SHORT,e.TEXTURETYPE_INT=g.a.TEXTURETYPE_INT,e.TEXTURETYPE_UNSIGNED_INTEGER=g.a.TEXTURETYPE_UNSIGNED_INTEGER,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=g.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=g.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=g.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,e.TEXTURETYPE_UNSIGNED_INT_24_8=g.a.TEXTURETYPE_UNSIGNED_INT_24_8,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=g.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=g.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=g.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,e.TEXTURE_NEAREST_SAMPLINGMODE=g.a.TEXTURE_NEAREST_SAMPLINGMODE,e.TEXTURE_BILINEAR_SAMPLINGMODE=g.a.TEXTURE_BILINEAR_SAMPLINGMODE,e.TEXTURE_TRILINEAR_SAMPLINGMODE=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=g.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=g.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=g.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=g.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=g.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=g.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_LINEAR=g.a.TEXTURE_NEAREST_LINEAR,e.TEXTURE_NEAREST_NEAREST=g.a.TEXTURE_NEAREST_NEAREST,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=g.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=g.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR=g.a.TEXTURE_LINEAR_LINEAR,e.TEXTURE_LINEAR_NEAREST=g.a.TEXTURE_LINEAR_NEAREST,e.TEXTURE_EXPLICIT_MODE=g.a.TEXTURE_EXPLICIT_MODE,e.TEXTURE_SPHERICAL_MODE=g.a.TEXTURE_SPHERICAL_MODE,e.TEXTURE_PLANAR_MODE=g.a.TEXTURE_PLANAR_MODE,e.TEXTURE_CUBIC_MODE=g.a.TEXTURE_CUBIC_MODE,e.TEXTURE_PROJECTION_MODE=g.a.TEXTURE_PROJECTION_MODE,e.TEXTURE_SKYBOX_MODE=g.a.TEXTURE_SKYBOX_MODE,e.TEXTURE_INVCUBIC_MODE=g.a.TEXTURE_INVCUBIC_MODE,e.TEXTURE_EQUIRECTANGULAR_MODE=g.a.TEXTURE_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=g.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,e.SCALEMODE_FLOOR=g.a.SCALEMODE_FLOOR,e.SCALEMODE_NEAREST=g.a.SCALEMODE_NEAREST,e.SCALEMODE_CEILING=g.a.SCALEMODE_CEILING,e.CollisionsEpsilon=.001,e._RescalePostProcessFactory=null,e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return A}),n.d(t,"c",function(){return R}),n.d(t,"a",function(){return O});var i=n(1),r=n(8),o=n(9),a=n(32),s=n(29),l=n(0),c=n(25),u=n(4),h=n(13),d=n(57),f=n(24),p=n(49),g=n(43),m=n(20),_=n(66),v=n(55),b=n(3),y=n(2),T=n(6),E=n(22),x=n(19),C=n(14),S=n(110),A=function(){},P=function(){this.visibleInstances={},this.batchCache=new R,this.instancesBufferSize=2048},R=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},M=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},O=function(e){function t(n,i,r,o,l,c){void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===c&&(c=!0);var u=e.call(this,n,i)||this;if(u._internalMeshDataInfo=new M,u.delayLoadState=b.a.DELAYLOADSTATE_NONE,u.instances=new Array,u._creationDataStorage=null,u._geometry=null,u._instanceDataStorage=new P,u._effectiveMaterial=null,u._shouldGenerateFlatShading=!1,u._originalBuilderSideOrientation=t.DEFAULTSIDE,u.overrideMaterialSideOrientation=null,i=u.getScene(),o){if(o._geometry&&o._geometry.applyToMesh(u),a.a.DeepCopy(o,u,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),u._internalMeshDataInfo._source=o,i.useClonedMeshhMap&&(o._internalMeshDataInfo.meshMap||(o._internalMeshDataInfo.meshMap={}),o._internalMeshDataInfo.meshMap[u.uniqueId]=u),u._originalBuilderSideOrientation=o._originalBuilderSideOrientation,u._creationDataStorage=o._creationDataStorage,o._ranges){var h=o._ranges;for(var n in h)h.hasOwnProperty(n)&&h[n]&&u.createAnimationRange(n,h[n].from,h[n].to)}var d;if(u.metadata=o.metadata&&o.metadata.clone?o.metadata.clone():o.metadata,s.a&&s.a.HasTags(o)&&s.a.AddTagsTo(u,s.a.GetTags(o,!0)),u.parent=o.parent,u.setPivotMatrix(o.getPivotMatrix()),u.id=n+"."+o.id,u.material=o.material,!l)for(var f=o.getDescendants(!0),p=0;p<f.length;p++){var g=f[p];g.clone&&g.clone(n+"."+g.name,u)}if(i.getPhysicsEngine){var m=i.getPhysicsEngine();if(c&&m){var _=m.getImpostorForPhysicsObject(o);_&&(u.physicsImpostor=_.clone(u))}}for(d=0;d<i.particleSystems.length;d++){var v=i.particleSystems[d];v.emitter===o&&v.clone(v.name,u)}u.refreshBoundingInfo(),u.computeWorldMatrix(!0)}return null!==r&&(u.parent=r),u._instanceDataStorage.hardwareInstancedRendering=u.getEngine().getCaps().instancedArrays,u}return i.d(t,e),t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new r.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new r.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new r.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new r.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){var n=e.prototype.toString.call(this,t);if(n+=", n vertices: "+this.getTotalVertices(),n+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)n+=", animation[0]: "+this.animations[i].toString(t);if(t)if(this._geometry){var r=this.getIndices(),o=this.getVerticesData(u.b.PositionKind);o&&r&&(n+=", flat shading: "+(o.length/3===r.length?"YES":"NO"))}else n+=", flat shading: UNKNOWN";return n},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,n=this.instances;t<n.length;t++)n[t]._unBindEffect()},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return T.a.Warn("You cannot use a mesh as LOD level twice"),this;var n=new S.a(e,t);return this._internalMeshDataInfo._LODLevels.push(n),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,n=0;n<t._LODLevels.length;n++){var i=t._LODLevels[n];if(i.distance===e)return i.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,n=0;n<t._LODLevels.length;n++)t._LODLevels[n].mesh===e&&(t._LODLevels.splice(n,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){var n=this._internalMeshDataInfo;if(!n._LODLevels||0===n._LODLevels.length)return this;var i=(t||this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length();if(n._LODLevels[n._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,n._LODLevels[n._LODLevels.length-1].mesh),this;for(var r=0;r<n._LODLevels.length;r++){var o=n._LODLevels[r];if(o.distance<i)return o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,o.mesh),o.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return null==this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,n){return this._geometry?this._geometry.getVerticesData(e,t,n):null},t.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!=this._masterMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),this.delayLoadState===b.a.DELAYLOADSTATE_LOADING)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var i=this.getEngine(),r=this.getScene(),o=n||i.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var a=this.material||r.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(var s=0,l=this.subMeshes;s<l.length;s++){var c=(g=l[s]).getMaterial();if(c)if(c._storeEffectOnSubMeshes){if(!c.isReadyForSubMesh(this,g,o))return!1}else if(!c.isReady(this,o))return!1}else if(!a.isReady(this,o))return!1;for(var u=0,h=this.lightSources;u<h.length;u++){var d=h[u].getShadowGenerator();if(d)for(var f=0,p=this.subMeshes;f<p.length;f++){var g=p[f];if(!d.isReady(g,o))return!1}}for(var m=0,_=this._internalMeshDataInfo._LODLevels;m<_.length;m++){var v=_[m];if(v.mesh&&!v.mesh.isReady(o))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t?this:(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var n=this.getIndices();if(!n)return null;var i=n.length,r=!1;if(e)r=!0;else for(var o=0,a=this.subMeshes;o<a.length;o++){var s=a[o];if(s.indexStart+s.indexCount>=i){r=!0;break}if(s.verticesStart+s.verticesCount>=t){r=!0;break}}if(!r)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.b(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),n=t/e|0,i=0;n%3!=0;)n++;this.releaseSubMeshes();for(var r=0;r<e&&!(i>=t);r++)p.b.CreateFromIndices(0,i,Math.min(n,t-i),this),i+=n;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,n,i){if(void 0===n&&(n=!1),this._geometry)this._geometry.setVerticesData(e,t,n,i);else{var r=new h.a;r.set(t,e);var o=this.getScene();new d.a(d.a.RandomId(),o,r,n,this)}return this},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var n=this.getVertexBuffer(e);n&&n.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=d.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},t.prototype.updateVerticesData=function(e,t,n,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,n,!1)):this._geometry.updateVerticesData(e,t,n),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var n=this.getVerticesData(u.b.PositionKind);if(!n)return this;if(e(n),this.updateVerticesData(u.b.PositionKind,n,!1,!1),t){var i=this.getIndices(),r=this.getVerticesData(u.b.NormalKind);if(!r)return this;h.a.ComputeNormals(n,i,r),this.updateVerticesData(u.b.NormalKind,r,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(d.a.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=!1),this._geometry)this._geometry.setIndices(e,t,n);else{var i=new h.a;i.indices=e;var r=this.getScene();new d.a(d.a.RandomId(),r,i,n,this)}return this},t.prototype.updateIndices=function(e,t,n){return void 0===n&&(n=!1),this._geometry?(this._geometry.updateIndices(e,t,n),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,n){if(!this._geometry)return this;var i,r=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(n){case m.a.PointFillMode:i=null;break;case m.a.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),r);break;default:case m.a.TriangleFillMode:i=this._geometry.getIndexBuffer()}return this._geometry._bind(t,i),this},t.prototype._draw=function(e,t,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var i=this.getScene().getEngine();return this._unIndexed||t==m.a.PointFillMode?i.drawArraysType(t,e.verticesStart,e.verticesCount,n):t==m.a.WireFrameFillMode?i.drawElementsType(t,0,e._linesIndexCount,n):i.drawElementsType(t,e.indexStart,e.indexCount,n),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e){if(this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var t=this.getScene(),n=t._isInIntermediateRendering(),i=n?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[e]=!i&&this.isEnabled()&&this.isVisible,r.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances){var o=this._instanceDataStorage.visibleInstances,a=t.getRenderId(),s=n?o.intermediateDefaultRenderId:o.defaultRenderId;r.visibleInstances[e]=o[a],!r.visibleInstances[e]&&s&&(r.visibleInstances[e]=o[s])}return r.hardwareInstancedRendering[e]=this._instanceDataStorage.hardwareInstancedRendering&&null!=r.visibleInstances[e],this._instanceDataStorage.previousBatch=r,r},t.prototype._renderWithInstances=function(e,t,n,i,r){var o=n.visibleInstances[e._id];if(!o)return this;for(var a=this._instanceDataStorage,s=a.instancesBufferSize,l=a.instancesBuffer,c=16*(o.length+1)*4;a.instancesBufferSize<c;)a.instancesBufferSize*=2;a.instancesData&&s==a.instancesBufferSize||(a.instancesData=new Float32Array(a.instancesBufferSize/4));var h=0,d=0,f=this._effectiveMesh.getWorldMatrix();if(n.renderSelf[e._id]&&(f.copyToArray(a.instancesData,h),h+=16,d++),o)for(var p=0;p<o.length;p++)o[p].getWorldMatrix().copyToArray(a.instancesData,h),h+=16,d++;return l&&s==a.instancesBufferSize?l.updateDirectly(a.instancesData,0,d):(l&&l.dispose(),l=new u.a(r,a.instancesData,!0,16,!1,!0),a.instancesBuffer=l,this.setVerticesBuffer(l.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(l.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(l.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(l.createVertexBuffer("world3",12,4))),this._bind(e,i,t),this._draw(e,t,d),r.unbindInstanceAttributes(),this},t.prototype._processRendering=function(e,t,n,i,r,o,a){var s=this.getScene().getEngine();if(r)this._renderWithInstances(e,n,i,t,s);else{i.renderSelf[e._id]&&(o&&o(!1,this._effectiveMesh.getWorldMatrix(),a),this._draw(e,n,this._instanceDataStorage.overridenInstanceCount));var l=i.visibleInstances[e._id];if(l)for(var c=0;c<l.length;c++){var u=l[c].getWorldMatrix();o&&o(!0,u,a),this._draw(e,n)}}return this},t.prototype._freeze=function(){if(this._instanceDataStorage.isFrozen=!0,this.subMeshes)for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e)},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1},t.prototype.render=function(e,t){var n=this.getScene();if(n._isInIntermediateRendering()?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var i=this._getInstancesRenderList(e._id);if(i.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var r,o=n.getEngine(),a=i.hardwareInstancedRendering[e._id],s=this._instanceDataStorage,l=e.getMaterial();if(!l)return this;if(!s.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==l)if(this._effectiveMaterial=l,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,e,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;t&&o.setAlphaMode(this._effectiveMaterial.alphaMode);for(var c=0,u=n._beforeRenderingMeshStage;c<u.length;c++)u[c].action(this,e,i);if(!(r=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var h,d=this._effectiveMesh;s.isFrozen?h=s.sideOrientation:(null==(h=this.overrideMaterialSideOrientation)&&(h=this._effectiveMaterial.sideOrientation,d._getWorldMatrixDeterminant()<0&&(h=h===m.a.ClockWiseSideOrientation?m.a.CounterClockWiseSideOrientation:m.a.ClockWiseSideOrientation)),s.sideOrientation=h);var f=this._effectiveMaterial._preBind(r,h);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var p=n.forcePointsCloud?m.a.PointFillMode:n.forceWireframe?m.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),a||this._bind(e,r,p);var g=d.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(g,this,e):this._effectiveMaterial.bind(g,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!f),this._processRendering(e,r,p,i,a,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,f)),this._processRendering(e,r,p,i,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var _=0,v=n._afterRenderingMeshStage;_<v.length;_++)v[_].action(this,e,i);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(e,t,n){e&&n&&n.bindOnlyWorldMatrix(t)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(u.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(u.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(u.b.MatricesWeightsKind),t=e.length,n=0;n<t;n+=4){var i=e[n]+e[n+1]+e[n+2]+e[n+3];if(0===i)e[n]=1;else{var r=1/i;e[n]*=r,e[n+1]*=r,e[n+2]*=r,e[n+3]*=r}}this.setVerticesData(u.b.MatricesWeightsKind,e)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(u.b.MatricesWeightsExtraKind),t=this.getVerticesData(u.b.MatricesWeightsKind),n=t.length,i=0;i<n;i+=4){var r=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(r+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var o=1/r;t[i]*=o,t[i+1]*=o,t[i+2]*=o,t[i+3]*=o,e[i]*=o,e[i+1]*=o,e[i+2]*=o,e[i+3]*=o}}this.setVerticesData(u.b.MatricesWeightsKind,t),this.setVerticesData(u.b.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(u.b.MatricesWeightsExtraKind),t=this.getVerticesData(u.b.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var n=t.length,i=0,r=0,o=0,a=0,s=null===e?4:8,l=new Array,c=0;c<=s;c++)l[c]=0;for(c=0;c<n;c+=4){for(var h=t[c],d=h,f=0===d?0:1,p=1;p<s;p++){var g=p<4?t[c+p]:e[c+p-4];g>h&&i++,0!==g&&f++,d+=g,h=g}if(l[f]++,f>o&&(o=f),0===d)r++;else{var m=1/d,_=0;for(p=0;p<s;p++)_+=p<4?Math.abs(t[c+p]-t[c+p]*m):Math.abs(e[c+p-4]-e[c+p-4]*m);_>.001&&a++}}var v=this.skeleton.bones.length,b=this.getVerticesData(u.b.MatricesIndicesKind),y=this.getVerticesData(u.b.MatricesIndicesExtraKind),T=0;for(c=0;c<n;c++)for(p=0;p<s;p++){var E=p<4?b[p]:y[p-4];(E>=v||E<0)&&T++}return{skinned:!0,valid:0===r&&0===a&&0===T,report:"Number of Weights = "+n/4+"\nMaximum influences = "+o+"\nMissing Weights = "+r+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+T}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===b.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=b.a.DELAYLOADSTATE_LOADING,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var n=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return o.h.LoadFile(this.delayLoadingFile,function(n){n instanceof ArrayBuffer?t._delayLoadingFunction(n,t):t._delayLoadingFunction(JSON.parse(n),t),t.instances.forEach(function(e){e.refreshBoundingInfo(),e._syncSubMeshes()}),t.delayLoadState=b.a.DELAYLOADSTATE_LOADED,e._removePendingData(t)},function(){},e.offlineProvider,n),this},t.prototype.isInFrustum=function(t){return this.delayLoadState!==b.a.DELAYLOADSTATE_LOADING&&!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0)},t.prototype.setMaterialByID=function(e){var t,n=this.getScene().materials;for(t=n.length-1;t>-1;t--)if(n[t].id===e)return this.material=n[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(u.b.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var n,i=this.getVerticesData(u.b.PositionKind),r=new Array;for(n=0;n<i.length;n+=3)l.x.TransformCoordinates(l.x.FromArray(i,n),e).toArray(r,n);if(this.setVerticesData(u.b.PositionKind,r,this.getVertexBuffer(u.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(u.b.NormalKind)){for(i=this.getVerticesData(u.b.NormalKind),r=[],n=0;n<i.length;n+=3)l.x.TransformNormal(l.x.FromArray(i,n),e).normalize().toArray(r,n);this.setVerticesData(u.b.NormalKind,r,this.getVertexBuffer(u.b.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=l.q.Identity()),this._worldMatrix=l.j.Identity(),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,n,i,r){return void 0===e&&(e=""),void 0===r&&(r=!0),new t(e,this.getScene(),n,this,i,r)},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(i.meshMap)for(var r in i.meshMap)(s=i.meshMap[r])&&(s._internalMeshDataInfo._source=null,i.meshMap[r]=void 0);i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var o=0,a=this.getScene().meshes;o<a.length;o++){var s;(s=a[o])._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}for(i._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();e.prototype.dispose.call(this,t,n)},t.prototype.applyDisplacementMap=function(e,t,n,i,r,a,s){var l=this;void 0===s&&(s=!1);var c=this.getScene();return o.h.LoadImage(e,function(e){var o=document.createElement("canvas"),c=o.getContext("2d"),u=e.width,h=e.height;o.width=u,o.height=h,c.drawImage(e,0,0);var d=c.getImageData(0,0,u,h).data;l.applyDisplacementMapFromBuffer(d,u,h,t,n,r,a,s),i&&i(l)},function(){},c.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,n,i,r,o,a,s){if(void 0===s&&(s=!1),!this.isVerticesDataPresent(u.b.PositionKind)||!this.isVerticesDataPresent(u.b.NormalKind)||!this.isVerticesDataPresent(u.b.UVKind))return T.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var c=this.getVerticesData(u.b.PositionKind,!0,!0),d=this.getVerticesData(u.b.NormalKind),f=this.getVerticesData(u.b.UVKind),p=l.x.Zero(),g=l.x.Zero(),m=l.w.Zero();o=o||l.w.Zero(),a=a||new l.w(1,1);for(var _=0;_<c.length;_+=3){l.x.FromArrayToRef(c,_,p),l.x.FromArrayToRef(d,_,g),l.w.FromArrayToRef(f,_/3*2,m);var v=4*((Math.abs(m.x*a.x+o.x)*t%t|0)+(Math.abs(m.y*a.y+o.y)*n%n|0)*t),b=e[v]/255*.3+e[v+1]/255*.59+e[v+2]/255*.11;g.normalize(),g.scaleInPlace(i+(r-i)*b),(p=p.add(g)).toArray(c,_)}return h.a.ComputeNormals(c,this.getIndices(),d),s?(this.setVerticesData(u.b.PositionKind,c),this.setVerticesData(u.b.NormalKind,d)):(this.updateVerticesData(u.b.PositionKind,c),this.updateVerticesData(u.b.NormalKind,d)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,n=this.getVerticesDataKinds(),i={},r={},o={},a=!1;for(e=0;e<n.length;e++){var s=this.getVertexBuffer(t=n[e]);t!==u.b.NormalKind?(i[t]=s,r[t]=i[t].getData(),o[t]=[]):(a=s.isUpdatable(),n.splice(e,1),e--)}var c,h=this.subMeshes.slice(0),d=this.getIndices(),f=this.getTotalIndices();for(c=0;c<f;c++){var g=d[c];for(e=0;e<n.length;e++)for(var m=i[t=n[e]].getStrideSize(),_=0;_<m;_++)o[t].push(r[t][g*m+_])}var v=[],b=o[u.b.PositionKind];for(c=0;c<f;c+=3){d[c]=c,d[c+1]=c+1,d[c+2]=c+2;for(var y=l.x.FromArray(b,3*c),T=l.x.FromArray(b,3*(c+1)),E=l.x.FromArray(b,3*(c+2)),x=y.subtract(T),C=E.subtract(T),S=l.x.Normalize(l.x.Cross(x,C)),A=0;A<3;A++)v.push(S.x),v.push(S.y),v.push(S.z)}for(this.setIndices(d),this.setVerticesData(u.b.NormalKind,v,a),e=0;e<n.length;e++)this.setVerticesData(t=n[e],o[t],i[t].isUpdatable());this.releaseSubMeshes();for(var P=0;P<h.length;P++){var R=h[P];p.b.AddToMesh(R.materialIndex,R.indexStart,R.indexCount,R.indexStart,R.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,n=this.getVerticesDataKinds(),i={},r={},o={};for(e=0;e<n.length;e++){var a=this.getVertexBuffer(t=n[e]);i[t]=a,r[t]=i[t].getData(),o[t]=[]}var s,l=this.subMeshes.slice(0),c=this.getIndices(),u=this.getTotalIndices();for(s=0;s<u;s++){var h=c[s];for(e=0;e<n.length;e++)for(var d=i[t=n[e]].getStrideSize(),f=0;f<d;f++)o[t].push(r[t][h*d+f])}for(s=0;s<u;s+=3)c[s]=s,c[s+1]=s+1,c[s+2]=s+2;for(this.setIndices(c),e=0;e<n.length;e++)this.setVerticesData(t=n[e],o[t],i[t].isUpdatable());this.releaseSubMeshes();for(var g=0;g<l.length;g++){var m=l[g];p.b.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,n,i=h.a.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(u.b.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices)for(t=0;t<i.indices.length;t+=3)n=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=n;return i.applyToMesh(this),this},t.prototype.increaseVertices=function(e){var t=h.a.ExtractFromMesh(this),n=t.uvs,i=t.indices,r=t.positions,o=t.normals;if(null===i||null===r||null===o||null===n)T.a.Warn("VertexData contains null entries");else{for(var a,s,c=e+1,u=new Array,d=0;d<c+1;d++)u[d]=new Array;var f,p=new l.x(0,0,0),g=new l.x(0,0,0),m=new l.w(0,0),_=new Array,v=new Array,b=new Array,y=r.length,E=n.length;for(d=0;d<i.length;d+=3){v[0]=i[d],v[1]=i[d+1],v[2]=i[d+2];for(var x=0;x<3;x++)if(s=v[(x+1)%3],void 0===b[a=v[x]]&&void 0===b[s]?(b[a]=new Array,b[s]=new Array):(void 0===b[a]&&(b[a]=new Array),void 0===b[s]&&(b[s]=new Array)),void 0===b[a][s]&&void 0===b[s][a]){b[a][s]=[],p.x=(r[3*s]-r[3*a])/c,p.y=(r[3*s+1]-r[3*a+1])/c,p.z=(r[3*s+2]-r[3*a+2])/c,g.x=(o[3*s]-o[3*a])/c,g.y=(o[3*s+1]-o[3*a+1])/c,g.z=(o[3*s+2]-o[3*a+2])/c,m.x=(n[2*s]-n[2*a])/c,m.y=(n[2*s+1]-n[2*a+1])/c,b[a][s].push(a);for(var C=1;C<c;C++)b[a][s].push(r.length/3),r[y]=r[3*a]+C*p.x,o[y++]=o[3*a]+C*g.x,r[y]=r[3*a+1]+C*p.y,o[y++]=o[3*a+1]+C*g.y,r[y]=r[3*a+2]+C*p.z,o[y++]=o[3*a+2]+C*g.z,n[E++]=n[2*a]+C*m.x,n[E++]=n[2*a+1]+C*m.y;b[a][s].push(s),b[s][a]=new Array,f=b[a][s].length;for(var S=0;S<f;S++)b[s][a][S]=b[a][s][f-1-S]}for(u[0][0]=i[d],u[1][0]=b[i[d]][i[d+1]][1],u[1][1]=b[i[d]][i[d+2]][1],C=2;C<c;C++)for(u[C][0]=b[i[d]][i[d+1]][C],u[C][C]=b[i[d]][i[d+2]][C],p.x=(r[3*u[C][C]]-r[3*u[C][0]])/C,p.y=(r[3*u[C][C]+1]-r[3*u[C][0]+1])/C,p.z=(r[3*u[C][C]+2]-r[3*u[C][0]+2])/C,g.x=(o[3*u[C][C]]-o[3*u[C][0]])/C,g.y=(o[3*u[C][C]+1]-o[3*u[C][0]+1])/C,g.z=(o[3*u[C][C]+2]-o[3*u[C][0]+2])/C,m.x=(n[2*u[C][C]]-n[2*u[C][0]])/C,m.y=(n[2*u[C][C]+1]-n[2*u[C][0]+1])/C,x=1;x<C;x++)u[C][x]=r.length/3,r[y]=r[3*u[C][0]]+x*p.x,o[y++]=o[3*u[C][0]]+x*g.x,r[y]=r[3*u[C][0]+1]+x*p.y,o[y++]=o[3*u[C][0]+1]+x*g.y,r[y]=r[3*u[C][0]+2]+x*p.z,o[y++]=o[3*u[C][0]+2]+x*g.z,n[E++]=n[2*u[C][0]]+x*m.x,n[E++]=n[2*u[C][0]+1]+x*m.y;for(u[c]=b[i[d+1]][i[d+2]],_.push(u[0][0],u[1][0],u[1][1]),C=1;C<c;C++){for(x=0;x<C;x++)_.push(u[C][x],u[C+1][x],u[C+1][x+1]),_.push(u[C][x],u[C+1][x+1],u[C][x+1]);_.push(u[C][x],u[C+1][x],u[C+1][x+1])}}t.indices=_,t.applyToMesh(this)}},t.prototype.forceSharedVertices=function(){var e=h.a.ExtractFromMesh(this),t=e.uvs,n=e.indices,i=e.positions;if(null===n||null===i||null===e.normals||null===t)T.a.Warn("VertexData contains null entries");else{for(var r,o,a=new Array,s=new Array,l=new Array,c=new Array,u=0,d=new Array,f=0;f<n.length;f+=3){o=[n[f],n[f+1],n[f+2]],c=new Array;for(var p=0;p<3;p++){c[p]="";for(var g=0;g<3;g++)Math.abs(i[3*o[p]+g])<1e-8&&(i[3*o[p]+g]=0),c[p]+=i[3*o[p]+g]+"|";c[p]=c[p].slice(0,-1)}if(c[0]!=c[1]&&c[0]!=c[2]&&c[1]!=c[2])for(p=0;p<3;p++){if((r=d.indexOf(c[p]))<0){for(d.push(c[p]),r=u++,g=0;g<3;g++)a.push(i[3*o[p]+g]);for(g=0;g<2;g++)l.push(t[2*o[p]+g])}s.push(r)}}var m=new Array;h.a.ComputeNormals(a,s,m),e.positions=a,e.indices=s,e.normals=m,e.uvs=l,e.applyToMesh(this)}},t._instancedMeshFactory=function(e,t){throw x.a.WarnImport("InstancedMesh")},t._PhysicsImpostorParser=function(e,t,n){throw x.a.WarnImport("PhysicsImpostor")},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this},t.prototype.optimizeIndices=function(e){var t=this,n=this.getIndices(),i=this.getVerticesData(u.b.PositionKind);if(!i||!n)return this;for(var r=new Array,a=0;a<i.length;a+=3)r.push(l.x.FromArray(i,a));var s=new Array;return o.a.SyncAsyncForLoop(r.length,40,function(e){for(var t=r.length-1-e,n=r[t],i=0;i<t;++i)if(n.equals(r[i])){s[t]=i;break}},function(){for(var i=0;i<n.length;++i)n[i]=s[n[i]]||n[i];var r=t.subMeshes.slice(0);t.setIndices(n),t.subMeshes=r,e&&e(t)}),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),s.a&&s.a.HasTags(this)&&(e.tags=s.a.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){e.geometryId=t.id,e.subMeshes=[];for(var n=0;n<this.subMeshes.length;n++){var i=this.subMeshes[n];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?e.materialId=this.material.id:this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),this.getScene()._getComponent(C.a.NAME_PHYSICSENGINE)){var r=this.getPhysicsImpostor();r&&(e.physicsMass=r.getParam("mass"),e.physicsFriction=r.getParam("friction"),e.physicsRestitution=r.getParam("mass"),e.physicsImpostor=r.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var o=0;o<this.instances.length;o++){var a=this.instances[o];if(!a.doNotSerialize){var l={name:a.name,id:a.id,position:a.position.asArray(),scaling:a.scaling.asArray()};a.parent&&(l.parentId=a.parent.id),a.rotationQuaternion?l.rotationQuaternion=a.rotationQuaternion.asArray():a.rotation&&(l.rotation=a.rotation.asArray()),e.instances.push(l),y.a.AppendSerializedAnimations(a,l),l.ranges=a.serializeAnimationRanges()}}y.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return T.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var n=e.getActiveTarget(t),i=n.getPositions();if(!i)return void T.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(u.b.PositionKind+t,i,!1,3);var r=n.getNormals();r&&this.geometry.setVerticesData(u.b.NormalKind+t,r,!1,3);var o=n.getTangents();o&&this.geometry.setVerticesData(u.b.TangentKind+t,o,!1,3)}}else for(t=0;this.geometry.isVerticesDataPresent(u.b.PositionKind+t);)this.geometry.removeVerticesData(u.b.PositionKind+t),this.geometry.isVerticesDataPresent(u.b.NormalKind+t)&&this.geometry.removeVerticesData(u.b.NormalKind+t),this.geometry.isVerticesDataPresent(u.b.TangentKind+t)&&this.geometry.removeVerticesData(u.b.TangentKind+t),t++}},t.Parse=function(e,n,i){var r;if((r=e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,n):new t(e.name,n)).id=e.id,s.a&&s.a.AddTagsTo(r,e.tags),r.position=l.x.FromArray(e.position),void 0!==e.metadata&&(r.metadata=e.metadata),e.rotationQuaternion?r.rotationQuaternion=l.q.FromArray(e.rotationQuaternion):e.rotation&&(r.rotation=l.x.FromArray(e.rotation)),r.scaling=l.x.FromArray(e.scaling),e.localMatrix?r.setPreTransformMatrix(l.j.FromArray(e.localMatrix)):e.pivotMatrix&&r.setPivotMatrix(l.j.FromArray(e.pivotMatrix)),r.setEnabled(e.isEnabled),r.isVisible=e.isVisible,r.infiniteDistance=e.infiniteDistance,r.showBoundingBox=e.showBoundingBox,r.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(r.applyFog=e.applyFog),void 0!==e.pickable&&(r.isPickable=e.pickable),void 0!==e.alphaIndex&&(r.alphaIndex=e.alphaIndex),r.receiveShadows=e.receiveShadows,r.billboardMode=e.billboardMode,void 0!==e.visibility&&(r.visibility=e.visibility),r.checkCollisions=e.checkCollisions,void 0!==e.isBlocker&&(r.isBlocker=e.isBlocker),r._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(r._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(r._waitingParentId=e.parentId),void 0!==e.actions&&(r._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(r.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(r.overlayColor=l.e.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(r.renderOverlay=e.renderOverlay),r.isUnIndexed=!!e.isUnIndexed,r.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(r.delayLoadState=b.a.DELAYLOADSTATE_NOTLOADED,r.delayLoadingFile=i+e.delayLoadingFile,r._boundingInfo=new g.a(l.x.FromArray(e.boundingBoxMinimum),l.x.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(r._binaryInfo=e._binaryInfo),r._delayInfo=[],e.hasUVs&&r._delayInfo.push(u.b.UVKind),e.hasUVs2&&r._delayInfo.push(u.b.UV2Kind),e.hasUVs3&&r._delayInfo.push(u.b.UV3Kind),e.hasUVs4&&r._delayInfo.push(u.b.UV4Kind),e.hasUVs5&&r._delayInfo.push(u.b.UV5Kind),e.hasUVs6&&r._delayInfo.push(u.b.UV6Kind),e.hasColors&&r._delayInfo.push(u.b.ColorKind),e.hasMatricesIndices&&r._delayInfo.push(u.b.MatricesIndicesKind),e.hasMatricesWeights&&r._delayInfo.push(u.b.MatricesWeightsKind),r._delayLoadingFunction=d.a._ImportGeometry,v.a.ForceFullSceneLoadingForIncremental&&r._checkDelayState()):d.a._ImportGeometry(e,r),e.materialId?r.setMaterialByID(e.materialId):r.material=null,e.morphTargetManagerId>-1&&(r.morphTargetManager=n.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(r.skeleton=n.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(r.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var o=0;o<e.animations.length;o++){var a=e.animations[o];(m=E.a.GetClass("BABYLON.Animation"))&&r.animations.push(m.Parse(a))}c.a.ParseAnimationRanges(r,e,n)}if(e.autoAnimate&&n.beginAnimation(r,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),r.layerMask=e.layerMask&&!isNaN(e.layerMask)?Math.abs(parseInt(e.layerMask)):268435455,e.physicsImpostor&&t._PhysicsImpostorParser(n,r,e),e.lodMeshIds&&(r._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var h=0;h<e.instances.length;h++){var f=e.instances[h],p=r.createInstance(f.name);if(f.id&&(p.id=f.id),s.a&&s.a.AddTagsTo(p,f.tags?f.tags:e.tags),p.position=l.x.FromArray(f.position),void 0!==f.metadata&&(p.metadata=f.metadata),f.parentId&&(p._waitingParentId=f.parentId),f.rotationQuaternion?p.rotationQuaternion=l.q.FromArray(f.rotationQuaternion):f.rotation&&(p.rotation=l.x.FromArray(f.rotation)),p.scaling=l.x.FromArray(f.scaling),null!=f.checkCollisions&&null!=f.checkCollisions&&(p.checkCollisions=f.checkCollisions),null!=f.pickable&&null!=f.pickable&&(p.isPickable=f.pickable),null!=f.showBoundingBox&&null!=f.showBoundingBox&&(p.showBoundingBox=f.showBoundingBox),null!=f.showSubMeshesBoundingBox&&null!=f.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),null!=f.alphaIndex&&null!=f.showSubMeshesBoundingBox&&(p.alphaIndex=f.alphaIndex),f.physicsImpostor&&t._PhysicsImpostorParser(n,p,f),f.animations){for(o=0;o<f.animations.length;o++){var m;a=f.animations[o],(m=E.a.GetClass("BABYLON.Animation"))&&p.animations.push(m.Parse(a))}c.a.ParseAnimationRanges(p,f,n),f.autoAnimate&&n.beginAnimation(p,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}return r},t.CreateRibbon=function(e,t,n,i,r,o,a,s,l){throw x.a.WarnImport("MeshBuilder")},t.CreateDisc=function(e,t,n,i,r,o){throw void 0===i&&(i=null),x.a.WarnImport("MeshBuilder")},t.CreateBox=function(e,t,n,i,r){throw void 0===n&&(n=null),x.a.WarnImport("MeshBuilder")},t.CreateSphere=function(e,t,n,i,r,o){throw x.a.WarnImport("MeshBuilder")},t.CreateHemisphere=function(e,t,n,i){throw x.a.WarnImport("MeshBuilder")},t.CreateCylinder=function(e,t,n,i,r,o,a,s,l){throw x.a.WarnImport("MeshBuilder")},t.CreateTorus=function(e,t,n,i,r,o,a){throw x.a.WarnImport("MeshBuilder")},t.CreateTorusKnot=function(e,t,n,i,r,o,a,s,l,c){throw x.a.WarnImport("MeshBuilder")},t.CreateLines=function(e,t,n,i,r){throw void 0===n&&(n=null),void 0===i&&(i=!1),void 0===r&&(r=null),x.a.WarnImport("MeshBuilder")},t.CreateDashedLines=function(e,t,n,i,r,o,a,s){throw void 0===o&&(o=null),x.a.WarnImport("MeshBuilder")},t.CreatePolygon=function(e,t,n,i,r,o,a){throw void 0===a&&(a=earcut),x.a.WarnImport("MeshBuilder")},t.ExtrudePolygon=function(e,t,n,i,r,o,a,s){throw void 0===s&&(s=earcut),x.a.WarnImport("MeshBuilder")},t.ExtrudeShape=function(e,t,n,i,r,o,a,s,l,c){throw void 0===a&&(a=null),x.a.WarnImport("MeshBuilder")},t.ExtrudeShapeCustom=function(e,t,n,i,r,o,a,s,l,c,u,h){throw x.a.WarnImport("MeshBuilder")},t.CreateLathe=function(e,t,n,i,r,o,a){throw x.a.WarnImport("MeshBuilder")},t.CreatePlane=function(e,t,n,i,r){throw x.a.WarnImport("MeshBuilder")},t.CreateGround=function(e,t,n,i,r,o){throw x.a.WarnImport("MeshBuilder")},t.CreateTiledGround=function(e,t,n,i,r,o,a,s,l){throw x.a.WarnImport("MeshBuilder")},t.CreateGroundFromHeightMap=function(e,t,n,i,r,o,a,s,l,c,u){throw x.a.WarnImport("MeshBuilder")},t.CreateTube=function(e,t,n,i,r,o,a,s,l,c){throw x.a.WarnImport("MeshBuilder")},t.CreatePolyhedron=function(e,t,n){throw x.a.WarnImport("MeshBuilder")},t.CreateIcoSphere=function(e,t,n){throw x.a.WarnImport("MeshBuilder")},t.CreateDecal=function(e,t,n,i,r,o){throw x.a.WarnImport("MeshBuilder")},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(u.b.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(u.b.PositionKind)||this.setVerticesData(u.b.PositionKind,t,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(u.b.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(u.b.NormalKind)||this.setVerticesData(u.b.NormalKind,t,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(u.b.PositionKind))return this;if(!this.isVerticesDataPresent(u.b.NormalKind))return this;if(!this.isVerticesDataPresent(u.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(u.b.MatricesWeightsKind))return this;var t=this._internalMeshDataInfo;if(!t._sourcePositions){var n=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=n}t._sourceNormals||this.setNormalsForCPUSkinning();var i=this.getVerticesData(u.b.PositionKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var r=this.getVerticesData(u.b.NormalKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var o=this.getVerticesData(u.b.MatricesIndicesKind),a=this.getVerticesData(u.b.MatricesWeightsKind);if(!a||!o)return this;for(var s,c=this.numBoneInfluencers>4,h=c?this.getVerticesData(u.b.MatricesIndicesExtraKind):null,d=c?this.getVerticesData(u.b.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),p=l.x.Zero(),g=new l.j,m=new l.j,_=0,v=0;v<i.length;v+=3,_+=4){var b;for(s=0;s<4;s++)(b=a[_+s])>0&&(l.j.FromFloat32ArrayToRefScaled(f,Math.floor(16*o[_+s]),b,m),g.addToSelf(m));if(c)for(s=0;s<4;s++)(b=d[_+s])>0&&(l.j.FromFloat32ArrayToRefScaled(f,Math.floor(16*h[_+s]),b,m),g.addToSelf(m));l.x.TransformCoordinatesFromFloatsToRef(t._sourcePositions[v],t._sourcePositions[v+1],t._sourcePositions[v+2],g,p),p.toArray(i,v),l.x.TransformNormalFromFloatsToRef(t._sourceNormals[v],t._sourceNormals[v+1],t._sourceNormals[v+2],g,p),p.toArray(r,v),g.reset()}return this.updateVerticesData(u.b.PositionKind,i),this.updateVerticesData(u.b.NormalKind,r),this},t.MinMax=function(e){var t=null,n=null;return e.forEach(function(e){var i=e.getBoundingInfo().boundingBox;t&&n?(t.minimizeInPlace(i.minimumWorld),n.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,n=i.maximumWorld)}),t&&n?{min:t,max:n}:{min:l.x.Zero(),max:l.x.Zero()}},t.Center=function(e){var n=e instanceof Array?t.MinMax(e):e;return l.x.Center(n.min,n.max)},t.MergeMeshes=function(e,n,i,r,o,a){var s;if(void 0===n&&(n=!0),!i){var l=0;for(s=0;s<e.length;s++)if(e[s]&&(l+=e[s].getTotalVertices())>65536)return T.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(a){var c,u,d=null;o=!1}var f,g=new Array,m=new Array,v=null,b=new Array,y=null;for(s=0;s<e.length;s++)if(e[s]){var E=e[s];if(E.isAnInstance)return T.a.Warn("Cannot merge instance meshes."),null;var x=E.computeWorldMatrix(!0);if((f=h.a.ExtractFromMesh(E,!0,!0)).transform(x),v?v.merge(f,i):(v=f,y=E),o&&b.push(E.getTotalIndices()),a)if(E.material){var C=E.material;if(C instanceof _.a){for(u=0;u<C.subMaterials.length;u++)g.indexOf(C.subMaterials[u])<0&&g.push(C.subMaterials[u]);for(c=0;c<E.subMeshes.length;c++)m.push(g.indexOf(C.subMaterials[E.subMeshes[c].materialIndex])),b.push(E.subMeshes[c].indexCount)}else for(g.indexOf(C)<0&&g.push(C),c=0;c<E.subMeshes.length;c++)m.push(g.indexOf(C)),b.push(E.subMeshes[c].indexCount)}else for(c=0;c<E.subMeshes.length;c++)m.push(0),b.push(E.subMeshes[c].indexCount)}if(y=y,r||(r=new t(y.name+"_merged",y.getScene())),v.applyToMesh(r),r.checkCollisions=y.checkCollisions,n)for(s=0;s<e.length;s++)e[s]&&e[s].dispose();if(o||a){r.releaseSubMeshes(),s=0;for(var S=0;s<b.length;)p.b.CreateFromIndices(0,S,b[s],r),S+=b[s],s++}if(a){for((d=new _.a(y.name+"_merged",y.getScene())).subMaterials=g,c=0;c<r.subMeshes.length;c++)r.subMeshes[c].materialIndex=m[c];r.material=d}else r.material=y.material;return r},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var n=this.instances[this.instances.length-1];this.instances[t]=n,n._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=h.a.FRONTSIDE,t.BACKSIDE=h.a.BACKSIDE,t.DOUBLESIDE=h.a.DOUBLESIDE,t.DEFAULTSIDE=h.a.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t._GroundMeshParser=function(e,t){throw x.a.WarnImport("GroundMesh")},t}(f.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.WithinEpsilon=function(e,t,n){void 0===n&&(n=1.401298e-45);var i=e-t;return-n<=i&&i<=n},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0==(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),Math.min(n,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,n){return(e-t)/(n-t)},e.Denormalize=function(e,t,n){return e*(n-t)+t},e.DeltaAngle=function(t,n){var i=e.Repeat(n-t,360);return i>180&&(i-=360),i},e.PingPong=function(t,n){var i=e.Repeat(t,2*n);return n-Math.abs(i-n)},e.SmoothStep=function(t,n,i){var r=e.Clamp(i);return n*(r=-2*r*r*r+3*r*r)+t*(1-r)},e.MoveTowards=function(t,n,i){return Math.abs(n-t)<=i?n:t+e.Sign(n-t)*i},e.MoveTowardsAngle=function(t,n,i){var r=e.DeltaAngle(t,n);return-i<r&&r<i?n:e.MoveTowards(t,n=t+r,i)},e.Lerp=function(e,t,n){return e+(t-e)*n},e.LerpAngle=function(t,n,i){var r=e.Repeat(n-t,360);return r>180&&(r-=360),t+r*e.Clamp(i)},e.InverseLerp=function(t,n,i){return t!=n?e.Clamp((i-t)/(n-t)):0},e.Hermite=function(e,t,n,i,r){var o=r*r,a=r*o;return e*(2*a-3*o+1)+n*(-2*a+3*o)+t*(a-2*o+r)+i*(a-o)},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,n){return(e-t)/(n-t)},e.PercentToRange=function(e,t,n){return(n-t)*e+t},e.NormalizeRadians=function(t){return t-e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),r=n(4),o=n(19),a=function(){function e(){}return e.prototype.set=function(e,t){switch(t){case r.b.PositionKind:this.positions=e;break;case r.b.NormalKind:this.normals=e;break;case r.b.TangentKind:this.tangents=e;break;case r.b.UVKind:this.uvs=e;break;case r.b.UV2Kind:this.uvs2=e;break;case r.b.UV3Kind:this.uvs3=e;break;case r.b.UV4Kind:this.uvs4=e;break;case r.b.UV5Kind:this.uvs5=e;break;case r.b.UV6Kind:this.uvs6=e;break;case r.b.ColorKind:this.colors=e;break;case r.b.MatricesIndicesKind:this.matricesIndices=e;break;case r.b.MatricesWeightsKind:this.matricesWeights=e;break;case r.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case r.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},e.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},e.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},e.prototype.updateMesh=function(e){return this._update(e),this},e.prototype.updateGeometry=function(e){return this._update(e),this},e.prototype._applyTo=function(e,t){return void 0===t&&(t=!1),this.positions&&e.setVerticesData(r.b.PositionKind,this.positions,t),this.normals&&e.setVerticesData(r.b.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(r.b.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(r.b.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(r.b.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(r.b.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(r.b.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(r.b.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(r.b.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(r.b.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(r.b.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(r.b.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},e.prototype._update=function(e,t,n){return this.positions&&e.updateVerticesData(r.b.PositionKind,this.positions,t,n),this.normals&&e.updateVerticesData(r.b.NormalKind,this.normals,t,n),this.tangents&&e.updateVerticesData(r.b.TangentKind,this.tangents,t,n),this.uvs&&e.updateVerticesData(r.b.UVKind,this.uvs,t,n),this.uvs2&&e.updateVerticesData(r.b.UV2Kind,this.uvs2,t,n),this.uvs3&&e.updateVerticesData(r.b.UV3Kind,this.uvs3,t,n),this.uvs4&&e.updateVerticesData(r.b.UV4Kind,this.uvs4,t,n),this.uvs5&&e.updateVerticesData(r.b.UV5Kind,this.uvs5,t,n),this.uvs6&&e.updateVerticesData(r.b.UV6Kind,this.uvs6,t,n),this.colors&&e.updateVerticesData(r.b.ColorKind,this.colors,t,n),this.matricesIndices&&e.updateVerticesData(r.b.MatricesIndicesKind,this.matricesIndices,t,n),this.matricesWeights&&e.updateVerticesData(r.b.MatricesWeightsKind,this.matricesWeights,t,n),this.matricesIndicesExtra&&e.updateVerticesData(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,n),this.matricesWeightsExtra&&e.updateVerticesData(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,n),this.indices&&e.setIndices(this.indices,null),this},e.prototype.transform=function(e){var t,n=e.m[0]*e.m[5]*e.m[10]<0,r=i.x.Zero();if(this.positions){var o=i.x.Zero();for(t=0;t<this.positions.length;t+=3)i.x.FromArrayToRef(this.positions,t,o),i.x.TransformCoordinatesToRef(o,e,r),this.positions[t]=r.x,this.positions[t+1]=r.y,this.positions[t+2]=r.z}if(this.normals){var a=i.x.Zero();for(t=0;t<this.normals.length;t+=3)i.x.FromArrayToRef(this.normals,t,a),i.x.TransformNormalToRef(a,e,r),this.normals[t]=r.x,this.normals[t+1]=r.y,this.normals[t+2]=r.z}if(this.tangents){var s=i.y.Zero(),l=i.y.Zero();for(t=0;t<this.tangents.length;t+=4)i.y.FromArrayToRef(this.tangents,t,s),i.y.TransformNormalToRef(s,e,l),this.tangents[t]=l.x,this.tangents[t+1]=l.y,this.tangents[t+2]=l.z,this.tangents[t+3]=l.w}if(n&&this.indices)for(t=0;t<this.indices.length;t+=3){var c=this.indices[t+1];this.indices[t+1]=this.indices[t+2],this.indices[t+2]=c}return this},e.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var n=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var i=this.indices.length+e.indices.length,r=t||this.indices instanceof Uint32Array?new Uint32Array(i):new Uint16Array(i);r.set(this.indices);for(var o=this.indices.length,a=0;a<e.indices.length;a++)r[o+a]=e.indices[a]+n;this.indices=r}else for(a=0;a<e.indices.length;a++)this.indices.push(e.indices[a]+n)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},e.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var n=t.length+e.length,i=e instanceof Float32Array,r=t instanceof Float32Array;if(i){var o=new Float32Array(n);return o.set(e),o.set(t,e.length),o}if(r){var a=e.slice(0),s=0;for(n=t.length;s<n;s++)a.push(t[s]);return a}return e.concat(t)},e.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(e,t){var n=r.b.DeduceStride(e);if(t.length%n!=0)throw new Error("The "+e+"s array count must be a multiple of "+n);return t.length/n},t=e(r.b.PositionKind,this.positions),n=function(n,i){var r=e(n,i);if(r!==t)throw new Error("The "+n+"s element count ("+r+") does not match the positions count ("+t+")")};this.normals&&n(r.b.NormalKind,this.normals),this.tangents&&n(r.b.TangentKind,this.tangents),this.uvs&&n(r.b.UVKind,this.uvs),this.uvs2&&n(r.b.UV2Kind,this.uvs2),this.uvs3&&n(r.b.UV3Kind,this.uvs3),this.uvs4&&n(r.b.UV4Kind,this.uvs4),this.uvs5&&n(r.b.UV5Kind,this.uvs5),this.uvs6&&n(r.b.UV6Kind,this.uvs6),this.colors&&n(r.b.ColorKind,this.colors),this.matricesIndices&&n(r.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(r.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(r.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(r.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},e.ExtractFromMesh=function(t,n,i){return e._ExtractFrom(t,n,i)},e.ExtractFromGeometry=function(t,n,i){return e._ExtractFrom(t,n,i)},e._ExtractFrom=function(t,n,i){var o=new e;return t.isVerticesDataPresent(r.b.PositionKind)&&(o.positions=t.getVerticesData(r.b.PositionKind,n,i)),t.isVerticesDataPresent(r.b.NormalKind)&&(o.normals=t.getVerticesData(r.b.NormalKind,n,i)),t.isVerticesDataPresent(r.b.TangentKind)&&(o.tangents=t.getVerticesData(r.b.TangentKind,n,i)),t.isVerticesDataPresent(r.b.UVKind)&&(o.uvs=t.getVerticesData(r.b.UVKind,n,i)),t.isVerticesDataPresent(r.b.UV2Kind)&&(o.uvs2=t.getVerticesData(r.b.UV2Kind,n,i)),t.isVerticesDataPresent(r.b.UV3Kind)&&(o.uvs3=t.getVerticesData(r.b.UV3Kind,n,i)),t.isVerticesDataPresent(r.b.UV4Kind)&&(o.uvs4=t.getVerticesData(r.b.UV4Kind,n,i)),t.isVerticesDataPresent(r.b.UV5Kind)&&(o.uvs5=t.getVerticesData(r.b.UV5Kind,n,i)),t.isVerticesDataPresent(r.b.UV6Kind)&&(o.uvs6=t.getVerticesData(r.b.UV6Kind,n,i)),t.isVerticesDataPresent(r.b.ColorKind)&&(o.colors=t.getVerticesData(r.b.ColorKind,n,i)),t.isVerticesDataPresent(r.b.MatricesIndicesKind)&&(o.matricesIndices=t.getVerticesData(r.b.MatricesIndicesKind,n,i)),t.isVerticesDataPresent(r.b.MatricesWeightsKind)&&(o.matricesWeights=t.getVerticesData(r.b.MatricesWeightsKind,n,i)),t.isVerticesDataPresent(r.b.MatricesIndicesExtraKind)&&(o.matricesIndicesExtra=t.getVerticesData(r.b.MatricesIndicesExtraKind,n,i)),t.isVerticesDataPresent(r.b.MatricesWeightsExtraKind)&&(o.matricesWeightsExtra=t.getVerticesData(r.b.MatricesWeightsExtraKind,n,i)),o.indices=t.getIndices(n,i),o},e.CreateRibbon=function(e){throw o.a.WarnImport("ribbonBuilder")},e.CreateBox=function(e){throw o.a.WarnImport("boxBuilder")},e.CreateSphere=function(e){throw o.a.WarnImport("sphereBuilder")},e.CreateCylinder=function(e){throw o.a.WarnImport("cylinderBuilder")},e.CreateTorus=function(e){throw o.a.WarnImport("torusBuilder")},e.CreateLineSystem=function(e){throw o.a.WarnImport("linesBuilder")},e.CreateDashedLines=function(e){throw o.a.WarnImport("linesBuilder")},e.CreateGround=function(e){throw o.a.WarnImport("groundBuilder")},e.CreateTiledGround=function(e){throw o.a.WarnImport("groundBuilder")},e.CreateGroundFromHeightMap=function(e){throw o.a.WarnImport("groundBuilder")},e.CreatePlane=function(e){throw o.a.WarnImport("planeBuilder")},e.CreateDisc=function(e){throw o.a.WarnImport("discBuilder")},e.CreatePolygon=function(e,t,n,i,r,a){throw o.a.WarnImport("polygonBuilder")},e.CreateIcoSphere=function(e){throw o.a.WarnImport("icoSphereBuilder")},e.CreatePolyhedron=function(e){throw o.a.WarnImport("polyhedronBuilder")},e.CreateTorusKnot=function(e){throw o.a.WarnImport("torusKnotBuilder")},e.ComputeNormals=function(e,t,n,r){var o=0,a=0,s=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=0,b=0,y=0,T=0,E=0,x=0,C=0,S=!1,A=!1,P=!1,R=!1,M=1,O=0,w=null;if(r&&(S=!!r.facetNormals,A=!!r.facetPositions,P=!!r.facetPartitioning,M=!0===r.useRightHandedSystem?-1:1,O=r.ratio||0,w=r.distanceTo,R=!!r.depthSort)){void 0===w&&(w=i.x.Zero());var I=r.depthSortedFacets}var D=0,L=0,k=0,N=0;if(P&&r&&r.bbSize){var F=0,B=0,U=0,V=0,G=0,z=0,j=0,H=0,W=0,X=0,Y=0,K=0,Q=0,q=0,Z=0,J=0,$=r.bbSize.x>r.bbSize.y?r.bbSize.x:r.bbSize.y;$=$>r.bbSize.z?$:r.bbSize.z,D=r.subDiv.X*O/r.bbSize.x,L=r.subDiv.Y*O/r.bbSize.y,k=r.subDiv.Z*O/r.bbSize.z,N=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0}for(o=0;o<e.length;o++)n[o]=0;var ee=t.length/3|0;for(o=0;o<ee;o++){if(_=1+(m=3*t[3*o]),y=1+(b=3*t[3*o+1]),x=1+(E=3*t[3*o+2]),d=M*((s=e[_]-e[y])*(h=e[C=E+2]-e[T=b+2])-(l=e[v=m+2]-e[T])*(u=e[x]-e[y])),f=M*(l*(c=e[E]-e[b])-(a=e[m]-e[b])*h),p=M*(a*u-s*c),d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,S&&r&&(r.facetNormals[o].x=d,r.facetNormals[o].y=f,r.facetNormals[o].z=p),A&&r&&(r.facetPositions[o].x=(e[m]+e[b]+e[E])/3,r.facetPositions[o].y=(e[_]+e[y]+e[x])/3,r.facetPositions[o].z=(e[v]+e[T]+e[C])/3),P&&r&&(F=Math.floor((r.facetPositions[o].x-r.bInfo.minimum.x*O)*D),B=Math.floor((r.facetPositions[o].y-r.bInfo.minimum.y*O)*L),U=Math.floor((r.facetPositions[o].z-r.bInfo.minimum.z*O)*k),V=Math.floor((e[m]-r.bInfo.minimum.x*O)*D),G=Math.floor((e[_]-r.bInfo.minimum.y*O)*L),z=Math.floor((e[v]-r.bInfo.minimum.z*O)*k),j=Math.floor((e[b]-r.bInfo.minimum.x*O)*D),H=Math.floor((e[y]-r.bInfo.minimum.y*O)*L),W=Math.floor((e[T]-r.bInfo.minimum.z*O)*k),X=Math.floor((e[E]-r.bInfo.minimum.x*O)*D),Y=Math.floor((e[x]-r.bInfo.minimum.y*O)*L),K=Math.floor((e[C]-r.bInfo.minimum.z*O)*k),q=V+r.subDiv.max*G+N*z,Z=j+r.subDiv.max*H+N*W,J=X+r.subDiv.max*Y+N*K,r.facetPartitioning[Q=F+r.subDiv.max*B+N*U]=r.facetPartitioning[Q]?r.facetPartitioning[Q]:new Array,r.facetPartitioning[q]=r.facetPartitioning[q]?r.facetPartitioning[q]:new Array,r.facetPartitioning[Z]=r.facetPartitioning[Z]?r.facetPartitioning[Z]:new Array,r.facetPartitioning[J]=r.facetPartitioning[J]?r.facetPartitioning[J]:new Array,r.facetPartitioning[q].push(o),Z!=q&&r.facetPartitioning[Z].push(o),J!=Z&&J!=q&&r.facetPartitioning[J].push(o),Q!=q&&Q!=Z&&Q!=J&&r.facetPartitioning[Q].push(o)),R&&r&&r.facetPositions){var te=I[o];te.ind=3*o,te.sqDistance=i.x.DistanceSquared(r.facetPositions[o],w)}n[m]+=d,n[_]+=f,n[v]+=p,n[b]+=d,n[y]+=f,n[T]+=p,n[E]+=d,n[x]+=f,n[C]+=p}for(o=0;o<n.length/3;o++)d=n[3*o],f=n[3*o+1],p=n[3*o+2],d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,n[3*o]=d,n[3*o+1]=f,n[3*o+2]=p},e._ComputeSides=function(t,n,r,o,a,s,l){var c,u,h=r.length,d=o.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:var f;for(c=0;c<h;c+=3)f=r[c],r[c]=r[c+2],r[c+2]=f;for(u=0;u<d;u++)o[u]=-o[u];break;case e.DOUBLESIDE:for(var p=n.length,g=p/3,m=0;m<p;m++)n[p+m]=n[m];for(c=0;c<h;c+=3)r[c+h]=r[c+2]+g,r[c+1+h]=r[c+1]+g,r[c+2+h]=r[c]+g;for(u=0;u<d;u++)o[d+u]=-o[u];var _=a.length,v=0;for(v=0;v<_;v++)a[v+_]=a[v];for(s=s||new i.y(0,0,1,1),l=l||new i.y(0,0,1,1),v=0,c=0;c<_/2;c++)a[v]=s.x+(s.z-s.x)*a[v],a[v+1]=s.y+(s.w-s.y)*a[v+1],a[v+_]=l.x+(l.z-l.x)*a[v+_],a[v+_+1]=l.y+(l.w-l.y)*a[v+_+1],v+=2}},e.ImportVertexData=function(t,n){var o=new e,a=t.positions;a&&o.set(a,r.b.PositionKind);var s=t.normals;s&&o.set(s,r.b.NormalKind);var l=t.tangents;l&&o.set(l,r.b.TangentKind);var c=t.uvs;c&&o.set(c,r.b.UVKind);var u=t.uv2s;u&&o.set(u,r.b.UV2Kind);var h=t.uv3s;h&&o.set(h,r.b.UV3Kind);var d=t.uv4s;d&&o.set(d,r.b.UV4Kind);var f=t.uv5s;f&&o.set(f,r.b.UV5Kind);var p=t.uv6s;p&&o.set(p,r.b.UV6Kind);var g=t.colors;g&&o.set(i.f.CheckColors4(g,a.length/3),r.b.ColorKind);var m=t.matricesIndices;m&&o.set(m,r.b.MatricesIndicesKind);var _=t.matricesWeights;_&&o.set(_,r.b.MatricesWeightsKind);var v=t.indices;v&&(o.indices=v),n.setAllVerticesData(o,t.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var i=n(1),r=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,e.STEP_BEFORECAMERADRAW_LAYER=1,e.STEP_BEFORERENDERTARGETDRAW_LAYER=0,e.STEP_BEFORERENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_AFTERRENDERTARGETDRAW_LAYER=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,e.STEP_AFTERCAMERADRAW_LAYER=3,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}(),o=function(e){function t(t){return e.apply(this,t)||this}return i.d(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,n){var i=0;for(Number;i<this.length&&!(e<this[i].index);i++);this.splice(i,0,{index:e,component:t,action:n.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(6),r=n(16),o=n(0),a=n(23),s=n(4),l=n(38),c=function(){function e(){}return e.BindEyePosition=function(e,t){if(t._forcedViewPosition)e.setVector3("vEyePosition",t._forcedViewPosition);else{var n=t.activeCamera.globalPosition;n||(n=t.activeCamera.devicePosition),e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:n)}},e.PrepareDefinesForMergedUV=function(e,t,n){t._needUVs=!0,t[n]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[n+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[n+"DIRECTUV"]=0},e.BindTextureMatrix=function(e,t,n){var i=e.getTextureMatrix();i.isIdentityAs3x2()||t.updateMatrix(n+"Matrix",i)},e.PrepareDefinesForMisc=function(e,t,n,i,o,a,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=n,s.POINTSIZE=i,s.FOG=t.fogEnabled&&e.applyFog&&t.fogMode!==r.a.FOGMODE_NONE&&o,s.NONUNIFORMSCALING=e.nonUniformScaling,s.ALPHATEST=a)},e.PrepareDefinesForFrameBoundValues=function(e,t,n,i,r){void 0===r&&(r=null);var o,a,s,l,c=!1;a=null==r?null!=e.clipPlane2:r,s=null==r?null!=e.clipPlane3:r,l=null==r?null!=e.clipPlane4:r,n.CLIPPLANE!==(o=null==r?null!=e.clipPlane:r)&&(n.CLIPPLANE=o,c=!0),n.CLIPPLANE2!==a&&(n.CLIPPLANE2=a,c=!0),n.CLIPPLANE3!==s&&(n.CLIPPLANE3=s,c=!0),n.CLIPPLANE4!==l&&(n.CLIPPLANE4=l,c=!0),n.DEPTHPREPASS!==!t.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,c=!0),n.INSTANCES!==i&&(n.INSTANCES=i,c=!0),c&&n.markAsUnprocessed()},e.PrepareDefinesForAttributes=function(e,t,n,i,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;if(t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(s.b.NormalKind),t._needNormals&&e.isVerticesDataPresent(s.b.TangentKind)&&(t.TANGENT=!0),t._needUVs?(t.UV1=e.isVerticesDataPresent(s.b.UVKind),t.UV2=e.isVerticesDataPresent(s.b.UV2Kind)):(t.UV1=!1,t.UV2=!1),n){var a=e.useVertexColors&&e.isVerticesDataPresent(s.b.ColorKind);t.VERTEXCOLOR=a,t.VERTEXALPHA=e.hasVertexAlpha&&a&&o}if(i)if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var l=void 0!==t.BONETEXTURE;e.skeleton.isUsingTextureForMatrices&&l?t.BONETEXTURE=!0:(t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!l&&void 0)}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0;if(r){var c=e.morphTargetManager;c?(t.MORPHTARGETS_TANGENT=c.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=c.supportsNormals&&t.NORMAL,t.MORPHTARGETS=c.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=c.numInfluencers):(t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}return!0},e.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var n=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=n&&t.markAsUnprocessed()}},e.PrepareDefinesForLights=function(e,t,n,i,r,o){if(void 0===r&&(r=4),void 0===o&&(o=!1),!n._areLightsDirty)return n._needNormals;var a=0,s=!1,c=!1,u=!1,h=!1,d=!1;if(e.lightsEnabled&&!o)for(var f=0,p=t.lightSources;f<p.length;f++){var g=p[f];switch(s=!0,void 0===n["LIGHT"+a]&&(c=!0),n["LIGHT"+a]=!0,n["SPOTLIGHT"+a]=!1,n["HEMILIGHT"+a]=!1,n["POINTLIGHT"+a]=!1,n["DIRLIGHT"+a]=!1,g.prepareLightSpecificDefines(n,a),n["LIGHT_FALLOFF_PHYSICAL"+a]=!1,n["LIGHT_FALLOFF_GLTF"+a]=!1,n["LIGHT_FALLOFF_STANDARD"+a]=!1,g.falloffType){case l.a.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+a]=!0;break;case l.a.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case l.a.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+a]=!0}if(i&&!g.specular.equalsFloats(0,0,0)&&(d=!0),n["SHADOW"+a]=!1,n["SHADOWPCF"+a]=!1,n["SHADOWPCSS"+a]=!1,n["SHADOWPOISSON"+a]=!1,n["SHADOWESM"+a]=!1,n["SHADOWCUBE"+a]=!1,n["SHADOWLOWQUALITY"+a]=!1,n["SHADOWMEDIUMQUALITY"+a]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&g.shadowEnabled){var m=g.getShadowGenerator();if(m){var _=m.getShadowMap();_&&_.renderList&&_.renderList.length>0&&(h=!0,m.prepareDefines(n,a))}}if(g.lightmapMode!=l.a.LIGHTMAP_DEFAULT?(u=!0,n["LIGHTMAPEXCLUDED"+a]=!0,n["LIGHTMAPNOSPECULAR"+a]=g.lightmapMode==l.a.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+a]=!1,n["LIGHTMAPNOSPECULAR"+a]=!1),++a===r)break}n.SPECULARTERM=d,n.SHADOWS=h;for(var v=a;v<r;v++)void 0!==n["LIGHT"+v]&&(n["LIGHT"+v]=!1,n["HEMILIGHT"+v]=!1,n["POINTLIGHT"+v]=!1,n["DIRLIGHT"+v]=!1,n["SPOTLIGHT"+v]=!1,n["SHADOW"+v]=!1,n["SHADOWPCF"+v]=!1,n["SHADOWPCSS"+v]=!1,n["SHADOWPOISSON"+v]=!1,n["SHADOWESM"+v]=!1,n["SHADOWCUBE"+v]=!1,n["SHADOWLOWQUALITY"+v]=!1,n["SHADOWMEDIUMQUALITY"+v]=!1);var b=e.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(c=!0),n.SHADOWFLOAT=h&&(b.textureFloatRender&&b.textureFloatLinearFiltering||b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=u,c&&n.rebuild(),s},e.PrepareUniformsAndSamplersList=function(e,t,n,i){var r;void 0===i&&(i=4);var o=null;e.uniformsNames?(r=e.uniformsNames,o=e.uniformBuffersNames,t=e.samplers,n=e.defines,i=e.maxSimultaneousLights):(r=e,t||(t=[]));for(var a=0;a<i&&n["LIGHT"+a];a++)r.push("vLightData"+a,"vLightDiffuse"+a,"vLightSpecular"+a,"vLightDirection"+a,"vLightFalloff"+a,"vLightGround"+a,"lightMatrix"+a,"shadowsInfo"+a,"depthValues"+a),o&&o.push("Light"+a),t.push("shadowSampler"+a),t.push("depthSampler"+a),n["PROJECTEDLIGHTTEXTURE"+a]&&(t.push("projectionLightSampler"+a),r.push("textureProjectionMatrix"+a));n.NUM_MORPH_INFLUENCERS&&r.push("morphTargetInfluences")},e.HandleFallbacksForShadows=function(e,t,n,i){void 0===n&&(n=4),void 0===i&&(i=0);for(var r=0,o=0;o<n&&e["LIGHT"+o];o++)o>0&&t.addFallback(r=i+o,"LIGHT"+o),e.SHADOWS||(e["SHADOW"+o]&&t.addFallback(i,"SHADOW"+o),e["SHADOWPCF"+o]&&t.addFallback(i,"SHADOWPCF"+o),e["SHADOWPCSS"+o]&&t.addFallback(i,"SHADOWPCSS"+o),e["SHADOWPOISSON"+o]&&t.addFallback(i,"SHADOWPOISSON"+o),e["SHADOWESM"+o]&&t.addFallback(i,"SHADOWESM"+o));return r++},e.PrepareAttributesForMorphTargets=function(e,t,n){var r=n.NUM_MORPH_INFLUENCERS;if(r>0&&a.a.LastCreatedEngine)for(var o=a.a.LastCreatedEngine.getCaps().maxVertexAttribs,l=t.morphTargetManager,c=l&&l.supportsNormals&&n.NORMAL,u=l&&l.supportsTangents&&n.TANGENT,h=0;h<r;h++)e.push(s.b.PositionKind+h),c&&e.push(s.b.NormalKind+h),u&&e.push(s.b.TangentKind+h),e.length>o&&i.a.Error("Cannot add more vertex attributes for mesh "+t.name)},e.PrepareAttributesForBones=function(e,t,n,i){n.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(s.b.MatricesIndicesKind),e.push(s.b.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(e.push(s.b.MatricesIndicesExtraKind),e.push(s.b.MatricesWeightsExtraKind)))},e.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},e.BindLightShadow=function(e,t,n,i){if(e.shadowEnabled&&t.receiveShadows){var r=e.getShadowGenerator();r&&r.bindShadowLight(n,i)}},e.BindLightProperties=function(e,t,n){e.transferToEffect(t,n+"")},e.BindLights=function(t,n,i,r,a,s){void 0===a&&(a=4),void 0===s&&(s=!1);for(var l=Math.min(n.lightSources.length,a),c=0;c<l;c++){var u=n.lightSources[c],h=c.toString(),d=u.getScaledIntensity();u._uniformBuffer.bindToEffect(i,"Light"+c),e.BindLightProperties(u,i,c),u.diffuse.scaleToRef(d,o.t.Color3[0]),u._uniformBuffer.updateColor4("vLightDiffuse",o.t.Color3[0],s?u.radius:u.range,h),r.SPECULARTERM&&(u.specular.scaleToRef(d,o.t.Color3[1]),u._uniformBuffer.updateColor3("vLightSpecular",o.t.Color3[1],h)),t.shadowsEnabled&&this.BindLightShadow(u,n,h,i),u._uniformBuffer.update()}},e.BindFogParameters=function(e,t,n,i){void 0===i&&(i=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==r.a.FOGMODE_NONE&&(n.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),n.setColor3("vFogColor",this._tempFogColor)):n.setColor3("vFogColor",e.fogColor))},e.BindBonesParameters=function(e,t){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var n=e.skeleton;if(n.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){var i=n.getTransformMatrixTexture();t.setTexture("boneSampler",i),t.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var r=n.getTransformMatrices(e);r&&t.setMatrices("mBones",r)}}},e.BindMorphTargetParameters=function(e,t){var n=e.morphTargetManager;e&&n&&t.setFloatArray("morphTargetInfluences",n.influences)},e.BindLogDepth=function(e,t,n){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(n.activeCamera.maxZ+1)/Math.LN2))},e.BindClipPlane=function(e,t){if(t.clipPlane){var n=t.clipPlane;e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}t.clipPlane2&&e.setFloat4("vClipPlane2",(n=t.clipPlane2).normal.x,n.normal.y,n.normal.z,n.d),t.clipPlane3&&e.setFloat4("vClipPlane3",(n=t.clipPlane3).normal.x,n.normal.y,n.normal.z,n.d),t.clipPlane4&&e.setFloat4("vClipPlane4",(n=t.clipPlane4).normal.x,n.normal.y,n.normal.z,n.d)},e._tempFogColor=o.e.Black(),e}()},function(e,t,n){"use strict";var i=n(1),r=n(9),o=n(47),a=n(8),s=n(28),l=n(61),c=n(29),u=n(0),h=n(42),d=n(24),f=n(21),p=n(30),g=n(31),m=n(63),_=n(38),v=n(50),b=n(36),y=n(83),T=n(91),E=n(14),x=n(3),C=n(35),S=n(6),A=n(23),P=n(19),R=n(17),M=n(79),O=n(51),w=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),I=function(){function e(e){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new u.w(0,0),this._previousStartingPointerPosition=new u.w(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=e}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new u.w(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),e.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getRenderingCanvasClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(e,t){var n=this._scene,i=n.getEngine().getRenderingCanvas();if(i){i.tabIndex=1,i.style.cursor=n.defaultCursor;var r=!!(e&&e.hit&&e.pickedMesh);r?(n.setPointerOverMesh(e.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(i.style.cursor=this._pointerOverMesh.actionManager.hoverCursor?this._pointerOverMesh.actionManager.hoverCursor:n.hoverCursor)):n.setPointerOverMesh(null);for(var o=0,a=n._pointerMoveStage;o<a.length;o++)e=a[o].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,r,i);if(e){var s=t.type===this._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE;if(n.onPointerMove&&n.onPointerMove(t,e,s),n.onPointerObservable.hasObservers()){var l=new R.b(s,t,e);this._setRayOnPointerInfo(l),n.onPointerObservable.notifyObservers(l,s)}}}},e.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,u.j.Identity(),t.activeCamera)))},e.prototype._checkPrePointerObservable=function(e,t,n){var i=this._scene,r=new R.d(n,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(r.ray=e.ray),i.onPrePointerObservable.notifyObservers(r,n),!!r.skipOnPointerObservable},e.prototype.simulatePointerMove=function(e,t){var n=new PointerEvent("pointermove",t);this._checkPrePointerObservable(e,n,R.a.POINTERMOVE)||this._processPointerMove(e,n)},e.prototype.simulatePointerDown=function(e,t){var n=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(e,n,R.a.POINTERDOWN)||this._processPointerDown(e,n)},e.prototype._processPointerDown=function(t,n){var i=this,r=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh.actionManager;if(o){if(o.hasPickTriggers)switch(o.processTrigger(x.a.ACTION_OnPickDownTrigger,b.a.CreateNew(t.pickedMesh,n)),n.button){case 0:o.processTrigger(x.a.ACTION_OnLeftPickTrigger,b.a.CreateNew(t.pickedMesh,n));break;case 1:o.processTrigger(x.a.ACTION_OnCenterPickTrigger,b.a.CreateNew(t.pickedMesh,n));break;case 2:o.processTrigger(x.a.ACTION_OnRightPickTrigger,b.a.CreateNew(t.pickedMesh,n))}o.hasSpecificTrigger(x.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var t=r.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(x.a.ACTION_OnLongPressTrigger)&&e==i._pickedDownMesh},!1,r.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==i._totalPointersPressed&&Date.now()-i._startingPointerTime>e.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,o.processTrigger(x.a.ACTION_OnLongPressTrigger,b.a.CreateNew(t.pickedMesh,n)))},e.LongPressDelay)}}else for(var a=0,s=r._pointerDownStage;a<s.length;a++)t=s[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,n);if(t){var l=R.a.POINTERDOWN;if(r.onPointerDown&&r.onPointerDown(n,t,l),r.onPointerObservable.hasObservers()){var c=new R.b(l,n,t);this._setRayOnPointerInfo(c),r.onPointerObservable.notifyObservers(c,l)}}},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(e,t,n){var i=new PointerEvent("pointerup",t),r=new w;n?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,i,R.a.POINTERUP)||this._processPointerUp(e,i,r)},e.prototype._processPointerUp=function(e,t,n){var i=this._scene;if(e&&e&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(i.onPointerPick&&i.onPointerPick(t,e),n.singleClick&&!n.ignore&&i.onPointerObservable.hasObservers())){var r=R.a.POINTERPICK,o=new R.b(r,t,e);this._setRayOnPointerInfo(o),i.onPointerObservable.notifyObservers(o,r)}var a=e.pickedMesh._getActionManagerForTrigger();if(a&&!n.ignore){a.processTrigger(x.a.ACTION_OnPickUpTrigger,b.a.CreateNew(e.pickedMesh,t)),!n.hasSwiped&&n.singleClick&&a.processTrigger(x.a.ACTION_OnPickTrigger,b.a.CreateNew(e.pickedMesh,t));var s=e.pickedMesh._getActionManagerForTrigger(x.a.ACTION_OnDoublePickTrigger);n.doubleClick&&s&&s.processTrigger(x.a.ACTION_OnDoublePickTrigger,b.a.CreateNew(e.pickedMesh,t))}}else if(!n.ignore)for(var l=0,c=i._pointerUpStage;l<c.length;l++)e=c[l].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var u=this._pickedDownMesh._getActionManagerForTrigger(x.a.ACTION_OnPickOutTrigger);u&&u.processTrigger(x.a.ACTION_OnPickOutTrigger,b.a.CreateNew(this._pickedDownMesh,t))}var h=0;i.onPointerObservable.hasObservers()&&(n.ignore||n.hasSwiped||(n.singleClick&&i.onPointerObservable.hasSpecificMask(R.a.POINTERTAP)?h=R.a.POINTERTAP:n.doubleClick&&i.onPointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&(h=R.a.POINTERDOUBLETAP),!h)||(o=new R.b(h,t,e),this._setRayOnPointerInfo(o),i.onPointerObservable.notifyObservers(o,h)),n.ignore||(o=new R.b(h=R.a.POINTERUP,t,e),this._setRayOnPointerInfo(o),i.onPointerObservable.notifyObservers(o,h))),i.onPointerUp&&!n.ignore&&i.onPointerUp(t,e,h)},e.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},e.prototype.attachControl=function(t,n,i){var o=this;void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=!0);var a=this._scene,s=a.getEngine().getRenderingCanvas();if(s){var l=a.getEngine();this._initActionManager=function(e,t){if(!o._meshPickProceed){var n=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers);o._currentPickResult=n,n&&(e=n.hit&&n.pickedMesh?n.pickedMesh._getActionManagerForTrigger():null),o._meshPickProceed=!0}return e},this._delayedSimpleClick=function(t,n,i){(Date.now()-o._previousStartingPointerTime>e.DoubleClickDelay&&!o._doubleClickOccured||t!==o._previousButtonPressed)&&(o._doubleClickOccured=!1,n.singleClick=!0,n.ignore=!1,i(n,o._currentPickResult))},this._initClickEvent=function(t,n,i,r){var a=new w;o._currentPickResult=null;var s=null,l=t.hasSpecificMask(R.a.POINTERPICK)||n.hasSpecificMask(R.a.POINTERPICK)||t.hasSpecificMask(R.a.POINTERTAP)||n.hasSpecificMask(R.a.POINTERTAP)||t.hasSpecificMask(R.a.POINTERDOUBLETAP)||n.hasSpecificMask(R.a.POINTERDOUBLETAP);!l&&M.a&&(s=o._initActionManager(s,a))&&(l=s.hasPickTriggers);var c=!1;if(l){var u=i.button;if(a.hasSwiped=o._isPointerSwiping(),!a.hasSwiped){var h=!e.ExclusiveDoubleClickMode;h||(h=!t.hasSpecificMask(R.a.POINTERDOUBLETAP)&&!n.hasSpecificMask(R.a.POINTERDOUBLETAP))&&!M.a.HasSpecificTrigger(x.a.ACTION_OnDoublePickTrigger)&&(s=o._initActionManager(s,a))&&(h=!s.hasSpecificTrigger(x.a.ACTION_OnDoublePickTrigger)),h?(Date.now()-o._previousStartingPointerTime>e.DoubleClickDelay||u!==o._previousButtonPressed)&&(a.singleClick=!0,r(a,o._currentPickResult),c=!0):(o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,o._delayedSimpleClickTimeout=window.setTimeout(o._delayedSimpleClick.bind(o,u,a,r),e.DoubleClickDelay));var d=t.hasSpecificMask(R.a.POINTERDOUBLETAP)||n.hasSpecificMask(R.a.POINTERDOUBLETAP);!d&&M.a.HasSpecificTrigger(x.a.ACTION_OnDoublePickTrigger)&&(s=o._initActionManager(s,a))&&(d=s.hasSpecificTrigger(x.a.ACTION_OnDoublePickTrigger)),d&&(u===o._previousButtonPressed&&Date.now()-o._previousStartingPointerTime<e.DoubleClickDelay&&!o._doubleClickOccured?(a.hasSwiped||o._isPointerSwiping()?(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=u,e.ExclusiveDoubleClickMode?(o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,r(a,o._previousPickResult)):r(a,o._currentPickResult)):(o._previousStartingPointerTime=0,o._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,e.ExclusiveDoubleClickMode&&o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,r(a,o._currentPickResult)),c=!0):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=u))}}c||r(a,o._currentPickResult)},this._onPointerMove=function(e){if(o._updatePointerPosition(e),!o._checkPrePointerObservable(null,e,e.type===o._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE)&&(a.cameraToUseForPointers||a.activeCamera)){a.pointerMovePredicate||(a.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||a.constantlyUpdateMeshUnderPointer||null!=e.actionManager)&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))});var t=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers);o._processPointerMove(t,e)}},this._onPointerDown=function(e){if(o._totalPointersPressed++,o._pickedDownMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(e),a.preventDefaultOnPointerDown&&s&&(e.preventDefault(),s.focus()),o._startingPointerPosition.x=o._pointerX,o._startingPointerPosition.y=o._pointerY,o._startingPointerTime=Date.now(),!o._checkPrePointerObservable(null,e,R.a.POINTERDOWN)&&(a.cameraToUseForPointers||a.activeCamera)){o._pointerCaptures[e.pointerId]=!0,a.pointerDownPredicate||(a.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),o._pickedDownMesh=null;var t=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers);o._processPointerDown(t,e)}},this._onPointerUp=function(e){0!==o._totalPointersPressed&&(o._totalPointersPressed--,o._pickedUpMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(e),a.preventDefaultOnPointerUp&&s&&(e.preventDefault(),s.focus()),o._initClickEvent(a.onPrePointerObservable,a.onPointerObservable,e,function(t,n){if(a.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&a.onPrePointerObservable.hasSpecificMask(R.a.POINTERTAP)&&o._checkPrePointerObservable(null,e,R.a.POINTERTAP))return;if(t.doubleClick&&a.onPrePointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&o._checkPrePointerObservable(null,e,R.a.POINTERDOUBLETAP))return}if(o._checkPrePointerObservable(null,e,R.a.POINTERUP))return}o._pointerCaptures[e.pointerId]&&(o._pointerCaptures[e.pointerId]=!1,(a.cameraToUseForPointers||a.activeCamera)&&(a.pointerUpPredicate||(a.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),!o._meshPickProceed&&(M.a&&M.a.HasTriggers||a.onPointerObservable.hasObservers())&&o._initActionManager(null,t),n||(n=o._currentPickResult),o._processPointerUp(n,e,t),o._previousPickResult=o._currentPickResult))}))},this._onKeyDown=function(e){var t=O.a.KEYDOWN;if(a.onPreKeyboardObservable.hasObservers()){var n=new O.c(t,e);if(a.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(n=new O.b(t,e),a.onKeyboardObservable.notifyObservers(n,t)),a.actionManager&&a.actionManager.processTrigger(x.a.ACTION_OnKeyDownTrigger,b.a.CreateNewFromScene(a,e))},this._onKeyUp=function(e){var t=O.a.KEYUP;if(a.onPreKeyboardObservable.hasObservers()){var n=new O.c(t,e);if(a.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(n=new O.b(t,e),a.onKeyboardObservable.notifyObservers(n,t)),a.actionManager&&a.actionManager.processTrigger(x.a.ACTION_OnKeyUpTrigger,b.a.CreateNewFromScene(a,e))},this._onCanvasFocusObserver=l.onCanvasFocusObservable.add(function(){s&&(s.addEventListener("keydown",o._onKeyDown,!1),s.addEventListener("keyup",o._onKeyUp,!1))}),this._onCanvasBlurObserver=l.onCanvasBlurObservable.add(function(){s&&(s.removeEventListener("keydown",o._onKeyDown),s.removeEventListener("keyup",o._onKeyUp))});var c=r.h.GetPointerPrefix();i&&(s.addEventListener(c+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",s.addEventListener(this._wheelEventName,this._onPointerMove,!1)),n&&s.addEventListener(c+"down",this._onPointerDown,!1),t&&window.addEventListener(c+"up",this._onPointerUp,!1)}},e.prototype.detachControl=function(){var e=r.h.GetPointerPrefix(),t=this._scene.getEngine().getRenderingCanvas(),n=this._scene.getEngine();t&&(t.removeEventListener(e+"move",this._onPointerMove),t.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&n.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&n.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp),t.style.cursor=this._scene.defaultCursor)},e.prototype.setPointerOverMesh=function(e){var t;this._pointerOverMesh!==e&&(this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(x.a.ACTION_OnPointerOutTrigger))&&t.processTrigger(x.a.ACTION_OnPointerOutTrigger,b.a.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(x.a.ACTION_OnPointerOverTrigger))&&t.processTrigger(x.a.ACTION_OnPointerOverTrigger,b.a.CreateNew(this._pointerOverMesh)))},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}();n.d(t,"a",function(){return D});var D=function(e){function t(n,i){var o=e.call(this)||this;return o._inputManager=new I(o),o.cameraToUseForPointers=null,o._isScene=!0,o.autoClear=!0,o.autoClearDepthAndStencil=!0,o.clearColor=new u.f(.2,.2,.3,1),o.ambientColor=new u.e(0,0,0),o._forceWireframe=!1,o._forcePointsCloud=!1,o.animationsEnabled=!0,o._animationPropertiesOverride=null,o.useConstantAnimationDeltaTime=!1,o.constantlyUpdateMeshUnderPointer=!1,o.hoverCursor="pointer",o.defaultCursor="",o.preventDefaultOnPointerDown=!0,o.preventDefaultOnPointerUp=!0,o.metadata=null,o.reservedDataStore=null,o.disableOfflineSupportExceptionRules=new Array,o.onDisposeObservable=new a.c,o._onDisposeObserver=null,o.onBeforeRenderObservable=new a.c,o._onBeforeRenderObserver=null,o.onAfterRenderObservable=new a.c,o._onAfterRenderObserver=null,o.onBeforeAnimationsObservable=new a.c,o.onAfterAnimationsObservable=new a.c,o.onBeforeDrawPhaseObservable=new a.c,o.onAfterDrawPhaseObservable=new a.c,o.onReadyObservable=new a.c,o.onBeforeCameraRenderObservable=new a.c,o._onBeforeCameraRenderObserver=null,o.onAfterCameraRenderObservable=new a.c,o._onAfterCameraRenderObserver=null,o.onBeforeActiveMeshesEvaluationObservable=new a.c,o.onAfterActiveMeshesEvaluationObservable=new a.c,o.onBeforeParticlesRenderingObservable=new a.c,o.onAfterParticlesRenderingObservable=new a.c,o.onDataLoadedObservable=new a.c,o.onNewCameraAddedObservable=new a.c,o.onCameraRemovedObservable=new a.c,o.onNewLightAddedObservable=new a.c,o.onLightRemovedObservable=new a.c,o.onNewGeometryAddedObservable=new a.c,o.onGeometryRemovedObservable=new a.c,o.onNewTransformNodeAddedObservable=new a.c,o.onTransformNodeRemovedObservable=new a.c,o.onNewMeshAddedObservable=new a.c,o.onMeshRemovedObservable=new a.c,o.onNewSkeletonAddedObservable=new a.c,o.onSkeletonRemovedObservable=new a.c,o.onNewMaterialAddedObservable=new a.c,o.onMaterialRemovedObservable=new a.c,o.onNewTextureAddedObservable=new a.c,o.onTextureRemovedObservable=new a.c,o.onBeforeRenderTargetsRenderObservable=new a.c,o.onAfterRenderTargetsRenderObservable=new a.c,o.onBeforeStepObservable=new a.c,o.onAfterStepObservable=new a.c,o.onActiveCameraChanged=new a.c,o.onBeforeRenderingGroupObservable=new a.c,o.onAfterRenderingGroupObservable=new a.c,o.onMeshImportedObservable=new a.c,o._registeredForLateAnimationBindings=new s.b(256),o.onPrePointerObservable=new a.c,o.onPointerObservable=new a.c,o.onPreKeyboardObservable=new a.c,o.onKeyboardObservable=new a.c,o._useRightHandedSystem=!1,o._timeAccumulator=0,o._currentStepId=0,o._currentInternalStep=0,o._fogEnabled=!0,o._fogMode=t.FOGMODE_NONE,o.fogColor=new u.e(.2,.2,.3),o.fogDensity=.1,o.fogStart=0,o.fogEnd=1e3,o._shadowsEnabled=!0,o._lightsEnabled=!0,o.activeCameras=new Array,o._texturesEnabled=!0,o.particlesEnabled=!0,o.spritesEnabled=!0,o._skeletonsEnabled=!0,o.lensFlaresEnabled=!0,o.collisionsEnabled=!0,o.gravity=new u.x(0,-9.807,0),o.postProcessesEnabled=!0,o.postProcesses=new Array,o.renderTargetsEnabled=!0,o.dumpNextRenderTargets=!1,o.customRenderTargets=new Array,o.importedMeshesFiles=new Array,o.probesEnabled=!0,o._meshesForIntersections=new s.b(256),o.proceduralTexturesEnabled=!0,o._totalVertices=new r.f,o._activeIndices=new r.f,o._activeParticles=new r.f,o._activeBones=new r.f,o._animationTime=0,o.animationTimeScale=1,o._renderId=0,o._frameId=0,o._executeWhenReadyTimeoutId=-1,o._intermediateRendering=!1,o._viewUpdateFlag=-1,o._projectionUpdateFlag=-1,o._toBeDisposed=new Array(256),o._activeRequests=new Array,o._pendingData=new Array,o._isDisposed=!1,o.dispatchAllSubMeshesOfActiveMeshes=!1,o._activeMeshes=new s.a(256),o._processedMaterials=new s.a(256),o._renderTargets=new s.b(256),o._activeParticleSystems=new s.a(256),o._activeSkeletons=new s.b(32),o._softwareSkinnedMeshes=new s.b(32),o._activeAnimatables=new Array,o._transformMatrix=u.j.Zero(),o.requireLightSorting=!1,o._components=[],o._serializableComponents=[],o._transientComponents=[],o._beforeCameraUpdateStage=E.b.Create(),o._beforeClearStage=E.b.Create(),o._gatherRenderTargetsStage=E.b.Create(),o._gatherActiveCameraRenderTargetsStage=E.b.Create(),o._isReadyForMeshStage=E.b.Create(),o._beforeEvaluateActiveMeshStage=E.b.Create(),o._evaluateSubMeshStage=E.b.Create(),o._activeMeshStage=E.b.Create(),o._cameraDrawRenderTargetStage=E.b.Create(),o._beforeCameraDrawStage=E.b.Create(),o._beforeRenderTargetDrawStage=E.b.Create(),o._beforeRenderingGroupDrawStage=E.b.Create(),o._beforeRenderingMeshStage=E.b.Create(),o._afterRenderingMeshStage=E.b.Create(),o._afterRenderingGroupDrawStage=E.b.Create(),o._afterCameraDrawStage=E.b.Create(),o._afterRenderTargetDrawStage=E.b.Create(),o._afterRenderStage=E.b.Create(),o._pointerMoveStage=E.b.Create(),o._pointerDownStage=E.b.Create(),o._pointerUpStage=E.b.Create(),o.geometriesByUniqueId=null,o._defaultMeshCandidates={data:[],length:0},o._defaultSubMeshCandidates={data:[],length:0},o._preventFreeActiveMeshesAndRenderingGroups=!1,o._activeMeshesFrozen=!1,o._allowPostProcessClearColor=!0,o.getDeterministicFrameTime=function(){return 1e3/60},o._blockMaterialDirtyMechanism=!1,o._engine=n||A.a.LastCreatedEngine,i&&i.virtual||(A.a._LastCreatedScene=o,o._engine.scenes.push(o)),o._uid=null,o._renderingManager=new T.b(o),y.a&&(o.postProcessManager=new y.a(o)),C.a.IsWindowObjectExist()&&o.attachControl(),o._createUbo(),g.a&&(o._imageProcessingConfiguration=new g.a),o.setDefaultCandidateProviders(),i&&!0===i.useGeometryUniqueIdsMap&&(o.geometriesByUniqueId={}),o.useMaterialMeshMap=i&&i.useGeometryUniqueIdsMap||!1,o.useClonedMeshhMap=i&&i.useClonedMeshhMap||!1,i&&i.virtual||o._engine.onNewSceneAddedObservable.notifyObservers(o),o}return i.d(t,e),t.DefaultMaterialFactory=function(e){throw P.a.WarnImport("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw P.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return I.DragMovementThreshold},set:function(e){I.DragMovementThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return I.LongPressDelay},set:function(e){I.LongPressDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return I.DoubleClickDelay},set:function(e){I.DoubleClickDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return I.ExclusiveDoubleClickMode},set:function(e){I.ExclusiveDoubleClickMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(x.a.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++)t[e].register();this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e),e.addFromContainer&&this._serializableComponents.push(e)},t.prototype._getComponent=function(e){for(var t=0,n=this._components;t<n.length;t++){var i=n[t];if(i.name===e)return i}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,t,n){return void 0===n&&(n=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==n},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this._sceneUbo=new m.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},t.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},t.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},t.prototype.simulatePointerUp=function(e,t,n){return this._inputManager.simulatePointerUp(e,t,n),this},t.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),this._inputManager.attachControl(e,t,n)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var n=this.meshes[e];if(n.isEnabled()&&n.subMeshes&&0!==n.subMeshes.length){if(!n.isReady(!0))return!1;for(var i="InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||t.getCaps().instancedArrays&&n.instances.length>0,r=0,o=this._isReadyForMeshStage;r<o.length;r++)if(!o[r].action(n,i))return!1}}for(e=0;e<this.geometries.length;e++)if(this.geometries[e].delayLoadState===x.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var a=0,s=this.activeCameras;a<s.length;a++)if(!s[a].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var l=0,c=this.particleSystems;l<c.length;l++)if(!c[l].isReady())return!1;return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var t=this,n=function(){e(),setTimeout(function(){t.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},t.prototype.executeOnceBeforeRender=function(e,t){var n=this;void 0!==t?setTimeout(function(){n._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this.isLoading,n=this._pendingData.indexOf(e);-1!==n&&this._pendingData.splice(n,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),t.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(t){e.executeWhenReady(function(){t()})})},t.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=o.a.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t,n,i){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?u.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=u.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,i):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.getUniqueId=function(){var e=t._uniqueIdCounter;return t._uniqueIdCounter++,e},t.prototype.addMesh=function(e,t){var n=this;void 0===t&&(t=!1),this.meshes.push(e),e._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){n.addMesh(e)})},t.prototype.removeMesh=function(e,t){var n=this;void 0===t&&(t=!1);var i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){n.removeMesh(e)}),i},t.prototype.addTransformNode=function(e){e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),this.onNewTransformNodeAddedObservable.notifyObservers(e)},t.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=n,n._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},t.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e)),t},t.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var n=0,i=this.meshes;n<i.length;n++)i[n]._removeLightSource(e);this.lights.splice(t,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var n=this.activeCameras.indexOf(e);return-1!==n&&this.activeCameras.splice(n,1),this.activeCamera===e&&(this.activeCamera=this.cameras.length>0?this.cameras[0]:null),this.onCameraRemovedObservable.notifyObservers(e),t},t.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},t.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},t.prototype.stopAnimation=function(e,t,n){},t.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},t.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},t.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[t]=n,n._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},t.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},t.prototype.addLight=function(e){this.lights.push(e),this.sortLightsByPriority();for(var t=0,n=this.meshes;t<n.length;t++){var i=n[t];-1===i.lightSources.indexOf(e)&&(i.lightSources.push(e),i._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(_.a.CompareLightsPriority)},t.prototype.addCamera=function(e){this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},t.prototype.addSkeleton=function(e){this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e)},t.prototype.addParticleSystem=function(e){this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this.multiMaterials.push(e)},t.prototype.addMaterial=function(e){e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e)},t.prototype.addMorphTargetManager=function(e){this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e)},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e)},t.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var n=this._engine.getRenderingCanvas();n&&(this.activeCamera&&this.activeCamera.detachControl(n),this.activeCamera=e,t&&e.attachControl(n))},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},t.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var n=this.skeletons[t],i=0;i<n.bones.length;i++)if(n.bones[i].id===e)return n.bones[i];return null},t.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var n=this.skeletons[t],i=0;i<n.bones.length;i++)if(n.bones[i].name===e)return n.bones[i];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},t.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===e)return this.geometries[n];return null},t.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId)||(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),0))},t.prototype.removeGeometry=function(e){var t;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];this.geometries[t]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},t.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},t.prototype.getTransformNodeByUniqueID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},t.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(t){return t.id===e})},t.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var n=this.getTransformNodeByID(e);if(n)return n;var i=this.getLightByID(e);return i||(this.getCameraByID(e)||this.getBoneByID(e)||null)},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var n=this.getTransformNodeByName(e);if(n)return n;var i=this.getLightByName(e);return i||(this.getCameraByName(e)||this.getBoneByName(e)||null)},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},t.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var n=this.morphTargetManagers[t],i=0;i<n.numTargets;++i){var r=n.getTarget(i);if(r.id===e)return r}return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=r.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),t.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new l.a),this._externalData.add(e,t)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new l.a),this._externalData.getOrAddWithFactory(e,t)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,t,n){if(n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var i=0,r=this._evaluateSubMeshStage;i<r.length;i++)r[i].action(t,e);var o=e.getMaterial();null!=o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._renderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._activeIndices.addCount(e.indexCount,!1),this._renderingManager.dispatch(e,t,o))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(){if(!this.activeCamera)return this;this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0;for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();return this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length)for(var e=this._activeMeshes.length,t=0;t<e;t++)(a=this._activeMeshes.data[t]).computeWorldMatrix();else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var n=0,i=this._beforeEvaluateActiveMeshStage;n<i.length;n++)i[n].action();var r=this.getActiveMeshCandidates(),o=r.length;for(t=0;t<o;t++){var a;if(!(a=r.data[t]).isBlocked&&(this._totalVertices.addCount(a.getTotalVertices(),!1),a.isReady()&&a.isEnabled()&&0!==a.scaling.lengthSquared())){a.computeWorldMatrix(),a.actionManager&&a.actionManager.hasSpecificTriggers2(x.a.ACTION_OnIntersectionEnterTrigger,x.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(a);var s=this.customLODSelector?this.customLODSelector(a,this.activeCamera):a.getLOD(this.activeCamera);null!=s&&(s!==a&&s.billboardMode!==h.a.BILLBOARDMODE_NONE&&s.computeWorldMatrix(),a._preActivate(),a.isVisible&&a.visibility>0&&0!=(a.layerMask&this.activeCamera.layerMask)&&(a.alwaysSelectAsActiveMesh||a.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(a),this.activeCamera._activeMeshes.push(a),s!==a&&s._activate(this._renderId,!1),a._activate(this._renderId,!1)&&(a.isAnInstance||(s._internalAbstractMeshDataInfo._onlyForInstances=!1),s._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(a,s)),a._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var l=0;l<this.particleSystems.length;l++){var c=this.particleSystems[l];if(c.isStarted()&&c.emitter){var u=c.emitter;u.position&&!u.isEnabled()||(this._activeParticleSystems.push(c),c.animate(),this._renderingManager.dispatchParticles(c))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!=t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var n=0,i=this._activeMeshStage;n<i.length;n++)i[n].action(e,t);if(null!=t&&null!=t.subMeshes&&t.subMeshes.length>0)for(var r=this.getActiveSubMeshCandidates(t),o=r.length,a=0;a<o;a++)this._evaluateSubMesh(r.data[a],t,e)},t.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var e=this.activeCamera.outputRenderTarget.getInternalTexture();e?this.getEngine().bindFramebuffer(e):S.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},t.prototype._renderForCamera=function(e,t){if(!e||!e._skipRendering){var n=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var i=0;i<this._softwareSkinnedMeshes.length;i++){var o=this._softwareSkinnedMeshes.data[i];o.applySkeleton(o.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets);for(var a=0,s=this._gatherActiveCameraRenderTargetsStage;a<s.length;a++)s[a].action(this._renderTargets);if(this.renderTargetsEnabled){this._intermediateRendering=!0;var l=!1;if(this._renderTargets.length>0){r.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var c=0;c<this._renderTargets.length;c++){var u=this._renderTargets.data[c];u._shouldRender()&&(this._renderId++,u.render(u.activeCamera&&u.activeCamera!==this.activeCamera,this.dumpNextRenderTargets),l=!0)}r.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var h=0,d=this._cameraDrawRenderTargetStage;h<d.length;h++)l=d[h].action(this.activeCamera)||l;this._intermediateRendering=!1,l&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._prepareFrame();for(var f=0,p=this._beforeCameraDrawStage;f<p.length;f++)p[f].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var g=0,m=this._afterCameraDrawStage;g<m.length;g++)m[g].action(this.activeCamera);this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e){if(e.cameraRigMode===f.a.RIG_MODE_NONE||e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)this._renderForCamera(e);else{if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix())}},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var n=0;t.actionManager&&n<t.actionManager.actions.length;n++){var i=t.actionManager.actions[n];if(i.trigger===x.a.ACTION_OnIntersectionEnterTrigger||i.trigger===x.a.ACTION_OnIntersectionExitTrigger){var r=i.getTriggerParameter(),o=r instanceof d.a?r:r.mesh,a=o.intersectsMesh(t,r.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(o);a&&-1===s?i.trigger===x.a.ACTION_OnIntersectionEnterTrigger?(i._executeCurrent(b.a.CreateNew(t,void 0,o)),t._intersectionsInProgress.push(o)):i.trigger===x.a.ACTION_OnIntersectionExitTrigger&&t._intersectionsInProgress.push(o):!a&&s>-1&&(i.trigger===x.a.ACTION_OnIntersectionExitTrigger&&i._executeCurrent(b.a.CreateNew(t,void 0,o)),t.actionManager.hasSpecificTrigger(x.a.ACTION_OnIntersectionExitTrigger,function(e){return o===(e instanceof d.a?e:e.mesh)})&&i.trigger!==x.a.ACTION_OnIntersectionExitTrigger||t._intersectionsInProgress.splice(s,1))}}}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,n=this.getDeterministicFrameTime(),i=0,r=this._engine.getLockstepMaxSteps(),o=Math.floor(e/60);o=Math.min(o,r);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(n),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,i++,e-=n}while(e>0&&i<o);this._timeAccumulator=e<0?0:e}else e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime)),this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(e)},t.prototype.render=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(x.a.ACTION_OnEveryFrameTrigger),t||this.animate();for(var n=0,i=this._beforeCameraUpdateStage;n<i.length;n++)i[n].action();if(e)if(this.activeCameras.length>0)for(var o=0;o<this.activeCameras.length;o++){var a=this.activeCameras[o];if(a.update(),a.cameraRigMode!==f.a.RIG_MODE_NONE)for(var s=0;s<a._rigCameras.length;s++)a._rigCameras[s].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==f.a.RIG_MODE_NONE))for(s=0;s<this.activeCamera._rigCameras.length;s++)this.activeCamera._rigCameras[s].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var l=this.getEngine(),c=this.activeCamera;if(this.renderTargetsEnabled){r.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var u=0;u<this.customRenderTargets.length;u++){var h=this.customRenderTargets[u];if(h._shouldRender()){if(this._renderId++,this.activeCamera=h.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");l.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),h.render(c!==this.activeCamera,this.dumpNextRenderTargets)}}r.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=c,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,p=this._beforeClearStage;d<p.length;d++)p[d].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var g=0,m=this._gatherRenderTargetsStage;g<m.length;g++)m[g].action(this._renderTargets);if(this.activeCameras.length>0)for(o=0;o<this.activeCameras.length;o++)o>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[o]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var _=0,v=this._afterRenderStage;_<v.length;_++)v[_].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(s=0;s<this._toBeDisposed.length;s++){var b=this._toBeDisposed[s];b&&b.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++)t[e].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var n=0,i=this._activeRequests;n<i.length;n++)i[n].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var r,o=this._engine.getRenderingCanvas();if(o)for(r=0;r<this.cameras.length;r++)this.cameras[r].detachControl(o);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(r=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(r,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var n in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(n)&&(t._vertexBuffers[n]._buffer._data=null)}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var n=t[e];n._buffer&&(n._buffer=null)}},t.prototype.getWorldExtends=function(e){var t=new u.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new u.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return this.meshes.filter(e=e||function(){return!0}).forEach(function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var i=e.getBoundingInfo(),o=i.boundingBox.maximumWorld;r.h.CheckExtends(i.boundingBox.minimumWorld,t,n),r.h.CheckExtends(o,t,n)}}),{min:t,max:n}},t.prototype.createPickingRay=function(e,t,n,i,r){throw void 0===r&&(r=!1),P.a.WarnImport("Ray")},t.prototype.createPickingRayToRef=function(e,t,n,i,r,o){throw void 0===o&&(o=!1),P.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,t,n){throw P.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,t,n,i){throw P.a.WarnImport("Ray")},t.prototype.pick=function(e,t,n,i,r,o){var a=new v.a;return a._pickingUnavailable=!0,a},t.prototype.pickWithRay=function(e,t,n,i){throw P.a.WarnImport("Ray")},t.prototype.multiPick=function(e,t,n,i,r){throw P.a.WarnImport("Ray")},t.prototype.multiPickWithRay=function(e,t,n){throw P.a.WarnImport("Ray")},t.prototype.setPointerOverMesh=function(e){this._inputManager.setPointerOverMesh(e)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++)t[e]._rebuild();for(var n=0,i=this.meshes;n<i.length;n++)i[n]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var r=0,o=this._components;r<o.length;r++)o[r].rebuild();for(var a=0,s=this.particleSystems;a<s.length;a++)s[a].rebuild()},t.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e]._rebuild();this.markAllMaterialsAsDirty(x.a.MATERIAL_TextureDirtyFlag)},t.prototype._getByTags=function(e,t,n){if(void 0===t)return e;var i=[];for(var r in n=n||function(e){},e){var o=e[r];c.a&&c.a.MatchesQuery(o,t)&&(i.push(o),n(o))}return i},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t.prototype.setRenderingOrder=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,n,i)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,n,i)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(x.a.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var n=0,i=this.materials;n<i.length;n++){var r=i[n];t&&!t(r)||r.markAsDirty(e)}},t.prototype._loadFile=function(e,t,n,i,o,a){var s=this,l=r.h.LoadFile(e,t,n,i?this.offlineProvider:void 0,o,a);return this._activeRequests.push(l),l.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),l},t.prototype._loadFileAsync=function(e,t,n){var i=this;return new Promise(function(r,o){i._loadFile(e,function(e){r(e)},void 0,t,n,function(e,t){o(t)})})},t._uniqueIdCounter=0,t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return l});var i=n(1),r=n(0),o=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),a=function(e,t){this.type=e,this.event=t},s=function(e){function t(t,n,i,o){var a=e.call(this,t,n)||this;return a.ray=null,a.skipOnPointerObservable=!1,a.localPosition=new r.w(i,o),a}return i.d(t,e),t}(a),l=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.pickInfo=i,r}return i.d(t,e),t}(a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(10),r=n(3),o=function(){function e(){}return Object.defineProperty(e,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,i.b.MarkAllMaterialsAsDirty(r.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),e._DiffuseTextureEnabled=!0,e._AmbientTextureEnabled=!0,e._OpacityTextureEnabled=!0,e._ReflectionTextureEnabled=!0,e._EmissiveTextureEnabled=!0,e._SpecularTextureEnabled=!0,e._BumpTextureEnabled=!0,e._LightmapTextureEnabled=!0,e._RefractionTextureEnabled=!0,e._ColorGradingTextureEnabled=!0,e._FresnelEnabled=!0,e._ClearCoatTextureEnabled=!0,e._ClearCoatBumpTextureEnabled=!0,e._ClearCoatTintTextureEnabled=!0,e._SheenTextureEnabled=!0,e._AnisotropicTextureEnabled=!0,e._ThicknessTextureEnabled=!0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(1),r=n(2),o=n(9),a=n(8),s=n(0),l=n(23),c=n(49),u=n(63),h=n(3),d=n(6),f=function(){function e(t,n,i){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new a.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=h.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._wasPreviouslyReady=!1,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=t,this.id=t||o.h.RandomId(),this._scene=n||l.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this.sideOrientation=this._scene.useRightHandedSystem?e.ClockWiseSideOrientation:e.CounterClockWiseSideOrientation,this._uniformBuffer=new u.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alpha=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new a.c),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new a.c),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return"Name: "+this.name},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(e,t){return!0},e.prototype.isReadyForSubMesh=function(e,t,n){return!1},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){this._wasPreviouslyReady=!1},e.prototype._preBind=function(t,n){void 0===n&&(n=null);var i=this._scene.getEngine(),r=(null==n?this.sideOrientation:n)===e.ClockWiseSideOrientation;return i.enableEffect(t||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,r),r},e.prototype.bind=function(e,t){},e.prototype.bindForSubMesh=function(e,t,n){},e.prototype.bindOnlyWorldMatrix=function(e){},e.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},e.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},e.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},e.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}},e.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},e.prototype.getActiveTextures=function(){return[]},e.prototype.hasTexture=function(e){return!1},e.prototype.clone=function(e){return null},e.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var n in this.meshMap){var i=this.meshMap[n];i&&t.push(i)}return t}return this._scene.meshes.filter(function(t){return t.material===e})},e.prototype.forceCompilation=function(e,t,n){var r=this,o=i.a({clipPlane:!1},n),a=new c.a,l=this.getScene(),u=function(){if(r._scene&&r._scene.getEngine()){a._materialDefines&&(a._materialDefines._renderId=-1);var n=l.clipPlane;o.clipPlane&&(l.clipPlane=new s.n(0,0,0,1)),r._storeEffectOnSubMeshes?r.isReadyForSubMesh(e,a)?t&&t(r):setTimeout(u,16):r.isReady()?t&&t(r):setTimeout(u,16),o.clipPlane&&(l.clipPlane=n)}};u()},e.prototype.forceCompilationAsync=function(e,t){var n=this;return new Promise(function(i){n.forceCompilation(e,function(){i()},t)})},e.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,n=this.getScene().meshes;t<n.length;t++){var i=n[t];if(i.subMeshes)for(var r=0,o=i.subMeshes;r<o.length;r++){var a=o[r];a.getMaterial()===this&&a._materialDefines&&e(a._materialDefines)}}},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.dispose=function(e,t,n){var i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),!0!==n)if(this.meshMap)for(var r in this.meshMap)(s=this.meshMap[r])&&(s.material=null,this.releaseVertexArrayObject(s,e));else for(var o=0,a=i.meshes;o<a.length;o++){var s;(s=a[o]).material!==this||s.sourceMesh||(s.material=null,this.releaseVertexArrayObject(s,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},e.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var n=e.geometry;if(this._storeEffectOnSubMeshes)for(var i=0,r=e.subMeshes;i<r.length;i++){var o=r[i];n._releaseVertexArrayObject(o._materialEffect),t&&o._materialEffect&&o._materialEffect.dispose()}else n._releaseVertexArrayObject(this._effect)}},e.prototype.serialize=function(){return r.a.Serialize(this)},e.Parse=function(e,t,n){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";return o.h.Instantiate(e.customType).Parse(e,t,n)},e.TriangleFillMode=h.a.MATERIAL_TriangleFillMode,e.WireFrameFillMode=h.a.MATERIAL_WireFrameFillMode,e.PointFillMode=h.a.MATERIAL_PointFillMode,e.PointListDrawMode=h.a.MATERIAL_PointListDrawMode,e.LineListDrawMode=h.a.MATERIAL_LineListDrawMode,e.LineLoopDrawMode=h.a.MATERIAL_LineLoopDrawMode,e.LineStripDrawMode=h.a.MATERIAL_LineStripDrawMode,e.TriangleStripDrawMode=h.a.MATERIAL_TriangleStripDrawMode,e.TriangleFanDrawMode=h.a.MATERIAL_TriangleFanDrawMode,e.ClockWiseSideOrientation=h.a.MATERIAL_ClockWiseSideOrientation,e.CounterClockWiseSideOrientation=h.a.MATERIAL_CounterClockWiseSideOrientation,e.TextureDirtyFlag=h.a.MATERIAL_TextureDirtyFlag,e.LightDirtyFlag=h.a.MATERIAL_LightDirtyFlag,e.FresnelDirtyFlag=h.a.MATERIAL_FresnelDirtyFlag,e.AttributesDirtyFlag=h.a.MATERIAL_AttributesDirtyFlag,e.MiscDirtyFlag=h.a.MATERIAL_MiscDirtyFlag,e.AllDirtyFlag=h.a.MATERIAL_AllDirtyFlag,e._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},e._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},e._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},e._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(t){e._FresnelDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._TextureAndMiscDirtyCallBack=function(t){e._TextureDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(t){for(var n=0,i=e._DirtyCallbackArray;n<i.length;n++)(0,i[n])(t)},i.c([Object(r.c)()],e.prototype,"id",void 0),i.c([Object(r.c)()],e.prototype,"uniqueId",void 0),i.c([Object(r.c)()],e.prototype,"name",void 0),i.c([Object(r.c)()],e.prototype,"checkReadyOnEveryCall",void 0),i.c([Object(r.c)()],e.prototype,"checkReadyOnlyOnce",void 0),i.c([Object(r.c)()],e.prototype,"state",void 0),i.c([Object(r.c)("alpha")],e.prototype,"_alpha",void 0),i.c([Object(r.c)("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),i.c([Object(r.c)()],e.prototype,"sideOrientation",void 0),i.c([Object(r.c)("alphaMode")],e.prototype,"_alphaMode",void 0),i.c([Object(r.c)()],e.prototype,"_needDepthPrePass",void 0),i.c([Object(r.c)()],e.prototype,"disableDepthWrite",void 0),i.c([Object(r.c)()],e.prototype,"forceDepthWrite",void 0),i.c([Object(r.c)()],e.prototype,"separateCullingPass",void 0),i.c([Object(r.c)("fogEnabled")],e.prototype,"_fogEnabled",void 0),i.c([Object(r.c)()],e.prototype,"pointSize",void 0),i.c([Object(r.c)()],e.prototype,"zOffset",void 0),i.c([Object(r.c)()],e.prototype,"wireframe",null),i.c([Object(r.c)()],e.prototype,"pointsCloud",null),i.c([Object(r.c)()],e.prototype,"fillMode",null),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(1),r=n(2),o=n(28),a=n(9),s=n(8),l=n(0),c=n(25),u=n(6),h=n(22),d=n(19),f=function(e){function t(n,i,r,a){void 0===a&&(a=!0);var c=e.call(this,n,r)||this;return c._position=l.x.Zero(),c.upVector=l.x.Up(),c.orthoLeft=null,c.orthoRight=null,c.orthoBottom=null,c.orthoTop=null,c.fov=.8,c.minZ=1,c.maxZ=1e4,c.inertia=.9,c.mode=t.PERSPECTIVE_CAMERA,c.isIntermediate=!1,c.viewport=new l.z(0,0,1,1),c.layerMask=268435455,c.fovMode=t.FOVMODE_VERTICAL_FIXED,c.cameraRigMode=t.RIG_MODE_NONE,c.customRenderTargets=new Array,c.outputRenderTarget=null,c.onViewMatrixChangedObservable=new s.c,c.onProjectionMatrixChangedObservable=new s.c,c.onAfterCheckInputsObservable=new s.c,c.onRestoreStateObservable=new s.c,c._rigCameras=new Array,c._webvrViewMatrix=l.j.Identity(),c._skipRendering=!1,c._projectionMatrix=new l.j,c._postProcesses=new Array,c._activeMeshes=new o.a(256),c._globalPosition=l.x.Zero(),c._computedViewMatrix=l.j.Identity(),c._doNotComputeProjectionMatrix=!1,c._transformMatrix=l.j.Zero(),c._refreshFrustumPlanes=!0,c._isCamera=!0,c._isLeftCamera=!1,c._isRightCamera=!0,c.getScene().addCamera(c),a&&!c.getScene().activeCamera&&(c.getScene().activeCamera=c),c.position=i,c}return i.d(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},t.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype.isReady=function(t){if(void 0===t&&(t=!1),t)for(var n=0,i=this._postProcesses;n<i.length;n++){var r=i[n];if(r&&!r.isReady())return!1}return e.prototype.isReady.call(this,t)},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=new l.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new l.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},t.prototype._isSynchronizedProjectionMatrix=function(){if(!(this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ))return!1;var e=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===e.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===e.getRenderWidth()&&this._cache.renderHeight===e.getRenderHeight()},t.prototype.attachControl=function(e,t){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,n=this._rigCameras.length;t<n;t++){var i=this._rigCameras[t],r=i._rigPostProcess;r?("pass"===r.getEffectName()&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty()):i._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,t){return void 0===t&&(t=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(u.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},t.prototype._getViewMatrix=function(){return l.j.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var n=this.getEngine(),i=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=n.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),i.useRightHandedSystem?l.j.PerspectiveFovRHToRef(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED):l.j.PerspectiveFovLHToRef(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED);else{var r=n.getRenderWidth()/2,o=n.getRenderHeight()/2;i.useRightHandedSystem?l.j.OrthoOffCenterRHToRef(this.orthoLeft||-r,this.orthoRight||r,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix):l.j.OrthoOffCenterLHToRef(this.orthoLeft||-r,this.orthoRight||r,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=n.getRenderWidth(),this._cache.renderHeight=n.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?l.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=l.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,t){if(void 0===t&&(t=!1),this._updateFrustumPlanes(),t&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(t){t._updateFrustumPlanes(),n=n||e.isInFrustum(t._frustumPlanes)}),n}return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,t,n){throw void 0===e&&(e=100),d.a.WarnImport("Ray")},t.prototype.dispose=function(n,i){for(void 0===i&&(i=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var r=this._rigCameras.pop();r&&r.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var o=this._postProcesses.length;--o>=0;){var a=this._postProcesses[o];a&&a.dispose(this)}for(o=this.customRenderTargets.length;--o>=0;)this.customRenderTargets[o].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),e.prototype.dispose.call(this,n,i)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,n){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var r=this.createRigCamera(this.name+"_L",0);r&&(r._isLeftCamera=!0);var o=this.createRigCamera(this.name+"_R",1);o&&(o._isRightCamera=!0),r&&o&&(this._rigCameras.push(r),this._rigCameras.push(o))}switch(this.cameraRigMode){case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:t._setStereoscopicAnaglyphRigMode(this);break;case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:t._setStereoscopicRigMode(this);break;case t.RIG_MODE_VR:t._setVRRigMode(this,n);break;case t.RIG_MODE_WEBVR:t._setWebVRRigMode(this,n)}this._cascadePostProcessesToRigCams(),this.update()}},t._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},t._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},t._setVRRigMode=function(e,t){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},t._setWebVRRigMode=function(e,t){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},t.prototype._getVRProjectionMatrix=function(){return l.j.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return l.j.Identity()},t.prototype._getWebVRViewMatrix=function(){return l.j.Identity()},t.prototype.setCameraRigParameter=function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(t/.0637))},t.prototype.createRigCamera=function(e,t){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=r.a.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),r.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.prototype.clone=function(e){return r.a.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},t.prototype.getDirection=function(e){var t=l.x.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){l.x.TransformNormalToRef(e,this.getWorldMatrix(),t)},t.GetConstructorFromName=function(e,n,i,r,o){return void 0===r&&(r=0),void 0===o&&(o=!0),c.a.Construct(e,n,i,{interaxial_distance:r,isStereoscopicSideBySide:o})||function(){return t._createDefaultParsedCamera(n,i)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,n){var i=t.GetConstructorFromName(e.type,e.name,n,e.interaxial_distance,e.isStereoscopicSideBySide),o=r.a.Parse(i,e,n);if(e.parentId&&(o._waitingParentId=e.parentId),o.inputs&&(o.inputs.parse(e),o._setupInputs()),o.setPosition&&(o.position.copyFromFloats(0,0,0),o.setPosition(l.x.FromArray(e.position))),e.target&&o.setTarget&&o.setTarget(l.x.FromArray(e.target)),e.cameraRigMode&&o.setCameraRigMode(e.cameraRigMode,e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{}),e.animations){for(var a=0;a<e.animations.length;a++){var s=e.animations[a],u=h.a.GetClass("BABYLON.Animation");u&&o.animations.push(u.Parse(s))}c.a.ParseAnimationRanges(o,e,n)}return e.autoAnimate&&n.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},t._createDefaultParsedCamera=function(e,t){throw d.a.WarnImport("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,i.c([Object(r.o)("position")],t.prototype,"_position",void 0),i.c([Object(r.o)()],t.prototype,"upVector",void 0),i.c([Object(r.c)()],t.prototype,"orthoLeft",void 0),i.c([Object(r.c)()],t.prototype,"orthoRight",void 0),i.c([Object(r.c)()],t.prototype,"orthoBottom",void 0),i.c([Object(r.c)()],t.prototype,"orthoTop",void 0),i.c([Object(r.c)()],t.prototype,"fov",void 0),i.c([Object(r.c)()],t.prototype,"minZ",void 0),i.c([Object(r.c)()],t.prototype,"maxZ",void 0),i.c([Object(r.c)()],t.prototype,"inertia",void 0),i.c([Object(r.c)()],t.prototype,"mode",void 0),i.c([Object(r.c)()],t.prototype,"layerMask",void 0),i.c([Object(r.c)()],t.prototype,"fovMode",void 0),i.c([Object(r.c)()],t.prototype,"cameraRigMode",void 0),i.c([Object(r.c)()],t.prototype,"interaxialDistance",void 0),i.c([Object(r.c)()],t.prototype,"isStereoscopicSideBySide",void 0),t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var i=n(1),r=n(9),o=n(8),a=n(0),s=n(10),l=n(4),c=n(13),u=n(42),h=n(50),d=n(43),f=n(3),p=n(108),g=n(19),m=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=a.x.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},_=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new m,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1},v=function(e){function t(n,i){void 0===i&&(i=null);var r=e.call(this,n,i,!1)||this;return r._internalAbstractMeshDataInfo=new _,r.cullingStrategy=t.CULLINGSTRATEGY_STANDARD,r.onCollideObservable=new o.c,r.onCollisionPositionChangeObservable=new o.c,r.onMaterialChangedObservable=new o.c,r.definedFacingForward=!0,r._occlusionQuery=null,r._renderingGroup=null,r.alphaIndex=Number.MAX_VALUE,r.isVisible=!0,r.isPickable=!0,r.showSubMeshesBoundingBox=!1,r.isBlocker=!1,r.enablePointerMoveEvents=!1,r.renderingGroupId=0,r._material=null,r.outlineColor=a.e.Red(),r.outlineWidth=.02,r.overlayColor=a.e.Red(),r.overlayAlpha=.5,r.useOctreeForRenderingSelection=!0,r.useOctreeForPicking=!0,r.useOctreeForCollisions=!0,r.alwaysSelectAsActiveMesh=!1,r.doNotSyncBoundingInfo=!1,r.actionManager=null,r._meshCollisionData=new p.a,r.ellipsoid=new a.x(.5,1,.5),r.ellipsoidOffset=new a.x(0,0,0),r.edgesWidth=1,r.edgesColor=new a.f(1,0,0,1),r._edgesRenderer=null,r._masterMesh=null,r._boundingInfo=null,r._renderId=0,r._intersectionsInProgress=new Array,r._unIndexed=!1,r._lightSources=new Array,r._waitingData={lods:null,actions:null,freezeWorldMatrix:null},r._bonesTransformMatrices=null,r.onRebuildObservable=new o.c,r._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),t.subtractToRef(r._meshCollisionData._oldPositionForCollisions,r._meshCollisionData._diffPositionForCollisions),r._meshCollisionData._diffPositionForCollisions.length()>s.b.CollisionsEpsilon&&r.position.addInPlace(r._meshCollisionData._diffPositionForCollisions),n&&r.onCollideObservable.notifyObservers(n),r.onCollisionPositionChangeObservable.notifyObservers(r.position)},r.getScene().addMesh(r),r._resyncLightSources(),r}return i.d(t,e),Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return u.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return u.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return u.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return u.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return u.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(t){return!!e.prototype._updateNonUniformScalingState.call(this,t)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(t.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(t+=", skeleton: "+n.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==u.a.BILLBOARDMODE_NONE?this._masterMesh:e.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(e,t){if(void 0===t&&(t=!0),this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},t.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++)t[e]._rebuild()},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,t=this.getScene().lights;e<t.length;e++){var n=t[e];n.isEnabled()&&n.canAffectMesh(this)&&this._lightSources.push(n)}this._markSubMeshesAsLightDirty()},t.prototype._resyncLighSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e);if(-1===n){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty()},t.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++)t[e].setEffect(null)},t.prototype._removeLightSource=function(e){var t=this._lightSources.indexOf(e);-1!==t&&(this._lightSources.splice(t,1),this._markSubMeshesAsLightDirty())},t.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,n=this.subMeshes;t<n.length;t++){var i=n[t];i._materialDefines&&e(i._materialDefines)}},t.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty()})},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},t.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){var n=t[e].getMaterial();n&&n.markAsDirty(f.a.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(e){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(e){return null},t.prototype.setVerticesData=function(e,t,n,i){return this},t.prototype.updateVerticesData=function(e,t,n,i){return this},t.prototype.setIndices=function(e,t){return this},t.prototype.isVerticesDataPresent=function(e){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},t.prototype.normalizeToUnitCube=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1);var n=null,i=null;t&&(this.rotationQuaternion?(i=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(n=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var r=this.getHierarchyBoundingVectors(e),o=r.max.subtract(r.min),a=Math.max(o.x,o.y,o.z);return 0===a?this:(this.scaling.scaleInPlace(1/a),t&&(this.rotationQuaternion&&i?this.rotationQuaternion.copyFrom(i):this.rotation&&n&&this.rotation.copyFrom(n)),this)},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(l.b.MatricesIndicesKind)&&this.isVerticesDataPresent(l.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(e){},t.prototype._activate=function(e,t){return this._renderId=e,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===u.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():e.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():e.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.movePOV=function(e,t,n){return this.position.addInPlace(this.calcMovePOV(e,t,n)),this},t.prototype.calcMovePOV=function(e,t,n){var i=new a.j;(this.rotationQuaternion?this.rotationQuaternion:a.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(i);var r=a.x.Zero(),o=this.definedFacingForward?-1:1;return a.x.TransformCoordinatesFromFloatsToRef(e*o,t,n*o,i,r),r},t.prototype.rotatePOV=function(e,t,n){return this.rotation.addInPlace(this.calcRotatePOV(e,t,n)),this},t.prototype.calcRotatePOV=function(e,t,n){var i=this.definedFacingForward?1:-1;return new a.x(e*i,t,n*i)},t.prototype.refreshBoundingInfo=function(e){return void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(e),null),this)},t.prototype._refreshBoundingInfo=function(e,t){if(e){var n=r.h.ExtractMinAndMax(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new d.a(n.minimum,n.maximum)}if(this.subMeshes)for(var i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()},t.prototype._getPositionData=function(e){var t=this.getVerticesData(l.b.PositionKind);if(t&&e&&this.skeleton){t=r.h.Slice(t),this._generatePointsArray();var n=this.getVerticesData(l.b.MatricesIndicesKind),i=this.getVerticesData(l.b.MatricesWeightsKind);if(i&&n){var o=this.numBoneInfluencers>4,s=o?this.getVerticesData(l.b.MatricesIndicesExtraKind):null,c=o?this.getVerticesData(l.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var u=this.skeleton.getTransformMatrices(this),h=a.t.Vector3[0],d=a.t.Matrix[0],f=a.t.Matrix[1],p=0,g=0;g<t.length;g+=3,p+=4){var m,_;for(d.reset(),m=0;m<4;m++)(_=i[p+m])>0&&(a.j.FromFloat32ArrayToRefScaled(u,Math.floor(16*n[p+m]),_,f),d.addToSelf(f));if(o)for(m=0;m<4;m++)(_=c[p+m])>0&&(a.j.FromFloat32ArrayToRefScaled(u,Math.floor(16*s[p+m]),_,f),d.addToSelf(f));a.x.TransformCoordinatesFromFloatsToRef(t[g],t[g+1],t[g+2],d,h),h.toArray(t,g),this._positions&&this._positions[g/3].copyFrom(h)}}}return t},t.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new d.a(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,n=0;n<t;n++){var i=this.subMeshes[n];(t>1||!i.IsGlobal)&&i.updateBoundingInfo(e)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(t.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),t.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},t.prototype.intersectsMesh=function(e,t,n){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return!0;if(n)for(var i=0,r=this.getChildMeshes();i<r.length;i++)if(r[i].intersectsMesh(e,t,!0))return!0;return!1},t.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),t.prototype.moveWithCollisions=function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=t.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(e,t,n){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var i=e.verticesStart+e.verticesCount,r=e.verticesStart;r<i;r++)e._lastColliderWorldVertices.push(a.x.TransformCoordinates(this._positions[r],t))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial()),n.collisionFound&&(n.collidedMesh=this),this},t.prototype._processCollisionsForSubMeshes=function(e,t){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),i=n.length,r=0;r<i;r++){var o=n.data[r];i>1&&!o._checkCollision(e)||this._collideForSubMesh(o,t,e)}return this},t.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var t=a.t.Matrix[0],n=a.t.Matrix[1];return a.j.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,n),this._processCollisionsForSubMeshes(e,n),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(e,t,n){var i=new h.a,r="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,o=this._boundingInfo;if(!(this.subMeshes&&o&&e.intersectsSphere(o.boundingSphere,r)&&e.intersectsBox(o.boundingBox,r)))return i;if(!this._generatePointsArray())return i;for(var s=null,l=this._scene.getIntersectingSubMeshCandidates(this,e),c=l.length,u=0;u<c;u++){var d=l.data[u];if(!(c>1)||d.canIntersects(e)){var f=d.intersects(e,this._positions,this.getIndices(),t,n);if(f&&(t||!s||f.distance<s.distance)&&((s=f).subMeshId=u,t))break}}if(s){var p=this.getWorldMatrix(),g=a.t.Vector3[0],m=a.t.Vector3[1];a.x.TransformCoordinatesToRef(e.origin,p,g),e.direction.scaleToRef(s.distance,m);var _=a.x.TransformNormal(m,p).addInPlace(g);return i.hit=!0,i.distance=a.x.Distance(g,_),i.pickedPoint=_,i.pickedMesh=this,i.bu=s.bu||0,i.bv=s.bv||0,i.faceId=s.faceId,i.subMeshId=s.subMeshId,i}return i},t.prototype.clone=function(e,t,n){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(t,n){var i,r=this;for(void 0===n&&(n=!1),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),null!=this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,i=0;i<this._intersectionsInProgress.length;i++){var o=this._intersectionsInProgress[i],a=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(a,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(r);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(r))&&e.excludedMeshes.splice(t,1);var n=e.getShadowGenerator();if(n){var i=n.getShadowMap();i&&i.renderList&&-1!==(t=i.renderList.indexOf(r))&&i.renderList.splice(t,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),n&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),e.prototype.dispose.call(this,t,n)},t.prototype.addChild=function(e){return e.setParent(this),this},t.prototype.removeChild=function(e){return e.setParent(null),this},t.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=a.x.Zero(),e.facetPositions[t]=a.x.Zero();return e.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(l.b.PositionKind),n=this.getIndices(),i=this.getVerticesData(l.b.NormalKind),r=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var o=!1,s=0;s<n.length;s++)if(n[s]>65535){o=!0;break}e.depthSortedIndices=o?new Uint32Array(n):new Uint16Array(n)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var u=this.getScene().activeCamera;e.facetDepthSortFrom=u?u.position:a.x.Zero()}e.depthSortedFacets=[];for(var h=0;h<e.facetNb;h++)e.depthSortedFacets.push({ind:3*h,sqDistance:0});e.invertedMatrix=a.j.Identity(),e.facetDepthSortOrigin=a.x.Zero()}e.bbSize.x=r.maximum.x-r.minimum.x>a.h?r.maximum.x-r.minimum.x:a.h,e.bbSize.y=r.maximum.y-r.minimum.y>a.h?r.maximum.y-r.minimum.y:a.h,e.bbSize.z=r.maximum.z-r.minimum.z>a.h?r.maximum.z-r.minimum.z:a.h;var d=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(d=d>e.bbSize.z?d:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/d),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/d),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/d),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=r,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),a.x.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,c.a.ComputeNormals(t,n,i,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);var f=e.depthSortedIndices.length/3|0;for(h=0;h<f;h++){var p=e.depthSortedFacets[h].ind;e.depthSortedIndices[3*h]=n[p],e.depthSortedIndices[3*h+1]=n[p+1],e.depthSortedIndices[3*h+2]=n[p+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},t.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},t.prototype.getFacetPosition=function(e){var t=a.x.Zero();return this.getFacetPositionToRef(e,t),t},t.prototype.getFacetPositionToRef=function(e,t){var n=this.getFacetLocalPositions()[e],i=this.getWorldMatrix();return a.x.TransformCoordinatesToRef(n,i,t),this},t.prototype.getFacetNormal=function(e){var t=a.x.Zero();return this.getFacetNormalToRef(e,t),t},t.prototype.getFacetNormalToRef=function(e,t){var n=this.getFacetLocalNormals()[e];return a.x.TransformNormalToRef(n,this.getWorldMatrix(),t),this},t.prototype.getFacetsAtLocalCoordinates=function(e,t,n){var i=this.getBoundingInfo(),r=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((e-i.minimum.x*r.partitioningBBoxRatio)*r.subDiv.X*r.partitioningBBoxRatio/r.bbSize.x),a=Math.floor((t-i.minimum.y*r.partitioningBBoxRatio)*r.subDiv.Y*r.partitioningBBoxRatio/r.bbSize.y),s=Math.floor((n-i.minimum.z*r.partitioningBBoxRatio)*r.subDiv.Z*r.partitioningBBoxRatio/r.bbSize.z);return o<0||o>r.subDiv.max||a<0||a>r.subDiv.max||s<0||s>r.subDiv.max?null:r.facetPartitioning[o+r.subDiv.max*a+r.subDiv.max*r.subDiv.max*s]},t.prototype.getClosestFacetAtCoordinates=function(e,t,n,i,r,o){void 0===r&&(r=!1),void 0===o&&(o=!0);var s=this.getWorldMatrix(),l=a.t.Matrix[5];s.invertToRef(l);var c=a.t.Vector3[8];a.x.TransformCoordinatesFromFloatsToRef(e,t,n,l,c);var u=this.getClosestFacetAtLocalCoordinates(c.x,c.y,c.z,i,r,o);return i&&a.x.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,s,i),u},t.prototype.getClosestFacetAtLocalCoordinates=function(e,t,n,i,r,o){void 0===r&&(r=!1),void 0===o&&(o=!0);var a=null,s=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,g=this.getFacetLocalPositions(),m=this.getFacetLocalNormals(),_=this.getFacetsAtLocalCoordinates(e,t,n);if(!_)return null;for(var v,b,y,T=Number.MAX_VALUE,E=T,x=0;x<_.length;x++)b=m[v=_[x]],u=(e-(y=g[v]).x)*b.x+(t-y.y)*b.y+(n-y.z)*b.z,(!r||r&&o&&u>=0||r&&!o&&u<=0)&&(E=(s=(d=e+b.x*(h=-(b.x*e+b.y*t+b.z*n-(u=b.x*y.x+b.y*y.y+b.z*y.z))/(b.x*b.x+b.y*b.y+b.z*b.z)))-e)*s+(l=(f=t+b.y*h)-t)*l+(c=(p=n+b.z*h)-n)*c)<T&&(T=E,a=v,i&&(i.x=d,i.y=f,i.z=p));return a},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(e,t,n){return void 0===n&&(n=!1),this},t.prototype.createNormals=function(e){var t,n=this.getVerticesData(l.b.PositionKind),i=this.getIndices();return t=this.isVerticesDataPresent(l.b.NormalKind)?this.getVerticesData(l.b.NormalKind):[],c.a.ComputeNormals(n,i,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(l.b.NormalKind,t,e),this},t.prototype.alignWithNormal=function(e,t){t||(t=a.c.Y);var n=a.t.Vector3[0],i=a.t.Vector3[1];return a.x.CrossToRef(t,e,i),a.x.CrossToRef(e,i,n),this.rotationQuaternion?a.q.RotationQuaternionFromAxisToRef(n,e,i,this.rotationQuaternion):a.x.RotationFromAxisToRef(n,e,i,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw g.a.WarnImport("EdgesRenderer")},t.prototype.enableEdgesRendering=function(e,t){throw g.a.WarnImport("EdgesRenderer")},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=f.a.MESHES_CULLINGSTRATEGY_STANDARD,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=f.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=f.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=f.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(1),r=n(0),o=n(2),a=n(8),s=n(23),l=n(19),c=n(9),u=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!0),this.state="",this.metadata=null,this.reservedDataStore=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=r.j.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||s.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),n&&this.addToSceneRootNodes()}return e.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},e.Construct=function(e,t,n,i){var r=this._NodeConstructors[e];return r?r(t,n,i):null},e.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&null!=this._parentNode._children){var n=this._parentNode._children.indexOf(this);-1!==n&&this._parentNode._children.splice(n,1),e||this._isDisposed||this.addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(null!=this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),e.prototype.addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},e.prototype.removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes;e[this._sceneRootNodesIndex]=e[e.length-1],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Node"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._scene.getEngine()},e.prototype.addBehavior=function(e,t){var n=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(n)}):e.attach(this),this._behaviors.push(e),this)},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),e.prototype.getBehaviorByName=function(e){for(var t=0,n=this._behaviors;t<n.length;t++){var i=n[t];if(i.name===e)return i}return null},e.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},e.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(e.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),e.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},e.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},e.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},e.prototype._updateCache=function(e){},e.prototype._isSynchronized=function(){return!0},e.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},e.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},e.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},e.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},e.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},e.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},e.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},e.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},e.prototype._getDescendants=function(e,t,n){if(void 0===t&&(t=!1),this._children)for(var i=0;i<this._children.length;i++){var r=this._children[i];n&&!n(r)||e.push(r),t||r._getDescendants(e,!1,n)}},e.prototype.getDescendants=function(e,t){var n=new Array;return this._getDescendants(n,e,t),n},e.prototype.getChildMeshes=function(e,t){var n=[];return this._getDescendants(n,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),n},e.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},e.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},e.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var n=this.animations[t];if(n.name===e)return n}return null},e.prototype.createAnimationRange=function(t,n,i){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,n,i);for(var r=0,o=this.animations.length;r<o;r++)this.animations[r]&&this.animations[r].createRange(t,n,i)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var n=0,i=this.animations.length;n<i;n++)this.animations[n]&&this.animations[n].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.beginAnimation=function(e,t,n,i){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,n,i):null},e.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var n=this._ranges[t];if(n){var i={};i.name=t,i.from=n.from,i.to=n.to,e.push(i)}}return e},e.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=r.j.Identity()),this._worldMatrix},e.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var n=0,i=this.getDescendants(!0);n<i.length;n++)i[n].dispose(e,t);this.parent?this.parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var r=0,o=this._behaviors;r<o.length;r++)o[r].detach();this._behaviors=[]},e.ParseAnimationRanges=function(e,t,n){if(t.ranges)for(var i=0;i<t.ranges.length;i++){var r=t.ranges[i];e.createAnimationRange(r.name,r.from,r.to)}},e.prototype.getHierarchyBoundingVectors=function(e,t){var n,i;if(void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var o=this.getBoundingInfo();n=o.boundingBox.minimumWorld,i=o.boundingBox.maximumWorld}else n=new r.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new r.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var a=0,s=this.getDescendants(!1);a<s.length;a++){var l=s[a];if(l.computeWorldMatrix(!0),(!t||t(l))&&l.getBoundingInfo&&0!==l.getTotalVertices()){var u=l.getBoundingInfo().boundingBox,h=u.maximumWorld;c.h.CheckExtends(u.minimumWorld,n,i),c.h.CheckExtends(h,n,i)}}return{min:n,max:i}},e._AnimationRangeFactory=function(e,t,n){throw l.a.WarnImport("AnimationRange")},e._NodeConstructors={},i.c([Object(o.c)()],e.prototype,"name",void 0),i.c([Object(o.c)()],e.prototype,"id",void 0),i.c([Object(o.c)()],e.prototype,"uniqueId",void 0),i.c([Object(o.c)()],e.prototype,"state",void 0),i.c([Object(o.c)()],e.prototype,"metadata",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(8),r=n(92),o=n(3),a=n(19),s=function(){function e(t,n,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new i.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._dataSource=e.DATASOURCE_UNKNOWN,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._webGLTexture=null,this._references=1,this._engine=t,this._dataSource=n,r||(this._webGLTexture=t._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,n){void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n,this.baseWidth=e,this.baseHeight=t,this.baseDepth=n,this._size=e*t*n},e.prototype._rebuild=function(){var t,n=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case e.DATASOURCE_TEMP:return;case e.DATASOURCE_URL:return void(t=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){t._swapAndDie(n),n.isReady=!0},null,this._buffer,void 0,this.format));case e.DATASOURCE_RAW:return(t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_RAW3D:return(t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_DYNAMIC:return(t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case e.DATASOURCE_RENDERTARGET:var i=new r.a;return i.generateDepthBuffer=this._generateDepthBuffer,i.generateMipMaps=this.generateMipMaps,i.generateStencilBuffer=this._generateStencilBuffer,i.samplingMode=this.samplingMode,i.type=this.type,(t=this.isCube?this._engine.createRenderTargetCubeTexture(this.width,i):this._engine.createRenderTargetTexture({width:this.width,height:this.height},i))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_DEPTHTEXTURE:return(t=this._engine.createDepthStencilTexture({width:this.width,height:this.height},{bilinearFiltering:this.samplingMode!==o.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube}))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_CUBE:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){t._swapAndDie(n),n.isReady=!0},null,this.format,this._extension));case e.DATASOURCE_CUBERAW:return(t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_CUBERAW_RGBD:return t=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(t,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){t._swapAndDie(n),n.isReady=!0});case e.DATASOURCE_CUBEPREFILTERED:return void((t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(n),n.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow);var t=this._engine.getLoadedTexturesCache(),n=t.indexOf(this);-1!==n&&t.splice(n,1)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,n,i,r){throw a.a.WarnImport("environmentTextureTools")},e.DATASOURCE_UNKNOWN=0,e.DATASOURCE_URL=1,e.DATASOURCE_TEMP=2,e.DATASOURCE_RAW=3,e.DATASOURCE_DYNAMIC=4,e.DATASOURCE_RENDERTARGET=5,e.DATASOURCE_MULTIRENDERTARGET=6,e.DATASOURCE_CUBE=7,e.DATASOURCE_CUBERAW=8,e.DATASOURCE_CUBEPREFILTERED=9,e.DATASOURCE_RAW3D=10,e.DATASOURCE_DEPTHTEXTURE=11,e.DATASOURCE_CUBERAW_RGBD=12,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(6),r=n(34),o=n(0),a=n(24),s=n(11),l=n(37);s.a._PhysicsImpostorParser=function(e,t,n){return new c(t,n.physicsImpostor,{mass:n.physicsMass,friction:n.physicsFriction,restitution:n.physicsRestitution},e)};var c=function(){function e(e,t,n,r){var a=this;void 0===n&&(n={mass:0}),this.object=e,this.type=t,this._options=n,this._scene=r,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=o.x.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new o.q,this._tmpQuat2=new o.q,this.beforeStep=function(){a._physicsEngine&&(a.object.translate(a._deltaPosition,-1),a._deltaRotationConjugated&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotationConjugated,a.object.rotationQuaternion),a.object.computeWorldMatrix(!1),a.object.parent&&a.object.rotationQuaternion?(a.getParentsRotation(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a._tmpQuat)):a._tmpQuat.copyFrom(a.object.rotationQuaternion||new o.q),a._options.disableBidirectionalTransformation||a.object.rotationQuaternion&&a._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(a,a.object.getAbsolutePosition(),a._tmpQuat),a._onBeforePhysicsStepCallbacks.forEach(function(e){e(a)}))},this.afterStep=function(){a._physicsEngine&&(a._onAfterPhysicsStepCallbacks.forEach(function(e){e(a)}),a._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(a),a.object.parent&&a.object.rotationQuaternion&&(a.getParentsRotation(),a._tmpQuat.conjugateInPlace(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a.object.rotationQuaternion)),a.object.setAbsolutePosition(a.object.position),a._deltaRotation&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotation,a.object.rotationQuaternion),a.object.translate(a._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((a._onPhysicsCollideCallbacks.length||a.onCollideEvent)&&a._physicsEngine){var t=a._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(a.onCollideEvent&&a.onCollideEvent(a,t),a._onPhysicsCollideCallbacks.filter(function(e){return-1!==e.otherImpostors.indexOf(t)}).forEach(function(e){e.callback(a,t)}))}},this.object?(!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotationQuaternion=this.object.rotation?o.q.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):new o.q),this._options.mass=void 0===n.mass?0:n.mass,this._options.friction=void 0===n.friction?.2:n.friction,this._options.restitution=void 0===n.restitution?.2:n.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===n.pressure?200:n.pressure,this._options.stiffness=void 0===n.stiffness?1:n.stiffness,this._options.velocityIterations=void 0===n.velocityIterations?20:n.velocityIterations,this._options.positionIterations=void 0===n.positionIterations?20:n.positionIterations,this._options.fixedPoints=void 0===n.fixedPoints?0:n.fixedPoints,this._options.margin=void 0===n.margin?0:n.margin,this._options.damping=void 0===n.damping?0:n.damping,this._options.path=void 0===n.path?null:n.path,this._options.shape=void 0===n.shape?null:n.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&i.a.Warn("You must affect impostors to children before affecting impostor to parent.")):i.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):i.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(e){this.setMass(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.setBodyPressure?e.getBodyPressure(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPressure&&t.setBodyPressure(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyStiffness?e.getBodyStiffness(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyStiffness&&t.setBodyStiffness(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyVelocityIterations?e.getBodyVelocityIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyVelocityIterations&&t.setBodyVelocityIterations(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyPositionIterations?e.getBodyPositionIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPositionIterations&&t.setBodyPositionIterations(this,e)}},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){return this.object.parent instanceof a.a?this.object.parent.physicsImpostor:null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion;this.object.rotationQuaternion=e.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var n=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),n}return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},e.prototype.getParam=function(e){return this._options[e]},e.prototype.setParam=function(e,t){this._options[e]=t,this._bodyUpdateRequired=!0},e.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):o.x.Zero()},e.prototype.setLinearVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):o.x.Zero()},e.prototype.setAngularVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},e.prototype.executeNativeFunction=function(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},e.prototype.unregisterBeforePhysicsStep=function(e){var t=this._onBeforePhysicsStepCallbacks.indexOf(e);t>-1?this._onBeforePhysicsStepCallbacks.splice(t,1):i.a.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},e.prototype.unregisterAfterPhysicsStep=function(e){var t=this._onAfterPhysicsStepCallbacks.indexOf(e);t>-1?this._onAfterPhysicsStepCallbacks.splice(t,1):i.a.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(e,t){var n=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:n})},e.prototype.unregisterOnPhysicsCollide=function(e,t){var n=e instanceof Array?e:[e],r=-1;this._onPhysicsCollideCallbacks.some(function(e,i){if(e.callback===t&&e.otherImpostors.length===n.length){var o=e.otherImpostors.every(function(e){return n.indexOf(e)>-1});return o&&(r=i),o}return!1})?this._onPhysicsCollideCallbacks.splice(r,1):i.a.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var e=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);e;)e.rotationQuaternion?this._tmpQuat2.copyFrom(e.rotationQuaternion):o.q.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),e=e.parent;return this._tmpQuat},e.prototype.applyForce=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this},e.prototype.applyImpulse=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this},e.prototype.createJoint=function(e,t,n){var i=new l.e(t,n);return this.addJoint(e,i),this},e.prototype.addJoint=function(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this},e.prototype.addAnchor=function(e,t,n,i,r){if(!this._physicsEngine)return this;var o=this._physicsEngine.getPhysicsPlugin();return o.appendAnchor?(this._physicsEngine&&o.appendAnchor(this,e,t,n,i,r),this):this},e.prototype.addHook=function(e,t,n,i){if(!this._physicsEngine)return this;var r=this._physicsEngine.getPhysicsPlugin();return r.appendAnchor?(this._physicsEngine&&r.appendHook(this,e,t,n,i),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(t){return t?new e(t,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach(function(t){e._physicsEngine&&e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},e.prototype.setDeltaRotation=function(e){this._deltaRotation||(this._deltaRotation=new o.q),this._deltaRotation.copyFrom(e),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(t,n,i,r,a){var s=e._tmpVecs[0],l=this.object;if(l.rotationQuaternion)if(a){var c=e._tmpQuat;l.rotationQuaternion.multiplyToRef(a,c),t.setRotationQuaternion(c,o.s.WORLD,n)}else t.setRotationQuaternion(l.rotationQuaternion,o.s.WORLD,n);s.x=0,s.y=0,s.z=0,i&&(s.x=i.x,s.y=i.y,s.z=i.z,t.getDirectionToRef(s,n,s),null==r&&(r=i.length()),s.x*=r,s.y*=r,s.z*=r),t.getParent()?(s.addInPlace(l.getAbsolutePosition()),t.setAbsolutePosition(s,n)):(n.setAbsolutePosition(l.getAbsolutePosition()),n.position.x-=s.x,n.position.y-=s.y,n.position.z-=s.z)},e.prototype.syncImpostorWithBone=function(t,n,i,r,a,s){var l=this.object;if(l.rotationQuaternion)if(a){var c=e._tmpQuat;t.getRotationQuaternionToRef(o.s.WORLD,n,c),c.multiplyToRef(a,l.rotationQuaternion)}else t.getRotationQuaternionToRef(o.s.WORLD,n,l.rotationQuaternion);var u=e._tmpVecs[0],h=e._tmpVecs[1];s||((s=e._tmpVecs[2]).x=0,s.y=1,s.z=0),t.getDirectionToRef(s,n,h),t.getAbsolutePositionToRef(n,u),null==r&&i&&(r=i.length()),null!=r&&(u.x+=h.x*r,u.y+=h.y*r,u.z+=h.z*r),l.setAbsolutePosition(u)},e.DEFAULT_OBJECT_SIZE=new o.x(1,1,1),e.IDENTITY_QUATERNION=o.q.Identity(),e._tmpVecs=r.a.BuildArray(3,o.x.Zero),e._tmpQuat=o.q.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var i=n(1),r=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}(),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return i.d(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.pushNoDuplicate((e.data||e)[t])}},t}(r)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(9),r=n(104),o=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(n){return e.AddTagsTo(t,n)},t.removeTags=function(n){return e.RemoveTagsFrom(t,n)},t.matchesTagsQuery=function(n){return e.MatchesQuery(t,n)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){return!!e._tags&&!i.h.IsEmpty(e._tags)},e.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var n=[];for(var i in e._tags)e._tags.hasOwnProperty(i)&&!0===e._tags[i]&&n.push(i);return n.join(" ")}return e._tags},e.AddTagsTo=function(t,n){n&&"string"==typeof n&&n.split(" ").forEach(function(n,i,r){e._AddTagTo(t,n)})},e._AddTagTo=function(t,n){""!==(n=n.trim())&&"true"!==n&&"false"!==n&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[n]=!0))},e.RemoveTagsFrom=function(t,n){if(e.HasTags(t)){var i=n.split(" ");for(var r in i)e._RemoveTagFrom(t,i[r])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,n){return void 0===n||(""===n?e.HasTags(t):r.a.Eval(n,function(n){return e.HasTags(t)&&t._tags[n]}))},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}return e.AddParser=function(e,t){this._BabylonFileParsers[e]=t},e.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},e.Parse=function(e,t,n,i){for(var r in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(r)&&this._BabylonFileParsers[r](e,t,n,i)},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"a",function(){return h});var i=n(1),r=n(2),o=n(8),a=n(9),s=n(0),l=n(64),c=n(93),u=function(e){function t(){var t=e.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return i.d(t,e),t}(l.a),h=function(){function e(){this.colorCurves=new c.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new s.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new o.c}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&c.a.PrepareUniforms(e)},e.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},e.prototype.prepareDefines=function(t,n){if(void 0===n&&(n=!1),n!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case e.TONEMAPPING_ACES:t.TONEMAPPING_ACES=!0;break;default:t.TONEMAPPING_ACES=!1}t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING3D=!!t.COLORGRADING&&this.colorGradingTexture.is3D,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(e,t){if(void 0===t&&(t=1),this._colorCurvesEnabled&&this.colorCurves&&c.a.Bind(this.colorCurves,e),this._vignetteEnabled){var n=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",n,i);var r=Math.tan(.5*this.vignetteCameraFov),o=r*t,s=Math.sqrt(o*r);o=a.h.Mix(o,s,this.vignetteStretch),r=a.h.Mix(r,s,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,r,-o*this.vignetteCentreX,-r*this.vignetteCentreY),e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,-2*this.vignetteWeight)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var l=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(l-1)/l,.5/l,l,this.colorGradingTexture.level)}},e.prototype.clone=function(){return r.a.Clone(function(){return new e},this)},e.prototype.serialize=function(){return r.a.Serialize(this)},e.Parse=function(t){return r.a.Parse(function(){return new e},t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,i.c([Object(r.g)()],e.prototype,"colorCurves",void 0),i.c([Object(r.c)()],e.prototype,"_colorCurvesEnabled",void 0),i.c([Object(r.m)("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),i.c([Object(r.c)()],e.prototype,"_colorGradingEnabled",void 0),i.c([Object(r.c)()],e.prototype,"_colorGradingWithGreenDepth",void 0),i.c([Object(r.c)()],e.prototype,"_colorGradingBGR",void 0),i.c([Object(r.c)()],e.prototype,"_exposure",void 0),i.c([Object(r.c)()],e.prototype,"_toneMappingEnabled",void 0),i.c([Object(r.c)()],e.prototype,"_toneMappingType",void 0),i.c([Object(r.c)()],e.prototype,"_contrast",void 0),i.c([Object(r.c)()],e.prototype,"vignetteStretch",void 0),i.c([Object(r.c)()],e.prototype,"vignetteCentreX",void 0),i.c([Object(r.c)()],e.prototype,"vignetteCentreY",void 0),i.c([Object(r.c)()],e.prototype,"vignetteWeight",void 0),i.c([Object(r.f)()],e.prototype,"vignetteColor",void 0),i.c([Object(r.c)()],e.prototype,"vignetteCameraFov",void 0),i.c([Object(r.c)()],e.prototype,"_vignetteBlendMode",void 0),i.c([Object(r.c)()],e.prototype,"_vignetteEnabled",void 0),i.c([Object(r.c)()],e.prototype,"_applyByPostProcess",void 0),i.c([Object(r.c)()],e.prototype,"_isEnabled",void 0),e}();r.a._ImageProcessingConfigurationParser=h.Parse},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null},r=function(){function e(){}return e.DeepCopy=function(e,t,n,r){for(var o in e)if(("_"!==o[0]||r&&-1!==r.indexOf(o))&&(!n||-1===n.indexOf(o))){var a=e[o],s=typeof a;if("function"!==s)try{if("object"===s)if(a instanceof Array){if(t[o]=[],a.length>0)if("object"==typeof a[0])for(var l=0;l<a.length;l++){var c=i(a[l],t);-1===t[o].indexOf(c)&&t[o].push(c)}else t[o]=a.slice(0)}else t[o]=i(a,t);else t[o]=a}catch(e){}}},e}()},function(e,t,n){"use strict";var i=n(1),r=n(2),o=n(28),a=n(16),s=n(0),l=n(4),c=n(31),u=n(5),h=n(64),d=n(75),f=n(15),p=n(7),g=n(22),m=n(18);u.a.IncludesShadersStore.defaultFragmentDeclaration="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",u.a.IncludesShadersStore.defaultUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n",n(56),n(84),n(85),n(120),n(112),u.a.IncludesShadersStore.fresnelFunction="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",n(113),n(86),n(87),n(121),n(95),n(88),n(98),n(89),n(122),n(123),n(114),n(115),n(99),u.a.ShadersStore.defaultPixelShader="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",u.a.IncludesShadersStore.defaultVertexDeclaration="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",n(67),n(68),n(124),n(96),n(100),n(101),n(102),n(103),n(69),n(70),n(125),n(90),n(116),n(117),u.a.IncludesShadersStore.pointCloudVertex="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",n(118),u.a.ShadersStore.defaultVertexShader="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";var _=n(3);n.d(t,"b",function(){return v}),n.d(t,"a",function(){return b});var v=function(e){function t(){var t=e.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.MULTIVIEW=!1,t.IS_REFLECTION_LINEAR=!1,t.IS_REFRACTION_LINEAR=!1,t.EXPOSURE=!1,t.rebuild(),t}return i.d(t,e),t.prototype.setReflectionMode=function(e){for(var t=0,n=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<n.length;t++){var i=n[t];this[i]=i===e}},t}(h.a),b=function(e){function t(n,i){var r=e.call(this,n,i)||this;return r._diffuseTexture=null,r._ambientTexture=null,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._specularTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._refractionTexture=null,r.ambientColor=new s.e(0,0,0),r.diffuseColor=new s.e(1,1,1),r.specularColor=new s.e(1,1,1),r.emissiveColor=new s.e(0,0,0),r.specularPower=64,r._useAlphaFromDiffuseTexture=!1,r._useEmissiveAsIllumination=!1,r._linkEmissiveWithDiffuse=!1,r._useSpecularOverAlpha=!1,r._useReflectionOverAlpha=!1,r._disableLighting=!1,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r._roughness=0,r.indexOfRefraction=.98,r.invertRefractionY=!0,r.alphaCutOff=.4,r._useLightmapAsShadowmap=!1,r._useReflectionFresnelFromSpecular=!1,r._useGlossinessFromSpecularMapAlpha=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._renderTargets=new o.a(16),r._worldViewProjectionMatrix=s.j.Zero(),r._globalAmbientColor=new s.e(0,0,0),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),t.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),t.RefractionTextureEnabled&&r._refractionTexture&&r._refractionTexture.isRenderTarget&&r._renderTargets.push(r._refractionTexture),r._renderTargets},r}return i.d(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(t.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(t.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},t.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},t.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},t.prototype.isReadyForSubMesh=function(e,n,i){if(void 0===i&&(i=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new v);var r=this.getScene(),o=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&o._renderId===r.getRenderId())return!0;var a=r.getEngine();if(o._needNormals=f.a.PrepareDefinesForLights(r,e,o,!0,this._maxSimultaneousLights,this._disableLighting),f.a.PrepareDefinesForMultiview(r,o),o._areTexturesDirty){if(o._needUVs=!1,o.MAINUV1=!1,o.MAINUV2=!1,r.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE")}else o.DIFFUSE=!1;if(this._ambientTexture&&t.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._ambientTexture,o,"AMBIENT")}else o.AMBIENT=!1;if(this._opacityTexture&&t.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else o.OPACITY=!1;if(this._reflectionTexture&&t.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.a.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case p.a.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.a.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.a.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.a.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX"),o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case p.a.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.a.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.a.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.a.CUBIC_MODE:case p.a.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC")}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else o.REFLECTION=!1;if(this._emissiveTexture&&t.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._emissiveTexture,o,"EMISSIVE")}else o.EMISSIVE=!1;if(this._lightmapTexture&&t.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else o.LIGHTMAP=!1;if(this._specularTexture&&t.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else o.SPECULAR=!1;if(r.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&t.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;f.a.PrepareDefinesForMergedUV(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAXOCCLUSION=this._useParallaxOcclusion,o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1;if(this._refractionTexture&&t.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube}else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=this.alphaMode===_.a.ALPHA_PREMULTIPLIED||this.alphaMode===_.a.ALPHA_PREMULTIPLIED_PORTERDUFF}if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(o._areFresnelDirty&&(t.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),f.a.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),o),f.a.PrepareDefinesForAttributes(e,o,!0,!0,!0),f.a.PrepareDefinesForFrameBoundValues(r,a,o,i),o.isDirty){o.markAsProcessed();var s=new u.c;o.REFLECTION&&s.addFallback(0,"REFLECTION"),o.SPECULAR&&s.addFallback(0,"SPECULAR"),o.BUMP&&s.addFallback(0,"BUMP"),o.PARALLAX&&s.addFallback(1,"PARALLAX"),o.PARALLAXOCCLUSION&&s.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&s.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&s.addFallback(1,"FOG"),o.POINTSIZE&&s.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&s.addFallback(0,"LOGARITHMICDEPTH"),f.a.HandleFallbacksForShadows(o,s,this._maxSimultaneousLights),o.SPECULARTERM&&s.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&s.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&s.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&s.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&s.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&s.addFallback(4,"FRESNEL"),o.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");var h=[l.b.PositionKind];o.NORMAL&&h.push(l.b.NormalKind),o.UV1&&h.push(l.b.UVKind),o.UV2&&h.push(l.b.UV2Kind),o.VERTEXCOLOR&&h.push(l.b.ColorKind),f.a.PrepareAttributesForBones(h,e,o,s),f.a.PrepareAttributesForInstances(h,o),f.a.PrepareAttributesForMorphTargets(h,e,o);var d="default",g=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],m=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],b=["Material","Scene"];c.a&&(c.a.PrepareUniforms(g,o),c.a.PrepareSamplers(m,o)),f.a.PrepareUniformsAndSamplersList({uniformsNames:g,uniformBuffersNames:b,samplers:m,defines:o,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,g,b,m,o));var y=o.toString(),T=n.effect,E=r.getEngine().createEffect(d,{attributes:h,uniformsNames:g,uniformBuffersNames:b,samplers:m,defines:y,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS}},a);E&&(this.allowShaderHotSwapping&&T&&!E.isReady()?(E=T,o.markAsUnprocessed()):(r.resetCachedMaterial(),n.setEffect(E,o),this.buildUniformLayout()))}return!(!n.effect||!n.effect.isReady()||(o._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,0))},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,i){var r=this.getScene(),o=i._materialDefines;if(o){var l=i.effect;if(l){this._activeEffect=l,o.INSTANCES||this.bindOnlyWorldMatrix(e),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var c=this._mustRebind(r,l,n.visibility);f.a.BindBonesParameters(n,l);var u=this._uniformBuffer;if(c){if(u.bindToEffect(l,"Material"),this.bindViewProjection(l),!u.useUbo||!this.isFrozen||!u.isSync){if(t.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(u.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),u.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&u.updateColor4("opacityParts",new s.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(u.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),u.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(u.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),u.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(u.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),u.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),r.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled&&(u.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),f.a.BindTextureMatrix(this._diffuseTexture,u,"diffuse"),this._diffuseTexture.hasAlpha&&l.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&t.AmbientTextureEnabled&&(u.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),f.a.BindTextureMatrix(this._ambientTexture,u,"ambient")),this._opacityTexture&&t.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),f.a.BindTextureMatrix(this._opacityTexture,u,"opacity")),this._reflectionTexture&&t.ReflectionTextureEnabled&&(u.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),u.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var h=this._reflectionTexture;u.updateVector3("vReflectionPosition",h.boundingBoxPosition),u.updateVector3("vReflectionSize",h.boundingBoxSize)}if(this._emissiveTexture&&t.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),f.a.BindTextureMatrix(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&t.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),f.a.BindTextureMatrix(this._lightmapTexture,u,"lightmap")),this._specularTexture&&t.SpecularTextureEnabled&&(u.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),f.a.BindTextureMatrix(this._specularTexture,u,"specular")),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),f.a.BindTextureMatrix(this._bumpTexture,u,"bump"),r._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&t.RefractionTextureEnabled){var d=1;this._refractionTexture.isCube||(u.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(d=this._refractionTexture.depth)),u.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,d,this.invertRefractionY?-1:1)}}this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&u.updateColor4("vSpecularColor",this.specularColor,this.specularPower),u.updateColor3("vEmissiveColor",t.EmissiveTextureEnabled?this.emissiveColor:s.e.BlackReadOnly),u.updateFloat("visibility",n.visibility),u.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}r.texturesEnabled&&(this._diffuseTexture&&t.DiffuseTextureEnabled&&l.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&t.AmbientTextureEnabled&&l.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.OpacityTextureEnabled&&l.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&t.ReflectionTextureEnabled&&l.setTexture(this._reflectionTexture.isCube?"reflectionCubeSampler":"reflection2DSampler",this._reflectionTexture),this._emissiveTexture&&t.EmissiveTextureEnabled&&l.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.LightmapTextureEnabled&&l.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&t.SpecularTextureEnabled&&l.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&l.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&t.RefractionTextureEnabled)&&(d=1,l.setTexture(this._refractionTexture.isCube?"refractionCubeSampler":"refraction2DSampler",this._refractionTexture)),f.a.BindClipPlane(l,r),r.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),f.a.BindEyePosition(l,r),l.setColor3("vAmbientColor",this._globalAmbientColor)}!c&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&f.a.BindLights(r,n,l,o,this._maxSimultaneousLights),(r.fogEnabled&&n.applyFog&&r.fogMode!==a.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(l),f.a.BindFogParameters(r,n,l),o.NUM_MORPH_INFLUENCERS&&f.a.BindMorphTargetParameters(n,l),f.a.BindLogDepth(o,l,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),u.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t||this._ambientTexture===t||this._opacityTexture===t||this._reflectionTexture===t||this._emissiveTexture===t||this._specularTexture===t||this._bumpTexture===t||this._lightmapTexture===t||this._refractionTexture===t},t.prototype.dispose=function(t,n){n&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,n)},t.prototype.clone=function(e){var n=this,i=r.a.Clone(function(){return new t(e,n.getScene())},this);return i.name=e,i.id=e,i},t.prototype.serialize=function(){return r.a.Serialize(this)},t.Parse=function(e,n,i){return r.a.Parse(function(){return new t(e.name,n)},e,n,i)},Object.defineProperty(t,"DiffuseTextureEnabled",{get:function(){return m.a.DiffuseTextureEnabled},set:function(e){m.a.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AmbientTextureEnabled",{get:function(){return m.a.AmbientTextureEnabled},set:function(e){m.a.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OpacityTextureEnabled",{get:function(){return m.a.OpacityTextureEnabled},set:function(e){m.a.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ReflectionTextureEnabled",{get:function(){return m.a.ReflectionTextureEnabled},set:function(e){m.a.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EmissiveTextureEnabled",{get:function(){return m.a.EmissiveTextureEnabled},set:function(e){m.a.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SpecularTextureEnabled",{get:function(){return m.a.SpecularTextureEnabled},set:function(e){m.a.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BumpTextureEnabled",{get:function(){return m.a.BumpTextureEnabled},set:function(e){m.a.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LightmapTextureEnabled",{get:function(){return m.a.LightmapTextureEnabled},set:function(e){m.a.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"RefractionTextureEnabled",{get:function(){return m.a.RefractionTextureEnabled},set:function(e){m.a.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorGradingTextureEnabled",{get:function(){return m.a.ColorGradingTextureEnabled},set:function(e){m.a.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FresnelEnabled",{get:function(){return m.a.FresnelEnabled},set:function(e){m.a.FresnelEnabled=e},enumerable:!0,configurable:!0}),i.c([Object(r.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"diffuseTexture",void 0),i.c([Object(r.m)("ambientTexture")],t.prototype,"_ambientTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),i.c([Object(r.m)("opacityTexture")],t.prototype,"_opacityTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),i.c([Object(r.m)("reflectionTexture")],t.prototype,"_reflectionTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),i.c([Object(r.m)("emissiveTexture")],t.prototype,"_emissiveTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),i.c([Object(r.m)("specularTexture")],t.prototype,"_specularTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularTexture",void 0),i.c([Object(r.m)("bumpTexture")],t.prototype,"_bumpTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),i.c([Object(r.m)("lightmapTexture")],t.prototype,"_lightmapTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"lightmapTexture",void 0),i.c([Object(r.m)("refractionTexture")],t.prototype,"_refractionTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),i.c([Object(r.e)("ambient")],t.prototype,"ambientColor",void 0),i.c([Object(r.e)("diffuse")],t.prototype,"diffuseColor",void 0),i.c([Object(r.e)("specular")],t.prototype,"specularColor",void 0),i.c([Object(r.e)("emissive")],t.prototype,"emissiveColor",void 0),i.c([Object(r.c)()],t.prototype,"specularPower",void 0),i.c([Object(r.c)("useAlphaFromDiffuseTexture")],t.prototype,"_useAlphaFromDiffuseTexture",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFromDiffuseTexture",void 0),i.c([Object(r.c)("useEmissiveAsIllumination")],t.prototype,"_useEmissiveAsIllumination",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useEmissiveAsIllumination",void 0),i.c([Object(r.c)("linkEmissiveWithDiffuse")],t.prototype,"_linkEmissiveWithDiffuse",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkEmissiveWithDiffuse",void 0),i.c([Object(r.c)("useSpecularOverAlpha")],t.prototype,"_useSpecularOverAlpha",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),i.c([Object(r.c)("useReflectionOverAlpha")],t.prototype,"_useReflectionOverAlpha",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useReflectionOverAlpha",void 0),i.c([Object(r.c)("disableLighting")],t.prototype,"_disableLighting",void 0),i.c([Object(r.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),i.c([Object(r.c)("useObjectSpaceNormalMap")],t.prototype,"_useObjectSpaceNormalMap",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),i.c([Object(r.c)("useParallax")],t.prototype,"_useParallax",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),i.c([Object(r.c)("useParallaxOcclusion")],t.prototype,"_useParallaxOcclusion",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),i.c([Object(r.c)()],t.prototype,"parallaxScaleBias",void 0),i.c([Object(r.c)("roughness")],t.prototype,"_roughness",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),i.c([Object(r.c)()],t.prototype,"indexOfRefraction",void 0),i.c([Object(r.c)()],t.prototype,"invertRefractionY",void 0),i.c([Object(r.c)()],t.prototype,"alphaCutOff",void 0),i.c([Object(r.c)("useLightmapAsShadowmap")],t.prototype,"_useLightmapAsShadowmap",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),i.c([Object(r.h)("diffuseFresnelParameters")],t.prototype,"_diffuseFresnelParameters",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"diffuseFresnelParameters",void 0),i.c([Object(r.h)("opacityFresnelParameters")],t.prototype,"_opacityFresnelParameters",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],t.prototype,"opacityFresnelParameters",void 0),i.c([Object(r.h)("reflectionFresnelParameters")],t.prototype,"_reflectionFresnelParameters",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"reflectionFresnelParameters",void 0),i.c([Object(r.h)("refractionFresnelParameters")],t.prototype,"_refractionFresnelParameters",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"refractionFresnelParameters",void 0),i.c([Object(r.h)("emissiveFresnelParameters")],t.prototype,"_emissiveFresnelParameters",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"emissiveFresnelParameters",void 0),i.c([Object(r.c)("useReflectionFresnelFromSpecular")],t.prototype,"_useReflectionFresnelFromSpecular",void 0),i.c([Object(r.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"useReflectionFresnelFromSpecular",void 0),i.c([Object(r.c)("useGlossinessFromSpecularMapAlpha")],t.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useGlossinessFromSpecularMapAlpha",void 0),i.c([Object(r.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),i.c([Object(r.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),i.c([Object(r.c)("invertNormalMapX")],t.prototype,"_invertNormalMapX",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),i.c([Object(r.c)("invertNormalMapY")],t.prototype,"_invertNormalMapY",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),i.c([Object(r.c)("twoSidedLighting")],t.prototype,"_twoSidedLighting",void 0),i.c([Object(r.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),i.c([Object(r.c)()],t.prototype,"useLogarithmicDepth",null),t}(d.a);g.a.RegisteredTypes["BABYLON.StandardMaterial"]=b,a.a.DefaultMaterialFactory=function(e){return new b("default material",e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.BuildArray=function(e,t){for(var n=[],i=0;i<e;++i)n.push(t());return n},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.GetDOMTextContent=function(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(e,t,n,i,r,o){this.source=e,this.pointerX=t,this.pointerY=n,this.meshUnderPointer=i,this.sourceEvent=r,this.additionalData=o}return e.CreateNew=function(t,n,i){var r=t.getScene();return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer||t,n,i)},e.CreateNewFromSprite=function(t,n,i,r){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,i,r)},e.CreateNewFromScene=function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)},e.CreateNewFromPrimitive=function(t,n,i,r){return new e(t,n.x,n.y,null,i,r)},e}()},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return l});var i=n(1),r=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}(),o=function(e){function t(t){return e.call(this,r.DistanceJoint,t)||this}return i.d(t,e),t.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},t}(r),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i.d(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(r),s=function(e){function t(t){return e.call(this,r.HingeJoint,t)||this}return i.d(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(a),l=function(e){function t(t){return e.call(this,r.Hinge2Joint,t)||this}return i.d(t,e),t.prototype.setMotor=function(e,t,n){void 0===n&&(n=0),this._physicsPlugin.setMotor(this,e||0,t,n)},t.prototype.setLimit=function(e,t,n){void 0===n&&(n=0),this._physicsPlugin.setLimit(this,e,t,n)},t}(a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(1),r=n(2),o=n(0),a=n(25),s=n(63),l=n(22),c=function(e){function t(n,i){var r=e.call(this,n,i)||this;return r.diffuse=new o.e(1,1,1),r.specular=new o.e(1,1,1),r.falloffType=t.FALLOFF_DEFAULT,r.intensity=1,r._range=Number.MAX_VALUE,r._inverseSquaredRange=0,r._photometricScale=1,r._intensityMode=t.INTENSITYMODE_AUTOMATIC,r._radius=1e-5,r.renderPriority=0,r._shadowEnabled=!0,r._excludeWithLayerMask=0,r._includeOnlyWithLayerMask=0,r._lightmapMode=0,r._excludedMeshesIds=new Array,r._includedOnlyMeshesIds=new Array,r._isLight=!0,r.getScene().addLight(r),r._uniformBuffer=new s.a(r.getScene().getEngine()),r._buildUniformLayout(),r.includedOnlyMeshes=new Array,r.excludedMeshes=new Array,r._resyncMeshes(),r}return i.d(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return o.x.Zero()},t.prototype.canAffectMesh=function(e){return!(e&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&e.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask))},t.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var i=0,r=this.getScene().meshes;i<r.length;i++)r[i]._removeLightSource(this);this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,n)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e){var n=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());return n?r.a.Clone(n,this):null},t.prototype.serialize=function(){var e=r.a.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(t){e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(t){e.includedOnlyMeshesIds.push(t.id)})),r.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,t,n){return a.a.Construct("Light_Type_"+e,t,n)||null},t.Parse=function(e,n){var i=t.GetConstructorFromName(e.type,e.name,n);if(!i)return null;var o=r.a.Parse(i,e,n);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(o._waitingParentId=e.parentId),void 0!==e.falloffType&&(o.falloffType=e.falloffType),void 0!==e.lightmapMode&&(o.lightmapMode=e.lightmapMode),e.animations){for(var s=0;s<e.animations.length;s++){var c=e.animations[s],u=l.a.GetClass("BABYLON.Animation");u&&o.animations.push(u.Parse(c))}a.a.ParseAnimationRanges(o,e,n)}return e.autoAnimate&&n.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},t.prototype._hookArrayForExcluded=function(e){var t=this,n=e.push;e.push=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];for(var o=n.apply(e,i),a=0,s=i;a<s.length;a++)s[a]._resyncLighSource(t);return o};var i=e.splice;e.splice=function(n,r){for(var o=i.apply(e,[n,r]),a=0,s=o;a<s.length;a++)s[a]._resyncLighSource(t);return o};for(var r=0,o=e;r<o.length;r++)o[r]._resyncLighSource(this)},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,n=e.push;e.push=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var o=n.apply(e,i);return t._resyncMeshes(),o};var i=e.splice;e.splice=function(n,r){var o=i.apply(e,[n,r]);return t._resyncMeshes(),o},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++)t[e]._resyncLighSource(this)},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var n=t[e];-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,n=this.getTypeID(),i=this.intensityMode;switch(i===t.INTENSITYMODE_AUTOMATIC&&(i=n===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),n){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(i){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var r=this.radius;r=Math.max(r,.001),e=2*Math.PI*(1-Math.cos(r))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,i.c([Object(r.e)()],t.prototype,"diffuse",void 0),i.c([Object(r.e)()],t.prototype,"specular",void 0),i.c([Object(r.c)()],t.prototype,"falloffType",void 0),i.c([Object(r.c)()],t.prototype,"intensity",void 0),i.c([Object(r.c)()],t.prototype,"range",null),i.c([Object(r.c)()],t.prototype,"intensityMode",null),i.c([Object(r.c)()],t.prototype,"radius",null),i.c([Object(r.c)()],t.prototype,"_renderPriority",void 0),i.c([Object(r.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),i.c([Object(r.c)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),i.c([Object(r.c)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),i.c([Object(r.c)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),i.c([Object(r.c)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(34),r=n(0),o=n(50),a=n(81),s=n(16),l=n(21),c=function(){function e(e,t,n){void 0===n&&(n=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=n}return e.prototype.intersectsBoxMinMax=function(t,n,i){void 0===i&&(i=0);var r,o,a,s,l=e.TmpVector3[0].copyFromFloats(t.x-i,t.y-i,t.z-i),c=e.TmpVector3[1].copyFromFloats(n.x+i,n.y+i,n.z+i),u=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<l.x||this.origin.x>c.x)return!1}else if((a=(c.x-this.origin.x)*(r=1/this.direction.x))==-1/0&&(a=1/0),(o=(l.x-this.origin.x)*r)>a&&(s=o,o=a,a=s),(u=Math.max(o,u))>(h=Math.min(a,h)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<l.y||this.origin.y>c.y)return!1}else if((a=(c.y-this.origin.y)*(r=1/this.direction.y))==-1/0&&(a=1/0),(o=(l.y-this.origin.y)*r)>a&&(s=o,o=a,a=s),(u=Math.max(o,u))>(h=Math.min(a,h)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<l.z||this.origin.z>c.z)return!1}else if((a=(c.z-this.origin.z)*(r=1/this.direction.z))==-1/0&&(a=1/0),(o=(l.z-this.origin.z)*r)>a&&(s=o,o=a,a=s),(u=Math.max(o,u))>(h=Math.min(a,h)))return!1;return!0},e.prototype.intersectsBox=function(e,t){return void 0===t&&(t=0),this.intersectsBoxMinMax(e.minimum,e.maximum,t)},e.prototype.intersectsSphere=function(e,t){void 0===t&&(t=0);var n=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,o=n*n+i*i+r*r,a=e.radius+t,s=a*a;if(o<=s)return!0;var l=n*this.direction.x+i*this.direction.y+r*this.direction.z;return!(l<0)&&o-l*l<=s},e.prototype.intersectsTriangle=function(t,n,i){var o=e.TmpVector3[0],s=e.TmpVector3[1],l=e.TmpVector3[2],c=e.TmpVector3[3],u=e.TmpVector3[4];n.subtractToRef(t,o),i.subtractToRef(t,s),r.x.CrossToRef(this.direction,s,l);var h=r.x.Dot(o,l);if(0===h)return null;var d=1/h;this.origin.subtractToRef(t,c);var f=r.x.Dot(c,l)*d;if(f<0||f>1)return null;r.x.CrossToRef(c,o,u);var p=r.x.Dot(this.direction,u)*d;if(p<0||f+p>1)return null;var g=r.x.Dot(s,u)*d;return g>this.length?null:new a.a(f,p,g)},e.prototype.intersectsPlane=function(e){var t,n=r.x.Dot(e.normal,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;var i=r.x.Dot(e.normal,this.origin);return(t=(-e.d-i)/n)<0?t<-9.99999997475243e-7?null:0:t},e.prototype.intersectsMesh=function(t,n){var i=r.t.Matrix[0];return t.getWorldMatrix().invertToRef(i),this._tmpRay?e.TransformToRef(this,i,this._tmpRay):this._tmpRay=e.Transform(this,i),t.intersects(this._tmpRay,n)},e.prototype.intersectsMeshes=function(e,t,n){n?n.length=0:n=[];for(var i=0;i<e.length;i++){var r=this.intersectsMesh(e[i],t);r.hit&&n.push(r)}return n.sort(this._comparePickingInfo),n},e.prototype._comparePickingInfo=function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},e.prototype.intersectionSegment=function(t,n,i){var o=this.origin,a=r.t.Vector3[0],s=r.t.Vector3[1],l=r.t.Vector3[2],c=r.t.Vector3[3];n.subtractToRef(t,a),this.direction.scaleToRef(e.rayl,l),o.addToRef(l,s),t.subtractToRef(o,c);var u,h,d,f,p=r.x.Dot(a,a),g=r.x.Dot(a,l),m=r.x.Dot(l,l),_=r.x.Dot(a,c),v=r.x.Dot(l,c),b=p*m-g*g,y=b,T=b;b<e.smallnum?(h=0,y=1,f=v,T=m):(f=p*v-g*_,(h=g*v-m*_)<0?(h=0,f=v,T=m):h>y&&(h=y,f=v+g,T=m)),f<0?(f=0,-_<0?h=0:-_>p?h=y:(h=-_,y=p)):f>T&&(f=T,-_+g<0?h=0:-_+g>p?h=y:(h=-_+g,y=p)),u=Math.abs(h)<e.smallnum?0:h/y,d=Math.abs(f)<e.smallnum?0:f/T;var E=r.t.Vector3[4];l.scaleToRef(d,E);var x=r.t.Vector3[5];a.scaleToRef(u,x),x.addInPlace(c);var C=r.t.Vector3[6];return x.subtractToRef(E,C),d>0&&d<=this.length&&C.lengthSquared()<i*i?x.length():-1},e.prototype.update=function(e,t,n,i,r,o,a){return this.unprojectRayToRef(e,t,n,i,r,o,a),this},e.Zero=function(){return new e(r.x.Zero(),r.x.Zero())},e.CreateNew=function(t,n,i,r,o,a,s){return e.Zero().update(t,n,i,r,o,a,s)},e.CreateNewFromTo=function(t,n,i){void 0===i&&(i=r.j.IdentityReadOnly);var o=n.subtract(t),a=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return o.normalize(),e.Transform(new e(t,o,a),i)},e.Transform=function(t,n){var i=new e(new r.x(0,0,0),new r.x(0,0,0));return e.TransformToRef(t,n,i),i},e.TransformToRef=function(e,t,n){r.x.TransformCoordinatesToRef(e.origin,t,n.origin),r.x.TransformNormalToRef(e.direction,t,n.direction),n.length=e.length;var i=n.direction,o=i.length();if(0!==o&&1!==o){var a=1/o;i.x*=a,i.y*=a,i.z*=a,n.length*=o}},e.prototype.unprojectRayToRef=function(e,t,n,i,o,a,s){var l=r.t.Matrix[0];o.multiplyToRef(a,l),l.multiplyToRef(s,l),l.invert();var c=r.t.Vector3[0];c.x=e/n*2-1,c.y=-(t/i*2-1),c.z=-1;var u=r.t.Vector3[1].copyFromFloats(c.x,c.y,1),h=r.t.Vector3[2],d=r.t.Vector3[3];r.x._UnprojectFromInvertedMatrixToRef(c,l,h),r.x._UnprojectFromInvertedMatrixToRef(u,l,d),this.origin.copyFrom(h),d.subtractToRef(h,this.direction),this.direction.normalize()},e.TmpVector3=i.a.BuildArray(6,r.x.Zero),e.smallnum=1e-8,e.rayl=1e9,e}();s.a.prototype.createPickingRay=function(e,t,n,i,r){void 0===r&&(r=!1);var o=c.Zero();return this.createPickingRayToRef(e,t,n,o,i,r),o},s.a.prototype.createPickingRayToRef=function(e,t,n,i,o,a){void 0===a&&(a=!1);var s=this.getEngine();if(!o){if(!this.activeCamera)throw new Error("Active camera not set");o=this.activeCamera}var l=o.viewport.toGlobal(s.getRenderWidth(),s.getRenderHeight());return e=e/s.getHardwareScalingLevel()-l.x,t=t/s.getHardwareScalingLevel()-(s.getRenderHeight()-l.y-l.height),i.update(e,t,l.width,l.height,n||r.j.IdentityReadOnly,a?r.j.IdentityReadOnly:o.getViewMatrix(),o.getProjectionMatrix()),this},s.a.prototype.createPickingRayInCameraSpace=function(e,t,n){var i=c.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,i,n),i},s.a.prototype.createPickingRayInCameraSpaceToRef=function(e,t,n,i){if(!o.a)return this;var a=this.getEngine();if(!i){if(!this.activeCamera)throw new Error("Active camera not set");i=this.activeCamera}var s=i.viewport.toGlobal(a.getRenderWidth(),a.getRenderHeight()),l=r.j.Identity();return e=e/a.getHardwareScalingLevel()-s.x,t=t/a.getHardwareScalingLevel()-(a.getRenderHeight()-s.y-s.height),n.update(e,t,s.width,s.height,l,l,i.getProjectionMatrix()),this},s.a.prototype._internalPick=function(e,t,n,i){if(!o.a)return null;for(var r=null,a=0;a<this.meshes.length;a++){var s=this.meshes[a];if(t){if(!t(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var l=e(s.getWorldMatrix()),c=s.intersects(l,n,i);if(c&&c.hit&&(n||null==r||!(c.distance>=r.distance))&&(r=c,n))break}return r||new o.a},s.a.prototype._internalMultiPick=function(e,t,n){if(!o.a)return null;for(var i=new Array,r=0;r<this.meshes.length;r++){var a=this.meshes[r];if(t){if(!t(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;var s=e(a.getWorldMatrix()),l=a.intersects(s,!1,n);l&&l.hit&&i.push(l)}return i},s.a.prototype.pick=function(e,t,n,i,a,s){var l=this;if(!o.a)return null;var u=this._internalPick(function(n){return l._tempPickingRay||(l._tempPickingRay=c.Zero()),l.createPickingRayToRef(e,t,n,l._tempPickingRay,a||null),l._tempPickingRay},n,i,s);return u&&(u.ray=this.createPickingRay(e,t,r.j.Identity(),a||null)),u},s.a.prototype.pickWithRay=function(e,t,n,i){var o=this,a=this._internalPick(function(t){return o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=r.j.Identity()),t.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=c.Zero()),c.TransformToRef(e,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform},t,n,i);return a&&(a.ray=e),a},s.a.prototype.multiPick=function(e,t,n,i,r){var o=this;return this._internalMultiPick(function(n){return o.createPickingRay(e,t,n,i||null)},n,r)},s.a.prototype.multiPickWithRay=function(e,t,n){var i=this;return this._internalMultiPick(function(t){return i._pickWithRayInverseMatrix||(i._pickWithRayInverseMatrix=r.j.Identity()),t.invertToRef(i._pickWithRayInverseMatrix),i._cachedRayForTransform||(i._cachedRayForTransform=c.Zero()),c.TransformToRef(e,i._pickWithRayInverseMatrix,i._cachedRayForTransform),i._cachedRayForTransform},t,n)},l.a.prototype.getForwardRay=function(e,t,n){void 0===e&&(e=100),t||(t=this.getWorldMatrix()),n||(n=this.position);var i=new r.x(0,0,this._scene.useRightHandedSystem?-1:1),o=r.x.TransformNormal(i,t),a=r.x.Normalize(o);return new c(n,a,e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),r=n(11),o=n(13),a=n(72),s=n(4);o.a.CreateLineSystem=function(e){for(var t=[],n=[],i=e.lines,r=e.colors,a=[],s=0,l=0;l<i.length;l++)for(var c=i[l],u=0;u<c.length;u++){if(n.push(c[u].x,c[u].y,c[u].z),r){var h=r[l];a.push(h[u].r,h[u].g,h[u].b,h[u].a)}u>0&&(t.push(s-1),t.push(s)),s++}var d=new o.a;return d.indices=t,d.positions=n,r&&(d.colors=a),d},o.a.CreateDashedLines=function(e){var t,n,r=e.dashSize||3,a=e.gapSize||1,s=e.dashNb||200,l=e.points,c=new Array,u=new Array,h=i.x.Zero(),d=0,f=0,p=0,g=0,m=0;for(m=0;m<l.length-1;m++)l[m+1].subtractToRef(l[m],h),d+=h.length();for(n=r*(t=d/s)/(r+a),m=0;m<l.length-1;m++){l[m+1].subtractToRef(l[m],h),f=Math.floor(h.length()/t),h.normalize();for(var _=0;_<f;_++)c.push(l[m].x+(p=t*_)*h.x,l[m].y+p*h.y,l[m].z+p*h.z),c.push(l[m].x+(p+n)*h.x,l[m].y+(p+n)*h.y,l[m].z+(p+n)*h.z),u.push(g,g+1),g+=2}var v=new o.a;return v.positions=c,v.indices=u,v},r.a.CreateLines=function(e,t,n,i,r){return void 0===n&&(n=null),void 0===i&&(i=!1),void 0===r&&(r=null),l.CreateLines(e,{points:t,updatable:i,instance:r},n)},r.a.CreateDashedLines=function(e,t,n,i,r,o,a,s){return void 0===o&&(o=null),l.CreateDashedLines(e,{points:t,dashSize:n,gapSize:i,dashNb:r,updatable:a,instance:s},o)};var l=function(){function e(){}return e.CreateLineSystem=function(e,t,n){var i=t.instance,r=t.lines,l=t.colors;if(i){var c,u,h=i.getVerticesData(s.b.PositionKind);l&&(c=i.getVerticesData(s.b.ColorKind));for(var d=0,f=0,p=0;p<r.length;p++)for(var g=r[p],m=0;m<g.length;m++)h[d]=g[m].x,h[d+1]=g[m].y,h[d+2]=g[m].z,l&&c&&(c[f]=(u=l[p])[m].r,c[f+1]=u[m].g,c[f+2]=u[m].b,c[f+3]=u[m].a,f+=4),d+=3;return i.updateVerticesData(s.b.PositionKind,h,!1,!1),l&&c&&i.updateVerticesData(s.b.ColorKind,c,!1,!1),i}var _=new a.b(e,n,null,void 0,void 0,!!l,t.useVertexAlpha);return o.a.CreateLineSystem(t).applyToMesh(_,t.updatable),_},e.CreateLines=function(t,n,i){return void 0===i&&(i=null),e.CreateLineSystem(t,{lines:[n.points],updatable:n.updatable,instance:n.instance,colors:n.colors?[n.colors]:null,useVertexAlpha:n.useVertexAlpha},i)},e.CreateDashedLines=function(e,t,n){void 0===n&&(n=null);var s=t.points,l=t.instance,c=t.gapSize||1,u=t.dashSize||3;if(l)return l.updateMeshPositions(function(e){var t,n,r=i.x.Zero(),o=e.length/6,a=0,c=0,u=0,h=0,d=0,f=0;for(d=0;d<s.length-1;d++)s[d+1].subtractToRef(s[d],r),a+=r.length();var p=l._creationDataStorage.dashSize;for(n=p*(t=a/o)/(p+l._creationDataStorage.gapSize),d=0;d<s.length-1;d++)for(s[d+1].subtractToRef(s[d],r),c=Math.floor(r.length()/t),r.normalize(),f=0;f<c&&h<e.length;)e[h]=s[d].x+(u=t*f)*r.x,e[h+1]=s[d].y+u*r.y,e[h+2]=s[d].z+u*r.z,e[h+3]=s[d].x+(u+n)*r.x,e[h+4]=s[d].y+(u+n)*r.y,e[h+5]=s[d].z+(u+n)*r.z,h+=6,f++;for(;h<e.length;)e[h]=s[d].x,e[h+1]=s[d].y,e[h+2]=s[d].z,h+=3},!1),l;var h=new a.b(e,n);return o.a.CreateDashedLines(t).applyToMesh(h,t.updatable),h._creationDataStorage=new r.b,h._creationDataStorage.dashSize=u,h._creationDataStorage.gapSize=c,h},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(16),r=n(8),o=n(17),a=n(23),s=n(65),l=n(0),c=function(){function e(e,t){var n=this;void 0===t&&(t=!0),this.originalScene=e,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new r.c,this.utilityLayerScene=new i.a(e.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=e.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),t&&(this._originalPointerObserver=e.onPrePointerObservable.add(function(t,i){if(n.utilityLayerScene.activeCamera&&(n.processAllEvents||t.type===o.a.POINTERMOVE||t.type===o.a.POINTERUP||t.type===o.a.POINTERDOWN)){n.utilityLayerScene.pointerX=e.pointerX,n.utilityLayerScene.pointerY=e.pointerY;var r=t.event;if(e.isPointerCaptured(r.pointerId))n._pointerCaptures[r.pointerId]=!1;else{var a=t.ray?n.utilityLayerScene.pickWithRay(t.ray):n.utilityLayerScene.pick(e.pointerX,e.pointerY);if(!t.ray&&a&&(t.ray=a.ray),n.utilityLayerScene.onPrePointerObservable.notifyObservers(t),n.onlyCheckPointerDownEvents&&t.type!=o.a.POINTERDOWN)return t.skipOnPointerObservable||n.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(t.type,t.event,a)),void(t.type===o.a.POINTERUP&&n._pointerCaptures[r.pointerId]&&(n._pointerCaptures[r.pointerId]=!1));if(n.utilityLayerScene.autoClearDepthAndStencil||n.pickUtilitySceneFirst)a&&a.hit&&(t.skipOnPointerObservable||n.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(t.type,t.event,a)),t.skipOnPointerObservable=!0);else{var s=t.ray?e.pickWithRay(t.ray):e.pick(e.pointerX,e.pointerY),l=t.event;s&&a&&(0===a.distance&&s.pickedMesh?n.mainSceneTrackerPredicate&&n.mainSceneTrackerPredicate(s.pickedMesh)?(n._notifyObservers(t,s,l),t.skipOnPointerObservable=!0):t.type===o.a.POINTERDOWN?n._pointerCaptures[l.pointerId]=!0:n._lastPointerEvents[l.pointerId]&&(n.onPointerOutObservable.notifyObservers(l.pointerId),delete n._lastPointerEvents[l.pointerId]):!n._pointerCaptures[l.pointerId]&&(a.distance<s.distance||0===s.distance)?(n._notifyObservers(t,a,l),t.skipOnPointerObservable||(t.skipOnPointerObservable=a.distance>0)):!n._pointerCaptures[l.pointerId]&&a.distance>s.distance&&(n.mainSceneTrackerPredicate&&n.mainSceneTrackerPredicate(s.pickedMesh)?(n._notifyObservers(t,s,l),t.skipOnPointerObservable=!0):n._lastPointerEvents[l.pointerId]&&(n.onPointerOutObservable.notifyObservers(l.pointerId),delete n._lastPointerEvents[l.pointerId])),t.type===o.a.POINTERUP&&n._pointerCaptures[l.pointerId]&&(n._pointerCaptures[l.pointerId]=!1))}}}}),this._originalPointerObserver&&e.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderObservable.add(function(){n.shouldRender&&n.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){n.dispose()}),this._updateCamera()}return e.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new s.a("shared gizmo light",new l.x(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=l.e.Gray()),this._sharedGizmoLight},Object.defineProperty(e,"DefaultUtilityLayer",{get:function(){return null==e._DefaultUtilityLayer&&(e._DefaultUtilityLayer=new e(a.a.LastCreatedScene)).originalScene.onDisposeObservable.addOnce(function(){e._DefaultUtilityLayer=null}),e._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultKeepDepthUtilityLayer",{get:function(){return null==e._DefaultKeepDepthUtilityLayer&&((e._DefaultKeepDepthUtilityLayer=new e(a.a.LastCreatedScene)).utilityLayerScene.autoClearDepthAndStencil=!1,e._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){e._DefaultKeepDepthUtilityLayer=null})),e._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),e.prototype._notifyObservers=function(e,t,n){e.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(e.type,e.event,t)),this._lastPointerEvents[n.pointerId]=!0)},e.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var e=this.utilityLayerScene.activeCamera.getScene(),t=this.utilityLayerScene.activeCamera;t._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e)}},e.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},e.prototype._updateCamera=function(){this.utilityLayerScene.activeCamera=this.originalScene.activeCameras.length>1?this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.originalScene.activeCamera},e._DefaultUtilityLayer=null,e._DefaultKeepDepthUtilityLayer=null,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(1),r=n(2),o=n(8),a=n(0),s=function(e){function t(n,i,r){void 0===i&&(i=null),void 0===r&&(r=!0);var s=e.call(this,n,i)||this;return s._forward=new a.x(0,0,1),s._forwardInverted=new a.x(0,0,-1),s._up=new a.x(0,1,0),s._right=new a.x(1,0,0),s._rightInverted=new a.x(-1,0,0),s._position=a.x.Zero(),s._rotation=a.x.Zero(),s._rotationQuaternion=null,s._scaling=a.x.One(),s._isDirty=!1,s._transformToBoneReferal=null,s._billboardMode=t.BILLBOARDMODE_NONE,s._preserveParentRotationForBillboard=!1,s.scalingDeterminant=1,s._infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s.reIntegrateRotationIntoRotationQuaternion=!1,s._poseMatrix=null,s._localMatrix=a.j.Zero(),s._usePivotMatrix=!1,s._absolutePosition=a.x.Zero(),s._pivotMatrix=a.j.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new o.c,s._nonUniformScaling=!1,r&&s.getScene().addTransformNode(s),s}return i.d(t,e),Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return a.x.Normalize(a.x.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return a.x.Normalize(a.x.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return a.x.Normalize(a.x.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=a.j.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;if(this.billboardMode!==e.billboardMode||this.billboardMode!==t.BILLBOARDMODE_NONE)return!1;if(e.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!e.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!e.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!e.rotation.equals(this._rotation))return!1;return!!e.scaling.equals(this._scaling)},t.prototype._initCache=function(){e.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.position=a.x.Zero(),t.scaling=a.x.Zero(),t.rotation=a.x.Zero(),t.rotationQuaternion=new a.q(0,0,0,0),t.billboardMode=-1,t.infiniteDistance=!1},t.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.j.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,n,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],n=arguments[1],i=arguments[2]}else t=e.x,n=e.y,i=e.z;if(this.parent){var r=a.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(r),a.x.TransformCoordinatesFromFloatsToRef(t,n,i,r,this.position)}else this.position.x=t,this.position.y=n,this.position.z=i;return this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=a.x.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=a.t.Matrix[0];return this._localMatrix.invertToRef(e),a.x.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=a.x.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,n,i,r,o){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=a.s.LOCAL);var s=t._lookAtVectorCache,l=o===a.s.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(l,s),this.setDirection(s,n,i,r),o===a.s.WORLD&&this.parent)if(this.rotationQuaternion){var c=a.t.Matrix[0];this.rotationQuaternion.toRotationMatrix(c);var u=a.t.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),c.multiplyToRef(u,c),this.rotationQuaternion.fromRotationMatrix(c)}else{var h=a.t.Quaternion[0];a.q.FromEulerVectorToRef(this.rotation,h),h.toRotationMatrix(c=a.t.Matrix[0]),u=a.t.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),c.multiplyToRef(u,c),h.fromRotationMatrix(c),h.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var t=a.x.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){return a.x.TransformNormalToRef(e,this.getWorldMatrix(),t),this},t.prototype.setDirection=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0);var r=-Math.atan2(e.z,e.x)+Math.PI/2,o=Math.sqrt(e.x*e.x+e.z*e.z),s=-Math.atan2(e.y,o);return this.rotationQuaternion?a.q.RotationYawPitchRollToRef(r+t,s+n,i,this.rotationQuaternion):(this.rotation.x=s+n,this.rotation.y=r+t,this.rotation.z=i),this},t.prototype.setPivotPoint=function(e,t){void 0===t&&(t=a.s.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(t==a.s.WORLD){var i=a.t.Matrix[0];n.invertToRef(i),e=a.x.TransformCoordinates(e,i)}return this.setPivotMatrix(a.j.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=a.x.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=a.x.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return e.x=this._pivotMatrix.m[12],e.y=this._pivotMatrix.m[13],e.z=this._pivotMatrix.m[14],this.getPivotPointToRef(e),a.x.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.setParent=function(e){if(!e&&!this.parent)return this;var t=a.t.Quaternion[0],n=a.t.Vector3[0],i=a.t.Vector3[1];if(e){var r=a.t.Matrix[0],o=a.t.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(o),this.getWorldMatrix().multiplyToRef(o,r),r.decompose(i,t,n)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(i,t,n);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(i),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,this.parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(e,n,i){var r;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==a.s.LOCAL){if(this.parent){var o=a.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(o),e=a.x.TransformNormal(e,o)}(r=a.q.RotationAxisToRef(e,n,t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=a.q.RotationAxisToRef(e,n,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this},t.prototype.rotateAround=function(e,t,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=a.t.Vector3[0],r=a.t.Vector3[1],o=a.t.Vector3[2],s=a.t.Quaternion[0],l=a.t.Matrix[0],c=a.t.Matrix[1],u=a.t.Matrix[2],h=a.t.Matrix[3];return e.subtractToRef(this.position,i),a.j.TranslationToRef(i.x,i.y,i.z,l),a.j.TranslationToRef(-i.x,-i.y,-i.z,c),a.j.RotationAxisToRef(t,n,u),c.multiplyToRef(u,h),h.multiplyToRef(l,h),h.decompose(r,s,o),this.position.addInPlace(o),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,t,n){var i=e.scale(t);if(n&&n!==a.s.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var r=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(r)}return this},t.prototype.addRotation=function(e,t,n){var i;this.rotationQuaternion?i=this.rotationQuaternion:a.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i=a.t.Quaternion[1]);var r=a.t.Quaternion[0];return a.q.RotationYawPitchRollToRef(t,e,n,r),i.multiplyInPlace(r),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var n=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=n,this._worldMatrix;this._updateCache();var i=this._cache;i.pivotMatrixUpdated=!1,i.billboardMode=this.billboardMode,i.infiniteDistance=this.infiniteDistance,this._currentRenderId=n,this._childUpdateId++,this._isDirty=!1;var r=this._getEffectiveParent(),o=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard,s=this.getScene().activeCamera,l=i.scaling,c=i.position;if(this._infiniteDistance)if(!this.parent&&s){var u=s.getWorldMatrix(),h=new a.x(u.m[12],u.m[13],u.m[14]);c.copyFromFloats(this._position.x+h.x,this._position.y+h.y,this._position.z+h.z)}else c.copyFrom(this._position);else c.copyFrom(this._position);l.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var d=i.rotationQuaternion;if(this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(a.q.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0)),d.copyFrom(this._rotationQuaternion)):(a.q.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,d),i.rotation.copyFrom(this._rotation)),this._usePivotMatrix){var f=a.t.Matrix[1];a.j.ScalingToRef(l.x,l.y,l.z,f);var p=a.t.Matrix[0];d.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(f,a.t.Matrix[4]),a.t.Matrix[4].multiplyToRef(p,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(c.x,c.y,c.z)}else a.j.ComposeToRef(l,d,c,this._localMatrix);if(r&&r.getWorldMatrix){if(o){this._transformToBoneReferal?r.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.t.Matrix[7]):a.t.Matrix[7].copyFrom(r.getWorldMatrix());var g=a.t.Vector3[5],m=a.t.Vector3[6];a.t.Matrix[7].decompose(m,void 0,g),a.j.ScalingToRef(m.x,m.y,m.z,a.t.Matrix[7]),a.t.Matrix[7].setTranslation(g),this._localMatrix.multiplyToRef(a.t.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(r.getWorldMatrix(),a.t.Matrix[6]),a.t.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(o&&s){if(this._worldMatrix.getTranslationToRef(a.t.Vector3[0]),a.t.Matrix[1].copyFrom(s.getViewMatrix()),a.t.Matrix[1].setTranslationFromFloats(0,0,0),a.t.Matrix[1].invertToRef(a.t.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){a.t.Matrix[0].decompose(void 0,a.t.Quaternion[0],void 0);var _=a.t.Vector3[1];a.t.Quaternion[0].toEulerAnglesToRef(_),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(_.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(_.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(_.z=0),a.j.RotationYawPitchRollToRef(_.y,_.x,_.z,a.t.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.t.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.t.Vector3[0])}return this._updateNonUniformScalingState(!this.ignoreNonUniformScaling&&(!!this._scaling.isNonUniform||!(!r||!r._nonUniformScaling)&&r._nonUniformScaling)),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.j.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),a.x.TransformCoordinates(this.absolutePosition,e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.globalPosition).length()},t.prototype.clone=function(e,n,i){var o=this,a=r.a.Clone(function(){return new t(e,o.getScene())},this);if(a.name=e,a.id=e,n&&(a.parent=n),!i)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var c=s[l];c.clone&&c.clone(e+"."+c.name,a)}return a},t.prototype.serialize=function(e){var t=r.a.Serialize(this,e);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.id),t},t.Parse=function(e,n,i){var o=r.a.Parse(function(){return new t(e.name,n)},e,n,i);return e.localMatrix?o.setPreTransformMatrix(a.j.FromArray(e.localMatrix)):e.pivotMatrix&&o.setPivotMatrix(a.j.FromArray(e.pivotMatrix)),o.setEnabled(e.isEnabled),e.parentId&&(o._waitingParentId=e.parentId),o},t.prototype.getChildTransformNodes=function(e,n){var i=[];return this._getDescendants(i,e,function(e){return(!n||n(e))&&e instanceof t}),i},t.prototype.dispose=function(t,n){if(void 0===n&&(n=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var i=0,r=this.getChildTransformNodes(!0);i<r.length;i++){var o=r[i];o.parent=null,o.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,n)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t._lookAtVectorCache=new a.x(0,0,0),t._rotationAxisCache=new a.q,i.c([Object(r.o)("position")],t.prototype,"_position",void 0),i.c([Object(r.o)("rotation")],t.prototype,"_rotation",void 0),i.c([Object(r.l)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),i.c([Object(r.o)("scaling")],t.prototype,"_scaling",void 0),i.c([Object(r.c)("billboardMode")],t.prototype,"_billboardMode",void 0),i.c([Object(r.c)()],t.prototype,"scalingDeterminant",void 0),i.c([Object(r.c)("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),i.c([Object(r.c)()],t.prototype,"ignoreNonUniformScaling",void 0),i.c([Object(r.c)()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(n(25).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(34),r=n(0),o=n(3),a=n(77),s=n(82),l={min:0,max:0},c={min:0,max:0},u=function(e,t,n){var i=r.x.Dot(t.centerWorld,e),o=Math.abs(r.x.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(r.x.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(r.x.Dot(t.directions[2],e))*t.extendSize.z;n.min=i-o,n.max=i+o},h=function(e,t,n){return u(e,t,l),u(e,n,c),!(l.min>c.max||c.min>l.max)},d=function(){function e(e,t,n){this._isLocked=!1,this.boundingBox=new a.a(e,t,n),this.boundingSphere=new s.a(e,t,n)}return e.prototype.reConstruct=function(e,t,n){this.boundingBox.reConstruct(e,t,n),this.boundingSphere.reConstruct(e,t,n)},Object.defineProperty(e.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},e.prototype.centerOn=function(t,n){var i=e.TmpVector3[0].copyFrom(t).subtractInPlace(n),r=e.TmpVector3[1].copyFrom(t).addInPlace(n);return this.boundingBox.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,r,this.boundingBox.getWorldMatrix()),this},e.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},e.prototype.isInFrustum=function(e,t){return void 0===t&&(t=o.a.MESHES_CULLINGSTRATEGY_STANDARD),!(t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(t!==o.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(e))},Object.defineProperty(e.prototype,"diagonalLength",{get:function(){var t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),e.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},e.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},e.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)},e.prototype.intersects=function(e,t){if(!s.a.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!a.a.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var n=this.boundingBox,i=e.boundingBox;return!!(h(n.directions[0],n,i)&&h(n.directions[1],n,i)&&h(n.directions[2],n,i)&&h(i.directions[0],n,i)&&h(i.directions[1],n,i)&&h(i.directions[2],n,i)&&h(r.x.Cross(n.directions[0],i.directions[0]),n,i)&&h(r.x.Cross(n.directions[0],i.directions[1]),n,i)&&h(r.x.Cross(n.directions[0],i.directions[2]),n,i)&&h(r.x.Cross(n.directions[1],i.directions[0]),n,i)&&h(r.x.Cross(n.directions[1],i.directions[1]),n,i)&&h(r.x.Cross(n.directions[1],i.directions[2]),n,i)&&h(r.x.Cross(n.directions[2],i.directions[0]),n,i)&&h(r.x.Cross(n.directions[2],i.directions[1]),n,i)&&h(r.x.Cross(n.directions[2],i.directions[2]),n,i))},e.TmpVector3=i.a.BuildArray(2,r.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(1),r=n(2),o=n(8),a=n(9),s=n(71),l=n(0),c=n(23),u=n(3),h=function(){function e(t){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=u.a.TEXTURE_EXPLICIT_MODE,this.wrapU=u.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=u.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=u.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new o.c,this._onDisposeObserver=null,this.delayLoadState=u.a.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=l.r.Zero(),this._scene=t||c.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(e.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(u.a.MATERIAL_TextureDirtyFlag|u.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(u.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=a.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name},e.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getTextureMatrix=function(){return l.j.IdentityReadOnly},e.prototype.getReflectionTextureMatrix=function(){return l.j.IdentityReadOnly},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},e.prototype.isReady=function(){return this.delayLoadState===u.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new l.r(this._texture._size,this._texture._size):new l.r(this._texture.baseWidth,this._texture.baseHeight):l.r.Zero()},e.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},e.prototype.scale=function(e){},Object.defineProperty(e.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._getFromCache=function(e,t,n,i){if(!this._scene)return null;for(var r=this._scene.getEngine().getLoadedTexturesCache(),o=0;o<r.length;o++){var a=r[o];if(!(void 0!==i&&i!==a.invertY||a.url!==e||a.generateMipMaps!==!t||n&&n!==a.samplingMode))return a.incrementReferences(),a}return null},e.prototype._rebuild=function(){},e.prototype.delayLoad=function(){},e.prototype.clone=function(){return null},Object.defineProperty(e.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:u.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:u.a.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),e.prototype.readPixels=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=null),!this._texture)return null;var i=this.getSize(),r=i.width,o=i.height,a=this.getScene();if(!a)return null;var s=a.getEngine();return 0!=t&&(r/=Math.pow(2,t),o/=Math.pow(2,t),r=Math.round(r),o=Math.round(o)),s._readTexturePixels(this._texture,r,o,this._texture.isCube?e:-1,t,n)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(e.prototype,"sphericalPolynomial",{get:function(){return this._texture&&s.a&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=s.a.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},e.prototype.serialize=function(){if(!this.name)return null;var e=r.a.Serialize(this);return r.a.AppendSerializedAnimations(this,e),e},e.WhenAllReady=function(e,t){var n=e.length;if(0!==n)for(var i,r,o=function(){if((i=e[a]).isReady())0==--n&&t();else{var o=function(){r.removeCallback(o),0==--n&&t()};(r=i.onLoadObservable).add(o)}},a=0;a<e.length;a++)o();else t()},e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,i.c([Object(r.c)()],e.prototype,"uniqueId",void 0),i.c([Object(r.c)()],e.prototype,"name",void 0),i.c([Object(r.c)()],e.prototype,"metadata",void 0),i.c([Object(r.c)("hasAlpha")],e.prototype,"_hasAlpha",void 0),i.c([Object(r.c)()],e.prototype,"getAlphaFromRGB",void 0),i.c([Object(r.c)()],e.prototype,"level",void 0),i.c([Object(r.c)()],e.prototype,"coordinatesIndex",void 0),i.c([Object(r.c)("coordinatesMode")],e.prototype,"_coordinatesMode",void 0),i.c([Object(r.c)()],e.prototype,"wrapU",void 0),i.c([Object(r.c)()],e.prototype,"wrapV",void 0),i.c([Object(r.c)()],e.prototype,"wrapR",void 0),i.c([Object(r.c)()],e.prototype,"anisotropicFilteringLevel",void 0),i.c([Object(r.c)()],e.prototype,"isCube",null),i.c([Object(r.c)()],e.prototype,"is3D",null),i.c([Object(r.c)()],e.prototype,"gammaSpace",void 0),i.c([Object(r.c)()],e.prototype,"invertZ",void 0),i.c([Object(r.c)()],e.prototype,"lodLevelInAlpha",void 0),i.c([Object(r.c)()],e.prototype,"lodGenerationOffset",null),i.c([Object(r.c)()],e.prototype,"lodGenerationScale",null),i.c([Object(r.c)()],e.prototype,"isRenderTarget",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),r=function(){function e(){}return e._RemoveAndStorePivotPoint=function(t){t&&0===e._PivotCached&&(t.getPivotPointToRef(e._OldPivotPoint),e._OldPivotPoint.equalsToFloats(0,0,0)||(t.setPivotMatrix(i.j.IdentityReadOnly),e._OldPivotPoint.subtractToRef(t.getPivotPoint(),e._PivotTranslation),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(t.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),t.position.addInPlace(e._PivotTmpVector))),e._PivotCached++},e._RestorePivotPoint=function(t){t&&!e._OldPivotPoint.equalsToFloats(0,0,0)&&1===e._PivotCached&&(t.setPivotPoint(e._OldPivotPoint),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(t.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),t.position.subtractInPlace(e._PivotTmpVector)),this._PivotCached--},e._PivotCached=0,e._OldPivotPoint=new i.x,e._PivotTranslation=new i.x,e._PivotTmpVector=new i.x,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),r=n(11),o=n(13);o.a.CreateSphere=function(e){for(var t=e.segments||32,n=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,r=e.slice&&e.slice<=0?1:e.slice||1,a=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,s=new i.x((e.diameterX||e.diameter||1)/2,(e.diameterY||e.diameter||1)/2,(e.diameterZ||e.diameter||1)/2),l=2+t,c=2*l,u=[],h=[],d=[],f=[],p=0;p<=l;p++){for(var g=p/l,m=g*Math.PI*r,_=0;_<=c;_++){var v=_/c,b=v*Math.PI*2*n,y=i.j.RotationZ(-m),T=i.j.RotationY(b),E=i.x.TransformCoordinates(i.x.Up(),y),x=i.x.TransformCoordinates(E,T),C=x.multiply(s),S=x.divide(s).normalize();h.push(C.x,C.y,C.z),d.push(S.x,S.y,S.z),f.push(v,g)}if(p>0)for(var A=h.length/3,P=A-2*(c+1);P+c+2<A;P++)u.push(P),u.push(P+1),u.push(P+c+1),u.push(P+c+1),u.push(P+1),u.push(P+c+2)}o.a._ComputeSides(a,h,u,d,f,e.frontUVs,e.backUVs);var R=new o.a;return R.indices=u,R.positions=h,R.normals=d,R.uvs=f,R},r.a.CreateSphere=function(e,t,n,i,r,o){return a.CreateSphere(e,{segments:t,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:o,updatable:r},i)};var a=function(){function e(){}return e.CreateSphere=function(e,t,n){var i=new r.a(e,n);return t.sideOrientation=r.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateSphere(t).applyToMesh(i,t.updatable),i},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(35),r=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return i.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),r=n(11),o=n(41),a=function(){function e(e){var t=this;void 0===e&&(e=o.a.DefaultUtilityLayer),this.gizmoLayer=e,this._attachedMesh=null,this.scaleRatio=1,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new i.x,this._rootMesh=new r.a("gizmoRootNode",e.utilityLayerScene),this._rootMesh.rotationQuaternion=i.q.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){t._update()})}return Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e,this._rootMesh.setEnabled(!!e),this._attachedMeshChanged(e)},enumerable:!0,configurable:!0}),e.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(e){e.dispose()}),e.parent=this._rootMesh,this._customMeshSet=!0},e.prototype._attachedMeshChanged=function(e){},e.prototype._update=function(){if(this.attachedMesh){var e=this.attachedMesh._effectiveMesh||this.attachedMesh;if(this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(e.absolutePosition),this.updateGizmoRotationToMatchAttachedMesh?e.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this._updateScale){var t=this.gizmoLayer.utilityLayerScene.activeCamera,n=t.globalPosition;t.devicePosition&&(n=t.devicePosition),this._rootMesh.position.subtractToRef(n,this._tempVector);var i=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(i,i,i),e._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}}},e.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return u});var i=n(1),r=n(9),o=n(4),a=n(81),s=n(43),l=n(3),c=function(){function e(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}(),u=function(e){function t(t,n,i,r,o,a,s,l){void 0===l&&(l=!0);var c=e.call(this)||this;return c.materialIndex=t,c.verticesStart=n,c.verticesCount=i,c.indexStart=r,c.indexCount=o,c._linesIndexCount=0,c._linesIndexBuffer=null,c._lastColliderWorldVertices=null,c._lastColliderTransformMatrix=null,c._renderId=0,c._alphaIndex=0,c._distanceToCamera=0,c._currentMaterial=null,c._mesh=a,c._renderingMesh=s||a,a.subMeshes.push(c),c._trianglePlanes=[],c._id=a.subMeshes.length-1,l&&(c.refreshBoundingInfo(),a.computeWorldMatrix(!0)),c}return i.d(t,e),t.AddToMesh=function(e,n,i,r,o,a,s,l){return void 0===l&&(l=!0),new t(e,n,i,r,o,a,s,l)},Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(o.b.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,n=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var i=this._renderingMesh.getBoundingInfo();t={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else t=r.h.ExtractMinAndMaxIndexed(e,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new s.a(t.minimum,t.maximum),this},t.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},t.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},t.prototype.render=function(e){return this._renderingMesh.render(this,e),this},t.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},t.prototype.intersects=function(e,t,n,i,r){var o=this.getMaterial();if(!o)return null;switch(o.fillMode){case l.a.MATERIAL_PointListDrawMode:case l.a.MATERIAL_LineListDrawMode:case l.a.MATERIAL_LineLoopDrawMode:case l.a.MATERIAL_LineStripDrawMode:case l.a.MATERIAL_TriangleFanDrawMode:case l.a.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,i):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,i,r):this._intersectTriangles(e,t,n,i,r)},t.prototype._intersectLines=function(e,t,n,i,r){for(var o=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var l=e.intersectionSegment(t[n[s]],t[n[s+1]],i);if(!(l<0)&&(r||!o||l<o.distance)&&((o=new a.a(null,null,l)).faceId=s/2,r))break}return o},t.prototype._intersectUnIndexedLines=function(e,t,n,i,r){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var l=e.intersectionSegment(t[s],t[s+1],i);if(!(l<0)&&(r||!o||l<o.distance)&&((o=new a.a(null,null,l)).faceId=s/2,r))break}return o},t.prototype._intersectTriangles=function(e,t,n,i,r){for(var o=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=3){var s=t[n[a]],l=t[n[a+1]],c=t[n[a+2]];if(!r||r(s,l,c,e)){var u=e.intersectsTriangle(s,l,c);if(u){if(u.distance<0)continue;if((i||!o||u.distance<o.distance)&&((o=u).faceId=a/3,i))break}}}return o},t.prototype._intersectUnIndexedTriangles=function(e,t,n,i,r){for(var o=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){var s=t[a],l=t[a+1],c=t[a+2];if(!r||r(s,l,c,e)){var u=e.intersectsTriangle(s,l,c);if(u){if(u.distance<0)continue;if((i||!o||u.distance<o.distance)&&((o=u).faceId=a/3,i))break}}}return o},t.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},t.prototype.clone=function(e,n){var i=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,n,!1);if(!this.IsGlobal){var r=this.getBoundingInfo();if(!r)return i;i._boundingInfo=new s.a(r.minimum,r.maximum)}return i},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.prototype.getClassName=function(){return"SubMesh"},t.CreateFromIndices=function(e,n,i,r,o){for(var a=Number.MAX_VALUE,s=-Number.MAX_VALUE,l=(o||r).getIndices(),c=n;c<n+i;c++){var u=l[c];u<a&&(a=u),u>s&&(s=u)}return new t(e,a,s-a+1,n,i,r,o)},t}(c)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(0),r=n(4),o=function(){function e(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return e.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(r.b.NormalKind))return null;var n,o=this.pickedMesh.getIndices();if(!o)return null;if(t){var a=this.pickedMesh.getVerticesData(r.b.NormalKind),s=i.x.FromArray(a,3*o[3*this.faceId]),l=i.x.FromArray(a,3*o[3*this.faceId+1]),c=i.x.FromArray(a,3*o[3*this.faceId+2]);s=s.scale(this.bu),l=l.scale(this.bv),c=c.scale(1-this.bu-this.bv),n=new i.x(s.x+l.x+c.x,s.y+l.y+c.y,s.z+l.z+c.z)}else{var u=this.pickedMesh.getVerticesData(r.b.PositionKind),h=i.x.FromArray(u,3*o[3*this.faceId]),d=i.x.FromArray(u,3*o[3*this.faceId+1]),f=i.x.FromArray(u,3*o[3*this.faceId+2]),p=h.subtract(d),g=f.subtract(d);n=i.x.Cross(p,g)}if(e){var m=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(i.t.Matrix[0].copyFrom(m),(m=i.t.Matrix[0]).setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(i.t.Matrix[1]),m=i.t.Matrix[1]),n=i.x.TransformNormal(n,m)}return n.normalize(),n},e.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(r.b.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(r.b.UVKind);if(!t)return null;var n=i.w.FromArray(t,2*e[3*this.faceId]),o=i.w.FromArray(t,2*e[3*this.faceId+1]),a=i.w.FromArray(t,2*e[3*this.faceId+2]);return n=n.scale(1-this.bu-this.bv),o=o.scale(this.bu),a=a.scale(this.bv),new i.w(n.x+o.x+a.x,n.y+o.y+a.y)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var i=n(1),r=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),o=function(e,t){this.type=e,this.event=t},a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.type=t,i.event=n,i.skipOnPointerObservable=!1,i}return i.d(t,e),t}(o)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(0),r=n(11),o=n(13);o.a.CreateBox=function(e){var t,n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],r=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[],s=e.width||e.size||1,l=e.height||e.size||1,c=e.depth||e.size||1,u=void 0===e.topBaseAt?1:e.topBaseAt,h=void 0===e.bottomBaseAt?0:e.bottomBaseAt,d=[2,0,3,1][u=(u+4)%4],f=[2,0,1,3][h=(h+4)%4],p=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(e.wrap){n=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],p=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var g=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],m=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],_=[17,18,19,16],v=[22,23,20,21];d>0;)g.unshift(g.pop()),_.unshift(_.pop()),d--;for(;f>0;)m.unshift(m.pop()),v.unshift(v.pop()),f--;g=g.flat(),m=m.flat(),p=p.concat(g).concat(m),n.push(_[0],_[2],_[3],_[0],_[1],_[2]),n.push(v[0],v[2],v[3],v[0],v[1],v[2])}var b=[s/2,l/2,c/2];t=p.reduce(function(e,t,n){return e.concat(t*b[n%3])},[]);for(var y=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,T=e.faceUV||new Array(6),E=e.faceColors,x=[],C=0;C<6;C++)void 0===T[C]&&(T[C]=new i.y(0,0,1,1)),E&&void 0===E[C]&&(E[C]=new i.f(1,1,1,1));for(var S=0;S<6;S++)if(a.push(T[S].z,T[S].w),a.push(T[S].x,T[S].w),a.push(T[S].x,T[S].y),a.push(T[S].z,T[S].y),E)for(var A=0;A<4;A++)x.push(E[S].r,E[S].g,E[S].b,E[S].a);o.a._ComputeSides(y,t,n,r,a,e.frontUVs,e.backUVs);var P=new o.a;if(P.indices=n,P.positions=t,P.normals=r,P.uvs=a,E){var R=y===o.a.DOUBLESIDE?x.concat(x):x;P.colors=R}return P},r.a.CreateBox=function(e,t,n,i,r){return void 0===n&&(n=null),a.CreateBox(e,{size:t,sideOrientation:r,updatable:i},n)};var a=function(){function e(){}return e.CreateBox=function(e,t,n){void 0===n&&(n=null);var i=new r.a(e,n);return t.sideOrientation=r.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateBox(t).applyToMesh(i,t.updatable),i},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(0),r=n(11),o=n(13),a=n(16);o.a.CreateCylinder=function(e){var t,n=e.height||2,r=0===e.diameterTop?0:e.diameterTop||e.diameter||1,a=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1,s=e.tessellation||24,l=e.subdivisions||1,c=!!e.hasRings,u=!!e.enclose,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,d=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,f=e.faceUV||new Array(3),p=e.faceColors,g=2+(1+(1!==h&&u?2:0))*(c?l:1);for(t=0;t<g;t++)p&&void 0===p[t]&&(p[t]=new i.f(1,1,1,1));for(t=0;t<g;t++)f&&void 0===f[t]&&(f[t]=new i.y(0,0,1,1));var m,_,v,b,y,T,E=new Array,x=new Array,C=new Array,S=new Array,A=new Array,P=2*Math.PI*h/s,R=(a-r)/2/n,M=i.x.Zero(),O=i.x.Zero(),w=i.x.Zero(),I=i.x.Zero(),D=i.x.Zero(),L=i.c.Y,k=1,N=1,F=0,B=0;for(b=0;b<=l;b++)for(v=((_=b/l)*(r-a)+a)/2,k=c&&0!==b&&b!==l?2:1,T=0;T<k;T++){for(c&&(N+=T),u&&(N+=2*T),y=0;y<=s;y++)m=y*P,M.x=Math.cos(-m)*v,M.y=-n/2+_*n,M.z=Math.sin(-m)*v,0===r&&b===l?(O.x=C[C.length-3*(s+1)],O.y=C[C.length-3*(s+1)+1],O.z=C[C.length-3*(s+1)+2]):(O.x=M.x,O.z=M.z,O.y=Math.sqrt(O.x*O.x+O.z*O.z)*R,O.normalize()),0===y&&(w.copyFrom(M),I.copyFrom(O)),x.push(M.x,M.y,M.z),C.push(O.x,O.y,O.z),S.push(f[N].x+(f[N].z-f[N].x)*y/s,B=c?F!==N?f[N].y:f[N].w:f[N].y+(f[N].w-f[N].y)*_),p&&A.push(p[N].r,p[N].g,p[N].b,p[N].a);1!==h&&u&&(x.push(M.x,M.y,M.z),x.push(0,M.y,0),x.push(0,M.y,0),x.push(w.x,w.y,w.z),i.x.CrossToRef(L,O,D),D.normalize(),C.push(D.x,D.y,D.z,D.x,D.y,D.z),i.x.CrossToRef(I,L,D),D.normalize(),C.push(D.x,D.y,D.z,D.x,D.y,D.z),S.push(f[N+1].x,B=c?F!==N?f[N+1].y:f[N+1].w:f[N+1].y+(f[N+1].w-f[N+1].y)*_),S.push(f[N+1].z,B),S.push(f[N+2].x,B=c?F!==N?f[N+2].y:f[N+2].w:f[N+2].y+(f[N+2].w-f[N+2].y)*_),S.push(f[N+2].z,B),p&&(A.push(p[N+1].r,p[N+1].g,p[N+1].b,p[N+1].a),A.push(p[N+1].r,p[N+1].g,p[N+1].b,p[N+1].a),A.push(p[N+2].r,p[N+2].g,p[N+2].b,p[N+2].a),A.push(p[N+2].r,p[N+2].g,p[N+2].b,p[N+2].a))),F!==N&&(F=N)}var U=1!==h&&u?s+4:s;for(b=0,N=0;N<l;N++){var V=0,G=0,z=0,j=0;for(y=0;y<s;y++)j=(b+1)*(U+1)+(y+1),E.push(V=b*(U+1)+y,G=(b+1)*(U+1)+y,z=b*(U+1)+(y+1)),E.push(j,z,G);1!==h&&u&&(E.push(V+2,G+2,z+2),E.push(j+2,z+2,G+2),E.push(V+4,G+4,z+4),E.push(j+4,z+4,G+4)),b=c?b+2:b+1}var H=function(e){var t=e?r/2:a/2;if(0!==t){var o,l,c,u=e?f[g-1]:f[0],d=null;p&&(d=e?p[g-1]:p[0]);var m=x.length/3,_=e?n/2:-n/2,v=new i.x(0,_,0);x.push(v.x,v.y,v.z),C.push(0,e?1:-1,0),S.push(u.x+.5*(u.z-u.x),u.y+.5*(u.w-u.y)),d&&A.push(d.r,d.g,d.b,d.a);var b=new i.w(.5,.5);for(c=0;c<=s;c++){o=2*Math.PI*c*h/s;var y=Math.cos(-o),T=Math.sin(-o);l=new i.x(y*t,_,T*t);var P=new i.w(y*b.x+.5,T*b.y+.5);x.push(l.x,l.y,l.z),C.push(0,e?1:-1,0),S.push(u.x+(u.z-u.x)*P.x,u.y+(u.w-u.y)*P.y),d&&A.push(d.r,d.g,d.b,d.a)}for(c=0;c<s;c++)e?(E.push(m),E.push(m+(c+2)),E.push(m+(c+1))):(E.push(m),E.push(m+(c+1)),E.push(m+(c+2)))}};H(!1),H(!0),o.a._ComputeSides(d,x,E,C,S,e.frontUVs,e.backUVs);var W=new o.a;return W.indices=E,W.positions=x,W.normals=C,W.uvs=S,p&&(W.colors=A),W},r.a.CreateCylinder=function(e,t,n,i,o,l,c,u,h){return void 0!==c&&c instanceof a.a||(void 0!==c&&(h=u||r.a.DEFAULTSIDE,u=c),c=l,l=1),s.CreateCylinder(e,{height:t,diameterTop:n,diameterBottom:i,tessellation:o,subdivisions:l,sideOrientation:h,updatable:u},c)};var s=function(){function e(){}return e.CreateCylinder=function(e,t,n){var i=new r.a(e,n);return t.sideOrientation=r.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateCylinder(t).applyToMesh(i,t.updatable),i},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(11),r=n(16),o=n(8),a=n(0),s=n(17),l=n(39),c=n(45),u=(n(80),function(){function e(e){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new o.c,this.onDragStartObservable=new o.c,this.onDragEndObservable=new o.c,this.moveAttached=!0,this.enabled=!0,this.detachCameraControls=!0,this.useObjectOrienationForDragging=!0,this.validateDrag=function(e){return!0},this._tmpVector=new a.x(0,0,0),this._alternatePickedPoint=new a.x(0,0,0),this._worldDragAxis=new a.x(0,0,0),this._targetPosition=new a.x(0,0,0),this._attachedElement=null,this._startDragRay=new l.a(new a.x,new a.x),this._lastPointerRay={},this._dragDelta=new a.x,this._pointA=new a.x(0,0,0),this._pointB=new a.x(0,0,0),this._pointC=new a.x(0,0,0),this._lineA=new a.x(0,0,0),this._lineB=new a.x(0,0,0),this._localAxis=new a.x(0,0,0),this._lookAt=new a.x(0,0,0),this._options=e||{};var t=0;if(this._options.dragAxis&&t++,this._options.dragPlaneNormal&&t++,t>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(e.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._scene=t.getScene(),this._attachedNode=t,e._planeScene||(this._debugMode?e._planeScene=this._scene:((e._planeScene=new r.a(this._scene.getEngine(),{virtual:!0})).detachControl(),this._scene.onDisposeObservable.addOnce(function(){e._planeScene.dispose(),e._planeScene=null}))),this._dragPlane=i.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,e._planeScene,!1,i.a.DOUBLESIDE),this.lastDragPosition=new a.x(0,0,0),this._pointerObserver=this._scene.onPointerObservable.add(function(t,i){var r;if(n.enabled)if(t.type==s.a.POINTERDOWN)!n.dragging&&t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh&&t.pickInfo.pickedPoint&&t.pickInfo.ray&&(n._attachedNode==(r=t.pickInfo.pickedMesh)||r.isDescendantOf(n._attachedNode))&&n._startDrag(t.event.pointerId,t.pickInfo.ray,t.pickInfo.pickedPoint);else if(t.type==s.a.POINTERUP)n.currentDraggingPointerID==t.event.pointerId&&n.releaseDrag();else if(t.type==s.a.POINTERMOVE){var o=t.event.pointerId;n.currentDraggingPointerID===e._AnyMouseID&&o!==e._AnyMouseID&&"mouse"==t.event.pointerType&&(n._lastPointerRay[n.currentDraggingPointerID]&&(n._lastPointerRay[o]=n._lastPointerRay[n.currentDraggingPointerID],delete n._lastPointerRay[n.currentDraggingPointerID]),n.currentDraggingPointerID=o),n._lastPointerRay[o]||(n._lastPointerRay[o]=new l.a(new a.x,new a.x)),t.pickInfo&&t.pickInfo.ray&&(n._lastPointerRay[o].origin.copyFrom(t.pickInfo.ray.origin),n._lastPointerRay[o].direction.copyFrom(t.pickInfo.ray.direction),n.currentDraggingPointerID==o&&n.dragging&&n._moveDrag(t.pickInfo.ray))}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){n._moving&&n.moveAttached&&(c.a._RemoveAndStorePivotPoint(n._attachedNode),n._targetPosition.subtractToRef(n._attachedNode.absolutePosition,n._tmpVector),n._tmpVector.scaleInPlace(n.dragDeltaRatio),n._attachedNode.getAbsolutePosition().addToRef(n._tmpVector,n._tmpVector),n.validateDrag(n._tmpVector)&&n._attachedNode.setAbsolutePosition(n._tmpVector),c.a._RestorePivotPoint(n._attachedNode))})},e.prototype.releaseDrag=function(){this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!0)},e.prototype.startDrag=function(t,n,i){void 0===t&&(t=e._AnyMouseID),this._startDrag(t,n,i);var r=this._lastPointerRay[t];t===e._AnyMouseID&&(r=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),r&&this._moveDrag(r)},e.prototype._startDrag=function(e,t,n){if(this._scene.activeCamera&&!this.dragging&&this._attachedNode){c.a._RemoveAndStorePivotPoint(this._attachedNode),t?(this._startDragRay.direction.copyFrom(t.direction),this._startDragRay.origin.copyFrom(t.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,n||this._tmpVector);var i=this._pickWithRayOnDragPlane(this._startDragRay);i&&(this.dragging=!0,this.currentDraggingPointerID=e,this.lastDragPosition.copyFrom(i),this.onDragStartObservable.notifyObservers({dragPlanePoint:i,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this._attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),c.a._RestorePivotPoint(this._attachedNode)}},e.prototype._moveDrag=function(e){this._moving=!0;var t=this._pickWithRayOnDragPlane(e);if(t){this.updateDragPlane&&this._updateDragPlanePosition(e,t);var n=0;this._options.dragAxis?(a.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis),t.subtractToRef(this.lastDragPosition,this._tmpVector),n=a.x.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(n,this._dragDelta)):(n=this._dragDelta.length(),t.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:n,delta:this._dragDelta,dragPlanePoint:t,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(t)}},e.prototype._pickWithRayOnDragPlane=function(t){var n=this;if(!t)return null;var i=Math.acos(a.x.Dot(this._dragPlane.forward,t.direction));if(i>Math.PI/2&&(i=Math.PI-i),this.maxDragAngle>0&&i>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(t.direction),this._attachedNode.absolutePosition.subtractToRef(t.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*a.x.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var r=a.x.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-r,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),this._alternatePickedPoint}return null}var o=e._planeScene.pickWithRay(t,function(e){return e==n._dragPlane});return o&&o.hit&&o.pickedMesh&&o.pickedPoint?o.pickedPoint:null},e.prototype._updateDragPlanePosition=function(e,t){this._pointA.copyFrom(t),this._options.dragAxis?(this.useObjectOrienationForDragging?a.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),e.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),a.x.CrossToRef(this._lineA,this._lineB,this._lookAt),a.x.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrienationForDragging?a.x.TransformCoordinatesToRef(this._options.dragPlaneNormal,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(e.origin)),this._dragPlane.position.copyFrom(this._attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},e.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},e._AnyMouseID=-2,e}())},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(3),r=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(t){e._loggingLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t},enumerable:!0,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._loggingLevel=i.a.SCENELOADER_NO_LOGGING,e}()},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.helperFunctions="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(0),r=n(13),o=n(4),a=n(49),s=n(55),l=n(43),c=n(3),u=n(9),h=n(29),d=function(){function e(e,t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null),this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=i,n?this.setAllVerticesData(n,i):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),r&&(this.applyToMesh(r),r.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),e.CreateGeometryForMesh=function(t){var n=new e(e.RandomId(),t.getScene());return n.applyToMesh(t),n},Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===c.a.DELAYLOADSTATE_LOADED||this.delayLoadState===c.a.DELAYLOADSTATE_NONE},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},e.prototype.setVerticesData=function(e,t,n,i){void 0===n&&(n=!1);var r=new o.b(this._engine,t,e,n,0===this._meshes.length,i);this.setVerticesBuffer(r)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},e.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var n=e.getKind();if(this._vertexBuffers[n]&&this._vertexBuffers[n].dispose(),this._vertexBuffers[n]=e,n===o.b.PositionKind){var i=e.getData();null!=t?this._totalVertices=t:null!=i&&(this._totalVertices=i.length/(e.byteStride/4)),this._updateExtend(i),this._resetPointsArrayCache();for(var r=this._meshes,a=r.length,s=0;s<a;s++){var c=r[s];c._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),c._createGlobalSubMesh(!1),c.computeWorldMatrix(!0)}}this.notifyUpdate(n),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},e.prototype.updateVerticesDataDirectly=function(e,t,n,i){void 0===i&&(i=!1);var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,n,i),this.notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,n){void 0===n&&(n=!1);var i=this.getVertexBuffer(e);i&&(i.update(t),e===o.b.PositionKind&&this._updateBoundingInfo(n,t),this.notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var n=0,i=this._meshes;n<i.length;n++){var r=i[n];r._boundingInfo?r._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):r._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum);for(var o=0,a=r.subMeshes;o<a.length;o++)a[o].refreshBoundingInfo()}},e.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var n=this.getVertexBuffers();n&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(n,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(n,t,e))}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,n){var i=this.getVertexBuffer(e);if(!i)return null;var r=i.getData();if(!r)return null;var a=i.getSize()*o.b.GetTypeByteLength(i.type),s=this._totalVertices*i.getSize();if(i.type!==o.b.FLOAT||i.byteStride!==a){var l=[];return i.forEach(s,function(e){return l.push(e)}),l}if(!(r instanceof Array||r instanceof Float32Array)||0!==i.byteOffset||r.length!==s){if(r instanceof Array){var c=i.byteOffset/4;return u.h.Slice(r,c,c+s)}if(r instanceof ArrayBuffer)return new Float32Array(r,i.byteOffset,s);if(c=r.byteOffset+i.byteOffset,n||t&&1!==this._meshes.length){var h=new Float32Array(s),d=new Float32Array(r.buffer,c,s);return h.set(d),h}return new Float32Array(r.buffer,c,s)}return n||t&&1!==this._meshes.length?u.h.Slice(r):r},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t,n){if(void 0===n&&(n=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var i=e.length!==this._indices.length;if(n||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),i)for(var r=0,o=this._meshes;r<o.length;r++)o[r]._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=n,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,n)),null!=t&&(this._totalVertices=t);for(var i=0,r=this._meshes;i<r.length;i++)r[i]._createGlobalSubMesh(!0);this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var n=this._indices;if(t||e&&1!==this._meshes.length){for(var i=n.length,r=[],o=0;o<i;o++)r.push(n[o]);return r}return n},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var n=this._meshes,i=n.indexOf(e);-1!==i&&(n.splice(i,1),e._geometry=null,0===n.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var n=this._meshes;e._geometry=this,this._scene.pushGeometry(this),n.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},e.prototype._updateExtend=function(e){void 0===e&&(e=null),e||(e=this.getVerticesData(o.b.PositionKind)),this._extend=u.h.ExtractMinAndMax(e,0,this._totalVertices,this.boundingBias,3)},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var n in this._vertexBuffers){1===t&&this._vertexBuffers[n].create();var i=this._vertexBuffers[n].getBuffer();i&&(i.references=t),n===o.b.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,n=this._meshes;t<n.length;t++)n[t]._markSubMeshesAsAttributesDirty()},e.prototype.load=function(e,t){this.delayLoadState!==c.a.DELAYLOADSTATE_LOADING&&(this.isReady()?t&&t():(this.delayLoadState=c.a.DELAYLOADSTATE_LOADING,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var n=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(i){if(n._delayLoadingFunction){n._delayLoadingFunction(JSON.parse(i),n),n.delayLoadState=c.a.DELAYLOADSTATE_LOADED,n._delayInfo=[],e._removePendingData(n);for(var r=n._meshes,o=r.length,a=0;a<o;a++)n._applyToMesh(r[a]);t&&t()}},void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var n=e[t+0];e[t+0]=e[t+2],e[t+2]=n}this.setIndices(e)}var i=this.getVerticesData(o.b.PositionKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(o.b.PositionKind,i,!1)}var r=this.getVerticesData(o.b.NormalKind,!1);if(null!=r&&r.length>0){for(t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(o.b.NormalKind,r,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(o.b.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var t=0;t<e.length;t+=3)this._positions.push(i.x.FromArray(e,t));return!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},e.prototype.dispose=function(){var e,t=this._meshes,n=t.length;for(e=0;e<n;e++)this.releaseForMesh(t[e]);for(var i in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},e.prototype.copy=function(t){var n=new r.a;n.indices=[];var i=this.getIndices();if(i)for(var o=0;o<i.length;o++)n.indices.push(i[o]);var a,s=!1,c=!1;for(a in this._vertexBuffers){var u=this.getVerticesData(a);if(u&&(u instanceof Float32Array?n.set(new Float32Array(u),a):n.set(u.slice(0),a),!c)){var h=this.getVertexBuffer(a);h&&(c=!(s=h.isUpdatable()))}}var d=new e(t,this._scene,n,s);for(a in d.delayLoadState=this.delayLoadState,d.delayLoadingFile=this.delayLoadingFile,d._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)d._delayInfo=d._delayInfo||[],d._delayInfo.push(a);return d._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),d},e.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,h.a&&h.a.HasTags(this)&&(e.tags=h.a.GetTags(this)),e},e.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(o.b.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(o.b.PositionKind)),this.isVertexBufferUpdatable(o.b.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(o.b.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(o.b.NormalKind)),this.isVertexBufferUpdatable(o.b.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(o.b.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(o.b.TangentKind)),this.isVertexBufferUpdatable(o.b.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(o.b.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(o.b.UVKind)),this.isVertexBufferUpdatable(o.b.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(o.b.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(o.b.UV2Kind)),this.isVertexBufferUpdatable(o.b.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(o.b.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(o.b.UV3Kind)),this.isVertexBufferUpdatable(o.b.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(o.b.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(o.b.UV4Kind)),this.isVertexBufferUpdatable(o.b.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(o.b.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(o.b.UV5Kind)),this.isVertexBufferUpdatable(o.b.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(o.b.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(o.b.UV6Kind)),this.isVertexBufferUpdatable(o.b.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(o.b.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(o.b.ColorKind)),this.isVertexBufferUpdatable(o.b.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(o.b.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(o.b.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(o.b.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(o.b.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(o.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(o.b.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var n=e._geometry;return n?n.copy(t):null},e.RandomId=function(){return u.h.RandomId()},e._ImportGeometry=function(t,n){var r=n.getScene(),s=t.geometryId;if(s){var l=r.getGeometryByID(s);l&&l.applyToMesh(n)}else if(t instanceof ArrayBuffer){var c=n._binaryInfo;if(c.positionsAttrDesc&&c.positionsAttrDesc.count>0){var u=new Float32Array(t,c.positionsAttrDesc.offset,c.positionsAttrDesc.count);n.setVerticesData(o.b.PositionKind,u,!1)}if(c.normalsAttrDesc&&c.normalsAttrDesc.count>0){var h=new Float32Array(t,c.normalsAttrDesc.offset,c.normalsAttrDesc.count);n.setVerticesData(o.b.NormalKind,h,!1)}if(c.tangetsAttrDesc&&c.tangetsAttrDesc.count>0){var d=new Float32Array(t,c.tangetsAttrDesc.offset,c.tangetsAttrDesc.count);n.setVerticesData(o.b.TangentKind,d,!1)}if(c.uvsAttrDesc&&c.uvsAttrDesc.count>0){var f=new Float32Array(t,c.uvsAttrDesc.offset,c.uvsAttrDesc.count);n.setVerticesData(o.b.UVKind,f,!1)}if(c.uvs2AttrDesc&&c.uvs2AttrDesc.count>0){var p=new Float32Array(t,c.uvs2AttrDesc.offset,c.uvs2AttrDesc.count);n.setVerticesData(o.b.UV2Kind,p,!1)}if(c.uvs3AttrDesc&&c.uvs3AttrDesc.count>0){var g=new Float32Array(t,c.uvs3AttrDesc.offset,c.uvs3AttrDesc.count);n.setVerticesData(o.b.UV3Kind,g,!1)}if(c.uvs4AttrDesc&&c.uvs4AttrDesc.count>0){var m=new Float32Array(t,c.uvs4AttrDesc.offset,c.uvs4AttrDesc.count);n.setVerticesData(o.b.UV4Kind,m,!1)}if(c.uvs5AttrDesc&&c.uvs5AttrDesc.count>0){var _=new Float32Array(t,c.uvs5AttrDesc.offset,c.uvs5AttrDesc.count);n.setVerticesData(o.b.UV5Kind,_,!1)}if(c.uvs6AttrDesc&&c.uvs6AttrDesc.count>0){var v=new Float32Array(t,c.uvs6AttrDesc.offset,c.uvs6AttrDesc.count);n.setVerticesData(o.b.UV6Kind,v,!1)}if(c.colorsAttrDesc&&c.colorsAttrDesc.count>0){var b=new Float32Array(t,c.colorsAttrDesc.offset,c.colorsAttrDesc.count);n.setVerticesData(o.b.ColorKind,b,!1,c.colorsAttrDesc.stride)}if(c.matricesIndicesAttrDesc&&c.matricesIndicesAttrDesc.count>0){for(var y=new Int32Array(t,c.matricesIndicesAttrDesc.offset,c.matricesIndicesAttrDesc.count),T=[],E=0;E<y.length;E++){var x=y[E];T.push(255&x),T.push((65280&x)>>8),T.push((16711680&x)>>16),T.push(x>>24)}n.setVerticesData(o.b.MatricesIndicesKind,T,!1)}if(c.matricesWeightsAttrDesc&&c.matricesWeightsAttrDesc.count>0){var C=new Float32Array(t,c.matricesWeightsAttrDesc.offset,c.matricesWeightsAttrDesc.count);n.setVerticesData(o.b.MatricesWeightsKind,C,!1)}if(c.indicesAttrDesc&&c.indicesAttrDesc.count>0){var S=new Int32Array(t,c.indicesAttrDesc.offset,c.indicesAttrDesc.count);n.setIndices(S,null)}if(c.subMeshesAttrDesc&&c.subMeshesAttrDesc.count>0){var A=new Int32Array(t,c.subMeshesAttrDesc.offset,5*c.subMeshesAttrDesc.count);for(n.subMeshes=[],E=0;E<c.subMeshesAttrDesc.count;E++)a.b.AddToMesh(A[5*E+0],A[5*E+1],A[5*E+2],A[5*E+3],A[5*E+4],n)}}else if(t.positions&&t.normals&&t.indices){if(n.setVerticesData(o.b.PositionKind,t.positions,t.positions._updatable),n.setVerticesData(o.b.NormalKind,t.normals,t.normals._updatable),t.tangents&&n.setVerticesData(o.b.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&n.setVerticesData(o.b.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&n.setVerticesData(o.b.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&n.setVerticesData(o.b.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&n.setVerticesData(o.b.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&n.setVerticesData(o.b.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&n.setVerticesData(o.b.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&n.setVerticesData(o.b.ColorKind,i.f.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(o.b.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(T=[],E=0;E<t.matricesIndices.length;E++){var P=t.matricesIndices[E];T.push(255&P),T.push((65280&P)>>8),T.push((16711680&P)>>16),T.push(P>>24)}n.setVerticesData(o.b.MatricesIndicesKind,T,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(o.b.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(T=[],E=0;E<t.matricesIndicesExtra.length;E++)T.push(255&(P=t.matricesIndicesExtra[E])),T.push((65280&P)>>8),T.push((16711680&P)>>16),T.push(P>>24);n.setVerticesData(o.b.MatricesIndicesExtraKind,T,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,n),n.setVerticesData(o.b.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&n.setVerticesData(o.b.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),n.setIndices(t.indices,null)}if(t.subMeshes){n.subMeshes=[];for(var R=0;R<t.subMeshes.length;R++){var M=t.subMeshes[R];a.b.AddToMesh(M.materialIndex,M.verticesStart,M.verticesCount,M.indexStart,M.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),delete n._shouldGenerateFlatShading),n.computeWorldMatrix(!0),r.onMeshImportedObservable.notifyObservers(n)},e._CleanMatricesWeights=function(e,t){if(s.a.CleanBoneMatrixWeights){var n=0;if(e.skeletonId>-1){var i=t.getScene().getLastSkeletonByID(e.skeletonId);if(i){n=i.bones.length;for(var r=t.getVerticesData(o.b.MatricesIndicesKind),a=t.getVerticesData(o.b.MatricesIndicesExtraKind),l=e.matricesWeights,c=e.matricesWeightsExtra,u=e.numBoneInfluencer,h=l.length,d=0;d<h;d+=4){for(var f=0,p=-1,g=0;g<4;g++)f+=m=l[d+g],m<.001&&p<0&&(p=g);if(c)for(g=0;g<4;g++){var m;f+=m=c[d+g],m<.001&&p<0&&(p=g+4)}if((p<0||p>u-1)&&(p=u-1),f>.001){var _=1/f;for(g=0;g<4;g++)l[d+g]*=_;if(c)for(g=0;g<4;g++)c[d+g]*=_}else p>=4?(c[d+p-4]=1-f,a[d+p-4]=n):(l[d+p]=1-f,r[d+p]=n)}t.setVerticesData(o.b.MatricesIndicesKind,r),e.matricesWeightsExtra&&t.setVerticesData(o.b.MatricesIndicesExtraKind,a)}}}},e.Parse=function(t,n,a){if(n.getGeometryByID(t.id))return null;var s=new e(t.id,n,void 0,t.updatable);return h.a&&h.a.AddTagsTo(s,t.tags),t.delayLoadingFile?(s.delayLoadState=c.a.DELAYLOADSTATE_NOTLOADED,s.delayLoadingFile=a+t.delayLoadingFile,s._boundingInfo=new l.a(i.x.FromArray(t.boundingBoxMinimum),i.x.FromArray(t.boundingBoxMaximum)),s._delayInfo=[],t.hasUVs&&s._delayInfo.push(o.b.UVKind),t.hasUVs2&&s._delayInfo.push(o.b.UV2Kind),t.hasUVs3&&s._delayInfo.push(o.b.UV3Kind),t.hasUVs4&&s._delayInfo.push(o.b.UV4Kind),t.hasUVs5&&s._delayInfo.push(o.b.UV5Kind),t.hasUVs6&&s._delayInfo.push(o.b.UV6Kind),t.hasColors&&s._delayInfo.push(o.b.ColorKind),t.hasMatricesIndices&&s._delayInfo.push(o.b.MatricesIndicesKind),t.hasMatricesWeights&&s._delayInfo.push(o.b.MatricesWeightsKind),s._delayLoadingFunction=r.a.ImportVertexData):r.a.ImportVertexData(t,s),n.pushGeometry(s,!0),s},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(8),o=n(0),a=n(42),s=n(53),l=n(54),c=n(48),u=n(41),h=n(33),d=function(e){function t(n,i,a){void 0===i&&(i=o.e.Gray()),void 0===a&&(a=u.a.DefaultUtilityLayer);var s=e.call(this,a)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new r.c;var c=new h.a("",a.utilityLayerScene);c.diffuseColor=i,c.specularColor=i.subtract(new o.e(.1,.1,.1));var d=new h.a("",a.utilityLayerScene);d.diffuseColor=i.add(new o.e(.3,.3,.3));var f=t._CreateArrow(a.utilityLayerScene,c);f.lookAt(s._rootMesh.position.add(n)),f.scaling.scaleInPlace(1/3),f.parent=s._rootMesh;var p=0,g=new o.x,m={snapDistance:0};s.dragBehavior=new l.a({dragAxis:n}),s.dragBehavior.moveAttached=!1,s._rootMesh.addBehavior(s.dragBehavior);var _=new o.x,v=new o.j;s.dragBehavior.onDragObservable.add(function(e){if(s.attachedMesh)if(s.attachedMesh.parent?(s.attachedMesh.parent.computeWorldMatrix().invertToRef(v),v.setTranslationFromFloats(0,0,0),o.x.TransformCoordinatesToRef(e.delta,v,_)):_.copyFrom(e.delta),0==s.snapDistance)s.attachedMesh.position.addInPlace(_);else if(p+=e.dragDistance,Math.abs(p)>s.snapDistance){var t=Math.floor(Math.abs(p)/s.snapDistance);p%=s.snapDistance,_.normalizeToRef(g),g.scaleInPlace(s.snapDistance*t),s.attachedMesh.position.addInPlace(g),m.snapDistance=s.snapDistance*t,s.onSnapObservable.notifyObservers(m)}}),s._pointerObserver=a.utilityLayerScene.onPointerObservable.add(function(e){if(!s._customMeshSet){var t=e.pickInfo&&-1!=s._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?d:c;s._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var b=a._getSharedGizmoLight();return b.includedOnlyMeshes=b.includedOnlyMeshes.concat(s._rootMesh.getChildMeshes(!1)),s}return i.d(t,e),t._CreateArrow=function(e,t){var n=new a.a("arrow",e),i=s.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375,tessellation:96},e),r=s.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},e);return r.material=t,i.parent=n,r.parent=n,i.material=t,i.rotation.x=Math.PI/2,i.position.z+=.3,r.position.z+=.1375,r.rotation.x=Math.PI/2,n},t._CreateArrowInstance=function(e,t){for(var n=new a.a("arrow",e),i=0,r=t.getChildMeshes();i<r.length;i++){var o=r[i];o.createInstance(o.name).parent=n}return n},t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.FilesToLoad={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this._xhr=new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var t in e.CustomRequestHeaders){var n=e.CustomRequestHeaders[t];n&&this._xhr.setRequestHeader(t,n)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,n){this._xhr.addEventListener(e,t,n)},e.prototype.removeEventListener=function(e,t,n){this._xhr.removeEventListener(e,t,n)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,n){for(var i=0,r=e.CustomRequestModifiers;i<r.length;i++)(0,r[i])(this._xhr);return this._xhr.open(t,n,!0)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach(function(e,n){return t.add(e,n)})},e.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},e.prototype.getOrAddWithFactory=function(e,t){var n=this.get(e);return void 0!==n?n:((n=t(e))&&this.add(e,n),n)},e.prototype.getOrAdd=function(e,t){var n=this.get(e);return void 0!==n?n:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data)e(t,this._data[t])},e.prototype.first=function(e){for(var t in this._data){var n=e(t,this._data[t]);if(n)return n}return null},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return c});var i=n(0),r=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],o=[function(e){return 1},function(e){return e.y},function(e){return e.z},function(e){return e.x},function(e){return e.x*e.y},function(e){return e.y*e.z},function(e){return 3*e.z*e.z-1},function(e){return e.x*e.z},function(e){return e.x*e.x-e.y*e.y}],a=function(e,t){return r[e]*o[e](t)},s=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],l=function(){function e(){this.preScaled=!1,this.l00=i.x.Zero(),this.l1_1=i.x.Zero(),this.l10=i.x.Zero(),this.l11=i.x.Zero(),this.l2_2=i.x.Zero(),this.l2_1=i.x.Zero(),this.l20=i.x.Zero(),this.l21=i.x.Zero(),this.l22=i.x.Zero()}return e.prototype.addLight=function(e,t,n){var r=new i.x(t.r,t.g,t.b).scale(n);this.l00=this.l00.add(r.scale(a(0,e))),this.l1_1=this.l1_1.add(r.scale(a(1,e))),this.l10=this.l10.add(r.scale(a(2,e))),this.l11=this.l11.add(r.scale(a(3,e))),this.l2_2=this.l2_2.add(r.scale(a(4,e))),this.l2_1=this.l2_1.add(r.scale(a(5,e))),this.l20=this.l20.add(r.scale(a(6,e))),this.l21=this.l21.add(r.scale(a(7,e))),this.l22=this.l22.add(r.scale(a(8,e)))},e.prototype.scaleInPlace=function(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},e.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(r[0]),this.l1_1.scaleInPlace(r[1]),this.l10.scaleInPlace(r[2]),this.l11.scaleInPlace(r[3]),this.l2_2.scaleInPlace(r[4]),this.l2_1.scaleInPlace(r[5]),this.l20.scaleInPlace(r[6]),this.l21.scaleInPlace(r[7]),this.l22.scaleInPlace(r[8])},e.FromArray=function(t){var n=new e;return i.x.FromArrayToRef(t[0],0,n.l00),i.x.FromArrayToRef(t[1],0,n.l1_1),i.x.FromArrayToRef(t[2],0,n.l10),i.x.FromArrayToRef(t[3],0,n.l11),i.x.FromArrayToRef(t[4],0,n.l2_2),i.x.FromArrayToRef(t[5],0,n.l2_1),i.x.FromArrayToRef(t[6],0,n.l20),i.x.FromArrayToRef(t[7],0,n.l21),i.x.FromArrayToRef(t[8],0,n.l22),n},e.FromPolynomial=function(t){var n=new e;return n.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),n.l1_1=t.y.scale(.977204),n.l10=t.z.scale(.977204),n.l11=t.x.scale(.977204),n.l2_2=t.xy.scale(1.16538),n.l2_1=t.yz.scale(1.16538),n.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),n.l21=t.zx.scale(1.16538),n.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),n.l1_1.scaleInPlace(-1),n.l11.scaleInPlace(-1),n.l2_1.scaleInPlace(-1),n.l21.scaleInPlace(-1),n.scaleInPlace(Math.PI),n},e}(),c=function(){function e(){this.x=i.x.Zero(),this.y=i.x.Zero(),this.z=i.x.Zero(),this.xx=i.x.Zero(),this.yy=i.x.Zero(),this.zz=i.x.Zero(),this.xy=i.x.Zero(),this.yz=i.x.Zero(),this.zx=i.x.Zero()}return Object.defineProperty(e.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=l.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!0,configurable:!0}),e.prototype.addAmbient=function(e){var t=new i.x(e.r,e.g,e.b);this.xx=this.xx.add(t),this.yy=this.yy.add(t),this.zz=this.zz.add(t)},e.prototype.scaleInPlace=function(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)},e.FromHarmonics=function(t){var n=new e;return n._harmonics=t,n.x=t.l11.scale(1.02333).scale(-1),n.y=t.l1_1.scale(1.02333).scale(-1),n.z=t.l10.scale(1.02333),n.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)),n.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)),n.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),n.yz=t.l2_1.scale(.858086).scale(-1),n.zx=t.l21.scale(.858086).scale(-1),n.xy=t.l2_2.scale(.858086),n.scaleInPlace(1/Math.PI),n},e.FromArray=function(t){var n=new e;return i.x.FromArrayToRef(t[0],0,n.x),i.x.FromArrayToRef(t[1],0,n.y),i.x.FromArrayToRef(t[2],0,n.z),i.x.FromArrayToRef(t[3],0,n.xx),i.x.FromArrayToRef(t[4],0,n.yy),i.x.FromArrayToRef(t[5],0,n.zz),i.x.FromArrayToRef(t[6],0,n.yz),i.x.FromArrayToRef(t[7],0,n.zx),i.x.FromArrayToRef(t[8],0,n.xy),n},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(6),r=function(){function e(e,t,n){this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=n,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){var t;if(this._uniformLocationPointer%(t=e<=2?e:4)!=0){var n=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-n,r=0;r<i;r++)this._data.push(0)}},e.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[e]){var n;if(t instanceof Array)t=(n=t).length;else{t=t,n=[];for(var i=0;i<t;i++)n.push(0)}for(this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,i=0;i<t;i++)this._data.push(n[i]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,n){this.addUniform(e,[t,n])},e.prototype.addFloat3=function(e,t,n,i){this.addUniform(e,[t,n,i])},e.prototype.addColor3=function(e,t){var n=new Array;t.toArray(n),this.addUniform(e,n)},e.prototype.addColor4=function(e,t,n){var i=new Array;t.toArray(i),i.push(n),this.addUniform(e,i)},e.prototype.addVector3=function(e,t){var n=new Array;t.toArray(n),this.addUniform(e,n)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._buffer=this._dynamic?this._engine.createDynamicUniformBuffer(this._bufferData):this._engine.createUniformBuffer(this._bufferData))},e.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},e.prototype.updateUniform=function(e,t,n){var r=this._uniformLocations[e];if(void 0===r){if(this._buffer)return void i.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,n),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(a=0;a<n;a++)this._bufferData[r+a]=t[a];else{for(var o=!1,a=0;a<n;a++)this._bufferData[r+a]!==t[a]&&(o=!0,this._bufferData[r+a]=t[a]);this._needSync=this._needSync||o}},e.prototype._updateMatrix3x3ForUniform=function(t,n){for(var i=0;i<3;i++)e._tempBuffer[4*i]=n[3*i],e._tempBuffer[4*i+1]=n[3*i+1],e._tempBuffer[4*i+2]=n[3*i+2],e._tempBuffer[4*i+3]=0;this.updateUniform(t,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,n){for(var i=0;i<2;i++)e._tempBuffer[4*i]=n[2*i],e._tempBuffer[4*i+1]=n[2*i+1],e._tempBuffer[4*i+2]=0,e._tempBuffer[4*i+3]=0;this.updateUniform(t,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,n){e._tempBuffer[0]=n,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,n,i){void 0===i&&(i=""),this._currentEffect.setFloat2(e+i,t,n)},e.prototype._updateFloat2ForUniform=function(t,n,i){e._tempBuffer[0]=n,e._tempBuffer[1]=i,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,n,i,r){void 0===r&&(r=""),this._currentEffect.setFloat3(e+r,t,n,i)},e.prototype._updateFloat3ForUniform=function(t,n,i,r){e._tempBuffer[0]=n,e._tempBuffer[1]=i,e._tempBuffer[2]=r,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,n,i,r,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,n,i,r)},e.prototype._updateFloat4ForUniform=function(t,n,i,r,o){e._tempBuffer[0]=n,e._tempBuffer[1]=i,e._tempBuffer[2]=r,e._tempBuffer[3]=o,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this.updateUniform(e,t.toArray(),16)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,n){void 0===n&&(n=""),this._currentEffect.setColor3(e+n,t)},e.prototype._updateColor3ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,n,i){void 0===i&&(i=""),this._currentEffect.setColor4(e+i,t,n)},e.prototype._updateColor4ForUniform=function(t,n,i){n.toArray(e._tempBuffer),e._tempBuffer[3]=i,this.updateUniform(t,e._tempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&e.bindUniformBuffer(this._buffer,t)},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);-1!==t&&(e[t]=e[e.length-1],e.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e];"_"!==n[0]&&this._keys.push(n)}},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var n=this._keys[t];if(this[n]!==e[n])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];e[n]=this[n]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];switch(typeof this[t]){case"number":this[t]=0;break;case"string":this[t]="";break;default:this[t]=!1}}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var n=this._keys[t],i=this[n];switch(typeof i){case"number":case"string":e+="#define "+n+" "+i+"\n";break;default:i&&(e+="#define "+n+"\n")}}return e},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(1),r=n(2),o=n(0),a=n(25),s=n(38);a.a.AddNodeConstructor("Light_Type_3",function(e,t){return function(){return new l(e,o.x.Zero(),t)}});var l=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r.groundColor=new o.e(0,0,0),r.direction=n||o.x.Up(),r}return i.d(t,e),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.getClassName=function(){return"HemisphericLight"},t.prototype.setDirectionToTarget=function(e){return this.direction=o.x.Normalize(e.subtract(o.x.Zero())),this.direction},t.prototype.getShadowGenerator=function(){return null},t.prototype.transferToEffect=function(e,t){var n=o.x.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},t.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=o.j.Identity()),this._worldMatrix},t.prototype.getTypeID=function(){return s.a.LIGHTTYPEID_HEMISPHERICLIGHT},t.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},i.c([Object(r.e)()],t.prototype,"groundColor",void 0),i.c([Object(r.o)()],t.prototype,"direction",void 0),t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(1),r=n(20),o=n(29),a=n(22),s=function(e){function t(t,n){var i=e.call(this,t,n,!0)||this;return n.multiMaterials.push(i),i.subMaterials=new Array,i._storeEffectOnSubMeshes=!0,i}return i.d(t,e),Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(e){var t=this,n=e.push;e.push=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var o=n.apply(e,i);return t._markAllSubMeshesAsTexturesDirty(),o};var i=e.splice;e.splice=function(n,r){var o=i.apply(e,[n,r]);return t._markAllSubMeshesAsTexturesDirty(),o}},t.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.getActiveTextures=function(){var t;return(t=e.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map(function(e){return e?e.getActiveTextures():[]}))},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(e,t,n){for(var i=0;i<this.subMaterials.length;i++){var r=this.subMaterials[i];if(r){if(r._storeEffectOnSubMeshes){if(!r.isReadyForSubMesh(e,t,n))return!1;continue}if(!r.isReady(e))return!1}}return!0},t.prototype.clone=function(e,n){for(var i=new t(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var o,a=this.subMaterials[r];o=n&&a?a.clone(e+"-"+a.name):this.subMaterials[r],i.subMaterials.push(o)}return i},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,o.a&&(e.tags=o.a.GetTags(this)),e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var n=this.subMaterials[t];e.materials.push(n?n.id:null)}return e},t.prototype.dispose=function(t,n,i){var r=this.getScene();if(r){if(i)for(var o=0;o<this.subMaterials.length;o++){var a=this.subMaterials[o];a&&a.dispose(t,n)}(o=r.multiMaterials.indexOf(this))>=0&&r.multiMaterials.splice(o,1),e.prototype.dispose.call(this,t,n)}},t.ParseMultiMaterial=function(e,n){var i=new t(e.name,n);i.id=e.id,o.a&&o.a.AddTagsTo(i,e.tags);for(var r=0;r<e.materials.length;r++){var a=e.materials[r];i.subMaterials.push(a?n.getMaterialByID(a):null)}return i},t}(r.a);a.a.RegisteredTypes["BABYLON.MultiMaterial"]=s},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bonesVertex="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),r=n(12),o=n(62),a=n(3),s=function(e,t,n,i){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=n,this.worldAxisForFileY=i},l=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(e){if(!e.isCube)return null;var t,n,i=e.getSize().width,r=e.readPixels(0),o=e.readPixels(1);e.isRenderTarget?(t=e.readPixels(3),n=e.readPixels(2)):(t=e.readPixels(2),n=e.readPixels(3));var s=e.readPixels(4),l=e.readPixels(5),c=a.a.TEXTURETYPE_UNSIGNED_INT;return e.textureType&&e.textureType!==a.a.TEXTURETYPE_UNSIGNED_INT&&(c=a.a.TEXTURETYPE_FLOAT),this.ConvertCubeMapToSphericalPolynomial({size:i,right:r,left:o,up:t,down:n,front:s,back:l,format:a.a.TEXTUREFORMAT_RGBA,type:c,gammaSpace:e.gammaSpace})},e.ConvertCubeMapToSphericalPolynomial=function(e){for(var t=new o.a,n=0,s=2/e.size,l=s,c=.5*s-1,u=0;u<6;u++)for(var h=this.FileFaces[u],d=e[h.name],f=c,p=e.format===a.a.TEXTUREFORMAT_RGBA?4:3,g=0;g<e.size;g++){for(var m=c,_=0;_<e.size;_++){var v=h.worldAxisForFileX.scale(m).add(h.worldAxisForFileY.scale(f)).add(h.worldAxisForNormal);v.normalize();var b=Math.pow(1+m*m+f*f,-1.5),y=d[g*e.size*p+_*p+0],T=d[g*e.size*p+_*p+1],E=d[g*e.size*p+_*p+2];e.type===a.a.TEXTURETYPE_UNSIGNED_INT&&(y/=255,T/=255,E/=255),e.gammaSpace&&(y=Math.pow(r.a.Clamp(y),i.v),T=Math.pow(r.a.Clamp(T),i.v),E=Math.pow(r.a.Clamp(E),i.v));var x=new i.e(y,T,E);t.addLight(v,x,b),n+=b,m+=s}f+=l}var C=4*Math.PI*6/6/n;return t.scaleInPlace(C),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),o.b.FromHarmonics(t)},e.FileFaces=[new s("right",new i.x(1,0,0),new i.x(0,0,-1),new i.x(0,-1,0)),new s("left",new i.x(-1,0,0),new i.x(0,0,1),new i.x(0,-1,0)),new s("up",new i.x(0,1,0),new i.x(1,0,0),new i.x(0,0,1)),new s("down",new i.x(0,-1,0),new i.x(1,0,0),new i.x(0,0,-1)),new s("front",new i.x(0,0,1),new i.x(1,0,0),new i.x(0,-1,0)),new s("back",new i.x(0,0,-1),new i.x(-1,0,0),new i.x(0,-1,0))],e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"a",function(){return d});var i=n(1),r=n(0),o=n(4),a=n(11),s=n(111),l=n(20),c=n(76),u=(n(126),n(127),n(15)),h=function(e){function t(t,n,i,a,s,l,u){void 0===n&&(n=null),void 0===i&&(i=null);var h=e.call(this,t,n,i,a,s)||this;h.useVertexColor=l,h.useVertexAlpha=u,h.color=new r.e(1,1,1),h.alpha=1,a&&(h.color=a.color.clone(),h.alpha=a.alpha,h.useVertexColor=a.useVertexColor,h.useVertexAlpha=a.useVertexAlpha),h.intersectionThreshold=.1;var d={attributes:[o.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===u&&(d.needAlphaBlending=!1),l?(d.defines.push("#define VERTEXCOLOR"),d.attributes.push(o.b.ColorKind)):d.uniforms.push("color"),h._colorShader=new c.a("colorShader",h.getScene(),"color",d),h}return i.d(t,e),t.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},t.prototype._removeClipPlaneDefine=function(e){var t=this._colorShader.options.defines.indexOf("#define "+e);-1!==t&&this._colorShader.options.defines.splice(t,1)},t.prototype.isReady=function(){var t=this.getScene();return t.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),t.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),t.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),t.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),!!this._colorShader.isReady()&&e.prototype.isReady.call(this)},t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._bind=function(e,t,n){if(!this._geometry)return this;var i=this._colorShader.getEffect(),r=this.isUnIndexed?null:this._geometry.getIndexBuffer();return this._geometry._bind(i,r),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),u.a.BindClipPlane(i,this.getScene()),this},t.prototype._draw=function(e,t,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var i=this.getScene().getEngine();return this._unIndexed?i.drawArraysType(l.a.LineListDrawMode,e.verticesStart,e.verticesCount,n):i.drawElementsType(l.a.LineListDrawMode,e.indexStart,e.indexCount,n),this},t.prototype.dispose=function(t){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e,n,i){return new t(e,this.getScene(),n,this,i)},t.prototype.createInstance=function(e){return new d(e,this)},t}(a.a),d=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.intersectionThreshold=n.intersectionThreshold,i}return i.d(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(1),r=function(e){function t(t){var n=e.call(this)||this;return n._buffer=t,n}return i.d(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(n(78).a)},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(33),o=n(58),a=function(){function e(t,n,a,s,l,c){if(void 0===n&&(n=1),void 0===a&&(a=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=n,!s){var u=new r.a("",t);u.disableLighting=!0,u.emissiveColor=i.e.Red().scale(.5),s=o.a._CreateArrow(t,u)}if(!l){var h=new r.a("",t);h.disableLighting=!0,h.emissiveColor=i.e.Green().scale(.5),l=o.a._CreateArrow(t,h)}if(!c){var d=new r.a("",t);d.disableLighting=!0,d.emissiveColor=i.e.Blue().scale(.5),c=o.a._CreateArrow(t,d)}this._xAxis=s,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=l,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=c,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=a&&(e._SetRenderingGroupId(this._xAxis,a),e._SetRenderingGroupId(this._yAxis,a),e._SetRenderingGroupId(this._zAxis,a)),this.scene=t,this.update(new i.x,i.x.Right(),i.x.Up(),i.x.Forward())}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t,n,i){this._xAxis.position.copyFrom(e),this._xAxis.setDirection(t),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(e),this._yAxis.setDirection(n),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(e),this._zAxis.setDirection(i),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},e.prototype.createInstance=function(){var t=o.a._CreateArrowInstance(this.scene,this._xAxis),n=o.a._CreateArrowInstance(this.scene,this._yAxis),i=o.a._CreateArrowInstance(this.scene,this._zAxis),r=new e(this.scene,this.scaleLines,null,t,n,i);return r._instanced=!0,r},e.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},e._SetRenderingGroupId=function(e,t){e.getChildMeshes().forEach(function(e){e.renderingGroupId=t})},e}(),s=n(1),l=function(e){function t(t,n,r,o){void 0===o&&(o=1);var a=e.call(this,t,o)||this;return a.pos=i.x.Zero(),a.xaxis=i.x.Zero(),a.yaxis=i.x.Zero(),a.zaxis=i.x.Zero(),a.mesh=r,a.bone=n,a}return s.d(t,e),t.prototype.update=function(){if(this.mesh&&this.bone){var t=this.bone;t.getAbsolutePositionToRef(this.mesh,this.pos),t.getDirectionToRef(i.c.X,this.mesh,this.xaxis),t.getDirectionToRef(i.c.Y,this.mesh,this.yaxis),t.getDirectionToRef(i.c.Z,this.mesh,this.zaxis),e.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},t.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,e.prototype.dispose.call(this))},t}(a),c=n(9),u=n(8),h=n(16),d=n(10);Object.defineProperty(h.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new f(this)),this._debugLayer},enumerable:!0,configurable:!0});var f=function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this.onPropertyChangedObservable=new u.c,this._scene=e,this._scene.onDisposeObservable.add(function(){t._scene._debugLayer&&t._scene._debugLayer.hide()})}return e.prototype._createInspector=function(e){if(!this.isVisible()){var t=s.a({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,t)}},e.prototype.select=function(e,t){this.BJSINSPECTOR&&(this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(t),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(e))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.show=function(t){var n=this;return new Promise(function(i,r){void 0===n.BJSINSPECTOR?c.h.LoadScript(t&&t.inspectorURL?t.inspectorURL:e.InspectorURL,function(){n._createInspector(t),i(n)}):(n._createInspector(t),i(n))})},e.InspectorURL="https://unpkg.com/babylonjs-inspector@"+d.b.Version+"/babylon.inspector.bundle.js",e}(),p=n(11),g=n(52),m=n(46),_=n(23),v=n(27),b=n(41),y=n(53),T=function(){function e(e){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=e||_.a.LastCreatedScene;var t=this._scene.getPhysicsEngine();t&&(this._physicsEnginePlugin=t.getPhysicsPlugin()),this._utilityLayer=new b.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return e.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var n=this._impostors[t];if(n)if(n.isDisposed)this.hideImpostor(this._impostors[t--]);else{if(n.type===v.a.MeshImpostor)continue;var i=this._meshes[t];i&&e&&e.syncMeshWithImpostor(i,n)}}},e.prototype.showImpostor=function(e,t){if(!this._scene)return null;for(var n=0;n<this._numMeshes;n++)if(this._impostors[n]==e)return null;var i=this._getDebugMesh(e,t);return i&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=i,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),i},e.prototype.hideImpostor=function(e){if(e&&this._scene&&this._utilityLayer){for(var t=!1,n=this._utilityLayer.utilityLayerScene,i=0;i<this._numMeshes;i++)if(this._impostors[i]==e){var r=this._meshes[i];if(!r)continue;n.removeMesh(r),r.dispose();var o=this._debugMeshMeshes.indexOf(r);o>-1&&this._debugMeshMeshes.splice(o,1),this._numMeshes--,this._numMeshes>0?(this._meshes[i]=this._meshes[this._numMeshes],this._impostors[i]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},e.prototype._getDebugMaterial=function(e){return this._debugMaterial||(this._debugMaterial=new r.a("",e),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=i.e.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},e.prototype._getDebugBoxMesh=function(e){return this._debugBoxMesh||(this._debugBoxMesh=g.a.CreateBox("physicsBodyBoxViewMesh",{size:1},e),this._debugBoxMesh.rotationQuaternion=i.q.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(e),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugSphereMesh=function(e){return this._debugSphereMesh||(this._debugSphereMesh=m.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},e),this._debugSphereMesh.rotationQuaternion=i.q.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(e),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugCylinderMesh=function(e){return this._debugCylinderMesh||(this._debugCylinderMesh=y.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},e),this._debugCylinderMesh.rotationQuaternion=i.q.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(e),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugMeshMesh=function(e,t){var n=new p.a(e.name,t,null,e);return n.position=i.x.Zero(),n.setParent(e),n.material=this._getDebugMaterial(t),this._debugMeshMeshes.push(n),n},e.prototype._getDebugMesh=function(e,t){var n=this;if(!this._utilityLayer)return null;if(t&&t.parent&&t.parent.physicsImpostor)return null;var i=null,r=this._utilityLayer.utilityLayerScene;switch(e.type){case v.a.BoxImpostor:i=this._getDebugBoxMesh(r),e.getBoxSizeToRef(i.scaling);break;case v.a.SphereImpostor:i=this._getDebugSphereMesh(r);var o=e.getRadius();i.scaling.x=2*o,i.scaling.y=2*o,i.scaling.z=2*o;break;case v.a.MeshImpostor:t&&(i=this._getDebugMeshMesh(t,r));break;case v.a.NoImpostor:t&&t.getChildMeshes().filter(function(e){return e.physicsImpostor?1:0}).forEach(function(e){n._getDebugBoxMesh(r).parent=e});break;case v.a.CylinderImpostor:i=this._getDebugCylinderMesh(r);var a=e.object.getBoundingInfo();i.scaling.x=a.boundingBox.maximum.x-a.boundingBox.minimum.x,i.scaling.y=a.boundingBox.maximum.y-a.boundingBox.minimum.y,i.scaling.z=a.boundingBox.maximum.z-a.boundingBox.minimum.z}return i},e.prototype.dispose=function(){for(var e=this._numMeshes,t=0;t<e;t++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}(),E=n(40),x=function(){function e(e){this.ray=e}return e.CreateAndShow=function(t,n,i){var r=new e(t);return r.show(n,i),r},e.prototype.show=function(e,t){if(!this._renderFunction&&this.ray){var n=this.ray;this._renderFunction=this._render.bind(this),this._scene=e,this._renderPoints=[n.origin,n.origin.add(n.direction.scale(n.length))],this._renderLine=p.a.CreateLines("ray",this._renderPoints,e,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}t&&this._renderLine&&this._renderLine.color.copyFrom(t)},e.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},e.prototype._render=function(){var e=this.ray;if(e){var t=this._renderPoints[1],n=Math.min(e.length,1e6);t.copyFrom(e.direction),t.scaleInPlace(n),t.addInPlace(e.origin),p.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},e.prototype.attachToMesh=function(e,t,n,r){this._attachedToMesh=e;var o=this.ray;o&&(o.direction||(o.direction=i.x.Zero()),o.origin||(o.origin=i.x.Zero()),r&&(o.length=r),n||(n=i.x.Zero()),t||(t=new i.x(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(t),this._meshSpaceOrigin.copyFrom(n)):(this._meshSpaceDirection=t.clone(),this._meshSpaceOrigin=n.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},e.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},e.prototype._updateToMesh=function(){var e=this.ray;this._attachedToMesh&&e&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,e.direction),i.x.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),e.origin)))},e.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},e}(),C=function(){function e(e,t,n,r,o){void 0===r&&(r=!0),void 0===o&&(o=1),this.skeleton=e,this.mesh=t,this.autoUpdateBonesMatrices=r,this.renderingGroupId=o,this.color=i.e.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=n,this._utilityLayer=new b.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(e,t,n,r,o,a){void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0);var s=i.t.Matrix[0],l=t.getParent();if(s.copyFrom(t.getLocalMatrix()),0!==r||0!==o||0!==a){var c=i.t.Matrix[1];i.j.IdentityToRef(c),c.setTranslationFromFloats(r,o,a),c.multiplyToRef(s,s)}l&&s.multiplyToRef(l.getAbsoluteTransform(),s),s.multiplyToRef(n,s),e.x=s.m[12],e.y=s.m[13],e.z=s.m[14]},e.prototype._getLinesForBonesWithLength=function(e,t){for(var n=e.length,r=this.mesh._effectiveMesh.position,o=0;o<n;o++){var a=e[o],s=this._debugLines[o];s||(s=[i.x.Zero(),i.x.Zero()],this._debugLines[o]=s),this._getBonePosition(s[0],a,t),this._getBonePosition(s[1],a,t,0,a.length,0),s[0].subtractInPlace(r),s[1].subtractInPlace(r)}},e.prototype._getLinesForBonesNoLength=function(e,t){for(var n=0,r=this.mesh._effectiveMesh,o=r.position,a=e.length-1;a>=0;a--){var s=e[a],l=s.getParent();if(l){var c=this._debugLines[n];c||(c=[i.x.Zero(),i.x.Zero()],this._debugLines[n]=c),s.getAbsolutePositionToRef(r,c[0]),l.getAbsolutePositionToRef(r,c[1]),c[0].subtractInPlace(o),c[1].subtractInPlace(o),n++}}},e.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var e=this.mesh._effectiveMesh;void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,e.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,e.getWorldMatrix());var t=this._utilityLayer.utilityLayerScene;this._debugMesh?E.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},t):(this._debugMesh=E.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},t),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},e.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}();n.d(t,"AxesViewer",function(){return a}),n.d(t,"BoneAxesViewer",function(){return l}),n.d(t,"DebugLayer",function(){return f}),n.d(t,"PhysicsViewer",function(){return T}),n.d(t,"RayHelper",function(){return x}),n.d(t,"SkeletonViewer",function(){return C})},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(1),r=n(0),o=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._normalMatrix=new r.j,i.allowShaderHotSwapping=!0,i._storeEffectOnSubMeshes=!0,i}return i.d(t,e),t.prototype.getEffect=function(){return this._activeEffect},t.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},t.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},t.prototype._afterBind=function(t,n){void 0===n&&(n=null),e.prototype._afterBind.call(this,t),this.getScene()._cachedEffect=n},t.prototype._mustRebind=function(e,t,n){return void 0===n&&(n=1),e.isCachedMaterialInvalid(this,t,n)},t}(n(20).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(1),r=n(2),o=n(0),a=n(4),s=n(7),l=n(15),c=n(5),u=n(20),h=n(22),d=function(e){function t(t,n,r,a){void 0===a&&(a={});var s=e.call(this,t,n)||this;return s._textures={},s._textureArrays={},s._floats={},s._ints={},s._floatsArrays={},s._colors3={},s._colors3Arrays={},s._colors4={},s._vectors2={},s._vectors3={},s._vectors4={},s._matrices={},s._matrices3x3={},s._matrices2x2={},s._vectors2Arrays={},s._vectors3Arrays={},s._cachedWorldViewMatrix=new o.j,s._shaderPath=r,s._options=i.a({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},a),s}return i.d(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ShaderMaterial"},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},t.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},t.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},t.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},t.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},t.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},t.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},t.prototype._checkCache=function(e,t){return!e||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},t.prototype.isReadyForSubMesh=function(e,t,n){return this.isReady(e,n)},t.prototype.isReady=function(e,t){var n=this.getScene(),i=n.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===n.getRenderId()&&this._checkCache(e,t))return!0;for(var r=[],o=[],s=new c.c,u=0;u<this._options.defines.length;u++)r.push(this._options.defines[u]);for(u=0;u<this._options.attributes.length;u++)o.push(this._options.attributes[u]);if(e&&e.isVerticesDataPresent(a.b.ColorKind)&&(o.push(a.b.ColorKind),r.push("#define VERTEXCOLOR")),t&&(r.push("#define INSTANCES"),l.a.PrepareAttributesForInstances(o,r)),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push(a.b.MatricesIndicesKind),o.push(a.b.MatricesWeightsKind),e.numBoneInfluencers>4&&(o.push(a.b.MatricesIndicesExtraKind),o.push(a.b.MatricesWeightsExtraKind));var h=e.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),s.addCPUSkinningFallback(0,e),h.isUsingTextureForMatrices?(r.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(r.push("#define BonesPerMesh "+(h.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else r.push("#define NUM_BONE_INFLUENCERS 0");for(var d in this._textures)if(!this._textures[d].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&r.push("#define ALPHATEST");var f=this._effect,p=r.join("\n");return this._effect=i.createEffect(this._shaderPath,{attributes:o,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:p,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},i),!!this._effect.isReady()&&(f!==this._effect&&n.resetCachedMaterial(),this._renderId=n.getRenderId(),!0)},t.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix())))},t.prototype.bind=function(e,t){if(this.bindOnlyWorldMatrix(e),this._effect&&this.getScene().getCachedMaterial()!==this){var n;for(n in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),l.a.BindBonesParameters(t,this._effect),this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._textureArrays)this._effect.setTextureArray(n,this._textureArrays[n]);for(n in this._ints)this._effect.setInt(n,this._ints[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors3Arrays)this._effect.setArray3(n,this._colors3Arrays[n]);for(n in this._colors4){var i=this._colors4[n];this._effect.setFloat4(n,i.r,i.g,i.b,i.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._vectors4)this._effect.setVector4(n,this._vectors4[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)this._effect.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)this._effect.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors2Arrays)this._effect.setArray2(n,this._vectors2Arrays[n]);for(n in this._vectors3Arrays)this._effect.setArray3(n,this._vectors3Arrays[n])}this._afterBind(t)},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);for(var n in this._textures)t.push(this._textures[n]);for(var n in this._textureArrays)for(var i=this._textureArrays[n],r=0;r<i.length;r++)t.push(i[r]);return t},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;for(var n in this._textures)if(this._textures[n]===t)return!0;for(var n in this._textureArrays)for(var i=this._textureArrays[n],r=0;r<i.length;r++)if(i[r]===t)return!0;return!1},t.prototype.clone=function(e){return new t(e,this.getScene(),this._shaderPath,this._options)},t.prototype.dispose=function(t,n,i){if(n){var r;for(r in this._textures)this._textures[r].dispose();for(r in this._textureArrays)for(var o=this._textureArrays[r],a=0;a<o.length;a++)o[a].dispose()}this._textures={},e.prototype.dispose.call(this,t,n,i)},t.prototype.serialize=function(){var e,t=r.a.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var n=this._textureArrays[e],i=0;i<n.length;i++)t.textureArrays[e].push(n[i].serialize())}for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];return t},t.Parse=function(e,n,i){var a,l=r.a.Parse(function(){return new t(e.name,n,e.shaderPath,e.options)},e,n,i);for(a in e.textures)l.setTexture(a,s.a.Parse(e.textures[a],n,i));for(a in e.textureArrays){for(var c=e.textureArrays[a],u=new Array,h=0;h<c.length;h++)u.push(s.a.Parse(c[h],n,i));l.setTextureArray(a,u)}for(a in e.floats)l.setFloat(a,e.floats[a]);for(a in e.floatsArrays)l.setFloats(a,e.floatsArrays[a]);for(a in e.colors3)l.setColor3(a,o.e.FromArray(e.colors3[a]));for(a in e.colors3Arrays){var d=e.colors3Arrays[a].reduce(function(e,t,n){return n%3==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return o.e.FromArray(e)});l.setColor3Array(a,d)}for(a in e.colors4)l.setColor4(a,o.f.FromArray(e.colors4[a]));for(a in e.vectors2)l.setVector2(a,o.w.FromArray(e.vectors2[a]));for(a in e.vectors3)l.setVector3(a,o.x.FromArray(e.vectors3[a]));for(a in e.vectors4)l.setVector4(a,o.y.FromArray(e.vectors4[a]));for(a in e.matrices)l.setMatrix(a,o.j.FromArray(e.matrices[a]));for(a in e.matrices3x3)l.setMatrix3x3(a,e.matrices3x3[a]);for(a in e.matrices2x2)l.setMatrix2x2(a,e.matrices2x2[a]);for(a in e.vectors2Arrays)l.setArray2(a,e.vectors2Arrays[a]);for(a in e.vectors3Arrays)l.setArray3(a,e.vectors3Arrays[a]);return l},t}(u.a);h.a.RegisteredTypes["BABYLON.ShaderMaterial"]=d},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(34),r=n(0),o=function(){function e(e,t,n){this.vectors=i.a.BuildArray(8,r.x.Zero),this.center=r.x.Zero(),this.centerWorld=r.x.Zero(),this.extendSize=r.x.Zero(),this.extendSizeWorld=r.x.Zero(),this.directions=i.a.BuildArray(3,r.x.Zero),this.vectorsWorld=i.a.BuildArray(8,r.x.Zero),this.minimumWorld=r.x.Zero(),this.maximumWorld=r.x.Zero(),this.minimum=r.x.Zero(),this.maximum=r.x.Zero(),this.reConstruct(e,t,n)}return e.prototype.reConstruct=function(e,t,n){var i=e.x,o=e.y,a=e.z,s=t.x,l=t.y,c=t.z,u=this.vectors;this.minimum.copyFromFloats(i,o,a),this.maximum.copyFromFloats(s,l,c),u[0].copyFromFloats(i,o,a),u[1].copyFromFloats(s,l,c),u[2].copyFromFloats(s,o,a),u[3].copyFromFloats(i,l,a),u[4].copyFromFloats(i,o,c),u[5].copyFromFloats(s,l,a),u[6].copyFromFloats(i,l,c),u[7].copyFromFloats(s,o,c),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||r.j.IdentityReadOnly,this._update(this._worldMatrix)},e.prototype.scale=function(t){var n=e.TmpVector3,i=this.maximum.subtractToRef(this.minimum,n[0]),r=i.length();i.normalizeFromLength(r);var o=i.scaleInPlace(r*t*.5),a=this.center.subtractToRef(o,n[1]),s=this.center.addToRef(o,n[2]);return this.reConstruct(a,s,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(e){var t=this.minimumWorld,n=this.maximumWorld,i=this.directions,o=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){for(t.copyFrom(this.minimum),n.copyFrom(this.maximum),s=0;s<8;++s)o[s].copyFrom(a[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(var s=0;s<8;++s){var l=o[s];r.x.TransformCoordinatesToRef(a[s],e,l),t.minimizeInPlace(l),n.maximizeInPlace(l)}n.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(t,this.centerWorld).scaleInPlace(.5)}r.x.FromArrayToRef(e.m,0,i[0]),r.x.FromArrayToRef(e.m,4,i[1]),r.x.FromArrayToRef(e.m,8,i[2]),this._worldMatrix=e},e.prototype.isInFrustum=function(t){return e.IsInFrustum(this.vectorsWorld,t)},e.prototype.isCompletelyInFrustum=function(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)},e.prototype.intersectsPoint=function(e){var t=this.minimumWorld,n=this.maximumWorld,i=e.x,o=e.y,a=e.z,s=-r.h;return!(n.x-i<s||s>i-t.x||n.y-o<s||s>o-t.y||n.z-a<s||s>a-t.z)},e.prototype.intersectsSphere=function(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)},e.prototype.intersectsMinMax=function(e,t){var n=this.minimumWorld,i=this.maximumWorld;return!(i.x<e.x||n.x>t.x||i.y<e.y||n.y>t.y||i.z<e.z||n.z>t.z)},e.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},e.IntersectsSphere=function(t,n,i,o){var a=e.TmpVector3[0];return r.x.ClampToRef(i,t,n,a),r.x.DistanceSquared(i,a)<=o*o},e.IsCompletelyInFrustum=function(e,t){for(var n=0;n<6;++n)for(var i=t[n],r=0;r<8;++r)if(i.dotCoordinate(e[r])<0)return!1;return!0},e.IsInFrustum=function(e,t){for(var n=0;n<6;++n){for(var i=!0,r=t[n],o=0;o<8;++o)if(r.dotCoordinate(e[o])>=0){i=!1;break}if(i)return!1}return!0},e.TmpVector3=i.a.BuildArray(3,r.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(3),r=function(){function e(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(e,"HasTriggers",{get:function(){for(var t in e.Triggers)if(e.Triggers.hasOwnProperty(t))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HasPickTriggers",{get:function(){for(var t in e.Triggers)if(e.Triggers.hasOwnProperty(t)){var n=parseInt(t);if(n>=i.a.ACTION_OnPickTrigger&&n<=i.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),e.HasSpecificTrigger=function(t){for(var n in e.Triggers)if(e.Triggers.hasOwnProperty(n)&&parseInt(n)===t)return!0;return!1},e.Triggers={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(11),r=n(13);r.a.CreatePlane=function(e){var t=[],n=[],i=[],o=[],a=0===e.sideOrientation?0:e.sideOrientation||r.a.DEFAULTSIDE,s=(e.width||e.size||1)/2,l=(e.height||e.size||1)/2;n.push(-s,-l,0),i.push(0,0,-1),o.push(0,0),n.push(s,-l,0),i.push(0,0,-1),o.push(1,0),n.push(s,l,0),i.push(0,0,-1),o.push(1,1),n.push(-s,l,0),i.push(0,0,-1),o.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),r.a._ComputeSides(a,n,t,i,o,e.frontUVs,e.backUVs);var c=new r.a;return c.indices=t,c.positions=n,c.normals=i,c.uvs=o,c},i.a.CreatePlane=function(e,t,n,i,r){return o.CreatePlane(e,{size:t,width:t,height:t,sideOrientation:r,updatable:i},n)};var o=function(){function e(){}return e.CreatePlane=function(e,t,n){void 0===n&&(n=null);var o=new i.a(e,n);return t.sideOrientation=i.a._GetDefaultSideOrientation(t.sideOrientation),o._originalBuilderSideOrientation=t.sideOrientation,r.a.CreatePlane(t).applyToMesh(o,t.updatable),t.sourcePlane&&(o.translate(t.sourcePlane.normal,-t.sourcePlane.d),o.setDirection(t.sourcePlane.normal.scale(-1))),o},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(e,t,n){this.bu=e,this.bv=t,this.distance=n,this.faceId=0,this.subMeshId=0}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(34),r=n(0),o=function(){function e(e,t,n){this.center=r.x.Zero(),this.centerWorld=r.x.Zero(),this.minimum=r.x.Zero(),this.maximum=r.x.Zero(),this.reConstruct(e,t,n)}return e.prototype.reConstruct=function(e,t,n){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var i=r.x.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(n||r.j.IdentityReadOnly)},e.prototype.scale=function(t){var n=e.TmpVector3,i=n[0].setAll(this.radius*t),r=this.center.subtractToRef(i,n[1]),o=this.center.addToRef(i,n[2]);return this.reConstruct(r,o,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{r.x.TransformCoordinatesToRef(this.center,t,this.centerWorld);var n=e.TmpVector3[0];r.x.TransformNormalFromFloatsToRef(1,1,1,t,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}},e.prototype.isInFrustum=function(e){for(var t=this.centerWorld,n=this.radiusWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<=-n)return!1;return!0},e.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,n=0;n<6;n++)if(e[n].dotCoordinate(t)<0)return!1;return!0},e.prototype.intersectsPoint=function(e){var t=r.x.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},e.Intersects=function(e,t){var n=r.x.DistanceSquared(e.centerWorld,t.centerWorld),i=e.radiusWorld+t.radiusWorld;return!(i*i<n)},e.TmpVector3=i.a.BuildArray(3,r.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(20),r=n(4),o=n(3),a=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[r.b.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.b.PositionKind]=new r.b(this._scene.getEngine(),e,r.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[r.b.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=this._scene.activeCamera;return!(!n||!(t=t||n._postProcesses.filter(function(e){return null!=e}))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(n,e,null!=t),0))},e.prototype.directRender=function(e,t,n,r,o){void 0===t&&(t=null),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===o&&(o=0);for(var a=this._scene.getEngine(),s=0;s<e.length;s++){s<e.length-1?e[s+1].activate(this._scene.activeCamera,t):t?a.bindFramebuffer(t,r,void 0,void 0,n,void 0,o):a.restoreDefaultFramebuffer();var l=e[s],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,c),a.drawElementsType(i.a.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(c))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,n,r,a){void 0===a&&(a=!1);var s=this._scene.activeCamera;if(s&&0!==(r=r||s._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var l=this._scene.getEngine(),c=0,u=r.length;c<u;c++){var h=r[c];if(c<u-1?h._outputTexture=r[c+1].activate(s,t):t?(l.bindFramebuffer(t,n,void 0,void 0,a),h._outputTexture=t):(l.restoreDefaultFramebuffer(),h._outputTexture=null),e)break;var d=h.apply();d&&(h.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,d),l.drawElementsType(i.a.TriangleFillMode,0,6),h.onAfterRenderObservable.notifyObservers(d))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(o.a.ALPHA_DISABLE)}},e.prototype.dispose=function(){var e=this._vertexBuffers[r.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}()},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightFragmentDeclaration="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightUboDeclaration="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.imageProcessingDeclaration="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.imageProcessingFunctions="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneFragment="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var i=n(109),r=function(){},o=function(){function e(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r,this._scene=t;for(var n=e.MIN_RENDERINGGROUPS;n<e.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(t,n,i,r){var o=this._renderingGroupInfo;if(o.scene=this._scene,o.camera=this._scene.activeCamera,this._scene.spriteManagers&&r)for(var a=0;a<this._scene.spriteManagers.length;a++)this.dispatchSprites(this._scene.spriteManagers[a]);for(a=e.MIN_RENDERINGGROUPS;a<e.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===e.MIN_RENDERINGGROUPS;var s=this._renderingGroups[a];if(s){var l=Math.pow(2,a);if(o.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,l),e.AUTOCLEAR){var c=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];c&&c.autoClear&&this._clearDepthStencilBuffer(c.depth,c.stencil)}for(var u=0,h=this._scene._beforeRenderingGroupDrawStage;u<h.length;u++)h[u].action(a);s.render(t,r,i,n);for(var d=0,f=this._scene._afterRenderingGroupDrawStage;d<f.length;d++)f[d].action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(o,l)}}},e.prototype.reset=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.dispose()}},e.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new i.a(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},e.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},e.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},e.prototype.dispatch=function(e,t,n){void 0===t&&(t=e.getMesh());var i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e,t,n)},e.prototype.setRenderingOrder=function(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=n,this._customTransparentSortCompareFn[e]=i,this._renderingGroups[e]){var r=this._renderingGroups[e];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],r.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},e.prototype.setRenderingAutoClearDepthStencil=function(e,t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:n,stencil:i}},e.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(1),r=n(2),o=n(0),a=function(){function e(){this._dirty=!0,this._tempColor=new o.f(0,0,0,0),this._globalCurve=new o.f(0,0,0,0),this._highlightsCurve=new o.f(0,0,0,0),this._midtonesCurve=new o.f(0,0,0,0),this._shadowsCurve=new o.f(0,0,0,0),this._positiveCurve=new o.f(0,0,0,0),this._negativeCurve=new o.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(e,t,n,i,r){void 0===n&&(n="vCameraColorCurvePositive"),void 0===i&&(i="vCameraColorCurveNeutral"),void 0===r&&(r="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(n,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},e.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype.getColorGradingDataToRef=function(t,n,i,r,o){null!=t&&(t=e.clamp(t,0,360),n=e.clamp(n,-100,100),i=e.clamp(i,-100,100),r=e.clamp(r,-100,100),n=e.applyColorGradingSliderNonlinear(n),n*=.5,r=e.applyColorGradingSliderNonlinear(r),n<0&&(n*=-1,t=(t+180)%360),e.fromHSBToRef(t,n,50+.25*r,o),o.scaleToRef(2,o),o.a=1+.01*i)},e.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),100*t},e.fromHSBToRef=function(t,n,i,r){var o=e.clamp(t,0,360),a=e.clamp(n/100,0,1),s=e.clamp(i/100,0,1);if(0===a)r.r=s,r.g=s,r.b=s;else{o/=60;var l=Math.floor(o),c=o-l,u=s*(1-a),h=s*(1-a*c),d=s*(1-a*(1-c));switch(l){case 0:r.r=s,r.g=d,r.b=u;break;case 1:r.r=h,r.g=s,r.b=u;break;case 2:r.r=u,r.g=s,r.b=d;break;case 3:r.r=u,r.g=h,r.b=s;break;case 4:r.r=d,r.g=u,r.b=s;break;default:r.r=s,r.g=u,r.b=h}}r.a=1},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e.prototype.clone=function(){return r.a.Clone(function(){return new e},this)},e.prototype.serialize=function(){return r.a.Serialize(this)},e.Parse=function(t){return r.a.Parse(function(){return new e},t,null,null)},i.c([Object(r.c)()],e.prototype,"_globalHue",void 0),i.c([Object(r.c)()],e.prototype,"_globalDensity",void 0),i.c([Object(r.c)()],e.prototype,"_globalSaturation",void 0),i.c([Object(r.c)()],e.prototype,"_globalExposure",void 0),i.c([Object(r.c)()],e.prototype,"_highlightsHue",void 0),i.c([Object(r.c)()],e.prototype,"_highlightsDensity",void 0),i.c([Object(r.c)()],e.prototype,"_highlightsSaturation",void 0),i.c([Object(r.c)()],e.prototype,"_highlightsExposure",void 0),i.c([Object(r.c)()],e.prototype,"_midtonesHue",void 0),i.c([Object(r.c)()],e.prototype,"_midtonesDensity",void 0),i.c([Object(r.c)()],e.prototype,"_midtonesSaturation",void 0),i.c([Object(r.c)()],e.prototype,"_midtonesExposure",void 0),e}();r.a._ColorCurvesParser=a.Parse},function(e,t,n){"use strict";var i=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,n,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===n&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=n,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,n,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===n&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=n,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),r=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),o=n(3),a=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=o.a.ALWAYS,e.KEEP=o.a.KEEP,e.REPLACE=o.a.REPLACE,e}();n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a})},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif"},function(e,t,n){"use strict";n.r(t);var i=n(30),r=n(8),o=n(0),a=n(22),s=function(){function e(e,t){this.triggerOptions=e,this.onBeforeExecuteObservable=new r.c,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):this.trigger=e.trigger?e.trigger:e,this._nextActiveAction=this,this._condition=t}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,n=this._actionManager.getScene().getRenderId();if(t._evaluationId===n){if(!t._currentResult)return}else{if(t._evaluationId=n,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction()},e.prototype.execute=function(e){},e.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(e){},e.prototype._serialize=function(e,t){var n={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(n),this._condition){var i=this._condition.serialize();return i.children.push(n),t&&t.children.push(i),i}return t&&t.children.push(n),n},e._SerializeValueAsString=function(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof o.w?e.x+", "+e.y:e instanceof o.x?e.x+", "+e.y+", "+e.z:e instanceof o.e?e.r+", "+e.g+", "+e.b:e instanceof o.f?e.r+", "+e.g+", "+e.b+", "+e.a:e},e._GetTargetProperty=function(e){return{name:"target",targetType:e._isMesh?"MeshProperties":e._isLight?"LightProperties":e._isCamera?"CameraProperties":"SceneProperties",value:e._isScene?"Scene":e.name}},e}();a.a.RegisteredTypes["BABYLON.Action"]=s;var l=n(36),c=n(1),u=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}(),h=function(e){function t(n,i,r,o,a){void 0===a&&(a=t.IsEqual);var s=e.call(this,n)||this;return s.propertyPath=r,s.value=o,s.operator=a,s._target=i,s._effectiveTarget=s._getEffectiveTarget(i,s.propertyPath),s._property=s._getProperty(s.propertyPath),s}return c.d(t,e),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?e:!e}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(e){switch(e){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(u),d=function(e){function t(t,n){var i=e.call(this,t)||this;return i.predicate=n,i}return c.d(t,e),t.prototype.isValid=function(){return this.predicate()},t}(u),f=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.value=i,r._target=n,r}return c.d(t,e),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[s._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(u);a.a.RegisteredTypes["BABYLON.ValueCondition"]=h,a.a.RegisteredTypes["BABYLON.PredicateCondition"]=d,a.a.RegisteredTypes["BABYLON.StateCondition"]=f;var p=n(6),g=n(3),m=function(e){function t(t,n,i,r){var o=e.call(this,t,r)||this;return o.propertyPath=i,o._target=o._effectiveTarget=n,o}return c.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},t)},t}(s),_=function(e){function t(t,n,i,r){var o=e.call(this,t,r)||this;return o.value=i,o._target=n,o}return c.d(t,e),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetStateAction",properties:[s._GetTargetProperty(this._target),{name:"value",value:this.value}]},t)},t}(s),v=function(e){function t(t,n,i,r,o){var a=e.call(this,t,o)||this;return a.propertyPath=i,a.value=r,a._target=a._effectiveTarget=n,a}return c.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)}]},t)},t}(s),b=function(e){function t(t,n,i,r,o){var a=e.call(this,t,o)||this;return a.propertyPath=i,a.value=r,a._target=a._effectiveTarget=n,a}return c.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&p.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)}]},t)},t}(s),y=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t,a)||this;return s.from=i,s.to=r,s.loop=o,s._target=n,s}return c.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[s._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:s._SerializeValueAsString(this.loop)||!1}]},t)},t}(s),T=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r._target=n,r}return c.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[s._GetTargetProperty(this._target)]},t)},t}(s),E=function(e){function t(t,n){return void 0===t&&(t=g.a.ACTION_NothingTrigger),e.call(this,t,n)||this}return c.d(t,e),t.prototype.execute=function(){},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},t)},t}(s),x=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r.children=n,r}return c.d(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t.prototype.serialize=function(t){for(var n=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),i=0;i<this.children.length;i++)n.combine.push(this.children[i].serialize(null));return n},t}(s),C=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r.func=n,r}return c.d(t,e),t.prototype.execute=function(e){this.func(e)},t}(s),S=function(e){function t(t,n,i,r){var o=e.call(this,t,r)||this;return o._target=n,o._parent=i,o}return c.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=o.x.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetParentAction",properties:[s._GetTargetProperty(this._target),s._GetTargetProperty(this._parent)]},t)},t}(s);a.a.RegisteredTypes["BABYLON.SetParentAction"]=S,a.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=C,a.a.RegisteredTypes["BABYLON.DoNothingAction"]=E,a.a.RegisteredTypes["BABYLON.StopAnimationAction"]=T,a.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=y,a.a.RegisteredTypes["BABYLON.IncrementValueAction"]=b,a.a.RegisteredTypes["BABYLON.SetValueAction"]=v,a.a.RegisteredTypes["BABYLON.SetStateAction"]=_,a.a.RegisteredTypes["BABYLON.SetParentAction"]=S;var A=n(23),P=n(32),R=function(e){function t(t){var n=e.call(this)||this;return n._scene=t||A.a.LastCreatedScene,t.actionManagers.push(n),n}return c.d(t,e),t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),n=0;n<this.actions.length;n++){var i=this.actions[n];0==--t.Triggers[i.trigger]&&delete t.Triggers[i.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++)if(e.indexOf(this.actions[t].trigger)>-1)return!0;return!1},t.prototype.hasSpecificTriggers2=function(e,t){for(var n=0;n<this.actions.length;n++){var i=this.actions[n];if(e==i.trigger||t==i.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,t){for(var n=0;n<this.actions.length;n++){var i=this.actions[n];if(i.trigger===e){if(!t)return!0;if(t(i.getTriggerParameter()))return!0}}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(e){return e.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(p.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),t.Triggers[e.trigger]?t.Triggers[e.trigger]++:t.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)},t.prototype.unregisterAction=function(e){var n=this.actions.indexOf(e);return-1!==n&&(this.actions.splice(n,1),0==(t.Triggers[e.trigger]-=1)&&delete t.Triggers[e.trigger],delete e._actionManager,!0)},t.prototype.processTrigger=function(e,n){for(var i=0;i<this.actions.length;i++){var r=this.actions[i];if(r.trigger===e){if(n&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var o=r.getTriggerParameter();if(o&&o!==n.sourceEvent.keyCode){if(!o.toLowerCase)continue;var a=o.toLowerCase();if(a!==n.sourceEvent.key&&String.fromCharCode(n.sourceEvent.charCode?n.sourceEvent.charCode:n.sourceEvent.keyCode).toLowerCase()!==a)continue}}r._executeCurrent(n)}}},t.prototype._getEffectiveTarget=function(e,t){for(var n=t.split("."),i=0;i<n.length-1;i++)e=e[n[i]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t.prototype.serialize=function(e){for(var n={children:new Array,name:e,type:3,properties:new Array},i=0;i<this.actions.length;i++){var r={type:0,children:new Array,name:t.GetTriggerName(this.actions[i].trigger),properties:new Array},o=this.actions[i].triggerOptions;if(o&&"number"!=typeof o)if(o.parameter instanceof Node)r.properties.push(s._GetTargetProperty(o.parameter));else{var a={};P.a.DeepCopy(o.parameter,a,["mesh"]),o.parameter&&o.parameter.mesh&&(a._meshId=o.parameter.mesh.id),r.properties.push({name:"parameter",targetType:null,value:a})}this.actions[i].serialize(r),n.children.push(r)}return n},t.Parse=function(e,n,i){var r=new t(i);null===n?i.actionManager=r:n.actionManager=r;for(var s=function(e,t,n,i){if(null===i){var r=parseFloat(t);return"true"===t||"false"===t?"true"===t:isNaN(r)?t:r}for(var a=i.split("."),s=t.split(","),l=0;l<a.length;l++)n=n[a[l]];if("boolean"==typeof n)return"true"===s[0];if("string"==typeof n)return s[0];var c=new Array;for(l=0;l<s.length;l++)c.push(parseFloat(s[l]));return n instanceof o.x?o.x.FromArray(c):n instanceof o.y?o.y.FromArray(c):n instanceof o.e?o.e.FromArray(c):n instanceof o.f?o.f.FromArray(c):parseFloat(s[0])},l=function(e,n,o,c,d){if(void 0===d&&(d=null),!e.detached){var f=new Array,p=null,g=null,m=e.combine&&e.combine.length>0;if(f.push(2===e.type?r:n),m){for(var _=new Array,v=0;v<e.combine.length;v++)l(e.combine[v],t.NothingTrigger,o,c,_);f.push(_)}else for(var b=0;b<e.properties.length;b++){var y=e.properties[b].value,T=e.properties[b].name,x=e.properties[b].targetType;"target"===T?y=p=null!==x&&"SceneProperties"===x?i:i.getNodeByName(y):"parent"===T?y=i.getNodeByName(y):"sound"===T?i.getSoundByName&&(y=i.getSoundByName(y)):"propertyPath"!==T?y=2===e.type&&"operator"===T?h[y]:s(0,y,p,"value"===T?g:null):g=y,f.push(y)}f.push(null===d?o:null),"InterpolateValueAction"===e.name&&(f[f.length-1]=f[f.length-2],f[f.length-2]=o);var C=function(e,t){var n=a.a.GetClass("BABYLON."+e);if(n){var i=Object.create(n.prototype);return i.constructor.apply(i,t),i}}(e.name,f);if(C instanceof u&&null!==o){var S=new E(n,o);c?c.then(S):r.registerAction(S),c=S}for(null===d?C instanceof u?(o=C,C=c):(o=null,c?c.then(C):r.registerAction(C)):d.push(C),b=0;b<e.children.length;b++)l(e.children[b],n,o,C,null)}},c=0;c<e.children.length;c++){var d,f=e.children[c];if(f.properties.length>0){var p=f.properties[0].value,g=null===f.properties[0].targetType?p:i.getMeshByName(p);g._meshId&&(g.mesh=i.getMeshByID(g._meshId)),d={trigger:t[f.name],parameter:g}}else d=t[f.name];for(var m=0;m<f.children.length;m++)f.detached||l(f.children[m],d,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=g.a.ACTION_NothingTrigger,t.OnPickTrigger=g.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=g.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=g.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=g.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=g.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=g.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=g.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=g.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=g.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=g.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=g.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=g.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=g.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=g.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=g.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(n(79).a),M=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r._sound=n,r}return c.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(s),O=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r._sound=n,r}return c.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(s);a.a.RegisteredTypes["BABYLON.PlaySoundAction"]=O,a.a.RegisteredTypes["BABYLON.StopSoundAction"]=O;var w,I=n(12),D=n(2);!function(e){e[e.STEP=1]="STEP"}(w||(w={}));var L=function(){function e(e,t,n){this.name=e,this.from=t,this.to=n}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}(),k=n(25),N=function(){},F=function(){function e(t,n,i,r,o,a){this.name=t,this.targetProperty=n,this.framePerSecond=i,this.dataType=r,this.loopMode=o,this.enableBlending=a,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=n.split("."),this.dataType=r,this.loopMode=void 0===o?e.ANIMATIONLOOPMODE_CYCLE:o}return e._PrepareAnimation=function(t,n,i,r,a,s,l,c){var u=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?u=e.ANIMATIONTYPE_FLOAT:a instanceof o.q?u=e.ANIMATIONTYPE_QUATERNION:a instanceof o.x?u=e.ANIMATIONTYPE_VECTOR3:a instanceof o.w?u=e.ANIMATIONTYPE_VECTOR2:a instanceof o.e?u=e.ANIMATIONTYPE_COLOR3:a instanceof o.r&&(u=e.ANIMATIONTYPE_SIZE),null==u)return null;var h=new e(t,n,i,u,l);return h.setKeys([{frame:0,value:a},{frame:r,value:s}]),void 0!==c&&h.setEasingFunction(c),h},e.CreateAnimation=function(t,n,i,r){var o=new e(t+"Animation",t,i,n,e.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(r),o},e.CreateAndStartAnimation=function(t,n,i,r,o,a,s,l,c,u){var h=e._PrepareAnimation(t,i,r,o,a,s,l,c);return h?n.getScene().beginDirectAnimation(n,[h],0,o,1===h.loopMode,1,u):null},e.CreateAndStartHierarchyAnimation=function(t,n,i,r,o,a,s,l,c,u,h){var d=e._PrepareAnimation(t,r,o,a,s,l,c,u);return d?n.getScene().beginDirectHierarchyAnimation(n,i,[d],0,a,1===d.loopMode,1,h):null},e.CreateMergeAndStartAnimation=function(t,n,i,r,o,a,s,l,c,u){var h=e._PrepareAnimation(t,i,r,o,a,s,l,c);return h?(n.animations.push(h),n.getScene().beginAnimation(n,0,o,1===h.loopMode,1,u)):null},e.TransitionTo=function(e,t,n,i,r,o,a,s){if(void 0===s&&(s=null),a<=0)return n[e]=t,s&&s(),null;var l=r*(a/1e3);o.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:l,value:t}]),n.animations||(n.animations=[]),n.animations.push(o);var c=i.beginAnimation(n,0,l,!1);return c.onAnimationEnd=s,c},Object.defineProperty(e.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++)if(!t[e].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var i in this._ranges)n&&(t+=", ",n=!1),t+=i;t+="}"}return t},e.prototype.addEvent=function(e){this._events.push(e)},e.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},e.prototype.getEvents=function(){return this._events},e.prototype.createRange=function(e,t,n){this._ranges[e]||(this._ranges[e]=new L(e,t,n))},e.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var n=this._ranges[e];if(n){if(t)for(var i=n.from,r=n.to,o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=i&&this._keys[o].frame<=r&&this._keys.splice(o,1);this._ranges[e]=null}},e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.getKeys=function(){return this._keys},e.prototype.getHighestFrame=function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},e.prototype.getEasingFunction=function(){return this._easingFunction},e.prototype.setEasingFunction=function(e){this._easingFunction=e},e.prototype.floatInterpolateFunction=function(e,t,n){return I.a.Lerp(e,t,n)},e.prototype.floatInterpolateFunctionWithTangents=function(e,t,n,i,r){return I.a.Hermite(e,t,n,i,r)},e.prototype.quaternionInterpolateFunction=function(e,t,n){return o.q.Slerp(e,t,n)},e.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,n,i,r){return o.q.Hermite(e,t,n,i,r).normalize()},e.prototype.vector3InterpolateFunction=function(e,t,n){return o.x.Lerp(e,t,n)},e.prototype.vector3InterpolateFunctionWithTangents=function(e,t,n,i,r){return o.x.Hermite(e,t,n,i,r)},e.prototype.vector2InterpolateFunction=function(e,t,n){return o.w.Lerp(e,t,n)},e.prototype.vector2InterpolateFunctionWithTangents=function(e,t,n,i,r){return o.w.Hermite(e,t,n,i,r)},e.prototype.sizeInterpolateFunction=function(e,t,n){return o.r.Lerp(e,t,n)},e.prototype.color3InterpolateFunction=function(e,t,n){return o.e.Lerp(e,t,n)},e.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},e.prototype._interpolate=function(t,n){if(n.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&n.repeatCount>0)return n.highLimitValue.clone?n.highLimitValue.clone():n.highLimitValue;var i=this._keys;if(1===i.length)return this._getKeyValue(i[0].value);var r=n.key;if(i[r].frame>=t)for(;r-1>=0&&i[r].frame>=t;)r--;for(var o=r;o<i.length;o++){var a=i[o+1];if(a.frame>=t){n.key=o;var s=i[o],l=this._getKeyValue(s.value);if(s.interpolation===w.STEP)return l;var c=this._getKeyValue(a.value),u=void 0!==s.outTangent&&void 0!==a.inTangent,h=a.frame-s.frame,d=(t-s.frame)/h,f=this.getEasingFunction();switch(null!=f&&(d=f.ease(d)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var p=u?this.floatInterpolateFunctionWithTangents(l,s.outTangent*h,c,a.inTangent*h,d):this.floatInterpolateFunction(l,c,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return p;case e.ANIMATIONLOOPMODE_RELATIVE:return n.offsetValue*n.repeatCount+p}break;case e.ANIMATIONTYPE_QUATERNION:var g=u?this.quaternionInterpolateFunctionWithTangents(l,s.outTangent.scale(h),c,a.inTangent.scale(h),d):this.quaternionInterpolateFunction(l,c,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return g;case e.ANIMATIONLOOPMODE_RELATIVE:return g.addInPlace(n.offsetValue.scale(n.repeatCount))}return g;case e.ANIMATIONTYPE_VECTOR3:var m=u?this.vector3InterpolateFunctionWithTangents(l,s.outTangent.scale(h),c,a.inTangent.scale(h),d):this.vector3InterpolateFunction(l,c,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return m;case e.ANIMATIONLOOPMODE_RELATIVE:return m.add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_VECTOR2:var _=u?this.vector2InterpolateFunctionWithTangents(l,s.outTangent.scale(h),c,a.inTangent.scale(h),d):this.vector2InterpolateFunction(l,c,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return _;case e.ANIMATIONLOOPMODE_RELATIVE:return _.add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_SIZE:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(l,c,d);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(l,c,d).add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_COLOR3:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(l,c,d);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(l,c,d).add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_MATRIX:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:if(e.AllowMatricesInterpolation)return this.matrixInterpolateFunction(l,c,d,n.workValue);case e.ANIMATIONLOOPMODE_RELATIVE:return l}}break}}return this._getKeyValue(i[i.length-1].value)},e.prototype.matrixInterpolateFunction=function(t,n,i,r){return e.AllowMatrixDecomposeForInterpolation?r?(o.j.DecomposeLerpToRef(t,n,i,r),r):o.j.DecomposeLerp(t,n,i):r?(o.j.LerpToRef(t,n,i,r),r):o.j.Lerp(t,n,i)},e.prototype.clone=function(){var t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var n in t._ranges={},this._ranges){var i=this._ranges[n];i&&(t._ranges[n]=i.clone())}return t},e.prototype.setKeys=function(e){this._keys=e.slice(0)},e.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var n=this.dataType;t.keys=[];for(var i=this.getKeys(),r=0;r<i.length;r++){var o=i[r],a={};switch(a.frame=o.frame,n){case e.ANIMATIONTYPE_FLOAT:a.values=[o.value];break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:a.values=o.value.asArray()}t.keys.push(a)}for(var s in t.ranges=[],this._ranges){var l=this._ranges[s];if(l){var c={};c.name=s,c.from=l.from,c.to=l.to,t.ranges.push(c)}}return t},Object.defineProperty(e,"ANIMATIONTYPE_FLOAT",{get:function(){return e._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR3",{get:function(){return e._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR2",{get:function(){return e._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_SIZE",{get:function(){return e._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_QUATERNION",{get:function(){return e._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_MATRIX",{get:function(){return e._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_COLOR3",{get:function(){return e._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return e._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return e._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return e._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),e._UniversalLerp=function(e,t,n){var i=e.constructor;return i.Lerp?i.Lerp(e,t,n):i.Slerp?i.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t},e.Parse=function(t){var n,i,r=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,s=[];for(t.enableBlending&&(r.enableBlending=t.enableBlending),t.blendingSpeed&&(r.blendingSpeed=t.blendingSpeed),i=0;i<t.keys.length;i++){var l,c,u=t.keys[i];switch(a){case e.ANIMATIONTYPE_FLOAT:n=u.values[0],u.values.length>=1&&(l=u.values[1]),u.values.length>=2&&(c=u.values[2]);break;case e.ANIMATIONTYPE_QUATERNION:if(n=o.q.FromArray(u.values),u.values.length>=8){var h=o.q.FromArray(u.values.slice(4,8));h.equals(o.q.Zero())||(l=h)}if(u.values.length>=12){var d=o.q.FromArray(u.values.slice(8,12));d.equals(o.q.Zero())||(c=d)}break;case e.ANIMATIONTYPE_MATRIX:n=o.j.FromArray(u.values);break;case e.ANIMATIONTYPE_COLOR3:n=o.e.FromArray(u.values);break;case e.ANIMATIONTYPE_VECTOR3:default:n=o.x.FromArray(u.values)}var f={};f.frame=u.frame,f.value=n,null!=l&&(f.inTangent=l),null!=c&&(f.outTangent=c),s.push(f)}if(r.setKeys(s),t.ranges)for(i=0;i<t.ranges.length;i++)r.createRange((n=t.ranges[i]).name,n.from,n.to);return r},e.AppendSerializedAnimations=function(e,t){D.a.AppendSerializedAnimations(e,t)},e.AllowMatricesInterpolation=!1,e.AllowMatrixDecomposeForInterpolation=!0,e._ANIMATIONTYPE_FLOAT=0,e._ANIMATIONTYPE_VECTOR3=1,e._ANIMATIONTYPE_QUATERNION=2,e._ANIMATIONTYPE_MATRIX=3,e._ANIMATIONTYPE_COLOR3=4,e._ANIMATIONTYPE_VECTOR2=5,e._ANIMATIONTYPE_SIZE=6,e._ANIMATIONLOOPMODE_RELATIVE=0,e._ANIMATIONLOOPMODE_CYCLE=1,e._ANIMATIONLOOPMODE_CONSTANT=2,e}();a.a.RegisteredTypes["BABYLON.Animation"]=F,k.a._AnimationRangeFactory=function(e,t,n){return new L(e,t,n)};var B=function(e){function t(t,n,i,o,a,s,l,c){void 0===a&&(a=1e3);var u=e.call(this,t,s)||this;return u.duration=1e3,u.onInterpolationDoneObservable=new r.c,u.propertyPath=i,u.value=o,u.duration=a,u.stopOtherAnimations=l,u.onInterpolationDone=c,u._target=u._effectiveTarget=n,u}return c.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var e,t=this,n=this._actionManager.getScene(),i=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)e=F.ANIMATIONTYPE_FLOAT;else if(this.value instanceof o.e)e=F.ANIMATIONTYPE_COLOR3;else if(this.value instanceof o.x)e=F.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof o.j)e=F.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof o.q))return void p.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");e=F.ANIMATIONTYPE_QUATERNION}var r=new F("InterpolateValueAction",this._property,1e3/this.duration*100,e,F.ANIMATIONLOOPMODE_CONSTANT);r.setKeys(i),this.stopOtherAnimations&&n.stopAnimation(this._effectiveTarget),n.beginDirectAnimation(this._effectiveTarget,[r],0,100,!1,1,function(){t.onInterpolationDoneObservable.notifyObservers(t),t.onInterpolationDone&&t.onInterpolationDone()})},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)},{name:"duration",value:s._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:s._SerializeValueAsString(this.stopOtherAnimations)||!1}]},t)},t}(s);a.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=B;var U=Object.freeze(new o.q(0,0,0,0)),V=Object.freeze(o.x.Zero()),G=Object.freeze(o.w.Zero()),z=Object.freeze(o.r.Zero()),j=Object.freeze(o.e.Black()),H=function(){function e(e,t,n,i){var r=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=n,this._host=i,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===F.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=o.j.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame&&this._keys.splice(0,0,{frame:0,value:this._minValue}),this._target instanceof Array){for(var a=0,s=0,l=this._target;s<l.length;s++)this._preparePath(l[s],a),this._getOriginalValues(a),a++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var c=t.getEvents();c&&c.length>0&&c.forEach(function(e){r._events.push(e._clone())}),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!0,configurable:!0}),e.prototype._preparePath=function(e,t){void 0===t&&(t=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var i=e[n[0]],r=1;r<n.length-1;r++)i=i[n[r]];this._targetPath=n[n.length-1],this._activeTargets[t]=i}else this._targetPath=n[0],this._activeTargets[t]=e},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){if(void 0===e&&(e=!1),e)if(this._target instanceof Array)for(var t=0,n=0,i=this._target;n<i.length;n++)void 0!==this._originalValue[t]&&this._setValue(i[n],this._activeTargets[t],this._originalValue[t],-1,t),t++;else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,t=0;t<this._events.length;t++)this._events[t].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},e.prototype.setValue=function(e,t){if(this._targetIsArray)for(var n=0;n<this._target.length;n++)this._setValue(this._target[n],this._activeTargets[n],e,t,n);else this._setValue(this._target,this._directTarget,e,t,0)},e.prototype._getOriginalValues=function(e){var t;void 0===e&&(e=0);var n=this._activeTargets[e];this._originalValue[e]=(t=n.getRestPose&&"_matrix"===this._targetPath?n.getRestPose():n[this._targetPath])&&t.clone?t.clone():t},e.prototype._setValue=function(e,t,n,i,r){if(this._currentActiveTarget=t,this._weight=i,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var a=t[this._targetPath];this._originalBlendValue=a.clone?a.clone():a}this._originalBlendValue.m?F.AllowMatrixDecomposeForInterpolation?this._currentValue?o.j.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=o.j.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?o.j.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=o.j.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=F._UniversalLerp(this._originalBlendValue,n,this._blendingFactor),this._blendingFactor+=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed}else this._currentValue=n;-1!==i?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[r]):t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[0].frame?e=t[0].frame:e>t[t.length-1].frame&&(e=t[t.length-1].frame),this._currentFrame=e;var n=this._animation._interpolate(e,this._animationState);this.setValue(n,-1)},e.prototype._prepareForSpeedRatioChange=function(e){this._ratioOffset=this._previousRatio-this._previousDelay*(this._animation.framePerSecond*e)/1e3},e.prototype.animate=function(e,t,n,i,r,o){void 0===o&&(o=-1);var a=this._animation,s=a.targetPropertyPath;if(!s||s.length<1)return this._stopped=!0,!1;var l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var c,u,h=n-t,d=e*(a.framePerSecond*r)/1e3+this._ratioOffset,f=0;if(this._previousDelay=e,this._previousRatio=d,!i&&n>=t&&d>=h)l=!1,f=a._getKeyValue(this._maxValue);else if(!i&&t>=n&&d<=h)l=!1,f=a._getKeyValue(this._minValue);else if(this._animationState.loopMode!==F.ANIMATIONLOOPMODE_CYCLE){var p=n.toString()+t.toString();if(!this._offsetsCache[p]){this._animationState.repeatCount=0,this._animationState.loopMode=F.ANIMATIONLOOPMODE_CYCLE;var g=a._interpolate(t,this._animationState),m=a._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),a.dataType){case F.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=m-g;break;case F.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=m.subtract(g);break;case F.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=m.subtract(g);case F.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=m.subtract(g);case F.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=m.subtract(g);case F.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=m.subtract(g)}this._highLimitsCache[p]=m}f=this._highLimitsCache[p],c=this._offsetsCache[p]}if(void 0===c)switch(a.dataType){case F.ANIMATIONTYPE_FLOAT:c=0;break;case F.ANIMATIONTYPE_QUATERNION:c=U;break;case F.ANIMATIONTYPE_VECTOR3:c=V;break;case F.ANIMATIONTYPE_VECTOR2:c=G;break;case F.ANIMATIONTYPE_SIZE:c=z;break;case F.ANIMATIONTYPE_COLOR3:c=j}if(this._host&&this._host.syncRoot){var _=this._host.syncRoot;u=t+(_.masterFrame-_.fromFrame)/(_.toFrame-_.fromFrame)*(n-t)}else u=l&&0!==h?t+d%h:n;var v=this._events;if((h>0&&this.currentFrame>u||h<0&&this.currentFrame<u)&&(this._onLoop(),v.length))for(var b=0;b<v.length;b++)v[b].onlyOnce||(v[b].isDone=!1);this._currentFrame=u,this._animationState.repeatCount=0===h?0:d/h>>0,this._animationState.highLimitValue=f,this._animationState.offsetValue=c;var y=a._interpolate(u,this._animationState);if(this.setValue(y,o),v.length)for(b=0;b<v.length;b++)if(h>0&&u>=v[b].frame&&v[b].frame>=t||h<0&&u<=v[b].frame&&v[b].frame<=t){var T=v[b];T.isDone||(T.onlyOnce&&(v.splice(b,1),b--),T.isDone=!0,T.action(u))}return l||(this._stopped=!0),l},e}(),W=n(16),X=n(47),Y=n(34),K=function(e){function t(t,n,i,r,a,s,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null);var c=e.call(this,t,n.getScene(),!1)||this;return c.name=t,c.children=new Array,c.animations=new Array,c._index=null,c._absoluteTransform=new o.j,c._invertedAbsoluteTransform=new o.j,c._scalingDeterminant=1,c._worldTransform=new o.j,c._needToDecompose=!0,c._needToCompose=!1,c._linkedTransformNode=null,c._waitingTransformNodeId=null,c._skeleton=n,c._localMatrix=r?r.clone():o.j.Identity(),c._restPose=a||c._localMatrix.clone(),c._baseMatrix=s||c._localMatrix.clone(),c._index=l,n.bones.push(c),c.setParent(i,!1),(s||r)&&c._updateDifferenceMatrix(),c}return c.d(t,e),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.setParent=function(e,t){if(void 0===t&&(t=!0),this._parent!==e){if(this._parent){var n=this._parent.children.indexOf(this);-1!==n&&this._parent.children.splice(n,1)}this._parent=e,this._parent&&this._parent.children.push(this),t&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.x.Zero(),this._localRotation=o.q.Zero(),this._localPosition=o.x.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,o.j.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},t.prototype.updateMatrix=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0),this._baseMatrix.copyFrom(e),t&&this._updateDifferenceMatrix(),n?(this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(e,t){if(void 0===t&&(t=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),t)for(var n=0;n<this.children.length;n++)this.children[n]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(e,n,i){void 0===n&&(n=o.s.LOCAL);var r=this.getLocalMatrix();if(n==o.s.LOCAL)r.addAtIndex(12,e.x),r.addAtIndex(13,e.y),r.addAtIndex(14,e.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0],l=t._tmpVecs[0];this._parent&&(i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.setTranslationFromFloats(0,0,0),s.invert(),o.x.TransformCoordinatesToRef(e,s,l),r.addAtIndex(12,l.x),r.addAtIndex(13,l.y),r.addAtIndex(14,l.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(e,n,i){void 0===n&&(n=o.s.LOCAL);var r=this.getLocalMatrix();if(n==o.s.LOCAL)r.setTranslationFromFloats(e.x,e.y,e.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0],l=t._tmpVecs[0];this._parent&&(i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.invert(),o.x.TransformCoordinatesToRef(e,s,l),r.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(e,t){this.setPosition(e,o.s.WORLD,t)},t.prototype.scale=function(e,n,i,r){void 0===r&&(r=!1);var a=this.getLocalMatrix(),s=t._tmpMats[0];o.j.ScalingToRef(e,n,i,s),s.multiplyToRef(a,a),s.invert();for(var l=0,c=this.children;l<c.length;l++){var u=(f=c[l]).getLocalMatrix();u.multiplyToRef(s,u),u.multiplyAtIndex(12,e),u.multiplyAtIndex(13,n),u.multiplyAtIndex(14,i),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var h=0,d=this.children;h<d.length;h++){var f;(f=d[h]).scale(e,n,i,r)}},t.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(e,n,i,r,a){if(void 0===r&&(r=o.s.LOCAL),r===o.s.LOCAL){var s=t._tmpQuat;return o.q.RotationYawPitchRollToRef(e,n,i,s),void this.setRotationQuaternion(s,r,a)}var l=t._tmpMats[0];if(this._getNegativeRotationToRef(l,a)){var c=t._tmpMats[1];o.j.RotationYawPitchRollToRef(e,n,i,c),l.multiplyToRef(c,c),this._rotateWithMatrix(c,r,a)}},t.prototype.rotate=function(e,n,i,r){void 0===i&&(i=o.s.LOCAL);var a=t._tmpMats[0];a.setTranslationFromFloats(0,0,0),o.j.RotationAxisToRef(e,n,a),this._rotateWithMatrix(a,i,r)},t.prototype.setAxisAngle=function(e,n,i,r){if(void 0===i&&(i=o.s.LOCAL),i===o.s.LOCAL){var a=t._tmpQuat;return o.q.RotationAxisToRef(e,n,a),void this.setRotationQuaternion(a,i,r)}var s=t._tmpMats[0];if(this._getNegativeRotationToRef(s,r)){var l=t._tmpMats[1];o.j.RotationAxisToRef(e,n,l),s.multiplyToRef(l,l),this._rotateWithMatrix(l,i,r)}},t.prototype.setRotation=function(e,t,n){void 0===t&&(t=o.s.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,t,n)},t.prototype.setRotationQuaternion=function(e,n,i){if(void 0===n&&(n=o.s.LOCAL),n===o.s.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var r=t._tmpMats[0];if(this._getNegativeRotationToRef(r,i)){var a=t._tmpMats[1];o.j.FromQuaternionToRef(e,a),r.multiplyToRef(a,a),this._rotateWithMatrix(a,n,i)}},t.prototype.setRotationMatrix=function(e,n,i){if(void 0===n&&(n=o.s.LOCAL),n===o.s.LOCAL){var r=t._tmpQuat;return o.q.FromRotationMatrixToRef(e,r),void this.setRotationQuaternion(r,n,i)}var a=t._tmpMats[0];if(this._getNegativeRotationToRef(a,i)){var s=t._tmpMats[1];s.copyFrom(e),a.multiplyToRef(e,s),this._rotateWithMatrix(s,n,i)}},t.prototype._rotateWithMatrix=function(e,n,i){void 0===n&&(n=o.s.LOCAL);var r=this.getLocalMatrix(),a=r.m[12],s=r.m[13],l=r.m[14],c=this.getParent(),u=t._tmpMats[3],h=t._tmpMats[4];c&&n==o.s.WORLD?(i?(u.copyFrom(i.getWorldMatrix()),c.getAbsoluteTransform().multiplyToRef(u,u)):u.copyFrom(c.getAbsoluteTransform()),h.copyFrom(u),h.invert(),r.multiplyToRef(u,r),r.multiplyToRef(e,r),r.multiplyToRef(h,r)):n==o.s.WORLD&&i?(u.copyFrom(i.getWorldMatrix()),h.copyFrom(u),h.invert(),r.multiplyToRef(u,r),r.multiplyToRef(e,r),r.multiplyToRef(h,r)):r.multiplyToRef(e,r),r.setTranslationFromFloats(a,s,l),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(e,n){var i=t._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),n&&(e.multiplyToRef(n.getWorldMatrix(),e),o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,i)),e.invert(),!isNaN(e.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(i,e),!0)},t.prototype.getPosition=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.x.Zero();return this.getPositionToRef(e,t,n),n},t.prototype.getPositionToRef=function(e,n,i){if(void 0===e&&(e=o.s.LOCAL),e==o.s.LOCAL){var r=this.getLocalMatrix();i.x=r.m[12],i.y=r.m[13],i.z=r.m[14]}else{var a=null;n&&(a=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0];n&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}},t.prototype.getAbsolutePosition=function(e){void 0===e&&(e=null);var t=o.x.Zero();return this.getPositionToRef(o.s.WORLD,e,t),t},t.prototype.getAbsolutePositionToRef=function(e,t){this.getPositionToRef(o.s.WORLD,e,t)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var t=this.children,n=t.length,i=0;i<n;i++)t[i].computeAbsoluteTransforms()},t.prototype.getDirection=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getDirectionToRef(e,t,n),n},t.prototype.getDirectionToRef=function(e,n,i){void 0===n&&(n=null);var r=null;n&&(r=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),n&&r&&a.multiplyToRef(r,a),o.x.TransformNormalToRef(e,a,i),i.normalize()},t.prototype.getRotation=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.x.Zero();return this.getRotationToRef(e,t,n),n},t.prototype.getRotationToRef=function(e,n,i){void 0===e&&(e=o.s.LOCAL),void 0===n&&(n=null);var r=t._tmpQuat;this.getRotationQuaternionToRef(e,n,r),r.toEulerAnglesToRef(i)},t.prototype.getRotationQuaternion=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.q.Identity();return this.getRotationQuaternionToRef(e,t,n),n},t.prototype.getRotationQuaternionToRef=function(e,n,i){if(void 0===e&&(e=o.s.LOCAL),void 0===n&&(n=null),e==o.s.LOCAL)this._decompose(),i.copyFrom(this._localRotation);else{var r=t._tmpMats[0],a=this.getAbsoluteTransform();n?a.multiplyToRef(n.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,i,void 0)}},t.prototype.getRotationMatrix=function(e,t){void 0===e&&(e=o.s.LOCAL);var n=o.j.Identity();return this.getRotationMatrixToRef(e,t,n),n},t.prototype.getRotationMatrixToRef=function(e,n,i){if(void 0===e&&(e=o.s.LOCAL),e==o.s.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(i);else{var r=t._tmpMats[0],a=this.getAbsoluteTransform();n?a.multiplyToRef(n.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(i)}},t.prototype.getAbsolutePositionFromLocal=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,n),n},t.prototype.getAbsolutePositionFromLocalToRef=function(e,n,i){void 0===n&&(n=null);var r=null;n&&(r=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];n&&r?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(r,a)):a=this.getAbsoluteTransform(),o.x.TransformCoordinatesToRef(e,a,i)},t.prototype.getLocalPositionFromAbsolute=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,n),n},t.prototype.getLocalPositionFromAbsoluteToRef=function(e,n,i){void 0===n&&(n=null);var r=null;n&&(r=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),n&&r&&a.multiplyToRef(r,a),a.invert(),o.x.TransformCoordinatesToRef(e,a,i)},t._tmpVecs=Y.a.BuildArray(2,o.x.Zero),t._tmpQuat=o.q.Identity(),t._tmpMats=Y.a.BuildArray(5,o.j.Identity),t}(k.a),Q=function(){function e(e,t,n,i,o,a,s,l,c){void 0===n&&(n=0),void 0===i&&(i=100),void 0===o&&(o=!1),void 0===a&&(a=1),this.target=t,this.fromFrame=n,this.toFrame=i,this.loopAnimation=o,this.onAnimationEnd=s,this.onAnimationLoop=c,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new r.c,this.onAnimationLoopObservable=new r.c,this._scene=e,l&&this.appendAnimations(t,l),this._speedRatio=a,e._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var t=0;t<this._runtimeAnimations.length;t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e);this._speedRatio=e},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(e){if(this._syncRoot=e,e){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(e,t){for(var n=this,i=0;i<t.length;i++){var r=new H(e,t[i],this._scene,this);r._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(r)}},e.prototype.getAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n];return null},e.prototype.reset=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)t[n].animation.enableBlending=!0,t[n].animation.blendingSpeed=e},e.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].animation.enableBlending=!1},e.prototype.goToFrame=function(e){var t=this._runtimeAnimations;if(t[0]){var n=0!==this.speedRatio?1e3*(e-t[0].currentFrame)/(t[0].animation.framePerSecond*this.speedRatio):0;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=n}for(var i=0;i<t.length;i++)t[i].goToFrame(e)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(e,t){if(e||t){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var i=(o=this._runtimeAnimations).length-1;i>=0;i--){var r=o[i];e&&r.animation.name!=e||t&&!t(r.target)||(r.dispose(),o.splice(i,1))}0==o.length&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else if((i=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(i,1);var o=this._runtimeAnimations;for(i=0;i<o.length;i++)o[i].dispose();this._raiseOnAnimationEnd()}},e.prototype.waitAsync=function(){var e=this;return new Promise(function(t,n){e.onAnimationEndObservable.add(function(){t(e)},void 0,void 0,e,!0)})},e.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var t,n=!1,i=this._runtimeAnimations;for(t=0;t<i.length;t++){var r=i[t].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||r}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<i.length;t++)i[t].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},e}();W.a.prototype._animate=function(){if(this.animationsEnabled){var e=this._activeAnimatables;if(0!==e.length){var t=X.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}this._animationTime+=this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale;var n=this._animationTime;this._animationTimeLast=t;for(var i=0;i<e.length;i++)e[i]._animate(n);this._processLateAnimationBindings()}}},W.a.prototype.beginWeightedAnimation=function(e,t,n,i,r,o,a,s,l,c){void 0===i&&(i=1),void 0===o&&(o=1);var u=this.beginAnimation(e,t,n,r,o,a,s,!1,l,c);return u.weight=i,u},W.a.prototype.beginAnimation=function(e,t,n,i,r,o,a,s,l,c){void 0===r&&(r=1),void 0===s&&(s=!0),t>n&&r>0&&(r*=-1),s&&this.stopAnimation(e,void 0,l),a||(a=new Q(this,e,t,n,i,r,o,void 0,c));var u=!l||l(e);if(e.animations&&u&&a.appendAnimations(e,e.animations),e.getAnimatables)for(var h=e.getAnimatables(),d=0;d<h.length;d++)this.beginAnimation(h[d],t,n,i,r,o,a,s,l,c);return a.reset(),a},W.a.prototype.beginHierarchyAnimation=function(e,t,n,i,r,o,a,s,l,c,u){void 0===o&&(o=1),void 0===l&&(l=!0);var h=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,n,i,r,o,a,s,l,c));for(var f=0,p=h;f<p.length;f++)d.push(this.beginAnimation(p[f],n,i,r,o,a,s,l,c));return d},W.a.prototype.beginDirectAnimation=function(e,t,n,i,r,o,a,s){return void 0===o&&(o=1),new Q(this,e,n,i,r,o,a,t,s)},W.a.prototype.beginDirectHierarchyAnimation=function(e,t,n,i,r,o,a,s,l){var c=e.getDescendants(t),u=[];u.push(this.beginDirectAnimation(e,n,i,r,o,a,s,l));for(var h=0,d=c;h<d.length;h++)u.push(this.beginDirectAnimation(d[h],n,i,r,o,a,s,l));return u},W.a.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},W.a.prototype.getAllAnimatablesByTarget=function(e){for(var t=[],n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n].target===e&&t.push(this._activeAnimatables[n]);return t},W.a.prototype.stopAnimation=function(e,t,n){for(var i=0,r=this.getAllAnimatablesByTarget(e);i<r.length;i++)r[i].stop(t,n)},W.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var t=0,n=this.animationGroups;t<n.length;t++)n[t].stop()},W.a.prototype._registerTargetForLateAnimationBinding=function(e,t){var n=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(n),n._lateAnimationHolders||(n._lateAnimationHolders={}),n._lateAnimationHolders[e.targetPath]||(n._lateAnimationHolders[e.targetPath]={totalWeight:0,animations:[],originalValue:t}),n._lateAnimationHolders[e.targetPath].animations.push(e),n._lateAnimationHolders[e.targetPath].totalWeight+=e.weight},W.a.prototype._processLateAnimationBindingsForMatrices=function(e){var t=1,n=o.t.Vector3[0],i=o.t.Vector3[1],r=o.t.Quaternion[0],a=0,s=e.animations[0],l=1;if(e.totalWeight<1)e.originalValue.decompose(i,r,n),l=1-e.totalWeight;else if(a=1,t=e.totalWeight,s.currentValue.decompose(i,r,n),1==(l=s.weight/t))return s.currentValue;i.scaleInPlace(l),n.scaleInPlace(l),r.scaleInPlace(l);for(var c=a;c<e.animations.length;c++){var u=e.animations[c],h=(l=u.weight/t,o.t.Vector3[2]),d=o.t.Vector3[3],f=o.t.Quaternion[1];u.currentValue.decompose(d,f,h),d.scaleAndAddToRef(l,i),f.scaleAndAddToRef(l,r),h.scaleAndAddToRef(l,n)}var p=s._animationState.workValue;return o.j.ComposeToRef(i,r,n,p),p},W.a.prototype._processLateAnimationBindingsForQuaternions=function(e,t){var n=e.originalValue;if(1===e.animations.length)return o.q.SlerpToRef(n,e.animations[0].currentValue,Math.min(1,e.totalWeight),t),t;var i,r,a=1;if(e.totalWeight<1){var s=1-e.totalWeight;r=[],(i=[]).push(n),r.push(s)}else{if(2===e.animations.length)return o.q.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),t;i=[],r=[],a=e.totalWeight}for(var l=0;l<e.animations.length;l++){var c=e.animations[l];i.push(c.currentValue),r.push(c.weight/a)}for(var u=0,h=null,d=0;d<i.length;)h?(o.q.SlerpToRef(h,i[d],r[d]/(u+=r[d]),h),d++):(o.q.SlerpToRef(i[d],i[d+1],r[d+1]/(r[d]+r[d+1]),t),h=t,u=r[d]+r[d+1],d+=2);return h},W.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var t=this._registeredForLateAnimationBindings.data[e];for(var n in t._lateAnimationHolders){var i=t._lateAnimationHolders[n],r=i.animations[0],a=i.originalValue,s=t[n];if(F.AllowMatrixDecomposeForInterpolation&&a.m)s=this._processLateAnimationBindingsForMatrices(i);else if(void 0!==a.w)s=this._processLateAnimationBindingsForQuaternions(i,s||o.q.Identity());else{var l=0,c=1;if(i.totalWeight<1)s=a.scale?a.scale(1-i.totalWeight):a*(1-i.totalWeight);else{var u=r.weight/(c=i.totalWeight);s=1!==u?r.currentValue.scale?r.currentValue.scale(u):r.currentValue*u:r.currentValue,l=1}for(var h=l;h<i.animations.length;h++){var d=i.animations[h],f=d.weight/c;d.currentValue.scaleAndAddToRef?d.currentValue.scaleAndAddToRef(f,s):s+=d.currentValue*f}}t[n]=s}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},K.prototype.copyAnimationRange=function(e,t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null),0===this.animations.length&&(this.animations.push(new F(this.name,"_matrix",e.animations[0].framePerSecond,F.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=e.animations[0].getRange(t);if(!o)return!1;for(var a,s,l,c=o.from,u=o.to,h=e.animations[0].getKeys(),d=e.length,f=e.getParent(),p=this.getParent(),g=i&&f&&d&&this.length&&d!==this.length,m=g&&p&&f?p.length/f.length:1,_=i&&!p&&r&&(1!==r.x||1!==r.y||1!==r.z),v=this.animations[0].getKeys(),b=0,y=h.length;b<y;b++)(a=h[b]).frame>=c&&a.frame<=u&&(i?(l=a.value.clone(),g?(s=l.getTranslation(),l.setTranslation(s.scaleInPlace(m))):_&&r?(s=l.getTranslation(),l.setTranslation(s.multiplyInPlace(r))):l=a.value):l=a.value,v.push({frame:a.frame+n,value:l}));return this.animations[0].createRange(t,c+n,u+n),!0};var q=function(){},Z=function(){function e(e,t){void 0===t&&(t=null),this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this.onAnimationEndObservable=new r.c,this.onAnimationLoopObservable=new r.c,this.onAnimationGroupEndObservable=new r.c,this.onAnimationGroupPauseObservable=new r.c,this.onAnimationGroupPlayObservable=new r.c,this._scene=t||A.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){if(this._speedRatio!==e){this._speedRatio=e;for(var t=0;t<this._animatables.length;t++)this._animatables[t].speedRatio=this._speedRatio}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(var t=0;t<this._animatables.length;t++)this._animatables[t].loopAnimation=this._loopAnimation}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),e.prototype.addTargetedAnimation=function(e,t){var n={animation:e,target:t},i=e.getKeys();return this._from>i[0].frame&&(this._from=i[0].frame),this._to<i[i.length-1].frame&&(this._to=i[i.length-1].frame),this._targetedAnimations.push(n),n},e.prototype.normalize=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),null==e&&(e=this._from),null==t&&(t=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var i=this._targetedAnimations[n].animation.getKeys(),r=i[0],o=i[i.length-1];if(r.frame>e){var a={frame:e,value:r.value,inTangent:r.inTangent,outTangent:r.outTangent,interpolation:r.interpolation};i.splice(0,0,a)}o.frame<t&&i.push(a={frame:t,value:o.value,inTangent:o.outTangent,outTangent:o.outTangent,interpolation:o.interpolation})}return this._from=e,this._to=t,this},e.prototype.start=function(e,t,n,i){var r=this;if(void 0===e&&(e=!1),void 0===t&&(t=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e;for(var o=function(o){var s=a._scene.beginDirectAnimation(o.target,[o.animation],void 0!==n?n:a._from,void 0!==i?i:a._to,e,t);s.onAnimationEnd=function(){r.onAnimationEndObservable.notifyObservers(o),r._checkAnimationGroupEnded(s)},s.onAnimationLoop=function(){r.onAnimationLoopObservable.notifyObservers(o)},a._animatables.push(s)},a=this,s=0,l=this._targetedAnimations;s<l.length;s++)o(l[s]);if(this._speedRatio=t,void 0!==n&&void 0!==i)if(n<i&&this._speedRatio<0){var c=i;i=n,n=c}else n>i&&this._speedRatio>0&&(this._speedRatio=-t);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var e=0;e<this._animatables.length;e++)this._animatables[e].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(e){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].reset();return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var e=this._animatables.slice(),t=0;t<e.length;t++)e[t].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(e){for(var t=0;t<this._animatables.length;t++)this._animatables[t].weight=e;return this},e.prototype.syncAllAnimationsWith=function(e){for(var t=0;t<this._animatables.length;t++)this._animatables[t].syncWith(e);return this},e.prototype.goToFrame=function(e){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].goToFrame(e);return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var e=this._scene.animationGroups.indexOf(this);e>-1&&this._scene.animationGroups.splice(e,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(e){var t=this._animatables.indexOf(e);t>-1&&this._animatables.splice(t,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(t,n){for(var i=new e(t||this.name,this._scene),r=0,o=this._targetedAnimations;r<o.length;r++){var a=o[r];i.addTargetedAnimation(a.animation.clone(),n?n(a.target):a.target)}return i},e.Parse=function(t,n){for(var i=new e(t.name,n),r=0;r<t.targetedAnimations.length;r++){var o=t.targetedAnimations[r],a=F.Parse(o.animation),s=o.targetId;if("influence"===o.animation.property){var l=n.getMorphTargetById(s);l&&i.addTargetedAnimation(a,l)}else{var c=n.getNodeByID(s);null!=c&&i.addTargetedAnimation(a,c)}}return null!==t.from&&null!==t.from&&i.normalize(t.from,t.to),i},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(e){var t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t},e}(),J=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=F.ANIMATIONLOOPMODE_CYCLE},$=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}(),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}($),te=function(e){function t(t){void 0===t&&(t=1);var n=e.call(this)||this;return n.amplitude=t,n}return c.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}($),ne=function(e){function t(t,n){void 0===t&&(t=3),void 0===n&&(n=2);var i=e.call(this)||this;return i.bounces=t,i.bounciness=n,i}return c.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),n=this.bounciness;n<=1&&(n=1.001);var i=Math.pow(n,t),r=1-n,o=(1-i)/r+.5*i,a=Math.log(-e*o*(1-n)+1)/Math.log(n),s=Math.floor(a),l=s+1,c=(1-Math.pow(n,s))/(r*o),u=.5*(c+(1-Math.pow(n,l))/(r*o)),h=e-u,d=u-c;return-Math.pow(1/n,t-s)/(d*d)*(h-d)*(h+d)},t}($),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}($),re=function(e){function t(t,n){void 0===t&&(t=3),void 0===n&&(n=3);var i=e.call(this)||this;return i.oscillations=t,i.springiness=n,i}return c.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return(0==n?e:(Math.exp(n*e)-1)/(Math.exp(n)-1))*Math.sin((6.283185307179586*t+1.5707963267948966)*e)},t}($),oe=function(e){function t(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.exponent=t,n}return c.d(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}($),ae=function(e){function t(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.power=t,n}return c.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}($),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return e*e},t}($),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}($),ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}($),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}($),he=function(e){function t(t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1);var o=e.call(this)||this;return o.x1=t,o.y1=n,o.x2=i,o.y2=r,o}return c.d(t,e),t.prototype.easeInCore=function(e){return o.d.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t}($),de=function(){function e(e,t,n){this.frame=e,this.action=t,this.onlyOnce=n,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}(),fe=n(11),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t}(i.a),ge=function(e){function t(t){var n=e.call(this)||this;return n.scene=t,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],n}return c.d(t,e),t.prototype.addAllToScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.addCamera(t)}),this.lights.forEach(function(t){e.scene.addLight(t)}),this.meshes.forEach(function(t){e.scene.addMesh(t)}),this.skeletons.forEach(function(t){e.scene.addSkeleton(t)}),this.animations.forEach(function(t){e.scene.addAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.addAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.addMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.addMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.addMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.addGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.addTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.addActionManager(t)}),this.textures.forEach(function(t){e.scene.addTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.addReflectionProbe(t)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var t=0,n=this.scene._serializableComponents;t<n.length;t++)n[t].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.removeCamera(t)}),this.lights.forEach(function(t){e.scene.removeLight(t)}),this.meshes.forEach(function(t){e.scene.removeMesh(t)}),this.skeletons.forEach(function(t){e.scene.removeSkeleton(t)}),this.animations.forEach(function(t){e.scene.removeAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.removeAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.removeMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.removeMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.removeMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.removeGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.removeTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.removeActionManager(t)}),this.textures.forEach(function(t){e.scene.removeTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.removeReflectionProbe(t)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var t=0,n=this.scene._serializableComponents;t<n.length;t++)n[t].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach(function(e){e.dispose()}),this.cameras=[],this.lights.forEach(function(e){e.dispose()}),this.lights=[],this.meshes.forEach(function(e){e.dispose()}),this.meshes=[],this.skeletons.forEach(function(e){e.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(e){e.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(e){e.dispose()}),this.multiMaterials=[],this.materials.forEach(function(e){e.dispose()}),this.materials=[],this.geometries.forEach(function(e){e.dispose()}),this.geometries=[],this.transformNodes.forEach(function(e){e.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(e){e.dispose()}),this.actionManagers=[],this.textures.forEach(function(e){e.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(e){e.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,t=this.scene._serializableComponents;e<t.length;e++)t[e].removeFromContainer(this,!0)},t.prototype._moveAssets=function(e,t,n){if(e)for(var i=0,r=e;i<r.length;i++){var o=r[i],a=!0;if(n)for(var s=0,l=n;s<l.length;s++)if(o===l[s]){a=!1;break}a&&t.push(o)}},t.prototype.moveAllFromScene=function(e){for(var t in void 0===e&&(e=new pe),this)this.hasOwnProperty(t)&&(this[t]=this[t]||[],this._moveAssets(this.scene[t],this[t],e[t]));this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new fe.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(t){t.parent||e.addChild(t)}),this.meshes.unshift(e),e},t}(i.a),me=n(10),_e=function(){function e(e){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=e,this._audioEngine=me.b.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return e.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},e.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},e.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},e.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},e.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var n=0;n<this.getFrequencyBinCount();n++){var i=this.DEBUGCANVASSIZE.height*(t[n]/this.BARGRAPHAMPLITUDE),r=this.DEBUGCANVASSIZE.height-i-1,o=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),a=n/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+a+", 100%, 50%)",this._debugCanvasContext.fillRect(n*o,r,o,i)}}},e.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},e.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},e.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},e}();me.b.AudioEngineFactory=function(e){return new ve(e)};var ve=function(){function e(e){var t=this;void 0===e&&(e=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new r.c,this.onAudioLockedObservable=new r.c,this._tryToRun=!1,this._onResize=function(){t._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var n=document.createElement("audio");this._hostElement=e;try{n&&n.canPlayType&&n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(e){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}return Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._triggerSuspendedState()},e.prototype.unlock=function(){this._triggerRunningState()},e.prototype._resumeAudioContext=function(){var e;return this._audioContext.resume&&(e=this._audioContext.resume()),e||Promise.resolve()},e.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,p.a.Error("Web Audio: "+e.message)}},e.prototype._triggerRunningState=function(){var e=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){e._tryToRun=!1,e._muteButton&&e._hideMuteButton()}).catch(function(){e._tryToRun=!1,e.unlocked=!1}),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},e.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},e.prototype._displayMuteButton=function(){var e=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var t=document.createElement("style");t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){e._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){e._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},e.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},e.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},e.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},e.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},e.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},e.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},e}(),be=n(9),ye=n(19),Te=function(){function e(t,n,i,a,s){var l=this;if(void 0===a&&(a=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new r.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=o.x.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new o.x(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=i,e._SceneComponentInitialization(i),this._readyToPlayCallback=a,this._customAttenuationFunction=function(e,t,n,i,r){return t<n?e*(1-t/n):0},s&&(this.autoplay=s.autoplay||!1,this.loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this.spatialSound=s.spatialSound||!1,this.maxDistance=s.maxDistance||100,this.useCustomAttenuation=s.useCustomAttenuation||!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming||!1),me.b.audioEngine.canUseWebAudio&&me.b.audioEngine.audioContext){this._soundGain=me.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var c=!0;if(n)try{"string"==typeof n?this._urlType="String":n instanceof ArrayBuffer?this._urlType="ArrayBuffer":n instanceof MediaStream?this._urlType="MediaStream":Array.isArray(n)&&(this._urlType="Array");var u=[],h=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=me.b.audioEngine.audioContext.createMediaStreamSource(n),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":n.byteLength>0&&(h=!0,this._soundLoaded(n));break;case"String":u.push(n);case"Array":0===u.length&&(u=n);for(var d=0;d<u.length;d++){var f=u[d];if(-1!==f.indexOf(".mp3",f.length-4)&&me.b.audioEngine.isMP3supported&&(h=!0),-1!==f.indexOf(".ogg",f.length-4)&&me.b.audioEngine.isOGGsupported&&(h=!0),-1!==f.indexOf(".wav",f.length-4)&&(h=!0),-1!==f.indexOf("blob:")&&(h=!0),h){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,be.h.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){l._isReadyToPlay=!0,l.autoplay&&l.play(),l._readyToPlayCallback&&l._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,function(e){l._soundLoaded(e)},void 0,!0,!0,function(e){e&&p.a.Error("XHR "+e.status+" error on: "+f+"."),p.a.Error("Sound creation aborted."),l._scene.mainSoundTrack.RemoveSound(l)});break}}break;default:c=!1}c?h||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback&&l._readyToPlayCallback()},1e3)):p.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){p.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),me.b.audioEngine.WarnedWebAudioUnsupported||(p.a.Error("Web Audio is not supported by your browser."),me.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback&&l._readyToPlayCallback()},1e3)}return e.prototype.dispose=function(){me.b.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},e.prototype.isReady=function(){return this._isReadyToPlay},e.prototype._soundLoaded=function(e){var t=this;me.b.audioEngine.audioContext&&me.b.audioEngine.audioContext.decodeAudioData(e,function(e){t._audioBuffer=e,t._isReadyToPlay=!0,t.autoplay&&t.play(),t._readyToPlayCallback&&t._readyToPlayCallback()},function(e){p.a.Error("Error while decoding audio data for: "+t.name+" / Error: "+e)})},e.prototype.setAudioBuffer=function(e){me.b.audioEngine.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},e.prototype._createSpatialParameters=function(){me.b.audioEngine.canUseWebAudio&&me.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=me.b.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},e.prototype._switchPanningModel=function(){me.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(e){me.b.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(e,t,n){t<e?p.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,me.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,me.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(e){this._position=e,me.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(e){this._localDirection=e,me.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},e.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var e=this._connectedTransformNode.getWorldMatrix(),t=o.x.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.setOrientation(t.x,t.y,t.z)}},e.prototype.updateDistanceFromListener=function(){if(me.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var e=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},e.prototype.play=function(e,t){var n=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&me.b.audioEngine.audioContext)try{this._startOffset<0&&(e=-this._startOffset,this._startOffset=0);var i=e?me.b.audioEngine.audioContext.currentTime+e:me.b.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=me.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){n._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(r=function(){if(me.b.audioEngine.unlocked){var e=n._htmlAudioElement.play();void 0!==e&&e.catch(function(e){me.b.audioEngine.lock(),(n.loop||n.autoplay)&&me.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){r()})})}else(n.loop||n.autoplay)&&me.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){r()})})();else{var r=function(){me.b.audioEngine.audioContext&&(n._soundSource=me.b.audioEngine.audioContext.createBufferSource(),n._soundSource.buffer=n._audioBuffer,n._soundSource.connect(n._inputAudioNode),n._soundSource.loop=n.loop,n._soundSource.playbackRate.value=n._playbackRate,n._soundSource.onended=function(){n._onended()},n._soundSource.start(i=e?me.b.audioEngine.audioContext.currentTime+e:me.b.audioEngine.audioContext.currentTime,n.isPaused?n._startOffset%n._soundSource.buffer.duration:t||0))};"suspended"===me.b.audioEngine.audioContext.state?setTimeout(function(){"suspended"===me.b.audioEngine.audioContext.state?(me.b.audioEngine.lock(),(n.loop||n.autoplay)&&me.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){r()})):r()},500):r()}this._startTime=i,this.isPlaying=!0,this.isPaused=!1}catch(e){p.a.Error("Error while trying to play audio: "+this.name+", "+e.message)}},e.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},e.prototype.stop=function(e){var t=this;this.isPlaying&&(this._streaming?(this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1):me.b.audioEngine.audioContext&&this._soundSource&&(this._soundSource.stop(e?me.b.audioEngine.audioContext.currentTime+e:me.b.audioEngine.audioContext.currentTime),this._soundSource.onended=function(){t.isPlaying=!1},this.isPaused||(this._startOffset=0)))},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():me.b.audioEngine.audioContext&&(this.stop(0),this._startOffset+=me.b.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(e,t){me.b.audioEngine.canUseWebAudio&&this._soundGain&&(t&&me.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(me.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,me.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,me.b.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e},e.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},e.prototype.getVolume=function(){return this._volume},e.prototype.attachToMesh=function(e){var t=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},e.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(e){if(e.getBoundingInfo){var t=e;if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(o.t.Matrix[0]),this.setPosition(o.t.Matrix[0].getTranslation());else{var n=t.getBoundingInfo();this.setPosition(n.boundingSphere.centerWorld)}me.b.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},e.prototype.clone=function(){var t=this;if(this._streaming)return null;var n=function(){t._isReadyToPlay?(r._audioBuffer=t.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play()):window.setTimeout(n,300)},i={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,i);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),n(),r},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},e.Parse=function(t,n,i,r){var a,s=t.name;a=t.url?i+t.url:i+s;var l,c={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};if(r){var u=function(){r._isReadyToPlay?(l._audioBuffer=r.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play()):window.setTimeout(u,300)};l=new e(s,new ArrayBuffer(0),n,null,c),u()}else l=new e(s,a,n,function(){n._removePendingData(l)},c),n._addPendingData(l);if(t.position){var h=o.x.FromArray(t.position);l.setPosition(h)}if(t.isDirectional&&(l.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var d=o.x.FromArray(t.localDirectionToMesh);l.setLocalDirectionToMesh(d)}if(t.connectedMeshId){var f=n.getMeshByID(t.connectedMeshId);f&&l.attachToMesh(f)}return l},e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("AudioSceneComponent")},e}(),Ee=function(){function e(e,t){void 0===t&&(t={}),this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=e,this.soundCollection=new Array,this._options=t,!this._isMainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return e.prototype._initializeSoundTrackAudioGraph=function(){me.b.audioEngine.canUseWebAudio&&me.b.audioEngine.audioContext&&(this._outputAudioNode=me.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(me.b.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},e.prototype.dispose=function(){if(me.b.audioEngine&&me.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},e.prototype.AddSound=function(e){this._isInitialized||this._initializeSoundTrackAudioGraph(),me.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&e.connectToSoundTrackAudioNode(this._outputAudioNode),e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.RemoveSound(e):this._scene.soundTracks&&this._scene.soundTracks[e.soundTrackId].RemoveSound(e)),this.soundCollection.push(e),e.soundTrackId=this.id},e.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},e.prototype.setVolume=function(e){me.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=e)},e.prototype.switchPanningModelToHRTF=function(){if(me.b.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToHRTF()},e.prototype.switchPanningModelToEqualPower=function(){if(me.b.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToEqualPower()},e.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,me.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,me.b.audioEngine.masterGain))},e}(),xe=n(14);i.a.AddParser(xe.a.NAME_AUDIO,function(e,t,n,i){var r,o=[];if(n.sounds=n.sounds||[],null!=e.sounds)for(var a=0,s=e.sounds.length;a<s;a++){var l=e.sounds[a];me.b.audioEngine.canUseWebAudio?(l.url||(l.url=l.name),o[l.url]?n.sounds.push(Te.Parse(l,t,i,o[l.url])):(r=Te.Parse(l,t,i),o[l.url]=r,n.sounds.push(r))):n.sounds.push(new Te(l.name,null,t))}o=[]}),Object.defineProperty(W.a.prototype,"mainSoundTrack",{get:function(){var e=this._getComponent(xe.a.NAME_AUDIO);return e||(e=new Ce(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new Ee(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),W.a.prototype.getSoundByName=function(e){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks)for(var n=0;n<this.soundTracks.length;n++)for(t=0;t<this.soundTracks[n].soundCollection.length;t++)if(this.soundTracks[n].soundCollection[t].name===e)return this.soundTracks[n].soundCollection[t];return null},Object.defineProperty(W.a.prototype,"audioEnabled",{get:function(){var e=this._getComponent(xe.a.NAME_AUDIO);return e||(e=new Ce(this),this._addComponent(e)),e.audioEnabled},set:function(e){var t=this._getComponent(xe.a.NAME_AUDIO);t||(t=new Ce(this),this._addComponent(t)),e?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(W.a.prototype,"headphone",{get:function(){var e=this._getComponent(xe.a.NAME_AUDIO);return e||(e=new Ce(this),this._addComponent(e)),e.headphone},set:function(e){var t=this._getComponent(xe.a.NAME_AUDIO);t||(t=new Ce(this),this._addComponent(t)),e?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});var Ce=function(){function e(e){this.name=xe.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.scene=e,e.soundTracks=new Array,e.sounds=new Array}return Object.defineProperty(e.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),e.prototype.register=function(){this.scene._afterRenderStage.registerStep(xe.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){if(e.sounds=[],this.scene.soundTracks)for(var t=0;t<this.scene.soundTracks.length;t++)for(var n=this.scene.soundTracks[t],i=0;i<n.soundCollection.length;i++)e.sounds.push(n.soundCollection[i].serialize())},e.prototype.addFromContainer=function(e){var t=this;e.sounds&&e.sounds.forEach(function(e){e.play(),e.autoplay=!0,t.scene.mainSoundTrack.AddSound(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;void 0===t&&(t=!1),e.sounds&&e.sounds.forEach(function(e){e.stop(),e.autoplay=!1,n.scene.mainSoundTrack.RemoveSound(e),t&&e.dispose()})},e.prototype.dispose=function(){var e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].dispose()},e.prototype.disableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!1,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var n=0;n<t.soundTracks[e].soundCollection.length;n++)t.soundTracks[e].soundCollection[n].pause()},e.prototype.enableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!0,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].isPaused&&t.mainSoundTrack.soundCollection[e].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var n=0;n<t.soundTracks[e].soundCollection.length;n++)t.soundTracks[e].soundCollection[n].isPaused&&t.soundTracks[e].soundCollection[n].play()},e.prototype.switchAudioModeForHeadphones=function(){var e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToHRTF()},e.prototype.switchAudioModeForNormalSpeakers=function(){var e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToEqualPower()},e.prototype._afterRender=function(){var e=this.scene;if(this._audioEnabled&&e._mainSoundTrack&&e.soundTracks&&(0!==e._mainSoundTrack.soundCollection.length||1!==e.soundTracks.length)){var t,n=me.b.audioEngine;if((t=e.activeCameras.length>0?e.activeCameras[0]:e.activeCamera)&&n.audioContext){n.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z),t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]);var i,r=o.j.Invert(t.getViewMatrix()),a=o.x.TransformNormal(new o.x(0,0,-1),r);for(a.normalize(),isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||n.audioContext.listener.setOrientation(a.x,a.y,a.z,0,1,0),i=0;i<e.mainSoundTrack.soundCollection.length;i++){var s=e.mainSoundTrack.soundCollection[i];s.useCustomAttenuation&&s.updateDistanceFromListener()}if(e.soundTracks)for(i=0;i<e.soundTracks.length;i++)for(var l=0;l<e.soundTracks[i].soundCollection.length;l++)(s=e.soundTracks[i].soundCollection[l]).useCustomAttenuation&&s.updateDistanceFromListener()}}},e}();Te._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_AUDIO);t||(t=new Ce(e),e._addComponent(t))};var Se=function(){function e(e,t,n){var i=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=n;for(var r=0,o=0,a=n;o<a.length;o++)r+=a[o];for(var s=r>0?1/r:0,l=0;l<this._weights.length;l++)this._weights[l]*=s;this._sounds=t;for(var c=0,u=this._sounds;c<u.length;c++)u[c].onEndedObservable.add(function(){i._onended()})}return Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(var t=0,n=this._sounds;t<n.length;t++)n[t].directionalConeInnerAngle=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(var t=0,n=this._sounds;t<n.length;t++)n[t].directionalConeOuterAngle=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(e!==this._volume)for(var t=0,n=this._sounds;t<n.length;t++)n[t].setVolume(e)},enumerable:!0,configurable:!0}),e.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},e.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},e.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},e.prototype.play=function(e){if(!this.isPaused){this.stop();for(var t=Math.random(),n=0,i=0;i<this._weights.length;i++)if(t<=(n+=this._weights[i])){this._currentIndex=i;break}}var r=this._sounds[this._currentIndex];r.isReady()?r.play(0,this.isPaused?void 0:e):r.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},e}(),Ae=n(17),Pe=function(){function e(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(e.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){var t=this;this._attachedCamera=e;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(e){e.type!==Ae.a.POINTERDOWN?e.type===Ae.a.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){var e=X.a.Now,n=0;null!=t._lastFrameTime&&(n=e-t._lastFrameTime),t._lastFrameTime=e,t._applyUserInteraction();var i=Math.max(Math.min((e-t._lastInteractionTime-t._idleRotationWaitTime)/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*i,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(n/1e3))})},e.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},e.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},e.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},e.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=X.a.Now)},e.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},e}(),Re=function(){function e(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(e.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var n=this._attachedCamera;n&&(e?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add(function(e){if(e){e.computeWorldMatrix(!0);var n=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*n,t.upperRadiusTransitionRange=.05*n}}):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},e.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},e.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&this._attachedCamera.radius===e&&!this._radiusIsAnimating},e.prototype._applyBoundRadiusAnimation=function(t){var n=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=F.CreateAnimation("radius",F.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=F.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return n._clearAnimationLocks()});i&&this._animatables.push(i)}},e.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},e.EasingFunction=new te(.3),e.EasingMode=$.EASINGMODE_EASEOUT,e}(),Me=function(){function e(){this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._attachedCamera=t;var i=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(e){e.type!==Ae.a.POINTERDOWN?e.type===Ae.a.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(e){e&&n.zoomOnMesh(e)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){n._applyUserInteraction(),n._maintainCameraAboveGround()})},e.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},e.prototype.zoomOnMesh=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),e.computeWorldMatrix(!0);var i=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(i.minimumWorld,i.maximumWorld,t,n)},e.prototype.zoomOnMeshHierarchy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),e.computeWorldMatrix(!0);var i=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(i.min,i.max,t,n)},e.prototype.zoomOnMeshesHierarchy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null);for(var i=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new o.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=0;a<e.length;a++){var s=e[a].getHierarchyBoundingVectors(!0);be.h.CheckExtends(s.min,i,r),be.h.CheckExtends(s.max,i,r)}this.zoomOnBoundingInfo(i,r,t,n)},e.prototype.zoomOnBoundingInfo=function(t,n,i,r){var a,s=this;if(void 0===i&&(i=!1),void 0===r&&(r=null),this._attachedCamera){var l=t.y,c=l+(n.y-l)*this._positionScale,u=n.subtract(t).scale(.5);if(i)a=new o.x(0,c,0);else{var h=t.add(u);a=new o.x(h.x,c,h.z)}this._vectorTransition||(this._vectorTransition=F.CreateAnimation("target",F.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var d=F.TransitionTo("target",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);var f=0;if(this._mode===e.FitFrustumSidesMode){var p=this._calculateLowerRadiusFromModelBoundingSphere(t,n);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.minZ),f=p}else this._mode===e.IgnoreBoundsSizeMode&&(f=this._calculateLowerRadiusFromModelBoundingSphere(t,n),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var g=n.subtract(t).length();this._attachedCamera.panningSensibility=5e3/g,this._attachedCamera.wheelPrecision=100/f}this._radiusTransition||(this._radiusTransition=F.CreateAnimation("radius",F.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(d=F.TransitionTo("radius",f,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){s.stopAllAnimations(),r&&r(),s._attachedCamera&&s._attachedCamera.useInputToRestoreState&&s._attachedCamera.storeState()}))&&this._animatables.push(d)}},e.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,n){var i=n.subtract(t).length(),r=this._getFrustumSlope(),o=.5*i*this._radiusScale,a=o*Math.sqrt(1+1/(r.x*r.x)),s=o*Math.sqrt(1+1/(r.y*r.y)),l=Math.max(a,s),c=this._attachedCamera;return c?(c.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(l=l<c.lowerRadiusLimit?c.lowerRadiusLimit:l),c.upperRadiusLimit&&(l=l>c.upperRadiusLimit?c.upperRadiusLimit:l),l):0},e.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var n=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&X.a.Now-this._lastInteractionTime>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.CreateAnimation("beta",F.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var r=F.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});r&&this._animatables.push(r)}}},e.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return o.w.Zero();var t=e.getScene().getEngine().getAspectRatio(e),n=Math.tan(e.fov/2);return new o.w(n*t,n)},e.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},e.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=X.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(e.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),e.EasingFunction=new oe,e.EasingMode=$.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1,e}(),Oe=function(e,t,n,i){void 0===t&&(t=new o.x),void 0===n&&(n=0),void 0===i&&(i=!1),this.direction=e,this.rotatedDirection=t,this.diff=n,this.ignore=i},we=function(){function e(e){this.ui=e,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new Oe(o.x.Up()),new Oe(o.x.Down()),new Oe(o.x.Left()),new Oe(o.x.Right()),new Oe(o.x.Forward()),new Oe(o.x.Forward().scaleInPlace(-1))],this._tmpMatrix=new o.j,this._tmpVector=new o.x,this._zeroVector=o.x.Zero(),this._lookAtTmpMatrix=new o.j}return e.prototype.init=function(){},e.prototype._closestFace=function(e){var t=this;return this._faceVectors.forEach(function(n){t._target.rotationQuaternion||(t._target.rotationQuaternion=o.q.RotationYawPitchRoll(t._target.rotation.y,t._target.rotation.x,t._target.rotation.z)),t._target.rotationQuaternion.toRotationMatrix(t._tmpMatrix),o.x.TransformCoordinatesToRef(n.direction,t._tmpMatrix,n.rotatedDirection),n.diff=o.x.GetAngleBetweenVectors(n.rotatedDirection,e,o.x.Cross(n.rotatedDirection,e))}),this._faceVectors.reduce(function(e,t){return e.ignore?t:t.ignore?e:e.diff<t.diff?e:t},this._faceVectors[0])},e.prototype._lookAtToRef=function(e,t,n){void 0===t&&(t=new o.x(0,1,0)),o.j.LookAtLHToRef(this._zeroVector,e,t,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),o.q.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},e.prototype.attach=function(e){var t=this;this._target=e,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(t._scene.activeCamera){var n=t._scene.activeCamera.position;t._scene.activeCamera.devicePosition&&(n=t._scene.activeCamera.devicePosition);var i=t._closestFace(n.subtract(e.position));t._scene.activeCamera.leftCamera?t._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix):t._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix),o.x.TransformCoordinatesToRef(o.x.Up(),t._tmpMatrix,t._tmpVector),t._faceVectors.forEach(function(e){i.direction.x&&e.direction.x&&(e.ignore=!0),i.direction.y&&e.direction.y&&(e.ignore=!0),i.direction.z&&e.direction.z&&(e.ignore=!0)});var r=t._closestFace(t._tmpVector);t._faceVectors.forEach(function(e){e.ignore=!1}),t.ui.position.copyFrom(e.position),i.direction.x&&(i.rotatedDirection.scaleToRef(e.scaling.x/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),i.direction.y&&(i.rotatedDirection.scaleToRef(e.scaling.y/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),i.direction.z&&(i.rotatedDirection.scaleToRef(e.scaling.z/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),t.ui.rotationQuaternion||(t.ui.rotationQuaternion=o.q.RotationYawPitchRoll(t.ui.rotation.y,t.ui.rotation.x,t.ui.rotation.z)),i.rotatedDirection.scaleToRef(-1,t._tmpVector),t._lookAtToRef(t._tmpVector,r.rotatedDirection,t.ui.rotationQuaternion),r.direction.x&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.x/2,t._tmpVector),r.direction.y&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.y/2,t._tmpVector),r.direction.z&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.z/2,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)}})},e.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},e}(),Ie=function(){function e(){var e=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(e._ownerNode){if(e._hoverValue+=e._hovered?e._millisecondsPerFrame:-e._millisecondsPerFrame,e._setAllVisibility(e._ownerNode,(e._hoverValue-e.delay)/e.fadeInTime),e._ownerNode.visibility>1)return e._setAllVisibility(e._ownerNode,1),void(e._hoverValue=e.fadeInTime+e.delay);if(e._ownerNode.visibility<0&&(e._setAllVisibility(e._ownerNode,0),e._hoverValue<0))return void(e._hoverValue=0);setTimeout(e._update,e._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){this._ownerNode=e,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(e){this._hovered=e,this._update()},e.prototype._setAllVisibility=function(e,t){var n=this;e.visibility=t,e.getChildMeshes().forEach(function(e){n._setAllVisibility(e,t)})},e}(),De=n(54),Le=function(){function e(){this._startDistance=0,this._initialScale=new o.x(0,0,0),this._targetScale=new o.x(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new De.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new De.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},e.prototype.attach=function(e){var t=this;this._ownerNode=e,this._dragBehaviorA.onDragStartObservable.add(function(n){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorA.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(n){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorB.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(e){e.onDragObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var e=t._getCurrentDistance()/t._startDistance;t._initialScale.scaleToRef(e,t._targetScale)}})}),e.addBehavior(this._dragBehaviorA),e.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var n=t._targetScale.subtract(e.scaling).scaleInPlace(.1);n.length()>.01&&e.scaling.addInPlace(n)}})},e.prototype.detach=function(){var e=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(t){t.onDragStartObservable.clear(),t.onDragObservable.clear(),e._ownerNode.removeBehavior(t)})},e}(),ke=n(24),Ne=n(21),Fe=n(45),Be=function(){function e(){this._sceneRenderObserver=null,this._targetPosition=new o.x(0,0,0),this._moving=!1,this._startingOrientation=new o.q,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new r.c,this.onDragEndObservable=new r.c}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._ownerNode=t,this._scene=this._ownerNode.getScene(),e._virtualScene||((e._virtualScene=new W.a(this._scene.getEngine())).detachControl(),this._scene.getEngine().scenes.pop());var i=null,r=new o.x(0,0,0);this._virtualOriginMesh=new ke.a("",e._virtualScene),this._virtualOriginMesh.rotationQuaternion=new o.q,this._virtualDragMesh=new ke.a("",e._virtualScene),this._virtualDragMesh.rotationQuaternion=new o.q;var a=null;this._pointerObserver=this._scene.onPointerObservable.add(function(e,t){if(e.type==Ae.a.POINTERDOWN){if(!n.dragging&&e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh&&e.pickInfo.ray&&(n._ownerNode==(h=e.pickInfo.pickedMesh)||h.isDescendantOf(n._ownerNode))){n._scene.activeCamera&&n._scene.activeCamera.cameraRigMode==Ne.a.RIG_MODE_NONE&&e.pickInfo.ray.origin.copyFrom(n._scene.activeCamera.globalPosition),Fe.a._RemoveAndStorePivotPoint(i=n._ownerNode),r.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.add(e.pickInfo.ray.direction)),n._virtualOriginMesh.removeChild(n._virtualDragMesh),i.computeWorldMatrix(),n._virtualDragMesh.position.copyFrom(i.absolutePosition),i.rotationQuaternion||(i.rotationQuaternion=o.q.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z));var s=i.parent;i.setParent(null),n._virtualDragMesh.rotationQuaternion.copyFrom(i.rotationQuaternion),i.setParent(s),n._virtualOriginMesh.addChild(n._virtualDragMesh),n._targetPosition.copyFrom(n._virtualDragMesh.absolutePosition),n.dragging=!0,n.currentDraggingPointerID=e.event.pointerId,n.detachCameraControls&&n._scene.activeCamera&&!n._scene.activeCamera.leftCamera&&(n._scene.activeCamera.inputs.attachedElement?(a=n._scene.activeCamera.inputs.attachedElement,n._scene.activeCamera.detachControl(n._scene.activeCamera.inputs.attachedElement)):a=null),Fe.a._RestorePivotPoint(i),n.onDragStartObservable.notifyObservers({})}}else if(e.type==Ae.a.POINTERUP)n.currentDraggingPointerID==e.event.pointerId&&(n.dragging=!1,n._moving=!1,n.currentDraggingPointerID=-1,i=null,n._virtualOriginMesh.removeChild(n._virtualDragMesh),n.detachCameraControls&&a&&n._scene.activeCamera&&!n._scene.activeCamera.leftCamera&&n._scene.activeCamera.attachControl(a,!0),n.onDragEndObservable.notifyObservers({}));else if(e.type==Ae.a.POINTERMOVE&&n.currentDraggingPointerID==e.event.pointerId&&n.dragging&&e.pickInfo&&e.pickInfo.ray&&i){var l=n.zDragFactor;n._scene.activeCamera&&n._scene.activeCamera.cameraRigMode==Ne.a.RIG_MODE_NONE&&(e.pickInfo.ray.origin.copyFrom(n._scene.activeCamera.globalPosition),l=0);var c=e.pickInfo.ray.origin.subtract(r);r.copyFrom(e.pickInfo.ray.origin);var u=-o.x.Dot(c,e.pickInfo.ray.direction);n._virtualOriginMesh.addChild(n._virtualDragMesh),n._virtualDragMesh.position.z-=n._virtualDragMesh.position.z<1?u*n.zDragFactor:u*l*n._virtualDragMesh.position.z,n._virtualDragMesh.position.z<0&&(n._virtualDragMesh.position.z=0),n._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.add(e.pickInfo.ray.direction)),n._virtualOriginMesh.removeChild(n._virtualDragMesh),n._targetPosition.copyFrom(n._virtualDragMesh.absolutePosition),i.parent&&o.x.TransformCoordinatesToRef(n._targetPosition,o.j.Invert(i.parent.getWorldMatrix()),n._targetPosition),n._moving||n._startingOrientation.copyFrom(n._virtualDragMesh.rotationQuaternion),n._moving=!0}var h});var s=new o.q;this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(n.dragging&&n._moving&&i){if(Fe.a._RemoveAndStorePivotPoint(i),i.position.addInPlace(n._targetPosition.subtract(i.position).scale(n.dragDeltaRatio)),n.rotateDraggedObject){s.copyFrom(n._startingOrientation),s.x=-s.x,s.y=-s.y,s.z=-s.z,n._virtualDragMesh.rotationQuaternion.multiplyToRef(s,s),o.q.RotationYawPitchRollToRef(s.toEulerAngles("xyz").y,0,0,s),s.multiplyToRef(n._startingOrientation,s);var e=i.parent;(!e||e.scaling&&!e.scaling.isNonUniformWithinEpsilon(.001))&&(i.setParent(null),o.q.SlerpToRef(i.rotationQuaternion,s,n.dragDeltaRatio,i.rotationQuaternion),i.setParent(e))}Fe.a._RestorePivotPoint(i)}})},e.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},e}(),Ue=function(){function e(e,t,n){if(this.targetPosition=o.x.Zero(),this.poleTargetPosition=o.x.Zero(),this.poleTargetLocalOffset=o.x.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=o.q.Identity(),this._bone1Mat=o.j.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=o.x.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=t,this._bone1=t.getParent(),this._bone1){this.mesh=e;var i=t.getPosition();if(t.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,i.x>i.y&&i.x>i.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var r=this._bone1.getScale(),a=this._bone2.getScale();this._bone1Length=this._bone1.length*r.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*a.y*this.mesh.scaling.y}else if(this._bone1.children[0]){e.computeWorldMatrix(!0);var s=this._bone2.children[0].getAbsolutePosition(e),l=this._bone2.getAbsolutePosition(e),c=this._bone1.getAbsolutePosition(e);this._bone1Length=o.x.Distance(s,l),this._bone2Length=o.x.Distance(l,c)}this._bone1.getRotationMatrixToRef(o.s.WORLD,e,this._bone1Mat),this.maxAngle=Math.PI,n&&(n.targetMesh&&(this.targetMesh=n.targetMesh,this.targetMesh.computeWorldMatrix(!0)),n.poleTargetMesh?(this.poleTargetMesh=n.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):n.poleTargetBone?this.poleTargetBone=n.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),n.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(n.poleTargetLocalOffset),n.poleAngle&&(this.poleAngle=n.poleAngle),n.bendAxis&&this._bendAxis.copyFrom(n.bendAxis),n.maxAngle&&(this.maxAngle=n.maxAngle),n.slerpAmount&&(this.slerpAmount=n.slerpAmount))}}return Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(e){this._setMaxAngle(e)},enumerable:!0,configurable:!0}),e.prototype._setMaxAngle=function(e){e<0&&(e=0),(e>Math.PI||null==e)&&(e=Math.PI),this._maxAngle=e;var t=this._bone1Length,n=this._bone2Length;this._maxReach=Math.sqrt(t*t+n*n-2*t*n*Math.cos(e))},e.prototype.update=function(){var t=this._bone1;if(t){var n=this.targetPosition,i=this.poleTargetPosition,r=e._tmpMats[0],a=e._tmpMats[1];this.targetMesh&&n.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,i):this.poleTargetMesh&&o.x.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),i);var s=e._tmpVecs[0],l=e._tmpVecs[1],c=e._tmpVecs[2],u=e._tmpVecs[3],h=e._tmpVecs[4],d=e._tmpQuat;t.getAbsolutePositionToRef(this.mesh,s),i.subtractToRef(s,h),0==h.x&&0==h.y&&0==h.z?h.y=1:h.normalize(),n.subtractToRef(s,u),u.normalize(),o.x.CrossToRef(u,h,l),l.normalize(),o.x.CrossToRef(u,l,c),c.normalize(),o.j.FromXYZAxesToRef(c,u,l,r);var f=this._bone1Length,p=this._bone2Length,g=o.x.Distance(s,n);this._maxReach>0&&(g=Math.min(this._maxReach,g));var m=(p*p+g*g-f*f)/(2*p*g),_=(g*g+f*f-p*p)/(2*g*f);m>1&&(m=1),_>1&&(_=1),m<-1&&(m=-1),_<-1&&(_=-1);var v=Math.acos(m),b=Math.acos(_),y=-v-b;if(this._rightHandedSystem)o.j.RotationYawPitchRollToRef(0,0,this._adjustRoll,a),a.multiplyToRef(r,r),o.j.RotationAxisToRef(this._bendAxis,b,a),a.multiplyToRef(r,r);else{var T=e._tmpVecs[5];T.copyFrom(this._bendAxis),T.x*=-1,o.j.RotationAxisToRef(T,-b,a),a.multiplyToRef(r,r)}this.poleAngle&&(o.j.RotationAxisToRef(u,this.poleAngle,a),r.multiplyToRef(a,r)),this._bone1&&(this.slerpAmount<1?(this._slerping||o.q.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),o.q.FromRotationMatrixToRef(r,d),o.q.SlerpToRef(this._bone1Quat,d,this.slerpAmount,this._bone1Quat),y=this._bone2Ang*(1-this.slerpAmount)+y*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,o.s.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(r,o.s.WORLD,this.mesh),this._bone1Mat.copyFrom(r),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,y,o.s.LOCAL),this._bone2Ang=y}},e._tmpVecs=[o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero()],e._tmpQuat=o.q.Identity(),e._tmpMats=[o.j.Identity(),o.j.Identity()],e}(),Ve=function(){function e(e,t,n,i){if(this.upAxis=o.x.Up(),this.upAxisSpace=o.s.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=o.q.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=o.x.Forward(),this.mesh=e,this.bone=t,this.target=n,i&&(i.adjustYaw&&(this.adjustYaw=i.adjustYaw),i.adjustPitch&&(this.adjustPitch=i.adjustPitch),i.adjustRoll&&(this.adjustRoll=i.adjustRoll),this.maxYaw=null!=i.maxYaw?i.maxYaw:Math.PI,this.minYaw=null!=i.minYaw?i.minYaw:-Math.PI,this.maxPitch=null!=i.maxPitch?i.maxPitch:Math.PI,this.minPitch=null!=i.minPitch?i.minPitch:-Math.PI,null!=i.slerpAmount&&(this.slerpAmount=i.slerpAmount),null!=i.upAxis&&(this.upAxis=i.upAxis),null!=i.upAxisSpace&&(this.upAxisSpace=i.upAxisSpace),null!=i.yawAxis||null!=i.pitchAxis)){var r=o.c.Y,a=o.c.X;null!=i.yawAxis&&(r=i.yawAxis.clone()).normalize(),null!=i.pitchAxis&&(a=i.pitchAxis.clone()).normalize();var s=o.x.Cross(a,r);this._transformYawPitch=o.j.Identity(),o.j.FromXYZAxesToRef(a,r,s,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}t.getParent()||this.upAxisSpace!=o.s.BONE||(this.upAxisSpace=o.s.LOCAL)}return Object.defineProperty(e.prototype,"minYaw",{get:function(){return this._minYaw},set:function(e){this._minYaw=e,this._minYawSin=Math.sin(e),this._minYawCos=Math.cos(e),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(e){this._maxYaw=e,this._maxYawSin=Math.sin(e),this._maxYawCos=Math.cos(e),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPitch",{get:function(){return this._minPitch},set:function(e){this._minPitch=e,this._minPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(e){this._maxPitch=e,this._maxPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var t=this.bone,n=e._tmpVecs[0];t.getAbsolutePositionToRef(this.mesh,n);var i=this.target,r=e._tmpMats[0],a=e._tmpMats[1],s=this.mesh,l=t.getParent(),c=e._tmpVecs[1];c.copyFrom(this.upAxis),this.upAxisSpace==o.s.BONE&&l?(this._transformYawPitch&&o.x.TransformCoordinatesToRef(c,this._transformYawPitchInv,c),l.getDirectionToRef(c,this.mesh,c)):this.upAxisSpace==o.s.LOCAL&&(s.getDirectionToRef(c,c),1==s.scaling.x&&1==s.scaling.y&&1==s.scaling.z||c.normalize());var u=!1,h=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(u=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(h=!0),u||h){var d=e._tmpMats[2],f=e._tmpMats[3];if(this.upAxisSpace==o.s.BONE&&1==c.y&&l)l.getRotationMatrixToRef(o.s.WORLD,this.mesh,d);else if(this.upAxisSpace!=o.s.LOCAL||1!=c.y||l){(g=e._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&o.x.TransformCoordinatesToRef(g,this._transformYawPitchInv,g),l?l.getDirectionToRef(g,this.mesh,g):s.getDirectionToRef(g,g);var p=o.x.Cross(c,g);p.normalize();var g=o.x.Cross(p,c);o.j.FromXYZAxesToRef(p,c,g,d)}else d.copyFrom(s.getWorldMatrix());d.invertToRef(f);var m=null;if(h){var _=e._tmpVecs[3];i.subtractToRef(n,_),o.x.TransformCoordinatesToRef(_,f,_),m=Math.sqrt(_.x*_.x+_.z*_.z);var v=Math.atan2(_.y,m),b=v;v>this._maxPitch?(_.y=this._maxPitchTan*m,b=this._maxPitch):v<this._minPitch&&(_.y=this._minPitchTan*m,b=this._minPitch),v!=b&&(o.x.TransformCoordinatesToRef(_,d,_),_.addInPlace(n),i=_)}if(u){i.subtractToRef(n,_=e._tmpVecs[4]),o.x.TransformCoordinatesToRef(_,f,_);var y=Math.atan2(_.x,_.z),T=y;if((y>this._maxYaw||y<this._minYaw)&&(null==m&&(m=Math.sqrt(_.x*_.x+_.z*_.z)),this._yawRange>Math.PI?this._isAngleBetween(y,this._maxYaw,this._midYawConstraint)?(_.z=this._maxYawCos*m,_.x=this._maxYawSin*m,T=this._maxYaw):this._isAngleBetween(y,this._midYawConstraint,this._minYaw)&&(_.z=this._minYawCos*m,_.x=this._minYawSin*m,T=this._minYaw):y>this._maxYaw?(_.z=this._maxYawCos*m,_.x=this._maxYawSin*m,T=this._maxYaw):y<this._minYaw&&(_.z=this._minYawCos*m,_.x=this._minYawSin*m,T=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var E=e._tmpVecs[8];E.copyFrom(o.c.Z),this._transformYawPitch&&o.x.TransformCoordinatesToRef(E,this._transformYawPitchInv,E);var x=e._tmpMats[4];this._boneQuat.toRotationMatrix(x),this.mesh.getWorldMatrix().multiplyToRef(x,x),o.x.TransformCoordinatesToRef(E,x,E),o.x.TransformCoordinatesToRef(E,f,E);var C=Math.atan2(E.x,E.z);if(this._getAngleBetween(C,y)>this._getAngleBetween(C,this._midYawConstraint)){null==m&&(m=Math.sqrt(_.x*_.x+_.z*_.z));var S=this._getAngleBetween(C,this._maxYaw);this._getAngleBetween(C,this._minYaw)<S?(T=C+.75*Math.PI,_.z=Math.cos(T)*m,_.x=Math.sin(T)*m):(T=C-.75*Math.PI,_.z=Math.cos(T)*m,_.x=Math.sin(T)*m)}}y!=T&&(o.x.TransformCoordinatesToRef(_,d,_),_.addInPlace(n),i=_)}}var A=e._tmpVecs[5],P=e._tmpVecs[6],R=e._tmpVecs[7],M=e._tmpQuat;i.subtractToRef(n,A),A.normalize(),o.x.CrossToRef(c,A,P),P.normalize(),o.x.CrossToRef(A,P,R),R.normalize(),o.j.FromXYZAxesToRef(P,R,A,r),0===P.x&&0===P.y&&0===P.z||0===R.x&&0===R.y&&0===R.z||0===A.x&&0===A.y&&0===A.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(o.j.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,a),a.multiplyToRef(r,r)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(o.s.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),o.q.FromRotationMatrixToRef(r,M),o.q.SlerpToRef(this._boneQuat,M,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,o.s.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(r,r),this.bone.setRotationMatrix(r,o.s.WORLD,this.mesh),this._slerping=!1))}},e.prototype._getAngleDiff=function(e,t){var n=t-e;return(n%=2*Math.PI)>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),n},e.prototype._getAngleBetween=function(e,t){var n=0;return(n=(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n},e.prototype._isAngleBetween=function(e,t,n){if(e=(e%=2*Math.PI)<0?e+2*Math.PI:e,(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(n=(n%=2*Math.PI)<0?n+2*Math.PI:n)){if(e>t&&e<n)return!0}else if(e>n&&e<t)return!0;return!1},e._tmpVecs=Y.a.BuildArray(10,o.x.Zero),e._tmpQuat=o.q.Identity(),e._tmpMats=Y.a.BuildArray(5,o.j.Identity),e}(),Ge=n(7),ze=n(26);me.b.prototype.updateRawTexture=function(e,t,n,i,r,o){if(void 0===r&&(r=null),void 0===o&&(o=me.b.TEXTURETYPE_UNSIGNED_INT),e){var a=this._getRGBABufferInternalSizedFormat(o,n),s=this._getInternalFormat(n),l=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=t,e.format=n,e.type=o,e.invertY=i,e._compression=r),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,s,l,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},me.b.prototype.createRawTexture=function(e,t,n,i,r,o,a,s,l){void 0===s&&(s=null),void 0===l&&(l=me.b.TEXTURETYPE_UNSIGNED_INT);var c=new ze.a(this,ze.a.DATASOURCE_RAW);c.baseWidth=t,c.baseHeight=n,c.width=t,c.height=n,c.format=i,c.generateMipMaps=r,c.samplingMode=a,c.invertY=o,c._compression=s,c.type=l,this._doNotHandleContextLost||(c._bufferView=e),this.updateRawTexture(c,e,i,o,s,l),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0);var u=this._getSamplingParameters(a,r);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(c),c},me.b.prototype.createRawCubeTexture=function(e,t,n,i,r,o,a,s){void 0===s&&(s=null);var l=this._gl,c=new ze.a(this,ze.a.DATASOURCE_CUBERAW);c.isCube=!0,c.format=n,c.type=i,this._doNotHandleContextLost||(c._bufferViewArray=e);var u=this._getWebGLTextureType(i),h=this._getInternalFormat(n);h===l.RGB&&(h=l.RGBA),u!==l.FLOAT||this._caps.textureFloatLinearFiltering?u!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?u!==l.FLOAT||this._caps.textureFloatRender?u!==l.HALF_FLOAT||this._caps.colorBufferFloat||(r=!1,p.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(r=!1,p.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(r=!1,a=me.b.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(r=!1,a=me.b.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var d=t;c.width=t,c.height=d,!this.needPOTTextures||be.h.IsExponentOfTwo(c.width)&&be.h.IsExponentOfTwo(c.height)||(r=!1),e&&this.updateRawCubeTexture(c,e,n,i,o,s),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,c,!0),e&&r&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var f=this._getSamplingParameters(a,r);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,f.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,f.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),c.generateMipMaps=r,c},me.b.prototype.updateRawCubeTexture=function(e,t,n,i,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0),e._bufferViewArray=t,e.format=n,e.type=i,e.invertY=r,e._compression=o;var s=this._gl,l=this._getWebGLTextureType(i),c=this._getInternalFormat(n),u=this._getRGBABufferInternalSizedFormat(i),h=!1;c===s.RGB&&(c=s.RGBA,h=!0),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===r||!!r),e.width%4!=0&&s.pixelStorei(s.UNPACK_ALIGNMENT,1);for(var d=0;d<6;d++){var f=t[d];o?s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,this.getCaps().s3tc[o],e.width,e.height,0,f):(h&&(f=this._convertRGBtoRGBATextureData(f,e.width,e.height,i)),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,u,e.width,e.height,0,c,l,f))}(!this.needPOTTextures||be.h.IsExponentOfTwo(e.width)&&be.h.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},me.b.prototype.createRawCubeTextureFromUrl=function(e,t,n,i,r,o,a,s,l,c,u,h){var d=this;void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=me.b.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===h&&(h=!1);var f=this._gl,p=this.createRawCubeTexture(null,n,i,r,!o,h,u);return t._addPendingData(p),p.url=e,this._internalTexturesCache.push(p),this._loadFile(e,function(e){!function(e){var n=p.width,o=a(e);if(o){if(s){var c=d._getWebGLTextureType(r),u=d._getInternalFormat(i),g=d._getRGBABufferInternalSizedFormat(r),m=!1;u===f.RGB&&(u=f.RGBA,m=!0),d._bindTextureDirectly(f.TEXTURE_CUBE_MAP,p,!0),d._unpackFlipY(!1);for(var _=s(o),v=0;v<_.length;v++)for(var b=n>>v,y=0;y<6;y++){var T=_[v][y];m&&(T=d._convertRGBtoRGBATextureData(T,b,b,r)),f.texImage2D(y,v,g,b,b,0,u,c,T)}d._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null)}else d.updateRawCubeTexture(p,o,i,r,h);p.isReady=!0,t._removePendingData(p),l&&l()}}(e)},void 0,t.offlineProvider,!0,function(e,n){t._removePendingData(p),c&&e&&c(e.status+" "+e.statusText,n)}),p},me.b.prototype.createRawTexture3D=function(e,t,n,i,r,o,a,s,l,c){void 0===l&&(l=null),void 0===c&&(c=me.b.TEXTURETYPE_UNSIGNED_INT);var u=new ze.a(this,ze.a.DATASOURCE_RAW3D);u.baseWidth=t,u.baseHeight=n,u.baseDepth=i,u.width=t,u.height=n,u.depth=i,u.format=r,u.type=c,u.generateMipMaps=o,u.samplingMode=s,u.is3D=!0,this._doNotHandleContextLost||(u._bufferView=e),this.updateRawTexture3D(u,e,r,a,l,c),this._bindTextureDirectly(this._gl.TEXTURE_3D,u,!0);var h=this._getSamplingParameters(s,o);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,h.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,h.min),o&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(u),u},me.b.prototype.updateRawTexture3D=function(e,t,n,i,r,o){void 0===r&&(r=null),void 0===o&&(o=me.b.TEXTURETYPE_UNSIGNED_INT);var a=this._getWebGLTextureType(o),s=this._getInternalFormat(n),l=this._getRGBABufferInternalSizedFormat(o,n);this._bindTextureDirectly(this._gl.TEXTURE_3D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=t,e.format=n,e.invertY=i,e._compression=r),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r&&t?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[r],e.width,e.height,e.depth,0,t):this._gl.texImage3D(this._gl.TEXTURE_3D,0,l,e.width,e.height,e.depth,0,s,a,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),e.isReady=!0};var je=function(e){function t(t,n,i,r,o,a,s,l,c){void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===l&&(l=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===c&&(c=g.a.TEXTURETYPE_UNSIGNED_INT);var u=e.call(this,null,o,!a,s)||this;return u.format=r,u._engine=o.getEngine(),u._texture=o.getEngine().createRawTexture(t,n,i,r,a,s,l,null,c),u.wrapU=Ge.a.CLAMP_ADDRESSMODE,u.wrapV=Ge.a.CLAMP_ADDRESSMODE,u}return c.d(t,e),t.prototype.update=function(e){this._engine.updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(e,n,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,i,g.a.TEXTUREFORMAT_LUMINANCE,r,o,a,s)},t.CreateLuminanceAlphaTexture=function(e,n,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,i,g.a.TEXTUREFORMAT_LUMINANCE_ALPHA,r,o,a,s)},t.CreateAlphaTexture=function(e,n,i,r,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,i,g.a.TEXTUREFORMAT_ALPHA,r,o,a,s)},t.CreateRGBTexture=function(e,n,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,i,g.a.TEXTUREFORMAT_RGB,r,o,a,s,l)},t.CreateRGBATexture=function(e,n,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,i,g.a.TEXTUREFORMAT_RGBA,r,o,a,s,l)},t.CreateRTexture=function(e,n,i,r,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=g.a.TEXTURETYPE_FLOAT),new t(e,n,i,g.a.TEXTUREFORMAT_R,r,o,a,s,l)},t}(Ge.a),He=function(){function e(e,t,n){this.name=e,this.id=t,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=o.j.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new r.c,this.bones=[],this._scene=n||A.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var i=this._scene.getEngine().getCaps();this._canUseTextureForBones=i.textureFloat&&i.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones&&!this.needInitialSkinMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter(function(e){return!e.getParent()})},e.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(){return this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var i in this._ranges)n&&(t+=", ",n=!1),t+=i;t+="}"}return t},e.prototype.getBoneIndexByName=function(e){for(var t=0,n=this.bones.length;t<n;t++)if(this.bones[t].name===e)return t;return-1},e.prototype.createAnimationRange=function(e,t,n){if(!this._ranges[e]){this._ranges[e]=new L(e,t,n);for(var i=0,r=this.bones.length;i<r;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(e,t,n)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var n=0,i=this.bones.length;n<i;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.copyAnimationRange=function(e,t,n){if(void 0===n&&(n=!1),this._ranges[t]||!e.getAnimationRange(t))return!1;var i,r,o=!0,a=this._getHighestAnimationFrame()+1,s={},l=e.bones;for(r=0,i=l.length;r<i;r++)s[l[r].name]=l[r];this.bones.length!==l.length&&(p.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+l.length),o=!1);var c=n&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(r=0,i=this.bones.length;r<i;r++){var u=this.bones[r].name,h=s[u];h?o=o&&this.bones[r].copyAnimationRange(h,t,a,n,c):(p.a.Warn("copyAnimationRange: not same rig, missing source bone "+u),o=!1)}var d=e.getAnimationRange(t);return d&&(this._ranges[t]=new L(t,d.from+a,d.to+a)),o},e.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[e].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,n=this.bones.length;t<n;t++)if(this.bones[t].animations[0]){var i=this.bones[t].animations[0].getHighestFrame();e<i&&(e=i)}return e},e.prototype.beginAnimation=function(e,t,n,i){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,n,i):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},e.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},e.prototype._computeTransformMatrices=function(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var i=this.bones[n];i._childUpdateId++;var r=i.getParent();if(r?i.getLocalMatrix().multiplyToRef(r.getWorldMatrix(),i.getWorldMatrix()):t?i.getLocalMatrix().multiplyToRef(t,i.getWorldMatrix()):i.getWorldMatrix().copyFrom(i.getLocalMatrix()),-1!==i._index){var o=null===i._index?n:i._index;i.getInvertedAbsoluteTransform().multiplyToArray(i.getWorldMatrix(),e,16*o)}}this._identity.copyToArray(e,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var e=0,t=this.bones;e<t.length;e++){var n=t[e];n._linkedTransformNode&&(n._linkedTransformNode.computeWorldMatrix(),n._matrix=n._linkedTransformNode._localMatrix,n.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var i=0;i<this._meshesWithPoseMatrix.length;i++){var r=this._meshesWithPoseMatrix[i],a=r.getPoseMatrix();if(r._bonesTransformMatrices&&r._bonesTransformMatrices.length===16*(this.bones.length+1)||(r._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==r){this._synchronizedWithMesh=r;for(var s=0;s<this.bones.length;s++){var l=this.bones[s];l.getParent()||(l.getBaseMatrix().multiplyToRef(a,o.t.Matrix[1]),l._updateDifferenceMatrix(o.t.Matrix[1]))}}this._computeTransformMatrices(r._bonesTransformMatrices,a)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=je.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},e.prototype.clone=function(t,n){var i=new e(t,n||t,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var r=0;r<this.bones.length;r++){var o=this.bones[r],a=null,s=o.getParent();if(s){var l=this.bones.indexOf(s);a=i.bones[l]}var c=new K(o.name,i,a,o.getBaseMatrix().clone(),o.getRestPose().clone());P.a.DeepCopy(o.animations,c.animations)}if(this._ranges)for(var u in i._ranges={},this._ranges){var h=this._ranges[u];h&&(i._ranges[u]=h.clone())}return this._isDirty=!0,i},e.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach(function(t){t.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=e})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var n=this.bones[t],i=n.getParent(),r={parentBoneIndex:i?this.bones.indexOf(i):-1,name:n.name,matrix:n.getBaseMatrix().toArray(),rest:n.getRestPose().toArray()};for(var o in e.bones.push(r),n.length&&(r.length=n.length),n.metadata&&(r.metadata=n.metadata),n.animations&&n.animations.length>0&&(r.animation=n.animations[0].serialize()),e.ranges=[],this._ranges){var a=this._ranges[o];if(a){var s={};s.name=o,s.from=a.from,s.to=a.to,e.ranges.push(s)}}}return e},e.Parse=function(t,n){var i,r=new e(t.name,t.id,n);for(t.dimensionsAtRest&&(r.dimensionsAtRest=o.x.FromArray(t.dimensionsAtRest)),r.needInitialSkinMatrix=t.needInitialSkinMatrix,i=0;i<t.bones.length;i++){var a=t.bones[i],s=null;a.parentBoneIndex>-1&&(s=r.bones[a.parentBoneIndex]);var l=a.rest?o.j.FromArray(a.rest):null,c=new K(a.name,r,s,o.j.FromArray(a.matrix),l);null!=a.id&&(c.id=a.id),a.length&&(c.length=a.length),a.metadata&&(c.metadata=a.metadata),a.animation&&c.animations.push(F.Parse(a.animation)),null!=a.linkedTransformNodeId&&(r._hasWaitingData=!0,c._waitingTransformNodeId=a.linkedTransformNodeId)}if(t.ranges)for(i=0;i<t.ranges.length;i++){var u=t.ranges[i];r.createAnimationRange(u.name,u.from,u.to)}return r},e.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var t=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=t||e)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=t)},e.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e},e.prototype.sortBones=function(){for(var e=new Array,t=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,e,t);this.bones=e},e.prototype._sortBones=function(e,t,n){if(!n[e]){n[e]=!0;var i=this.bones[e];void 0===i._index&&(i._index=e);var r=i.getParent();r&&this._sortBones(this.bones.indexOf(r),t,n),t.push(i)}},e}(),We={},Xe=function(){function e(e){this.attached={},this.camera=e,this.checkInputs=function(){}}return e.prototype.add=function(e){var t=e.getSimpleName();this.attached[t]?p.a.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},e.prototype.remove=function(e){for(var t in this.attached){var n=this.attached[t];n===e&&(n.detachControl(this.attachedElement),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}},e.prototype.removeByType=function(e){for(var t in this.attached){var n=this.attached[t];n.getClassName()===e&&(n.detachControl(this.attachedElement),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}},e.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},e.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},e.prototype.attachElement=function(e,t){if(void 0===t&&(t=!1),!this.attachedElement)for(var n in t=!Ne.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedElement=e,this.noPreventDefault=t,this.attached)this.attached[n].attachControl(e,t)},e.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var n in this.attached)this.attached[n].detachControl(e),t&&(this.attached[n].camera=null);this.attachedElement=null}},e.prototype.rebuildInputCheck=function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},e.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},e.prototype.serialize=function(e){var t={};for(var n in this.attached){var i=this.attached[n],r=D.a.Serialize(i);t[i.getClassName()]=r}e.inputsmgr=t},e.prototype.parse=function(e){var t=e.inputsmgr;if(t){for(var n in this.clear(),t)if(r=We[n]){var i=D.a.Parse(function(){return new r},t[n],null);this.add(i)}}else for(var n in this.attached){var r;(r=We[this.attached[n].getClassName()])&&(i=D.a.Parse(function(){return new r},e,null),this.remove(this.attached[n]),this.add(i))}},e}(),Ye=function(e,t){this.x=e,this.y=t},Ke=function(){function e(t,n,i,r,o,a,s){void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=2),void 0===s&&(s=3),this.id=t,this.index=n,this.browserGamepad=i,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=r,this._leftStickAxisY=o,this._rightStickAxisX=a,this._rightStickAxisY=s,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e}(),Qe=function(e){function t(t,n,i){var o=e.call(this,t,n,i)||this;return o.onButtonDownObservable=new r.c,o.onButtonUpObservable=new r.c,o.type=Ke.GENERIC,o._buttons=new Array(i.buttons.length),o}return c.d(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,n){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(n),this.onButtonDownObservable.notifyObservers(n)),0===e&&(this._onbuttonup&&this._onbuttonup(n),this.onButtonUpObservable.notifyObservers(n))),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(Ke),qe=function(){function e(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return e.prototype.attachControl=function(e,t){var n=this,i=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=i.onGamepadConnectedObservable.add(function(e){e.type!==Ke.POSE_ENABLED&&(n.gamepad&&e.type!==Ke.XBOX||(n.gamepad=e))}),this._onGamepadDisconnectedObserver=i.onGamepadDisconnectedObservable.add(function(e){n.gamepad===e&&(n.gamepad=null)}),this.gamepad=i.getGamepadByType(Ke.XBOX)},e.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){var n=t.x/this.gamepadRotationSensibility;0!=n&&Math.abs(n)>.005&&(e.inertialAlphaOffset+=n)}if(0!=t.y){var i=t.y/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialBetaOffset+=i)}}var r=this.gamepad.leftStick;if(r&&0!=r.y){var o=r.y/this.gamepadMoveSensibility;0!=o&&Math.abs(o)>.005&&(this.camera.inertialRadiusOffset-=o)}}},e.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},c.c([Object(D.c)()],e.prototype,"gamepadRotationSensibility",void 0),c.c([Object(D.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();We.ArcRotateCameraGamepadInput=qe;var Ze=n(51),Je=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var i,r=e.event;r.metaKey||(e.type===Ze.a.KEYDOWN?(n._ctrlPressed=r.ctrlKey,n._altPressed=r.altKey,(-1!==n.keysUp.indexOf(r.keyCode)||-1!==n.keysDown.indexOf(r.keyCode)||-1!==n.keysLeft.indexOf(r.keyCode)||-1!==n.keysRight.indexOf(r.keyCode)||-1!==n.keysReset.indexOf(r.keyCode))&&(-1===(i=n._keys.indexOf(r.keyCode))&&n._keys.push(r.keyCode),r.preventDefault&&(t||r.preventDefault()))):-1===n.keysUp.indexOf(r.keyCode)&&-1===n.keysDown.indexOf(r.keyCode)&&-1===n.keysLeft.indexOf(r.keyCode)&&-1===n.keysRight.indexOf(r.keyCode)&&-1===n.keysReset.indexOf(r.keyCode)||((i=n._keys.indexOf(r.keyCode))>=0&&n._keys.splice(i,1),r.preventDefault&&(t||r.preventDefault())))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&e.useInputToRestoreState&&e.restoreState()}},e.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},c.c([Object(D.c)()],e.prototype,"keysUp",void 0),c.c([Object(D.c)()],e.prototype,"keysDown",void 0),c.c([Object(D.c)()],e.prototype,"keysLeft",void 0),c.c([Object(D.c)()],e.prototype,"keysRight",void 0),c.c([Object(D.c)()],e.prototype,"keysReset",void 0),c.c([Object(D.c)()],e.prototype,"panningSensibility",void 0),c.c([Object(D.c)()],e.prototype,"zoomingSensibility",void 0),c.c([Object(D.c)()],e.prototype,"useAltToZoom",void 0),c.c([Object(D.c)()],e.prototype,"angularSpeed",void 0),e}();We.ArcRotateCameraKeyboardMoveInput=Je;var $e=function(){function e(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var n=.01*e.wheelDelta*this.wheelDeltaPercentage*t;return e.wheelDelta>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)},e.prototype.attachControl=function(e,t){var n=this;this._wheel=function(e,i){if(e.type===Ae.a.POINTERWHEEL){var r=e.event,o=0,a=r;if(a.wheelDelta)if(n.wheelDeltaPercentage){if((o=n.computeDeltaFromMouseWheelLegacyEvent(a,n.camera.radius))>0){for(var s=n.camera.radius,l=n.camera.inertialRadiusOffset+o,c=0;c<20&&Math.abs(l)>.001;c++)s-=l,l*=n.camera.inertia;s=I.a.Clamp(s,0,Number.MAX_VALUE),o=n.computeDeltaFromMouseWheelLegacyEvent(a,s)}}else o=a.wheelDelta/(40*n.wheelPrecision);else o=-(r.deltaY||r.detail)/n.wheelPrecision;o&&(n.camera.inertialRadiusOffset+=o),r.preventDefault&&(t||r.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ae.a.POINTERWHEEL)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},c.c([Object(D.c)()],e.prototype,"wheelPrecision",void 0),c.c([Object(D.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();We.ArcRotateCameraMouseWheelInput=$e;var et=function(){function e(){this.buttons=[0,1,2]}return e.prototype.attachControl=function(e,t){var n=this,i=this.camera.getEngine(),r=0,o=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(a,s){var l=a.event,c="touch"===l.pointerType;if(!i.isInVRExclusivePointerMode&&(a.type===Ae.a.POINTERMOVE||-1!==n.buttons.indexOf(l.button))){var u=l.srcElement||l.target;if(n._altKey=l.altKey,n._ctrlKey=l.ctrlKey,n._metaKey=l.metaKey,n._shiftKey=l.shiftKey,n._buttonsPressed=l.buttons,i.isPointerLock){var h=l.movementX||l.mozMovementX||l.webkitMovementX||l.msMovementX||0,d=l.movementY||l.mozMovementY||l.webkitMovementY||l.msMovementY||0;n.onTouch(null,h,d),n.pointA=null,n.pointB=null}else if(a.type===Ae.a.POINTERDOWN&&u){try{u.setPointerCapture(l.pointerId)}catch(e){}null===n.pointA?n.pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}:null===n.pointB&&(n.pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}),n.onButtonDown(l),t||(l.preventDefault(),e.focus())}else if(a.type===Ae.a.POINTERDOUBLETAP)n.onDoubleTap(l.pointerType);else if(a.type===Ae.a.POINTERUP&&u){try{u.releasePointerCapture(l.pointerId)}catch(e){}c||(n.pointB=null),i._badOS?n.pointA=n.pointB=null:n.pointB&&n.pointA&&n.pointA.pointerId==l.pointerId?(n.pointA=n.pointB,n.pointB=null):n.pointA&&n.pointB&&n.pointB.pointerId==l.pointerId?n.pointB=null:n.pointA=n.pointB=null,(0!==r||o)&&(n.onMultiTouch(n.pointA,n.pointB,r,0,o,null),r=0,o=null),n.onButtonUp(l),t||l.preventDefault()}else if(a.type===Ae.a.POINTERMOVE)if(t||l.preventDefault(),n.pointA&&null===n.pointB)n.onTouch(n.pointA,h=l.clientX-n.pointA.x,d=l.clientY-n.pointA.y),n.pointA.x=l.clientX,n.pointA.y=l.clientY;else if(n.pointA&&n.pointB){var f=n.pointA.pointerId===l.pointerId?n.pointA:n.pointB;f.x=l.clientX,f.y=l.clientY;var p=n.pointA.x-n.pointB.x,g=n.pointA.y-n.pointB.y,m=p*p+g*g,_={x:(n.pointA.x+n.pointB.x)/2,y:(n.pointA.y+n.pointB.y)/2,pointerId:l.pointerId,type:a.type};n.onMultiTouch(n.pointA,n.pointB,r,m,o,_),o=_,r=m}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ae.a.POINTERDOWN|Ae.a.POINTERUP|Ae.a.POINTERMOVE),this._onLostFocus=function(){n.pointA=n.pointB=null,r=0,o=null,n.onLostFocus()},e.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),be.h.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},e.prototype.detachControl=function(e){this._onLostFocus&&be.h.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},e.prototype.getClassName=function(){return"BaseCameraPointersInput"},e.prototype.getSimpleName=function(){return"pointers"},e.prototype.onDoubleTap=function(e){},e.prototype.onTouch=function(e,t,n){},e.prototype.onMultiTouch=function(e,t,n,i,r,o){},e.prototype.onContextMenu=function(e){e.preventDefault()},e.prototype.onButtonDown=function(e){},e.prototype.onButtonUp=function(e){},e.prototype.onLostFocus=function(){},c.c([Object(D.c)()],e.prototype,"buttons",void 0),e}(),tt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttons=[0,1,2],t.angularSensibilityX=1e3,t.angularSensibilityY=1e3,t.pinchPrecision=12,t.pinchDeltaPercentage=0,t.panningSensibility=1e3,t.multiTouchPanning=!0,t.multiTouchPanAndZoom=!0,t.pinchInwards=!0,t._isPanClick=!1,t._twoFingerActivityCount=0,t._isPinching=!1,t}return c.d(t,e),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,t,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,t,n,i,r,o){if(!(0===n&&null===r||0===i&&null===o)){var a=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.camera.inertialRadiusOffset+=this.pinchDeltaPercentage?.001*(i-n)*this.camera.radius*this.pinchDeltaPercentage:(i-n)/(this.pinchPrecision*a*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&r&&o){var s=o.x-r.x,l=o.y-r.y;this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}}else{this._twoFingerActivityCount++;var c=Math.sqrt(n),u=Math.sqrt(i);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(u-c)>this.camera.pinchToPanMaxDistance?(this.camera.inertialRadiusOffset+=this.pinchDeltaPercentage?.001*(i-n)*this.camera.radius*this.pinchDeltaPercentage:(i-n)/(this.pinchPrecision*a*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&o&&r&&(l=o.y-r.y,this.camera.inertialPanningX+=-(s=o.x-r.x)/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility)}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},c.c([Object(D.c)()],t.prototype,"buttons",void 0),c.c([Object(D.c)()],t.prototype,"angularSensibilityX",void 0),c.c([Object(D.c)()],t.prototype,"angularSensibilityY",void 0),c.c([Object(D.c)()],t.prototype,"pinchPrecision",void 0),c.c([Object(D.c)()],t.prototype,"pinchDeltaPercentage",void 0),c.c([Object(D.c)()],t.prototype,"panningSensibility",void 0),c.c([Object(D.c)()],t.prototype,"multiTouchPanning",void 0),c.c([Object(D.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(et);We.ArcRotateCameraPointersInput=tt;var nt=function(e){function t(t){return e.call(this,t)||this}return c.d(t,e),t.prototype.addMouseWheel=function(){return this.add(new $e),this},t.prototype.addPointers=function(){return this.add(new tt),this},t.prototype.addKeyboard=function(){return this.add(new Je),this},t}(Xe);nt.prototype.addVRDeviceOrientation=function(){return this.add(new it),this};var it=function(){function e(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){this.camera.attachControl(e,t),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){null!==e.alpha&&(this._alpha=(0|+e.alpha)*this.alphaCorrection),null!==e.gamma&&(this._gamma=(0|+e.gamma)*this.gammaCorrection),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();We.ArcRotateCameraVRDeviceOrientationInput=it;var rt=function(){function e(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var i,r=e.event;e.type===Ze.a.KEYDOWN?-1===n.keysForward.indexOf(r.keyCode)&&-1===n.keysBackward.indexOf(r.keyCode)&&-1===n.keysUp.indexOf(r.keyCode)&&-1===n.keysDown.indexOf(r.keyCode)&&-1===n.keysLeft.indexOf(r.keyCode)&&-1===n.keysRight.indexOf(r.keyCode)||(-1===(i=n._keys.indexOf(r.keyCode))&&n._keys.push(r.keyCode),t||r.preventDefault()):-1===n.keysForward.indexOf(r.keyCode)&&-1===n.keysBackward.indexOf(r.keyCode)&&-1===n.keysUp.indexOf(r.keyCode)&&-1===n.keysDown.indexOf(r.keyCode)&&-1===n.keysLeft.indexOf(r.keyCode)&&-1===n.keysRight.indexOf(r.keyCode)||((i=n._keys.indexOf(r.keyCode))>=0&&n._keys.splice(i,1),t||r.preventDefault())}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},e.prototype._onLostFocus=function(e){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t],i=e._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(n)?e._localDirection.copyFromFloats(0,0,i):-1!==this.keysBackward.indexOf(n)?e._localDirection.copyFromFloats(0,0,-i):-1!==this.keysUp.indexOf(n)?e._localDirection.copyFromFloats(0,i,0):-1!==this.keysDown.indexOf(n)?e._localDirection.copyFromFloats(0,-i,0):-1!==this.keysRight.indexOf(n)?e._localDirection.copyFromFloats(i,0,0):-1!==this.keysLeft.indexOf(n)&&e._localDirection.copyFromFloats(-i,0,0),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.x.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},c.c([Object(D.c)()],e.prototype,"keysForward",void 0),c.c([Object(D.c)()],e.prototype,"keysBackward",void 0),c.c([Object(D.c)()],e.prototype,"keysUp",void 0),c.c([Object(D.c)()],e.prototype,"keysDown",void 0),c.c([Object(D.c)()],e.prototype,"keysRight",void 0),c.c([Object(D.c)()],e.prototype,"keysLeft",void 0),e}();We.FlyCameraKeyboardInput=rt;var ot=function(){function e(e){void 0===e&&(e=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return e.prototype.attachControl=function(e,t){var n=this;this.element=e,this.noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(e,t){n._pointerInput(e,t)},Ae.a.POINTERDOWN|Ae.a.POINTERUP|Ae.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){n.camera.rollCorrect&&n.camera.restoreRoll(n.camera.rollCorrect)}),this._mousemoveCallback=function(e){n._onMouseMove(e)},e.addEventListener("mousemove",this._mousemoveCallback,!1)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&e.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},e.prototype.getClassName=function(){return"FlyCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},e.prototype._pointerInput=function(e,t){var n=e.event,i=this.camera.getEngine();if(!i.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==n.pointerType)&&(e.type===Ae.a.POINTERMOVE||-1!==this.buttons.indexOf(n.button))){var r=n.srcElement||n.target;if(e.type===Ae.a.POINTERDOWN&&r){try{r.setPointerCapture(n.pointerId)}catch(n){}this.previousPosition={x:n.clientX,y:n.clientY},this.activeButton=n.button,this.noPreventDefault||(n.preventDefault(),this.element.focus())}else if(e.type===Ae.a.POINTERUP&&r){try{r.releasePointerCapture(n.pointerId)}catch(n){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||n.preventDefault()}else if(e.type===Ae.a.POINTERMOVE){if(!this.previousPosition||i.isPointerLock)return;this.rotateCamera(n.clientX-this.previousPosition.x,n.clientY-this.previousPosition.y),this.previousPosition={x:n.clientX,y:n.clientY},this.noPreventDefault||n.preventDefault()}}},e.prototype._onMouseMove=function(e){var t=this.camera.getEngine();t.isPointerLock&&!t.isInVRExclusivePointerMode&&(this.rotateCamera(e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0),this.previousPosition=null,this.noPreventDefault||e.preventDefault())},e.prototype.rotateCamera=function(e,t){var n=this,i=this.camera;this.camera.getScene().useRightHandedSystem&&(e*=-1),i.parent&&i.parent._getWorldMatrixDeterminant()<0&&(e*=-1);var r,a=e/this.angularSensibility,s=t/this.angularSensibility,l=o.q.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z);if(this.buttonsPitch.some(function(e){return e===n.activeButton})&&(r=o.q.RotationAxis(o.c.X,s),l.multiplyInPlace(r)),this.buttonsYaw.some(function(e){return e===n.activeButton})){r=o.q.RotationAxis(o.c.Y,a),l.multiplyInPlace(r);var c=i.bankedTurnLimit+i._trackRoll;i.bankedTurn&&-c<i.rotation.z&&i.rotation.z<c&&(r=o.q.RotationAxis(o.c.Z,i.bankedTurnMultiplier*-a),l.multiplyInPlace(r))}this.buttonsRoll.some(function(e){return e===n.activeButton})&&(r=o.q.RotationAxis(o.c.Z,-a),i._trackRoll-=a,l.multiplyInPlace(r)),l.toEulerAnglesToRef(i.rotation)},c.c([Object(D.c)()],e.prototype,"buttons",void 0),c.c([Object(D.c)()],e.prototype,"angularSensibility",void 0),e}();We.FlyCameraMouseInput=ot;var at=function(){function e(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var i,r=e.event;r.metaKey||(e.type===Ze.a.KEYDOWN?(n._ctrlPressed=r.ctrlKey,n._altPressed=r.altKey,n._shiftPressed=r.shiftKey,(-1!==n.keysHeightOffsetIncr.indexOf(r.keyCode)||-1!==n.keysHeightOffsetDecr.indexOf(r.keyCode)||-1!==n.keysRotationOffsetIncr.indexOf(r.keyCode)||-1!==n.keysRotationOffsetDecr.indexOf(r.keyCode)||-1!==n.keysRadiusIncr.indexOf(r.keyCode)||-1!==n.keysRadiusDecr.indexOf(r.keyCode))&&(-1===(i=n._keys.indexOf(r.keyCode))&&n._keys.push(r.keyCode),r.preventDefault&&(t||r.preventDefault()))):-1===n.keysHeightOffsetIncr.indexOf(r.keyCode)&&-1===n.keysHeightOffsetDecr.indexOf(r.keyCode)&&-1===n.keysRotationOffsetIncr.indexOf(r.keyCode)&&-1===n.keysRotationOffsetDecr.indexOf(r.keyCode)&&-1===n.keysRadiusIncr.indexOf(r.keyCode)&&-1===n.keysRadiusDecr.indexOf(r.keyCode)||((i=n._keys.indexOf(r.keyCode))>=0&&n._keys.splice(i,1),r.preventDefault&&(t||r.preventDefault())))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){var e=this;this._onKeyboardObserver&&this._keys.forEach(function(t){-1!==e.keysHeightOffsetIncr.indexOf(t)&&e._modifierHeightOffset()?e.camera.heightOffset+=e.heightSensibility:-1!==e.keysHeightOffsetDecr.indexOf(t)&&e._modifierHeightOffset()?e.camera.heightOffset-=e.heightSensibility:-1!==e.keysRotationOffsetIncr.indexOf(t)&&e._modifierRotationOffset()?(e.camera.rotationOffset+=e.rotationSensibility,e.camera.rotationOffset%=360):-1!==e.keysRotationOffsetDecr.indexOf(t)&&e._modifierRotationOffset()?(e.camera.rotationOffset-=e.rotationSensibility,e.camera.rotationOffset%=360):-1!==e.keysRadiusIncr.indexOf(t)&&e._modifierRadius()?e.camera.radius+=e.radiusSensibility:-1!==e.keysRadiusDecr.indexOf(t)&&e._modifierRadius()&&(e.camera.radius-=e.radiusSensibility)})},e.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},e.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},e.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},c.c([Object(D.c)()],e.prototype,"keysHeightOffsetIncr",void 0),c.c([Object(D.c)()],e.prototype,"keysHeightOffsetDecr",void 0),c.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierAlt",void 0),c.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierCtrl",void 0),c.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierShift",void 0),c.c([Object(D.c)()],e.prototype,"keysRotationOffsetIncr",void 0),c.c([Object(D.c)()],e.prototype,"keysRotationOffsetDecr",void 0),c.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierAlt",void 0),c.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierCtrl",void 0),c.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierShift",void 0),c.c([Object(D.c)()],e.prototype,"keysRadiusIncr",void 0),c.c([Object(D.c)()],e.prototype,"keysRadiusDecr",void 0),c.c([Object(D.c)()],e.prototype,"keysRadiusModifierAlt",void 0),c.c([Object(D.c)()],e.prototype,"keysRadiusModifierCtrl",void 0),c.c([Object(D.c)()],e.prototype,"keysRadiusModifierShift",void 0),c.c([Object(D.c)()],e.prototype,"heightSensibility",void 0),c.c([Object(D.c)()],e.prototype,"rotationSensibility",void 0),c.c([Object(D.c)()],e.prototype,"radiusSensibility",void 0),e}();We.FollowCameraKeyboardMoveInput=at;var st=function(){function e(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.attachControl=function(e,t){var n=this;this._wheel=function(e,i){if(e.type===Ae.a.POINTERWHEEL){var r=e.event,o=0,a=Math.max(-1,Math.min(1,r.deltaY||r.wheelDelta||-r.detail));n.wheelDeltaPercentage?(console.assert(n.axisControlRadius+n.axisControlHeight+n.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+n.axisControlRadius+", axisControlHeightOffset: "+n.axisControlHeight+", axisControlRotationOffset: "+n.axisControlRotation),n.axisControlRadius?o=.01*a*n.wheelDeltaPercentage*n.camera.radius:n.axisControlHeight?o=.01*a*n.wheelDeltaPercentage*n.camera.heightOffset:n.axisControlRotation&&(o=.01*a*n.wheelDeltaPercentage*n.camera.rotationOffset)):o=a*n.wheelPrecision,o&&(n.axisControlRadius?n.camera.radius+=o:n.axisControlHeight?n.camera.heightOffset-=o:n.axisControlRotation&&(n.camera.rotationOffset-=o)),r.preventDefault&&(t||r.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Ae.a.POINTERWHEEL)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},c.c([Object(D.c)()],e.prototype,"axisControlRadius",void 0),c.c([Object(D.c)()],e.prototype,"axisControlHeight",void 0),c.c([Object(D.c)()],e.prototype,"axisControlRotation",void 0),c.c([Object(D.c)()],e.prototype,"wheelPrecision",void 0),c.c([Object(D.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();We.FollowCameraMouseWheelInput=st;var lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.angularSensibilityX=1,t.angularSensibilityY=1,t.pinchPrecision=1e4,t.pinchDeltaPercentage=0,t.axisXControlRadius=!1,t.axisXControlHeight=!1,t.axisXControlRotation=!0,t.axisYControlRadius=!1,t.axisYControlHeight=!0,t.axisYControlRotation=!1,t.axisPinchControlRadius=!0,t.axisPinchControlHeight=!1,t.axisPinchControlRotation=!1,t.warningEnable=!0,t._warningCounter=0,t}return c.d(t,e),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,t,n){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=t/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=n/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=t/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=n/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=t/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=n/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,t,n,i,r,o){if(!(0===n&&null===r||0===i&&null===o)){var a=(i-n)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(a*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=a*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=a*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=a*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=a),this.axisPinchControlHeight&&(this.camera.heightOffset+=a),this.axisPinchControlRadius&&(this.camera.radius-=a))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},c.c([Object(D.c)()],t.prototype,"angularSensibilityX",void 0),c.c([Object(D.c)()],t.prototype,"angularSensibilityY",void 0),c.c([Object(D.c)()],t.prototype,"pinchPrecision",void 0),c.c([Object(D.c)()],t.prototype,"pinchDeltaPercentage",void 0),c.c([Object(D.c)()],t.prototype,"axisXControlRadius",void 0),c.c([Object(D.c)()],t.prototype,"axisXControlHeight",void 0),c.c([Object(D.c)()],t.prototype,"axisXControlRotation",void 0),c.c([Object(D.c)()],t.prototype,"axisYControlRadius",void 0),c.c([Object(D.c)()],t.prototype,"axisYControlHeight",void 0),c.c([Object(D.c)()],t.prototype,"axisYControlRotation",void 0),c.c([Object(D.c)()],t.prototype,"axisPinchControlRadius",void 0),c.c([Object(D.c)()],t.prototype,"axisPinchControlHeight",void 0),c.c([Object(D.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(et);We.FollowCameraPointersInput=lt;var ct=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var i,r=e.event;r.metaKey||(e.type===Ze.a.KEYDOWN?-1===n.keysUp.indexOf(r.keyCode)&&-1===n.keysDown.indexOf(r.keyCode)&&-1===n.keysLeft.indexOf(r.keyCode)&&-1===n.keysRight.indexOf(r.keyCode)||(-1===(i=n._keys.indexOf(r.keyCode))&&n._keys.push(r.keyCode),t||r.preventDefault()):-1===n.keysUp.indexOf(r.keyCode)&&-1===n.keysDown.indexOf(r.keyCode)&&-1===n.keysLeft.indexOf(r.keyCode)&&-1===n.keysRight.indexOf(r.keyCode)||((i=n._keys.indexOf(r.keyCode))>=0&&n._keys.splice(i,1),t||r.preventDefault()))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t],i=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?e._localDirection.copyFromFloats(-i,0,0):-1!==this.keysUp.indexOf(n)?e._localDirection.copyFromFloats(0,0,i):-1!==this.keysRight.indexOf(n)?e._localDirection.copyFromFloats(i,0,0):-1!==this.keysDown.indexOf(n)&&e._localDirection.copyFromFloats(0,0,-i),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.x.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},e.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},e.prototype._onLostFocus=function(){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},c.c([Object(D.c)()],e.prototype,"keysUp",void 0),c.c([Object(D.c)()],e.prototype,"keysDown",void 0),c.c([Object(D.c)()],e.prototype,"keysLeft",void 0),c.c([Object(D.c)()],e.prototype,"keysRight",void 0),e}();We.FreeCameraKeyboardMoveInput=ct;var ut=function(){function e(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new r.c,this._allowCameraRotation=!0}return e.prototype.attachControl=function(e,t){var n=this,i=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(r){var o=r.event;if(!i.isInVRExclusivePointerMode&&(n.touchEnabled||"touch"!==o.pointerType)&&(r.type===Ae.a.POINTERMOVE||-1!==n.buttons.indexOf(o.button))){var a=o.srcElement||o.target;if(r.type===Ae.a.POINTERDOWN&&a){try{a.setPointerCapture(o.pointerId)}catch(e){}n.previousPosition={x:o.clientX,y:o.clientY},t||(o.preventDefault(),e.focus())}else if(r.type===Ae.a.POINTERUP&&a){try{a.releasePointerCapture(o.pointerId)}catch(e){}n.previousPosition=null,t||o.preventDefault()}else if(r.type===Ae.a.POINTERMOVE){if(!n.previousPosition||i.isPointerLock)return;var s=o.clientX-n.previousPosition.x,l=o.clientY-n.previousPosition.y;n.camera.getScene().useRightHandedSystem&&(s*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),n._allowCameraRotation&&(n.camera.cameraRotation.y+=s/n.angularSensibility,n.camera.cameraRotation.x+=l/n.angularSensibility),n.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:l}),n.previousPosition={x:o.clientX,y:o.clientY},t||o.preventDefault()}}}),this._onMouseMove=function(e){if(i.isPointerLock&&!i.isInVRExclusivePointerMode){var r=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0;n.camera.getScene().useRightHandedSystem&&(r*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(r*=-1),n.camera.cameraRotation.y+=r/n.angularSensibility,n.camera.cameraRotation.x+=(e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0)/n.angularSensibility,n.previousPosition=null,t||e.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ae.a.POINTERDOWN|Ae.a.POINTERUP|Ae.a.POINTERMOVE),e.addEventListener("mousemove",this._onMouseMove,!1),e.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},e.prototype.onContextMenu=function(e){e.preventDefault()},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},e.prototype.getClassName=function(){return"FreeCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},c.c([Object(D.c)()],e.prototype,"buttons",void 0),c.c([Object(D.c)()],e.prototype,"angularSensibility",void 0),e}();We.FreeCameraMouseInput=ut;var ht=function(){function e(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return e.prototype.attachControl=function(e,t){var n=this,i=null;void 0===this._pointerInput&&(this._onLostFocus=function(){n._offsetX=null,n._offsetY=null},this._pointerInput=function(e){var r=e.event;if("mouse"!==r.pointerType)if(e.type===Ae.a.POINTERDOWN){if(t||r.preventDefault(),n._pointerPressed.push(r.pointerId),1!==n._pointerPressed.length)return;i={x:r.clientX,y:r.clientY}}else if(e.type===Ae.a.POINTERUP){if(t||r.preventDefault(),-1===(o=n._pointerPressed.indexOf(r.pointerId)))return;if(n._pointerPressed.splice(o,1),0!=o)return;i=null,n._offsetX=null,n._offsetY=null}else if(e.type===Ae.a.POINTERMOVE){if(t||r.preventDefault(),!i)return;var o;if(0!=(o=n._pointerPressed.indexOf(r.pointerId)))return;n._offsetX=r.clientX-i.x,n._offsetY=-(r.clientY-i.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Ae.a.POINTERDOWN|Ae.a.POINTERUP|Ae.a.POINTERMOVE),this._onLostFocus&&e.addEventListener("blur",this._onLostFocus)},e.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},e.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var e=this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var t=e._computeLocalCameraSpeed(),n=new o.x(0,0,t*this._offsetY/this.touchMoveSensibility);o.j.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(o.x.TransformCoordinates(n,e._cameraRotationMatrix))}}},e.prototype.getClassName=function(){return"FreeCameraTouchInput"},e.prototype.getSimpleName=function(){return"touch"},c.c([Object(D.c)()],e.prototype,"touchAngularSensibility",void 0),c.c([Object(D.c)()],e.prototype,"touchMoveSensibility",void 0),e}();We.FreeCameraTouchInput=ht;var dt=function(e){function t(t){var n=e.call(this,t)||this;return n._mouseInput=null,n}return c.d(t,e),t.prototype.addKeyboard=function(){return this.add(new ct),this},t.prototype.addMouse=function(e){return void 0===e&&(e=!0),this._mouseInput||(this._mouseInput=new ut(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addTouch=function(){return this.add(new ht),this},t.prototype.clear=function(){e.prototype.clear.call(this),this._mouseInput=null},t}(Xe);dt.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new ft,this.add(this._deviceOrientationInput)),this};var ft=function(){function e(){var e=this;this._screenOrientationAngle=0,this._screenQuaternion=new o.q,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new r.c,this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,e._screenOrientationAngle=-be.h.ToRadians(e._screenOrientationAngle/2),e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),0,Math.cos(e._screenOrientationAngle))},this._deviceOrientation=function(t){e._alpha=null!==t.alpha?t.alpha:0,e._beta=null!==t.beta?t.beta:0,e._gamma=null!==t.gamma?t.gamma:0,null!==t.alpha&&e._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new o.q(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(e){var t=this;this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new o.q),this._camera&&this._camera.onDisposeObservable.add(function(){t._onDeviceOrientationChangedObservable.clear()})},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},e.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},e.prototype.checkInputs=function(){this._alpha&&(o.q.RotationYawPitchRollToRef(be.h.ToRadians(this._alpha),be.h.ToRadians(this._beta),-be.h.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();We.FreeCameraDeviceOrientationInput=ft;var pt=function(){function e(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=o.j.Identity(),this._deltaTransform=o.x.Zero(),this._vector3=o.x.Zero(),this._vector2=o.w.Zero()}return e.prototype.attachControl=function(e,t){var n=this,i=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=i.onGamepadConnectedObservable.add(function(e){e.type!==Ke.POSE_ENABLED&&(n.gamepad&&e.type!==Ke.XBOX||(n.gamepad=e))}),this._onGamepadDisconnectedObserver=i.onGamepadDisconnectedObservable.add(function(e){n.gamepad===e&&(n.gamepad=null)}),this.gamepad=i.getGamepadByType(Ke.XBOX)},e.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var e=this.camera,t=this.gamepad.leftStick,n=t.x/this.gamepadMoveSensibility,i=t.y/this.gamepadMoveSensibility;t.x=Math.abs(n)>.005?0+n:0,t.y=Math.abs(i)>.005?0+i:0;var r=this.gamepad.rightStick;if(r){var a=r.x/this.gamepadAngularSensibility,s=r.y/this.gamepadAngularSensibility;r.x=Math.abs(a)>.001?0+a:0,r.y=Math.abs(s)>.001?0+s:0}else r={x:0,y:0};e.rotationQuaternion?e.rotationQuaternion.toRotationMatrix(this._cameraTransform):o.j.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,this._cameraTransform);var l=50*e._computeLocalCameraSpeed();this._vector3.copyFromFloats(t.x*l,0,-t.y*l),o.x.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),e.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(r.y,r.x),e.cameraRotation.addInPlace(this._vector2)}},e.prototype.getClassName=function(){return"FreeCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},c.c([Object(D.c)()],e.prototype,"gamepadAngularSensibility",void 0),c.c([Object(D.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();We.FreeCameraGamepadInput=pt;var gt,mt=n(61);!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(gt||(gt={}));var _t=function(){function e(t){var n=this;if(this._leftJoystick=!!t,e._globalJoystickIndex++,this._axisTargetedByLeftAndRight=gt.X,this._axisTargetedByUpAndDown=gt.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new mt.a,this.deltaPosition=o.x.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(t){e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas&&(e.Canvas.width=e.vjCanvasWidth,e.Canvas.height=e.vjCanvasHeight),e.halfWidth=e.vjCanvasWidth/2},!e.Canvas){window.addEventListener("resize",this._onResize,!1),e.Canvas=document.createElement("canvas"),e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas.width=window.innerWidth,e.Canvas.height=window.innerHeight,e.Canvas.style.width="100%",e.Canvas.style.height="100%",e.Canvas.style.position="absolute",e.Canvas.style.backgroundColor="transparent",e.Canvas.style.top="0px",e.Canvas.style.left="0px",e.Canvas.style.zIndex="5",e.Canvas.style.msTouchAction="none",e.Canvas.setAttribute("touch-action","none");var i=e.Canvas.getContext("2d");if(!i)throw new Error("Unable to create canvas for virtual joystick");(e.vjCanvasContext=i).strokeStyle="#ffffff",e.vjCanvasContext.lineWidth=2,document.body.appendChild(e.Canvas)}e.halfWidth=e.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new o.w(0,0),this._joystickPreviousPointerPos=new o.w(0,0),this._joystickPointerStartPos=new o.w(0,0),this._deltaJoystickVector=new o.w(0,0),this._onPointerDownHandlerRef=function(e){n._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){n._onPointerMove(e)},this._onPointerUpHandlerRef=function(e){n._onPointerUp(e)},e.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),e.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),e.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return e.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},e.prototype._onPointerDown=function(t){t.preventDefault(),(!0===this._leftJoystick?t.clientX<e.halfWidth:t.clientX>e.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):e._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},e.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var t=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case gt.X:this.deltaPosition.x=Math.min(1,Math.max(-1,t));break;case gt.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,t));break;case gt.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,t))}var n=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case gt.X:this.deltaPosition.x=Math.min(1,Math.max(-1,n));break;case gt.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,n));break;case gt.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,n))}}else{var i=this._touches.get(e.pointerId.toString());i&&(i.x=e.clientX,i.y=e.clientY)}},e.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)e.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var n=this._touches.get(t.pointerId.toString());n&&e.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},e.prototype.setJoystickColor=function(e){this._joystickColor=e},e.prototype.setActionOnTouch=function(e){this._action=e},e.prototype.setAxisForLeftRight=function(e){switch(e){case gt.X:case gt.Y:case gt.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=gt.X}},e.prototype.setAxisForUpDown=function(e){switch(e){case gt.X:case gt.Y:case gt.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=gt.Y}},e.prototype._drawVirtualJoystick=function(){var t=this;this.pressed&&this._touches.forEach(function(n,i){i.pointerId===t._joystickPointerID?(e.vjCanvasContext.clearRect(t._joystickPointerStartPos.x-64,t._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(t._joystickPreviousPointerPos.x-42,t._joystickPreviousPointerPos.y-42,84,84),e.vjCanvasContext.beginPath(),e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.lineWidth=2,e.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,60,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.arc(t._joystickPointerPos.x,t._joystickPointerPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(e.vjCanvasContext.clearRect(i.prevX-44,i.prevY-44,88,88),e.vjCanvasContext.beginPath(),e.vjCanvasContext.fillStyle="white",e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle="red",e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.arc(i.x,i.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),i.prevX=i.x,i.prevY=i.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},e.prototype.releaseCanvas=function(){e.Canvas&&(e.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),e.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),e.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),e.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(e.Canvas),e.Canvas=null)},e._globalJoystickIndex=0,e}();dt.prototype.addVirtualJoystick=function(){return this.add(new vt),this};var vt=function(){function e(){}return e.prototype.getLeftJoystick=function(){return this._leftjoystick},e.prototype.getRightJoystick=function(){return this._rightjoystick},e.prototype.checkInputs=function(){if(this._leftjoystick){var e=this.camera,t=50*e._computeLocalCameraSpeed(),n=o.j.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0),i=o.x.TransformCoordinates(new o.x(this._leftjoystick.deltaPosition.x*t,this._leftjoystick.deltaPosition.y*t,this._leftjoystick.deltaPosition.z*t),n);e.cameraDirection=e.cameraDirection.add(i),e.cameraRotation=e.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},e.prototype.attachControl=function(e,t){this._leftjoystick=new _t(!0),this._leftjoystick.setAxisForUpDown(gt.Z),this._leftjoystick.setAxisForLeftRight(gt.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new _t(!1),this._rightjoystick.setAxisForUpDown(gt.X),this._rightjoystick.setAxisForLeftRight(gt.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},e.prototype.detachControl=function(e){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},e.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},e.prototype.getSimpleName=function(){return"virtualJoystick"},e}();We.FreeCameraVirtualJoystickInput=vt;var bt=function(e){function t(t,n,i,r){void 0===r&&(r=!0);var a=e.call(this,t,n,i,r)||this;return a.cameraDirection=new o.x(0,0,0),a.cameraRotation=new o.w(0,0),a.updateUpVectorFromRotation=!1,a._tmpQuaternion=new o.q,a.rotation=new o.x(0,0,0),a.speed=2,a.noRotationConstraint=!1,a.lockedTarget=null,a._currentTarget=o.x.Zero(),a._initialFocalDistance=1,a._viewMatrix=o.j.Zero(),a._camMatrix=o.j.Zero(),a._cameraTransformMatrix=o.j.Zero(),a._cameraRotationMatrix=o.j.Zero(),a._referencePoint=new o.x(0,0,1),a._transformedReferencePoint=o.x.Zero(),a._globalCurrentTarget=o.x.Zero(),a._globalCurrentUpVector=o.x.Zero(),a._defaultUp=o.x.Up(),a._cachedRotationZ=0,a._cachedQuaternionRotationZ=0,a}return c.d(t,e),t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),e.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.lockedTarget=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this);var n=this._getLockedTargetPosition();n?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(n):this._cache.lockedTarget=n.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=o.h),o.j.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);this.rotation.y=t.x>=0?-Math.atan(t.z/t.x)+Math.PI/2:-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.t.Matrix[0]),o.x.TransformNormalToRef(this.cameraDirection,o.t.Matrix[0],o.t.Vector3[0]),void this.position.addInPlace(o.t.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var t=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),n&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion&&this.rotation.lengthSquared()&&o.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),!this.noRotationConstraint)){var i=Math.PI/2*.95;this.rotation.x>i&&(this.rotation.x=i),this.rotation.x<-i&&(this.rotation.x=-i)}t&&(Math.abs(this.cameraDirection.x)<this.speed*o.h&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*o.h&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*o.h&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*o.h&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*o.h&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),e.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.j.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return o.x.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?o.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o.q.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),o.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,t,n){if(this.parent){var i=this.parent.getWorldMatrix();o.x.TransformCoordinatesToRef(e,i,this._globalPosition),o.x.TransformCoordinatesToRef(t,i,this._globalCurrentTarget),o.x.TransformNormalToRef(n,i,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._globalCurrentTarget.copyFrom(t),this._globalCurrentUpVector.copyFrom(n);this.getScene().useRightHandedSystem?o.j.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):o.j.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},t.prototype.createRigCamera=function(e,n){if(this.cameraRigMode!==Ne.a.RIG_MODE_NONE){var i=new t(e,this.position.clone(),this.getScene());return this.cameraRigMode!==Ne.a.RIG_MODE_VR&&this.cameraRigMode!==Ne.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new o.q),i._cameraRigParams={},i.rotationQuaternion=new o.q),i}return null},t.prototype._updateRigCameras=function(){var t=this._rigCameras[0],n=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:var i=this.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*(this.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1),t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,n);break;case Ne.a.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),n.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),n.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,n){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=t._TargetFocalPoint.addInPlace(this.position);o.j.TranslationToRef(-i.x,-i.y,-i.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(o.j.RotationY(e),t._RigCamTransformMatrix),o.j.TranslationToRef(i.x,i.y,i.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),o.x.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,n.position),n.setTarget(i)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new o.j,t._TargetTransformMatrix=new o.j,t._TargetFocalPoint=new o.x,c.c([Object(D.o)()],t.prototype,"rotation",void 0),c.c([Object(D.c)()],t.prototype,"speed",void 0),c.c([Object(D.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Ne.a),yt=function(e){function t(t,n,i,r){void 0===r&&(r=!0);var a=e.call(this,t,n,i,r)||this;return a.ellipsoid=new o.x(.5,1,.5),a.ellipsoidOffset=new o.x(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=o.x.Zero(),a._diffPosition=o.x.Zero(),a._newPosition=o.x.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),a._newPosition.copyFrom(t),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>me.b.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&n&&a.onCollide(n))},a.inputs=new dt(a),a.inputs.addKeyboard().addMouse(),a}return c.d(t,e),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new o.x(0,0,0),this.cameraRotation=new o.w(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?o.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var n=e;this.applyGravity&&(n=e.add(this.getScene().gravity)),t.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},c.c([Object(D.o)()],t.prototype,"ellipsoid",void 0),c.c([Object(D.o)()],t.prototype,"ellipsoidOffset",void 0),c.c([Object(D.c)()],t.prototype,"checkCollisions",void 0),c.c([Object(D.c)()],t.prototype,"applyGravity",void 0),t}(bt);k.a.AddNodeConstructor("TouchCamera",function(e,t){return function(){return new Tt(e,o.x.Zero(),t)}});var Tt=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.inputs.addTouch(),r._setupInputs(),r}return c.d(t,e),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},t}(yt);k.a.AddNodeConstructor("ArcRotateCamera",function(e,t){return function(){return new Et(e,0,0,1,o.x.Zero(),t)}});var Et=function(e){function t(t,n,i,a,s,l,c){void 0===c&&(c=!0);var u=e.call(this,t,o.x.Zero(),l,c)||this;return u._upVector=o.x.Up(),u.inertialAlphaOffset=0,u.inertialBetaOffset=0,u.inertialRadiusOffset=0,u.lowerAlphaLimit=null,u.upperAlphaLimit=null,u.lowerBetaLimit=.01,u.upperBetaLimit=Math.PI-.01,u.lowerRadiusLimit=null,u.upperRadiusLimit=null,u.inertialPanningX=0,u.inertialPanningY=0,u.pinchToPanMaxDistance=20,u.panningDistanceLimit=null,u.panningOriginTarget=o.x.Zero(),u.panningInertia=.9,u.zoomOnFactor=1,u.targetScreenOffset=o.w.Zero(),u.allowUpsideDown=!0,u.useInputToRestoreState=!0,u._viewMatrix=new o.j,u.panningAxis=new o.x(1,1,0),u.onMeshTargetChangedObservable=new r.c,u.checkCollisions=!1,u.collisionRadius=new o.x(.5,.5,.5),u._previousPosition=o.x.Zero(),u._collisionVelocity=o.x.Zero(),u._newPosition=o.x.Zero(),u._computationVector=o.x.Zero(),u._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),n?(u.setPosition(t),u.onCollide&&u.onCollide(n)):u._previousPosition.copyFrom(u._position);var i=Math.cos(u.alpha),r=Math.sin(u.alpha),o=Math.cos(u.beta),a=Math.sin(u.beta);0===a&&(a=1e-4);var s=u._getTargetPosition();u._computationVector.copyFromFloats(u.radius*i*a,u.radius*o,u.radius*r*a),s.addToRef(u._computationVector,u._newPosition),u._position.copyFrom(u._newPosition);var l=u.upVector;u.allowUpsideDown&&u.beta<0&&(l=(l=l.clone()).negate()),u._computeViewMatrix(u._position,s,l),u._viewMatrix.addAtIndex(12,u.targetScreenOffset.x),u._viewMatrix.addAtIndex(13,u.targetScreenOffset.y),u._collisionTriggered=!1},u._target=o.x.Zero(),s&&u.setTarget(s),u.alpha=n,u.beta=i,u.radius=a,u.getViewMatrix(),u.inputs=new nt(u),u.inputs.addKeyboard().addMouseWheel().addPointers(),u}return c.d(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new o.j,this._upToYMatrix=new o.j,this._upVector=o.x.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!0,configurable:!0}),t.prototype.setMatUp=function(){o.j.RotationAlignToRef(o.x.UpReadOnly,this._upVector,this._YToUpMatrix),o.j.RotationAlignToRef(this._upVector,o.x.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Re,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Me,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Pe,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache._target=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=o.w.Zero()},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}return this._getLockedTargetPosition()||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),e.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(e,t,n,i){var r=this;void 0===n&&(n=!0),void 0===i&&(i=2),this._useCtrlForPanning=n,this._panningMouseButton=i,this.inputs.attachElement(e,t),this._reset=function(){r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.inertialPanningX=0,r.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<o.h&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<o.h&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*o.h&&(this.inertialRadiusOffset=0)}0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),o.x.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),o.x.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*o.h&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*o.h&&(this.inertialPanningY=0)),this._checkLimits(),e.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){null==this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null==this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.x.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),this.alpha=0===this._computationVector.x&&0===this._computationVector.z?Math.PI/2:Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var i=e,r=this._getTargetPosition();if(r&&!n&&r.equals(i))return;this._targetHost=null,this._target=i,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),n=Math.cos(this.beta),i=Math.sin(this.beta);0===i&&(i=1e-4);var r=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*i,this.radius*n,this.radius*t*i),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.x.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),r.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&i<0&&(s=(s=s.clone()).negate()),this._computeViewMatrix(this._position,r,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=r,this._viewMatrix},t.prototype.zoomOn=function(e,t){void 0===t&&(t=!1),e=e||this.getScene().meshes;var n=fe.a.MinMax(e),i=o.x.Distance(n.min,n.max);this.radius=i*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:i},t)},t.prototype.focusOn=function(e,t){var n,i;if(void 0===t&&(t=!1),void 0===e.min){var r=e||this.getScene().meshes;n=fe.a.MinMax(r),i=o.x.Distance(n.min,n.max)}else n=e,i=e.distance;this._target=fe.a.Center(n),t||(this.maxZ=2*i)},t.prototype.createRigCamera=function(e,n){var i=0;switch(this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ne.a.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===n?1:-1);break;case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===n?-1:1)}var r=new t(e,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return r._cameraRigParams={},r},t.prototype._updateRigCameras=function(){var t=this._rigCameras[0],n=this._rigCameras[1];switch(t.beta=n.beta=this.beta,this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ne.a.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},c.c([Object(D.c)()],t.prototype,"alpha",void 0),c.c([Object(D.c)()],t.prototype,"beta",void 0),c.c([Object(D.c)()],t.prototype,"radius",void 0),c.c([Object(D.o)("target")],t.prototype,"_target",void 0),c.c([Object(D.o)("upVector")],t.prototype,"_upVector",void 0),c.c([Object(D.c)()],t.prototype,"inertialAlphaOffset",void 0),c.c([Object(D.c)()],t.prototype,"inertialBetaOffset",void 0),c.c([Object(D.c)()],t.prototype,"inertialRadiusOffset",void 0),c.c([Object(D.c)()],t.prototype,"lowerAlphaLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperAlphaLimit",void 0),c.c([Object(D.c)()],t.prototype,"lowerBetaLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperBetaLimit",void 0),c.c([Object(D.c)()],t.prototype,"lowerRadiusLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperRadiusLimit",void 0),c.c([Object(D.c)()],t.prototype,"inertialPanningX",void 0),c.c([Object(D.c)()],t.prototype,"inertialPanningY",void 0),c.c([Object(D.c)()],t.prototype,"pinchToPanMaxDistance",void 0),c.c([Object(D.c)()],t.prototype,"panningDistanceLimit",void 0),c.c([Object(D.o)()],t.prototype,"panningOriginTarget",void 0),c.c([Object(D.c)()],t.prototype,"panningInertia",void 0),c.c([Object(D.c)()],t.prototype,"zoomOnFactor",void 0),c.c([Object(D.c)()],t.prototype,"targetScreenOffset",void 0),c.c([Object(D.c)()],t.prototype,"allowUpsideDown",void 0),c.c([Object(D.c)()],t.prototype,"useInputToRestoreState",void 0),t}(bt);k.a.AddNodeConstructor("DeviceOrientationCamera",function(e,t){return function(){return new xt(e,o.x.Zero(),t)}});var xt=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r._tmpDragQuaternion=new o.q,r._disablePointerInputWhenUsingDeviceOrientation=!0,r._dragFactor=0,r._quaternionCache=new o.q,r.inputs.addDeviceOrientation(),r.inputs._deviceOrientationInput&&r.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){r._disablePointerInputWhenUsingDeviceOrientation&&r.inputs._mouseInput&&(r.inputs._mouseInput._allowCameraRotation=!1,r.inputs._mouseInput.onPointerMovedObservable.add(function(e){0!=r._dragFactor&&(r._initialQuaternion||(r._initialQuaternion=new o.q),o.q.FromEulerAnglesToRef(0,e.offsetX*r._dragFactor,0,r._tmpDragQuaternion),r._initialQuaternion.multiplyToRef(r._tmpDragQuaternion,r._initialQuaternion))}))}),r}return c.d(t,e),t.prototype.enableHorizontalDragging=function(e){void 0===e&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var t=this;void 0===e&&(e=o.c.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new o.q),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(n){e[n]?t._initialQuaternion[n]*=-1:t._initialQuaternion[n]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(yt),Ct=function(e){function t(t){return e.call(this,t)||this}return c.d(t,e),t.prototype.addKeyboard=function(){return this.add(new rt),this},t.prototype.addMouse=function(e){return void 0===e&&(e=!0),this.add(new ot(e)),this},t}(Xe),St=function(e){function t(t,n,i,r){void 0===r&&(r=!0);var a=e.call(this,t,n,i,r)||this;return a.ellipsoid=new o.x(1,1,1),a.ellipsoidOffset=new o.x(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a.cameraDirection=o.x.Zero(),a._trackRoll=0,a.rollCorrect=100,a.bankedTurn=!1,a.bankedTurnLimit=Math.PI/2,a.bankedTurnMultiplier=1,a._needMoveForGravity=!1,a._oldPosition=o.x.Zero(),a._diffPosition=o.x.Zero(),a._newPosition=o.x.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),a._newPosition.copyFrom(t),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>me.b.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&n&&a.onCollide(n))},a.inputs=new Ct(a),a.inputs.addKeyboard().addMouse(),a}return c.d(t,e),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysForward=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysBackward=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new o.x(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?o.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var n=e;this.applyGravity&&(n=e.add(this.getScene().gravity)),t.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var t=this._trackRoll,n=t-this.rotation.z;Math.abs(n)>=.001&&(this.rotation.z+=n/e,Math.abs(t-this.rotation.z)<=.001&&(this.rotation.z=t))},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},c.c([Object(D.o)()],t.prototype,"ellipsoid",void 0),c.c([Object(D.o)()],t.prototype,"ellipsoidOffset",void 0),c.c([Object(D.c)()],t.prototype,"checkCollisions",void 0),c.c([Object(D.c)()],t.prototype,"applyGravity",void 0),t}(bt),At=function(e){function t(t){return e.call(this,t)||this}return c.d(t,e),t.prototype.addKeyboard=function(){return this.add(new at),this},t.prototype.addMouseWheel=function(){return this.add(new st),this},t.prototype.addPointers=function(){return this.add(new lt),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(Xe);k.a.AddNodeConstructor("FollowCamera",function(e,t){return function(){return new Rt(e,o.x.Zero(),t)}}),k.a.AddNodeConstructor("ArcFollowCamera",function(e,t){return function(){return new Mt(e,0,0,1,null,t)}});var Pt,Rt=function(e){function t(t,n,i,r){void 0===r&&(r=null);var o=e.call(this,t,n,i)||this;return o.radius=12,o.lowerRadiusLimit=null,o.upperRadiusLimit=null,o.rotationOffset=0,o.lowerRotationOffsetLimit=null,o.upperRotationOffsetLimit=null,o.heightOffset=4,o.lowerHeightOffsetLimit=null,o.upperHeightOffsetLimit=null,o.cameraAcceleration=.05,o.maxCameraSpeed=20,o.lockedTarget=r,o.inputs=new At(o),o.inputs.addKeyboard().addMouseWheel().addPointers(),o}return c.d(t,e),t.prototype._follow=function(e){if(e){var t;if(e.rotationQuaternion){var n=new o.j;e.rotationQuaternion.toRotationMatrix(n),t=Math.atan2(n.m[8],n.m[10])}else t=e.rotation.y;var i=be.h.ToRadians(this.rotationOffset)+t,r=e.getAbsolutePosition(),a=r.x+Math.sin(i)*this.radius,s=r.z+Math.cos(i)*this.radius,l=(a-this.position.x)*this.cameraAcceleration*2,c=(r.y+this.heightOffset-this.position.y)*this.cameraAcceleration,u=(s-this.position.z)*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=l<1?-this.maxCameraSpeed:this.maxCameraSpeed),(c>this.maxCameraSpeed||c<-this.maxCameraSpeed)&&(c=c<1?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=u<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new o.x(this.position.x+l,this.position.y+c,this.position.z+u),this.setTarget(r)}},t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t),this._reset=function(){}},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),e.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},c.c([Object(D.c)()],t.prototype,"radius",void 0),c.c([Object(D.c)()],t.prototype,"lowerRadiusLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperRadiusLimit",void 0),c.c([Object(D.c)()],t.prototype,"rotationOffset",void 0),c.c([Object(D.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperRotationOffsetLimit",void 0),c.c([Object(D.c)()],t.prototype,"heightOffset",void 0),c.c([Object(D.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),c.c([Object(D.c)()],t.prototype,"upperHeightOffsetLimit",void 0),c.c([Object(D.c)()],t.prototype,"cameraAcceleration",void 0),c.c([Object(D.c)()],t.prototype,"maxCameraSpeed",void 0),c.c([Object(D.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(bt),Mt=function(e){function t(t,n,i,r,a,s){var l=e.call(this,t,o.x.Zero(),s)||this;return l.alpha=n,l.beta=i,l.radius=r,l.target=a,l._cartesianCoordinates=o.x.Zero(),l._follow(),l}return c.d(t,e),t.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this.target.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(bt),Ot=n(35),wt=n(39);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(Pt||(Pt={}));var It,Dt,Lt=function(){function e(){}return e.InitiateController=function(e){for(var t=0,n=this._ControllerFactories;t<n.length;t++){var i=n[t];if(i.canCreate(e))return i.create(e)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(e);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),kt=function(e){function t(t){var n=e.call(this,t.id,t.index,t)||this;return n._deviceRoomPosition=o.x.Zero(),n._deviceRoomRotationQuaternion=new o.q,n.devicePosition=o.x.Zero(),n.deviceRotationQuaternion=new o.q,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new o.q,n._deviceToWorld=o.j.Identity(),n._pointingPoseNode=null,n._workingMatrix=o.j.Identity(),n._meshAttachedObservable=new r.c,n.type=Ke.POSE_ENABLED,n.controllerType=Pt.GENERIC,n.position=o.x.Zero(),n.rotationQuaternion=new o.q,n._calculatedPosition=o.x.Zero(),n._calculatedRotation=new o.q,o.q.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return c.d(t,e),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(this.updateFromDevice(this.browserGamepad.pose),!this._trackPosition&&A.a.LastCreatedScene&&A.a.LastCreatedScene.activeCamera&&A.a.LastCreatedScene.activeCamera.devicePosition&&((e=A.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(e.devicePosition),e.deviceRotationQuaternion)){var e;(e=e)._deviceRoomRotationQuaternion.toEulerAnglesToRef(o.t.Vector3[0]);var t=Math.atan2(Math.sin(o.t.Vector3[0].y-this._draggedRoomRotation),Math.cos(o.t.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(t)>this._maxRotationDistFromHeadset){var n=t-(t<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=n;var i=Math.sin(-n),r=Math.cos(-n);this._calculatedPosition.x=this._calculatedPosition.x*r-this._calculatedPosition.z*i,this._calculatedPosition.z=this._calculatedPosition.x*i+this._calculatedPosition.z*r}}o.x.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),o.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},t.prototype.updateFromDevice=function(e){if(e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new o.q),this._updatePoseAndMesh(),this._pointingPoseNode){for(var t=[],n=this._pointingPoseNode;n.parent;)t.push(n.parent),n=n.parent;t.reverse().forEach(function(e){e.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(e){if(void 0===e&&(e=100),!this.mesh)return new wt.a(o.x.Zero(),new o.x(0,0,1),e);var t=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),n=t.getTranslation(),i=new o.x(0,0,-1),r=o.x.TransformNormal(i,t),a=o.x.Normalize(r);return new wt.a(n,a,e)},t.POINTING_POSE="POINTING_POSE",t}(Ke);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(It||(It={})),function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(Dt||(Dt={}));var Nt=function(e){function t(t,n,i,o){void 0===o&&(o=!1);var a=e.call(this,t,n,i,0,1,2,3)||this;return a._leftTrigger=0,a._rightTrigger=0,a.onButtonDownObservable=new r.c,a.onButtonUpObservable=new r.c,a.onPadDownObservable=new r.c,a.onPadUpObservable=new r.c,a._buttonA=0,a._buttonB=0,a._buttonX=0,a._buttonY=0,a._buttonBack=0,a._buttonStart=0,a._buttonLB=0,a._buttonRB=0,a._buttonLeftStick=0,a._buttonRightStick=0,a._dPadUp=0,a._dPadDown=0,a._dPadLeft=0,a._dPadRight=0,a._isXboxOnePad=!1,a.type=Ke.XBOX,a._isXboxOnePad=o,a}return c.d(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,n){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(n),this.onButtonDownObservable.notifyObservers(n)),0===e&&(this._onbuttonup&&this._onbuttonup(n),this.onButtonUpObservable.notifyObservers(n))),e},t.prototype._setDPadValue=function(e,t,n){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(n),this.onPadDownObservable.notifyObservers(n)),0===e&&(this._ondpadup&&this._ondpadup(n),this.onPadUpObservable.notifyObservers(n))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,It.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,It.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,It.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,It.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,It.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,It.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,It.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,It.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,It.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,It.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Dt.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Dt.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Dt.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Dt.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Ke),Ft=function(){function e(e){var t=this;this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new r.c,Ot.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new r.c(function(e){for(var n in t._babylonGamepads){var i=t._babylonGamepads[n];i&&i._isConnected&&t.onGamepadConnectedObservable.notifyObserver(e,i)}}),this._onGamepadConnectedEvent=function(e){var n,i=e.gamepad;i.index in t._babylonGamepads&&t._babylonGamepads[i.index].isConnected||(t._babylonGamepads[i.index]?((n=t._babylonGamepads[i.index]).browserGamepad=i,n._isConnected=!0):n=t._addNewGamepad(i),t.onGamepadConnectedObservable.notifyObservers(n),t._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var n=e.gamepad;for(var i in t._babylonGamepads)if(t._babylonGamepads[i].index===n.index){var r=t._babylonGamepads[i];r._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(r);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(e){void 0===e&&(e=Ke.XBOX);for(var t=0,n=this._babylonGamepads;t<n.length;t++){var i=n[t];if(i&&i.type===e)return i}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(e){var t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=-1!==e.id.search("Xbox One");return t=n||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")?new Nt(e.id,e.index,e,n):e.pose?Lt.InitiateController(e):new Qe(e.id,e.index,e),this._babylonGamepads[t.index]=t,t},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;for(var t in this._updateGamepadObjects(),this._babylonGamepads){var n=this._babylonGamepads[t];n&&n.isConnected&&n.update()}this._isMonitoring&&!this._scene&&be.h.QueueNewFrame(function(){e._checkGamepadsStatus()})},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var n=e[t];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[t].browserGamepad=n,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var i=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(i)}}},e}();Object.defineProperty(W.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new Ft(this);var e=this._getComponent(xe.a.NAME_GAMEPAD);e||(e=new Bt(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),dt.prototype.addGamepad=function(){return this.add(new pt),this},nt.prototype.addGamepad=function(){return this.add(new qe),this};var Bt=function(){function e(e){this.name=xe.a.NAME_GAMEPAD,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(xe.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},e}();k.a.AddNodeConstructor("FreeCamera",function(e,t){return function(){return new Ut(e,o.x.Zero(),t)}});var Ut=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.inputs.addGamepad(),r}return c.d(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Tt);Ne.a._createDefaultParsedCamera=function(e,t){return new Ut(e,o.x.Zero(),t)},k.a.AddNodeConstructor("GamepadCamera",function(e,t){return function(){return new Vt(e,o.x.Zero(),t)}});var Vt=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return c.d(t,e),t.prototype.getClassName=function(){return"GamepadCamera"},t}(Ut),Gt=n(28),zt=n(5);zt.a.ShadersStore.postprocessVertexShader="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";var jt=function(){function e(e,t,n,i,a,s,l,c,u,h,d,f,p,m){void 0===l&&(l=g.a.TEXTURE_NEAREST_SAMPLINGMODE),void 0===h&&(h=null),void 0===d&&(d=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===f&&(f="postprocess"),void 0===m&&(m=!1),this.name=e,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=g.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=g.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new Gt.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new o.w(1,1),this._texelSize=o.w.Zero(),this.onActivateObservable=new r.c,this.onSizeChangedObservable=new r.c,this.onApplyObservable=new r.c,this.onBeforeRenderObservable=new r.c,this.onAfterRenderObservable=new r.c,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):c&&(this._engine=c,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=l||g.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=u||!1,this._textureType=d,this._samplers=i||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=n||[],this._parameters.push("scale"),this._indexParameters=p,m||this.updateEffect(h)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=e,this._textures.forEach(function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)})},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new Gt.a(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(e,t,n,i,r,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,n||this._samplers,null!==e?e:"",void 0,r,o,i||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(e,t,n){var i=this;void 0===t&&(t=null);var r=(e=e||this._camera).getScene(),o=r.getEngine(),a=o.getCaps().maxTextureSize,s=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,l=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,c=e.parent;!c||c.leftCamera!=e&&c.rightCamera!=e||(s/=2);var u,h=this._options.width||s,d=this._options.height||l;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var f=o.currentViewport;f&&(h*=f.width,d*=f.height)}if((this.renderTargetSamplingMode===g.a.TEXTURE_TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(h=o.needPOTTextures?be.h.GetExponentOfTwo(h,a,this.scaleMode):h),this._options.height||(d=o.needPOTTextures?be.h.GetExponentOfTwo(d,a,this.scaleMode):d)),this.width!==h||this.height!==d){if(this._textures.length>0){for(var p=0;p<this._textures.length;p++)this._engine._releaseTexture(this._textures.data[p]);this._textures.reset()}this.width=h,this.height=d;var m={width:this.width,height:this.height},_={generateMipMaps:!1,generateDepthBuffer:n||0===e._postProcesses.indexOf(this),generateStencilBuffer:(n||0===e._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(m,_)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(m,_)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==i.samples&&i._engine.updateRenderTargetTextureSampleCount(e,i.samples)})}return this._shareOutputWithPostProcess?u=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(u=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):u=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(s/h,l/d),this._engine.bindFramebuffer(u,0,s,l,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(u,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(e),this.autoClear&&this.alphaMode===g.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:r.clearColor,r._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),u},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._effect._bindTexture("textureSampler",this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},e.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var n=this._engine.postProcesses.indexOf(this);-1!==n&&this._engine.postProcesses.splice(n,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0){var i=this._camera._getFirstPostProcess();i&&i.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}();zt.a.ShadersStore.passPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",zt.a.ShadersStore.passCubePixelShader="\nvarying vec2 vUV;\nuniform samplerCube textureSampler;\nvoid main(void)\n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";var Ht=function(e){function t(t,n,i,r,o,a,s,l){return void 0===i&&(i=null),void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1),e.call(this,t,"pass",null,null,n,i,r,o,a,void 0,s,void 0,null,l)||this}return c.d(t,e),t}(jt),Wt=function(e){function t(t,n,i,r,o,a,s,l){void 0===i&&(i=null),void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var c=e.call(this,t,"passCube",null,null,n,i,r,o,a,"#define POSITIVEX",s,void 0,null,l)||this;return c._face=0,c}return c.d(t,e),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),t}(jt);me.b._RescalePostProcessFactory=function(e){return new Ht("rescale",1,null,me.b.TEXTURE_BILINEAR_SAMPLINGMODE,e,!1,me.b.TEXTURETYPE_UNSIGNED_INT)},zt.a.ShadersStore.anaglyphPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}";var Xt=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t,"anaglyph",null,["leftSampler"],n,i[1],r,o,a)||this;return s._passedProcess=i[0]._rigPostProcess,s.onApplyObservable.add(function(e){e.setTextureFromPostProcess("leftSampler",s._passedProcess)}),s}return c.d(t,e),t}(jt);Ne.a._setStereoscopicAnaglyphRigMode=function(e){e._rigCameras[0]._rigPostProcess=new Ht(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new Xt(e.name+"_anaglyph",1,e._rigCameras)},k.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(e,t,n){return function(){return new Yt(e,0,0,1,o.x.Zero(),n.interaxial_distance,t)}});var Yt=function(e){function t(t,n,i,r,o,a,s){var l=e.call(this,t,n,i,r,o,s)||this;return l.interaxialDistance=a,l.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a}),l}return c.d(t,e),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(Et);k.a.AddNodeConstructor("AnaglyphFreeCamera",function(e,t,n){return function(){return new Kt(e,o.x.Zero(),n.interaxial_distance,t)}});var Kt=function(e){function t(t,n,i,r){var o=e.call(this,t,n,r)||this;return o.interaxialDistance=i,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i}),o}return c.d(t,e),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(yt);k.a.AddNodeConstructor("AnaglyphGamepadCamera",function(e,t,n){return function(){return new Qt(e,o.x.Zero(),n.interaxial_distance,t)}});var Qt=function(e){function t(t,n,i,r){var o=e.call(this,t,n,r)||this;return o.interaxialDistance=i,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i}),o}return c.d(t,e),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(Vt);k.a.AddNodeConstructor("AnaglyphUniversalCamera",function(e,t,n){return function(){return new qt(e,o.x.Zero(),n.interaxial_distance,t)}});var qt=function(e){function t(t,n,i,r){var o=e.call(this,t,n,r)||this;return o.interaxialDistance=i,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:i}),o}return c.d(t,e),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(Ut);zt.a.ShadersStore.stereoscopicInterlacePixelShader="const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}";var Zt=function(e){function t(t,n,i,r,a,s){var l=e.call(this,t,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],r,a,s,i?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return l._passedProcess=n[0]._rigPostProcess,l._stepSize=new o.w(1/l.width,1/l.height),l.onSizeChangedObservable.add(function(){l._stepSize=new o.w(1/l.width,1/l.height)}),l.onApplyObservable.add(function(e){e.setTextureFromPostProcess("camASampler",l._passedProcess),e.setFloat2("stepSize",l._stepSize.x,l._stepSize.y)}),l}return c.d(t,e),t}(jt);Ne.a._setStereoscopicRigMode=function(e){var t=e.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||e.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;e._rigCameras[0]._rigPostProcess=new Ht(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new Zt(e.name+"_stereoInterlace",e._rigCameras,t)},k.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(e,t,n){return function(){return new Jt(e,0,0,1,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var Jt=function(e){function t(t,n,i,r,o,a,s,l){var c=e.call(this,t,n,i,r,o,l)||this;return c.interaxialDistance=a,c.isStereoscopicSideBySide=s,c.setCameraRigMode(s?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a}),c}return c.d(t,e),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(Et);k.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,t,n){return function(){return new $t(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var $t=function(e){function t(t,n,i,r,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=i,a.isStereoscopicSideBySide=r,a.setCameraRigMode(r?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i}),a}return c.d(t,e),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(yt);k.a.AddNodeConstructor("StereoscopicGamepadCamera",function(e,t,n){return function(){return new en(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var en=function(e){function t(t,n,i,r,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=i,a.isStereoscopicSideBySide=r,a.setCameraRigMode(r?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i}),a}return c.d(t,e),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(Vt);k.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,t,n){return function(){return new tn(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var tn=function(e){function t(t,n,i,r,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=i,a.isStereoscopicSideBySide=r,a.setCameraRigMode(r?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:i}),a}return c.d(t,e),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(Ut);k.a.AddNodeConstructor("VirtualJoysticksCamera",function(e,t){return function(){return new nn(e,o.x.Zero(),t)}});var nn=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.inputs.addVirtualJoystick(),r}return c.d(t,e),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(yt),rn=function(){function e(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){return o.j.Translation(4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){return o.j.Translation(-4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return o.j.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){return o.j.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var t=new e;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},e}();zt.a.ShadersStore.vrDistortionCorrectionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn;\nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}";var on=function(e){function t(t,n,i,r){var a=e.call(this,t,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,r.postProcessScaleFactor,n,Ge.a.BILINEAR_SAMPLINGMODE)||this;return a._isRightEye=i,a._distortionFactors=r.distortionK,a._postProcessScaleFactor=r.postProcessScaleFactor,a._lensCenterOffset=r.lensCenterOffset,a.adaptScaleToCurrentViewport=!0,a.onSizeChangedObservable.add(function(){a._scaleIn=new o.w(2,2/a.aspectRatio),a._scaleFactor=new o.w(1/a._postProcessScaleFactor*.5,1/a._postProcessScaleFactor*.5*a.aspectRatio),a._lensCenter=new o.w(a._isRightEye?.5-.5*a._lensCenterOffset:.5+.5*a._lensCenterOffset,.5)}),a.onApplyObservable.add(function(e){e.setFloat2("LensCenter",a._lensCenter.x,a._lensCenter.y),e.setFloat2("Scale",a._scaleFactor.x,a._scaleFactor.y),e.setFloat2("ScaleIn",a._scaleIn.x,a._scaleIn.y),e.setFloat4("HmdWarpParam",a._distortionFactors[0],a._distortionFactors[1],a._distortionFactors[2],a._distortionFactors[3])}),a}return c.d(t,e),t}(jt);zt.a.ShadersStore.vrMultiviewToSingleviewPixelShader="#ifdef GL_ES\nprecision mediump sampler2DArray;\n#endif\nvarying vec2 vUV;\nuniform sampler2DArray multiviewSampler;\nuniform int imageIndex;\nvoid main(void)\n{\ngl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));\n}";var an=n(63),sn=n(83),ln=n(91);me.b.prototype.createRenderTargetCubeTexture=function(e,t){var n=c.a({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:me.b.TEXTURETYPE_UNSIGNED_INT,samplingMode:me.b.TEXTURE_TRILINEAR_SAMPLINGMODE,format:me.b.TEXTUREFORMAT_RGBA},t);n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(n.type!==me.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(n.type!==me.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=me.b.TEXTURE_NEAREST_SAMPLINGMODE);var i=this._gl,r=new ze.a(this,ze.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,r,!0);var o=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);n.type!==me.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(n.type=me.b.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,o.mag),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,o.min),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);for(var a=0;a<6;a++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),e,e,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);var s=i.createFramebuffer();return this._bindUnboundFramebuffer(s),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,e,e),n.generateMipMaps&&i.generateMipmap(i.TEXTURE_CUBE_MAP),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),r._framebuffer=s,r.width=e,r.height=e,r.isReady=!0,r.isCube=!0,r.samples=1,r.generateMipMaps=n.generateMipMaps,r.samplingMode=n.samplingMode,r.type=n.type,r.format=n.format,r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=n.generateStencilBuffer,this._internalTexturesCache.push(r),r};var cn=function(e){function t(t,n,i,a,s,l,c,u,h,d,f,p,m){void 0===s&&(s=!0),void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1),void 0===u&&(u=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=!0),void 0===d&&(d=!1),void 0===f&&(f=!1),void 0===p&&(p=g.a.TEXTUREFORMAT_RGBA),void 0===m&&(m=!1);var _=e.call(this,null,i,!a)||this;return _.isCube=c,_.renderParticles=!0,_.renderSprites=!1,_.coordinatesMode=Ge.a.PROJECTION_MODE,_.ignoreCameraViewport=!1,_.onBeforeBindObservable=new r.c,_.onAfterUnbindObservable=new r.c,_.onBeforeRenderObservable=new r.c,_.onAfterRenderObservable=new r.c,_.onClearObservable=new r.c,_._currentRefreshId=-1,_._refreshRate=1,_._samples=1,_.boundingBoxPosition=o.x.Zero(),(i=_.getScene())?(_.renderList=new Array,_._engine=i.getEngine(),_.name=t,_.isRenderTarget=!0,_._initialSizeParameter=n,_._processSizeParameter(n),_._resizeObserver=_.getScene().getEngine().onResizeObservable.add(function(){}),_._generateMipMaps=!!a,_._doNotChangeAspectRatio=s,_._renderingManager=new ln.b(i),_._renderingManager._useSceneAutoClearSetup=!0,f?_:(_._renderTargetOptions={generateMipMaps:a,type:l,format:p,samplingMode:u,generateDepthBuffer:h,generateStencilBuffer:d},u===Ge.a.NEAREST_SAMPLINGMODE&&(_.wrapU=Ge.a.CLAMP_ADDRESSMODE,_.wrapV=Ge.a.CLAMP_ADDRESSMODE),m||(c?(_._texture=i.getEngine().createRenderTargetCubeTexture(_.getRenderSize(),_._renderTargetOptions),_.coordinatesMode=Ge.a.INVCUBIC_MODE,_._textureMatrix=o.j.Identity()):_._texture=i.getEngine().createRenderTargetTexture(_._size,_._renderTargetOptions)),_)):_}return c.d(t,e),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),t.prototype._hookArray=function(e){var t=this,n=e.push;e.push=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var o=0===e.length,a=n.apply(e,i);return o&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),a};var i=e.splice;e.splice=function(n,r){var o=i.apply(e,[n,r]);return 0===e.length&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),o}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=!0),void 0===n&&(n=!1),this.getScene()){var i=this.getScene().getEngine();this.depthStencilTexture=i.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:n,isCube:this.isCube}),i.setFrameBufferDepthStencilTexture(this)}},t.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new sn.a(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,n=this._postProcesses;t<n.length;t++)n[t].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.scale=function(e){var t=this.getRenderSize()*e;this.resize(t)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var t=this.isCube;this.releaseInternalTexture();var n=this.getScene();n&&(this._processSizeParameter(e),this._texture=t?n.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):n.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},t.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),a=this.getScene()){var n,i=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var r=0;r<this._waitingRenderList.length;r++){var o=a.getMeshByID(this._waitingRenderList[r]);o&&this.renderList.push(o)}delete this._waitingRenderList}if(this.renderListPredicate){var a;if(this.renderList?this.renderList.length=0:this.renderList=[],!(a=this.getScene()))return;var s=a.meshes;for(r=0;r<s.length;r++){var l=s[r];this.renderListPredicate(l)&&this.renderList.push(l)}}this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(n=this.activeCamera,i.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==a.activeCamera&&a.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(n=a.activeCamera)&&i.setViewport(n.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var c=this.renderList?this.renderList:a.getActiveMeshes().data,u=this.renderList?this.renderList.length:a.getActiveMeshes().length,h=a.getRenderId(),d=0;d<u;d++)if(l=c[d]){if(!l.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}var f;if(l._preActivateForIntermediateRendering(h),f=!(this.renderList||!n)&&0==(l.layerMask&n.layerMask),l.isEnabled()&&l.isVisible&&l.subMeshes&&!f&&l._activate(h,!0)){l.isAnInstance?l=l.sourceMesh:l._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,l._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var p=0;p<l.subMeshes.length;p++){var g=l.subMeshes[p];a._activeIndices.addCount(g.indexCount,!1),this._renderingManager.dispatch(g,l)}}}for(var m=0;m<a.particleSystems.length;m++){var _=a.particleSystems[m],v=_.emitter;_.isStarted()&&v&&v.position&&v.isEnabled()&&c.indexOf(v)>=0&&this._renderingManager.dispatchParticles(_)}if(this.isCube)for(var b=0;b<6;b++)this.renderToTarget(b,c,e,t),a.incrementRenderId(),a.resetCachedMaterial();else this.renderToTarget(0,c,e,t);this.onAfterUnbindObservable.notifyObservers(this),a.activeCamera&&(this.activeCamera&&this.activeCamera!==a.activeCamera&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),i.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,t){var n=e*t,i=be.h.NearestPOT(n+16384/(128+n));return Math.min(be.h.FloorPOT(e),i)},t.prototype._bindFrameBuffer=function(e){void 0===e&&(e=0);var t=this.getScene();if(t){var n=t.getEngine();this._texture&&n.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0)}},t.prototype.unbindFrameBuffer=function(e,t){var n=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(t)})},t.prototype.renderToTarget=function(e,t,n,i){var r=this.getScene();if(r){var o=r.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&r.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e),this.onBeforeRenderObservable.notifyObservers(e),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(o):o.clear(this.clearColor||r.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||r.updateTransformMatrix(!0);for(var a=0,s=r._beforeRenderTargetDrawStage;a<s.length;a++)s[a].action(this);this._renderingManager.render(this.customRenderFunction,t,this.renderParticles,this.renderSprites);for(var l=0,c=r._afterRenderTargetDrawStage;l<c.length;l++)c[l].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):n&&r.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||r.updateTransformMatrix(!0),i&&be.h.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),o),this.isCube&&5!==e?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&5===e&&o.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(o,e))}}},t.prototype.setRenderingOrder=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,n,i)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,this.renderList&&(n.renderList=this.renderList.slice(0)),n},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);if(t.renderTargetSize=this.getRenderSize(),t.renderList=[],this.renderList)for(var n=0;n<this.renderList.length;n++)t.renderList.push(this.renderList[n].id);return t},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var t=this.getScene();if(t){var n=t.customRenderTargets.indexOf(this);n>=0&&t.customRenderTargets.splice(n,1);for(var i=0,r=t.cameras;i<r.length;i++){var o=r[i];(n=o.customRenderTargets.indexOf(this))>=0&&o.customRenderTargets.splice(n,1)}e.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(Ge.a);Ge.a._CreateRenderTargetTexture=function(e,t,n,i){return new cn(e,t,n,i)};var un=function(e){function t(t,n){void 0===n&&(n=512);var i=e.call(this,"multiview rtt",n,t,!1,!0,ze.a.DATASOURCE_UNKNOWN,!1,void 0,!1,!1,!0,void 0,!0)||this,r=t.getEngine().createMultiviewRenderTargetTexture(i.getRenderWidth(),i.getRenderHeight());return r.isMultiview=!0,i._texture=r,i}return c.d(t,e),t.prototype._bindFrameBuffer=function(e){void 0===e&&(e=0),this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(cn);me.b.prototype.createMultiviewRenderTargetTexture=function(e,t){var n=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var i=new ze.a(this,ze.a.DATASOURCE_UNKNOWN,!0);return i.width=e,i.height=t,i._framebuffer=n.createFramebuffer(),i._colorTextureArray=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,i._colorTextureArray),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.RGBA8,e,t,2),i._depthStencilTextureArray=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,i._depthStencilTextureArray),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.DEPTH32F_STENCIL8,e,t,2),i.isReady=!0,i},me.b.prototype.bindMultiviewFramebuffer=function(e){var t=this._gl,n=this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),!e._colorTextureArray||!e._depthStencilTextureArray)throw"Invalid multiview frame buffer";n.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),n.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2)},Ne.a.prototype._useMultiviewToSingleView=!1,Ne.a.prototype._multiviewTexture=null,Ne.a.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new un(this.getScene(),{width:e,height:t})):this._multiviewTexture=new un(this.getScene(),{width:e,height:t})},W.a.prototype._transformMatrixR=o.j.Zero(),W.a.prototype._multiviewSceneUbo=null,W.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new an.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},W.a.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,o.t.Matrix[0]),o.i.GetRightPlaneToRef(o.t.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},W.a.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width/2:this.getEngine().getRenderWidth(!0)/2,e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(var t=0;t<e._rigCameras.length;t++){var n=this.getEngine();this._activeCamera=e._rigCameras[t],n.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var hn=function(e){function t(t,n,i){var r=e.call(this,t,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],i,n,Ge.a.BILINEAR_SAMPLINGMODE)||this;return r.onSizeChangedObservable.add(function(){}),r.onApplyObservable.add(function(e){e.setInt("imageIndex",n._scene.activeCamera&&n._scene.activeCamera.isLeftCamera?0:1),e.setTexture("multiviewSampler",n._multiviewTexture)}),r}return c.d(t,e),t}(jt);Ne.a._setVRRigMode=function(e,t){var n=t.vrCameraMetrics||rn.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=n,e._rigCameras[0].viewport=new o.z(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[0]._cameraRigParams.vrHMatrix=n.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=n.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=n,e._rigCameras[1].viewport=new o.z(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[1]._cameraRigParams.vrHMatrix=n.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=n.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,n.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new hn("VRMultiviewToSingleview",e,n.postProcessScaleFactor)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),n.multiviewEnabled=!1)),n.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new on("VR_Distort_Compensation_Left",e._rigCameras[0],!1,n),e._rigCameras[1]._rigPostProcess=new on("VR_Distort_Compensation_Right",e._rigCameras[1],!0,n))},k.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,t){return function(){return new dn(e,0,0,1,o.x.Zero(),t)}});var dn=function(e){function t(t,n,i,r,o,a,s,l){void 0===s&&(s=!0),void 0===l&&(l=rn.GetDefault());var c=e.call(this,t,n,i,r,o,a)||this;return l.compensateDistortion=s,c.setCameraRigMode(Ne.a.RIG_MODE_VR,{vrCameraMetrics:l}),c.inputs.addVRDeviceOrientation(),c}return c.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(Et);k.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,t){return function(){return new fn(e,o.x.Zero(),t)}});var fn=function(e){function t(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=rn.GetDefault());var a=e.call(this,t,n,i)||this;return o.compensateDistortion=r,a.setCameraRigMode(Ne.a.RIG_MODE_VR,{vrCameraMetrics:o}),a}return c.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(xt);k.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(e,t){return function(){return new pn(e,o.x.Zero(),t)}});var pn=function(e){function t(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=rn.GetDefault());var a=e.call(this,t,n,i,r,o)||this;return a.inputs.addGamepad(),a}return c.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(fn),gn=n(65);Ne.a._setWebVRRigMode=function(e,t){if(t.vrDisplay){var n=t.vrDisplay.getEyeParameters("left"),i=t.vrDisplay.getEyeParameters("right");e._rigCameras[0].viewport=new o.z(0,0,.5,1),e._rigCameras[0].setCameraRigParameter("left",!0),e._rigCameras[0].setCameraRigParameter("specs",t.specs),e._rigCameras[0].setCameraRigParameter("eyeParameters",n),e._rigCameras[0].setCameraRigParameter("frameData",t.frameData),e._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[0].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[0].parent=e,e._rigCameras[0]._getViewMatrix=e._getWebVRViewMatrix,e._rigCameras[1].viewport=new o.z(.5,0,.5,1),e._rigCameras[1].setCameraRigParameter("eyeParameters",i),e._rigCameras[1].setCameraRigParameter("specs",t.specs),e._rigCameras[1].setCameraRigParameter("frameData",t.frameData),e._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[1].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[1].parent=e,e._rigCameras[1]._getViewMatrix=e._getWebVRViewMatrix}},Object.defineProperty(me.b.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),me.b.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new r.c,this.onVRRequestPresentComplete=new r.c,this.onVRRequestPresentStart=new r.c},me.b.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},me.b.prototype.getVRDevice=function(){return this._vrDisplay},me.b.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},me.b.prototype.initWebVRAsync=function(){var e=this,t=function(){var t={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(t),e._webVRInitPromise=new Promise(function(e){e(t)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(n){e._vrDisplay=n.display,t()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=be.h.QueueNewFrame(e._bindedRenderFunction),t()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},me.b.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(n){e._vrSupported=!0,e._vrDisplay=n[0],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},me.b.prototype.enableVR=function(){var e=this;this._vrDisplay&&!this._vrDisplay.isPresenting&&(this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()}).catch(function(){e.onVRRequestPresentComplete.notifyObservers(!1)}))},me.b.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new o.r(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var e=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*e.renderWidth,e.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},me.b.prototype.disableVR=function(){var e=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return e._onVRFullScreenTriggered()}).catch(function(){return e._onVRFullScreenTriggered()}),Ot.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},me.b.prototype._connectVREvents=function(e,t){this._onVRDisplayPointerRestricted=function(){e&&e.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){t.exitPointerLock&&t.exitPointerLock()},Ot.a.IsWindowObjectExist()&&(window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1))},me.b.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(e){be.h.Warn("webVR submitFrame has had an unexpected failure: "+e)}},me.b.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},me.b.prototype._requestVRFrame=function(){this._frameHandler=be.h.QueueNewFrame(this._bindedRenderFunction,this._vrDisplay)},k.a.AddNodeConstructor("WebVRFreeCamera",function(e,t){return function(){return new mn(e,o.x.Zero(),t)}}),k.a.AddNodeConstructor("WebVRGamepadCamera",function(e,t){return function(){return new mn(e,o.x.Zero(),t)}});var mn=function(e){function t(t,n,i,a){void 0===a&&(a={});var s=e.call(this,t,n,i)||this;s.webVROptions=a,s._vrDevice=null,s.rawPose=null,s._specsVersion="1.1",s._attached=!1,s._descendants=[],s._deviceRoomPosition=o.x.Zero(),s._deviceRoomRotationQuaternion=o.q.Identity(),s._standingMatrix=null,s.devicePosition=o.x.Zero(),s.deviceRotationQuaternion=o.q.Identity(),s.deviceScaleFactor=1,s._deviceToWorld=o.j.Identity(),s._worldToDevice=o.j.Identity(),s.controllers=[],s.onControllersAttachedObservable=new r.c,s.onControllerMeshLoadedObservable=new r.c,s.onPoseUpdatedFromDeviceObservable=new r.c,s._poseSet=!1,s.rigParenting=!0,s._defaultHeight=void 0,s._htmlElementAttached=null,s._detachIfAttached=function(){var e=s.getEngine().getVRDevice();e&&!e.isPresenting&&s._htmlElementAttached&&s.detachControl(s._htmlElementAttached)},s._workingVector=o.x.Zero(),s._oneVector=o.x.One(),s._workingMatrix=o.j.Identity(),s._tmpMatrix=new o.j,s._cache.position=o.x.Zero(),a.defaultHeight&&(s._defaultHeight=a.defaultHeight,s.position.y=s._defaultHeight),s.minZ=.1,5===arguments.length&&(s.webVROptions=arguments[4]),null==s.webVROptions.trackPosition&&(s.webVROptions.trackPosition=!0),null==s.webVROptions.controllerMeshes&&(s.webVROptions.controllerMeshes=!0),null==s.webVROptions.defaultLightingOnControllers&&(s.webVROptions.defaultLightingOnControllers=!0),s.rotationQuaternion=new o.q,s.webVROptions&&s.webVROptions.positionScale&&(s.deviceScaleFactor=s.webVROptions.positionScale);var l=s.getEngine();return s._onVREnabled=function(e){e&&s.initControllers()},l.onVRRequestPresentComplete.add(s._onVREnabled),l.initWebVR().add(function(e){e.vrDisplay&&s._vrDevice!==e.vrDisplay&&(s._vrDevice=e.vrDisplay,s.setCameraRigMode(Ne.a.RIG_MODE_WEBVR,{parentCamera:s,vrDisplay:s._vrDevice,frameData:s._frameData,specs:s._specsVersion}),s._attached&&s.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(s._frameData=new VRFrameData),a.useMultiview&&(s.getScene().getEngine().getCaps().multiview?(s._useMultiviewToSingleView=!0,s._rigPostProcess=new hn("VRMultiviewToSingleview",s,1)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),s._useMultiviewToSingleView=!1)),i.onBeforeCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&(s._descendants=s.getDescendants(!0,function(e){var t=s.controllers.some(function(t){return t._mesh===e}),n=-1!==s._rigCameras.indexOf(e);return!t&&!n}),s._descendants.forEach(function(t){t.parent=e}))}),i.onAfterCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&s._descendants.forEach(function(e){e.parent=s})}),s}return c.d(t,e),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var t=this;void 0===e&&(e=function(e){}),this.getEngine().initWebVRAsync().then(function(n){n.vrDisplay&&n.vrDisplay.stageParameters&&n.vrDisplay.stageParameters.sittingToStandingTransform&&t.webVROptions.trackPosition?(t._standingMatrix=new o.j,o.j.FromFloat32ArrayToRefScaled(n.vrDisplay.stageParameters.sittingToStandingTransform,0,1,t._standingMatrix),t.getScene().useRightHandedSystem||t._standingMatrix&&t._standingMatrix.toggleModelMatrixHandInPlace(),e(!0)):e(!1)})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(t){e.useStandingMatrix(function(e){t(e)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),e.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var t=0,n=this.controllers;t<n.length;t++){var i=n[t];if(i.hand===e)return i}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(t){return void 0===t&&(t=100),this.leftCamera?e.prototype.getForwardRay.call(this,t,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):e.prototype.getForwardRay.call(this,t)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),e.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(t,n){e.prototype.attachControl.call(this,t,n),this._attached=!0,this._htmlElementAttached=t,n=!Ne.a.ForceAttachControlToAlwaysPreventDefault&&n,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(t){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),e.prototype.detachControl.call(this,t),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),t.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,t){void 0===t&&(t=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(o.j.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),t||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(t){var n=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),o.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),o.j.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(e){e._deviceToWorld.copyFrom(n._deviceToWorld),n._correctPositionIfNotTrackPosition(e._deviceToWorld),e.update()})),t||e.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){o.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),o.j.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),o.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),e.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return o.j.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;return e._updateCache(),o.j.FromArrayToRef(this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),o.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==e.deviceScaleFactor&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||o.j.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;return e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ,o.j.FromArrayToRef(this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers=[];var t=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add(function(t){if(t.type===Ke.POSE_ENABLED){var n=t;n.defaultModel&&n.defaultModel.setEnabled(!1),"right"===n.hand&&(e._rightController=null),"left"===n.hand&&(e._leftController=null);var i=e.controllers.indexOf(n);-1!==i&&e.controllers.splice(i,1)}}),this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add(function(t){if(t.type===Ke.POSE_ENABLED){var n=t;if(e.webVROptions.trackPosition||(n._disableTrackPosition(new o.x("left"==n.hand?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),n.deviceScaleFactor=e.deviceScaleFactor,n._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(n._deviceToWorld),e.webVROptions.controllerMeshes&&(n.defaultModel?n.defaultModel.setEnabled(!0):n.initControllerMesh(e.getScene(),function(t){if(t.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(n),e.webVROptions.defaultLightingOnControllers){e._lightOnControllers||(e._lightOnControllers=new gn.a("vrControllersLight",new o.x(0,1,0),e.getScene()));var i=function(e,t){var n=e.getChildren();n&&0!==n.length&&n.forEach(function(e){t.includedOnlyMeshes.push(e),i(e,t)})};e._lightOnControllers.includedOnlyMeshes.push(t),i(t,e._lightOnControllers)}})),n.attachToPoseControlledCamera(e),-1===e.controllers.indexOf(n)){e.controllers.push(n);for(var i=!1,r=0;r<e.controllers.length;r++)e.controllers[r].controllerType===Pt.VIVE&&(i?e.controllers[r].hand="right":(i=!0,e.controllers[r].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(yt),_n=function(e){function t(t){var n=e.call(this,t)||this;return n.onTriggerStateChangedObservable=new r.c,n.onMainButtonStateChangedObservable=new r.c,n.onSecondaryButtonStateChangedObservable=new r.c,n.onPadStateChangedObservable=new r.c,n.onPadValuesChangedObservable=new r.c,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(t.buttons.length),n.hand=t.hand,n}return c.d(t,e),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._setButtonValue(this.browserGamepad.buttons[t],this._buttons[t],t);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,t,n){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,n,e),this._handleButtonChange(n,e,this._changes)),this._buttons[n].pressed=e.pressed,this._buttons[n].touched=e.touched,this._buttons[n].value=e.value<1e-8?0:e.value):this._buttons[n]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(kt),vn=n(31),bn=n(33),yn=function(e){function t(t,n,i,r,o,a){void 0===i&&(i=null),void 0===o&&(o=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=g.a.TEXTUREFORMAT_RGBA);var s=e.call(this,null,i,!r,void 0,o,void 0,void 0,void 0,void 0,a)||this;s.name=t,s._engine=s.getScene().getEngine(),s.wrapU=Ge.a.CLAMP_ADDRESSMODE,s.wrapV=Ge.a.CLAMP_ADDRESSMODE,s._generateMipMaps=r,n.getContext?(s._canvas=n,s._texture=s._engine.createDynamicTexture(n.width,n.height,r,o)):(s._canvas=document.createElement("canvas"),s._texture=n.width||0===n.width?s._engine.createDynamicTexture(n.width,n.height,r,o):s._engine.createDynamicTexture(n,n,r,o));var l=s.getSize();return s._canvas.width=l.width,s._canvas.height=l.height,s._context=s._canvas.getContext("2d"),s}return c.d(t,e),t.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},t.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},t.prototype.scaleTo=function(e,t){var n=this.getSize();n.width=e,n.height=t,this._recreate(n)},t.prototype.getContext=function(){return this._context},t.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},t.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},t.prototype.drawText=function(e,t,n,i,r,o,a,s){void 0===s&&(s=!0);var l=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,l.width,l.height)),this._context.font=i,null==t){var c=this._context.measureText(e);t=(l.width-c.width)/2}if(null==n){var u=parseInt(i.replace(/\D/g,""));n=l.height/2+u/3.65}this._context.fillStyle=r,this._context.fillText(e,t,n),s&&this.update(a)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),i=new t(this.name,n,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},t.prototype.serialize=function(){var t=this.getScene();t&&!t.isReady()&&p.a.Warn("The scene must be ready before serializing the dynamic texture");var n=e.prototype.serialize.call(this);return n.base64String=this._canvas.toDataURL(),n.invertY=this._invertY,n.samplingMode=this.samplingMode,n},t.prototype._rebuild=function(){this.update()},t}(Ge.a),Tn=(n(86),n(56),n(87),"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}");zt.a.ShadersStore.imageProcessingPixelShader=Tn;var En=function(e){function t(t,n,i,r,o,a,s,l){void 0===i&&(i=null),void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT);var c=e.call(this,t,"imageProcessing",[],[],n,i,r,o,a,null,s,"postprocess",null,!0)||this;return c._fromLinearSpace=!0,c._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},l?(l.applyByPostProcess=!0,c._attachImageProcessingConfiguration(l,!0),c.fromLinearSpace=!1):(c._attachImageProcessingConfiguration(null,!0),c.imageProcessingConfiguration.applyByPostProcess=!0),c.onApply=function(e){c.imageProcessingConfiguration.bind(e,c.aspectRatio)},c}return c.d(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,t){var n=this;if(void 0===t&&(t=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var i=null,r=this.getEngine(),o=this.getCamera();if(o)i=o.getScene();else if(r&&r.scenes){var a=r.scenes;i=a[a.length-1]}else i=A.a.LastCreatedScene;this._imageProcessingConfiguration=i.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._updateParameters()})),t||this._updateParameters()}},Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var t in this._defines)this._defines[t]&&(e+="#define "+t+";\r\n");var n=["textureSampler"],i=["scale"];vn.a&&(vn.a.PrepareSamplers(n,this._defines),vn.a.PrepareUniforms(i,this._defines)),this.updateEffect(e,i,n)},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},c.c([Object(D.c)()],t.prototype,"_fromLinearSpace",void 0),t}(jt),xn=n(13),Cn=n(4);fe.a._GroundMeshParser=function(e,t){return Sn.Parse(e,t)};var Sn=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.generateOctree=!1,i}return c.d(t,e),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),t.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},t.prototype.getHeightAtCoordinates=function(e,t){var n=this.getWorldMatrix(),i=o.t.Matrix[5];n.invertToRef(i);var r=o.t.Vector3[8];if(o.x.TransformCoordinatesFromFloatsToRef(e,0,t,i,r),t=r.z,(e=r.x)<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(e,t);return o.x.TransformCoordinatesFromFloatsToRef(0,-(a.x*e+a.z*t+a.w)/a.y,0,n,r),r.y},t.prototype.getNormalAtCoordinates=function(e,t){var n=new o.x(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,n),n},t.prototype.getNormalAtCoordinatesToRef=function(e,t,n){var i=this.getWorldMatrix(),r=o.t.Matrix[5];i.invertToRef(r);var a=o.t.Vector3[8];if(o.x.TransformCoordinatesFromFloatsToRef(e,0,t,r,a),t=a.z,(e=a.x)<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(e,t);return o.x.TransformNormalFromFloatsToRef(s.x,s.y,s.z,i,n),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,t){var n=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[i*this._subdivisionsX+n];return t<r.slope.x*e+r.slope.y?r.facet1:r.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var n=0;n<t;n++)for(var i=0;i<e;i++){var r={slope:o.w.Zero(),facet1:new o.y(0,0,0,0),facet2:new o.y(0,0,0,0)};this._heightQuads[n*e+i]=r}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(Cn.b.PositionKind);if(!e)return this;for(var t=o.t.Vector3[3],n=o.t.Vector3[2],i=o.t.Vector3[1],r=o.t.Vector3[0],a=o.t.Vector3[4],s=o.t.Vector3[5],l=o.t.Vector3[6],c=o.t.Vector3[7],u=o.t.Vector3[8],h=0,d=0,f=0,p=0,g=0,m=0,_=0,v=this._subdivisionsX,b=this._subdivisionsY,y=0;y<b;y++)for(var T=0;T<v;T++){f=(y+1)*(v+1)*3,t.x=e[(d=y*(v+1)*3)+(h=3*T)],t.y=e[d+h+1],t.z=e[d+h+2],n.x=e[d+h+3],n.y=e[d+h+4],n.z=e[d+h+5],i.x=e[f+h],i.y=e[f+h+1],i.z=e[f+h+2],r.x=e[f+h+3],r.y=e[f+h+4],r.z=e[f+h+5],g=t.z-(p=(r.z-t.z)/(r.x-t.x))*t.x,n.subtractToRef(t,a),i.subtractToRef(t,s),r.subtractToRef(t,l),o.x.CrossToRef(l,s,c),o.x.CrossToRef(a,l,u),c.normalize(),u.normalize(),m=-(c.x*t.x+c.y*t.y+c.z*t.z),_=-(u.x*n.x+u.y*n.y+u.z*n.z);var E=this._heightQuads[y*v+T];E.slope.copyFromFloats(p,g),E.facet1.copyFromFloats(c.x,c.y,c.z,m),E.facet2.copyFromFloats(u.x,u.y,u.z,_)}return this},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},t.Parse=function(e,n){var i=new t(e.name,n);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i},t}(fe.a);xn.a.CreateGround=function(e){var t,n,i=[],r=[],a=[],s=[],l=e.width||1,c=e.height||1,u=e.subdivisionsX||e.subdivisions||1,h=e.subdivisionsY||e.subdivisions||1;for(t=0;t<=h;t++)for(n=0;n<=u;n++){var d=new o.x(n*l/u-l/2,0,(h-t)*c/h-c/2),f=new o.x(0,1,0);r.push(d.x,d.y,d.z),a.push(f.x,f.y,f.z),s.push(n/u,1-t/h)}for(t=0;t<h;t++)for(n=0;n<u;n++)i.push(n+1+(t+1)*(u+1)),i.push(n+1+t*(u+1)),i.push(n+t*(u+1)),i.push(n+(t+1)*(u+1)),i.push(n+1+(t+1)*(u+1)),i.push(n+t*(u+1));var p=new xn.a;return p.indices=i,p.positions=r,p.normals=a,p.uvs=s,p},xn.a.CreateTiledGround=function(e){var t,n,i,r,a=null!=e.xmin?e.xmin:-1,s=null!=e.zmin?e.zmin:-1,l=null!=e.xmax?e.xmax:1,c=null!=e.zmax?e.zmax:1,u=e.subdivisions||{w:1,h:1},h=e.precision||{w:1,h:1},d=new Array,f=new Array,p=new Array,g=new Array;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,h.w=h.w<1?1:h.w,h.h=h.h<1?1:h.h;var m=(l-a)/u.w,_=(c-s)/u.h;function v(e,i,r,a){var s=f.length/3,l=h.w+1;for(t=0;t<h.h;t++)for(n=0;n<h.w;n++){var c=[s+n+t*l,s+(n+1)+t*l,s+(n+1)+(t+1)*l,s+n+(t+1)*l];d.push(c[1]),d.push(c[2]),d.push(c[3]),d.push(c[0]),d.push(c[1]),d.push(c[3])}var u=o.x.Zero(),m=new o.x(0,1,0);for(t=0;t<=h.h;t++)for(u.z=t*(a-i)/h.h+i,n=0;n<=h.w;n++)u.x=n*(r-e)/h.w+e,u.y=0,f.push(u.x,u.y,u.z),p.push(m.x,m.y,m.z),g.push(n/h.w,t/h.h)}for(i=0;i<u.h;i++)for(r=0;r<u.w;r++)v(a+r*m,s+i*_,a+(r+1)*m,s+(i+1)*_);var b=new xn.a;return b.indices=d,b.positions=f,b.normals=p,b.uvs=g,b},xn.a.CreateGroundFromHeightMap=function(e){var t,n,i=[],r=[],a=[],s=[],l=e.colorFilter||new o.e(.3,.59,.11),c=e.alphaFilter||0,u=!1;if(e.minHeight>e.maxHeight){u=!0;var h=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=h}for(t=0;t<=e.subdivisions;t++)for(n=0;n<=e.subdivisions;n++){var d=new o.x(n*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),f=4*(((d.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(d.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),p=e.buffer[f]/255,g=e.buffer[f+1]/255,m=e.buffer[f+2]/255;u&&(p=1-p,g=1-g,m=1-m),d.y=e.buffer[f+3]/255>=c?e.minHeight+(e.maxHeight-e.minHeight)*(p*l.r+g*l.g+m*l.b):e.minHeight-o.h,r.push(d.x,d.y,d.z),a.push(0,0,0),s.push(n/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(n=0;n<e.subdivisions;n++){var _=n+1+(t+1)*(e.subdivisions+1),v=n+1+t*(e.subdivisions+1),b=n+t*(e.subdivisions+1),y=n+(t+1)*(e.subdivisions+1),T=r[3*_+1]>=e.minHeight,E=r[3*b+1]>=e.minHeight;T&&r[3*v+1]>=e.minHeight&&E&&(i.push(_),i.push(v),i.push(b)),r[3*y+1]>=e.minHeight&&T&&E&&(i.push(y),i.push(_),i.push(b))}xn.a.ComputeNormals(r,i,a);var x=new xn.a;return x.indices=i,x.positions=r,x.normals=a,x.uvs=s,x},fe.a.CreateGround=function(e,t,n,i,r,o){return An.CreateGround(e,{width:t,height:n,subdivisions:i,updatable:o},r)},fe.a.CreateTiledGround=function(e,t,n,i,r,o,a,s,l){return An.CreateTiledGround(e,{xmin:t,zmin:n,xmax:i,zmax:r,subdivisions:o,precision:a,updatable:l},s)},fe.a.CreateGroundFromHeightMap=function(e,t,n,i,r,o,a,s,l,c,u){return An.CreateGroundFromHeightMap(e,t,{width:n,height:i,subdivisions:r,minHeight:o,maxHeight:a,updatable:l,onReady:c,alphaFilter:u},s)};var An=function(){function e(){}return e.CreateGround=function(e,t,n){var i=new Sn(e,n);return i._setReady(!1),i._subdivisionsX=t.subdivisionsX||t.subdivisions||1,i._subdivisionsY=t.subdivisionsY||t.subdivisions||1,i._width=t.width||1,i._height=t.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,xn.a.CreateGround(t).applyToMesh(i,t.updatable),i._setReady(!0),i},e.CreateTiledGround=function(e,t,n){void 0===n&&(n=null);var i=new fe.a(e,n);return xn.a.CreateTiledGround(t).applyToMesh(i,t.updatable),i},e.CreateGroundFromHeightMap=function(e,t,n,i){void 0===i&&(i=null);var r=n.width||10,a=n.height||10,s=n.subdivisions||1,l=n.minHeight||0,c=n.maxHeight||1,u=n.colorFilter||new o.e(.3,.59,.11),h=n.alphaFilter||0,d=n.updatable,f=n.onReady,p=new Sn(e,i=i||A.a.LastCreatedScene);return p._subdivisionsX=s,p._subdivisionsY=s,p._width=r,p._height=a,p._maxX=p._width/2,p._maxZ=p._height/2,p._minX=-p._maxX,p._minZ=-p._maxZ,p._setReady(!1),be.h.LoadImage(t,function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!i.isDisposed){var o=e.width,g=e.height;t.width=o,t.height=g,n.drawImage(e,0,0);var m=n.getImageData(0,0,o,g).data;xn.a.CreateGroundFromHeightMap({width:r,height:a,subdivisions:s,minHeight:l,maxHeight:c,colorFilter:u,buffer:m,bufferWidth:o,bufferHeight:g,alphaFilter:h}).applyToMesh(p,d),f&&f(p),p._setReady(!0)}},function(){},i.offlineProvider),p},e}();xn.a.CreateTorus=function(e){for(var t=[],n=[],i=[],r=[],a=e.diameter||1,s=e.thickness||.5,l=e.tessellation||16,c=0===e.sideOrientation?0:e.sideOrientation||xn.a.DEFAULTSIDE,u=l+1,h=0;h<=l;h++)for(var d=h/l,f=h*Math.PI*2/l-Math.PI/2,p=o.j.Translation(a/2,0,0).multiply(o.j.RotationY(f)),g=0;g<=l;g++){var m=1-g/l,_=g*Math.PI*2/l+Math.PI,v=Math.cos(_),b=Math.sin(_),y=new o.x(v,b,0),T=y.scale(s/2),E=new o.w(d,m);T=o.x.TransformCoordinates(T,p),y=o.x.TransformNormal(y,p),n.push(T.x,T.y,T.z),i.push(y.x,y.y,y.z),r.push(E.x,E.y);var x=(h+1)%u,C=(g+1)%u;t.push(h*u+g),t.push(h*u+C),t.push(x*u+g),t.push(h*u+C),t.push(x*u+C),t.push(x*u+g)}xn.a._ComputeSides(c,n,t,i,r,e.frontUVs,e.backUVs);var S=new xn.a;return S.indices=t,S.positions=n,S.normals=i,S.uvs=r,S},fe.a.CreateTorus=function(e,t,n,i,r,o,a){return Rn.CreateTorus(e,{diameter:t,thickness:n,tessellation:i,sideOrientation:a,updatable:o},r)};var Pn,Rn=function(){function e(){}return e.CreateTorus=function(e,t,n){var i=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreateTorus(t).applyToMesh(i,t.updatable),i},e}(),Mn=n(53),On=function(){function e(t,n){if(void 0===n&&(n=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=e._idCounter++,n)this._gazeTracker=n.clone("gazeTracker");else{this._gazeTracker=fe.a.CreateTorus("gazeTracker",.0035,.0025,20,t,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var i=new bn.a("targetMat",t);i.specularColor=o.e.Black(),i.emissiveColor=new o.e(.7,.7,.7),i.backFaceCulling=!1,this._gazeTracker.material=i}}return e.prototype._getForwardRay=function(e){return new wt.a(o.x.Zero(),new o.x(0,0,e))},e.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},e.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},e.prototype._activatePointer=function(){this._activePointer=!0},e.prototype._deactivatePointer=function(){this._activePointer=!1},e.prototype._updatePointerDistance=function(e){void 0===e&&(e=100)},e.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},e._idCounter=0,e}(),wn=function(e){function t(t,n,i){var r=e.call(this,n,i)||this;r.webVRController=t,r._laserPointer=fe.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,n,!1);var a=new bn.a("laserPointerMat",n);if(a.emissiveColor=new o.e(.7,.7,.7),a.alpha=.6,r._laserPointer.material=a,r._laserPointer.rotation.x=Math.PI/2,r._laserPointer.position.z=-.5,r._laserPointer.isVisible=!1,r._laserPointer.isPickable=!1,!t.mesh){var s=new fe.a("preloadControllerMesh",n),l=new fe.a(kt.POINTING_POSE,n);l.rotation.x=-.7,s.addChild(l),t.attachToMesh(s)}return r._setLaserPointerParent(t.mesh),r._meshAttachedObserver=t._meshAttachedObservable.add(function(e){r._setLaserPointerParent(e)}),r}return c.d(t,e),t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){e.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){e.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerParent=function(e){var t=function(e){e.isPickable=!1,e.getChildMeshes().forEach(function(e){t(e)})};t(e);var n=e.getChildren(void 0,!1),i=e;this.webVRController._pointingPoseNode=null;for(var r=0;r<n.length;r++)if(n[r].name&&n[r].name.indexOf(kt.POINTING_POSE)>=0){this.webVRController._pointingPoseNode=i=n[r];break}this._laserPointer.parent=i},t.prototype._updatePointerDistance=function(e){void 0===e&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(On),In=function(e){function t(t,n){var i=e.call(this,n)||this;return i.getCamera=t,i}return c.d(t,e),t.prototype._getForwardRay=function(e){var t=this.getCamera();return t?t.getForwardRay(e):new wt.a(o.x.Zero(),o.x.Forward())},t}(On),Dn=function(){},Ln=function(){function e(e,t){var n=this;if(void 0===t&&(t={}),this.webVROptions=t,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new r.c,this.onAfterEnteringVRObservable=new r.c,this.onExitingVRObservable=new r.c,this.onControllerMeshLoadedObservable=new r.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new o.x(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new o.x(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new r.c,this.onNewMeshPicked=new r.c,this.onBeforeCameraTeleport=new r.c,this.onAfterCameraTeleport=new r.c,this.onSelectedMeshUnselected=new r.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.requestPointerLockOnFullScreen=!0,this._onResize=function(){n.moveButtonToBottomRight(),n._fullscreenVRpresenting&&n._webVRready&&n.exitVR()},this._onFullscreenChange=function(){var e=document;void 0!==e.fullscreen?n._fullscreenVRpresenting=document.fullscreen:void 0!==e.mozFullScreen?n._fullscreenVRpresenting=e.mozFullScreen:void 0!==e.webkitIsFullScreen?n._fullscreenVRpresenting=e.webkitIsFullScreen:void 0!==e.msIsFullScreen?n._fullscreenVRpresenting=e.msIsFullScreen:void 0!==document.msFullscreenElement&&(n._fullscreenVRpresenting=document.msFullscreenElement),!n._fullscreenVRpresenting&&n._canvas&&(n.exitVR(),n._useCustomVRButton||(n._btnVR.style.top=n._canvas.offsetTop+n._canvas.offsetHeight-70+"px",n._btnVR.style.left=n._canvas.offsetLeft+n._canvas.offsetWidth-100+"px"))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){n._leftController&&n._leftController._activePointer&&n._castRayAndSelectObject(n._leftController),n._rightController&&n._rightController._activePointer&&n._castRayAndSelectObject(n._rightController),n._noControllerIsActive?n._castRayAndSelectObject(n._cameraGazer):n._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(e){if(e.type!==Ke.POSE_ENABLED)e.leftStick&&e.onleftstickchanged(function(e){n._teleportationInitialized&&n.teleportationEnabled&&(!n._leftController&&!n._rightController||n._leftController&&!n._leftController._activePointer&&n._rightController&&!n._rightController._activePointer)&&(n._checkTeleportWithRay(e,n._cameraGazer),n._checkTeleportBackwards(e,n._cameraGazer))}),e.rightStick&&e.onrightstickchanged(function(e){n._teleportationInitialized&&n._checkRotate(e,n._cameraGazer)}),e.type===Ke.XBOX&&(e.onbuttondown(function(e){n._interactionsEnabled&&e===It.A&&n._cameraGazer._selectionPointerDown()}),e.onbuttonup(function(e){n._interactionsEnabled&&e===It.A&&n._cameraGazer._selectionPointerUp()}));else{var t=e,i=new wn(t,n._scene,n._cameraGazer._gazeTracker);"right"===t.hand||n._leftController&&n._leftController.webVRController!=t?n._rightController=i:n._leftController=i,n._tryEnableInteractionOnController(i)}},this._tryEnableInteractionOnController=function(e){n._interactionsRequested&&!e._interactionsEnabled&&n._enableInteractionOnController(e),n._teleportationRequested&&!e._teleportationEnabled&&n._enableTeleportationOnController(e)},this._onNewGamepadDisconnected=function(e){e instanceof _n&&("left"===e.hand&&null!=n._leftController&&(n._leftController.dispose(),n._leftController=null),"right"===e.hand&&null!=n._rightController&&(n._rightController.dispose(),n._rightController=null))},this._workingVector=o.x.Zero(),this._workingQuaternion=o.q.Identity(),this._workingMatrix=o.j.Identity(),this._scene=e,this._canvas=e.getEngine().getRenderingCanvas(),void 0===t.createFallbackVRDeviceOrientationFreeCamera&&(t.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===t.createDeviceOrientationCamera&&(t.createDeviceOrientationCamera=!0),void 0===t.laserToggle&&(t.laserToggle=!0),void 0===t.defaultHeight&&(t.defaultHeight=1.7),t.useCustomVRButton&&(this._useCustomVRButton=!0,t.customVRButton&&(this._btnVR=t.customVRButton)),t.rayLength&&(this._rayLength=t.rayLength),this._defaultHeight=t.defaultHeight,t.positionScale&&(this._rayLength*=t.positionScale,this._defaultHeight*=t.positionScale),this._hasEnteredVR=!1,this._position=this._scene.activeCamera?this._scene.activeCamera.position.clone():new o.x(0,this._defaultHeight,0),t.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new xt("deviceOrientationVRHelper",this._position.clone(),e),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof bt&&this._scene.activeCamera.rotation)){var i=this._scene.activeCamera;this._deviceOrientationCamera.rotationQuaternion.copyFrom(i.rotationQuaternion?i.rotationQuaternion:o.q.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z)),this._deviceOrientationCamera.rotation=i.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(t.createFallbackVRDeviceOrientationFreeCamera&&(t.useMultiview&&(t.vrDeviceOrientationCameraMetrics||(t.vrDeviceOrientationCameraMetrics=rn.GetDefault()),t.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new fn("VRDeviceOrientationVRHelper",this._position,this._scene,!0,t.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new mn("WebVRHelper",this._position,this._scene,t),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new In(function(){return n.currentVRCamera},e),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var a=document.createElement("style");a.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),document.getElementsByTagName("head")[0].appendChild(a),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){n.isInVRMode?n.exitVR():n.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,t.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(e){e.vrDisplay&&n.displayVRButton()}),this._onKeyDown=function(e){27===e.keyCode&&n.isInVRMode&&n.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){n.isInVRMode&&(n.exitVR(),n._fullscreenVRpresenting&&n._scene.getEngine().exitFullscreen())},Ae.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(e){return n.onVRDisplayChanged(e)},this._onVrDisplayPresentChange=function(){return n.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){n._webVRrequesting=!0,n.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){n._webVRrequesting=!1,n.updateButtonVisibility()},e.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),e.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),e.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),e.onDisposeObservable.add(function(){n.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(e){return n._onDefaultMeshLoaded(e)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new ee,this._circleEase.setEasingMode($.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(e.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(e){e&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=e,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(e){this._displayGaze=e,e||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(e){this._displayLaserPointer=e,e?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),e.prototype._onDefaultMeshLoaded=function(e){this._leftController&&this._leftController.webVRController==e&&e.mesh&&this._leftController._setLaserPointerParent(e.mesh),this._rightController&&this._rightController.webVRController==e&&e.mesh&&this._rightController._setLaserPointerParent(e.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(e)}catch(e){p.a.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(e.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),e.prototype.onVrDisplayPresentChange=function(){var e=this._scene.getEngine().getVRDevice();if(e){var t=this._webVRpresenting;this._webVRpresenting=e.isPresenting,t&&!this._webVRpresenting&&this.exitVR()}else p.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},e.prototype.onVRDisplayChanged=function(e){this._webVRsupported=e.vrSupported,this._webVRready=!!e.vrDisplay,this._webVRpresenting=e.vrDisplay&&e.vrDisplay.isPresenting,this.updateButtonVisibility()},e.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},e.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},e.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},e.prototype.enterVR=function(){var e=this;if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(e){p.a.Warn("Error in your custom logic onEnteringVR: "+e)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=o.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var t=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,n=o.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-t,i=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=o.q.FromEulerAngles(0,i+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(t){e.onAfterEnteringVRObservable.notifyObservers({success:t})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){e.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(e){e&&e._activatePointer()}),this._hasEnteredVR=!0)},e.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){p.a.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var e=this._scene.getEngine();e._onVrDisplayPresentChange&&e._onVrDisplayPresentChange()}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)},enumerable:!0,configurable:!0}),e.prototype.enableInteractions=function(){var e=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(t){return t.isVisible&&(t.isPickable||t.name===e._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(t){return!!(e._isTeleportationFloor(t)||-1===t.name.indexOf("gazeTracker")&&-1===t.name.indexOf("teleportationTarget")&&-1===t.name.indexOf("torusTeleportation"))&&e.raySelectionPredicate(t)},this._interactionsEnabled=!0)},Object.defineProperty(e.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),e.prototype._isTeleportationFloor=function(e){for(var t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[t].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)},e.prototype.addFloorMesh=function(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))},e.prototype.removeFloorMesh=function(e){if(this._floorMeshesCollection){var t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}},e.prototype.enableTeleportation=function(e){if(void 0===e&&(e={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),e.floorMeshName&&(this._floorMeshName=e.floorMeshName),e.floorMeshes&&(this._floorMeshesCollection=e.floorMeshes),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var t=new vn.a;t.vignetteColor=new o.f(0,0,0,0),t.vignetteEnabled=!0,this._postProcessMove=new En("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,t),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},e.prototype._enableInteractionOnController=function(e){var t=this;e.webVRController.mesh&&(e._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&e._activatePointer(),this.webVROptions.laserToggle&&e.webVRController.onMainButtonStateChangedObservable.add(function(n){t._displayLaserPointer&&1===n.value&&(e._activePointer?e._deactivatePointer():e._activatePointer(),t.displayGaze&&(e._gazeTracker.isVisible=e._activePointer))}),e.webVRController.onTriggerStateChangedObservable.add(function(n){var i=e;t._noControllerIsActive&&(i=t._cameraGazer),i._pointerDownOnMeshAsked?n.value<t._padSensibilityDown&&i._selectionPointerUp():n.value>t._padSensibilityUp&&i._selectionPointerDown()}))},e.prototype._checkTeleportWithRay=function(e,t){this._teleportationRequestInitiated&&!t._teleportationRequestInitiated||(t._teleportationRequestInitiated?Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),t._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&t._dpadPressed&&(t._activatePointer(),t._teleportationRequestInitiated=!0))},e.prototype._checkRotate=function(e,t){t._teleportationRequestInitiated||(t._rotationLeftAsked?e.x>-this._padSensibilityDown&&(t._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&t._dpadPressed&&(t._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),t._rotationRightAsked?e.x<this._padSensibilityDown&&(t._rotationRightAsked=!1):e.x>this._padSensibilityUp&&t._dpadPressed&&(t._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},e.prototype._checkTeleportBackwards=function(e,t){if(!t._teleportationRequestInitiated)if(e.y>this._padSensibilityUp&&t._dpadPressed){if(!t._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var n=o.q.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),i=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(n=this.currentVRCamera.deviceRotationQuaternion,i=this.currentVRCamera.devicePosition),n.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,o.q.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),o.x.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var r=new wt.a(i,this._workingVector),a=this._scene.pickWithRay(r,this._raySelectionPredicate);a&&a.pickedPoint&&a.pickedMesh&&this._isTeleportationFloor(a.pickedMesh)&&a.distance<5&&this.teleportCamera(a.pickedPoint),t._teleportationBackRequestInitiated=!0}}else t._teleportationBackRequestInitiated=!1},e.prototype._enableTeleportationOnController=function(e){var t=this;e.webVRController.mesh&&(e._interactionsEnabled||this._enableInteractionOnController(e),e._interactionsEnabled=!0,e._teleportationEnabled=!0,e.webVRController.controllerType===Pt.VIVE&&(e._dpadPressed=!1,e.webVRController.onPadStateChangedObservable.add(function(t){e._dpadPressed=t.pressed,e._dpadPressed||(e._rotationLeftAsked=!1,e._rotationRightAsked=!1,e._teleportationBackRequestInitiated=!1)})),e.webVRController.onPadValuesChangedObservable.add(function(n){t.teleportationEnabled&&(t._checkTeleportBackwards(n,e),t._checkTeleportWithRay(n,e)),t._checkRotate(n,e)}))},e.prototype._createTeleportationCircles=function(){this._teleportationTarget=fe.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var e=new yn("DynamicTexture",512,this._scene,!0);e.hasAlpha=!0;var t=e.getContext();t.beginPath(),t.arc(256,256,200,0,2*Math.PI,!1),t.fillStyle=this._teleportationFillColor,t.fill(),t.lineWidth=10,t.strokeStyle=this._teleportationBorderColor,t.stroke(),t.closePath(),e.update();var n=new bn.a("TextPlaneMaterial",this._scene);n.diffuseTexture=e,this._teleportationTarget.material=n;var i=fe.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);i.isPickable=!1,i.parent=this._teleportationTarget;var r=new F("animationInnerCircle","position.y",30,F.ANIMATIONTYPE_FLOAT,F.ANIMATIONLOOPMODE_CYCLE),o=[];o.push({frame:0,value:0}),o.push({frame:30,value:.4}),o.push({frame:60,value:0}),r.setKeys(o);var a=new ue;a.setEasingMode($.EASINGMODE_EASEINOUT),r.setEasingFunction(a),i.animations=[],i.animations.push(r),this._scene.beginAnimation(i,0,60,!0),this._hideTeleportationTarget()},e.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},e.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},e.prototype._rotateCamera=function(e){var t=this;if(this.currentVRCamera instanceof yt){e?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var n=o.q.FromRotationMatrix(o.j.RotationY(Math.PI/4*this._rotationAngle)),i=new F("animationRotation","rotationQuaternion",90,F.ANIMATIONTYPE_QUATERNION,F.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),r.push({frame:6,value:n}),i.setKeys(r),i.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(i),this._postProcessMove.animations=[];var a=new F("animationPP","vignetteWeight",90,F.ANIMATIONTYPE_FLOAT,F.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:3,value:4}),s.push({frame:6,value:0}),a.setKeys(s),a.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(a);var l=new F("animationPP2","vignetteStretch",90,F.ANIMATIONTYPE_FLOAT,F.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:3,value:10}),c.push({frame:6,value:0}),l.setKeys(c),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){t._webVRCamera.detachPostProcess(t._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},e.prototype._moveTeleportationSelectorTo=function(e,t,n){if(e.pickedPoint){t._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(e.pickedPoint),this._teleportationTarget.position.copyFrom(e.pickedPoint));var i=this._convertNormalToDirectionOfRay(e.getNormal(!0,!1),n);if(i){var r=o.x.Cross(o.c.Y,i),a=o.x.Cross(i,r);o.x.RotationFromAxisToRef(a,i,r,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},e.prototype.teleportCamera=function(e){var t=this;if(this.currentVRCamera instanceof yt){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),e.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(e),this._workingVector.y+=this.isInVRMode?this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var n=new F("animationCameraTeleportation","position",90,F.ANIMATIONTYPE_VECTOR3,F.ANIMATIONLOOPMODE_CONSTANT);n.setKeys([{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}]),n.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(n),this._postProcessMove.animations=[];var i=new F("animationPP","vignetteWeight",90,F.ANIMATIONTYPE_FLOAT,F.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:0}),r.push({frame:5,value:8}),r.push({frame:11,value:0}),i.setKeys(r),this._postProcessMove.animations.push(i);var o=new F("animationPP2","vignetteStretch",90,F.ANIMATIONTYPE_FLOAT,F.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:0}),a.push({frame:5,value:10}),a.push({frame:11,value:0}),o.setKeys(a),this._postProcessMove.animations.push(o),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){t._webVRCamera.detachPostProcess(t._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,function(){t.onAfterCameraTeleport.notifyObservers(t._workingVector)}),this._hideTeleportationTarget()}},e.prototype._convertNormalToDirectionOfRay=function(e,t){return e&&Math.acos(o.x.Dot(e,t.direction))<Math.PI/2&&e.scaleInPlace(-1),e},e.prototype._castRayAndSelectObject=function(e){if(this.currentVRCamera instanceof yt){var t=e._getForwardRay(this._rayLength),n=this._scene.pickWithRay(t,this._raySelectionPredicate);if(n&&(e._laserPointer&&(n.originMesh=e._laserPointer.parent),this._scene.simulatePointerMove(n,{pointerId:e._id})),e._currentHit=n,n&&n.pickedPoint){if(this._displayGaze){var i=1;e._gazeTracker.isVisible=!0,e._isActionableMesh&&(i=3),this.updateGazeTrackerScale&&(e._gazeTracker.scaling.x=n.distance*i,e._gazeTracker.scaling.y=n.distance*i,e._gazeTracker.scaling.z=n.distance*i);var r=this._convertNormalToDirectionOfRay(n.getNormal(),t);if(r){var a=o.x.Cross(o.c.Y,r),s=o.x.Cross(r,a);o.x.RotationFromAxisToRef(s,r,a,e._gazeTracker.rotation)}e._gazeTracker.position.copyFrom(n.pickedPoint),e._gazeTracker.position.x<0?e._gazeTracker.position.x+=.002:e._gazeTracker.position.x-=.002,e._gazeTracker.position.y<0?e._gazeTracker.position.y+=.002:e._gazeTracker.position.y-=.002,e._gazeTracker.position.z<0?e._gazeTracker.position.z+=.002:e._gazeTracker.position.z-=.002}e._updatePointerDistance(n.distance)}else e._updatePointerDistance(),e._gazeTracker.isVisible=!1;if(n&&n.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(n.pickedMesh)&&n.pickedPoint)return e._currentMeshSelected&&!this._isTeleportationFloor(e._currentMeshSelected)&&this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,void(e._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(n,e,t));if(n.pickedMesh!==e._currentMeshSelected)if(this.meshSelectionPredicate(n.pickedMesh)){this.onNewMeshPicked.notifyObservers(n),e._currentMeshSelected=n.pickedMesh,n.pickedMesh.isPickable&&n.pickedMesh.actionManager?(this.changeGazeColor(new o.e(0,0,1)),this.changeLaserColor(new o.e(.2,.2,1)),e._isActionableMesh=!0):(this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7)),e._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(n.pickedMesh)}catch(e){p.a.Warn("Error in your custom logic onNewMeshSelected: "+e)}}else this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7))}else this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7))}},e.prototype._notifySelectedMeshUnselected=function(e){e&&this.onSelectedMeshUnselected.notifyObservers(e)},e.prototype.changeLaserColor=function(e){this._leftController&&this._leftController._setLaserPointerColor(e),this._rightController&&this._rightController._setLaserPointerColor(e)},e.prototype.changeGazeColor=function(e){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=e,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=e),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=e))},e.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},e.prototype.getClassName=function(){return"VRExperienceHelper"},e}(),kn=function(e){function t(t,n){var i=e.call(this,t,o.x.Zero(),n)||this;return i.minZ=0,i.rotationQuaternion=new o.q,i.cameraRigMode=Ne.a.RIG_MODE_CUSTOM,i.updateUpVectorFromRotation=!0,i._updateNumberOfRigCameras(1),i}return c.d(t,e),t.prototype._updateNumberOfRigCameras=function(e){for(void 0===e&&(e=1);this.rigCameras.length<e;){var t=new bt("view: "+this.rigCameras.length,o.x.Zero(),this.getScene());t.minZ=0,t.parent=this,t.rotationQuaternion=new o.q,t.updateUpVectorFromRotation=!0,this.rigCameras.push(t)}for(;this.rigCameras.length>e;){var n=this.rigCameras.pop();n&&n.dispose()}},t.prototype._updateForDualEyeDebugging=function(e){void 0===e&&(e=.01),this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new o.z(0,0,.5,1),this.rigCameras[0].position.x=-e/2,this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new o.z(.5,0,.5,1),this.rigCameras[1].position.x=e/2,this.rigCameras[1].outputRenderTarget=null},t.prototype.updateFromXRSessionManager=function(e){var n=this;if(!e._currentXRFrame||!e._currentXRFrame.getDevicePose)return!1;var i=e._currentXRFrame.getDevicePose(e._frameOfReference);return!(!i||!i.poseModelMatrix||(o.j.FromFloat32ArrayToRefScaled(i.poseModelMatrix,0,1,t._TmpMatrix),this._scene.useRightHandedSystem||t._TmpMatrix.toggleModelMatrixHandInPlace(),t._TmpMatrix.getTranslationToRef(this.position),t._TmpMatrix.getRotationMatrixToRef(t._TmpMatrix),o.q.FromRotationMatrixToRef(t._TmpMatrix,this.rotationQuaternion),this.computeWorldMatrix(),this._updateNumberOfRigCameras(e._currentXRFrame.views.length),e._currentXRFrame.views.forEach(function(t,r){o.j.FromFloat32ArrayToRefScaled(i.getViewMatrix(t),0,1,n.rigCameras[r]._computedViewMatrix),o.j.FromFloat32ArrayToRefScaled(t.projectionMatrix,0,1,n.rigCameras[r]._projectionMatrix),n._scene.useRightHandedSystem||(n.rigCameras[r]._computedViewMatrix.toggleModelMatrixHandInPlace(),n.rigCameras[r]._projectionMatrix.toggleProjectionMatrixHandInPlace());var a=e._xrSession.baseLayer.getViewport(t),s=e._xrSession.baseLayer.framebufferWidth,l=e._xrSession.baseLayer.framebufferHeight;n.rigCameras[r].viewport.width=a.width/s,n.rigCameras[r].viewport.height=a.height/l,n.rigCameras[r].viewport.x=a.x/s,n.rigCameras[r].viewport.y=a.y/l,n.rigCameras[r].outputRenderTarget=e._sessionRenderTargetTexture}),0))},t._TmpMatrix=new o.j,t}(yt),Nn=function(){function e(e){this.scene=e,this.onXRFrameObservable=new r.c,this.onXRSessionEnded=new r.c,this._sessionRenderTargetTexture=null,this._tmpMatrix=new o.j}return e.prototype.initializeAsync=function(){var e=this;return p.a.Warn("The WebXR APIs are still under development and are subject to change in the future."),this._xrNavigator=navigator,this._xrNavigator.xr?this._xrNavigator.xr.requestDevice().then(function(t){return e._xrDevice=t,e.scene.getEngine()._gl.setCompatibleXRDevice(e._xrDevice)}):Promise.reject("webXR not supported by this browser")},e.prototype.enterXRAsync=function(t,n){var i=this;return this._xrDevice.requestSession(t).then(function(e){return i._xrSession=e,i._xrSession.addEventListener("end",function(){i._sessionRenderTargetTexture=null,i.scene.getEngine().restoreDefaultFramebuffer(),i.scene.getEngine().customAnimationFrameRequester=null,i.onXRSessionEnded.notifyObservers(null),i.scene.getEngine()._renderLoop()},{once:!0}),i._xrSession.baseLayer=new XRWebGLLayer(i._xrSession,i.scene.getEngine()._gl),i._xrSession.requestFrameOfReference(n)}).then(function(t){i._frameOfReference=t,i.scene.getEngine().customAnimationFrameRequester={requestAnimationFrame:i._xrSession.requestAnimationFrame.bind(i._xrSession),renderFunction:function(e,t){i._currentXRFrame=t,i.onXRFrameObservable.notifyObservers(null),i.scene.getEngine()._renderLoop()}},i._sessionRenderTargetTexture=e._CreateRenderTargetTextureFromSession(i._xrSession,i.scene),window.cancelAnimationFrame(i.scene.getEngine()._frameHandler),i.scene.getEngine()._renderLoop()})},e.prototype.exitXRAsync=function(){return this._xrSession.end()},e.prototype.environmentPointHitTestAsync=function(e){var t=this;return new Promise(function(n){var i=new Float32Array([e.origin.x,e.origin.y,e.origin.z]),r=new Float32Array([e.direction.x,e.direction.y,e.direction.z]);t.scene.useRightHandedSystem||(i[2]*=-1,r[2]*=-1),t._xrSession.requestHitTest(i,r,t._frameOfReference).then(function(e){if(e.length>0){o.j.FromFloat32ArrayToRefScaled(e[0].hitMatrix,0,1,t._tmpMatrix);var i=t._tmpMatrix.getTranslation();t.scene.useRightHandedSystem||(i.z*=-1),n(i)}else n(null)}).catch(function(){n(null)})})},e.prototype.supportsSessionAsync=function(e){return this._xrDevice.supportsSession(e).then(function(){return!0}).catch(function(){return!1})},e._CreateRenderTargetTextureFromSession=function(e,t){var n=new ze.a(t.getEngine(),ze.a.DATASOURCE_UNKNOWN,!0);n.width=e.baseLayer.framebufferWidth,n.height=e.baseLayer.framebufferHeight,n._framebuffer=e.baseLayer.framebuffer;var i=new cn("XR renderTargetTexture",{width:n.width,height:n.height},t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return i._texture=n,i},e.prototype.dispose=function(){this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear()},e}();!function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(Pn||(Pn={}));var Fn,Bn=function(){function e(e){this.scene=e,this.state=Pn.NOT_IN_XR,this.onStateChangedObservable=new r.c,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.camera=new kn("",e),this._sessionManager=new Nn(e),this.container=new ke.a("",e),this.camera.parent=this.container}return e.prototype._setState=function(e){this.state=e,this.onStateChangedObservable.notifyObservers(this.state)},e.CreateAsync=function(t){var n=new e(t);return n._sessionManager.initializeAsync().then(function(){return n._supported=!0,n}).catch(function(){return n})},e.prototype.exitXRAsync=function(){return this._setState(Pn.EXITING_XR),this._sessionManager.exitXRAsync()},e.prototype.enterXRAsync=function(e,t){var n=this;if(!this._supported)throw"XR session not supported by this browser";return this._setState(Pn.ENTERING_XR),this._sessionManager.enterXRAsync(e,t).then(function(){n._originalSceneAutoClear=n.scene.autoClear,n._nonVRCamera=n.scene.activeCamera,n.scene.autoClear=!1,n.scene.activeCamera=n.camera,n._sessionManager.onXRFrameObservable.add(function(){n.camera.updateFromXRSessionManager(n._sessionManager)}),n._sessionManager.onXRSessionEnded.addOnce(function(){n.camera.rigCameras.forEach(function(e){e.outputRenderTarget=null}),n.scene.autoClear=n._originalSceneAutoClear,n.scene.activeCamera=n._nonVRCamera,n._sessionManager.onXRFrameObservable.clear(),n._setState(Pn.NOT_IN_XR)}),n._setState(Pn.IN_XR)})},e.prototype.environmentPointHitTestAsync=function(e){return this._sessionManager.environmentPointHitTestAsync(e)},e.prototype.setPositionOfCameraUsingContainer=function(t){this.camera.globalPosition.subtractToRef(t,e._TmpVector),this.container.position.subtractInPlace(e._TmpVector)},e.prototype.rotateCameraByQuaternionUsingContainer=function(e){this.container.rotationQuaternion||(this.container.rotationQuaternion=o.q.FromEulerVector(this.container.rotation)),this.container.rotationQuaternion.multiplyInPlace(e),this.container.position.rotateByQuaternionAroundPointToRef(e,this.camera.globalPosition,this.container.position)},e.prototype.supportsSessionAsync=function(e){return this._supported?this._sessionManager.supportsSessionAsync(e):Promise.resolve(!1)},e.prototype.dispose=function(){this.camera.dispose(),this.container.dispose(),this.onStateChangedObservable.clear(),this._sessionManager.dispose()},e._TmpVector=new o.x,e}(),Un=function(){function e(e,t){this.element=e,this.initializationOptions=t}return e.prototype.update=function(e){},e}(),Vn=function(){},Gn=function(){function e(e,t){var n=this;if(this.scene=e,this._buttons=[],this._activeButton=null,this.activeButtonChangedObservable=new r.c,this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",t.customButtons)this._buttons=t.customButtons;else{var i=document.createElement("button");i.style.cssText="color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-repeat:no-repeat; background-position: center; outline: none;",i.innerText="HMD",this._buttons.push(new Un(i,{immersive:!0,outputContext:t.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",this.element.innerText=e===this?"EXIT":"HMD"};var o=document.createElement("button");o.style.cssText=i.style.cssText,o.innerText="Window",this._buttons.push(new Un(o,{immersive:!1,environmentIntegration:!0,outputContext:t.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",this.element.innerText=e===this?"EXIT":"Window"},this._updateButtons(null)}var a=e.getEngine().getRenderingCanvas();a&&a.parentNode&&(a.parentNode.appendChild(this._overlay),e.onDisposeObservable.addOnce(function(){n.dispose()}))}return e.CreateAsync=function(t,n,i){var r=this,o=new e(t,i),a=o._buttons.map(function(e){return n.supportsSessionAsync(e.initializationOptions)});return n.onStateChangedObservable.add(function(e){e==Pn.NOT_IN_XR&&o._updateButtons(null)}),Promise.all(a).then(function(e){return e.forEach(function(e,t){e&&(o._overlay.appendChild(o._buttons[t].element),o._buttons[t].element.onclick=function(){return c.b(r,void 0,void 0,function(){return c.e(this,function(e){switch(e.label){case 0:return n.state!=Pn.IN_XR?[3,2]:(o._updateButtons(null),[4,n.exitXRAsync()]);case 1:return e.sent(),[2];case 2:return n.state!=Pn.NOT_IN_XR?[3,4]:(o._updateButtons(o._buttons[t]),[4,n.enterXRAsync(o._buttons[t].initializationOptions,"eye-level")]);case 3:e.sent(),e.label=4;case 4:return[2]}})})})}),o})},e.prototype._updateButtons=function(e){var t=this;this._activeButton=e,this._buttons.forEach(function(e){e.update(t._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e.prototype.dispose=function(){var e=this.scene.getEngine().getRenderingCanvas();e&&e.parentNode&&e.parentNode.contains(this._overlay)&&e.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},e}(),zn=function(){function e(e){this.pointer=new ke.a("controllerPointer",e)}return e.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.pointer.dispose()},e}(),jn=function(){function e(e){var t=this;this.helper=e,this.controllers=[],this._tmpMatrix=new o.j,this._frameObserver=e._sessionManager.onXRFrameObservable.add(function(){if(e._sessionManager._currentXRFrame&&e._sessionManager._currentXRFrame.getDevicePose){var n=e._sessionManager._currentXRFrame;e._sessionManager._xrSession.getInputSources().forEach(function(i,r){var a=n.getInputPose(i,e._sessionManager._frameOfReference);if(a){t.controllers.length<=r&&t.controllers.push(new zn(e.container.getScene()));var s=t.controllers[r];a.gripMatrix&&(s.grip||(s.grip=new ke.a("controllerGrip",e.container.getScene())),o.j.FromFloat32ArrayToRefScaled(a.gripMatrix,0,1,t._tmpMatrix),s.grip.getScene().useRightHandedSystem||t._tmpMatrix.toggleModelMatrixHandInPlace(),s.grip.rotationQuaternion||(s.grip.rotationQuaternion=new o.q),t._tmpMatrix.decompose(s.grip.scaling,s.grip.rotationQuaternion,s.grip.position)),o.j.FromFloat32ArrayToRefScaled(a.targetRay.transformMatrix,0,1,t._tmpMatrix),s.pointer.getScene().useRightHandedSystem||t._tmpMatrix.toggleModelMatrixHandInPlace(),s.pointer.rotationQuaternion||(s.pointer.rotationQuaternion=new o.q),t._tmpMatrix.decompose(s.pointer.scaling,s.pointer.rotationQuaternion,s.pointer.position)}})}})}return e.prototype.dispose=function(){this.controllers.forEach(function(e){e.dispose()}),this.helper._sessionManager.onXRFrameObservable.remove(this._frameObserver)},e}(),Hn=function(){function e(e,t){var n=this;this._canvas=null,this.canvasContext=null,t||((t=document.createElement("canvas")).style.cssText="position:absolute; bottom:0px;right:0px;z-index:10;width:100%;height:100%;background-color: #000000;"),this._setManagedOutputCanvas(t),e.onStateChangedObservable.add(function(t){t==Pn.ENTERING_XR?n._addCanvas():e.state==Pn.NOT_IN_XR&&n._removeCanvas()})}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype._setManagedOutputCanvas=function(e){this._removeCanvas(),e?(this._canvas=e,this.canvasContext=this._canvas.getContext("xrpresent")):(this._canvas=null,this.canvasContext=null)},e.prototype._addCanvas=function(){this._canvas&&document.body.appendChild(this._canvas)},e.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&document.body.removeChild(this._canvas)},e}(),Wn=(Fn={root:0,found:!1},function(e,t,n,i){Fn.root=0,Fn.found=!1;var r=t*t-4*e*n;if(r<0)return Fn;var o=Math.sqrt(r),a=(-t-o)/(2*e),s=(-t+o)/(2*e);if(a>s){var l=s;s=a,a=l}return a>0&&a<i?(Fn.root=a,Fn.found=!0,Fn):s>0&&s<i?(Fn.root=s,Fn.found=!0,Fn):Fn}),Xn=function(){function e(){this._collisionPoint=o.x.Zero(),this._planeIntersectionPoint=o.x.Zero(),this._tempVector=o.x.Zero(),this._tempVector2=o.x.Zero(),this._tempVector3=o.x.Zero(),this._tempVector4=o.x.Zero(),this._edge=o.x.Zero(),this._baseToVertex=o.x.Zero(),this._destinationPoint=o.x.Zero(),this._slidePlaneNormal=o.x.Zero(),this._displacementVector=o.x.Zero(),this._radius=o.x.One(),this._retry=0,this._basePointWorld=o.x.Zero(),this._velocityWorld=o.x.Zero(),this._normalizedVelocity=o.x.Zero(),this._collisionMask=-1}return Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e,t,n){this._velocity=t,o.x.NormalizeToRef(t,this._normalizedVelocity),this._basePoint=e,e.multiplyToRef(this._radius,this._basePointWorld),t.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=n,this.collisionFound=!1},e.prototype._checkPointInTriangle=function(e,t,n,i,r){t.subtractToRef(e,this._tempVector),n.subtractToRef(e,this._tempVector2),o.x.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var a=o.x.Dot(this._tempVector4,r);return!(a<0)&&(i.subtractToRef(e,this._tempVector3),o.x.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((a=o.x.Dot(this._tempVector4,r))<0)&&(o.x.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(a=o.x.Dot(this._tempVector4,r))>=0))},e.prototype._canDoCollision=function(e,t,n,i){var r=o.x.Distance(this._basePointWorld,e),a=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(r>this._velocityWorldLength+a+t||!function(e,t,n,i){return!(e.x>n.x+i||n.x-i>t.x||e.y>n.y+i||n.y-i>t.y||e.z>n.z+i||n.z-i>t.z)}(n,i,this._basePointWorld,this._velocityWorldLength+a))},e.prototype._testTriangle=function(e,t,n,i,r,a){var s,l=!1;t||(t=[]),t[e]||(t[e]=new o.n(0,0,0,0),t[e].copyFromPoints(n,i,r));var c=t[e];if(a||c.isFrontFacingTo(this._normalizedVelocity,0)){var u=c.signedDistanceTo(this._basePoint),h=o.x.Dot(c.normal,this._velocity);if(0==h){if(Math.abs(u)>=1)return;l=!0,s=0}else{var d=(1-u)/h;if((s=(-1-u)/h)>d){var f=d;d=s,s=f}if(s>1||d<0)return;s<0&&(s=0),s>1&&(s=1)}this._collisionPoint.copyFromFloats(0,0,0);var p=!1,g=1;if(l||(this._basePoint.subtractToRef(c.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(s,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,i,r,c.normal)&&(p=!0,g=s,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!p){var m=this._velocity.lengthSquared(),_=m;this._basePoint.subtractToRef(n,this._tempVector);var v=2*o.x.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=Wn(_,v,b,g);y.found&&(g=y.root,p=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(i,this._tempVector),v=2*o.x.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(y=Wn(_,v,b,g)).found&&(g=y.root,p=!0,this._collisionPoint.copyFrom(i)),this._basePoint.subtractToRef(r,this._tempVector),v=2*o.x.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(y=Wn(_,v,b,g)).found&&(g=y.root,p=!0,this._collisionPoint.copyFrom(r)),i.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var T=this._edge.lengthSquared(),E=o.x.Dot(this._edge,this._velocity),x=o.x.Dot(this._edge,this._baseToVertex);if(_=T*-m+E*E,v=T*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*E*x,b=T*(1-this._baseToVertex.lengthSquared())+x*x,(y=Wn(_,v,b,g)).found){var C=(E*y.root-x)/T;C>=0&&C<=1&&(g=y.root,p=!0,this._edge.scaleInPlace(C),n.addToRef(this._edge,this._collisionPoint))}r.subtractToRef(i,this._edge),i.subtractToRef(this._basePoint,this._baseToVertex),T=this._edge.lengthSquared(),E=o.x.Dot(this._edge,this._velocity),x=o.x.Dot(this._edge,this._baseToVertex),_=T*-m+E*E,v=T*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*E*x,b=T*(1-this._baseToVertex.lengthSquared())+x*x,(y=Wn(_,v,b,g)).found&&(C=(E*y.root-x)/T)>=0&&C<=1&&(g=y.root,p=!0,this._edge.scaleInPlace(C),i.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),T=this._edge.lengthSquared(),E=o.x.Dot(this._edge,this._velocity),x=o.x.Dot(this._edge,this._baseToVertex),_=T*-m+E*E,v=T*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*E*x,b=T*(1-this._baseToVertex.lengthSquared())+x*x,(y=Wn(_,v,b,g)).found&&(C=(E*y.root-x)/T)>=0&&C<=1&&(g=y.root,p=!0,this._edge.scaleInPlace(C),r.addToRef(this._edge,this._collisionPoint))}if(p){var S=g*this._velocity.length();(!this.collisionFound||S<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=S,this.collisionFound=!0)}}},e.prototype._collide=function(e,t,n,i,r,o,a){for(var s=i;s<r;s+=3)this._testTriangle(s,e,t[n[s+2]-o],t[n[s+1]-o],t[n[s]-o],a)},e.prototype._getResponse=function(e,t){e.addToRef(t,this._destinationPoint),t.scaleInPlace(this._nearestDistance/t.length()),this._basePoint.addToRef(t,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(o.n.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,t)},e}(),Yn=function(){function e(){this._scaledPosition=o.x.Zero(),this._scaledVelocity=o.x.Zero(),this._finalPosition=o.x.Zero()}return e.prototype.getNewPosition=function(e,t,n,i,r,o,a){e.divideToRef(n._radius,this._scaledPosition),t.divideToRef(n._radius,this._scaledVelocity),n.collidedMesh=null,n._retry=0,n._initialVelocity=this._scaledVelocity,n._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,n,i,this._finalPosition,r),this._finalPosition.multiplyInPlace(n._radius),o(a,this._finalPosition,n.collidedMesh)},e.prototype.createCollider=function(){return new Xn},e.prototype.init=function(e){this._scene=e},e.prototype._collideWithWorld=function(e,t,n,i,r,o){void 0===o&&(o=null);var a=10*me.b.CollisionsEpsilon;if(n._retry>=i)r.copyFrom(e);else{var s=o?o.collisionMask:n.collisionMask;n._initialize(e,t,a);for(var l=0;l<this._scene.meshes.length;l++){var c=this._scene.meshes[l];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==o&&0!=(s&c.collisionGroup)&&c._checkCollision(n)}n.collisionFound?(0===t.x&&0===t.y&&0===t.z||n._getResponse(e,t),t.length()<=a?r.copyFrom(e):(n._retry++,this._collideWithWorld(e,t,n,i,r,o))):e.addToRef(t,r)}},e}();W.a.CollisionCoordinatorFactory=function(){return new Yn};var Kn=n(50),Qn=n(81),qn=n(108),Zn=n(77),Jn=n(43),$n=n(82),ei=function(){function e(e,t,n,i,r,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=n,this._depth=i,this._maxDepth=r,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),e.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++)this.blocks[t].addEntry(e);else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},e.prototype.removeEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++)this.blocks[t].removeEntry(e);else{var n=this.entries.indexOf(e);n>-1&&this.entries.splice(n,1)}},e.prototype.addEntries=function(e){for(var t=0;t<e.length;t++)this.addEntry(e[t])},e.prototype.select=function(e,t,n){if(Zn.a.IsInFrustum(this._boundingVectors,e)){if(this.blocks){for(var i=0;i<this.blocks.length;i++)this.blocks[i].select(e,t,n);return}n?t.concat(this.entries):t.concatWithNoDuplicate(this.entries)}},e.prototype.intersects=function(e,t,n,i){if(Zn.a.IntersectsSphere(this._minPoint,this._maxPoint,e,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++)this.blocks[r].intersects(e,t,n,i);return}i?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},e.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var n=0;n<this.blocks.length;n++)this.blocks[n].intersectsRay(e,t);return}t.concatWithNoDuplicate(this.entries)}},e.prototype.createInnerBlocks=function(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},e._CreateBlocks=function(t,n,i,r,a,s,l,c){l.blocks=new Array;for(var u=new o.x((n.x-t.x)/2,(n.y-t.y)/2,(n.z-t.z)/2),h=0;h<2;h++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var p=new e(t.add(u.multiplyByFloats(h,d,f)),t.add(u.multiplyByFloats(h+1,d+1,f+1)),r,a+1,s,c);p.addEntries(i),l.blocks.push(p)}},e}(),ti=function(){function e(e,t,n){void 0===n&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=t||64,this._selectionContent=new Gt.b(1024),this._creationFunc=e}return e.prototype.update=function(e,t,n){ei._CreateBlocks(e,t,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++)this.blocks[t].addEntry(e)},e.prototype.removeMesh=function(e){for(var t=0;t<this.blocks.length;t++)this.blocks[t].removeEntry(e)},e.prototype.select=function(e,t){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++)this.blocks[n].select(e,this._selectionContent,t);return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(e,t,n){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++)this.blocks[i].intersects(e,t,this._selectionContent,n);return n?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++)this.blocks[t].intersectsRay(e,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.CreationFuncForMeshes=function(e,t){var n=e.getBoundingInfo();!e.isBlocked&&n.boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},e.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},e}();W.a.prototype.createOrUpdateSelectionOctree=function(e,t){void 0===e&&(e=64),void 0===t&&(t=2);var n=this._getComponent(xe.a.NAME_OCTREE);n||(n=new ni(this),this._addComponent(n)),this._selectionOctree||(this._selectionOctree=new ti(ti.CreationFuncForMeshes,e,t));var i=this.getWorldExtends();return this._selectionOctree.update(i.min,i.max,this.meshes),this._selectionOctree},Object.defineProperty(W.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),ke.a.prototype.createOrUpdateSubmeshesOctree=function(e,t){void 0===e&&(e=64),void 0===t&&(t=2);var n=this.getScene(),i=n._getComponent(xe.a.NAME_OCTREE);i||(i=new ni(n),n._addComponent(i)),this._submeshesOctree||(this._submeshesOctree=new ti(ti.CreationFuncForSubMeshes,e,t)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(r.minimumWorld,r.maximumWorld,this.subMeshes),this._submeshesOctree};var ni=function(){function e(e){this.name=xe.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new wt.a(o.x.Zero(),new o.x(1,1,1)),this.scene=e,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return e.prototype.register=function(){var e=this;this.scene.onMeshRemovedObservable.add(function(t){var n=e.scene.selectionOctree;if(null!=n){var i=n.dynamicContent.indexOf(t);-1!==i&&n.dynamicContent.splice(i,1)}}),this.scene.onMeshImportedObservable.add(function(t){var n=e.scene.selectionOctree;null!=n&&n.addMesh(t)})},e.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},e.prototype.getActiveSubMeshCandidates=function(e){return e._submeshesOctree&&e.useOctreeForRenderingSelection?e._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(e)},e.prototype.getIntersectingSubMeshCandidates=function(e,t){return e._submeshesOctree&&e.useOctreeForPicking?(wt.a.TransformToRef(t,e.getWorldMatrix(),this._tempRay),e._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(e)},e.prototype.getCollidingSubMeshCandidates=function(e,t){if(e._submeshesOctree&&e.useOctreeForCollisions){var n=t._velocityWorldLength+Math.max(t._radius.x,t._radius.y,t._radius.z);return e._submeshesOctree.intersects(t._basePointWorld,n)}return this.scene._getDefaultSubMeshCandidates(e)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e}(),ii=n(74),ri=n(128),oi=function(){this._timeElapsedQueryEnded=!1},ai=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=ke.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=ke.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};me.b.prototype.createQuery=function(){return this._gl.createQuery()},me.b.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},me.b.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},me.b.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},me.b.prototype.beginOcclusionQuery=function(e,t){var n=this._getGlAlgorithmType(e);return this._gl.beginQuery(n,t),this},me.b.prototype.endOcclusionQuery=function(e){var t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},me.b.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},me.b.prototype._deleteTimeQuery=function(e){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},me.b.prototype._getTimeQueryResult=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},me.b.prototype._getTimeQueryAvailability=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},me.b.prototype.startTimeQuery=function(){var e=this.getCaps(),t=e.timerQuery;if(!t)return null;var n=new oi;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)n._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(n._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;n._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,n._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,n._timeElapsedQuery),this._currentNonTimestampToken=n}return n},me.b.prototype.endTimeQuery=function(e){var t=this.getCaps(),n=t.timerQuery;if(!n||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),n.queryCounterEXT(e._endTimeQuery,n.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;n.endQueryEXT?n.endQueryEXT(n.TIME_ELAPSED_EXT):this._gl.endQuery(n.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var i=this._gl.getParameter(n.GPU_DISJOINT_EXT),r=!1;if(e._endTimeQuery?r=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(r=this._getTimeQueryAvailability(e._timeElapsedQuery)),r&&!i){var o=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var a=this._getTimeQueryResult(e._startTimeQuery);o=this._getTimeQueryResult(e._endTimeQuery)-a,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;o=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},me.b.prototype._getGlAlgorithmType=function(e){return e===ke.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(ke.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(ke.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new ai),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(ke.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(ke.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(ke.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(ke.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),ke.a.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===ke.a.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2)return e.isOccluded=!1,!1;if(!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var n=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=1!==n}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return!1;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==ke.a.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var i=this.getScene();if(i.getBoundingBoxRenderer){var r=i.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery),r.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return e.isOccluded},me.b.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},me.b.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},me.b.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},me.b.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},me.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},me.b.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},me.b.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)};var si=n(107),li=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),ci=function(){function e(e,t){this.type=e,this.event=t}return e.GetTypeFromCharacter=function(e){switch(e){case 67:return li.COPY;case 86:return li.PASTE;case 88:return li.CUT;default:return-1}},e}(),ui=n(59),hi=n(55),di=function(){function e(e,t,n){this.lengthComputable=e,this.loaded=t,this.total=n}return e.FromProgressEvent=function(t){return new e(t.lengthComputable,t.loaded,t.total)},e}(),fi=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return hi.a.ForceFullSceneLoadingForIncremental},set:function(e){hi.a.ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return hi.a.ShowLoadingScreen},set:function(e){hi.a.ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return hi.a.loggingLevel},set:function(e){hi.a.loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return hi.a.CleanBoneMatrixWeights},set:function(e){hi.a.CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),e._getDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._getPluginForExtension=function(t){return e._registeredPlugins[t]||(p.a.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),e._getDefaultPlugin())},e._getPluginForDirectLoad=function(t){for(var n in e._registeredPlugins){var i=e._registeredPlugins[n].plugin;if(i.canDirectLoad&&i.canDirectLoad(t))return e._registeredPlugins[n]}return e._getDefaultPlugin()},e._getPluginForFilename=function(t){var n=t.indexOf("?");-1!==n&&(t=t.substring(0,n));var i=t.lastIndexOf("."),r=t.substring(i,t.length).toLowerCase();return e._getPluginForExtension(r)},e._getDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},e._loadData=function(t,n,i,r,o,a,s){var l,c=e._getDirectLoad(t.name),u=s?e._getPluginForExtension(s):c?e._getPluginForDirectLoad(t.name):e._getPluginForFilename(t.name);if(!(l=u.plugin.createPlugin?u.plugin.createPlugin():u.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";var h,d=u.isBinary;e.OnPluginActivatedObservable.notifyObservers(l);var f=function(e,t){n.isDisposed?o("Scene has been disposed"):(n.offlineProvider=h,i(l,e,t))},p=null,g=!1,m=l.onDisposeObservable;m&&m.add(function(){g=!0,p&&(p.abort(),p=null),a()});var _=function(){g||(p=be.h.LoadFile(t.url,f,r?function(e){r(di.FromProgressEvent(e))}:void 0,h,d,function(e,t){o("Failed to load scene."+(t?" "+t.message:""),t)}))};if(c)return f(c),l;var v=t.file||ui.a.FilesToLoad[t.name.toLowerCase()];if(-1===t.rootUrl.indexOf("file:")||-1!==t.rootUrl.indexOf("file:")&&!v){var b=n.getEngine(),y=b.enableOfflineSupport;if(y){for(var T=!1,E=0,x=n.disableOfflineSupportExceptionRules;E<x.length;E++)if(x[E].test(t.url)){T=!0;break}y=!T}y&&me.b.OfflineProviderFactory?h=me.b.OfflineProviderFactory(t.url,_,b.disableManifestCheck):_()}else v?p=be.h.ReadFile(v,f,r,d):o("Unable to find file named "+t.name);return l},e._getFileInfo=function(e,t){var n,i,r=null;if(t)if(t.name)n=e+t.name,i=t.name,r=t;else{var o=t;if("/"===o.substr(0,1))return be.h.Error("Wrong sceneFilename parameter"),null;n=e+o,i=o}else n=e,i=be.h.GetFilename(e),e=be.h.GetFolderPath(e);return{url:n,rootUrl:e,name:i,file:r}},e.GetPluginForExtension=function(t){return e._getPluginForExtension(t).plugin},e.IsPluginForExtensionAvailable=function(t){return!!e._registeredPlugins[t]},e.RegisterPlugin=function(t){if("string"==typeof t.extensions)e._registeredPlugins[t.extensions.toLowerCase()]={plugin:t,isBinary:!1};else{var n=t.extensions;Object.keys(n).forEach(function(i){e._registeredPlugins[i.toLowerCase()]={plugin:t,isBinary:n[i].isBinary}})}},e.ImportMesh=function(t,n,i,r,o,a,s,l){if(void 0===i&&(i=""),void 0===r&&(r=A.a.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),!r)return p.a.Error("No scene available to import mesh to"),null;var c=e._getFileInfo(n,i);if(!c)return null;var u={};r._addPendingData(u);var h=function(){r._removePendingData(u)},d=function(e,t){var n="Unable to import meshes from "+c.url+": "+e;s?s(r,n,t):p.a.Error(n),h()},f=a?function(e){try{a(e)}catch(e){d("Error in onProgress callback",e)}}:void 0,g=function(e,t,n,i){if(r.importedMeshesFiles.push(c.url),o)try{o(e,t,n,i)}catch(e){d("Error in onSuccess callback",e)}r._removePendingData(u)};return e._loadData(c,r,function(e,n,i){if(e.rewriteRootURL&&(c.rootUrl=e.rewriteRootURL(c.rootUrl,i)),e.importMesh){var o=e,a=new Array,s=new Array,l=new Array;if(!o.importMesh(t,r,n,c.rootUrl,a,s,l,d))return;r.loadingPluginName=e.name,g(a,s,l,[])}else e.importMeshAsync(t,r,n,c.rootUrl,f,c.name).then(function(t){r.loadingPluginName=e.name,g(t.meshes,t.particleSystems,t.skeletons,t.animationGroups)}).catch(function(e){d(e.message,e)})},f,d,h,l)},e.ImportMeshAsync=function(t,n,i,r,o,a){return void 0===i&&(i=""),void 0===r&&(r=A.a.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),new Promise(function(s,l){e.ImportMesh(t,n,i,r,function(e,t,n,i){s({meshes:e,particleSystems:t,skeletons:n,animationGroups:i})},o,function(e,t,n){l(n||new Error(t))},a)})},e.Load=function(t,n,i,r,o,a,s){return void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedEngine),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),i?e.Append(t,n,new W.a(i),r,o,a,s):(be.h.Error("No engine available"),null)},e.LoadAsync=function(t,n,i,r,o){return void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedEngine),void 0===r&&(r=null),void 0===o&&(o=null),new Promise(function(a,s){e.Load(t,n,i,function(e){a(e)},r,function(e,t,n){s(n||new Error(t))},o)})},e.Append=function(t,n,i,r,o,a,s){if(void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!i)return p.a.Error("No scene available to append to"),null;var l=e._getFileInfo(t,n);if(!l)return null;e.ShowLoadingScreen&&i.getEngine().displayLoadingUI();var c={};i._addPendingData(c);var u=function(){i._removePendingData(c),i.getEngine().hideLoadingUI()},h=function(e,t){var n="Unable to load from "+l.url+(e?": "+e:"");a?a(i,n,t):p.a.Error(n),u()},d=o?function(e){try{o(e)}catch(e){h("Error in onProgress callback",e)}}:void 0,f=function(){if(r)try{r(i)}catch(e){h("Error in onSuccess callback",e)}i._removePendingData(c)};return e._loadData(l,i,function(t,n){if(t.load){if(!t.load(i,n,l.rootUrl,h))return;i.loadingPluginName=t.name,f()}else t.loadAsync(i,n,l.rootUrl,d,l.name).then(function(){i.loadingPluginName=t.name,f()}).catch(function(e){h(e.message,e)});e.ShowLoadingScreen&&i.executeWhenReady(function(){i.getEngine().hideLoadingUI()})},d,h,u,s)},e.AppendAsync=function(t,n,i,r,o){return void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),new Promise(function(a,s){e.Append(t,n,i,function(e){a(e)},r,function(e,t,n){s(n||new Error(t))},o)})},e.LoadAssetContainer=function(t,n,i,r,o,a,s){if(void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!i)return p.a.Error("No scene available to load asset container to"),null;var l=e._getFileInfo(t,n);if(!l)return null;var c={};i._addPendingData(c);var u=function(){i._removePendingData(c)},h=function(e,t){var n="Unable to load assets from "+l.url+(e?": "+e:"");a?a(i,n,t):p.a.Error(n),u()},d=o?function(e){try{o(e)}catch(e){h("Error in onProgress callback",e)}}:void 0,f=function(e){if(r)try{r(e)}catch(e){h("Error in onSuccess callback",e)}i._removePendingData(c)};return e._loadData(l,i,function(t,n){if(t.loadAssetContainer){var r=t.loadAssetContainer(i,n,l.rootUrl,h);if(!r)return;i.loadingPluginName=t.name,f(r)}else t.loadAssetContainerAsync?t.loadAssetContainerAsync(i,n,l.rootUrl,d,l.name).then(function(e){i.loadingPluginName=t.name,f(e)}).catch(function(e){h(e.message,e)}):h("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");e.ShowLoadingScreen&&i.executeWhenReady(function(){i.getEngine().hideLoadingUI()})},d,h,u,s)},e.LoadAssetContainerAsync=function(t,n,i,r,o){return void 0===n&&(n=""),void 0===i&&(i=A.a.LastCreatedScene),void 0===r&&(r=null),void 0===o&&(o=null),new Promise(function(a,s){e.LoadAssetContainer(t,n,i,function(e){a(e)},r,function(e,t,n){s(n||new Error(t))},o)})},e.NO_LOGGING=g.a.SCENELOADER_NO_LOGGING,e.MINIMAL_LOGGING=g.a.SCENELOADER_MINIMAL_LOGGING,e.SUMMARY_LOGGING=g.a.SCENELOADER_SUMMARY_LOGGING,e.DETAILED_LOGGING=g.a.SCENELOADER_DETAILED_LOGGING,e.OnPluginActivatedObservable=new r.c,e._registeredPlugins={},e}(),pi=function(e){function t(t){var n=e.call(this,t)||this;return n.controllerType=Pt.DAYDREAM,n}return c.d(t,e),t.prototype.initControllerMesh=function(e,n){var i=this;fi.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){if(0===e){var i=this.onTriggerStateChangedObservable;i&&i.notifyObservers(t)}else p.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(pi.GAMEPAD_ID_PREFIX)},create:function(e){return new pi(e)}});var gi=function(e){function t(t){var n=e.call(this,t)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=Pt.GEAR_VR,n._calculatedPosition=new o.x("left"==n.hand?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return c.d(t,e),t.prototype.initControllerMesh=function(e,n){var i=this;fi.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(t){var r=new fe.a("",e);t[1].parent=r,t[1].position.z=-.15,i._defaultModel=r,i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){if(e<this._buttonIndexToObservableNameMap.length){var i=this[this._buttonIndexToObservableNameMap[e]];i&&i.notifyObservers(t)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(gi.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")},create:function(e){return new gi(e)}});var mi=function(e){function t(t){return e.call(this,t)||this}return c.d(t,e),t.prototype.initControllerMesh=function(e,n){var i=this;fi.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){console.log("Button id: "+e+"state: "),console.dir(t)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(_n);Lt._DefaultControllerFactory=function(e){return new mi(e)};var _i=function(e){function t(t){var n=e.call(this,t)||this;return n.onSecondaryTriggerStateChangedObservable=new r.c,n.onThumbRestChangedObservable=new r.c,n.controllerType=Pt.OCULUS,n}return c.d(t,e),t.prototype.initControllerMesh=function(e,n){var i=this;fi.ImportMesh("",t.MODEL_BASE_URL,"left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,n){var i=t,r="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(i);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-i.value,this._defaultModel.getChildren()[3].position.y=.005*-i.value,this._defaultModel.getChildren()[3].position.z=.005*-i.value),void this.onTriggerStateChangedObservable.notifyObservers(i);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=r*i.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(i);case 3:return this._defaultModel&&(this._defaultModel.getChildren()[1].position.y=i.pressed?-.001:0),void this.onMainButtonStateChangedObservable.notifyObservers(i);case 4:return this._defaultModel&&(this._defaultModel.getChildren()[2].position.y=i.pressed?-.001:0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(i);case 5:return void this.onThumbRestChangedObservable.notifyObservers(i)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new _i(e)}});var vi=function(e){function t(t){var n=e.call(this,t)||this;return n.controllerType=Pt.VIVE,n._invertLeftStickY=!0,n}return c.d(t,e),t.prototype.initControllerMesh=function(e,n){var i=this;fi.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,n){var i=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(i);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-i.value),void this.onTriggerStateChangedObservable.notifyObservers(i);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(i);case 3:return this._defaultModel&&(this._defaultModel.getChildren()[2].position.y=i.pressed?-.001:0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(i)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new vi(e)}});var bi=function(){this.buttonMeshes={},this.axisMeshes={}},yi=function(e){function t(t){var n=e.call(this,t)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:kt.POINTING_POSE},n.onTrackpadChangedObservable=new r.c,n.onTrackpadValuesChangedObservable=new r.c,n.trackpad={x:0,y:0},n.controllerType=Pt.WINDOWS,n._loadedMeshInfo=null,n}return c.d(t,e),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var t=0;t<this._mapping.axisMeshNames.length;t++)this._lerpAxisTransform(t,this.browserGamepad.axes[t])},t.prototype._handleButtonChange=function(e,t,n){var i=this._mapping.buttons[e];if(i){this._updateTrackpad();var r=this[this._mapping.buttonObservableNames[i]];r&&r.notifyObservers(t),this._lerpButtonTransform(i,t.value)}},t.prototype._lerpButtonTransform=function(e,t){if(this._loadedMeshInfo){var n=this._loadedMeshInfo.buttonMeshes[e];n.unpressed.rotationQuaternion&&n.pressed.rotationQuaternion&&n.value.rotationQuaternion&&(o.q.SlerpToRef(n.unpressed.rotationQuaternion,n.pressed.rotationQuaternion,t,n.value.rotationQuaternion),o.x.LerpToRef(n.unpressed.position,n.pressed.position,t,n.value.position))}},t.prototype._lerpAxisTransform=function(e,t){if(this._loadedMeshInfo){var n=this._loadedMeshInfo.axisMeshes[e];if(n&&n.min.rotationQuaternion&&n.max.rotationQuaternion&&n.value.rotationQuaternion){var i=.5*t+.5;o.q.SlerpToRef(n.min.rotationQuaternion,n.max.rotationQuaternion,i,n.value.rotationQuaternion),o.x.LerpToRef(n.min.position,n.max.position,i,n.value.position)}}},t.prototype.initControllerMesh=function(e,n,i){var r,o,a=this;if(void 0===i&&(i=!1),fi.IsPluginForExtensionAvailable(".glb")){var s="default";if(this.id&&!i){var l=this.id.match(t.GAMEPAD_ID_PATTERN);s=l&&l[0]||s}o="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,r=t.MODEL_BASE_URL+s+"/"}else p.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),r=mi.MODEL_BASE_URL,o=mi.MODEL_FILENAME;fi.ImportMesh("",r,o,e,function(t){a._loadedMeshInfo=a.processModel(e,t),a._loadedMeshInfo&&(a._defaultModel=a._loadedMeshInfo.rootNode,a.attachToMesh(a._defaultModel),n&&n(a._defaultModel))},null,function(e,t){p.a.Log(t),p.a.Warn("Failed to retrieve controller model from the remote server: "+r+o),i||a.initControllerMesh(e,n,!0)})},t.prototype.processModel=function(e,t){for(var n=null,i=new fe.a(this.id+" "+this.hand,e),r=null,o=0;o<t.length;o++){var a=t[o];if(!a.parent){a.isPickable=!1,r=a;break}}return r?(r.setParent(i),n=this.createMeshInfo(i)):p.a.Warn("Could not find root node in model file."),n},t.prototype.createMeshInfo=function(e){var t,n=new bi;for(n.rootNode=e,n.buttonMeshes={},n.axisMeshes={},t=0;t<this._mapping.buttons.length;t++){var i=this._mapping.buttonMeshNames[this._mapping.buttons[t]];if(i){var r=c(e,i);if(r){var o={index:t,value:u(r,"VALUE"),pressed:u(r,"PRESSED"),unpressed:u(r,"UNPRESSED")};o.value&&o.pressed&&o.unpressed?n.buttonMeshes[this._mapping.buttons[t]]=o:p.a.Warn("Missing button submesh under mesh with name: "+i+"(VALUE: "+!!o.value+", PRESSED: "+!!o.pressed+", UNPRESSED:"+!!o.unpressed+")")}else p.a.Warn("Missing button mesh with name: "+i)}else p.a.Log("Skipping unknown button at index: "+t+" with mapped name: "+this._mapping.buttons[t])}for(t=0;t<this._mapping.axisMeshNames.length;t++){var a=this._mapping.axisMeshNames[t];if(a){var s=c(e,a);if(s){var l={index:t,value:u(s,"VALUE"),min:u(s,"MIN"),max:u(s,"MAX")};l.value&&l.min&&l.max?n.axisMeshes[t]=l:p.a.Warn("Missing axis submesh under mesh with name: "+a+"(VALUE: "+!!l.value+", MIN: "+!!l.min+", MAX:"+!!l.max+")")}else p.a.Warn("Missing axis mesh with name: "+a)}else p.a.Log("Skipping unknown axis at index: "+t)}return n.pointingPoseNode=c(e,this._mapping.pointingPoseMeshName),n.pointingPoseNode?this._pointingPoseNode=n.pointingPoseNode:p.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),n;function c(e,t){return e.getChildren(function(e){return e.name===t},!1)[0]}function u(e,t){return e.getChildren(function(e){return e.name==t},!0)[0]}},t.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,t);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),i=n.getTranslation(),r=new o.x(0,0,-1),a=o.x.TransformNormal(r,n),s=o.x.Normalize(a);return new wt.a(i,s,t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(yi.GAMEPAD_ID_PREFIX)},create:function(e){return new yi(e)}});var Ti=n(58),Ei=n(52),xi=n(48),Ci=n(41),Si=function(e){function t(t,n,i){void 0===n&&(n=o.e.Gray()),void 0===i&&(i=Ci.a.DefaultUtilityLayer);var a=e.call(this,i)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new r.c,a.uniformScaling=!1,a._coloredMaterial=new bn.a("",i.utilityLayerScene),a._coloredMaterial.diffuseColor=n,a._coloredMaterial.specularColor=n.subtract(new o.e(.1,.1,.1));var s=new bn.a("",i.utilityLayerScene);s.diffuseColor=n.add(new o.e(.3,.3,.3));var l=new ke.a("",i.utilityLayerScene),c=Ei.a.CreateBox("yPosMesh",{size:.4},i.utilityLayerScene),u=Mn.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},i.utilityLayerScene);u.material=a._coloredMaterial,l.addChild(c),l.addChild(u),c.scaling.scaleInPlace(.1),c.material=a._coloredMaterial,c.rotation.x=Math.PI/2,c.position.z+=.3,u.position.z+=.1375,u.rotation.x=Math.PI/2,l.lookAt(a._rootMesh.position.add(t)),a._rootMesh.addChild(l),l.scaling.scaleInPlace(1/3),a.dragBehavior=new De.a({dragAxis:t}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var h=0,d=new o.x,f={snapDistance:0};a.dragBehavior.onDragObservable.add(function(e){if(a.attachedMesh){var n=e.dragDistance*(3*a.scaleRatio/a._rootMesh.scaling.length()),i=!1,r=0;a.uniformScaling?(a.attachedMesh.scaling.normalizeToRef(d),d.y<0&&d.scaleInPlace(-1)):d.copyFrom(t),0==a.snapDistance?d.scaleToRef(n,d):(h+=n,Math.abs(h)>a.snapDistance?(r=Math.floor(Math.abs(h)/a.snapDistance),h<0&&(r*=-1),h%=a.snapDistance,d.scaleToRef(a.snapDistance*r,d),i=!0):d.scaleInPlace(0)),a.attachedMesh.scaling.addInPlace(d),i&&(f.snapDistance=a.snapDistance*r,a.onSnapObservable.notifyObservers(f))}}),a._pointerObserver=i.utilityLayerScene.onPointerObservable.add(function(e){if(!a._customMeshSet){var t=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?s:a._coloredMaterial;a._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var p=i._getSharedGizmoLight();return p.includedOnlyMeshes=p.includedOnlyMeshes.concat(a._rootMesh.getChildMeshes()),a}return c.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(t,n){var i=this;void 0===n&&(n=!1),e.prototype.setCustomMesh.call(this,t),n&&(this._rootMesh.getChildMeshes().forEach(function(e){e.material=i._coloredMaterial,e.color&&(e.color=i._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},t}(xi.a),Ai=n(46),Pi=n(40),Ri=function(e){function t(t,n){void 0===t&&(t=o.e.Gray()),void 0===n&&(n=Ci.a.DefaultKeepDepthUtilityLayer);var i=e.call(this,n)||this;i._boundingDimensions=new o.x(1,1,1),i._renderObserver=null,i._pointerObserver=null,i._scaleDragSpeed=.2,i._tmpQuaternion=new o.q,i._tmpVector=new o.x(0,0,0),i._tmpRotationMatrix=new o.j,i.ignoreChildren=!1,i.includeChildPredicate=null,i.rotationSphereSize=.1,i.scaleBoxSize=.1,i.fixedDragMeshScreenSize=!1,i.fixedDragMeshScreenSizeDistanceFactor=10,i.onDragStartObservable=new r.c,i.onScaleBoxDragObservable=new r.c,i.onScaleBoxDragEndObservable=new r.c,i.onRotationSphereDragObservable=new r.c,i.onRotationSphereDragEndObservable=new r.c,i.scalePivot=null,i._existingMeshScale=new o.x,i._dragMesh=null,i.pointerDragBehavior=new De.a,i._updateScale=!1,i._anchorMesh=new ke.a("anchor",n.utilityLayerScene),i.coloredMaterial=new bn.a("",n.utilityLayerScene),i.coloredMaterial.disableLighting=!0,i.hoverColoredMaterial=new bn.a("",n.utilityLayerScene),i.hoverColoredMaterial.disableLighting=!0,i._lineBoundingBox=new ke.a("",n.utilityLayerScene),i._lineBoundingBox.rotationQuaternion=new o.q;var a=[];a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(i._boundingDimensions.x,0,0)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(0,i._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(0,0,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(i._boundingDimensions.x,0,0),new o.x(i._boundingDimensions.x,i._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(i._boundingDimensions.x,0,0),new o.x(i._boundingDimensions.x,0,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,i._boundingDimensions.y,0),new o.x(i._boundingDimensions.x,i._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,i._boundingDimensions.y,0),new o.x(0,i._boundingDimensions.y,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,0,i._boundingDimensions.z),new o.x(i._boundingDimensions.x,0,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(0,0,i._boundingDimensions.z),new o.x(0,i._boundingDimensions.y,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new o.x(0,i._boundingDimensions.y,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new o.x(i._boundingDimensions.x,0,i._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Pi.a.CreateLines("lines",{points:[new o.x(i._boundingDimensions.x,i._boundingDimensions.y,i._boundingDimensions.z),new o.x(i._boundingDimensions.x,i._boundingDimensions.y,0)]},n.utilityLayerScene)),a.forEach(function(e){e.color=t,e.position.addInPlace(new o.x(-i._boundingDimensions.x/2,-i._boundingDimensions.y/2,-i._boundingDimensions.z/2)),e.isPickable=!1,i._lineBoundingBox.addChild(e)}),i._rootMesh.addChild(i._lineBoundingBox),i.setColor(t),i._rotateSpheresParent=new ke.a("",n.utilityLayerScene),i._rotateSpheresParent.rotationQuaternion=new o.q;for(var s=function(e){var t=Ai.a.CreateSphere("",{diameter:1},n.utilityLayerScene);t.rotationQuaternion=new o.q,t.material=l.coloredMaterial,(d=new De.a({})).moveAttached=!1,d.updateDragPlane=!1,t.addBehavior(d);var r=new o.x(1,0,0),a=0;d.onDragStartObservable.add(function(){r.copyFrom(t.forward),a=0}),d.onDragObservable.add(function(t){if(i.onRotationSphereDragObservable.notifyObservers({}),i.attachedMesh){var n=i.attachedMesh.parent;if(n&&n.scaling&&n.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Fe.a._RemoveAndStorePivotPoint(i.attachedMesh);var s=r,l=t.dragPlaneNormal.scale(o.x.Dot(t.dragPlaneNormal,s)),c=s.subtract(l).normalizeToNew(),u=o.x.Dot(c,t.delta)<0?Math.abs(t.delta.length()):-Math.abs(t.delta.length());u=u/i._boundingDimensions.length()*i._anchorMesh.scaling.length(),i.attachedMesh.rotationQuaternion||(i.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(i.attachedMesh.rotation.y,i.attachedMesh.rotation.x,i.attachedMesh.rotation.z)),i._anchorMesh.rotationQuaternion||(i._anchorMesh.rotationQuaternion=o.q.RotationYawPitchRoll(i._anchorMesh.rotation.y,i._anchorMesh.rotation.x,i._anchorMesh.rotation.z)),a+=u,Math.abs(a)<=2*Math.PI&&(e>=8?o.q.RotationYawPitchRollToRef(0,0,u,i._tmpQuaternion):e>=4?o.q.RotationYawPitchRollToRef(u,0,0,i._tmpQuaternion):o.q.RotationYawPitchRollToRef(0,u,0,i._tmpQuaternion),i._anchorMesh.addChild(i.attachedMesh),i._anchorMesh.rotationQuaternion.multiplyToRef(i._tmpQuaternion,i._anchorMesh.rotationQuaternion),i._anchorMesh.removeChild(i.attachedMesh),i.attachedMesh.setParent(n)),i.updateBoundingBox(),Fe.a._RestorePivotPoint(i.attachedMesh)}i._updateDummy()}),d.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({}),i._selectNode(t)}),d.onDragEndObservable.add(function(){i.onRotationSphereDragEndObservable.notifyObservers({}),i._selectNode(null),i._updateDummy()}),l._rotateSpheresParent.addChild(t)},l=this,c=0;c<12;c++)s(c);i._rootMesh.addChild(i._rotateSpheresParent),i._scaleBoxesParent=new ke.a("",n.utilityLayerScene),i._scaleBoxesParent.rotationQuaternion=new o.q;for(var u=0;u<2;u++)for(var h=0;h<2;h++)for(var d,f=function(){var e=Ei.a.CreateBox("",{size:1},n.utilityLayerScene);e.material=g.coloredMaterial;var t=new o.x(0==u?-1:1,0==h?-1:1,0==m?-1:1);(d=new De.a({dragAxis:t})).moveAttached=!1,e.addBehavior(d),d.onDragObservable.add(function(t){if(i.onScaleBoxDragObservable.notifyObservers({}),i.attachedMesh){var n=i.attachedMesh.parent;if(n&&n.scaling&&n.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Fe.a._RemoveAndStorePivotPoint(i.attachedMesh);var r=t.dragDistance/i._boundingDimensions.length()*i._anchorMesh.scaling.length(),a=new o.x(r,r,r);a.scaleInPlace(i._scaleDragSpeed),i.updateBoundingBox(),i.scalePivot?(i.attachedMesh.getWorldMatrix().getRotationMatrixToRef(i._tmpRotationMatrix),i._boundingDimensions.scaleToRef(.5,i._tmpVector),o.x.TransformCoordinatesToRef(i._tmpVector,i._tmpRotationMatrix,i._tmpVector),i._anchorMesh.position.subtractInPlace(i._tmpVector),i._boundingDimensions.multiplyToRef(i.scalePivot,i._tmpVector),o.x.TransformCoordinatesToRef(i._tmpVector,i._tmpRotationMatrix,i._tmpVector),i._anchorMesh.position.addInPlace(i._tmpVector)):(e.absolutePosition.subtractToRef(i._anchorMesh.position,i._tmpVector),i._anchorMesh.position.subtractInPlace(i._tmpVector)),i._anchorMesh.addChild(i.attachedMesh),i._anchorMesh.scaling.addInPlace(a),(i._anchorMesh.scaling.x<0||i._anchorMesh.scaling.y<0||i._anchorMesh.scaling.z<0)&&i._anchorMesh.scaling.subtractInPlace(a),i._anchorMesh.removeChild(i.attachedMesh),i.attachedMesh.setParent(n),Fe.a._RestorePivotPoint(i.attachedMesh)}i._updateDummy()}),d.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({}),i._selectNode(e)}),d.onDragEndObservable.add(function(){i.onScaleBoxDragEndObservable.notifyObservers({}),i._selectNode(null),i._updateDummy()}),g._scaleBoxesParent.addChild(e)},g=this,m=0;m<2;m++)f();i._rootMesh.addChild(i._scaleBoxesParent);var _=new Array;return i._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(e){_[e.event.pointerId]?e.pickInfo&&e.pickInfo.pickedMesh!=_[e.event.pointerId]&&(_[e.event.pointerId].material=i.coloredMaterial,delete _[e.event.pointerId]):i._rotateSpheresParent.getChildMeshes().concat(i._scaleBoxesParent.getChildMeshes()).forEach(function(t){e.pickInfo&&e.pickInfo.pickedMesh==t&&(_[e.event.pointerId]=t,t.material=i.hoverColoredMaterial)})}),i._renderObserver=i.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){i.attachedMesh&&!i._existingMeshScale.equals(i.attachedMesh.scaling)?i.updateBoundingBox():i.fixedDragMeshScreenSize&&(i._updateRotationSpheres(),i._updateScaleBoxes()),i._dragMesh&&i.attachedMesh&&i.pointerDragBehavior.dragging&&(i._lineBoundingBox.position.rotateByQuaternionToRef(i._rootMesh.rotationQuaternion,i._tmpVector),i.attachedMesh.setAbsolutePosition(i._dragMesh.position.add(i._tmpVector.scale(-1))))}),i.updateBoundingBox(),i}return c.d(t,e),t.prototype.setColor=function(e){this.coloredMaterial.emissiveColor=e,this.hoverColoredMaterial.emissiveColor=e.clone().add(new o.e(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(t){t.color&&(t.color=e)})},t.prototype._attachedMeshChanged=function(e){var t=this;if(e){Fe.a._RemoveAndStorePivotPoint(e);var n=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(n),Fe.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(e){e.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){t._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(t){t.isVisible=!e||t==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Fe.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null);var t=null;this.attachedMesh.skeleton&&(t=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=o.q.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var n=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);n.max.subtractToRef(n.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2,(n.max.z+n.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=t)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Fe.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),t=0;t<3;t++)for(var n=0;n<2;n++)for(var i=0;i<2;i++){var r=4*t+2*n+i;if(0==t&&(e[r].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*n,this._boundingDimensions.z*i),e[r].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(o.x.Cross(e[r].position.normalizeToNew(),o.x.Right()).normalizeToNew().add(e[r].position))),1==t&&(e[r].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y/2,this._boundingDimensions.z*i),e[r].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(o.x.Cross(e[r].position.normalizeToNew(),o.x.Up()).normalizeToNew().add(e[r].position))),2==t&&(e[r].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y*i,this._boundingDimensions.z/2),e[r].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(o.x.Cross(e[r].position.normalizeToNew(),o.x.Forward()).normalizeToNew().add(e[r].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[r].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var a=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[r].scaling.set(a,a,a)}else e[r].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),t=0;t<2;t++)for(var n=0;n<2;n++)for(var i=0;i<2;i++){var r=4*t+2*n+i;if(e[r])if(e[r].position.set(this._boundingDimensions.x*t,this._boundingDimensions.y*n,this._boundingDimensions.z*i),e[r].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[r].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var a=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[r].scaling.set(a,a,a)}else e[r].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(t,n){t.setEnabled(n<4?-1!=e.indexOf("x"):n<8?-1!=e.indexOf("y"):-1!=e.indexOf("z"))})},t.prototype.setEnabledScaling=function(e){this._scaleBoxesParent.getChildMeshes().forEach(function(t,n){t.setEnabled(e)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=fe.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new o.q,this.pointerDragBehavior.useObjectOrienationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var t=function(e){e.isPickable=!1,e.getChildMeshes().forEach(function(e){t(e)})};t(e),e.rotationQuaternion||(e.rotationQuaternion=o.q.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var n=e.position.clone(),i=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var r=Ei.a.CreateBox("box",{size:1},e.getScene()),a=e.getHierarchyBoundingVectors();return a.max.subtractToRef(a.min,r.scaling),0===r.scaling.y&&(r.scaling.y=o.h),0===r.scaling.x&&(r.scaling.x=o.h),0===r.scaling.z&&(r.scaling.z=o.h),r.position.set((a.max.x+a.min.x)/2,(a.max.y+a.min.y)/2,(a.max.z+a.min.z)/2),e.addChild(r),e.rotationQuaternion.copyFrom(i),e.position.copyFrom(n),e.removeChild(r),r.addChild(e),r.visibility=0,r},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo")},t}(xi.a),Mi=function(e){function t(t,n,i,a){void 0===n&&(n=o.e.Gray()),void 0===i&&(i=Ci.a.DefaultUtilityLayer),void 0===a&&(a=32);var s=e.call(this,i)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new r.c;var l=new bn.a("",i.utilityLayerScene);l.diffuseColor=n,l.specularColor=n.subtract(new o.e(.1,.1,.1));var c=new bn.a("",i.utilityLayerScene);c.diffuseColor=n.add(new o.e(.3,.3,.3));var u=new ke.a("",i.utilityLayerScene),h=fe.a.CreateTorus("",.6,.03,a,i.utilityLayerScene);h.visibility=0;var d=fe.a.CreateTorus("",.6,.005,a,i.utilityLayerScene);d.material=l,d.rotation.x=Math.PI/2,h.rotation.x=Math.PI/2,u.addChild(d),u.addChild(h),u.lookAt(s._rootMesh.position.add(t)),s._rootMesh.addChild(u),u.scaling.scaleInPlace(1/3),s.dragBehavior=new De.a({dragPlaneNormal:t}),s.dragBehavior.moveAttached=!1,s.dragBehavior.maxDragAngle=9*Math.PI/20,s.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,s._rootMesh.addBehavior(s.dragBehavior);var f=new o.x;s.dragBehavior.onDragStartObservable.add(function(e){s.attachedMesh&&f.copyFrom(e.dragPlanePoint)});var p=new o.j,g=new o.x,m=new o.x,_={snapDistance:0},v=0,b=new o.j,y=new o.x,T=new o.q;s.dragBehavior.onDragObservable.add(function(e){if(s.attachedMesh){s.attachedMesh.rotationQuaternion||(s.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(s.attachedMesh.rotation.y,s.attachedMesh.rotation.x,s.attachedMesh.rotation.z));var n=s.attachedMesh.parent;n&&s.attachedMesh.setParent(null);var r=e.dragPlanePoint.subtract(s.attachedMesh.absolutePosition).normalize(),a=f.subtract(s.attachedMesh.absolutePosition).normalize(),l=o.x.Cross(r,a),c=o.x.Dot(r,a),u=Math.atan2(l.length(),c);if(g.copyFrom(t),m.copyFrom(t),s.updateGizmoRotationToMatchAttachedMesh&&(s.attachedMesh.rotationQuaternion.toRotationMatrix(p),m=o.x.TransformCoordinates(g,p)),i.utilityLayerScene.activeCamera){var h=i.utilityLayerScene.activeCamera.position.subtract(s.attachedMesh.position);o.x.Dot(h,m)>0&&(g.scaleInPlace(-1),m.scaleInPlace(-1))}o.x.Dot(m,l)>0&&(u=-u);var d=!1;if(0!=s.snapDistance)if(v+=u,Math.abs(v)>s.snapDistance){var E=Math.floor(Math.abs(v)/s.snapDistance);v<0&&(E*=-1),v%=s.snapDistance,u=s.snapDistance*E,d=!0}else u=0;b.reset(),s.attachedMesh.parent&&(s.attachedMesh.parent.computeWorldMatrix().invertToRef(b),b.getRotationMatrixToRef(b),o.x.TransformCoordinatesToRef(g,b,g));var x=Math.sin(u/2);T.set(g.x*x,g.y*x,g.z*x,Math.cos(u/2)),b.determinant()>0&&(T.toEulerAnglesToRef(y),o.q.RotationYawPitchRollToRef(y.y,-y.x,-y.z,T)),s.updateGizmoRotationToMatchAttachedMesh?s.attachedMesh.rotationQuaternion.multiplyToRef(T,s.attachedMesh.rotationQuaternion):T.multiplyToRef(s.attachedMesh.rotationQuaternion,s.attachedMesh.rotationQuaternion),f.copyFrom(e.dragPlanePoint),d&&(_.snapDistance=u,s.onSnapObservable.notifyObservers(_)),n&&s.attachedMesh.setParent(n)}}),s._pointerObserver=i.utilityLayerScene.onPointerObservable.add(function(e){if(!s._customMeshSet){var t=e.pickInfo&&-1!=s._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?c:l;s._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var E=i._getSharedGizmoLight();return E.includedOnlyMeshes=E.includedOnlyMeshes.concat(s._rootMesh.getChildMeshes(!1)),s}return c.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(xi.a),Oi=function(e){function t(t,n){void 0===t&&(t=Ci.a.DefaultUtilityLayer),void 0===n&&(n=32);var i=e.call(this,t)||this;return i.onDragStartObservable=new r.c,i.onDragEndObservable=new r.c,i.xGizmo=new Mi(new o.x(1,0,0),o.e.Red().scale(.5),t,n),i.yGizmo=new Mi(new o.x(0,1,0),o.e.Green().scale(.5),t,n),i.zGizmo=new Mi(new o.x(0,0,1),o.e.Blue().scale(.5),t,n),[i.xGizmo,i.yGizmo,i.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){i.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){i.onDragEndObservable.notifyObservers({})})}),i.attachedMesh=null,i}return c.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(xi.a),wi=function(e){function t(t){void 0===t&&(t=Ci.a.DefaultUtilityLayer);var n=e.call(this,t)||this;return n.onDragStartObservable=new r.c,n.onDragEndObservable=new r.c,n.xGizmo=new Ti.a(new o.x(1,0,0),o.e.Red().scale(.5),t),n.yGizmo=new Ti.a(new o.x(0,1,0),o.e.Green().scale(.5),t),n.zGizmo=new Ti.a(new o.x(0,0,1),o.e.Blue().scale(.5),t),[n.xGizmo,n.yGizmo,n.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n}return c.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(xi.a);xn.a.CreatePolyhedron=function(e){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,i,r,a,s=e.size,l=e.sizeX||s||1,c=e.sizeY||s||1,u=e.sizeZ||s||1,h=e.custom||t[e.type&&(e.type<0||e.type>=t.length)?0:e.type||0],d=h.face.length,f=e.faceUV||new Array(d),p=e.faceColors,g=void 0===e.flat||e.flat,m=0===e.sideOrientation?0:e.sideOrientation||xn.a.DEFAULTSIDE,_=new Array,v=new Array,b=new Array,y=new Array,T=new Array,E=0,x=0,C=new Array,S=0,A=0;if(g)for(A=0;A<d;A++)p&&void 0===p[A]&&(p[A]=new o.f(1,1,1,1)),f&&void 0===f[A]&&(f[A]=new o.y(0,0,1,1));if(g)for(A=0;A<d;A++){var P=h.face[A].length;for(n=2*Math.PI/P,i=.5*Math.tan(n/2),r=.5,S=0;S<P;S++)_.push(h.vertex[h.face[A][S]][0]*l,h.vertex[h.face[A][S]][1]*c,h.vertex[h.face[A][S]][2]*u),C.push(E),E++,y.push(f[A].x+(f[A].z-f[A].x)*(.5+i),f[A].y+(f[A].w-f[A].y)*(r-.5)),a=i*Math.cos(n)-r*Math.sin(n),r=i*Math.sin(n)+r*Math.cos(n),i=a,p&&T.push(p[A].r,p[A].g,p[A].b,p[A].a);for(S=0;S<P-2;S++)v.push(C[0+x],C[S+2+x],C[S+1+x]);x+=P}else{for(S=0;S<h.vertex.length;S++)_.push(h.vertex[S][0]*l,h.vertex[S][1]*c,h.vertex[S][2]*u),y.push(0,0);for(A=0;A<d;A++)for(S=0;S<h.face[A].length-2;S++)v.push(h.face[A][0],h.face[A][S+2],h.face[A][S+1])}xn.a.ComputeNormals(_,v,b),xn.a._ComputeSides(m,_,v,b,y,e.frontUVs,e.backUVs);var R=new xn.a;return R.positions=_,R.indices=v,R.normals=b,R.uvs=y,p&&g&&(R.colors=T),R},fe.a.CreatePolyhedron=function(e,t,n){return Ii.CreatePolyhedron(e,t,n)};var Ii=function(){function e(){}return e.CreatePolyhedron=function(e,t,n){void 0===n&&(n=null);var i=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreatePolyhedron(t).applyToMesh(i,t.updatable),i},e}(),Di=function(e){function t(t){void 0===t&&(t=Ci.a.DefaultUtilityLayer);var n=e.call(this,t)||this;n.onDragStartObservable=new r.c,n.onDragEndObservable=new r.c,n.xGizmo=new Si(new o.x(1,0,0),o.e.Red().scale(.5),t),n.yGizmo=new Si(new o.x(0,1,0),o.e.Green().scale(.5),t),n.zGizmo=new Si(new o.x(0,0,1),o.e.Blue().scale(.5),t),n.uniformScaleGizmo=new Si(new o.x(0,1,0),o.e.Yellow().scale(.5),t),n.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,n.uniformScaleGizmo.uniformScaling=!0;var i=Ii.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene);i.scaling.scaleInPlace(.02),i.visibility=0;var a=Ii.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene);a.scaling.scaleInPlace(.007),i.addChild(a),n.uniformScaleGizmo.setCustomMesh(i,!0);var s=t._getSharedGizmoLight();return s.includedOnlyMeshes=s.includedOnlyMeshes.concat(a),[n.xGizmo,n.yGizmo,n.zGizmo,n.uniformScaleGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n}return c.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e,this.uniformScaleGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){e||p.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e,this.uniformScaleGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e,this.uniformScaleGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t}(xi.a),Li=function(){function e(e){var t=this;this.scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new r.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=o.e.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new Be,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new Ci.a(e),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=Ci.a.DefaultUtilityLayer,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=e.onPointerObservable.add(function(e){if(t.usePointerToAttachGizmos&&e.type==Ae.a.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){var n=e.pickInfo.pickedMesh;if(null==t.attachableMeshes)for(;n&&null!=n.parent;)n=n.parent;else{var i=!1;t.attachableMeshes.forEach(function(e){n&&(n==e||n.isDescendantOf(e))&&(n=e,i=!0)}),i||(n=null)}n instanceof ke.a?t._attachedMesh!=n&&t.attachToMesh(n):t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)}else t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)})}return e.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this.gizmos){var n=this.gizmos[t];n&&this._gizmosEnabled[t]&&(n.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new wi(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Oi(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Di(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new Ri(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var t=this.gizmos[e];t&&t.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),ki=n(38),Ni=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return c.d(t,e),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!0,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix||(this.transformedPosition||(this.transformedPosition=o.x.Zero()),o.x.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=o.x.Zero()),o.x.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),0))},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=o.x.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=o.x.Cross(this.direction,o.c.Y),t=o.x.Cross(e,this.direction);return o.x.RotationFromAxis(e,t,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=o.x.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=o.j.Identity()),o.j.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,t,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,n,e):this._setDefaultShadowProjectionMatrix(e,t,n),this},c.c([Object(D.o)()],t.prototype,"position",null),c.c([Object(D.o)()],t.prototype,"direction",null),c.c([Object(D.c)()],t.prototype,"shadowMinZ",null),c.c([Object(D.c)()],t.prototype,"shadowMaxZ",null),t}(ki.a);k.a.AddNodeConstructor("Light_Type_1",function(e,t){return function(){return new Fi(e,o.x.Zero(),t)}});var Fi=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r._shadowFrustumSize=0,r._shadowOrthoScale=.1,r.autoUpdateExtends=!0,r._orthoLeft=Number.MAX_VALUE,r._orthoRight=Number.MIN_VALUE,r._orthoTop=Number.MIN_VALUE,r._orthoBottom=Number.MAX_VALUE,r.position=n.scale(-1),r.direction=n,r}return c.d(t,e),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return ki.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,n)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var t=this.getScene().activeCamera;t&&o.j.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,t,n){var i=this.getScene().activeCamera;if(i){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var r=o.x.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var a=0;a<n.length;a++){var s=n[a];if(s)for(var l=s.getBoundingInfo().boundingBox,c=0;c<l.vectorsWorld.length;c++)o.x.TransformCoordinatesToRef(l.vectorsWorld[c],t,r),r.x<this._orthoLeft&&(this._orthoLeft=r.x),r.y<this._orthoBottom&&(this._orthoBottom=r.y),r.x>this._orthoRight&&(this._orthoRight=r.x),r.y>this._orthoTop&&(this._orthoTop=r.y)}}var u=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom;o.j.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,t){e["DIRLIGHT"+t]=!0},c.c([Object(D.c)()],t.prototype,"shadowFrustumSize",null),c.c([Object(D.c)()],t.prototype,"shadowOrthoScale",null),c.c([Object(D.c)()],t.prototype,"autoUpdateExtends",void 0),t}(Ni);fe.a.CreateHemisphere=function(e,t,n,i){return Bi.CreateHemisphere(e,{segments:t,diameter:n},i)};var Bi=function(){function e(){}return e.CreateHemisphere=function(e,t,n){t.diameter||(t.diameter=1),t.segments||(t.segments=16);var i=Ai.a.CreateSphere("",{slice:.5,diameter:t.diameter,segments:t.segments},n),r=fe.a.CreateDisc("",t.diameter/2,3*t.segments+(4-t.segments),n);r.rotation.x=-Math.PI/2,r.parent=i;var o=fe.a.MergeMeshes([r,i],!0);return o.name=e,o},e}();k.a.AddNodeConstructor("Light_Type_2",function(e,t){return function(){return new Ui(e,o.x.Zero(),o.x.Zero(),0,0,t)}});var Ui=function(e){function t(t,n,i,r,a,s){var l=e.call(this,t,s)||this;return l._innerAngle=0,l._projectionTextureMatrix=o.j.Zero(),l._projectionTextureLightNear=1e-6,l._projectionTextureLightFar=1e3,l._projectionTextureUpDirection=o.x.Up(),l._projectionTextureViewLightDirty=!0,l._projectionTextureProjectionLightDirty=!0,l._projectionTextureDirty=!0,l._projectionTextureViewTargetVector=o.x.Zero(),l._projectionTextureViewLightMatrix=o.j.Zero(),l._projectionTextureProjectionLightMatrix=o.j.Zero(),l._projectionTextureScalingMatrix=o.j.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),l.position=n,l.direction=i,l.angle=r,l.exponent=a,l}return c.d(t,e),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var t=this;if(this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady())){var n=this._projectionTexture;n.onLoadObservable&&n.onLoadObservable.addOnce(function(){t._markMeshesAsLightDirty()})}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return ki.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(t){e.prototype._setDirection.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(t){e.prototype._setPosition.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){var i=this.getScene().activeCamera;i&&(this._shadowAngleScale=this._shadowAngleScale||1,o.j.PerspectiveFovLHToRef(this._shadowAngleScale*this._angle,1,this.getDepthMinZ(i),this.getDepthMaxZ(i),e))},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),o.j.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,n=e/(e-t),i=-n*t,r=1/Math.tan(this._angle/2);o.j.FromValuesToRef(r/1,0,0,0,0,r,0,0,0,0,n,1,0,0,i,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferToEffect=function(e,t){var n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),n=o.x.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),n=o.x.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+t,this.projectionTexture)),this},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())},c.c([Object(D.c)()],t.prototype,"angle",null),c.c([Object(D.c)()],t.prototype,"innerAngle",null),c.c([Object(D.c)()],t.prototype,"shadowAngleScale",null),c.c([Object(D.c)()],t.prototype,"exponent",void 0),c.c([Object(D.c)()],t.prototype,"projectionTextureLightNear",null),c.c([Object(D.c)()],t.prototype,"projectionTextureLightFar",null),c.c([Object(D.c)()],t.prototype,"projectionTextureUpDirection",null),c.c([Object(D.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(Ni),Vi=function(e){function t(t){var n=e.call(this,t)||this;return n.cachedPosition=new o.x,n.cachedForward=new o.x(0,0,1),n._light=null,n.attachedMesh=new ke.a("",n.gizmoLayer.utilityLayerScene),n._material=new bn.a("light",n.gizmoLayer.originalScene),n._material.diffuseColor=new o.e(.5,.5,.5),n._material.specularColor=new o.e(.1,.1,.1),n}return c.d(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var n=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),this._lightMesh=e instanceof gn.a?t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof Fi?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof Ui?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(e){e.material=n._material}),this._lightMesh.parent=this._rootMesh;var i=this.gizmoLayer._getSharedGizmoLight();i.includedOnlyMeshes=i.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new o.q,e.position&&this.attachedMesh.position.copyFrom(e.position),e.direction&&this.attachedMesh.setDirection(e.direction),this._update()}},enumerable:!0,configurable:!0}),t.prototype._update=function(){e.prototype._update.call(this),this._light&&(this._light.position&&(this.attachedMesh.position.equals(this.cachedPosition)?this.attachedMesh.position.copyFrom(this._light.position):(this._light.position.copyFrom(this.attachedMesh.position),this.cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(o.x.DistanceSquared(this.attachedMesh.forward,this.cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this.cachedForward.copyFrom(this.attachedMesh.forward)):o.x.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.cachedForward.copyFrom(this._lightMesh.forward))),this._light.isEnabled()?this._material.diffuseColor.set(this._light.diffuse.r/3,this._light.diffuse.g/3,this._light.diffuse.b/3):this._material.diffuseColor.set(0,0,0))},t.prototype.dispose=function(){this._material.dispose(),e.prototype.dispose.call(this)},t._CreateHemisphericLightMesh=function(e){var n=new fe.a("hemisphereLight",e),i=Bi.CreateHemisphere(n.name,{segments:10,diameter:1},e);return i.position.z=-.15,i.rotation.x=Math.PI/2,i.parent=n,this._createLightLines(3,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreatePointLightMesh=function(e){var n=new fe.a("pointLight",e),i=Ai.a.CreateSphere(n.name,{segments:10,diameter:1},e);return i.rotation.x=Math.PI/2,i.parent=n,this._createLightLines(5,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateSpotLightMesh=function(e){var n=new fe.a("spotLight",e);Ai.a.CreateSphere(n.name,{segments:10,diameter:1},e).parent=n;var i=Bi.CreateHemisphere(n.name,{segments:10,diameter:2},e);return i.parent=n,i.rotation.x=-Math.PI/2,this._createLightLines(2,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateDirectionalLightMesh=function(e){var n=new fe.a("directionalLight",e),i=new fe.a(n.name,e);i.parent=n,Ai.a.CreateSphere(n.name,{diameter:1.2,segments:10},e).parent=i;var r=fe.a.CreateCylinder(n.name,6,.3,.3,6,1,e);r.parent=i,(o=r.clone(n.name)).scaling.y=.5,o.position.x+=1.25,(a=r.clone(n.name)).scaling.y=.5,a.position.x+=-1.25;var o,a,s=fe.a.CreateCylinder(n.name,1,0,.6,6,1,e);return s.position.y+=3,s.parent=i,(o=s.clone(n.name)).position.y=1.5,o.position.x+=1.25,(a=s.clone(n.name)).position.y=1.5,a.position.x+=-1.25,i.scaling.scaleInPlace(t._Scale),i.rotation.z=Math.PI/2,i.rotation.y=Math.PI/2,n},t._Scale=.007,t._createLightLines=function(e,t){var n=new fe.a("root",t);n.rotation.x=Math.PI/2;var i=new fe.a("linePivot",t);i.parent=n;var r=fe.a.CreateCylinder("line",2,.2,.3,6,1,t);if(r.position.y=r.scaling.y/2+1.2,r.parent=i,e<2)return i;for(var o=0;o<4;o++)(a=i.clone("lineParentClone")).rotation.z=Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*o,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2;if(e<3)return n;for(o=0;o<4;o++)(a=i.clone("linePivotClone")).rotation.z=Math.PI/2,a.rotation.y=Math.PI/2*o;if(e<4)return n;for(o=0;o<4;o++){var a;(a=i.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*o,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2}return e<5?n:((a=i.clone("linePivotClone")).rotation.z=Math.PI,n)},t}(xi.a),Gi=n(44);zt.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};",zt.a.IncludesShadersStore.kernelBlurFragment="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X});\ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif",zt.a.IncludesShadersStore.kernelBlurFragment2="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif",zt.a.ShadersStore.kernelBlurPixelShader="\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g;\nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;\n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r;\nreturn coc;\n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT;\nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",zt.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",zt.a.ShadersStore.kernelBlurVertexShader="\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}";var zi=function(e){function t(t,n,i,r,o,a,s,l,c,u,h){void 0===a&&(a=Ge.a.BILINEAR_SAMPLINGMODE),void 0===c&&(c=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=""),void 0===h&&(h=!1);var d=e.call(this,t,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],r,o,a,s,l,null,c,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return d.direction=n,d.blockCompilation=h,d._packedFloat=!1,d._staticDefines="",d._staticDefines=u,d.onApplyObservable.add(function(e){d._outputTexture?e.setFloat2("delta",1/d._outputTexture.width*d.direction.x,1/d._outputTexture.height*d.direction.y):e.setFloat2("delta",1/d.width*d.direction.x,1/d.height*d.direction.y)}),d.kernel=i,d}return c.d(t,e),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.updateEffect=function(e,t,n,i,r,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this._updateParameters(r,o)},t.prototype._updateParameters=function(t,n){for(var i=this._kernel,r=(i-1)/2,o=[],a=[],s=0,l=0;l<i;l++){var c=this._gaussianWeight(l/(i-1)*2-1);o[l]=l-r,a[l]=c,s+=c}for(l=0;l<a.length;l++)a[l]/=s;var u=[],h=[],d=[];for(l=0;l<=r;l+=2){var f=Math.min(l+1,Math.floor(r));if(l===f)d.push({o:o[l],w:a[l]});else{var p=a[l]+a[f]*(f===r?.5:1),g=o[l]+1/(1+a[l]/a[f]);0===g?(d.push({o:o[l],w:a[l]}),d.push({o:o[l+1],w:a[l+1]})):(d.push({o:g,w:p}),d.push({o:-g,w:p}))}}for(l=0;l<d.length;l++)h[l]=d[l].o,u[l]=d[l].w;o=h,a=u;var m=this.getEngine().getCaps().maxVaryingVectors,_=Math.max(m,0)-1,v=Math.min(o.length,_),b="";for(b+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(b+="#define CENTER_WEIGHT "+this._glslFloat(a[v-1])+"\r\n",v--),l=0;l<v;l++)b+="#define KERNEL_OFFSET"+l+" "+this._glslFloat(o[l])+"\r\n",b+="#define KERNEL_WEIGHT"+l+" "+this._glslFloat(a[l])+"\r\n";var y=0;for(l=_;l<o.length;l++)b+="#define KERNEL_DEP_OFFSET"+y+" "+this._glslFloat(o[l])+"\r\n",b+="#define KERNEL_DEP_WEIGHT"+y+" "+this._glslFloat(a[l])+"\r\n",y++;this.packedFloat&&(b+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,e.prototype.updateEffect.call(this,b,null,null,{varyingCount:v,depCount:y},t,n)},t.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),n=0,i=[t,t-1,t+1,t-2,t+2];n<i.length;n++){var r=i[n];if(r%2!=0&&Math.floor(r/2)%2==0&&r>0)return Math.max(r,3)}return Math.max(t,3)},t.prototype._gaussianWeight=function(e){var t=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(t)},t.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},t}(jt),ji=function(e){function t(t,n,i,r,a,s,l){void 0===a&&(a=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===s&&(s=Ge.a.BILINEAR_SAMPLINGMODE),void 0===l&&(l=!0);var c=e.call(this,t,n,i,r,!0,a,!1,s,l)||this;return c.scene=i,c.mirrorPlane=new o.n(0,1,0,1),c._transformMatrix=o.j.Zero(),c._mirrorMatrix=o.j.Zero(),c._adaptiveBlurKernel=0,c._blurKernelX=0,c._blurKernelY=0,c._blurRatio=1,c.ignoreCameraViewport=!0,c._updateGammaSpace(),c._imageProcessingConfigChangeObserver=i.imageProcessingConfiguration.onUpdateParameters.add(function(){}),c.onBeforeRenderObservable.add(function(){o.j.ReflectionToRef(c.mirrorPlane,c._mirrorMatrix),c._savedViewMatrix=i.getViewMatrix(),c._mirrorMatrix.multiplyToRef(c._savedViewMatrix,c._transformMatrix),i.setTransformMatrix(c._transformMatrix,i.getProjectionMatrix()),i.clipPlane=c.mirrorPlane,i.getEngine().cullBackFaces=!1,i._mirroredCameraPosition=o.x.TransformCoordinates(i.activeCamera.globalPosition,c._mirrorMatrix)}),c.onAfterRenderObservable.add(function(){i.setTransformMatrix(c._savedViewMatrix,i.getProjectionMatrix()),i.getEngine().cullBackFaces=!0,i._mirroredCameraPosition=null,i.clipPlane=null}),c}return c.d(t,e),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),n=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*n},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),t=e.getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new zi("horizontal blur",new o.w(1,0),this._blurKernelX,this._blurRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new zi("vertical blur",new o.w(0,1),this._blurKernelY,this._blurRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),i=new t(this.name,n.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.mirrorPlane.asArray(),t},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(cn);Ge.a._CreateMirror=function(e,t,n,i){return new ji(e,t,n,i)},me.b.prototype._createDepthStencilCubeTexture=function(e,t){var n=new ze.a(this,ze.a.DATASOURCE_UNKNOWN);if(n.isCube=!0,1===this.webGLVersion)return p.a.Error("Depth cube texture is not supported by WebGL 1."),n;var i=c.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,n,!0),this._setupDepthStencilTexture(n,e,i.generateStencil,i.bilinearFiltering,i.comparisonFunction);for(var o=0;o<6;o++)i.generateStencil?r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH24_STENCIL8,e,e,0,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8,null):r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.DEPTH_COMPONENT24,e,e,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null);return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),n},me.b.prototype._partialLoadFile=function(e,t,n,i,r){void 0===r&&(r=null),this._loadFile(e,function(e){n[t]=e,n._internalCount++,6===n._internalCount&&i(n)},void 0,void 0,!0,function(e,t){r&&e&&r(e.status+" "+e.statusText,t)})},me.b.prototype._cascadeLoadFiles=function(e,t,n,i){void 0===i&&(i=null);var r=[];r._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(n[o],o,r,t,i)},me.b.prototype._cascadeLoadImgs=function(e,t,n,i){void 0===i&&(i=null);var r=[];r._internalCount=0;for(var o=0;o<6;o++)this._partialLoadImg(n[o],o,r,e,t,i)},me.b.prototype._partialLoadImg=function(e,t,n,i,r,o){var a;void 0===o&&(o=null),a=be.h.LoadImage(e,function(){n[t]=a,n._internalCount++,i&&i._removePendingData(a),6===n._internalCount&&r(n)},function(e,t){i&&i._removePendingData(a),o&&o(e,t)},i?i.offlineProvider:null),i&&i._addPendingData(a)},me.b.prototype.createCubeTexture=function(e,t,n,i,r,o,a,s,l,c,u,h,d){var f=this;void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=!1),void 0===c&&(c=0),void 0===u&&(u=0),void 0===h&&(h=null),void 0===d&&(d=[]);var g=this._gl,m=h||new ze.a(this,ze.a.DATASOURCE_CUBE);m.isCube=!0,m.url=e,m.generateMipMaps=!i,m._lodGenerationScale=c,m._lodGenerationOffset=u,this._doNotHandleContextLost||(m._extension=s,m._files=n);for(var _=e.lastIndexOf("."),v=s||(_>-1?e.substring(_).toLowerCase():""),b=null,y=0,T=me.b._TextureLoaders;y<T.length;y++){var E=T[y];if(-1===d.indexOf(E)&&E.canLoad(v,this._textureFormatInUse,h,!1,!1)){b=E;break}}if(b){e=b.transformUrl(e,this._textureFormatInUse);var x=function(e){f._bindTextureDirectly(g.TEXTURE_CUBE_MAP,m,!0),b.loadCubeData(e,m,l,r,o)};n&&6===n.length?b.supportCascades?this._cascadeLoadFiles(t,x,n,o):o?o("Textures type does not support cascades."):p.a.Warn("Texture loader does not support cascades."):this._loadFile(e,x,void 0,void 0,!0,function(e,s){if(b){var h=b.getFallbackTextureUrl(m.url,f._textureFormatInUse);if(p.a.Warn(b.constructor.name+" failed when trying to load "+m.url+", falling back to the next supported loader"),h)return d.push(b),void f.createCubeTexture(h,t,n,i,r,o,a,v,l,c,u,m,d)}o&&e&&o(e.status+" "+e.statusText,s)})}else{if(!n)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(e){var t=f.needPOTTextures?be.h.GetExponentOfTwo(e[0].width,f._caps.maxCubemapTextureSize):e[0].width,n=t;if(f._prepareWorkingCanvas(),f._workingCanvas&&f._workingContext){f._workingCanvas.width=t,f._workingCanvas.height=n;var o=[g.TEXTURE_CUBE_MAP_POSITIVE_X,g.TEXTURE_CUBE_MAP_POSITIVE_Y,g.TEXTURE_CUBE_MAP_POSITIVE_Z,g.TEXTURE_CUBE_MAP_NEGATIVE_X,g.TEXTURE_CUBE_MAP_NEGATIVE_Y,g.TEXTURE_CUBE_MAP_NEGATIVE_Z];f._bindTextureDirectly(g.TEXTURE_CUBE_MAP,m,!0),f._unpackFlipY(!1);for(var s=a?f._getInternalFormat(a):f._gl.RGBA,l=0;l<o.length;l++)e[l].width!==t||e[l].height!==n?(f._workingContext.drawImage(e[l],0,0,e[l].width,e[l].height,0,0,t,n),g.texImage2D(o[l],0,s,s,g.UNSIGNED_BYTE,f._workingCanvas)):g.texImage2D(o[l],0,s,s,g.UNSIGNED_BYTE,e[l]);i||g.generateMipmap(g.TEXTURE_CUBE_MAP),f._setCubeMapTextureParams(!i),m.width=t,m.height=n,m.isReady=!0,a&&(m.format=a),m.onLoadedObservable.notifyObservers(m),m.onLoadedObservable.clear(),r&&r()}},n,o)}return this._internalTexturesCache.push(m),m};var Hi=function(e){function t(t,n,i,r,a,s,l,c,u,h,d,f,p){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=g.a.TEXTUREFORMAT_RGBA),void 0===u&&(u=!1),void 0===h&&(h=null),void 0===d&&(d=!1),void 0===f&&(f=.8),void 0===p&&(p=0);var m=e.call(this,n)||this;if(m.boundingBoxPosition=o.x.Zero(),m._rotationY=0,m._prefiltered=!1,m.name=t,m.url=t,m._noMipmap=r,m.hasAlpha=!1,m._format=c,m.isCube=!0,m._textureMatrix=o.j.Identity(),m._createPolynomials=d,m.coordinatesMode=Ge.a.CUBIC_MODE,!t&&!a)return m;var _=t.lastIndexOf("."),v=h||(_>-1?t.substring(_).toLowerCase():""),b=".dds"===v,y=".env"===v;if(y?(m.gammaSpace=!1,m._prefiltered=!1):(m._prefiltered=u,u&&(m.gammaSpace=!1)),m._texture=m._getFromCache(t,r),!a&&(y||b||i||(i=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),a=[],i))for(var T=0;T<i.length;T++)a.push(t+i[T]);return m._files=a,m._texture?s&&(m._texture.isReady?be.h.SetImmediate(function(){return s()}):m._texture.onLoadedObservable.add(s)):n.useDelayedTextureLoading?m.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:m._texture=u?n.getEngine().createPrefilteredCubeTexture(t,n,f,p,s,l,c,h,m._createPolynomials):n.getEngine().createCubeTexture(t,n,a,r,s,l,m._format,h,!1,f,p),m}return c.d(t,e),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(o.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),t.CreateFromImages=function(e,n,i){var r="";return e.forEach(function(e){return r+=e}),new t(r,n,null,i,e)},t.CreateFromPrefilteredData=function(e,n,i,r){return void 0===i&&(i=null),void 0===r&&(r=!0),new t(e,n,null,!1,null,null,null,void 0,!0,i,r)},Object.defineProperty(t.prototype,"isPrefiltered",{get:function(){return this._prefiltered},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,t,n){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)),this.url=e,this.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=!1,n&&(this._delayedOnLoad=n),this.delayLoad(t)},t.prototype.delayLoad=function(e){if(this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this._prefiltered?t.getEngine().createPrefilteredCubeTexture(this.url,t,this.lodGenerationScale,this.lodGenerationOffset,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):t.getEngine().createCubeTexture(this.url,t,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,e)))}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._textureMatrix=e)},t.Parse=function(e,n,i){var r=D.a.Parse(function(){var r=!1;return e.prefiltered&&(r=e.prefiltered),new t(i+e.name,n,e.extensions,!1,null,null,null,void 0,r)},e,n);if(e.boundingBoxPosition&&(r.boundingBoxPosition=o.x.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=o.x.FromArray(e.boundingBoxSize)),e.animations)for(var s=0;s<e.animations.length;s++){var l=e.animations[s],c=a.a.GetClass("BABYLON.Animation");c&&r.animations.push(c.Parse(l))}return r},t.prototype.clone=function(){var e=this,n=this.getScene(),i=0,r=D.a.Clone(function(){if(!n)return e;var r=new t(e.url,n,e._extensions,e._noMipmap,e._files);return i=r.uniqueId,r},this);return r.uniqueId=i,r},c.c([Object(D.c)("rotationY")],t.prototype,"rotationY",null),c.c([Object(D.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(Gi.a);Ge.a._CubeTextureParser=Hi.Parse,a.a.RegisteredTypes["BABYLON.CubeTexture"]=Hi;var Wi=n(15),Xi=n(64),Yi=n(75),Ki=n(18);zt.a.IncludesShadersStore.backgroundFragmentDeclaration=" uniform vec4 vPrimaryColor;\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nuniform vec4 vPrimaryColorShadow;\n#endif\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",zt.a.IncludesShadersStore.backgroundUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vPrimaryColorShadow;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",n(113),n(84),n(85),n(120),n(112),n(95),n(98),n(89),n(114),n(99),zt.a.ShadersStore.backgroundPixelShader="#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n#define RECIPROCAL_PI2 0.15915494\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec4 reflectionColor=vec4(1.,1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample;\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor.rgb=toLinearSpace(reflectionColor.rgb);\n#endif\n#ifdef REFLECTIONBGR\nreflectionColor.rgb=reflectionColor.bgr;\n#endif\n\nreflectionColor.rgb*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor.rgb*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nvec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);\n#else\nvec3 mainColor=vPrimaryColor.rgb;\n#endif\nvec3 finalColor=colorBase*mainColor;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=saturate(viewAngleToFloor/startAngle);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb+=dither(vPositionW.xy,0.5);\ncolor=max(color,0.0);\n#endif\ngl_FragColor=color;\n}\n",zt.a.IncludesShadersStore.backgroundVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",n(67),n(68),n(96),n(100),n(69),n(70),n(90),n(116),n(117),zt.a.ShadersStore.backgroundVertexShader="precision highp float;\n#include<__decl__backgroundVertex>\n#include<helperFunctions>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(position,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#ifdef EQUIRECTANGULAR_RELFECTION_FOV\nmat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));\nvec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));\nif (fFovMultiplier<=1.0) {\nvDirectionW=normalize(segment);\n} else {\nvDirectionW=normalize(vDirectionW+(vDirectionW-segment));\n}\n#endif\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var Qi=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.GAMMADIFFUSE=!1,t.DIFFUSEHASALPHA=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONBLUR=!1,t.REFLECTIONFRESNEL=!1,t.REFLECTIONFALLOFF=!1,t.TEXTURELODSUPPORT=!1,t.PREMULTIPLYALPHA=!1,t.USERGBCOLOR=!1,t.USEHIGHLIGHTANDSHADOWCOLORS=!1,t.NOISE=!1,t.REFLECTIONBGR=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.MULTIVIEW=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.EQUIRECTANGULAR_RELFECTION_FOV=!1,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SHADOWFLOAT=!1,t.rebuild(),t}return c.d(t,e),t}(Xi.a),qi=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.primaryColor=o.e.White(),i._primaryColorShadowLevel=0,i._primaryColorHighlightLevel=0,i.reflectionTexture=null,i.reflectionBlur=0,i.diffuseTexture=null,i._shadowLights=null,i.shadowLights=null,i.shadowLevel=0,i.sceneCenter=o.x.Zero(),i.opacityFresnel=!0,i.reflectionFresnel=!1,i.reflectionFalloffDistance=0,i.reflectionAmount=1,i.reflectionReflectance0=.05,i.reflectionReflectance90=.5,i.useRGBColor=!0,i.enableNoise=!1,i._fovMultiplier=1,i.useEquirectangularFOV=!1,i._maxSimultaneousLights=4,i.maxSimultaneousLights=4,i._imageProcessingObserver=null,i.switchToBGR=!1,i._renderTargets=new Gt.a(16),i._reflectionControls=o.y.Zero(),i._white=o.e.White(),i._primaryShadowColor=o.e.Black(),i._primaryHighlightColor=o.e.Black(),i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),i._diffuseTexture&&i._diffuseTexture.isRenderTarget&&i._renderTargets.push(i._diffuseTexture),i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),i._renderTargets},i}return c.d(t,e),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var n=e;n<.5?(this.reflectionReflectance0=t.StandardReflectance0*(n*=2),this.reflectionReflectance90=t.StandardReflectance90*n):(this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*(n=2*n-1),this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._computePrimaryColorFromPerceptualColor(),t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype.isReadyForSubMesh=function(e,t,n){var i=this;if(void 0===n&&(n=!1),t.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new Qi);var r=this.getScene(),o=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&o._renderId===r.getRenderId())return!0;var a=r.getEngine();if(Wi.a.PrepareDefinesForLights(r,e,o,!1,this._maxSimultaneousLights),o._needNormals=!0,Wi.a.PrepareDefinesForMultiview(r,o),o._areTexturesDirty){if(o._needUVs=!1,r.texturesEnabled){if(r.getEngine().getCaps().textureLOD&&(o.TEXTURELODSUPPORT=!0),this._diffuseTexture&&Ki.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Wi.a.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE"),o.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,o.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,o.OPACITYFRESNEL=this._opacityFresnel}else o.DIFFUSE=!1,o.DIFFUSEHASALPHA=!1,o.GAMMADIFFUSE=!1,o.OPACITYFRESNEL=!1;var s=this._reflectionTexture;if(s&&Ki.a.ReflectionTextureEnabled){if(!s.isReadyOrNotBlocking())return!1;switch(o.REFLECTION=!0,o.GAMMAREFLECTION=s.gammaSpace,o.RGBDREFLECTION=s.isRGBD,o.REFLECTIONBLUR=this._reflectionBlur>0,o.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,o.LODINREFLECTIONALPHA=s.lodLevelInAlpha,o.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,o.REFLECTIONBGR=this.switchToBGR,s.coordinatesMode===Ge.a.INVCUBIC_MODE&&(o.INVERTCUBICMAP=!0),o.REFLECTIONMAP_3D=s.isCube,s.coordinatesMode){case Ge.a.EXPLICIT_MODE:o.REFLECTIONMAP_EXPLICIT=!0;break;case Ge.a.PLANAR_MODE:o.REFLECTIONMAP_PLANAR=!0;break;case Ge.a.PROJECTION_MODE:o.REFLECTIONMAP_PROJECTION=!0;break;case Ge.a.SKYBOX_MODE:o.REFLECTIONMAP_SKYBOX=!0,o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!s.getReflectionTextureMatrix().isIdentity();break;case Ge.a.SPHERICAL_MODE:o.REFLECTIONMAP_SPHERICAL=!0;break;case Ge.a.EQUIRECTANGULAR_MODE:o.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MODE:o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ge.a.CUBIC_MODE:case Ge.a.INVCUBIC_MODE:default:o.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(o.REFLECTIONFRESNEL=!0,o.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(o.REFLECTIONFRESNEL=!1,o.REFLECTIONFALLOFF=!1)}else o.REFLECTION=!1,o.REFLECTIONFRESNEL=!1,o.REFLECTIONFALLOFF=!1,o.REFLECTIONBLUR=!1,o.REFLECTIONMAP_3D=!1,o.REFLECTIONMAP_SPHERICAL=!1,o.REFLECTIONMAP_PLANAR=!1,o.REFLECTIONMAP_CUBIC=!1,o.REFLECTIONMAP_PROJECTION=!1,o.REFLECTIONMAP_SKYBOX=!1,o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,o.REFLECTIONMAP_EXPLICIT=!1,o.REFLECTIONMAP_EQUIRECTANGULAR=!1,o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,o.INVERTCUBICMAP=!1,o.REFLECTIONMAP_OPPOSITEZ=!1,o.LODINREFLECTIONALPHA=!1,o.GAMMAREFLECTION=!1,o.RGBDREFLECTION=!1}o.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,o.USERGBCOLOR=this._useRGBColor,o.NOISE=this._enableNoise}if(o._areLightsDirty&&(o.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o)}if(Wi.a.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),o),Wi.a.PrepareDefinesForFrameBoundValues(r,a,o,n),Wi.a.PrepareDefinesForAttributes(e,o,!1,!0,!1)&&e&&(r.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(Cn.b.NormalKind)||(e.createNormals(!0),p.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),o.isDirty){o.markAsProcessed(),r.resetCachedMaterial();var l=new zt.c;o.FOG&&l.addFallback(0,"FOG"),o.POINTSIZE&&l.addFallback(1,"POINTSIZE"),o.MULTIVIEW&&l.addFallback(0,"MULTIVIEW"),Wi.a.HandleFallbacksForShadows(o,l,this._maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,e);var c=[Cn.b.PositionKind];o.NORMAL&&c.push(Cn.b.NormalKind),o.UV1&&c.push(Cn.b.UVKind),o.UV2&&c.push(Cn.b.UV2Kind),Wi.a.PrepareAttributesForBones(c,e,o,l),Wi.a.PrepareAttributesForInstances(c,o);var u=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],h=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],d=["Material","Scene"];vn.a&&(vn.a.PrepareUniforms(u,o),vn.a.PrepareSamplers(h,o)),Wi.a.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:h,defines:o,maxSimultaneousLights:this._maxSimultaneousLights});var f=o.toString();t.setEffect(r.getEngine().createEffect("background",{attributes:c,uniformsNames:u,uniformBuffersNames:d,samplers:h,defines:f,fallbacks:l,onCompiled:function(e){i.onCompiled&&i.onCompiled(e),i.bindSceneUniformBuffer(e,r.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},a),o),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady()||(o._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,0))},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),e.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n._materialDefines;if(r){var o=n.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e),Wi.a.BindBonesParameters(t,this._activeEffect);var a=this._mustRebind(i,o,t.visibility);if(a){this._uniformBuffer.bindToEffect(o,"Material"),this.bindViewProjection(o);var s=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(i.texturesEnabled&&(this._diffuseTexture&&Ki.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Wi.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),s&&Ki.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",s.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",s.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),r.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),i.texturesEnabled&&(this._diffuseTexture&&Ki.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),s&&Ki.a.ReflectionTextureEnabled&&(r.REFLECTIONBLUR&&r.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",s):r.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",s._lodTextureMid||s),this._uniformBuffer.setTexture("reflectionSamplerLow",s._lodTextureLow||s),this._uniformBuffer.setTexture("reflectionSamplerHigh",s._lodTextureHigh||s)):this._uniformBuffer.setTexture("reflectionSampler",s),r.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),Wi.a.BindClipPlane(this._activeEffect,i),Wi.a.BindEyePosition(o,i)}!a&&this.isFrozen||(i.lightsEnabled&&Wi.a.BindLights(i,t,this._activeEffect,r,this._maxSimultaneousLights,!1),this.bindView(o),Wi.a.BindFogParameters(i,t,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(t,this._activeEffect)}}},t.prototype.dispose=function(t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return D.a.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.BackgroundMaterial",e},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,n,i){return D.a.Parse(function(){return new t(e.name,n)},e,n,i)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,c.c([Object(D.e)()],t.prototype,"_primaryColor",void 0),c.c([Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),c.c([Object(D.e)()],t.prototype,"__perceptualColor",void 0),c.c([Object(D.c)()],t.prototype,"_primaryColorShadowLevel",void 0),c.c([Object(D.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),c.c([Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),c.c([Object(D.m)()],t.prototype,"_reflectionTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionBlur",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),c.c([Object(D.m)()],t.prototype,"_diffuseTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),c.c([Object(D.c)()],t.prototype,"_shadowLevel",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),c.c([Object(D.o)()],t.prototype,"_sceneCenter",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),c.c([Object(D.c)()],t.prototype,"_opacityFresnel",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionFresnel",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionFalloffDistance",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionAmount",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionReflectance0",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),c.c([Object(D.c)()],t.prototype,"_reflectionReflectance90",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),c.c([Object(D.c)()],t.prototype,"_useRGBColor",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),c.c([Object(D.c)()],t.prototype,"_enableNoise",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),c.c([Object(D.c)()],t.prototype,"_maxSimultaneousLights",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),c.c([Object(D.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(Yi.a);a.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=qi;var Zi=n(80),Ji=function(){function e(t,n){var i=this;this._errorHandler=function(e,t){i.onErrorObservable.notifyObservers({message:e,exception:t})},this._options=c.a({},e._getDefaultOptions(),t),this._scene=n,this.onErrorObservable=new r.c,this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new o.e(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:g.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new o.e(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:o.x.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(e){var t=c.a({},this._options,e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new o.f(e.r,e.g,e.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof Gi.a)this._scene.environmentTexture=this._options.environmentTexture;else{var e=Hi.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new fe.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y},e.prototype._getSceneSize=function(){var e=this,t=this._options.groundSize,n=this._options.skyboxSize,i=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:t,skyboxSize:n,rootPosition:i};var r=this._scene.getWorldExtends(function(t){return t!==e._ground&&t!==e._rootMesh&&t!==e._skybox}),o=r.max.subtract(r.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof Et&&this._scene.activeCamera.upperRadiusLimit&&(n=t=2*this._scene.activeCamera.upperRadiusLimit);var a=o.length();a>t&&(n=t=2*a),t*=1.1,n*=1.5,(i=r.min.add(o.scale(.5))).y=r.min.y-this._options.groundYBias}return{groundSize:t,skyboxSize:n,rootPosition:i}},e.prototype._setupGround=function(e){var t=this;this._ground&&!this._ground.isDisposed()||(this._ground=fe.a.CreatePlane("BackgroundPlane",e.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){t._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new qi("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof Gi.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var e=new Ge.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);e.gammaSpace=!1,e.hasAlpha=!0,this._groundMaterial.diffuseTexture=e}},e.prototype._setupGroundMirrorTexture=function(e){var t=Ge.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new ji("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,Ge.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new o.n(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var n=0;n<this._scene.meshes.length;n++){var i=this._scene.meshes[n];i!==this._ground&&i!==this._skybox&&i!==this._rootMesh&&this._groundMirror.renderList.push(i)}this._groundMirror.clearColor=new o.f(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(e){var t=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=fe.a.CreateBox("BackgroundSkybox",e.skyboxSize,this._scene,void 0,fe.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){t._skybox=null})),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new qi("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof Gi.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new Hi(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=Ge.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),$i=n(42),er=function(e){function t(t,n,i,a,s){void 0===s&&(s=null);var l=e.call(this,t,a)||this;l._useDirectMapping=!1,l.onLoadErrorObservable=new r.c,t=t||"photoDome",i.resolution=0|Math.abs(i.resolution)||32,i.size=Math.abs(i.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),l._useDirectMapping=void 0===i.useDirectMapping||i.useDirectMapping,void 0===i.faceForward&&(i.faceForward=!0),l._setReady(!1);var c=l._material=new qi(t+"_material",a);if(l._mesh=fe.a.CreateSphere(t+"_mesh",i.resolution,i.size,a,!1,fe.a.BACKSIDE),c.opacityFresnel=!1,c.useEquirectangularFOV=!0,c.fovMultiplier=1,l.photoTexture=new Ge.a(n,a,!0,!l._useDirectMapping,void 0,void 0,function(e,t){l.onLoadErrorObservable.notifyObservers(e||"Unknown error occured"),s&&s(e,t)}),l.photoTexture.onLoadObservable.addOnce(function(){l._setReady(!0)}),l._mesh.material=c,l._mesh.parent=l,i.faceForward&&a.activeCamera){var u=a.activeCamera,h=o.x.Forward(),d=o.x.TransformNormal(h,u.getViewMatrix());d.normalize(),l.rotation.y=Math.acos(o.x.Dot(h,d))}return l}return c.d(t,e),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(e){this._photoTexture!==e&&(this._photoTexture=e,this._useDirectMapping?(this._photoTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),e.prototype.dispose.call(this,t,n)},t}($i.a);zt.a.ShadersStore.rgbdDecodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";var tr=function(){function e(){}return e._ExpandDefaultBRDFTexture=function(e){var t=e.getEngine(),n=t.getCaps(),i=!1;if(n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(i=!0,e.type=g.a.TEXTURETYPE_HALF_FLOAT):n.textureFloatRender&&n.textureFloatLinearFiltering&&(i=!0,e.type=g.a.TEXTURETYPE_FLOAT),i){e.isReady=!1;var r=new jt("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t,!1,void 0,e.type,void 0,null,!1);e._isRGBD=!1,e.invertY=!1;var o=t.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_BILINEAR_SAMPLINGMODE,type:e.type,format:g.a.TEXTUREFORMAT_RGBA});r.getEffect().executeWhenCompiled(function(){r.onApply=function(t){t._bindTexture("textureSampler",e),t.setFloat2("scale",1,1)},t.scenes[0].postProcessManager.directRender([r],o,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(e),t._releaseFramebufferObjects(o),r&&r.dispose(),o._swapAndDie(e),e.isReady=!0})}},e.GetEnvironmentBRDFTexture=function(e){var t=this;if(!e.environmentBRDFTexture){var n=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;var i=Ge.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",e,!0,!0,Ge.a.BILINEAR_SAMPLINGMODE);i._texture._isRGBD=!0,i.wrapU=Ge.a.CLAMP_ADDRESSMODE,i.wrapV=Ge.a.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=i,e.useDelayedTextureLoading=n,i.onLoadObservable.addOnce(function(){t._ExpandDefaultBRDFTexture(i._texture)})}return e.environmentBRDFTexture},e._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xuy9Ccx261oW9q5v/r7/33ufgalSbWtiTJsmTZOmSdOkpVKsWhxAxIJFQaCKUkpFiiBFKjKPh3PO7hjb2LmNnYxtjbGtbY21rQGkgCgiIKPMM5x99ruatZ7puq/7up/nWd/3bzzABjb/9675Xeu5hnt41rv8s+evW9fz+ZT+W9N/63o6re3v+nlfvq2CbdZT2hbW7dukDbf/a/9uS3G7E69Ln9PifK50sHSMvD2ur3+XY/E2++dyPelDPoU7Jm9XTm2uab86vJ56gvSd80dzXflA+Zul74PHwGuGv/MXLv+kL4Lfp56r3DM8ef6utE10Xnu97fra7uWi2/etZ8BV/F3F+fdni/8Dn9O4KSvt/cxPMa+HY5Qx024OHF3cM7zHdcsy3uAeuu3wPve3S2OVthHH09v5e9BuCT0HHgPlHsjz+3uxNALYAJ9JgAigALyBmQGPQEcAxwRQgVhIogwcIoAG2HYsM1gR3IokEDD5biMBhMeSoLXkweCoAxsGcDoX3Xi3nkCFACnfiQaPARECgPaVAMZjEuAsNttAjIBZSY8HXHkuFctt4Npj2e8+B/ImFOnwEcg9SPEqcNdyDBSZemwipBkwmvMwocG9Gm6nCDUisHpb+iSRTp+2kQTQAJ9cACt8cwRN/Ss5IJBJ7a2qC0AHYK4gUkpuQE2uoTiJfMPw4epjeqdRXYE5Rhu0me7aGCwIKtfFD0sAmklCgWBmG3utbfCrfdtlBUpK6qUIpwCkkUYDIg4yp4QhAeW9GDBwLR6glgysC8PvZq6o2MJMT3jdhtKqI0WiMfeTCMhs54BqzwNPyLueclxzS/3+XQI0jtSSQrmly4ecv249Z+U/gQOoNj+HBKj+yhGEtn9/2C10qLaWLH5Tz6KykeI3FTb7wM0uRJMWlZtmQwgXFgAr23VwDGRjADoPOgMIQ1pigNdnCrbviaqvFMopuDpvHjB8/RXoeI8ydGp4RAM2x13NzQtr74BkQoFZlceBDQTugIlaixa7kbn5nl3wNgVNpxGKi2OvQxJmjOJ24riNB/sKX0VJPS/zjNfTTgAp9s95AIj9K9DPqPQc22+nS6C0eYAGZJMLyF+sPPwGVggXypcH8HggA5gwbCjHhy9v1Z7yDIY4Gie3nIMGrQHUUNVBVeq14rnyOeiBvWjVl8QgQoZ6NajErESk0n0wx4CLFLuXJ5gOE4J8gtV4cW2RlYbvrO5lVWMk10KU6lpwrHbBr8cHn8+EMdH5YPl2H4gANhCmPEABLTsBp/5k+Y1TwGReWlGTgqiy6WFrxXcEQQTilLw8mUP5AIh1pbJnTgUrOiYIVBZKMAXqW7GISigAyjbYgkWfyyqyTTI5ZckLokEehQNxAs8TYMHF8X3w+3kSrcc1qozPAsAUqbfLX8B5AKgyFGBidOcIiB8JAMdZWV4fGak/nU+Sd0BC266CANbTqdp+zPZHmX9Uf1Txju1HxS6DbeeAZtOtavtKAILAhw9B1aCNjhyJELDZrldlFwRB1YT2nJtUNnVTBPJ41Y+dAQwOE2eD6+EBWZ4FDDRUFmUn7ZiLzjkgGbgOTTTintG1y2QiuKh2ZSKrLoDDVt4RI90jc28CMunnC/AK27iBhEB+FHgme78rtk2w5b+vcguSAKLyH5YCfT6ghAgFeAh+H9PXBxcBPiKICjo4fnEE+ODLk1NJQ7M9PACXK2iqgTa1DTpPHo59FYGgNZuM9T1AoBphFMIPIhXPMzG1Q/jBVYceAobVqCElHYo+uzwBPKvGyXBuY1O9YjZBQzOP312TK4PAVjDw/Hn/p5CEJKI2puq15C/jXFz7kiZB2CPLckzzzIPjlMtbPuT89WtK/rUSoOkFMDV/KvflEp6pCnCtH614yRPU0AAScxjvlwGABFFGlgQ12MJD+QCt7HX88bEE2aRFFnhGOdBO5hWsLDOx/mzZT6meSgAa9cLrYnA6O0yqxSDpbG/uFRAXwDWPYUsG1s2Le91Yp8CJsK5VM6wYUJyMGLLqjESsCcykC80XsddknltlRSC/fL+GBFAdXXw97fDrafnnzl+fG4FyIrAAPggD9nsTNQIhsLfziwqAVX+r5IcqAQKMxZlYUBaSQVUog4jWgXJhCGKah1QlQIUDZlDSQCm804n1+6rfQOAqEALA0SCMcwdeqZyqONKIQBsAVoBWKlcvRKnq6YHSKmAa/LJKUZFBJMf3tEdeJvmGY05cIx1XkXIlH8re8/J0SeK6I3LMvQCSAHQYULL8OhfApT6X2BN2v4YSRxW/Hivf4ALcScuPAx9JxxIHwKY6AXiIfC5+mHBNj63rW2cAwyMiDiQnygJ3AQzEZ+6BG+iCGBQ4BqD1cTHlKFTJUA3kyi0RyHF8EAAVWOg+vBCSqLeMFFnct64jOXAcW6SM8wHbLcgEUNT/3BKA2BJsWnoFAahKgGv79V2Bs5WAWkbkHAAMirgnoA1ajN8REKHay/IesCzkDdrzfMR6/B5moHuLORMu1PtKipbG9wGldsSgQVSpqdkWECRtRcPyn1DQGTVvl+rPh7pYOA2tvKxE8DOBJJuq+4/i7rj0SKpN9zA9QpFQbV9EtBxbZ1uPUcYDuAlDAEn5z83i7yRgld91AXZiftMXkG9oAartCqQKQOgIhOKHMX8elsbWF8mgdRSnm0QfJry4SoCEhAwND9EMjFE+wCXXJlS/o7ZK9RXwDhNDl0jsgJ2r81cpz8a0MpfrkJNA53sQqWsHXI8mCXZdCDImRAHmuvljjiO+Z+0FUG5GCMLy6/YcAAB/B30igdOZ4/2dDRJBIKCNQyggxfheNfn4kh8qsSGKei6v5l7VDyQEcSBzWIEKgDeTtkubWQvKg5StfBsXI4DDd2ky2EBirkt3pw3BXbFnQdjGVqSoj9weBi3fB1QqHyaIe0FEZMmmnigfNqoYwDOge4zg1AovQhcCmflOgjgbX4jrCLavWzpCa8/EOQ5xXds2y687f0ObDchdgC4M2E4wqAQYYsiDcrcRDSjVRRiQlQds/5WzAE3mHSoJlJGfIoeW8jezBDON+R7/URIQE4IyJvcJQT5XSzqCLhHJtOFN9pBVh0iil5U+5BhUnM6qw3G2UOCo4w/hkNUGtDWIa3mOgVC8CsjhtVhSN/c7ALl0J0Aqs6BkUkASUWMFiapFKoLwRCgBBJCUf9wE1MCswoEKdOcSChlQf76y8PlOGkeAeYZCMkwg+SlJ4PfIQal9uQZULKW4sAxVi2N1rr2zMusyXx/cKtZXqtrtFJxQ5C4xKBWeARc7D6F2GlAQLu4j3zoRoEwXPqRTkKMBMJt9pWLWAZbX2mON8gDTyTl4Jgbc7lrFd8HxiPdH3N9tkSGAU24DtmU+7gYsTT8lHGjlPhPz13gZFV01BWUbpWr+tazYyMOoI8TkCKg4ISgUtRIQcDwk9xhQ0u4jIQHL6m0bqDn5xANopvZ/vMZfvpGoYbscRNWbLEITA55VGMhAkZMrsfYAqQa3JBsgBiKJUTKuOg9x3PBa8ZljsjCqZojlqPIy/CFCMg6pfEe6ZvNdA+JbPrSGAG0egO36C8p+KTtYe/ttGZBzBKz+uv5fzotMPQLz/r3YRbhqAYDOgdvnDDzJIPNb4BxK8kX5AnQghqk74cJAubXqB7aWBodSMnU8Qw8MdHPMdv/cwOUEnhvEvnLRxnusgD0n0AM5CgmCMp1T2epj9ffu8XuJQFLwEZH5Z9OIH11FJoACfnohSNDwo63/DBnkyyo5gTDbv329AtpokhAOKtq23shiD21ZxIUW9VBwHACYsdomk5+HEiiTGSQ4uCsggqYg/L547mJyMZ5mNqdKRc0Eq0HDAMNrZyJS5SfaXlpqvEfRwOXjRKrIcxoitWUSI8WcUth8TYY81LPoJQs75+2SSM9F0DUYcHfcRLvFgijzdyAC2DL/rQyIQEdXYGYE1jKgz/Tbkh/Z/5QsqH3jBpQqL4AM3Fmv3QOFEDgoe9l/tZ1RAuEsROLPKo6v0VpVoGx34bBDYBxUD14EMQwciGp+CgGggMeOgq45Lnd13MZR8gjAFfYNDBUcoYturN7MmtMwTolJOoN35Ca6oUS+1uVDz38tVQFKAhBagBvQC1gpHJDgB3vPiUAX00MG38TzXtGl1e/lDdJoM5l9vGH4EF03IA+UMkBRPY0TgAcrcgpISra7TOUDhKswpBN1zen9npIAVANdDjrOHQycROMOr0xy0KrjT4C5FwO3R6nU8RHJwgN5AKPgh8EN/iRKaIJDafeAvmf+uBNAUn07GagP/jLYIkIoNzB2BVb9i8x5R+DsugFj277adAYrzcjzFQIkCkhYssIpYKtOQUkedI4qUlXeoQFmPkloQhPhPIrtVVZQgpsHY5DQi4A1TRiVw/ygNMqnnErPDgsw9TLz7lwHbPhIofsE411geVYtgtDEhFUPXVZUY8o7jMQR62n556sDaM1AUSlw2ASkbH3JI1T1hwRhecBQMTAqraw+EYCNz2dife4baDfHJRyNks3affEAYGCyIk8lEVlRZdKunVcBVA1YNUiniIE7INmhUIwMmmVKcxFIFGGNMvDTYMZcSrnO7BbbRzxae+6ufViQUZR/wX2738WFVoIICgYKW8jvQd8Bt4Xx6Aggeh9AHPejamN23ycF7Qs/mouoFrmC264z+yEYOKPP5ABZ9y64VYJOOYfIFaBSSVeAmWKRA0DlEqpbH2XFePkjHqj9TH65v6gMKfw0lpHPpxS5objAaP5FmjOhQ5PEdnyRhFMEV3cdJe3w/uNZguVpk6AiIPMABGJ1X0ffyZDUCNwgavB9SviJbiMTQGkCyglA1QFI8bypBHAuAOcHRK6g2K1uHK8tvrTx0/kAn2TD47Ux7sOB+shrdn8yhqfKASufBbi2h2FPQX7WXdUPiCPt6hUujXs7aB9VGmTnMhrkADgmPaO+Qez72CafOfdQb6JO1Kl7xgpNhDIq5Y3W1+cXOJiZ9cuH7SEA9gCUeQC5538v2aVLUZWApt4JrOkhROqPDoG2LczZrQBwchCYeBjrk+pB0rFlrGEosLswrD/OFdT7AgqGg5oVy5NLRXZ+vAKoA5C6hBreI3YzNIja9Qg1AdVvY7oRRpQl1wAVDUk9hVXKq4gDvh9/g6LgziGMQExuxwBMuIUeifVast11dZJ9LCYu1IDxh8pf/l4+7PyNtQpgfxUoE0EH/GWAaTdQ1EWECFV1RO8ArwubeoISotjfgFGp8UDRe3G6BK4KKYq5xhgUH6wAJ6s6D6gQpBznsvLwgAqsOEK68YO3s5bMhD09AlACWQQi5VIM0COwiuWjmDx0FjzvgxW/13pcSnnm2dC9jZKl5WGIHhFNACqPkc7lCGCU/TcuwLmCMeiNQzDg7gPa234RHqBysJPAhxG6hbhfwKgpxfkxMAHCgmTUwJtOEiqVrC61/EFg7Ci3AppXF9Atdh+kuFUdFaCFojm3IgECEBeK60kKAHUoZhfuS4B7lAcwKh8kHHUmH0u9nhSqkjviFgRiXI1fXwmA3wWgG39aP0BR1aPqnwY9WGhX/89DsRsKiPZfyAHg4EOlaOAC8jDEAKZOuQJUdraYUtl9vkFZP6tmgyShUB0GD37PSLldTG8SgA0AQ3VXRAT3xrgIJiiy3CoB6UDEJNa+YIYoJeciRxERlrPMMCaCZKLKvxSQmu/vzhkkEtnBgeIj+PHK6nLcNpOkeYZ0rOXX1xCAXgZi2oCx3s+WPq8zbiBfmgE6lP/KhWGcXZfBvji4iBAkmA2ZEIvS8QuBpfthldqqIZUWYdA64OLgRIUS2fUjrgEJLSozuUQmgUu6jXAbqxSOLAJra++HJ1McpC9K8Q8fRyQ9DVgDZ6G+W+WKSgxarVWoJglCnHtEIJVTpkuB9hozAeQkYGc6sCkD7oABN5AHeHUDBVTlC5mWX6X+jRwQmCVcqOUpTtzV4zfrjsAyYQMCV8XonbLfbPa/PT/rYurDDkkBO8/INeQnzOpolZlUipXWKEE9IDQf2az/oQSgIRGtvt0KRUURfiMYpNWJtaGO5SyrblSVKcfu9SWMzl9DEQ3uci09lY2Sn4ZAQDzqZZdzd8qY+OQrwdKxdJiR7tXy68//X2sF3kCArwTLLiCe/PMY9S+jEx2BBYyr2e+DQOQITJ2/Dex54Jfz0r4DV8AAQXWwyq7sPHK6Tc6MrHy8Pg8DVhAR9w5bgyN1V+oULkOw4rXZ5bpa4O/ZSKGZeJ26qnzFvlGrKjk1N+sZZoqgAoLo5R4UuTNpmVKtPgcLVCWC/B2ciwDS3gmgtgLvBJB7Ajrgt/kBTPwBkKlvIJ0zWF8v6A1KBIaVgTYgfaNQ0C8gyMEMD6oy1DME+QPnGsiiIrnU8wDDj9aPzh+pUDsFERYMHv7eJjwZqa5UdgzbiEQiIA2TewFoRCIyJhrhToj8nMqO1rcHA+a9XKslGA9g+508AYr1GCLAd1/+BXAAGwjw58AR6M3ed6x/vhKb5KOcQQXQRE9A7ari+j8QyUR2P3QEMJhVlaGJQL6hLkywKoKgsU7AZs8ZXHbboHKgBgwmKqMBxZliBbyZBKDscAs64jjnkVlGWWG+T45EgOwiwmF9xiYmDUzqeETVVSVRhKgkDiCIgFh0olCQaxl0ZmwSGdbrKTgYrBfHLGQHBFC6AakBCJOBEPcnV065AEwEFqA/QvVVCIBKZ5xE/nLVHnNVARUbB7/L8nMeQrgDAQKfjGykYHQDHEAT+UIsvgUX93XlJgFqoxKiPDSTyFMJNbmfcikiuabAzddpwTtSvn4LrrpWbvIqAx+eLiwSSt9UwOZMRNLNPDNa71UaQatzJ6b7kUBfL1qRNwIer9q4knS1mQC2o9gZgbIfQCT+ynYtUUd5AdMViKQRdAIa1dfJQZkPeArw4cZgXBqWDYGd8VraYhjmLuGo1mUYmAdkE4M8gJAQq2ry/hTj2n3QlSAcGilFaqxUVS/zyuSB0FfPIYmMlLKj6JbwgHxgRgS3RHviCPaTBGG3rcajNolZUnDrAxvfnqQ6vsqptO2W33D+pjVNBW4EMAX+mpgTicCB+isAO1U3vf0+BHCKT0qPA8e4B8wH4OCJYvSIHBhcYP10M0+5IpX4U27DNiXVLfA8Nc4m5arPt8AyyI5z9yHeQ1CR2BmIwa9IyBCmrezX17mRarXsugaNTiBqUnMuw90fIiqZVwDiFm6nKLJ1AUF1xXzXvAfdt6b+9GzpXsq8C7uPzrGJAHJ8nysBhgjodeCqDFjdgAoFirJHGf2q4FAdEACtpcEg9m84toM/zgMwucBwCcOE3ja4DocenKehOQ8FAdD80FgBR+VAsz5oJXXVBGnpo9IgAaHIlEzqiZJm+cYAQgsee96oEUiXtqicWiV0UFkogIzICwEb5DdGuQv3Pei+heszmKOKST2MChGUWBA5VAIwrwI7l5Bgu6HnWoKzbcDQHASKb+P3fqJPdwQWRmTF7FQIuurPwLPHxRIK21NPGn3gcznGOQ8kNBp0DQ8+HuQEEqtMz3HUKzZOJjOQUsIjQBYOQg1Uc71MbF0CadfplLXadOuompaDc+BkKbkNXaf3eZlCVPIc7CzpHI0g8nUJVVbfsQ2T8n2UI6IxI1xCdOzlN9YQoDQDbe8FhERgbt1V4J9OBAbqb/IGBGIdJsCtL+xmQgUcMAeB784/ytzT8XF/UFRHMNW22wHGCSwNavH9m4fQvw6rADeZ9T+UAKyXpgajzrp3yWKkxhVHHhBIvDqRZgmQXZMBemCfdVYfBIJzAJnoXJs2EIUF6YjY7Pdmp9gNIeDaMgHAj4PWXoDtkEFFQM73L3YvhxGh5QeFB9uf8EPqn8MFta5lxicnBWFyUYAVb6AELSaTEECsmAQu88B761JbCoDY21a53rgKqy5tiMCzKYqr5hQAOcnYUtnfIAutEmxqkJprNM+lkV0BZEhITSYLzGCIE1BCQNP5Bq6Bk7+Pdwd4B5Q7EOsFuTwqRNheCZYcQHkbcHshSCnxuV4A/jFQfBlIeYBmYk405dfH+sZyF+UqD2yg9N7Kl+FGg79Ty4+B3x7MlKJTEonBgAPZgjpI/HUdxcgV4MAOSKVnXwXo+ZpN/MrJVACnsqHqWPCNAFeQ0wESa7dGOQEPKHUNVbfrIQJ1LeeVYZK4z4bQ8Vv5a023KfiO+R46sgzcZL09kBeI9l1+4/mbN/mHFuD9F0HbLwTz36jsuQ/AN/6gkkfvA9BqX8Dis/xC6UmJnYpPrEfTZh6A3Nc/JLTqbO8Q+EhubVwASdXxYZOX5vqGMwEVwPuuQCWfZJKQBvMoL1GPaxQX9pIJqpjMKvakSxGACpxJlFTUSTigC7heF88XkgOCiIiGn2fbFfco32eOiKYqAeIat0XLbzp/M5QBs33fQR8QAai8aQTC5aYKgKFBUThUf87Ccx8BgM6oNzkItPjFPTCrKhuP24ZhAgGfVLGr6KyIImRQg9JE0nCMxhNtkDThEoNoYj5AwyjqBAxCvG+gvjFRdNQuOpZQS6da/KzwWkid00ehqJ0SnwPtTBhQgEXuISYARYLBfYfvh3c0x4p57ey+QCYwnoAASuafp/4CKewAwex/+Zxv9nZgUb8vpbum7pFDyF8TcgNVI8sorevK47UEg8ozCgvatqzEVoWdsyiDC9RNq71NJFq34bPMdtAUxwN7KdVUdlTZ9oESm3MH/fXOxaCq9MDZBUd5fm2IF/AmTrAqaIBAoDeupJbP2pgyxz2YpHNkVMVCX3ev7DdFDkFZ77H78rMrrmEngPYyEHgNGAK9/G1e/rkdEsGnGoJoPbkESRZGhZV7sIBI4w4AjAPRxfvgNsR+mA02gEbwUJwW2XxUZSQQHhhORTtq37Xdw1jdKw8PJhfCCHWzRDGX3VfgmU3oKVDX6hESEDXq7gPckJIFKj7rxgXGdxmFtc8Qj6X2IfdBBBiSQyUtrdae/Cw5soBUA6Fe457PtfyL529JIUDOA4zj/5wfcFl+Uv8Cyv1fPyGIXUF9qJzsK/sX8kDgvmjg98Dds/ITNp8HHD4sV/Iz5ASDbdrOm6Nn4dMDdQR6c91RYxERhVbi6v1LvcNodK8jEMm0qLgnlQw643SM56rnLeQQqam7/nwyvhfhtcgkYQ+s+Iw1qfq8g3JGR4ljPVUCaD8NHrgAUv9qz8yEoPIQAPR1fRz/s5NA6yfXdeL9+sghVJBWf+QUCv8juGFwNUs1b/OtW4hLfiOVta7BJv6G+wK5WHgoK56PRqDqkZkFhQU9g3Zs7wfhwahsicXAA0k8b5c7RIJ0NqX0mpyNWpOzKeDvJSoRM7h9OW5EXjsB+IlA7QdCqyPA+B+TfEgARaWd+peBVKgUwoVyXKfwvvMvjUNyFEYto3xAuek+BEBr13IGloVtOFCecgA8zj47V4EwaPfD2Ds+hrBwOEhZyXqOYgz6QtRsOK26uHNWMIrvlwd0e35+WNZB28s/IDDEPZKKPKveKvSiONw5BnZ+AriRy9AvFBXkQLmK8TV4Z9AjjuXDawiQmoF8CHDOoZRN/tX+gEoMj1P/FB5YgnDhgWgSUvuZUEMQAzqBpwMfHoXLFtsEHrNzE1TKUsvqAgEK1NgMF1I4BttItbsJPpOMixVMkgJcL+totbXDRF/sBBQg8I4VUmA6a+cG+w0AlrkHcR+c46lSHt+n0T49wKLzZKW398ITgXcB62n58PNf33MAthcAMv9VcYNqAMf3rgowjv+bwgrVL4MDlLRsL/cbAL8OQgSb+duCMp4S3Oxtcw68Lw675j56au9jcmWjtV1HYnFgm+jbj52EGsyjBKBSsyISFnSPyhlIex+7D3zuSArOEWUAPzpJSC6l3aUeIPF+BC6g7k6iYVzH8XXLb84E0H4dWLgAsP9NnSnpp0KEieRf2P4ryn3KiiuAovo5q6wqA5k0pCsg++1i/4w6va+107gNDzzMitvtKHlH1rer3NyRWAZLHkyjBJ9TjKjSMJNxD5yLUUPlYtQAN66C7g8DePaYBrgBCB05WOAyAbfEnQd4RDwtQekJwycCJ4jDuBrafnspKBIA/zYAv/EnBH+YB4jVv5f1d4pq1L+M3sZ2lRhggCrga/UH1uxYcEM09T6O9oXH7MIEP3XVkQsA1g7J2BU4YglBP1JjbbuVMjoiyYRqwG2A7PMMChBMmH01zQ8lJJrYkdiyYgOJDgM8Idvv+QSlB7JSdj3zD7yuZMbmw/ehPMd2PysBpNh/awkusX6uBvCEIIj504AtMTyDfWYOACblbAKvHtuAAFwHVQKUDe8n7wLwhkk7aEWmiTvTIYBxGp4cTOynLLtLOlUpd4PCVhzsQEG3YYGn+9Hx+yE8HMA7A5hdzWOPo67XLVP19OmQge4VEddjkncezNS7wudQHYyQkORQbVglMC7VuoDlt+whQJkKfLZTgWuv/xYW4Cu8EPTb0Rns21dGQOdbMFEStIm8OKtvjm+ARUAVZTwXItD+VhGA2CoF21jLuwOKRTlMoHp6D2BmrgFl2lmhXJkRtscrMoAR12bXazvMdtcOSriyTqZ8hhQcUYgwpKfATHZRgo3vT7PiFjBehe36CJz6nQMqfKGxY8ihF5rkdRQelXujCHdbtvyW87fWRqBUDoQ3A7vaP0wSUrMAwzxAuTj8t5MczIBM/2SCQZCinQ5i+sO5ASQsJhS8HnYk+bNT3CrO5YECmeVR5MKUolz0EC1h0YCr46UMjo4rgO+hgBCGIK7WPUsKSk1F/wMMcme7a7QD95FaiUys3S3nIQzstT0pDDDXb7+fJwx1T+haypgSzkCRswW5vU/9dWsigNoHkJ1AfSFIN/lX7H++pAN5gJpbQIAXJar/ti/Ssv4wyFG5wFnIUh+WETlhxbF5RCiGBArIyAmoZBiHFHUbfJR9cjAPvVeSU/0DHdAjafE58D5GgxiJqausQGgqrjbLZB+AVso5dRfVisBFSKse2DVzzl4AACAASURBVHG+d6MEnXQYBuiW2I1iK0Ew5ABYKQ+Lehii/MnyW8EBtLn/KRdQau2+5l/WlWQOhwQ2XDBKzgB3YUG5VF8StOEBxFHkCOpgDpJ6VlExD5Fvu0wmwkDq5QmUWyDQtudJqk3TfavOItnhoAnsdQxs0Z+AjSZRqRAVbjAY0UVEg85+L0sdEZAs2RB5wqBHb5IuOyCPACh2//yJvvNjVT0kGHN85VK8Q5gjq57bSOsyAWwjPs8HKEm9Eg5so8kk+loizlcFOO4/lgdw6l3IAQEkljkrLVW8PMzYRbC9MrxqQMiKzQnC4hCs+sgYPSqtuapByaPoARIm9vi62T4LgLSchAKaB5QlHLG+5iLmgcv9ENahoJ62p1R4augyOknCI7F6pOrq/E28OkpPqv441+DJwpNqu2fLbzv/jTYZKHoHwP6EN4IojCqmBHPSrwzgEsO7z+WR6ux/U3FMILJCU4LOOAGt2D5WR863wI6Se2HWP6iHz+QHQhC5EKLdA1ZY7Rj89xvF/3PHVUQEy6AioJyAUbDJON8AonIsEYCZFdghiumuPrp/oduAc1EeIu1iw8WyLCI2v/1YzfWxjIzBhKi0tSGAWgoE1Vf2Pylu3/bXLH0lgDI4JjoDEUhVwRQ4SdXREncU+wiw02EC11CTdnST6/YKEDZDbodXGdWBiprvBI8bwMbWUFYReslGHqwB0PouwcfdTE5IHxYgvKaFaGqf4bJ8z4bbgfriMzEJRoyrxbOIvscbkx8YKD187/A7bCHA5gCO2H9j++nloHZdnAdwTUC9+QAVgOQEjM1v7GrUtpPg06oMLC3zAHo95ibMQOMchCGTHjkUYmvbGEUgxeyp6UhpjUaaQROAOMg7WPUZ9BNUC26/X8uPsmqp+yAciAG7B4iKm8NldC+G+QxwBvOqLr4D5mTYNXTufQG5cnfdEOAj9hAg9QHUMmD9bFXeuYFi+00F4EAeAKoAM6RQkpL1BiPAVL4AW5FZyWViDpR+Yj2/xBETYDiwHNnk5262EdeH3zO00ex08kB0eRFshJnpDyhOgJQECcMM9N51sLrOkoiK1UWi8gg4jboLp9ZTyylnYBwUEVxQTj0GWrzrjSgr/7hQIwoB0vLlI85/s00Gyom/NiMwzwswNf9W/quhANf/XYiQL9pYaVR0tPciJyCBPJcbSLiKLfzICYzW4/HNgxxVCgTAYtLQbsG4jV55sESgFb02HmV7bgc6JTLrSS1ZpgHIce6g6jAJ8BnlDsFJ8fiTEoSkzvI7B0QYq3AP0D4UHIUT2n3g3bGksRMAhgDoAvS7AEQzkLPwg/ZgtX1WwHT/tv9PBIFAzuvH4A6AT6HBKCfg1nPTkJswVAgPIZpvfJR1FwMndBRFUUXyDMHMoIjtfpBzEE7FDjD41MtDRLa23BKqWc8obTsdK5xV3dCxKEcULQuIs+cWIiDy9TyOGHx45kOAdqZuCPCR2QHYtwDTjEByAHPlP1b4WPGLylqlbtvXmwmq2pTZVwIsCJAELCF0bToBshET3PygycfyregzMGpNCpvPa9WlQyiVKAXZwAwBk8jMfvFQwrCQDhJ1B0QGxL1SY+Qc8jWq645UkJ1LlEnnigs7qX4Y0AOWIh+7vSK3uRDAHvuo0kf3YvnI87eBA8DXgQEJgKV3th/yAC1Gty/5aPsE6l5jefE+AFNa65TpyOa3LDUkCKW7gMfvYlNR31dKzfup5J9yDfXUbMkHbkGA0JCOs73aiaiBb1xCvV+s+0CkSCZAXmy1GZyj5GR8be4KTWkLcx+VQ5zDmAPxTOhhibq5EXP9ktRniGFG6Y8Qg72+7ejLbz9/m58LUMuA29uAfMlPZvupFdgTReshwISfU3eXzFOTe1T874EunYABq2jogUFfj+gAzgBosW7XVRS1M0DpE1C6nHiwzIQJrDASjILYlMpE5xsCNmp4AnAitJlyMCQsoBsRmAYnHnkMQnYysVvokcr4PHMu4MhxPNj5/hoCaLG/sv+cDMyXS9n/Rgz5JpdYvgwu+bkdS5MBHkttC+Ymyg2QYvrEnlBgAoTO5ItkWtj7H51DJdkEwVQ5E4m2TCyNu/z+zWx01nFSTrmdXpmKWpm9b2CFFAO6Q3YKJP2kHsIXzh02Hr1IZzCTwDsC6Mcovd3HEn/6tHwUOIBU5qMXgir7X4G8HSQnBct2FWylZbjTDgxlQB3Ti31Nwo2n6qJb8Ouq8whKfO0GCYeh9qm23qvKVOKwALdT17fEg/qjcwus2tH+JibsJRO5dZgSnu58QEbSQYD78XGpt7w8aNm9pPGHA13bZqV+0gkNrj9SanVd6vu/cUpPY8N8D036uwP4qPPfCsqA4oUgNXtvW4Fr8k4QQ+KDTBQYBxelFJbf7IMq1N22uANOqtGXl4lEdhHl0c2FCO1644TeODRo18/AwLgWB7LVNyYEPSA4e26uq7iMKF+BTiOy7k+y+qTYxoHEA1wp2ygHESYIu8DxRL8nDPND8TkD7QLU9U4Rw3LEMVi3FX3fnQBaGZDtP/1GQFX5pu7JNeiQwAI5f20OA5RzYLU1CT6I9SvzdyoBhoCorTdQ9XGIQMnMPGjS5YzDiTqMxACvgyNKJPYqCAjQUd4gg50n3dghawdRS6wqpY4HpwQjXB8Dpw/eHqg6KiiJyV6zVuzHO4oIdMr5jLdFlxMreuQ6zPJKJOtp+R3GAaSOQN//r5KBAejrHAFeT5+F/S9K1xKI+UsL1TbbFgBGlQDTSOStcwGu4feZikAH8F5ZAzdR4u4AEOraWC1kfgJLgNBTkXCvYN7Abs85r7zRfi/C6jfy4cGvVXnG8s9c1xGw9p3IWL29gwgch3mGkdLPEcbyO87fLhyABbyu+2+XyxOCbPkvxWfZ/le16+UEUMlVyY9cBAMQiUKBs4YiwgmYcmO+8dVhRCFCISgcJgAksX+6JxpUbTG4HLbdxjXgMB+dN1DtvJskrIgsHDnOgdCdI7gPeHcUYc0q9VyCsOcCYgDOHLvEBnPEgFsFzmuinDl2EvbYy0efv92XAXcwxMnAAuym1CUkwFJfIgi0xLpKgM6gAC8CehmtCBBSVswTqFhWEREO9GELbz43uo3qQPyA8fE7KRiTVs3Ee5JyuYEpG23bce0w44HmCW2kknZwl2epCO5Y2KBiYh8qtOsdXedTiOTFuwAdxmhio22X2JE1wvGuIDr2TgCuFbh2/gEJkNrLWYHG1mflr0osSAKteRjnA2CgYahl9J9QCSCCqjdJxd8E+C6wjzQCkT2PYvC+zS+E2bPr5BaEk+jF3gZ8naoFq3cIWraxg0qEGsCjXIHdp6fm1i4zqUWqOusCZo93hGimlR7ifeVElt95/tvZAbye1Vr9OCiEBJAI7CYATdyeyQAAzJWDxBOKNMpXpfCALD5P+EkPB50EaIpRXbtN3WoimVdvaAD4ELTC+hp7bNYLUKtrG9h1b/GDMCQ4t3MfnX6AFq8HjijJsZ48BOseA3qkOa16PSdCJJmvcfY4RwDs4/04BBgT0NGQoW2/E4CpAuyqHGT/tynDGaje/mPdv9lkkyfougEIHyIywAlBmYjaw+lVAgY9AZksfPbfDpbqRQSAo9h+FALIfgFM01EfvbTwISHo68d+CAXEkCx6lQkAyxGyGFn9XtmS3UYMlL7CKzDOqLZSVL1MWPLFZggeY9+Z7I4dI+29/EvVAWzgxrhf2P8cX2v7rxOAwzyAidPbMfybg0WugBN3w/gfwgl2EC4bD3kGpdiiStBczAzwMI8xEe/n62U1miOEQO2NwrVr6AHYW/o2uM2A7JBF7zv0VV+rJIO1d42KNOw5tTOZdQFHlH1MPLEjOS1t/BQSj1xVb/lOANUBqOTf5gagGzAp3a7rOWTAfxGkUAFQyj+qEDhiKI+gUx3gpCOBHFVa2fcSNijrrpQ68QKRipnGHAAvE4oE76hKcCRJCDZ96DQOlQbnrHLPjo+sepQLMUCs9/7pCu/A6ADmQ4exNdfPvwdI5SDG5xEhACQLe85g+Zjzd7QqQHUAnYYgWfrLj0V0AjbbvP0FLkFWCHzXYPry+SiDRKGN3wGYrEYMWpGJnwX8Uy3+FDCVA0Fwl7+HuYFAQaOQJo3UTqzuj+fUd7ZSAefqu4Dx9TzdRcw4DSb+Adi7gOzvq92HF57DDmA5nXYCaA4AgS+mA1eHYJXe/IhojadtHkD/GAiCFC23XV5vgEss+gSh3HbGCXB+IcjOK8ArN4Gs/dT1ZshHoUcGKg+WrkuZArdudWWlUlSggRgPdm/dZ7Z9MYQwQxqjfMVRZZ8KATJxvDBnAONk+z7LxxoHwAlAOx/A2X9WfBMWZO2umX3RMhx2A3oyqE4A1FxWDcqgrjb7gBMwHYNlSASdg9RjYBJnXcXWjUAu8abKjgKwsQPR4DFA7XUf1lCD7eX4uAYoHVeCR5oBYJ90WlChLLPdd4Y0bBCy33oRdytg6mX2Pka2fjaRWckmdBZz51s+9vyd5AC4AUi0BocdgPhCD8oTjHoEhpl/DAPIXRSTKpt4fDKvPSBRHTjiBMhZWBXsEAea6lDR2wMsOQl3/IgQzHX5we7IxoEdIPxIAGuw9q+FCSFORs5ZdAb905KDkeX2uQFzno6CI8WUOP1R8T6puiOg3AugHMfyu87f2c0BVNXfS4DzCcBi+f1rvrbLs0RhbXsf6N08Qh34Cjx4XPvQzDU6BwFOoAf4KBk4kdSbDhEq0R0H9egcfQWm+wUDzpNJxyG4ezRDCLGyx4Cm40oQziX1RiQyC1gFdgXI014enFPv2XPbJKA99k4AugrQeSNw+ZWgrhPIQDfKfqAbsJMwNO3FBPpWnYCBaAaeUn3RTVgGOTYvuWUCGIFi1oc6Wt/LPUwpfnM8DOoGpcE2gsx6dr3vTMYhA4PjxVl9/p7tWiwo1DXqMKEuHbTk4r2udp2UWpHuNKg7qq5CEH3c9bT8y+fvSg7gVH4XAC1/8HLQrhPI1p8sf3oUrPzCyqucgVHR3j75lu53oF2HOW/UHciE45pxvAXsWfOwioB2m65TWfM6kCYy/BKIw/2OuwlvzS2wuoSQv7MmJ22z6/GEkvcShzO5gHFYMFLjScU+oOwvxAHMlgE3AtgdwK7qBfD8MpBm/znj75qCMDnGrwwzai0ah0I1t2FBHTzRNGHOJ0jQvwAnAJY8Bi/1LYC9g+xEFiStzDJmh975vgIL4lIW3hHFEeWOlbYHMHvdcyRiieNpIURIENA/z85nTCqaxKaTe9NEcew88vxbGfDjzn9nXdfXoQsQSAAagJK17lQFVJJPqLl8O5DJvqsZhPnyzSD1cwNMVYCPWewzq65JwsFNxWoDgvZgrG9BHoPRgEEkBkcg1/uPY3dJLuh+ZhqERMUgAvc8ITQTPU4GWpWeCyHaPnb7QVKP7k2196S4fMxpa9+6XtKhg2rMvrySBX9/71qicGMnAOsAsAXYVgBUC3CLuVVnIAx/IAP3CrFu1x9CCDPr1hUkXEP4YVTfAs8RRd633SQMM1hl/Dq7BU1PxkYmQyT+4YYuokc6wSBRhFGXdXv6NTDGRBGTTQzgx+zDJHocsGsXrNbNzCt+7GAkiKeqAxFJ9Zbn6ycXExHQ8rt3B1DmARTAp/ZffEloiqMzwNjaiw7AekLeJytzywmg6or8QRAW2ONDzC+Sdq21FwnJ5gkSkellRsUphu9Zf3negf3WwA1A2SEGR0rFAUnCKHdT6fYkIYTXQgQqLG5MLo8JCxjAjyAIysKzo1CZ+lEu4VEO4JFz/1UOwTmAfOzl95y/ew8BUhIQGoHMxKDtkFQVoAqAcQIq2VcdACp1IZV8ea7VV6g8txCze5CEwQNcH7e4CHxYlZ6IHMw2eZ0CXSG6dJmsXrwEr0sfbRrYT1D5GUCOHUH8XTmujo41tv6xRXaADOfFjwlixgU4ktiGucsleGsu95stAwYTguqYA7IPHUAiAHQADejmrUDGAaj3A3AfP7kFGeejXe6QAWTo0xeh/Qag5/DAgpfCg8gJiAYhCUY1r8Ak/goBHggBqOtQEdQ0MZATcI6jEp0Gl3IoCKEeaKN99zM5gHLo5T/3VLdALYqhR4q9r+8o8Gh/vidOgctzmOzkm1J1fLaGfDwZ75turcAfnwmglQGTC6iWv1QGqvLie/62A9vP1tqryT+4T75NGLsPyoBVM9FRuBKeSBASaZjhxMcqzCnBbHMN0i1kQmrnsLbUOYHwtWBKRWlZ2FdQANyGzog4HgPePiHw9Vu1ndl3fE0BUb3QOH/gEiYz949S+x3IHNbosEyTXWfbrQrw8efvyUnA103M30ICSwiVGIAQWvJN5AlkC7BX/gqWiAxEac928E1UBSowvfXmbsCedW8kF6u4sbUHk3i2h2AybBhm4uPwgtWJPZFdfxzEw3DBNbXMnSO67qJuXcfB9viJhKEU3qh2kPQ7Tgo2jGCnosmi4wA+4fw9YQhQ+wJqQnCQCzCkUMy6qA5E3YFSyeHijVJSuZCy/nWvamnxOOVx4Y1R3YDAnmSNDYW4dWxXYeu8bWzZGX75GgYuYaTuQxC6DEVMPD3gKb8xVvH5c3VBX2Pip4UPXTAf6MCbAbez9t24vrk6RXJRuLNNYgpzAJ9w/t71lJOADfA0LbjE/y7bn3MBocqneF3P2ustB4CarP5M7I/QRNUj1Q9sf+gEoklCZM9kiZHUWZPH05W+VR20gipFPEIMx5yCDnscGUwm554aLjhQD6oRI3fRV/y8dqIUN0MS5p5VpxKruj9mxwH83vP3ZgeQQoAW/4uWYOMEMqtEbwdyuYF8U0yMj8oILFXDgLy+FxbMVAWiNl855RbPaZ1CfRCq34A7/Caz/u1h+fPGLsErXA1LkjSYVmh3joCQIqU+ThI+NHrDXAApJitqPwwQdhpCA7bw/tgH9q/PBFR8MnegyCapPeUGOu4kCg2WT8wEYJKAriRY1Do3Can4P4PCdvpZAO+fENxoz3v2fpjwIyu/37HkPurNU/0BJuPPoBFuwwCnM4GI7XTXvmulVKDzcw/I1bxgYB8H/ryVr8AkEPQBOyaWHtHUsTAZj7OSDj8P8gixawiIZPBK7xJkF8KPwwJ4LnSNyyeev0+GAKkJKMX87e8GYKwU+EpApPYtbq+KNZP1f0zsP1MqrByqwV5vm0ziKXIpw88CwcE0aj+WLbhIEMcBnzhWX8+U4otS2GOJ4UW6gIhARtb9kCMY1PGPOoK5F4qQqovkLgI+lU97TqStU6HB8knn7/NJwN0yY9//4M1ATtmz+hq1Dyz+TAmwC2YRJhR7hA6jTtxRIIqO0QBdgOQHEB0Pvo9KzDUo0oN5gkuQbkFYWQ3c46TSAxkfbRr0gdpFZOOPq92BudbBG30soD0QnQM4WDmIHUC79kQSFtBzZcAA6EAQ/P22sy6fdP7+9XTa4n+YDYghQAF3dgNzswHTl4gn/hQyUBN/qjewNh6dggTzZFVAhQczoQJGXEMFR0LxAxO+oZvsYQHUcxk4nOxgnTn+U6sGDpgi/ozU9oUtDxp1elZ9qNod2z0MASrpEhgPHLM91Y6quxBm7AAUqWxjYPnk8/evKf73SUAVAiRQ92YFauD73EAmAaPSqnEIVNhYWdq28KZL0EVNQX1rHVUDjJmOKglRLN5JHlpAWcvecxL9dX7t44DfdwlToUSQXIus/FNIYr7SMKHyT0gKqhg9VHdJEj37bis9NQwwLqdv/3cH8K+cf2BdswOwbwYSFYGw/790DuaLktYf8wc4wDtOga0/5wK4n0A1C0X9AWa5SACa1mW1HuJ9l/H3gGkDWoUM9vhzoD5u3Xvhi/ITI7II1x+w848G+uDlINFxu0nCAxOVlC1nh+AnDXnCGYcFOO0XQgVTATjoAOD57ASQFD2FAV718fXgOE9A2fx4WUsUZl505cB8+9jqT3xm2+w6BDOLy3f/qfxCmW9QQw3KBZgsv4rlrYK76wvj8w6ooYqhzb9ne76KEaD3sxOwFJBKiPFCcwFvVAhx4LjKfjvbf2B+gCYJAOuwGnHAAUw7CEsWy+/bHQC8DkyWAHkmIIQA5Aoa0OfzAL6lF4ZuryegJvvIUQRx/h50ZELBh52ikJZ84Ri6Hr3XN0CM3PbpuYf+ul5Y4GLwHikNuvz0sWJCiYDvyKKj0uqcDMDuNgccQFf1C8kPwehdmlTvQ5UDH+q5Y051HioHIJZRE9GeA/j9579rQ4BcAeg7Aazni94AbLwZhAP14ZQ+AtnYg8ookn0qNFDHiZKHUA7kWrtU7+h8WFY0bRo79bTMQGIcyBT01NsPEu8vZtSf9b/nUoTH6ChpA761uOxnekCsVzOR2IuIwR4frqXTazBFDsWxhSFCrNTOQeyBdxoPikCUa9DLIAQNqxHqusgBbATQQoBtZaoGtLf/2L/r6757zUCiLFicQVVXmdArrgHZlpN44rNRcCYLZd+jun9+KHxt9VEJ0AzJoJ8/iGCoHUqLAUOXguGFAe08OJ2Sc7uzGLz8PZxLCBU7JrhhiHHABWjSyOfuqLYEMJTp3PqDDoD3r9/5UMvvGOiqX2B3AJ9y/sHdAfifB8MfBcXpwZkkAOTqxaBx1r89cL2NTSTWrcNcAADMgTGoAIQVAyKLmbDgsd2BnGcQjiGO9ftgZtcynzOInYQ6Bja2PNUFOIBKx6GV9miooFV/cOzAiuO5p3II1QHokOKwA5CEY1U+Z912aSjOI/27npY/sBNASgKmdwPm7L/rAlRvBAp+LIR6AHqTgcaOIN8o19orYvZIuXuKHrUIy7BA6bW38i5s2HdToGWTzN+p7YUPUe1VHm60zoIkUF0oIb0hLiAP/n78r+lKuoEDJNENPzoW+pADECU4TRAFiHZMmLBgygEooLdjV8DLGYZp3+UPnH/INgLhLwQbMpidD7CRCCbV4B0BrjnIDng5j6Ao5UDd661UDUOmpIeDH+AyY/tFt54Dew0X5qx/ulXBNdVjxTbZAV5kg8FzmatTVQEFTk8GTEz5u3bOHdl5RTT7toNS4gyJtOPMhxn+OjPIDjmAGOD+haQ9EA+IImwDHjmAdj+WP3j+IWgEKra/JPbaewJNDJ+dgv35rwzmcFJQshz1xaIOlLYfwJEIk4or33FogXY+r3ONOwS8qtQRIGH50Dmo3EOfFLT25fsWEIsGsT3PU7fB109PkwHYTc5XcH2cfVUIQpVkPZwHiN1Pc1EFeOzcvGIbhyBbjS0YRyFDPeOjHYAHv52D0NZvfy2fev5hqgLYNwPX9wLugIO3BRd34EDdgF5sa6jspsSHlQXOAzCAEYg6FLCq9xSln1TnQ12BY+s/tvz+GG249gIBGADDmn/vHJ3wZHhcva+06cPZghPqPkhA9sIDQ0YvwOK/OAewnvhYUf4Ax0UNCzKZ7gRgGoGq7Uewi98KQOBXIENJ0PQHgBoai06qbxSYXhiSQwH3wg2p6jb558hgVum7jiGoLqjynzzfUYfQcw/FMj+OFHrE4VxJMP9ehw5WbRzQuk06KmeiQw/vKPx5oxCkqv5kv75VcOEIXD6h5wAemwPwpGfyB9V9ebLHJOB29uVfPf+IqQLYMiDW+LneL5KCWBmISoFH8gBBmNAHNKs9gsL+naKIYrE7tl/afQXIkbKP1h8lBTbP6vMBUiCFi47uQxW95f5tOuo7G07wL+DwN+om+ErJbmomoAIWkM6LcADbzTNk4y17uy+KyGgZ5QFm9y3favm0nQDKZCDMAcDfBbQy9uewAADlmntUeIBAGuUBuH5f8g4dIHeSe0mYRQjBpb0af+P5Rw5gBPbR+qNkwLAkUOaBwlBVYI63EWQCFt2u7ZAC5wcOuAq2s1WRBxUMFd8710L3aLSPstwjiz9yEOb7Bd2Jj7H6qPyFgHYH8K+df1TkAGhOAP5ISDf2D0IA5wx0SLDfnKDcZwYXtwebPEQv+RerfOsALAR2QOEflRCcU2sdzcPSOkh6bqC/rgv4YTw/mSeAee46XCiJt471f2ozEc21Vw7Egss7gmMAb2PRkQk9N2vN273g0GVs9ZWjwGXoIDIB2BxAifdLjd9WBvavxO8GkPmAuPwXNgkpyy9aev2LN9FZlPQZAdk5AU8GjYDIlaADwP6AunxEFu1c6i8cdHq9dwNHEn6szGbgB92CR1xAPR78WKUClwW+AFe2x37fY26iF++XkC/cRsy1j4iC3YghjwDghxwAjS8bOliSsMRgAd+u35LDVmpdPv38Y6IT0DcEpZ8N2y5fTAxSXYGz+YCw979Yc9X6q94F4MODBstCEPPADknmEWQQAXAW7EMXwAMF5xlMOoRpwB/OEwhFd2FDQAZB8xQm/ZSb6OcEWi/+GNiW2F8EwBmMGMIoQnn0snC+ATmAf30nAOwE5CnBQAZF6eGXg6re8otCgmSftfn562OugPfLjTKFueu/+/dIJNHWUQOSAWveKqoaCGDXoRs1F02Qgbm2eq2s+QhxpXad9UMF18dDBXQEFdp+TUXlORibK2PymXAhX+9khSAC8aiRSF4z9vhDHX5MFAiqosxEHvScXEhAY4mz9WX7/d/wtWFW+f05vDNY/tD5x3UOIMf6+AYg/LWgFAqU3wUAu29m/+WuwB4ZOMBj6BDlCvLNFcCMbTzo7UQ4gIFEGyyWsLQNVyDx4QYOQOkQRMzsyUSFHpPJQ2HXvQsYAD6o0fNeKsTZlw2nCw+s/zCxGTuL/c51ZuVZZ3EU4M2eI3mM8gt4TxrgrYNKxDBa5q0+EgqGCzsByBxAfUfAdjJ6EYgDvnhRiCgDGhWnacJ2HcfxPjlonQQO+uwIuiW+/FgmKwDWfSiAeYDPgfWY8ns4DNyCULH5sAM8wjCB1wFqdxrxhPXvZvdji74fWWT1LbDngNqO1aAXxdxo8SX4B2U7vD57Dhvz1+0ciVnws9Ph614+4/wTYQ7AvSLMvAtQ/UKwfVGInDrsGnrgVWFovdC3NQAAIABJREFUg6hL0PfLZyZUcwT2e1WCA8uYypLPVAD6Vt4CWYNsDuyHiaMb44/cCJCZs/1e9brkMcg1xI7HWloFUAUqY8uFks8ouNsmfBfBhAMopeNOjb88W7TzDHj8rvx2JhsWWELwQFfkBt8jX+fyh3cCiHIAXA4E218Ayu3BJiGYKwkl9pUvB6GfFVcEUSyPA3XQF2Be/MHA058r8Lp9AzNWHiEcgV4vlwAzCjhQfJmTIMfy1OMNEniWcqxVLZbbgJfeLYAgMccKCIZtdXzsvKY7yUgBXX2HA85BvjvAX8tY7fW1yVBB5i/QGbTvtHzm+SeDHIAvB6a4f9tZTw22IKIyYK8qwOsoL1CHPcT8ZnBQX0CDoH97kB+gDGrYQuQKZtR9ZptqsDMg+w5Dx/Xdfbox/gSRBDVz5SlcjD9dKfBHm5t41Ak5trF0sPvQqafLbcw5AKPeNKMR80W95Jw7Ro75K9DhuSL4IWDLc/7tuNbbrqflM88/lacD55eClqYfyAGU14DLEmB1AtvD3E4avCLsQCJwP46c/lvOYRU03B6z7oY8MHYcOAKjqvPq3gf0/HHYOjtyCRJhkRLr/ScThzzPYTLTzzC3CUALZksmcRjSTyKqY9Iy2X044QBA0fmXftC9qERduQ9R/oATk5Gtt8fx39WGCqD8IjxZ/o1KAPmHQcorwdyPg/jJQdIRmORf3BlomoGqsyBg8mzB3ChkFN6EFzYZaId1MLlIALylIL07aFfYW9cjGExwjhKKsK1U9FjJPQHpWFtup8qVYUJNeQK4rkBNmaBQwcw6SiLi4Ld/BwlBUX6ThITABqLjkptWaH9upcj7vodyBO1KpdUPypajbZGcls86/3ROAuZfB6r23v5SkP9BEJsErL8VOGgAqgMumApswM2JQEjuWZDmG6VyBKZzz27nCMLNAdDuwEN4e7TsSuygUI5AhgqPCAnmwD4Aarn+x+YIDs0JsAN7/9TtIhTb47sBDjQWuXCFzq3seQN9GzF+u7xO5hi0SuNxvdpbEk2qHtl6f13xtvYYyx/ZCcAmAfEnws1rwrD2X1/80V4Lli4jeGX4IAfgHIFqCFI9AwQ8m/2fcQR2GwtKtupe9RWIY/ud17iy2hPIQyokE1dAT1Phg3Apg8qDV3MinzC/EKh4cSQHKhVswRPJKMfUU+8gPAn6B0YWP3QPzl3pUKSRDth6SvwiUaQwCbfF4yZCWT77/DM5CUjvBDRvB6Y3BO1gFu8LKE0KNd6eJAOX9MuKCkk45Qw80LYlUeIvr4P+QYZFyTuYc3W2l0DPg1uqe6lw0ENjmnHXlRNKSsPlthMWfvpYj+w0LHaX70N0vSZJdtBNGMIJwZm2ksQgGmvapB/lPjRAu4oukneaECy4y9iQtv5Atr84gnYP0nmWzz7/rEgC4lTg9lqwBK4A+KU6UOP5BuI6wCNiMHkDNNg8PRiJQalzAnm6TlZ2pd5+mY3xWZmPOACtwkN3AKw9RQwO7L7DTp0Tj11BMdV9qFR0dE5rUc31TCYSnXUPKg1IJAhIBFJVahHuKOuMym7/bqQy8zNgY4dAyu5afi0Z9cMC3Na6ALyO5XMqAagkYPCWYJfph7IgkkSvG5BLejJ+F6XEzNYyZCCGN+8fhPjp8QrPoFYkhARm7bM6b8kke0CidjLxAE0FtrgSoZy9aH9vrn9uymUcDBsqICfKkpHzYeurANlddpAsyhN0cf6BygEnASX4yZ53HQT1Szirb5KYMF5cCGCJYfmj558TSUCcAGTfEdjyA9uBsB+gNf3YDsB8rB4ZhLE9tgDTkHY9ATzk2YE8zhFYCzsCPDsGBE9SSQW2OFygHEbef257OPfwvJ2E5aGkYL6yg2FDBZxI5ikVD5cF5zXhBWb4RagUtw9b58MkIc8RTCjy+/pj21BFhxyt38EqvM4VJDzwdS6fe/75gABK/I6/FORzAUgI6aJ7cb8nA6OKwgVYpR+FBwrkmRj2757+9hrdW0YgFDkB8x0qSMsxbVCBD79RFjuLNFEFlyovIY81BHtg4feA0PsGPoe24pFDUcSiJ+F4YvQxe70fopQ2dgV0vPDlIH2gN/LJZwzKergduwEFbusQkEhtWFDuk8wJkAuw14Ak0v5e/s1MAOmXgV8HAGNIQD8V7nIBfmbg3hDEyT2cvWfAXrZFsDRQ+r5+VnelzGUw8+C0/QAGvEafLQANcZgsOJ+bv0McBhglJ+Da6+qEFc6S41E7wBwmK01qLT3L6XkHcN7J8p4lu3zPBhWOUby/X8WwD2CsvvgWIAQgg1Y5ExdGoAp3SoazLoEVvYUG7Y7uy4KE4fJ55/dQFYCAL2cF0u8F1sQf/VIQlg1Vpr/zHgADOH6TMCq5nAw0o/QMlAjwipR6roBcSjVdcHwA7TTQcxlLw1t9FwDwNNgBho8oL9qfCnucK1AgMkQZWfhJV6DyDHWZKMfh9YS5AVVFKGosGqgUuPk8cQhgHcG+HVQ+GgG0MYpuwRLGelr+2Pm1DgFsyhxVARDsOgm4X4J7PwDYbfGKcGvRm9I3WMH+BVxhPkCoPyQK5bkUYE3YoMEWA7kX+3uQmOOYcCJyEiLEAPCqMEKGQMPQgex8x3koZWb7Hln+npXf1z3KFYAaDhwJ2/UplXe/GkzqS6Q1EwIY+y5fL6YtfSKAGPwYBu8GaSOA02nrAsS5ALYMmMKD7UthXmA7kX9V+P7Vq7IzMYAyY9mwlu7QtvO2AvjkBDxJsFLj8VmpESp4rp66otNottXuMSIMALBLYtlrUkqYQDEmB0MTQ7AL9Z7qUCQj3214UvmBfuhgyUHnF+oA707o8bZfHdsAlSoAPTfAAIxJJIOYqhQRgA0pgFCxwkfhA4N/I9Pl88/vDQhgAy+WAfnVYNgKjIk/9U4AahvmrsBKAOkNQumGlb+L0+iBOQM7mi1YuwMGJOLUvxBGENdXaz0CuSIX+2Meo1DAQKtj6ZXi8zTcQls4UIwiT4cMlniwb36k8Hy+rmsQquavNx3BWny/rLs+zBd4wrAq7hXXEYprUEIrj47BEtvI0itSSGFB++7FFShiWP6t8+umClB/GKTG/uwGUPlFGbBafpoIlPMB9SIGGX8LCN8PgOvd37IJiN2FJRSvtZG6M3zaoItBnNdU28xn64cCKvnmgQ5LgtKdIgef+e9dCwzOQV1fuRU7MIk8REnOkYhImvF3Qgtf9ne2vpMY9MqOVlsRir0nHmR9cmAiYRKT4B2QCcf56BAsYayn5Y+fz+t6em9S+1wFSMqP9f+SGMQXgkQdgfyeQHgpSK8TUCUJUbkVYbjYXABL7seKDkpvVD0CuwIwDtd8PIjduoClwV/6t9tVeXrCAKYpL1/D8fyAV+5jIYZRWFk1sN9FAXYfpJ3wQbsF4QA6hNGz8AiS9nf+ZoI8LIhRzUfOIYjXZduwdQwF1Og0PFn4fRoppnXLF+wEsM0DwNmAhQAoDDDvCtgOZasB+8FLrsDZ/M7U4GL53ew/tOyYW2jLGxCUDUcVF4ruQgPlCgSwndXMxxY9AOgKujB2MXYnrOjE4+4cE/kBp9aySuFjbkdqjwX8cD9l73W+QJGDXoZAtSodvSwUwWaBR/vn8dFAinbcEomy5Ug6PUfAxFMIAJ0PhhD1XECMy584r+f19PpiCWDrB8i1f3QD9V0BOCdgXA2oIIjmC8gkIDiJMEkYATYCfk/RRwQShAxVqSKiQK2GbUSc3XUJZOsjMkk2O6Ya4QlEA9BEGDBVafCk8fhSYb6mQSsyAkoBFsFhXx2OVn9k+2PyaCDT4YICJ8fxM9so4kiS3sY4g1/ts/yJ19fXT8v5YrP/rRFoAzV3APZyAWKSULX04tXh3B/QqQI4BZ0OBY6qP4OG3EfpAOzG8R0S6BIFhyTYCcjHZCLCh97bFvYbgBePUghFEgfUv5la9+0fWyoUPQ+spp4slUvIy4JJP9rqd5wBKPu+FZUklVprcCty0ATkVP0FzABsxLCeli987/ra6eJ8lQgArH8lgEIG21fmkIBfEhpXA8y8ARUedHIAxuYfJAAkEA+dNGw1bPLyUKnbnjYMgTMGDT9en7lXQJEROIlBqOHASvG0AzgBuZQVI5DNgj1MBO5ohqNMEoWO/W0o4B2AdzPKKhtnEHbrHXMJeL06Zrehw35doiQYqb1yCvacNgfACcDdMHzha+vPL5frjSWA11uNf/8VoOwGaguw7QfYL4SnCZMDaD39oiRYYFh+cciAUij5QRJAE+7BiiTAysvntkqtgRw5CR9CYHZfHgtn8k2GAEWZOKCx35vuyCDmd0RgkpvC5vecwcSsQEVQBkCdY5S7zKDh79CAkvc4UBnAc9i/PaDLeas7gFePK2CzYwitPhAoKroiHU94jRiWL3pt/dnl8nQXhwD4I6FRI5BtFEpfGpN+/ZJgfeBYJaAMPyp5IhxWb0EUJsmHgx72hay/BiEeNzqGWh6QhQkFPFlU4HZU296LfJ4hQcC5ujkChF/eZ6IvQIJ2IgE5VvV23RbcmnhGCT/1k2EIUvu3tuq9mD0RcGzxWbUdQWR3VAiPyUa5l0YAREC1XGhdEB57+aL3rD+zXJ5uT6fzhc4BQDtwdgL7acqvA2GzEMf26heEqtqXGDvIERgXIBKCQYnQEQUafFHi4+2tcto8gIGryQXwXmW/pi5IV96F8HbsFo7kCDyN7UcLymoRmcQxvz2+2W744lJBLtOhAA5ivD+WCKpiypZfJBN/jFllTyDXoLKAtoBk8HtwewehtsHviODXboHDFhsWLF/88+tP7QSwbHkATP6h9S+xP1t/3SKcvmjPAdCUYdoeByWCpS0fEAKAXhOCdwt+aCJkG4A81AnshZjIVkugCWDyddTPZkCX60fnQS7Eba8gnY9zcCZiUTml+jbufzpZRKDEI3PcHOUetDuIQeqBHpBNVW0kGPs3hhwFtF27P905yHG+/WxzD7xuPS1f/HPrT1xcnu5OF+t1IoDcD2BifwQ6hgSqHEgtwjXDD+8CiKoAveWDvMBxoEckAEBy4UEhBVboTAIuOeeBWgaVpY12XOMO4HgxQWEIwJG/3kt1/yngmr3B8cTuQJOMeuOvpYZ2N6zNJ5WddBgMMFRlQxwZuHPlQFTS46GBU+fJZh/lGiJX0F/uwb8nAb/kZ9cf23IAmwvoE4B/S1DL7HtnoJN+yu4zMRTQ0HITz5M6C3LoEcJwXQBkVvEGZrweUuLqCFROQOj9QOnrAB6UFflaG+iZJIJwYxgyRGD3pIODX7kGSShh6c6SwiG1f3Q5MFb2puLevvMbeXu5A23f50MCD352Bo20EkGmzxsB/OjFxel2J4AtD+DKfyUHoNqDtxsTOYIcBuwAoFmBJjwo4ImqA327PwRzQBxuP6P2EVjztXbtPWiMSPjxeROJ2EDHAqK5g1ZXLyTJZMPuJQC3y9Lba2AV5rDHWOlQlSeJ4EBFoecODBEEnYU6BEBw4/2aVPmOVUfAd+0+dZYiQNG9lOXaFSBZ2EQkfm889k4AX/oz6w8vmQBOy3rVCKCUAqEBKOoK7LUI5zcDmRZhsPoWEEwUTVkr0TwhFHDgo0SeU00gDwaf0O5UtAv6Bpx7cOdWpNPKkh5OjRjseZ8SBoz31ZOHYrC70GLY9gsEOjULUDuCbihB8+XZlVg1Va8wo9CkhBKgrAxcrf6oysJBwPFKWFPBDO28fWLga7XOYPnSn15/cFP/zQWcLk43iQD43QA5CVjfCcDNQUnl9y/NVYEM9qZNrPTqF4S1/U/H8I7giAuIgdzIxuhqlySyEstYnQBqEn6ODmzBslOaNPCgrsQ+gVmC8S4jDgX62+rjJlLyispgw+9jtyYioJh55jgFNBwmoN2uahoc36qnBWkP5Eftvtn+ES8Aad+JY31yBpCw3B3Al/3U+gN7DuDidLP9l9qCg1eEj+YFmJ8Vy+BAd1CHuQgJXFlvZP0tcXRJYAbEodozMDKwpxS87wgYzKGrCEuZjarkvmKCUWTn6/7d6oFXW3NekSj0oB7E8J1ZgAg4RRwS2CbcKe8I9C4D933q30wafLxCjk7VSfFnwoa++jdyZutfPi9f9pPr919cphzAaTldLxfrXg7slQTxp8NMIpAcQB0ctR8AlB1mDbZBpPIAbR8P8njdvm2YxS/k1FRfba90mo/J17Q/tEH1oIGtnZ8DAEM7gwlHFVKmz8H4GNNWZUAZtjrr/cu+KqnYA7sHbL5q0QYcJfZiJfeA9jP67BU0d9AUM4rZjy7HqscMGaht6n12Mwu9wiuCQcCzU0HiWb78J9fvLTmAZSOAy9NNIgDIAVA7cCOH7dBifgCrPr/+y7T8stJbd5AufqYikI/zQkEPRAFq6kGftwMw9bdhcBUiAAgFYHZK3w0DWO91so+JDn1FJaZwXgOqjCcNXMLvLVCKvV0xfke9DbgIasiJyGOcAHyEK4C23nLNM4AfhQcR+PvLNTGE5JCvffnyn1i/u1QBdgdwuecB9jAgqgi0Xwr2MwRdVYAbgvacQCYODAnQgqOTMNoVxP8VLOP8gFJfBdZk08gh1GuEYU3bKEcwk0C0DiQmCL6urnMwLshvKYFe7nenXdhCpUG2B3YNan+kLuCDSUMRkfDgZxcSxfdG8YO23h6IkQwUAI8RAFYjJtSfkoNa/dsxl6/48fW7qgNIeYDrrRqQXgQqZge6dmDbJFQV2839L+CkDsGa1Rd2viQUiQQ8CBCoPjdgQOlKc2jD899By7DR6Qm1t8BHZYPrFSVFVuR964HSGyhRHC38Bfy8Sd5zInwwAK/PLS8NHIJNINp7wKpsSILCnmMgt1Bnu+/UGsiOVXZs/9t32vNrcF/aeY9m+/0x05i3x9HHtyRhyYYJZD0tX/Fj63dsnYA1CXhxut5CgfV0XhoBbOFA6f/nBKHN/PccgF+XnIAdoD4k8KraTwByydADSIDeZekD9Q/JgYHQcQ9dEgJdFrG/vVcAmWEfA+q9CgVYjW34gNDVnYR6e00a9lx2+jGtOxASDElioj9gnPW3ScyR5WcF7ib2yOEUQomIZLScySxtjySyEcCPrt+OBJAcwO4CLuPJQQX0pUkoA7mqPvyEmKv50zpZ2hN5AQoRFMjtEM8kMcgJ7A9I2HjlGjwRAZEQAB1QJXEQKKmPIDofxuXKLfBRrWPiUEABl8gA4mxUaT43A1Bu24nZrW73iMCC0MT9gz4DBAWC07kCqB5YIHmV98dB2w6Ae0L7ryKOEcBH6r+tX77yR9ZvUw7gtBFB/akwGw7YFuCcKwCHYJt+GuDrgBBVAQ9oVnml+p0qwKLzARGwJdg6Sj1PHKiB1hXUc1KC0V9LftQy3yBIJHh7kTqu3TsPmW7VwRKItfgxcWgngL7iEYDvJgA7JCGsOpPPY5xAIVpU2VG8zw5BOQoP9IBgSN0j0ihOYDv38lU/vP7NrQRYQoDiAPaegNN5SS/+VAQArcG7jQdlr7G7bRNuIUB2DC7Dz4Duf5YuwIAkIIEXAmxQf3Yn3RxCDGZWzP0M7lpjQtmHhXM8HYIIE36iemBy883f1KM7MDKgvR9ojsF/c84P6LcEz4Mcz6Cs8zQBdBqGGKgj8CtgoxMp1xmRgl3uE4T6WG27RAA/tH7r3glY+wC2XoDTzZYH2MKARgDtRaGt9MevC6eqgJnm65OADcAIVJ0TaEMuIAUJOjrWKGO/r49Ljggu1i6/zqu9qga0HDps3ykBWhXXbzCSx4S2WksqilBilW+uxd4B5QTwWu36jvJT9cESQR/w6nyodhFAUYWTs5u3+W5fUOERATxV/XvEgOTKcX/5nAjgB9dvKY1Aex9AqQSUZOCu5vZ9gb72314ZZhuDIgeAICt/RySgbD4s25XHbtMGQl4+yOonYPpjaAUmYIsuQ+MNOuuNNlMYwNbcaG6Y14jcgW9OYo33kIQzdisEVun5E8fcRmnhO7cBq4mFj+M/434xgBuBWSVEUPDfqKSsqk8jAEzI+Wtm8mIgxxa/3QuzjygRLl/9d9dvIgewlwJrMnDrCajNPr5F2PYE0OvDTD2fHYACPMb5A1fgQC1IgBS9Den8Vz2GIJkDiUHW+hILCg9gGlPZrlt1h6vtkoinivr4O4lH3otTgz4zr4DerhipB49djytr+Lw/gsCebx7wvJ+ezIPgsX+jy5hxAkgkcWzOxPFC7b8oD6rz2dxEuu7lq39g/caeA7AzBEvWv8T8+bPp/MOkH/QI5Gx/+uJcCVCOIG3XBlNT83oMnD+ACm4GvlB2E1fT+l7VYBRCiOahmHSMT/BvQAxdS6TyrU4sCQnupAV/HoqdsMNqq/EiVMLlY+lQgtUeaSByAibTb0qDGYD1mUZOQIcPiljwGmb/ZkC/MPs/VfufcRI2R1Cub/ma71+/YZsMdLF1AEIIAMnA6z0ZmOcHsBtIIBVvDS6Ah4RgetAZcK4SoBW/kgCouSKAemwHUjhusG7fN1D8fbhLwtiuwocYVsUBao8gD2uGmTDaD4A4kjHEGDgE+dITdUYGMak2Ac9ruicMBh1q9pAcnpD5b6roXcIs0Mueve1n1D2NuQLco/a/PScbFlgHpdZte+L1LV/zfevX7WXAy5T44xzATgSnkgzcEoHcIQgNQjgvIFcGsCRokn6mHbjlAbziCxdQv4TNBcgGoO06egnCHjCDEKJCsRv/91qJUaPVnH/WcAA/5Qo0+AWQBVDtvspZcGDwxAai2iXHNCHUWTgSr9YM5PZZKTvaYiTqNyT+ly3Ex0KEXpIPv0sBtfoeaR06BHuvl6/53vWvKgJAB5A6A/07Asx8AaP4AGjpAJoLYMBXh5Dr+MY1uKYhC275rgA4ToORbhJCYGM1wKh6zykU5R0RA4UKXqM9QfS2kU5BTFe27iSdw0Pc1hCsMxq4AXFEa8j9Of1PhU2QAxFJFDYwIPDIrIT9UMCCZr8L+f72yKOAj8GKLiLaRrkIdc0N3EguviSIJIFOaHnH96z/TyOA9Xq5WNJ8gFwFyAnBm6012AJeJATxfQDmBSGo8JT1VwRByTmboYd8gVTofq5gH4JEChVcPcUfWXhJNKTkzol0YG3CDuUICPYyd2GPrz7xFfjXk0U+wZIH+gc8JlIGg50BydAfK769B6iYNmfwhPgfMucI3OhvBdzHEUD7bmzlX5T670nAd3z3+leGDmB/Uch6KRuCavyPCcLtEoPPoOLcB+A/l+NQmS50Bx7cJiyIAC6qAZYUCgjihKKCaB3QM65hMBeh6LKBozyu0vSivN4D9BTeazFexYQbCFqIFUEoAvkFIYAXUPNnRY8qDJFFb9vbZF4E9McTgM81LO/4O+tf3gjgYgP5xem6/Lsrf8oJ7HMDttxAi//FT4nnVuCk1qU6gPmBAmKO98v2ZZBah9BsPdp9BCLkCCJHEGX9DYB61YBRJUHAP0w4kuYOld67CO8bED6aioptxbVqL+cIZPXABx1zZUN/RqvaBUqWsHoWHyktdAA5b8IWeqToCLTob7w2/nvGDURxflTjj8iiHx5wBaB9Xr72u9a/BHMBahKQcwDpdWHr/ivCtTtwSv079r+ShVJ6ArkDNxCFiXftfrbWzknDomh+eRqC/RJhA5OuBoSuYNYRhDkFHTrIpeatu/aKPIytz2AvYeBLOQZj9aE4GIYDlC/QDkBbfHQmFXTTLwZhkrGqOAP6WTKICSBOBvaBHIcFinw4dFDbLF/7nev/ERFAcQAJ/LsL2H9FuE8ATdHrdOL6Ik9Ue5hEVIFW1JxcgJnYw+ssUFsSUQCYKgIG5NNuwB+3W0IEEFv4CVcB/fZ+DkBEJ6iW9h2EZQ9FDHHyr+3FYRAThgItghPV2cLOlqL4jKz4BvDGMSF454CtVP8poMd9+27A229FEB6ko7BgTCaVCMgJbedavvY71r9YQoCS8MNOwLpsOV3ltwa3ZCA6gPIGIQwBTIKPAa/ATstMYq2/rsJDkkUBBoOOqwgE7h4pyKaf4zkCA+uZ6gFPPKo9DAdcgcz9Z1BCmbEXDlhwT+QDqOKAgz8kAPEz6A0gDHhPAArYjyGAXlPPvBvQ6q2s/iH7P3iDcHIUMUks7/zb6/8qHUCO/wsBZAeQJgjV14VlN4C9AbXjrzQHgSMAckg3DtU8/b0vM3Zf5AyicEAtFwm+qvwZcNsZ0uOxVj4tP/tZAuEx81AOLX4jCFbXvr7TWvHrQWp/TwnGxCcq6VQm5ghABRK6QuDDBFgyOZvwRRHASPWjRF4vwddzAyrWRzJCoOo3/4zsv3UKJZTogX93AO/89vUvcBLQxP9pXsDWJHS1hwIXJ/sbgibbjwlAagl28T4qegGeDgssYCnGd2U9jOfFtqIMiMdvQIri/8i6Ry5DQPNoDuBQ30A6nwUvfDowr4CP4Qmhnam3LVIEvxgUr9UnBHX5Ds8aE4IlJs7Aa3eglXKGDBjgngwAoFK1VYgwsvfz66Nk4/LOv7X++cv2SrCWBPQOYCOAXA1YL+qPiJpWYCYA/FwUNi1riouKH+QAyBUY5zCt+lEVQZcOK2xB7SX0Z+r/IekMdN+p87xPaA6j5wPweD4rcIQAmHRGVQFDCrWxxzsUJgX7uZ8DiMhFHQNDkkYqHpRdMoDmoC4BQAjWFHqWALzSWycROwHlOJZ3fdv65zAEqGVAJID29+4AlvzSUFvrL2Cn9wcWglD2v4JHhQmZMIJwwE7hRetOScKOQ9hed+Iy/a6/P1D8EPht+/2vrtprl+EhOw/8/SHTLxVZmOtgQZ2T4Rg6AFHK9Ha/DD90KKzS3lFEBKBdANpkPp+10EwOCHrlDup1POItwUwuWo2Vxe+TQnM1CvRzRLG862+s/9PFVeoDSLX/9Xq5XMq8gNIDsPcD1HkC28tCytuC9vi/5QLs5KCi9hTrLz4hmIYFLBfk0GJ0BrlS97hvoIGylxT0wN+zARLQUbigCEYAMDzmNig6IUcx+wecQuQHpglgMmesYnE4AAAgAElEQVQwRwAWpPiJATln+z3oFbBRCc3flIfo2XpW03FuwAKSHUI7lwJuDPCx+isSgT6Ad33r+mcvLtfbi8tley1YIoDcDmyagbBJCN4WJMHP/QGo/jv4CzCa8pvmoR38CuQR8CfzAlRVaFBMwCbthnx7v1rQlH4EViCEx+QBwpIiqmrfLRwigHqNVqnLGXgpHntEAArQPZCzYs8RgnAE1a1YYHRVHyoY2xE1McTxeEwWihReBAHMHmM9Le/66+uf2QlgdwBpHkBxAzQfwDiAbTvzpqDa/beBYOsU3L52Dgd25aT8gKsAJJC1TkIgCRcGFMvfs/u0jux+ze2HDUY2NxCSwyAUMJTgQD9DGBluA8KYCRv0NgBjOsdcCIBQbOSjYnzW+xmV77kCre7t7Uc+ro9A384ykx/oOYPY7iuC6C/zrmAW2GW7cQixvPtb1v9+I4AN/DUMKOEAtgOXv9u04ev6Q6JV4fPPiYEDSGW9Bn6XACz7ZiA6AqgABUB3l5VBaEnCFvM64cHmPXq5garCojyo7Lo4loa9WDrhEmaAbxWbCUWrOypu8Rc6BzAmAKXe9vg4UNvVNoBb6vAzCDmXYOkHjzMCOKp1/Hds52fUXrXz+mVj8NpzWdAXp2IJyRPI8u5vXv/b/Y1AFycggBwG2EpAmhvQXhySkoEK/MYNMPjt5/1xZ4Iw4HdhgOoPiJzAWYCYty0Oo1j/mBQqNAfE0LaLlD1W/P45WFnb59m/+t2KaNijc4228etHLkCFDHWZKZURAcg2Yq3u7CBeDAG0GFo3CcXKrkAbAbmQ5B5zmIYe9Aap5Bttw26Ft13e/U3rn94IIKt/TQRe5ETgHgbYqcHmpSEpGQjKf4gQGvh9ApDyAFL1rc1vtr6fK0hrAYwm4QiEYGJuDgIYzDZP4M5hOvjw3D0IHwgRuEMwtPP6fAreKl8QuwDb/BMpPPoF+wvD3klYsKrmInYOXjWZAJSqI9D83/ExMQRRuQGlvscJwKv2TGhQCCFyFuV6l3d/4/m/urhachVgvb7Y8gDpZ8JdMrCSAYQI6dXhSAD5rUGm7JfAjDMFfViACg3g7zqBArPYCZSuQgvIsj26AASbdQMWhna7FC6U/43MPS2H3oKxgk+SwBNyBFEQoMIL3tYTAmcOyu8aiuVZ2SKyQACV+xSRAm87H/+3bzRyB0pNLaGo0MCqtyaA4yDv2/92TruddwrLu//a+b+4vFzqK8G2dwPCJKCwMajOF9hfGVbKgBH4ySGYnEAC4YnyBPsD5+2IDLTiN/W3sbxX/BbF23Ws9WnwAYW4xB/rvQBt3sevmQF4sM1EjsCCK1J/XK6A2tbzWukIRKvyk8IBRxRzdh89Ayu0KttFYNYlPkscTDhepZsXQbseATRW7nYmbf1VeKJDiG3p8u5vWP+z1AmY1Z8SgIUQQP3NlOE0UzD/glAmgqT0ojdAJAQl+I3dz25gL9OBM6jHauCs+Yi6La2LlrvEH1KAJ450VBECZCdg6KDjEDTRKJCiYxl7Bt5CKbmGvN1zJiyI3yCk5wNwoKCIQS+z3kOpdSM7TRDxPvM2PyIDDgdmE30vngAi9dcksLz69et/kjoBKwHUMqAMBUpOoBDFnhRMYUCz+Qr8eRlXBEKVL2AvNXr7uSUfM8irwjYHgI1DKgSwjT3gHNzEINybQgCO7QHwqk6gGnv0dthFOOMSZtQ9Jo/Y7mdYiW4/BFyz6DGJNJDoPe36ppga2Lx+liDG5IDqXc7tY2qr6PF2nlxG8bklBQ/c0frR8dGBLK9+3fqnLi72RqAtAdj6AEwFgPIB0BW4v0249ARI5Qcy6ILflwtLCNDgV7Ypys7uAJenEMLsWxXaVxQcQdTGICQUkSDM3YGxmjO8IzDn7WY6DTnh1/k8Un8J3ADsFnIN6HgOdg0YMtjt/NGOKP/j1R4beR4f/7Nys+L3qwOWYhCQNpR4DPjt9/Nhgj3m8upfXf+jWgW4PN1cqARg7hDMJGHbgrfGocvTzbqcL6z157jfuoINnL2koAO/yBskgJPi5/DBx/cFYAxo+kwVAWv3AeZBV6ElkkJICSx+XQZRt1fgMeqf9pkFf5l+yv4g2t9qrT9PHO8r5ecZf33lx7VouyNC6G2DYENA279bgg5B/kYRQE/de3mBBvRRjiDRTdl+efX/Xf9kKwO2MABDgpoUzGpvXhxSl209AQjyQgCvu0agdeklBZsTqIDhBKEBOQBYKv7WE2BB3iJ4sP3UbahDBp45iOqOHoBBaz+360HIaaCH4UFUVoTlEsBB4lCDXWUBFODt3pEjeIwbUMfywO2FAx7ACuwxAeikGlp+Bu0oHPAJwrm43RJAnNhr1xNvU0hgefX/Pv/7rQzY2oA30LuKABBA7RosyzYXANWA6gYMeBMZaOXHHEGGqKsMCHKAZCAnCS3wMRzIeiwSi2zlW55AATzODRjtF1UDooTAxIeewaQbWbmN+j+xUqCgzWTB23ir75U/dgneXzQV7wGdnUSc2GO3gMlBlSj0gG3XocD8YglgjhyKrvsQokMCy+m0vPpXzv9ucQCp+SfF+xd7nO9j/50URA4gdQjmHxItRLBQebACWiQEAewJdDm+r63C6XMDuX2PgLH8wgnU/VwlwBNDcx42AMAJSirmN2ptyn7aEcR5Axs6FID3t1dv91HUoJf17b7dB5XckE2d11+2ZzDrygD6DFb3Y5b/qBMYuQMGn46v58OBPph7Ci/tP/20GB7d5hUUCaRly6v/1/pvp8lAbS4AzAnYSWBvDirZ/0wAygGcLtar2hMgwc8JQV0ZSMoN/+XPFvwFpna7ppmFMJraNwIpwLahAfcVcB6B5xM4fa7EYwHM+1njr6x/FPfTGYOE4XTsPwoXur8cxKTAtNDWe4AzUBthxJY/VngmCaXidhvrDlCxEcz9+r93GLEbsADUYG5nbvE8hx8xkAvgyx7+GLhv+3t59S+v764OAN4JUBN+OSnYEoDrdf07kcHNcpneFbAnA43659LgDmAEf/D3pu8j8LNTyFl46w4A4KY8yKSRt4O+A4799ecGcBvPxyFBrN4zVQL9HoIoQHixBBA5hjjut/DGnAFSQVluXYIKDRjQ6Dp6YG+hgz1qAUc7zljpfQIwcAPwS0KKELxFt0e2yt1b58kgdhAa/NvS5dW/tL5zJ4C9AuDtfwoF0iSgPFW4/r0t253ARgCZDPYwIKu/dAMYBiDY8z7NqlsXwGEBbseVgLatbx6KQoFY7YMQARKLHtzHk4MGzBPtxZ2aAmX/Izfhge2Jw1t4a+61ytuwQIGeKUJVArzizwLfA5v1P123Vc1GSAxS5xDAelv73/a0JNOz/kgT7ZryxZlf8sVl/m/lIGLgl+++vPp/nr/m4nKbC9A6AQvoMRSA2H8H+77NBnpIAu4/MX5RqgE504+hADoB9/cGmrmQAMnAhAW7gyjqjPkCIAKT+LPgdklEU7yzvQOeMND2H3QCtaphgwMP0RjMeMbHOAALWntmdTwLa64MzIIeodqoJUr6WRhbEjnmBBqxWfi1n+zWBNEHOFt7ZfURphFJoAtQ21uXYH1Gs/498LdAYXn1f1+/quYA9nkA2eLnRqCNGPZXhOV6P/67EwEQQCGENDloy/hDEtAAXocACdi2X4BDAvyM4Hfb1ap7dhKUGEQAa/XHDsQcKphZhFHyEMID0y6MPkH/qnEvTNBGfFbd57bTxMFQL+rJVxSBXqm9Bz7uPU4Etq17wPdOIB95J1xW3raMrXtU/x8BXhOAsu4NkBy7z9j6mW20e9hCgL+4fgX3Aeygh0qAj/8TKezgL6HB1f5Ogevl6nS7TxHegZz/k+DH/oDXIfZvLsCqO24D6l6bgXxSUIcCZd8gPDBqTIlEMwcAzxeDviozzQDU8ftkPiDs/JsDuiYTVvG2lXYA3jNwVsAm9LzCe0VXZOHjdwZ2epOUpQ0mEQ9qH8PPxPkRGaDJ96FFpNL9GP9p6s8OQH3eCOB/W78M3gewzwPY7X1xAqD8Tf2zSygOIOUA9jzCXg68OF+mGLW4gALq2BE0sCdiMOBfXjefffxfgNryBiU5Z1wCTCay7oEVHtXdA72XKDRuIoOeHQaercGMHMJEo4+aV2DBfYwQeqGDygbw9r2wQCm8pRBUdeEQzAxDezSV7POE0LH9zg+o/MAR+++3xSVo0zHUYJWeVXZLFHPALyS1vPt/OX/xNh24qT5MCqLEX4n767/FATQiSI7gct3fF2hDAAX+5gJs/A+A38mghQUq/o9CgbIcY3u/bYGjrxD4/YrSi9wBdBIyQXjAxzmC5iXsX4oongL2tK8nCG34tTtoBKCThR706axuOU0fVvD2YcEoDChA8HYfQedDAQvex9l/RQCjZRa4x9X/GPAL2Szv/gvrF17CZKCdCPYuwNwMlBN+JdY3/17lHEAmghoSXJ5ubQiA4PdEwLH/Dvha+wfwQwXBgZtcA69vVty6iwb7AgZcj9N+W+iwLx20DmuXgKCL7T6v0Uofqfsx1edwIHIBfrmmCmPY3VuJmCjsMWLgM2mosEARgl5mCWAmFLB+Ymz3lVtggPJ5ewQQ7VtgjDmE3jJPEsu7//z6Ba0PwKp/6QYsOYC9VHjZ4n8AfM0HXGy5gDo5KLmApOAF1P7vZNcT0JEMjPLzNnVbtP8cKoC6S4LAPAABHCYZVUC6RGIDNNt8b/sR1n0HoEOEo44g2p4hbz/3CQDWyhmDDOhy7Dngo6NgW2913PoIb/e96nOGAD/j/seXj8jBry/2u8HWJwF76xrEHw/86gDe9efOn3+5vRIsx/yl9FfLgpdpTgDY/jRHAGx//Xy1L98JYLk4XzUXsCkmJgWbC2jgx9i/kIFalgEP1QKv9pwLaKpucwJo/znhV8godgE8qWhEAjo0YKBiLkCBWCn8jOrPbFMsOpCC+4XeiDBmw4CYDKyu+2DBx/rKCaiEIFPEnOr3E34I0ZYz8O7A0ouO/4+ovz4DHreAu/2riCKtXd71P58/73J/KWhpBU4u4GLv7kvJvp0M9lLgen1xlbL/hgQgFNjfMLy7gJwHgERgIgGbHEygKUAvJJHj/qra1h342L4pf10nOgY1UQgSEFOKo3wAgr6XHLTvEMJwowAKAWqP5EOAx5IAgpeOUe26tvYJjt498Na9vIC1+O2IHviPt/x4VKX63i2oJRFBIPgUAWi1j+J5u1wBm4GrfEEM7j4ppLXLu/7H9XN3AoAeAGgKSuqPLiCDvZIAgj/b/0ICpgpgQoEE9Jb4KwDOy43dj8BPicE9LodtYeKQJwx0BFllIUSwoFbOoCizTQaOHIGfhmxpwQLdhwwWfk/IATzyBaIzeQCv7wz04jKU4S8kY6nCAlkpvLf8SCHHQK9AjlBt59JW3G57xBH40KCdAVXdVwdY83ukYH3B8q4/u35OygFk5S9lwKL+l+ACWP0t+Hf7X3IAez/A8voFkkBK7rVQAO1/IQN0CW1ZcgnFLVhAc3/AHAlURYeXitjwgKsCCPbob9VbYG38TG4gQYRTgQz4SQKYnA7M2j6bC7Db+TDAq35s7RVoLbTVpxj8WtubXe9XAGwiz+v9yAEw9C0oj6u/phsL/TngY8CxvPPPnD+LQ4BL6PzbYv+LDejl31zm2x3A1ZLmEOTYH/7dw4DTcr5sgH8v5AFsTqARQ7b+Bey1/s/gz58hRHCkALMJnfWn2YWzwPdhAJOEzRdYGOO2ESnY5TpsUCFDXpbbnCPwegMfL5klABsa9JN9EfRV7O+tfE/TZ+J+b8+tlvdtf0QArMYM7Nj+27i/D28mD+8H2AOMPpcjLu/8H9bPvLg43V5yCACx/5b533MBu+LveYDkGK6WDegpJ1Dsf/p3dwKnPQ/w3toQ1KoBrTKArqApfKkeKOUvio9xP6u+cAHO4rcwAGcSHksS6lAgyhcoQvBaD8oeTC8uDkHBdzv3G0sAKhBQNIAQLleqrL2lhb7510D3ZNEDu03t4ZY6VEAnEG0dq72y62P119bfUsa82isyqATwtf/d+hnJAUAIsMX8HALkEmAigaT6xQHsFYGrbP+3f1siME0PXt4LpUAsCxIRbMqf4/9CFsb2jxxBjfuBHKifQCcCmQwKLLHEGKn9yAX08wSVANyPhRxPBJY9tiFbaOSxZKD3Q3g2+uGl4zxArPk+M9CjBIasNvX9UMCnCvswR+AhlL0XiAAbxfCj2N4Tx0jn9Xr8Bss7/pvzp5cQ4HJ/H8B6vYUALfGHmX/4+2qFECD9vdn+Av6Lq9P2YyO3G/j3+H2P/fPfORfQQN5yAwh8QwI1iVjCBPVvBjK0Dtc8Qg4JIgJQLqDvBmy8H6t+QAD0UlGGu53uOxf/c9YAHcJRIogIwGp9OsOYAHRtYOQHGhBHGt9zBlbB8XoTPBqsLJx1jM+WPqIDPnaDooLxGPqWTB4HfHWM5R1/ev20y4v2PgAs+212fyeDZv139b/cY/715rKEADvwKwnc5XBgCwPu1uX1BR3AeSOBnAisAOfPuXFoW28dAeUIcq5AJwuRIFDJRckwIAd8g5DKE+j16B7y37MvHDVvOEajPyIATx8cHjQIquRhZOv1UcbVAEsJI6BHQUDbr6fhDOkZiD8e9Ec0nwMDa+x7cb2H6tMMf6EjTxzLO/7r9VMvLtb9xR4p+ZdBn2v+W24gx/07Eeyfd/ufbX+J/3MIkEOBXf2Xq9Pd6SJVAgrw939LCXBXavhcS4MW+Coc8O4A8wUJ/E3to8qAXm7dgA0HEPS4XbXy+SfNMNvf4IlAbb0AZl/q0beq3q//67pAWzrnAlitPQkcI4Aj8Lehgf7kLbungFnTr91BPwRQsJ6L9DmbgHCc8wAvTvnLkZav+S/Pn9KqACkPsCl8TvLt4C8uYF9ecwA5BChEUJJ/16e7vay4hQA7AZwvE/ghD3BKFQEJfugXSCAuPQMF4HkZTBJqYA+qBSo34FRfkYFqFS75AiCGmdeO8ctF5LsF0jEb5BD+fRdg10Ylwm2YMaDVZ47ibTBxlADQwHPIwFDVbmDGAfSIIYb0nO3XoD9a2Ovp+kjhR+tH1BDtv3z1f77+vpYETC6gZP0vU8a/qn4lgBQS7HH/5fXe9ZeTgEuy/1en7d9CAFc1D1DUvuQFQP1LjgDzAiZHsIO45BIQ6Br0NvZ/ihtoJGDCAAd6jPXt31bhdTlwPgcQ6XwM+jgc6JOBNfJlW7XUqjwDPgK9zR54kI/MfboiG20rQLfjMJBx6yhXYHW6F/Nj1kDF20xD3gFoGL9R4N/OtnzVf3r+pEQAGfw1CZjBX23/9nmL/5dN3W8urlIOoGT/M/B35c9/329/ny7Peykwlfu2f4vlb9b/XAmhdQgmABfXkPoGPDnYnEADPcwlyOofE0LJDwzCAflGIeEGahMPWvxRJSBS+p4DsG5hZP81CYz9wBwJHCEAFRJo9e4X/Y7bfF8AHIGeCcLCegR4Xh+TQl+/31gC+I/Pv/fyMjf0bBOCNsXfSGDr+tvBX4Cfkn+76m9JQEEAF9e76hcSuN+cwOYOdiDvIE8EUMGdKwPJwvtcQMsbtLZhGxY0oCP4PRH08gN2XZuR2EqDXDmwLb24XQHlUx1Ag7PP7D/dATSFHnsDHQwwLfiynrbyVtNHdl85gEjxLVlYrWUHoFRc5/yZIHpuYBzRR0DuAfyp4I9Ip+YAvvJPrR+/JQG3EuBWAUhJv9P1BvIN/JUIdvXPyn+9EcZ6c7H925J/dxdX6+3+K0OJCHYHsFyttwncRf0TGaDCa1fQHEAUFiRwJHLAvxNAo3wAVwG4q3AEfKwolL8R+E35dSIQAwLc1iq6LQPyOv95PgAoxrln/1UiEN3CDAGMlT4igHnlV87BG+1jBBCB3roB9gIMVAXcX2gCmCGP5Sv+w/PHpclAadbfRgAb6Av4S9y/EwISwN4HcLq9vC5xfwZ/jv8vrncCuC8EUElAOQF0AJAsbG6hgJxDBFxeQI/235JAI4lMHKYleFwe1B2DnCjULsDG+FFI4ElgnNzz2YMetHFdL9VX0oVRTcBSgHIADYjNcVjAItARpEr5C+AiMB8BOULZO4ftGjlXUPIMRTd7ZMDbNmdwhBTamfrhQbR2Bvx7DuDL/+T5d+0hwNLAv2f+r5abqwb668vrZP1r7H992j43B7Bl/wH8ORG4EcBdCQHQCdi/W7cguoGm/MkxDBOEUDFQpcPUkMT9AQr4Nh+gm4RY9TG5x87gMZOEElRnQgCv/rxEx/rj6j9TBNKBdQRWzeesvncA5ZjewjNQLeCRWHhfD2ZPALHVH5OBBvws2EdAHa1XBHBkn+XL/oP1Yy63PoBN+bcQIMf/l9c5BNj+zUSwkcCeF7hOwK8EUMDf/t3Vf3MBy+V6l+L/13L8j7mAMkGo5AZagjAGfysncpkwrhog6DFv0EsANmIYKX+rDkRuICKApvhRvd8TwNPtf3MBbOWbVuttojDAK7tWfQVw3DKpr1LzPgE0SPvtFAGoMAGVWqXvijOYA/yLIIAjQPYZiDnnsHzpv3f+6MuLZZ8MtIcAxf5fn26utr8LAVyXrP96k4ng9iK5gBT7b+C/Xva4v9j/i+vTQ3UAmQBqInB5rWb5k9UvxIAJwaL8UDHA0iF2DKL6Q2ehs/01b9CSf3YbjPHjsKCpc8sZ+OQgAzyO+Y8RgCWB+fg/0nxebj83mjhKAB7wiVgKiNjs4/aWCGLrrxW/ncPb9t46G9vHoB/F/KP1Mxb/MQRwdJ/lS/6d9aNKErCAf7f+1zkEqARQlD8TwfVa4/8M+rvLFPdvBPCQHcBOAOdTAftrOQFYwL65ggL45gJ8GNBCAKwWmJDAgF41D2G2nxOEHBaozyr5p2y/Ajluh8ZeZfs56u/BexT/a+tfQOj13tt6Ze0biO0RME7n+N5+5vxAi7uTA4hCALVOEQC7CAYyGnuv6J4g4m0iIP+iIYAvevf5I65yGXC3/0X5r9brqwz+q5sU/yfrvzmAlvzblf/qtIF/+3e3/fm/jQQeLjIBbCTAoUAjBgR/yf7bngEuFba+gig3gD0CbPuf0jGYiMCHBQXYZT2/G8Am/ljxkQqa/VY5AFxb8gR+WbzEqz3rPdr/eQLwYUDLIKh1s2rP2x0DPOcKUOERpBb0niBOp6U6l55LmCWEN8oB8LWNAoHli951/q0XS+rxb4m/BP6dAKoD2EgAwL+TQLL/l2j9r9f7y+vlYXcBWwhweb47Lyn+T3mAkgsoroCVH/MBLQTA3gFdHeBEoSaA8mahca8AOgZfGozmBDRN7vUCMDkUILPa6wwAg3scAign0JbZTIB3AQ3IqPhWxVm5vUvA7Xt/s/Wfs/gYViiQz4JdbZeOt/8iaP2faLsIgLM5gegcIyDPEIo6xvKFX7v+5hQCbHMA1uvN/l9t9j+DP7mAFPdf7nmA0+3lzVb6yyHA9a7+95vSZ+BvDmAH/+X16dnp6nzbgJ8IIOUBGhFwdcDmBHjeAPcQ2H4BmwhMSi+TgyIXUPoHxlODZ8KBkQOwcbzX+pG9n1H/PvBbwo2Dgaa62u57RVexPapv/DeTwQwBRKFAs/ps41vmwW8zcgW/WAjgaPy/fa/lC776/JtSG/CW9MvgL/Z/cwGb/U9uYLf/V1vdP6t/tv07AewkkP7bgP9wcXN6dnF9erZcvn6TwF7Ab11AcwboBF6rk4dUglA3EcVlQqv2SAqqOjCr/Dr5Z5t/Wj4AI38Ldjb/nAPo2/tY/b3Vt0eyII9UfkwAfJwEMEUIzWm0mNoSg1d7tuYe2O1YDcgN7iqeP7rs7wUBHAXz0e2LG1j++Feuv2F3AJdb0q9Z/+QCNsCfbi5vltuNAPbYf6v97wnATfmXDfBIAA+XN7v6P9vU//Lm9Hy9eO9VUv1GApYQwA3UUMGGBVwh0L0Ctp247wSwAuDnDbQXkPas/wwBoMpzDmDkAFDhEeYW2J4A5lS/ALQHcAtka/85qacdwMjqK7W36t4HfLkmb81HRMFWvUcK7+sE8Fjw7w7g87/s/GEbAWwlv80BXN8k+7//d7PlAHbVT+Df/0vWPxHAupf+LnPcv4F/A/6m/pkAXlqX1y4S4N9TXYAjhL37D/MEcV7gMRWC+XbhXva/vIY8mB0oJgFZE68IwJKASgRqhW8gt+t7qu9j+z7AOd73YYEigQKsFl4UR6Cs/hjsvdg+AnkvBxDnAqyT8ATRcgCjDP9svN8D7hFQH9mW8wDLH/uS84duIcBOADvw1+vrDP5EAgn81QEU9b9Z7i+v1ruLm9P91fWSlX99uLxeduXP/72UgF/An/7d3cCu9vY/mxtIpNAmENFEIpxUVLsEsVyIvz3gW4b5NeN2tmBMBOplIT4hiIafy4I2GIh0vtj1eQKYAb8CcTPhSAjNIbBKN9XluB4BaR0Bxt3Wntt9RiGAjd/fJIB2P2aThI4APvcLX/+Qq8uL2633//pmcwA5D7D/u+4EgODfcgCXN9n236TYf4v5i/pf3qzPLm+WlzYCuLhen51PP5+Bnohg3YFv3UDLDxQnwF2D+DlZfTOrsJJBATo2DuH8gWL92farvoCS6OMfIFEOwHb6aa2PC389sM8RgFJ3tuz9zz4HgGRh1RvJoSm+B7aP72fcwBzIE1mp+F8ve1zcj6HF4x1ApNBHlyuQP0X99xDgj37B+Z/ZZgJuan+9xf03hQh24G9hADiA9XYD/9Vm+wv4N9t/c3q4SjF/Uv/b00YALy2Xr9/toN8AvxQnYN2ATw5ymbCBn+cP6O7BXi4gKbt6bwB3A7b2Xp8HKOt0yQ/7ARG+jyWAfkxvXwLOCh+BfmTnrcqzSs8TQM/2Ixn0/44s/S93Angq+HcC+OzPf/2fvry8uN0SgDebA7jNZLA5gE39b5r9v0rKf3dVwb/eX93sln8jgedXxfrfnl66uj29clpeuzovmwNA8AchgUsS2vkDLUegmoZ8+3CL++EVUykAAAroSURBVDkUwLIgZ/zbJKAxAWjVj+DPZT6l7PGyWOHbPrG954SftfqYsUfgq2y+dQUjy+/t/Tzoe0m8Iwm+IyQRJQY5CXg0B3BU6WeBPbtdLzxYPuvzzv/U5gA2639zs+z/7mHAzbolBHcCKMm/jQCutth/j/vX7d+HTADPrm63uH99fnW7vHx1e9r+eyXZ//KfJ4HdGVTg49++aUj1CpQ3BtlwoCi8bwyypBCVAIvi4zyAErdj/d/W+THhZ0OAluizfqAY//ZvWm8V3y+zQI8dgFZ5TQYc51vwzzkAb917BKCAGW3PDuCXAgG8LyQAdwfwhz/n9X/y+uridkv+3dxuJHC6ubrdqwHbsj0EuLpZNtW/u7peGwHs4F835X92dbs8v9pU/2ZX/pev7k6vXFy/nuN/JADrBhIBaBJoCcG4cxAJoLx5WLYM0wtD5roA2fpz7K8IwCb4uJVHE0ADvFfz7RxK/Ru4LUGwQnMI4IFdYmmO171LaLF128cvs1UAuz5ah8vV30cJAMH1S9kBsGN5TCJw+Yw/cv4ntiagHfy3y04A1zc78HfwX+/gT7H/dVb/6xL3327gT9b/6nZ96fpueWVT/qvb01tOl++5bur/cxnojQwa+I/mBLhV2L9dKH5vQNQEZBN+HOPrz9zO44t43MiLYFXlO2XnRxY/EUSk9t6y2+x+ZPObVe+B3TuDPiG8SQAWokdDgzckCfjpn/n6P745gOub8/XtXQoBbm4365/UPxHAHvfvsf/VzXp/fbs829Q/Kf/6/Pou2f7ru9MrV3ent17drq+cTxvoy38YCvx8Sgru/xVHgJWBLWmI5cFSDrTJQPdCkVwJ4NmC/sUgUcZ/3vIfaemJQK+s/XiZBWzbPlJ2julVjK/jcgR++ZsBrAhg1va/kSHALwYH8CJCgBeSA/i0P3T+x7YGoNu7083t7XJzfbvF/nseYI//r28T+K9vlx38V7fLw/Vu+9dn13fLS9cp4ffy9d36yvX98tbru9PblqvX7hL4fzaDfPt7A74lAp8cTETguwYxIahLghgCqAQgZvltzV/N+ceY36f1UNl1lb/E9Sd6y7+N8dneKzvvFR7t/yzwtaIzyBXAjzqAxxDAiAx+KYYA7zME8Ac/7fV/9Ob24vbm9ny9EcDN3XK7hQBIAJv1v7o93V/fnh6ub9eH6xTzP7++O710fXd6+ebu9Jbr7b/709uu79e3J+AXAkguYN0/RwRAvQKibbg1BJWOQZwp2HthCJf+et1+JRTAWL7pfQ/sNr7nuD599m5AJfSsbbcqbxXcO4A5oCt1j9T8TQIoYc2L7QN4nyGAT/nU8z+yxf27A7jL1YDbXflvr2+T/b/ewL9Z/7vl2fXt6dn13en5zQ7+9eWbu2UD/ltv7k9vu3k4vd9y9Z77jQDWnQTKfxgKIBFgGJAbhUTbsJowZDsES6mPXxdWynyo8tFbfjDJx8k8m85TyTyM1ft/FzKYA3oP5M0dPA34PYv/JgH8EieAT/797/21m/Lf3adE4O3mAG53F7Db/5vbZVP+++u79eHmdrHgv1/ecvNweuvt/entG/hv7s9vP59+5tT+804guQAmgVYitKVBnEWIU4jt68PGrw23qt+SegXY0b/JynNZT8X1aOf93x70bZsE3gjoPZC/SQD9rr+ogagk0zj0+IXsA3ifcQCf+MnnX3N3d0oEcJcSgDe7+q+3O/jvNuu/3t/cnZ7d3C278t/cry/fFvA/rG+/fVje/+756YNOFz97fT79NBHARgg2HIhDgdw1OJwjYF8eqgmgB3rM67eIXgO9WHf+19p6SwocpyfrjqBn8EZgfpMAPMij0l4P0DPrflkSwO/5hPf+6vv75ADu7vdqwM3N3cXdzd2m/uvdzd3ycLOp/93p+e39ksD/sLzl9uH0trtnp7ffPjt9wN2z0wdd3b7n5fPpp06JAJgEOBTQYUBT/1IaxAlBJfmH7xDEST6+xIdKz5F8qfKrd/O0WL84gAJg/JeXqdq8An16tdSbBKB7BHp9ALPAf7MKMN8RsHzc7z7/g/cPp5v73QGsexLw9m7J4D/d394vz27u1me3D8tLt/fry3cPy1vunu3gf7+75+sH3L+0/Irbh9c/4Hz6yVMigB4JRKXBEv+rSUL0GnE38Qd7+5Xql7l6GMe3Rt+WnPMKX1Q9+jft6y08gtv//SYBqJzDTKb/KAEcJYJflg7gYz72vb/y4dmm/psLWG5v7k63t3enu9u7Dfynh9v707O7DfwPp5fvHk5vuX++vu3++fL+98/XD3x4efngh5dPv+p8+vFTIgAmAZUP4N6AKP7HdwTYdwNibb/9BFjSdGXum9pbkFulb3G4BbwHuQJ4H/SFJLZ/33cJYFQJeKP6AGbLgL8YCEDF9rPLODcx0vEX0gfw0b/z/MHPn59ubvcQYFP/9fb2frm/vV/v7+5Pz+6fLS/dPZxevn92esv9S6e3Pzw/vf/Dy6e/79nLp7//+VtO/9B68RNXiQCYBEoYsP0bhQB2fkD78RCeAdisPv/mXwx6m7zzoG5ttiU2t/82m95UHoFs/36TAHRD0Wxr8C8VBzAL9veZJOBH/vb3ftBGAPfPLm/v7k63dw+nu7v70/3tw/pw/3B6fv/s9PLDS8tbH146vf3ZS+sHPH/L8sHPX1l/1ctvW37N6fLHb86nHz2dTz8mCGALBdABYGMQTxDCl4Xa2X42wccqz026kcK3hhwEeQTs2eUYy79JAG8SQNSbP0sKf08cwG/7iPMHJAew3jw8XNzd3Z/v7p8tD/fPTs8fXjq9/Oyl5a3PXz693/NX1g986a3Lr3zlbadf/cr7nf7h08WPXJ9PP3w6n34ECOAnIAwoyUDVC8CTgLi5BxW/NOew1iewl/9KLI9Kj0BWoJ4F+psOIIH7zRDAViQUYGfB/j7jAD78w197+7Pny83Ds+X2/tly9/Cw3j97aXn+7KXl5ecvn976/JX1/V552/IrXnnb+g+89f2XX/u2D/z/2zuXnYSBMAqf0YhAW1pKuQVUVDRqCG5MUBN0oRt3bnwMX8c38EmMD+DGxBgX3qKocUc0mk5NkQk/ZWw1bozMgnBpWJ5zvv8yrbfM0QLHIzieiAH4FED7ACL9xS4APQlI7wxM7+4jOvm9pKejObng+1H9K9ErA/jeslDYOrAygH9oADs7PK3piCU1b1wzWEI3mKYZnmFazDZt5KwMypkcqtki6pbzuuTiFhz34HgIGIBIf5r8YtxHEz+I+PLmXb/YP0VOXwK/xW/0e9Rn2XUZzkcRgioBoqlA9QB69ESben+GALa231O67sV0YyRupJA00yMpy2a27aDg5FHJl7xaucKaca1V4LiEi5uuAfgEQPGf1vy0xqcNPXnCy0QcJvZgyn8n9RUBKAKQbQaGj/56kqVPBgqKVzZujBL7nzGAZrOtpczYuGmxhGUzw8myTK6IUmkSi5Uqa05Mt7c4TsFxAY4ruLjr4r8vfj/1hfBF2gu8F3W8OIwzmOJRqR5mDIoABpeJxHz9N++qBKCiHwIDaKy+JWx7LO5kPb1QhDM1g9mFGttYWfP2OY7BcQKOc3Bcd7Df7XT9/VpfHPWlgo8WeVD0UUkvS3tFAIPjyN+Inv5XGcCQGUC9/hwrlQ1tbn602FjH5u7eywHHIVwcgeOsi/v+jN9v6vn1O+AG6vEwUf/kWjDVFQGEpzwdPSoD6J9UfIX2wWWiYS8BPgCAPOYxoDrtqQAAAABJRU5ErkJggg==",e}(),nr=function(){function e(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indiceOfRefraction=e._DefaultIndiceOfRefraction,this.indiceOfRefraction=e._DefaultIndiceOfRefraction,this._texture=null,this.texture=null,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=o.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t,n,i){if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&Ki.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(n.getCaps().standardDerivatives&&this._bumpTexture&&Ki.a.ClearCoatBumpTextureEnabled&&!i&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Ki.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(t,n){this._isEnabled?(t.CLEARCOAT=!0,t._areTexturesDirty&&n.texturesEnabled&&(this._texture&&Ki.a.ClearCoatTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._bumpTexture&&Ki.a.ClearCoatBumpTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indiceOfRefraction===e._DefaultIndiceOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&Ki.a.ClearCoatTintTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1)},e.prototype.bindForSubMesh=function(e,t,n,i,r,o,a){if(!e.useUbo||!r||!e.isSync){this._texture&&Ki.a.ClearCoatTextureEnabled&&(e.updateFloat2("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level),Wi.a.BindTextureMatrix(this._texture,e,"clearCoat")),this._bumpTexture&&n.getCaps().standardDerivatives&&Ki.a.ClearCoatTextureEnabled&&!i&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),Wi.a.BindTextureMatrix(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,a?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,a?-1:1)),this._tintTexture&&Ki.a.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),Wi.a.BindTextureMatrix(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var s=1-this._indiceOfRefraction,l=1+this._indiceOfRefraction,c=Math.pow(-s/l,2);e.updateFloat4("vClearCoatRefractionParams",c,1/this._indiceOfRefraction,s,l),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&Ki.a.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._bumpTexture&&n.getCaps().standardDerivatives&&Ki.a.ClearCoatBumpTextureEnabled&&!i&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Ki.a.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))},e.prototype.hasTexture=function(e){return this._texture===e||this._bumpTexture===e||this._tintTexture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)},e.prototype.dispose=function(e){e&&(this._texture&&this._texture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._tintTexture&&this._tintTexture.dispose())},e.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},e.AddFallbacks=function(e,t,n){return e.CLEARCOAT_BUMP&&t.addFallback(n++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(n++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(n++,"CLEARCOAT"),n},e.AddUniforms=function(e){e.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},e.AddSamplers=function(e){e.push("clearCoatSampler","clearCoatBumpSampler","clearCoatTintSampler")},e.PrepareUniformBuffer=function(e){e.addUniform("vClearCoatParams",2),e.addUniform("vClearCoatRefractionParams",4),e.addUniform("vClearCoatInfos",2),e.addUniform("clearCoatMatrix",16),e.addUniform("vClearCoatBumpInfos",2),e.addUniform("vClearCoatTangentSpaceParams",2),e.addUniform("clearCoatBumpMatrix",16),e.addUniform("vClearCoatTintParams",4),e.addUniform("clearCoatColorAtDistance",1),e.addUniform("vClearCoatTintInfos",2),e.addUniform("clearCoatTintMatrix",16)},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},e._DefaultIndiceOfRefraction=1.5,c.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),c.c([Object(D.c)()],e.prototype,"intensity",void 0),c.c([Object(D.c)()],e.prototype,"roughness",void 0),c.c([Object(D.c)()],e.prototype,"_indiceOfRefraction",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indiceOfRefraction",void 0),c.c([Object(D.m)()],e.prototype,"_texture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),c.c([Object(D.m)()],e.prototype,"_bumpTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),c.c([Object(D.c)()],e.prototype,"_isTintEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTintEnabled",void 0),c.c([Object(D.e)()],e.prototype,"tintColor",void 0),c.c([Object(D.c)()],e.prototype,"tintColorAtDistance",void 0),c.c([Object(D.c)()],e.prototype,"tintThickness",void 0),c.c([Object(D.m)()],e.prototype,"_tintTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"tintTexture",void 0),e}(),ir=function(){function e(e){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new o.w(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){return!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&Ki.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(e,t,n){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!t.isVerticesDataPresent(Cn.b.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&n.texturesEnabled&&(this._texture&&Ki.a.AnisotropicTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1)},e.prototype.bindForSubMesh=function(e,t,n){e.useUbo&&n&&e.isSync||(this._texture&&Ki.a.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),Wi.a.BindTextureMatrix(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&Ki.a.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)},e.prototype.hasTexture=function(e){return this._texture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},e.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},e.AddFallbacks=function(e,t,n){return e.ANISOTROPIC&&t.addFallback(n++,"ANISOTROPIC"),n},e.AddUniforms=function(e){e.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},e.PrepareUniformBuffer=function(e){e.addUniform("vAnisotropy",3),e.addUniform("vAnisotropyInfos",2),e.addUniform("anisotropyMatrix",16)},e.AddSamplers=function(e){e.push("anisotropySampler")},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},c.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),c.c([Object(D.c)()],e.prototype,"intensity",void 0),c.c([Object(D.n)()],e.prototype,"direction",void 0),c.c([Object(D.m)()],e.prototype,"_texture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),rr=function(){function e(t){this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._internalMarkAllSubMeshesAsMiscDirty=t}return e.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},e.prototype.prepareDefines=function(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics},e.prototype.getClassName=function(){return"PBRBRDFConfiguration"},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},e.DEFAULT_USE_ENERGY_CONSERVATION=!0,e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,e.DEFAULT_USE_SPHERICAL_HARMONICS=!0,c.c([Object(D.c)()],e.prototype,"_useEnergyConservation",void 0),c.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useEnergyConservation",void 0),c.c([Object(D.c)()],e.prototype,"_useSmithVisibilityHeightCorrelated",void 0),c.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSmithVisibilityHeightCorrelated",void 0),c.c([Object(D.c)()],e.prototype,"_useSphericalHarmonics",void 0),c.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSphericalHarmonics",void 0),e}(),or=function(){function e(e){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=o.e.White(),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){return!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&Ki.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(e,t){this._isEnabled?(e.SHEEN=this._isEnabled,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&Ki.a.SheenTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._texture,e,"SHEEN_TEXTURE"):e.SHEEN_TEXTURE=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_LINKWITHALBEDO=!1)},e.prototype.bindForSubMesh=function(e,t,n){e.useUbo&&n&&e.isSync||(this._texture&&Ki.a.SheenTextureEnabled&&(e.updateFloat2("vSheenInfos",this._texture.coordinatesIndex,this._texture.level),Wi.a.BindTextureMatrix(this._texture,e,"sheen")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity)),t.texturesEnabled&&this._texture&&Ki.a.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture)},e.prototype.hasTexture=function(e){return this._texture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},e.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRSheenConfiguration"},e.AddFallbacks=function(e,t,n){return e.SHEEN&&t.addFallback(n++,"SHEEN"),n},e.AddUniforms=function(e){e.push("vSheenColor","vSheenInfos","sheenMatrix")},e.PrepareUniformBuffer=function(e){e.addUniform("vSheenColor",4),e.addUniform("vSheenInfos",2),e.addUniform("sheenMatrix",16)},e.AddSamplers=function(e){e.push("sheenSampler")},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},c.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),c.c([Object(D.c)()],e.prototype,"_linkSheenWithAlbedo",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),c.c([Object(D.c)()],e.prototype,"intensity",void 0),c.c([Object(D.e)()],e.prototype,"color",void 0),c.c([Object(D.m)()],e.prototype,"_texture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),ar=function(){function e(e){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.refractionIntensity=1,this.translucencyIntensity=1,this.scatteringIntensity=1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1,this.indexOfRefraction=1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=o.e.White(),this.tintColorAtDistance=1,this.diffusionDistance=o.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&Ki.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var n=this._getRefractionTexture(t);if(n&&Ki.a.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(e,t){if(e._areTexturesDirty&&(e.SUBSURFACE=!1,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_SCATERRING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_REFRACTION=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(e.SUBSURFACE=!0,e._areTexturesDirty&&t.texturesEnabled&&this._thicknessTexture&&Ki.a.ThicknessTextureEnabled&&Wi.a.PrepareDefinesForMergedUV(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),e.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture),this._isRefractionEnabled&&t.texturesEnabled)){var n=this._getRefractionTexture(t);n&&Ki.a.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=n.isCube,e.SS_GAMMAREFRACTION=n.gammaSpace,e.SS_RGBDREFRACTION=n.isRGBD,e.SS_REFRACTIONMAP_OPPOSITEZ=n.invertZ,e.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency)}},e.prototype.bindForSubMesh=function(e,t,n,i,r){var o=this._getRefractionTexture(t);if(!e.useUbo||!i||!e.isSync){if(this._thicknessTexture&&Ki.a.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),Wi.a.BindTextureMatrix(this._thicknessTexture,e,"thickness")),e.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),o&&Ki.a.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",o.getReflectionTextureMatrix());var a=1;o.isCube||o.depth&&(a=o.depth),e.updateFloat4("vRefractionInfos",o.level,1/this._indexOfRefraction,a,this._invertRefractionY?-1:1),e.updateFloat3("vRefractionMicrosurfaceInfos",o.getSize().width,o.lodGenerationScale,o.lodGenerationOffset)}e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,this.scatteringIntensity)}t.texturesEnabled&&(this._thicknessTexture&&Ki.a.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),o&&Ki.a.RefractionTextureEnabled&&(r?e.setTexture("refractionSampler",o):(e.setTexture("refractionSampler",o._lodTextureMid||o),e.setTexture("refractionSamplerLow",o._lodTextureLow||o),e.setTexture("refractionSamplerHigh",o._lodTextureHigh||o))))},e.prototype.unbind=function(e){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget||(e.setTexture("refractionSampler",null),0))},e.prototype._getRefractionTexture=function(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null},Object.defineProperty(e.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!0,configurable:!0}),e.prototype.fillRenderTargetTextures=function(e){Ki.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)},e.prototype.hasTexture=function(e){return this._thicknessTexture===e||this._refractionTexture===e},e.prototype.hasRenderTargetTextures=function(){return!!(Ki.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},e.prototype.getActiveTextures=function(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture)},e.prototype.getAnimatables=function(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture)},e.prototype.dispose=function(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},e.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},e.AddFallbacks=function(e,t,n){return e.SS_SCATERRING&&t.addFallback(n++,"SS_SCATERRING"),e.SS_TRANSLUCENCY&&t.addFallback(n++,"SS_TRANSLUCENCY"),n},e.AddUniforms=function(e){e.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix")},e.AddSamplers=function(e){e.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},e.PrepareUniformBuffer=function(e){e.addUniform("vRefractionMicrosurfaceInfos",3),e.addUniform("vRefractionInfos",4),e.addUniform("refractionMatrix",16),e.addUniform("vThicknessInfos",2),e.addUniform("thicknessMatrix",16),e.addUniform("vThicknessParam",2),e.addUniform("vDiffusionDistance",3),e.addUniform("vTintColor",4),e.addUniform("vSubSurfaceIntensity",3)},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},c.c([Object(D.c)()],e.prototype,"_isRefractionEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isRefractionEnabled",void 0),c.c([Object(D.c)()],e.prototype,"_isTranslucencyEnabled",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTranslucencyEnabled",void 0),c.c([Object(D.c)()],e.prototype,"_isScatteringEnabled",void 0),c.c([Object(D.c)()],e.prototype,"refractionIntensity",void 0),c.c([Object(D.c)()],e.prototype,"translucencyIntensity",void 0),c.c([Object(D.c)()],e.prototype,"scatteringIntensity",void 0),c.c([Object(D.m)()],e.prototype,"_thicknessTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertRefractionY",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkRefractionWithTransparency",void 0),c.c([Object(D.c)()],e.prototype,"minimumThickness",void 0),c.c([Object(D.c)()],e.prototype,"maximumThickness",void 0),c.c([Object(D.e)()],e.prototype,"tintColor",void 0),c.c([Object(D.c)()],e.prototype,"tintColorAtDistance",void 0),c.c([Object(D.e)()],e.prototype,"diffusionDistance",void 0),c.c([Object(D.c)()],e.prototype,"_useMaskFromThicknessTexture",void 0),c.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useMaskFromThicknessTexture",void 0),e}();zt.a.IncludesShadersStore.pbrFragmentDeclaration="uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif",zt.a.IncludesShadersStore.pbrUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\nuniform vec3 vAnisotropy;\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\nuniform vec4 vSheenColor;\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",zt.a.IncludesShadersStore.pbrFragmentExtraDeclaration="uniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif",zt.a.IncludesShadersStore.pbrFragmentSamplersDeclaration="#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\n#if CLEARCOAT_TEXTUREDIRECTUV == 1\n#define vClearCoatUV vMainUV1\n#elif CLEARCOAT_TEXTUREDIRECTUV == 2\n#define vClearCoatUV vMainUV2\n#else\nvarying vec2 vClearCoatUV;\n#endif\nuniform sampler2D clearCoatSampler;\n#endif\n#ifdef CLEARCOAT_BUMP\n#if CLEARCOAT_BUMPDIRECTUV == 1\n#define vClearCoatBumpUV vMainUV1\n#elif CLEARCOAT_BUMPDIRECTUV == 2\n#define vClearCoatBumpUV vMainUV2\n#else\nvarying vec2 vClearCoatBumpUV;\n#endif\nuniform sampler2D clearCoatBumpSampler;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\n#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1\n#define vClearCoatTintUV vMainUV1\n#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2\n#define vClearCoatTintUV vMainUV2\n#else\nvarying vec2 vClearCoatTintUV;\n#endif\nuniform sampler2D clearCoatTintSampler;\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\n#if SHEEN_TEXTUREDIRECTUV == 1\n#define vSheenUV vMainUV1\n#elif SHEEN_TEXTUREDIRECTUV == 2\n#define vSheenUV vMainUV2\n#else\nvarying vec2 vSheenUV;\n#endif\nuniform sampler2D sheenSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\n#if ANISOTROPIC_TEXTUREDIRECTUV == 1\n#define vAnisotropyUV vMainUV1\n#elif ANISOTROPIC_TEXTUREDIRECTUV == 2\n#define vAnisotropyUV vMainUV2\n#else\nvarying vec2 vAnisotropyUV;\n#endif\nuniform sampler2D anisotropySampler;\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1\n#define vThicknessUV vMainUV1\n#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2\n#define vThicknessUV vMainUV2\n#else\nvarying vec2 vThicknessUV;\n#endif\nuniform sampler2D thicknessSampler;\n#endif\n#endif",n(88),zt.a.IncludesShadersStore.pbrHelperFunctions="\n#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\n\n\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n\n\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\n\n\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\n\n\n\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\n\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\n\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n\n\n\n\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif",zt.a.IncludesShadersStore.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n\n\n\n\n\n\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+vSphericalL1_1*(normal.y)\n+vSphericalL10*(normal.z)\n+vSphericalL11*(normal.x)\n+vSphericalL2_2*(normal.y*normal.x)\n+vSphericalL2_1*(normal.y*normal.z)\n+vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+vSphericalL21*(normal.z*normal.x)\n+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif\n#endif",zt.a.IncludesShadersStore.pbrDirectLightingSetupFunctions="\nstruct preLightingInfo\n{\n\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\n\nfloat attenuation;\n\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\n\nresult.lightDistance=sqrt(result.lightDistanceSquared);\n\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightDistance=length(-lightData.xyz);\n\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\n\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}",zt.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977;\n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",zt.a.IncludesShadersStore.pbrBRDFFunctions="\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\n\n\n\n#ifdef MS_BRDF_ENERGY_CONSERVATION\n\n\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness,sampler2D brdfSampler) {\n\nvec2 UV=vec2(NdotV,perceptualRoughness);\n\nvec4 brdfLookup=texture2D(brdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(REFLECTION)\n\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\n\n\n\n\n\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn t*t;\n#endif\n}\n#endif\n\n\n\n\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\n\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n\n\n\n\n#ifdef BRDF_V_HEIGHT_CORRELATED\n\n\n\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\n\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\n\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\n\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\n\n\n\nreturn 0.25/(VdotH*VdotH);\n}\n#endif\n#ifdef SHEEN\n\n\n\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n#endif\n\n\n\n\n\n\n\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\n\n\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\n\n\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\n\n\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n",zt.a.IncludesShadersStore.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\n\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\n\n\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\n\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\n\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\n\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat visibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat visibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*visibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat visibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*visibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat visibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*visibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n\nvec3 fresnel=reflectance0;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\nvec3 sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n",zt.a.IncludesShadersStore.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,normal));\nreturn square(temp);\n}\n#endif\n\n\n\n\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif",n(121),n(122),n(123),n(115),zt.a.IncludesShadersStore.pbrDebug="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w<vDebugMode.x) {\nreturn;\n}\n\n#if DEBUGMODE == 1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 3 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 4 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 5\n\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE == 7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 10 && defined(CLEARCOAT)\n\ngl_FragColor.rgb=clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n\n#elif DEBUGMODE == 20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE == 21 && defined(AMBIENT)\ngl_FragColor.rgb=ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE == 22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE == 23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearCoatMapData.rg,0.0);\n#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearCoatTintMapData.rgb;\n#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenMapData.rgb;\n#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropyMapData.rgb;\n#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=thicknessMap.rgb;\n\n#elif DEBUGMODE == 40 && defined(SS_REFRACTION)\n\ngl_FragColor.rgb=environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 41 && defined(REFLECTION)\ngl_FragColor.rgb=environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=environmentClearCoatRadiance;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 54 && defined(REFLECTION)\ngl_FragColor.rgb=environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 61\ngl_FragColor.rgb=specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 62\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE == 63\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE == 64\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE == 65 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 66 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatRoughness);\n#elif DEBUGMODE == 67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatNdotV);\n#elif DEBUGMODE == 68 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=transmittance;\n#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=refractionTransmittance;\n\n#elif DEBUGMODE == 70 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE == 71 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE == 72 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE == 73 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 74 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 75 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 76 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE == 77\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#endif",zt.a.ShadersStore.pbrPixelShader="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n\n#include<helperFunctions>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#ifdef CLEARCOAT\n\nvec3 clearCoatNormalW=normalW;\n#endif\n#include<bumpFragment>\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n#ifdef REFLECTANCE\n\n\n\n\n\nsurfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\n\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\n\nmicroSurface=saturate(microSurface);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\n\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\n\nalphaG+=AARoughnessFactors.y;\n#endif\n#ifdef ANISOTROPIC\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\nvec3 anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n#endif\n\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef SS_REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\n#ifdef SHEEN\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset)*vSheenInfos.y;\nsheenIntensity*=sheenMapData.a;\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\n\nsurfaceAlbedo.rgb*=sheenFactor;\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#endif\nfloat sheenRoughness=roughness;\n\nsheenIntensity*=(1.-reflectance);\n\nsheenColor*=sheenIntensity;\n#endif\n\n#if defined(REFLECTION)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\n\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\n\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG,NdotVUnclamped);\n#else\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nsheenReflectionLOD=sheenReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nenvironmentSheenRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,sheenReflectionLOD);\n#else\nfloat lodSheenReflectionNormalized=saturate(sheenReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodSheenReflectionNormalizedDoubled=lodSheenReflectionNormalized*2.0;\nvec4 environmentSheenMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodSheenReflectionNormalizedDoubled<1.0){\nenvironmentSheenRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSheenMid,\nlodSheenReflectionNormalizedDoubled\n);\n}else{\nenvironmentSheenRadiance=mix(\nenvironmentSheenMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodSheenReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentSheenRadiance.rgb=fromRGBD(environmentSheenRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentSheenRadiance.rgb=toLinearSpace(environmentSheenRadiance.rgb);\n#endif\n\nenvironmentSheenRadiance.rgb*=vReflectionInfos.x;\nenvironmentSheenRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#ifdef CLEARCOAT\n\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\nclearCoatIntensity*=clearCoatMapData.x;\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\nclearCoatThickness*=clearCoatTintMapData.a;\n#endif\nclearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\n#endif\n\n\n\n\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\nspecularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz*2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBN,vClearCoatBumpUV+uvOffset,clearCoatBumpSampler,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;\n#endif\n\nvec2 clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\n\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\n\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\n\nclearCoatAlphaG+=clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG,clearCoatNdotVUnclamped);\n#else\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nclearCoatReflectionLOD=clearCoatReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nfloat requestedClearCoatReflectionLOD=clearCoatReflectionLOD;\nenvironmentClearCoatRadiance=sampleReflectionLod(reflectionSampler,clearCoatReflectionCoords,requestedClearCoatReflectionLOD);\n#else\nfloat lodClearCoatReflectionNormalized=saturate(clearCoatReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodClearCoatReflectionNormalizedDoubled=lodClearCoatReflectionNormalized*2.0;\nvec4 environmentClearCoatMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodClearCoatReflectionNormalizedDoubled<1.0){\nenvironmentClearCoatRadiance=mix(\nsampleReflection(reflectionSamplerHigh,clearCoatReflectionCoords),\nenvironmentClearCoatMid,\nlodClearCoatReflectionNormalizedDoubled\n);\n}else{\nenvironmentClearCoatRadiance=mix(\nenvironmentClearCoatMid,\nsampleReflection(reflectionSamplerLow,clearCoatReflectionCoords),\nlodClearCoatReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentClearCoatRadiance.rgb=fromRGBD(environmentClearCoatRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentClearCoatRadiance.rgb=toLinearSpace(environmentClearCoatRadiance.rgb);\n#endif\n#ifdef CLEARCOAT_TINT\n\nvec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);\n\nfloat clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\nvec3 absorption=vec3(0.);\n#endif\n\nenvironmentClearCoatRadiance.rgb*=vReflectionInfos.x;\nenvironmentClearCoatRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#if defined(ENVIRONMENTBRDF)\n\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness,environmentBrdfSampler);\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\n\nalpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_SCATTERING\nfloat scatteringIntensity=vSubSurfaceIntensity.z;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#ifdef SS_REFRACTION\nrefractionIntensity*=thicknessMap.g;\n#endif\n#ifdef SS_TRANSLUCENCY\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#ifdef SS_SCATTERING\nscatteringIntensity*=thicknessMap.a;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\n#endif\n#endif\n\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\n\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(specularEnvironmentR0,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#if defined(SHEEN) && defined(REFLECTION)\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nsheenEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nsheenEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#endif\n\n#ifdef CLEARCOAT\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness,environmentBrdfSampler);\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\n\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatAbsorption(clearCoatNdotVRefract,clearCoatNdotVRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#ifdef REFLECTION\nenvironmentIrradiance*=absorption;\n#endif\n#ifdef SHEEN\nsheenEnvironmentReflectance*=absorption;\n#endif\nspecularEnvironmentReflectance*=absorption;\n#endif\n\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\nfloat conservationFactor=(1.-fresnelIBLClearCoat);\n#ifdef REFLECTION\nenvironmentIrradiance*=conservationFactor;\n#endif\n#ifdef SHEEN\nsheenEnvironmentReflectance*=(conservationFactor*conservationFactor);\n#endif\nspecularEnvironmentReflectance*=(conservationFactor*conservationFactor);\n#endif\n\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\n\n\n\n\n\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\n\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\n\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\n\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n\nsurfaceAlbedo*=(1.-refractionIntensity);\n\nenvironmentIrradiance*=(1.-refractionIntensity);\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n\nrefractionTransmittance*=1.0-specularEnvironmentReflectance;\n#endif\n\n#if defined(REFLECTION) && defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)\n#if defined(USESPHERICALINVERTEX)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#endif\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\nrefractionIrradiance*=transmittance;\n#endif\n\n\n\n#ifndef METALLICWORKFLOW\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)\nfinalIrradiance+=refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef SS_REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractionTransmittance;\n#endif\n\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\n\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=energyConservationFactor;\n#endif\n\n#ifdef REFLECTION\nvec3 finalClearCoatRadiance=environmentClearCoatRadiance.rgb;\nfinalClearCoatRadiance*=clearCoatEnvironmentReflectance;\n\nvec3 finalClearCoatRadianceScaled=finalClearCoatRadiance*vLightingIntensity.z;\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*=(conservationFactor*conservationFactor);\n#ifdef CLEARCOAT_TINT\nfinalRefraction*=absorption;\n#endif\n#endif\n#endif\n\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n\n\n\n\n\n#ifdef REFLECTION\nvec3 finalSheenRadiance=environmentSheenRadiance.rgb;\nfinalSheenRadiance*=sheenEnvironmentReflectance;\n\nvec3 finalSheenRadianceScaled=finalSheenRadiance*vLightingIntensity.z;\n#endif\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n#endif\n\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalAmbient*ambientOcclusionColor +\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef CLEARCOAT\n\n\nfinalClearCoatScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#ifdef CLEARCOAT\n\n\nfinalClearCoatRadianceScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=finalColor;\n#include<pbrDebug>\n}\n",zt.a.IncludesShadersStore.pbrVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;;\n#endif\n#endif\n",n(124),n(101),n(102),n(103),n(125),n(118),zt.a.ShadersStore.pbrVertexShader="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatUV;\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nvarying vec2 vClearCoatBumpUV;\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatTintUV;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nvarying vec2 vSheenUV;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nvarying vec2 vAnisotropyUV;\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nvarying vec2 vThicknessUV;\n#endif\n#endif\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nif (vClearCoatInfos.x == 0.)\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nif (vClearCoatBumpInfos.x == 0.)\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nif (vClearCoatTintInfos.x == 0.)\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nif (vSheenInfos.x == 0.)\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nif (vAnisotropyInfos.x == 0.)\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nif (vThicknessInfos.x == 0.)\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";var sr=function(e){function t(){var t=e.call(this)||this;return t.PBR=!0,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.ALBEDO=!1,t.ALBEDODIRECTUV=0,t.VERTEXCOLOR=!1,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.AMBIENTINGRAYSCALE=!1,t.OPACITY=!1,t.VERTEXALPHA=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHABLEND=!1,t.ALPHAFROMALBEDO=!1,t.ALPHATESTVALUE="0.5",t.SPECULAROVERALPHA=!1,t.RADIANCEOVERALPHA=!1,t.ALPHAFRESNEL=!1,t.LINEARALPHAFRESNEL=!1,t.PREMULTIPLYALPHA=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITY=!1,t.REFLECTIVITYDIRECTUV=0,t.SPECULARTERM=!1,t.MICROSURFACEFROMREFLECTIVITYMAP=!1,t.MICROSURFACEAUTOMATIC=!1,t.LODBASEDMICROSFURACE=!1,t.MICROSURFACEMAP=!1,t.MICROSURFACEMAPDIRECTUV=0,t.METALLICWORKFLOW=!1,t.ROUGHNESSSTOREINMETALMAPALPHA=!1,t.ROUGHNESSSTOREINMETALMAPGREEN=!1,t.METALLNESSSTOREINMETALMAPBLUE=!1,t.AOSTOREINMETALMAPRED=!1,t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1,t.NORMAL=!1,t.TANGENT=!1,t.BUMP=!1,t.BUMPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.NORMALXYSCALE=!0,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.USELIGHTMAPASSHADOWMAP=!1,t.GAMMALIGHTMAP=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.SPHERICAL_HARMONICS=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.RADIANCEOCCLUSION=!1,t.HORIZONOCCLUSION=!1,t.INSTANCES=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.NONUNIFORMSCALING=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.MULTIVIEW=!1,t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.LOGARITHMICDEPTH=!1,t.FORCENORMALFORWARD=!1,t.SPECULARAA=!1,t.CLEARCOAT=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1,t.ANISOTROPIC_TEXTUREDIRECTUV=0,t.BRDF_V_HEIGHT_CORRELATED=!1,t.MS_BRDF_ENERGY_CONSERVATION=!1,t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTUREDIRECTUV=0,t.SHEEN_LINKWITHALBEDO=!1,t.SUBSURFACE=!1,t.SS_REFRACTION=!1,t.SS_TRANSLUCENCY=!1,t.SS_SCATERRING=!1,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,t.SS_REFRACTIONMAP_3D=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.UNLIT=!1,t.DEBUGMODE=0,t.rebuild(),t}return c.d(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(Xi.a),lr=function(e){function t(n,i){var r=e.call(this,n,i)||this;return r._directIntensity=1,r._emissiveIntensity=1,r._environmentIntensity=1,r._specularIntensity=1,r._lightingInfos=new o.y(r._directIntensity,r._emissiveIntensity,r._environmentIntensity,r._specularIntensity),r._disableBumpMap=!1,r._albedoTexture=null,r._ambientTexture=null,r._ambientTextureStrength=1,r._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r._opacityTexture=null,r._reflectionTexture=null,r._emissiveTexture=null,r._reflectivityTexture=null,r._metallicTexture=null,r._metallic=null,r._roughness=null,r._microSurfaceTexture=null,r._bumpTexture=null,r._lightmapTexture=null,r._ambientColor=new o.e(0,0,0),r._albedoColor=new o.e(1,1,1),r._reflectivityColor=new o.e(1,1,1),r._reflectionColor=new o.e(1,1,1),r._emissiveColor=new o.e(0,0,0),r._microSurface=.9,r._useLightmapAsShadowmap=!1,r._useHorizonOcclusion=!0,r._useRadianceOcclusion=!0,r._useAlphaFromAlbedoTexture=!1,r._useSpecularOverAlpha=!0,r._useMicroSurfaceFromReflectivityMapAlpha=!1,r._useRoughnessFromMetallicTextureAlpha=!0,r._useRoughnessFromMetallicTextureGreen=!1,r._useMetallnessFromMetallicTextureBlue=!1,r._useAmbientOcclusionFromMetallicTextureRed=!1,r._useAmbientInGrayScale=!1,r._useAutoMicroSurfaceFromReflectivityMap=!1,r._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,r._useRadianceOverAlpha=!0,r._useObjectSpaceNormalMap=!1,r._useParallax=!1,r._useParallaxOcclusion=!1,r._parallaxScaleBias=.05,r._disableLighting=!1,r._maxSimultaneousLights=4,r._invertNormalMapX=!1,r._invertNormalMapY=!1,r._twoSidedLighting=!1,r._alphaCutOff=.4,r._forceAlphaTest=!1,r._useAlphaFresnel=!1,r._useLinearAlphaFresnel=!1,r._transparencyMode=null,r._environmentBRDFTexture=null,r._forceIrradianceInFragment=!1,r._forceNormalForward=!1,r._enableSpecularAntiAliasing=!1,r._imageProcessingObserver=null,r._renderTargets=new Gt.a(16),r._globalAmbientColor=new o.e(0,0,0),r._useLogarithmicDepth=!1,r._unlit=!1,r._debugMode=0,r.debugMode=0,r.debugLimit=-1,r.debugFactor=1,r.clearCoat=new nr(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.anisotropy=new ir(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.brdf=new rr(r._markAllSubMeshesAsMiscDirty.bind(r)),r.sheen=new or(r._markAllSubMeshesAsTexturesDirty.bind(r)),r.subSurface=new ar(r._markAllSubMeshesAsTexturesDirty.bind(r)),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),Ki.a.ReflectionTextureEnabled&&r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r.subSurface.fillRenderTargetTextures(r._renderTargets),r._renderTargets},r._environmentBRDFTexture=tr.GetEnvironmentBRDFTexture(i),r}return c.d(t,e),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(Ki.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===t.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaBlendingForMesh=function(t){return!(this._disableAlphaBlending&&t.visibility>=1)&&e.prototype.needAlphaBlendingForMesh.call(this,t)},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,t,n){if(t.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new sr);var i=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&i._renderId===this.getScene().getRenderId())return!0;var r=this.getScene(),o=r.getEngine();if(i._areTexturesDirty&&r.texturesEnabled){if(this._albedoTexture&&Ki.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Ki.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Ki.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var a=this._getReflectionTexture();if(a&&Ki.a.ReflectionTextureEnabled&&!a.isReadyOrNotBlocking())return!1;if(this._lightmapTexture&&Ki.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Ki.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Ki.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(o.getCaps().standardDerivatives&&this._bumpTexture&&Ki.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Ki.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(i,r)&&this.clearCoat.isReadyForSubMesh(i,r,o,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(i,r)&&this.anisotropy.isReadyForSubMesh(i,r)))return!1;if(i._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;o.getCaps().standardDerivatives||e.isVerticesDataPresent(Cn.b.NormalKind)||(e.createNormals(!0),p.a.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var s=t.effect,l=this._prepareEffect(e,i,this.onCompiled,this.onError,n);return l&&(this.allowShaderHotSwapping&&s&&!l.isReady()?(l=s,i.markAsUnprocessed()):(r.resetCachedMaterial(),t.setEffect(l,i),this.buildUniformLayout())),!(!t.effect||!t.effect.isReady()||(i._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,0))},t.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,t,n,i,r,o){if(void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===o&&(o=null),this._prepareDefines(e,t,r,o),!t.isDirty)return null;t.markAsProcessed();var a=this.getScene().getEngine(),s=new zt.c,l=0;t.USESPHERICALINVERTEX&&s.addFallback(l++,"USESPHERICALINVERTEX"),t.FOG&&s.addFallback(l,"FOG"),t.SPECULARAA&&s.addFallback(l,"SPECULARAA"),t.POINTSIZE&&s.addFallback(l,"POINTSIZE"),t.LOGARITHMICDEPTH&&s.addFallback(l,"LOGARITHMICDEPTH"),t.PARALLAX&&s.addFallback(l,"PARALLAX"),t.PARALLAXOCCLUSION&&s.addFallback(l++,"PARALLAXOCCLUSION"),l=ir.AddFallbacks(t,s,l),l=ir.AddFallbacks(t,s,l),l=ar.AddFallbacks(t,s,l),l=or.AddFallbacks(t,s,l),t.ENVIRONMENTBRDF&&s.addFallback(l++,"ENVIRONMENTBRDF"),t.TANGENT&&s.addFallback(l++,"TANGENT"),t.BUMP&&s.addFallback(l++,"BUMP"),l=Wi.a.HandleFallbacksForShadows(t,s,this._maxSimultaneousLights,l++),t.SPECULARTERM&&s.addFallback(l++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&s.addFallback(l++,"USESPHERICALFROMREFLECTIONMAP"),t.LIGHTMAP&&s.addFallback(l++,"LIGHTMAP"),t.NORMAL&&s.addFallback(l++,"NORMAL"),t.AMBIENT&&s.addFallback(l++,"AMBIENT"),t.EMISSIVE&&s.addFallback(l++,"EMISSIVE"),t.VERTEXCOLOR&&s.addFallback(l++,"VERTEXCOLOR"),t.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(l++,e),t.MORPHTARGETS&&s.addFallback(l++,"MORPHTARGETS"),t.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");var c=[Cn.b.PositionKind];t.NORMAL&&c.push(Cn.b.NormalKind),t.TANGENT&&c.push(Cn.b.TangentKind),t.UV1&&c.push(Cn.b.UVKind),t.UV2&&c.push(Cn.b.UV2Kind),t.VERTEXCOLOR&&c.push(Cn.b.ColorKind),Wi.a.PrepareAttributesForBones(c,e,t,s),Wi.a.PrepareAttributesForInstances(c,t),Wi.a.PrepareAttributesForMorphTargets(c,e,t);var u="pbr",h=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler","boneSampler"],f=["Material","Scene"];ar.AddUniforms(h),ar.AddSamplers(d),nr.AddUniforms(h),nr.AddSamplers(d),ir.AddUniforms(h),ir.AddSamplers(d),or.AddUniforms(h),or.AddSamplers(d),vn.a&&(vn.a.PrepareUniforms(h,t),vn.a.PrepareSamplers(d,t)),Wi.a.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:f,samplers:d,defines:t,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,h,f,d,t));var p=t.toString();return a.createEffect(u,{attributes:c,uniformsNames:h,uniformBuffersNames:f,samplers:d,defines:p,fallbacks:s,onCompiled:n,onError:i,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS}},a)},t.prototype._prepareDefines=function(e,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var o=this.getScene(),a=o.getEngine();if(Wi.a.PrepareDefinesForLights(o,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,Wi.a.PrepareDefinesForMultiview(o,n),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,o.texturesEnabled){o.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Ki.a.DiffuseTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"):n.ALBEDO=!1,this._ambientTexture&&Ki.a.AmbientTextureEnabled?(Wi.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&Ki.a.OpacityTextureEnabled?(Wi.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var s=this._getReflectionTexture();if(s&&Ki.a.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=s.gammaSpace,n.RGBDREFLECTION=s.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,n.LODINREFLECTIONALPHA=s.lodLevelInAlpha,s.coordinatesMode===Ge.a.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=s.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,s.coordinatesMode){case Ge.a.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case Ge.a.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case Ge.a.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case Ge.a.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case Ge.a.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case Ge.a.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ge.a.CUBIC_MODE:case Ge.a.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!s.boundingBoxSize}s.coordinatesMode!==Ge.a.SKYBOX_MODE?s.sphericalPolynomial&&(n.USESPHERICALFROMREFLECTIONMAP=!0,n.USESPHERICALINVERTEX=!(this._forceIrradianceInFragment||o.getEngine().getCaps().maxVaryingVectors<=8)):n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!s.getReflectionTextureMatrix().isIdentity()}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1;this._lightmapTexture&&Ki.a.LightmapTextureEnabled?(Wi.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):n.LIGHTMAP=!1,this._emissiveTexture&&Ki.a.EmissiveTextureEnabled?Wi.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,Ki.a.SpecularTextureEnabled?(this._metallicTexture?(Wi.a.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(Wi.a.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._microSurfaceTexture?Wi.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Ki.a.BumpTextureEnabled&&!this._disableBumpMap?(Wi.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&Ki.a.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&Ki.a.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),n.ALPHAFROMALBEDO=!!this._shouldUseAlphaFromAlbedoTexture()}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,n.TWOSIDEDLIGHTING=!(this.backFaceCulling||!this._twoSidedLighting),n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===g.a.ALPHA_PREMULTIPLIED||this.alphaMode===g.a.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,n.SPECULARAA=o.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(Wi.a.PrepareDefinesForMisc(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(Cn.b.NormalKind),n.DEBUGMODE=this._debugMode),this.subSurface.prepareDefines(n,o),this.clearCoat.prepareDefines(n,o),this.anisotropy.prepareDefines(n,e,o),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,o),Wi.a.PrepareDefinesForFrameBoundValues(o,a,n,!!i,r),Wi.a.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(e,t,n){var i=this,r=c.a({clipPlane:!1},n),o=new sr,a=this._prepareEffect(e,o,void 0,void 0,void 0,r.clipPlane);a.isReady()?t&&t(this):a.onCompileObservable.add(function(){t&&t(i)})},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),nr.PrepareUniformBuffer(e),ir.PrepareUniformBuffer(e),or.PrepareUniformBuffer(e),ar.PrepareUniformBuffer(e),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this.subSurface.unbind(this._activeEffect)&&(t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,i){var r=this.getScene(),a=i._materialDefines;if(a){var s=i.effect;if(s){this._activeEffect=s,a.INSTANCES||this.bindOnlyWorldMatrix(e),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(r,s,n.visibility);Wi.a.BindBonesParameters(n,this._activeEffect);var c=null,u=this._uniformBuffer;if(l){var h=r.getEngine();if(u.bindToEffect(s,"Material"),this.bindViewProjection(s),c=this._getReflectionTexture(),!u.useUbo||!this.isFrozen||!u.isSync){if(r.texturesEnabled){if(this._albedoTexture&&Ki.a.DiffuseTextureEnabled&&(u.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),Wi.a.BindTextureMatrix(this._albedoTexture,u,"albedo")),this._ambientTexture&&Ki.a.AmbientTextureEnabled&&(u.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),Wi.a.BindTextureMatrix(this._ambientTexture,u,"ambient")),this._opacityTexture&&Ki.a.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Wi.a.BindTextureMatrix(this._opacityTexture,u,"opacity")),c&&Ki.a.ReflectionTextureEnabled){if(u.updateMatrix("reflectionMatrix",c.getReflectionTextureMatrix()),u.updateFloat2("vReflectionInfos",c.level,0),c.boundingBoxSize){var d=c;u.updateVector3("vReflectionPosition",d.boundingBoxPosition),u.updateVector3("vReflectionSize",d.boundingBoxSize)}var f=c.sphericalPolynomial;if(a.USESPHERICALFROMREFLECTIONMAP&&f)if(a.SPHERICAL_HARMONICS){var p=f.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",p.l00),this._activeEffect.setVector3("vSphericalL1_1",p.l1_1),this._activeEffect.setVector3("vSphericalL10",p.l10),this._activeEffect.setVector3("vSphericalL11",p.l11),this._activeEffect.setVector3("vSphericalL2_2",p.l2_2),this._activeEffect.setVector3("vSphericalL2_1",p.l2_1),this._activeEffect.setVector3("vSphericalL20",p.l20),this._activeEffect.setVector3("vSphericalL21",p.l21),this._activeEffect.setVector3("vSphericalL22",p.l22)}else this._activeEffect.setFloat3("vSphericalX",f.x.x,f.x.y,f.x.z),this._activeEffect.setFloat3("vSphericalY",f.y.x,f.y.y,f.y.z),this._activeEffect.setFloat3("vSphericalZ",f.z.x,f.z.y,f.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",f.xx.x-f.zz.x,f.xx.y-f.zz.y,f.xx.z-f.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",f.yy.x-f.zz.x,f.yy.y-f.zz.y,f.yy.z-f.zz.z),this._activeEffect.setFloat3("vSphericalZZ",f.zz.x,f.zz.y,f.zz.z),this._activeEffect.setFloat3("vSphericalXY",f.xy.x,f.xy.y,f.xy.z),this._activeEffect.setFloat3("vSphericalYZ",f.yz.x,f.yz.y,f.yz.z),this._activeEffect.setFloat3("vSphericalZX",f.zx.x,f.zx.y,f.zx.z);u.updateFloat3("vReflectionMicrosurfaceInfos",c.getSize().width,c.lodGenerationScale,c.lodGenerationOffset)}this._emissiveTexture&&Ki.a.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Wi.a.BindTextureMatrix(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&Ki.a.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Wi.a.BindTextureMatrix(this._lightmapTexture,u,"lightmap")),Ki.a.SpecularTextureEnabled&&(this._metallicTexture?(u.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),Wi.a.BindTextureMatrix(this._metallicTexture,u,"reflectivity")):this._reflectivityTexture&&(u.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),Wi.a.BindTextureMatrix(this._reflectivityTexture,u,"reflectivity")),this._microSurfaceTexture&&(u.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),Wi.a.BindTextureMatrix(this._microSurfaceTexture,u,"microSurfaceSampler"))),this._bumpTexture&&h.getCaps().standardDerivatives&&Ki.a.BumpTextureEnabled&&!this._disableBumpMap&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),Wi.a.BindTextureMatrix(this._bumpTexture,u,"bump"),r._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),a.METALLICWORKFLOW?(o.t.Color3[0].r=null==this._metallic?1:this._metallic,o.t.Color3[0].g=null==this._roughness?1:this._roughness,u.updateColor4("vReflectivityColor",o.t.Color3[0],0)):u.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),u.updateColor3("vEmissiveColor",Ki.a.EmissiveTextureEnabled?this._emissiveColor:o.e.BlackReadOnly),u.updateColor3("vReflectionColor",this._reflectionColor),u.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),u.updateFloat("visibility",n.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,u.updateVector4("vLightingIntensity",this._lightingInfos)}r.texturesEnabled&&(this._albedoTexture&&Ki.a.DiffuseTextureEnabled&&u.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Ki.a.AmbientTextureEnabled&&u.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Ki.a.OpacityTextureEnabled&&u.setTexture("opacitySampler",this._opacityTexture),c&&Ki.a.ReflectionTextureEnabled&&(a.LODBASEDMICROSFURACE?u.setTexture("reflectionSampler",c):(u.setTexture("reflectionSampler",c._lodTextureMid||c),u.setTexture("reflectionSamplerLow",c._lodTextureLow||c),u.setTexture("reflectionSamplerHigh",c._lodTextureHigh||c))),a.ENVIRONMENTBRDF&&u.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Ki.a.EmissiveTextureEnabled&&u.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Ki.a.LightmapTextureEnabled&&u.setTexture("lightmapSampler",this._lightmapTexture),Ki.a.SpecularTextureEnabled&&(this._metallicTexture?u.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&u.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&u.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&h.getCaps().standardDerivatives&&Ki.a.BumpTextureEnabled&&!this._disableBumpMap&&u.setTexture("bumpSampler",this._bumpTexture)),this.subSurface.bindForSubMesh(u,r,h,this.isFrozen,a.LODBASEDMICROSFURACE),this.clearCoat.bindForSubMesh(u,r,h,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY),this.anisotropy.bindForSubMesh(u,r,this.isFrozen),this.sheen.bindForSubMesh(u,r,this.isFrozen),Wi.a.BindClipPlane(this._activeEffect,r),r.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var g=r._forcedViewPosition?r._forcedViewPosition:r._mirroredCameraPosition?r._mirroredCameraPosition:r.activeCamera.globalPosition;s.setFloat4("vEyePosition",g.x,g.y,g.z,r.useRightHandedSystem===(null!=r._mirroredCameraPosition)?-1:1),s.setColor3("vAmbientColor",this._globalAmbientColor),s.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!l&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&Wi.a.BindLights(r,n,this._activeEffect,a,this._maxSimultaneousLights,this._lightFalloff!==t.LIGHTFALLOFF_STANDARD),(r.fogEnabled&&n.applyFog&&r.fogMode!==W.a.FOGMODE_NONE||c)&&this.bindView(s),Wi.a.BindFogParameters(r,n,this._activeEffect,!0),a.NUM_MORPH_INFLUENCERS&&Wi.a.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),Wi.a.BindLogDepth(a,this._activeEffect,r)),u.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._albedoTexture&&t.push(this._albedoTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._reflectivityTexture&&t.push(this._reflectivityTexture),this._metallicTexture&&t.push(this._metallicTexture),this._microSurfaceTexture&&t.push(this._microSurfaceTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this.subSurface.getActiveTextures(t),this.clearCoat.getActiveTextures(t),this.sheen.getActiveTextures(t),this.anisotropy.getActiveTextures(t),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._albedoTexture===t||this._ambientTexture===t||this._opacityTexture===t||this._reflectionTexture===t||this._reflectivityTexture===t||this._metallicTexture===t||this._microSurfaceTexture===t||this._bumpTexture===t||this._lightmapTexture===t||this.subSurface.hasTexture(t)||this.clearCoat.hasTexture(t)||this.sheen.hasTexture(t)||this.anisotropy.hasTexture(t)},t.prototype.dispose=function(t,n){n&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose()),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,n)},t.PBRMATERIAL_OPAQUE=0,t.PBRMATERIAL_ALPHATEST=1,t.PBRMATERIAL_ALPHABLEND=2,t.PBRMATERIAL_ALPHATESTANDBLEND=3,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,c.c([Object(D.i)()],t.prototype,"_imageProcessingConfiguration",void 0),c.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),c.c([Object(D.c)()],t.prototype,"useLogarithmicDepth",null),c.c([Object(D.c)()],t.prototype,"transparencyMode",null),t}(Yi.a),cr=function(e){function t(n,i){var r=e.call(this,n,i)||this;return r.directIntensity=1,r.emissiveIntensity=1,r.environmentIntensity=1,r.specularIntensity=1,r.disableBumpMap=!1,r.ambientTextureStrength=1,r.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,r.ambientColor=new o.e(0,0,0),r.albedoColor=new o.e(1,1,1),r.reflectivityColor=new o.e(1,1,1),r.reflectionColor=new o.e(1,1,1),r.emissiveColor=new o.e(0,0,0),r.microSurface=1,r.useLightmapAsShadowmap=!1,r.useAlphaFromAlbedoTexture=!1,r.forceAlphaTest=!1,r.alphaCutOff=.4,r.useSpecularOverAlpha=!0,r.useMicroSurfaceFromReflectivityMapAlpha=!1,r.useRoughnessFromMetallicTextureAlpha=!0,r.useRoughnessFromMetallicTextureGreen=!1,r.useMetallnessFromMetallicTextureBlue=!1,r.useAmbientOcclusionFromMetallicTextureRed=!1,r.useAmbientInGrayScale=!1,r.useAutoMicroSurfaceFromReflectivityMap=!1,r.useRadianceOverAlpha=!0,r.useObjectSpaceNormalMap=!1,r.useParallax=!1,r.useParallaxOcclusion=!1,r.parallaxScaleBias=.05,r.disableLighting=!1,r.forceIrradianceInFragment=!1,r.maxSimultaneousLights=4,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.twoSidedLighting=!1,r.useAlphaFresnel=!1,r.useLinearAlphaFresnel=!1,r.environmentBRDFTexture=null,r.forceNormalForward=!1,r.enableSpecularAntiAliasing=!1,r.useHorizonOcclusion=!0,r.useRadianceOcclusion=!0,r.unlit=!1,r._environmentBRDFTexture=tr.GetEnvironmentBRDFTexture(i),r}return c.d(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return 1/this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=1/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===lr.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?lr.LIGHTFALLOFF_PHYSICAL:lr.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===lr.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?lr.LIGHTFALLOFF_GLTF:lr.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var n=this,i=D.a.Clone(function(){return new t(e,n.getScene())},this);return i.id=e,i.name=e,this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),i},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,i){var r=D.a.Parse(function(){return new t(e.name,n)},e,n,i);return e.clearCoat&&r.clearCoat.parse(e.clearCoat),e.anisotropy&&r.anisotropy.parse(e.anisotropy),e.brdf&&r.brdf.parse(e.brdf),e.sheen&&r.sheen.parse(e.brdf),r},t.PBRMATERIAL_OPAQUE=lr.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=lr.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=lr.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=lr.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=lr.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),c.c([Object(D.e)("ambient"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),c.c([Object(D.e)("albedo"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),c.c([Object(D.e)("reflectivity"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),c.c([Object(D.e)("reflection"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),c.c([Object(D.e)("emissive"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),c.c([Object(D.c)()],t.prototype,"usePhysicalLightFalloff",null),c.c([Object(D.c)()],t.prototype,"useGLTFLightFalloff",null),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(lr);a.a.RegisteredTypes["BABYLON.PBRMaterial"]=cr;var ur=n(62),hr=n(71);function dr(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var fr=dr("DXT1"),pr=dr("DXT3"),gr=dr("DXT5"),mr=dr("DX10"),_r=function(){function e(){}return e.GetDDSInfo=function(e){var t=new Int32Array(e,0,31),n=new Int32Array(e,0,35),i=1;131072&t[2]&&(i=Math.max(1,t[7]));var r=t[21],o=r===mr?n[32]:0,a=g.a.TEXTURETYPE_UNSIGNED_INT;switch(r){case 113:a=g.a.TEXTURETYPE_HALF_FLOAT;break;case 116:a=g.a.TEXTURETYPE_FLOAT;break;case mr:if(10===o){a=g.a.TEXTURETYPE_HALF_FLOAT;break}}return{width:t[4],height:t[3],mipmapCount:i,isFourCC:4==(4&t[20]),isRGB:64==(64&t[20]),isLuminance:131072==(131072&t[20]),isCube:512==(512&t[28]),isCompressed:r===fr||r===pr||r===gr,dxgiFormat:o,textureType:a}},e._ToHalfFloat=function(t){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=t;var n=e._Int32View[0],i=n>>16&32768,r=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((r|=2048)>>114-o)+(r>>113-o&1):(i|=o-112<<10|r>>1,i+=1&r)},e._FromHalfFloat=function(e){var t=(32768&e)>>15,n=(31744&e)>>10,i=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==n?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i,r,o,a){for(var s=new Float32Array(r),l=new Uint16Array(o,i),c=0,u=0;u<n;u++)for(var h=0;h<t;h++){var d=4*(h+u*t);s[c]=e._FromHalfFloat(l[d]),s[c+1]=e._FromHalfFloat(l[d+1]),s[c+2]=e._FromHalfFloat(l[d+2]),s[c+3]=e.StoreLODInAlphaChannel?a:e._FromHalfFloat(l[d+3]),c+=4}return s},e._GetHalfFloatRGBAArrayBuffer=function(t,n,i,r,o,a){if(e.StoreLODInAlphaChannel){for(var s=new Uint16Array(r),l=new Uint16Array(o,i),c=0,u=0;u<n;u++)for(var h=0;h<t;h++){var d=4*(h+u*t);s[c]=l[d],s[c+1]=l[d+1],s[c+2]=l[d+2],s[c+3]=e._ToHalfFloat(a),c+=4}return s}return new Uint16Array(o,i,r)},e._GetFloatRGBAArrayBuffer=function(t,n,i,r,o,a){if(e.StoreLODInAlphaChannel){for(var s=new Float32Array(r),l=new Float32Array(o,i),c=0,u=0;u<n;u++)for(var h=0;h<t;h++){var d=4*(h+u*t);s[c]=l[d],s[c+1]=l[d+1],s[c+2]=l[d+2],s[c+3]=a,c+=4}return s}return new Float32Array(o,i,r)},e._GetFloatAsUIntRGBAArrayBuffer=function(t,n,i,r,o,a){for(var s=new Uint8Array(r),l=new Float32Array(o,i),c=0,u=0;u<n;u++)for(var h=0;h<t;h++){var d=4*(h+u*t);s[c]=255*I.a.Clamp(l[d]),s[c+1]=255*I.a.Clamp(l[d+1]),s[c+2]=255*I.a.Clamp(l[d+2]),s[c+3]=e.StoreLODInAlphaChannel?a:255*I.a.Clamp(l[d+3]),c+=4}return s},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,n,i,r,o,a){for(var s=new Uint8Array(r),l=new Uint16Array(o,i),c=0,u=0;u<n;u++)for(var h=0;h<t;h++){var d=4*(h+u*t);s[c]=255*I.a.Clamp(e._FromHalfFloat(l[d])),s[c+1]=255*I.a.Clamp(e._FromHalfFloat(l[d+1])),s[c+2]=255*I.a.Clamp(e._FromHalfFloat(l[d+2])),s[c+3]=e.StoreLODInAlphaChannel?a:255*I.a.Clamp(e._FromHalfFloat(l[d+3])),c+=4}return s},e._GetRGBAArrayBuffer=function(e,t,n,i,r,o,a,s,l){for(var c=new Uint8Array(i),u=new Uint8Array(r,n),h=0,d=0;d<t;d++)for(var f=0;f<e;f++){var p=4*(f+d*e);c[h]=u[p+o],c[h+1]=u[p+a],c[h+2]=u[p+s],c[h+3]=u[p+l],h+=4}return c},e._ExtractLongWordOrder=function(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)},e._GetRGBArrayBuffer=function(e,t,n,i,r,o,a,s){for(var l=new Uint8Array(i),c=new Uint8Array(r,n),u=0,h=0;h<t;h++)for(var d=0;d<e;d++){var f=3*(d+h*e);l[u]=c[f+o],l[u+1]=c[f+a],l[u+2]=c[f+s],u+=3}return l},e._GetLuminanceArrayBuffer=function(e,t,n,i,r){for(var o=new Uint8Array(i),a=new Uint8Array(r,n),s=0,l=0;l<t;l++)for(var c=0;c<e;c++)o[s]=a[c+l*e],s++;return o},e.UploadDDSLevels=function(t,n,i,r,o,a,s,l){void 0===s&&(s=-1);var c=null;r.sphericalPolynomial&&(c=new Array);var u,h,d,f,m,_,v,b=t.getCaps().s3tc,y=new Int32Array(i,0,31),T=0,E=0,x=1;if(542327876===y[0])if(r.isFourCC||r.isRGB||r.isLuminance)if(!r.isCompressed||b){var C=y[22];f=y[1]+4;var S,A=!1;if(r.isFourCC)switch(u=y[21]){case fr:x=8,E=b.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case pr:x=16,E=b.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case gr:x=16,E=b.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:A=!0;break;case mr:f+=20;var P=!1;switch(r.dxgiFormat){case 10:A=!0,P=!0;break;case 88:r.isRGB=!0,r.isFourCC=!1,C=32,P=!0}if(P)break;default:return void console.error("Unsupported FourCC code:",(S=u,String.fromCharCode(255&S,S>>8&255,S>>16&255,S>>24&255)))}var R=e._ExtractLongWordOrder(y[23]),M=e._ExtractLongWordOrder(y[24]),O=e._ExtractLongWordOrder(y[25]),w=e._ExtractLongWordOrder(y[26]);A&&(E=t._getRGBABufferInternalSizedFormat(r.textureType)),_=1,131072&y[2]&&!1!==o&&(_=Math.max(1,y[7]));for(var I=l||0;I<a;I++){for(h=y[4],d=y[3],v=0;v<_;++v){if(-1===s||s===v){var D=-1===s?v:0;if(!r.isCompressed&&r.isFourCC){n.format=g.a.TEXTUREFORMAT_RGBA,T=h*d*4;var L=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(128===C?(L=e._GetFloatAsUIntRGBAArrayBuffer(h,d,f,T,i,D),c&&0==D&&c.push(e._GetFloatRGBAArrayBuffer(h,d,f,T,i,D))):64===C&&(L=e._GetHalfFloatAsUIntRGBAArrayBuffer(h,d,f,T,i,D),c&&0==D&&c.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,T,i,D))),n.type=g.a.TEXTURETYPE_UNSIGNED_INT):128===C?(n.type=g.a.TEXTURETYPE_FLOAT,L=e._GetFloatRGBAArrayBuffer(h,d,f,T,i,D),c&&0==D&&c.push(L)):64!==C||t.getCaps().textureHalfFloat?(n.type=g.a.TEXTURETYPE_HALF_FLOAT,L=e._GetHalfFloatRGBAArrayBuffer(h,d,f,T,i,D),c&&0==D&&c.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,T,i,D))):(n.type=g.a.TEXTURETYPE_FLOAT,L=e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,T,i,D),c&&0==D&&c.push(L)),L&&t._uploadDataToTextureDirectly(n,L,I,D)}else if(r.isRGB)n.type=g.a.TEXTURETYPE_UNSIGNED_INT,24===C?(n.format=g.a.TEXTUREFORMAT_RGB,m=e._GetRGBArrayBuffer(h,d,f,T=h*d*3,i,R,M,O),t._uploadDataToTextureDirectly(n,m,I,D)):(n.format=g.a.TEXTUREFORMAT_RGBA,m=e._GetRGBAArrayBuffer(h,d,f,T=h*d*4,i,R,M,O,w),t._uploadDataToTextureDirectly(n,m,I,D));else if(r.isLuminance){var k=t._getUnpackAlignement(),N=h;T=Math.floor((h+k-1)/k)*k*(d-1)+N,m=e._GetLuminanceArrayBuffer(h,d,f,T,i),n.format=g.a.TEXTUREFORMAT_LUMINANCE,n.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(n,m,I,D)}else T=Math.max(4,h)/4*Math.max(4,d)/4*x,m=new Uint8Array(i,f,T),n.type=g.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(n,E,h,d,m,I,D)}f+=C?h*d*(C/8):T,h*=.5,d*=.5,h=Math.max(1,h),d=Math.max(1,d)}if(void 0!==l)break}r.sphericalPolynomial=c&&c.length>0?hr.a.ConvertCubeMapToSphericalPolynomial({size:y[4],right:c[0],left:c[1],up:c[2],down:c[3],front:c[4],back:c[5],format:g.a.TEXTUREFORMAT_RGBA,type:g.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):void 0}else p.a.Error("Compressed textures are not supported on this platform.");else p.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else p.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();me.b.prototype.createPrefilteredCubeTexture=function(e,t,n,i,r,o,a,s,l){var c=this;return void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=!0),this.createCubeTexture(e,t,null,!1,function(e){if(e){var o=e.texture;if(l?e.info.sphericalPolynomial&&(o._sphericalPolynomial=e.info.sphericalPolynomial):o._sphericalPolynomial=new ur.b,o._dataSource=ze.a.DATASOURCE_CUBEPREFILTERED,c.getCaps().textureLOD)r&&r(o);else{var a=c._gl,s=e.width;if(s){for(var u=[],h=0;h<3;h++){var d=1-h/2,f=i,g=I.a.Log2(s)*n+i,m=Math.round(Math.min(Math.max(f+(g-f)*d,0),g)),_=new ze.a(c,ze.a.DATASOURCE_TEMP);if(_.type=o.type,_.format=o.format,_.width=Math.pow(2,Math.max(I.a.Log2(s)-m,0)),_.height=_.width,_.isCube=!0,c._bindTextureDirectly(a.TEXTURE_CUBE_MAP,_,!0),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.isDDS){var v=e.info,b=e.data;c._unpackFlipY(v.isCompressed),_r.UploadDDSLevels(c,_,b,v,!0,6,m)}else p.a.Warn("DDS is the only prefiltered cube map supported so far.");c._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null);var y=new Gi.a(t);y.isCube=!0,y._texture=_,_.isReady=!0,u.push(y)}o._lodTextureHigh=u[2],o._lodTextureMid=u[1],o._lodTextureLow=u[0],r&&r(o)}}}else r&&r(null)},o,a,s,l,n,i)};var vr=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(e,t,n,i,r){return 0===e.indexOf(".dds")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,i,r){var o,a=t.getEngine(),s=!1;if(Array.isArray(e))for(var l=0;l<e.length;l++){var c=e[l];o=_r.GetDDSInfo(c),t.width=o.width,t.height=o.height,s=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),_r.UploadDDSLevels(a,t,c,o,s,6,-1,l),o.isFourCC||1!==o.mipmapCount||a.generateMipMapsForCubemap(t)}else{var u=e;o=_r.GetDDSInfo(u),t.width=o.width,t.height=o.height,n&&(o.sphericalPolynomial=new ur.b),s=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),_r.UploadDDSLevels(a,t,u,o,s,6),o.isFourCC||1!==o.mipmapCount||a.generateMipMapsForCubemap(t)}a._setCubeMapTextureParams(s),t.isReady=!0,i&&i({isDDS:!0,width:t.width,info:o,data:e,texture:t})},e.prototype.loadData=function(e,t,n){var i=_r.GetDDSInfo(e),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps&&i.width>>i.mipmapCount-1==1;n(i.width,i.height,r,i.isFourCC,function(){_r.UploadDDSLevels(t.getEngine(),t,e,i,r,1)})},e}();me.b._TextureLoaders.push(new vr),zt.a.ShadersStore.rgbdEncodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}";var br=function(){function e(){}return e.GetEnvInfo=function(t){for(var n=new DataView(t),i=0,r=0;r<e._MagicBytes.length;r++)if(n.getUint8(i++)!==e._MagicBytes[r])return p.a.Error("Not a babylon environment map"),null;for(var o="",a=0;a=n.getUint8(i++);)o+=String.fromCharCode(a);var s=JSON.parse(o);return s.specular&&(s.specular.specularDataPosition=i,s.specular.lodGenerationScale=s.specular.lodGenerationScale||.8),s},e.CreateEnvTextureAsync=function(t){var n=this,i=t.getInternalTexture();if(!i)return Promise.reject("The cube texture is invalid.");if(!t._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var r=i.getEngine();if(r&&r.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===g.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=r.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var a=g.a.TEXTURETYPE_FLOAT;if(!r.getCaps().textureFloatRender&&(a=g.a.TEXTURETYPE_HALF_FLOAT,!r.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var s=i.width,l=new W.a(r),c={},u=[],h=I.a.Log2(i.width);h=Math.round(h);for(var d=function(e){for(var n=Math.pow(2,h-e),i=function(i){var s=t.readPixels(i,e),h=r.createRawTexture(s,n,n,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,a),d=new Promise(function(t,a){var s=new jt("rgbdEncode","rgbdEncode",null,null,1,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,r,!1,void 0,g.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);s.getEffect().executeWhenCompiled(function(){s.onApply=function(e){e._bindTexture("textureSampler",h)};var a=r.getRenderWidth(),u=r.getRenderHeight();r.setSize(n,n),l.postProcessManager.directRender([s],null),be.h.ToBlob(o,function(n){var r=new FileReader;r.onload=function(n){c[6*e+i]=n.target.result,t()},r.readAsArrayBuffer(n)}),r.setSize(a,u)})});u.push(d)},s=0;s<6;s++)i(s)},f=0;f<=h;f++)d(f);return Promise.all(u).then(function(){l.dispose();for(var i={version:1,width:s,irradiance:n._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},r=0,o=0;o<=h;o++)for(var a=0;a<6;a++){var u=c[6*o+a].byteLength;i.specular.mipmaps.push({length:u,position:r}),r+=u}for(var d=JSON.stringify(i),f=new ArrayBuffer(d.length+1),p=new Uint8Array(f),g=(o=0,d.length);o<g;o++)p[o]=d.charCodeAt(o);p[d.length]=0;var m=new ArrayBuffer(e._MagicBytes.length+r+f.byteLength),_=new Uint8Array(m),v=new DataView(m),b=0;for(o=0;o<e._MagicBytes.length;o++)v.setUint8(b++,e._MagicBytes[o]);for(_.set(new Uint8Array(f),b),b+=f.byteLength,o=0;o<=h;o++)for(a=0;a<6;a++){var y=c[6*o+a];_.set(new Uint8Array(y),b),b+=y.byteLength}return m})},e._CreateEnvTextureIrradiance=function(e){var t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}},e.UploadEnvLevelsAsync=function(t,n,i){if(1!==i.version)throw new Error('Unsupported babylon environment map version "'+i.version+'"');var r=i.specular;if(!r)return Promise.resolve();var o=I.a.Log2(i.width);if(o=Math.round(o)+1,r.mipmaps.length!==6*o)throw new Error('Unsupported specular mipmaps number "'+r.mipmaps.length+'"');t._lodGenerationScale=r.lodGenerationScale;for(var a=new Array(o),s=0;s<o;s++){a[s]=new Array(6);for(var l=0;l<6;l++){var c=r.mipmaps[6*s+l];a[s][l]=new Uint8Array(n,r.specularDataPosition+c.position,c.length)}}return e.UploadLevelsAsync(t,a)},e.UploadLevelsAsync=function(e,t){if(!be.h.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");var n=Math.round(I.a.Log2(e.width))+1,i=e.getEngine(),r=!1,o=!1,a=null,s=null,l=null,c=i.getCaps();if(e.format=g.a.TEXTUREFORMAT_RGBA,e.type=g.a.TEXTURETYPE_UNSIGNED_INT,e.generateMipMaps=!0,i.updateTextureSamplingMode(g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e),c.textureLOD?i.webGLVersion<2?r=!1:c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering?(r=!0,e.type=g.a.TEXTURETYPE_HALF_FLOAT):c.textureFloatRender&&c.textureFloatLinearFiltering&&(r=!0,e.type=g.a.TEXTURETYPE_FLOAT):(r=!1,o=!0,l={}),r)a=new jt("rgbdDecode","rgbdDecode",null,null,1,null,g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,i,!1,void 0,e.type,void 0,null,!1),e._isRGBD=!1,e.invertY=!1,s=i.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:g.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:e.type,format:g.a.TEXTUREFORMAT_RGBA});else if(e._isRGBD=!0,e.invertY=!0,o)for(var u=e._lodGenerationScale,h=e._lodGenerationOffset,d=0;d<3;d++){var f=(n-1)*u+h,p=Math.round(Math.min(Math.max(h+(f-h)*(1-d/2),0),f)),m=new ze.a(i,ze.a.DATASOURCE_TEMP);m.isCube=!0,m.invertY=!0,m.generateMipMaps=!1,i.updateTextureSamplingMode(g.a.TEXTURE_LINEAR_LINEAR,m);var _=new Gi.a(null);switch(_.isCube=!0,_._texture=m,l[p]=_,d){case 0:e._lodTextureLow=_;break;case 1:e._lodTextureMid=_;break;case 2:e._lodTextureHigh=_}}var v=[],b=function(n){for(var c=function(c){var u=new Blob([t[n][c]],{type:"image/png"}),h=URL.createObjectURL(u),d=new Image;d.src=h;var f=new Promise(function(t,u){d.onload=function(){if(r){var f=i.createTexture(null,!0,!0,null,g.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(e){u(e)},d);a.getEffect().executeWhenCompiled(function(){a.onApply=function(e){e._bindTexture("textureSampler",f),e.setFloat2("scale",1,1)},i.scenes[0].postProcessManager.directRender([a],s,!0,c,n),i.restoreDefaultFramebuffer(),f.dispose(),window.URL.revokeObjectURL(h),t()})}else{if(i._uploadImageToTexture(e,d,c,n),o){var p=l[n];p&&i._uploadImageToTexture(p._texture,d,c,0)}t()}},d.onerror=function(e){u(e)}});v.push(f)},u=0;u<6;u++)c(u)};for(d=0;d<t.length;d++)b(d);if(t.length<n){var y=void 0,T=Math.pow(2,n-1-t.length),E=T*T*4;switch(e.type){case g.a.TEXTURETYPE_UNSIGNED_INT:y=new Uint8Array(E);break;case g.a.TEXTURETYPE_HALF_FLOAT:y=new Uint16Array(E);break;case g.a.TEXTURETYPE_FLOAT:y=new Float32Array(E)}for(d=t.length;d<n;d++)for(var x=0;x<6;x++)i._uploadArrayBufferViewToTexture(e,y,x,d)}return Promise.all(v).then(function(){s&&(i._releaseFramebufferObjects(s),s._swapAndDie(e)),a&&a.dispose(),o&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))})},e.UploadEnvSpherical=function(e,t){1!==t.version&&p.a.Warn('Unsupported babylon environment map version "'+t.version+'"');var n=t.irradiance;if(n){var i=new ur.b;o.x.FromArrayToRef(n.x,0,i.x),o.x.FromArrayToRef(n.y,0,i.y),o.x.FromArrayToRef(n.z,0,i.z),o.x.FromArrayToRef(n.xx,0,i.xx),o.x.FromArrayToRef(n.yy,0,i.yy),o.x.FromArrayToRef(n.zz,0,i.zz),o.x.FromArrayToRef(n.yz,0,i.yz),o.x.FromArrayToRef(n.zx,0,i.zx),o.x.FromArrayToRef(n.xy,0,i.xy),e._sphericalPolynomial=i}},e._UpdateRGBDAsync=function(t,n,i,r,o){return t._dataSource=ze.a.DATASOURCE_CUBERAW_RGBD,t._bufferViewArrayArray=n,t._lodGenerationScale=r,t._lodGenerationOffset=o,t._sphericalPolynomial=i,e.UploadLevelsAsync(t,n).then(function(){t.isReady=!0})},e._MagicBytes=[134,22,135,150,246,214,150,54],e}();ze.a._UpdateRGBDAsync=br._UpdateRGBDAsync;var yr=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,i,r){return 0===e.indexOf(".env")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,i,r){if(!Array.isArray(e)){var o=br.GetEnvInfo(e=e);o?(t.width=o.width,t.height=o.width,br.UploadEnvSpherical(t,o),br.UploadEnvLevelsAsync(t,e,o).then(function(){t.isReady=!0,i&&i()})):r&&r("Can not parse the environment file",null)}},e.prototype.loadData=function(e,t,n){throw".env not supported in 2d."},e}();me.b._TextureLoaders.push(new yr);var Tr=function(){function e(t,n,i,r){this.arrayBuffer=t,this.isInvalid=!1;var o=new Uint8Array(this.arrayBuffer,0,12);if(171!==o[0]||75!==o[1]||84!==o[2]||88!==o[3]||32!==o[4]||49!==o[5]||49!==o[6]||187!==o[7]||13!==o[8]||10!==o[9]||26!==o[10]||10!==o[11])return this.isInvalid=!0,void p.a.Error("texture missing KTX identifier");var a=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*a),l=67305985===s.getUint32(0,!0);this.glType=s.getUint32(1*a,l),this.glTypeSize=s.getUint32(2*a,l),this.glFormat=s.getUint32(3*a,l),this.glInternalFormat=s.getUint32(4*a,l),this.glBaseInternalFormat=s.getUint32(5*a,l),this.pixelWidth=s.getUint32(6*a,l),this.pixelHeight=s.getUint32(7*a,l),this.pixelDepth=s.getUint32(8*a,l),this.numberOfArrayElements=s.getUint32(9*a,l),this.numberOfFaces=s.getUint32(10*a,l),this.numberOfMipmapLevels=s.getUint32(11*a,l),this.bytesOfKeyValueData=s.getUint32(12*a,l),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===n?this.loadType=e.COMPRESSED_2D:p.a.Error("number of faces expected"+n+", but found "+this.numberOfFaces):p.a.Error("texture arrays not currently supported"):p.a.Error("only 2D textures currently supported")):p.a.Error("only compressed formats currently supported")}return e.prototype.uploadLevels=function(t,n){switch(this.loadType){case e.COMPRESSED_2D:this._upload2DCompressedLevels(t,n)}},e.prototype._upload2DCompressedLevels=function(t,n){for(var i=e.HEADER_LEN+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight,a=n?this.numberOfMipmapLevels:1,s=0;s<a;s++){var l=new Int32Array(this.arrayBuffer,i,1)[0];i+=4;for(var c=0;c<this.numberOfFaces;c++){var u=new Uint8Array(this.arrayBuffer,i,l);t.getEngine()._uploadCompressedDataToTextureDirectly(t,this.glInternalFormat,r,o,u,c,s),i+=l,i+=3-(l+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),Er=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,i,r){return!(!t||i||n||r)},e.prototype.transformUrl=function(e,t){var n=e.lastIndexOf(".");return-1!=n&&"ktx"==e.substring(n+1)?e:(n>-1?e.substring(0,n):e)+t},e.prototype.getFallbackTextureUrl=function(e,t){var n=new RegExp(t+"$");return e.replace(n,"")},e.prototype.loadCubeData=function(e,t,n,i,r){if(!Array.isArray(e)){t._invertVScale=!t.invertY;var o=t.getEngine(),a=new Tr(e,6),s=a.numberOfMipmapLevels>1&&t.generateMipMaps;o._unpackFlipY(!0),a.uploadLevels(t,t.generateMipMaps),t.width=a.pixelWidth,t.height=a.pixelHeight,o._setCubeMapTextureParams(s),t.isReady=!0}},e.prototype.loadData=function(e,t,n){t._invertVScale=!t.invertY;var i=new Tr(e,1);n(i.pixelWidth,i.pixelHeight,!1,!0,function(){i.uploadLevels(t,t.generateMipMaps)},i.isInvalid)},e}();me.b._TextureLoaders.unshift(new Er),W.a.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();0===this.lights.length&&new gn.a("default light",o.x.Up(),this)},W.a.prototype.createDefaultCamera=function(e,t,n){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var i,r=this.getWorldExtends(),a=r.max.subtract(r.min),s=r.min.add(a.scale(.5)),l=1.5*a.length();if(isFinite(l)||(l=1,s.copyFromFloats(0,0,0)),e){var c=new Et("default camera",-Math.PI/2,Math.PI/2,l,s,this);c.lowerRadiusLimit=.01*l,c.wheelPrecision=100/l,i=c}else{var u=new yt("default camera",new o.x(s.x,s.y,-l),this);u.setTarget(s),i=u}i.minZ=.01*l,i.maxZ=1e3*l,i.speed=.2*l,this.activeCamera=i;var h=this.getEngine().getRenderingCanvas();n&&h&&i.attachControl(h)}},W.a.prototype.createDefaultCameraOrLight=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.createDefaultLight(t),this.createDefaultCamera(e,t,n)},W.a.prototype.createDefaultSkybox=function(e,t,n,i,r){if(void 0===t&&(t=!1),void 0===n&&(n=1e3),void 0===i&&(i=0),void 0===r&&(r=!0),!e)return p.a.Warn("Can not create default skybox without environment texture."),null;r&&e&&(this.environmentTexture=e);var o=fe.a.CreateBox("hdrSkyBox",n,this);if(t){var a=new cr("skyBox",this);a.backFaceCulling=!1,a.reflectionTexture=e.clone(),a.reflectionTexture&&(a.reflectionTexture.coordinatesMode=Ge.a.SKYBOX_MODE),a.microSurface=1-i,a.disableLighting=!0,a.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=a}else{var s=new bn.a("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=e.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=Ge.a.SKYBOX_MODE),s.disableLighting=!0,o.infiniteDistance=!0,o.material=s}return o.isPickable=!1,o},W.a.prototype.createDefaultEnvironment=function(e){return Ji?new Ji(e,this):null},W.a.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new Ln(this,e)},W.a.prototype.createDefaultXRExperienceAsync=function(){var e=this;return Bn.CreateAsync(this).then(function(t){var n=new Hn(t);return Gn.CreateAsync(e,t,{outputCanvasContext:n.canvasContext}).then(function(e){return new jn(t),t})})};var xr=function(e){function t(t,n,i,r,o,a,s){void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===s&&(s={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var l=e.call(this,null,i,!r,o)||this;l._onUserActionRequestedObservable=null,l._stillImageCaptured=!1,l._displayingPosterTexture=!1,l._createInternalTexture=function(){if(null!=l._texture){if(!l._displayingPosterTexture)return;l._texture.dispose(),l._displayingPosterTexture=!1}if(!l._engine.needPOTTextures||be.h.IsExponentOfTwo(l.video.videoWidth)&&be.h.IsExponentOfTwo(l.video.videoHeight)?(l.wrapU=Ge.a.WRAP_ADDRESSMODE,l.wrapV=Ge.a.WRAP_ADDRESSMODE):(l.wrapU=Ge.a.CLAMP_ADDRESSMODE,l.wrapV=Ge.a.CLAMP_ADDRESSMODE,l._generateMipMaps=!1),l._texture=l._engine.createDynamicTexture(l.video.videoWidth,l.video.videoHeight,l._generateMipMaps,l.samplingMode),l.video.autoplay||l._settings.poster)l._texture.isReady=!0,l._updateInternalTexture(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l);else{var e=l.video.onplaying,t=!1,n=l.video.muted;l.video.muted=!0,l.video.onplaying=function(){l.video.muted=n,l.video.onplaying=e,l._texture.isReady=!0,l._updateInternalTexture(),t||l.video.pause(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l)};var i=l.video.play();i?i.then(function(){}).catch(function(){t=!0,l._onUserActionRequestedObservable&&l._onUserActionRequestedObservable.hasObservers()&&l._onUserActionRequestedObservable.notifyObservers(l)}):(l.video.onplaying=e,l._texture.isReady=!0,l._updateInternalTexture(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l))}},l.reset=function(){null!=l._texture&&(l._displayingPosterTexture||(l._texture.dispose(),l._texture=null))},l._updateInternalTexture=function(){null!=l._texture&&l._texture.isReady&&(l.video.readyState<l.video.HAVE_CURRENT_DATA||l._displayingPosterTexture||l._engine.updateVideoTexture(l._texture,l.video,l._invertY))},l._engine=l.getScene().getEngine(),l._generateMipMaps=r,l._initialSamplingMode=a,l.autoUpdateTexture=s.autoUpdateTexture,l.name=t||l._getName(n),l.video=l._getVideo(n),l._settings=s,s.poster&&(l.video.poster=s.poster),void 0!==s.autoPlay&&(l.video.autoplay=s.autoPlay),void 0!==s.loop&&(l.video.loop=s.loop),l.video.setAttribute("playsinline",""),l.video.addEventListener("paused",l._updateInternalTexture),l.video.addEventListener("seeked",l._updateInternalTexture),l.video.addEventListener("emptied",l.reset),l._createInternalTextureOnEvent=s.poster&&!s.autoPlay?"play":"canplay",l.video.addEventListener(l._createInternalTextureOnEvent,l._createInternalTexture);var c=l.video.readyState>=l.video.HAVE_CURRENT_DATA;return!s.poster||s.autoPlay&&c?c&&l._createInternalTexture():(l._texture=l._engine.createTexture(s.poster,!1,!0,i),l._displayingPosterTexture=!0),l}return c.d(t,e),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new r.c),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:"object"==typeof e?e.toString():e},t.prototype._getVideo=function(e){if(e instanceof HTMLVideoElement)return be.h.SetCorsBehavior(e.currentSrc,e),e;var t=document.createElement("video");return"string"==typeof e?(be.h.SetCorsBehavior(e,t),t.src=e):(be.h.SetCorsBehavior(e[0],t),e.forEach(function(e){var n=document.createElement("source");n.src=e,t.appendChild(n)})),t},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(e,n){var i=document.createElement("video");return i.setAttribute("autoplay",""),i.setAttribute("muted","true"),i.setAttribute("playsinline",""),i.muted=!0,void 0!==i.mozSrcObject?i.mozSrcObject=n:"object"==typeof i.srcObject?i.srcObject=n:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.src=window.URL&&window.URL.createObjectURL(n)),new Promise(function(n){var r=function(){n(new t("video",i,e,!0,!0)),i.removeEventListener("playing",r)};i.addEventListener("playing",r),i.play()})},t.CreateFromWebCamAsync=function(e,t,n){var i,r=this;return void 0===n&&(n=!1),t&&t.deviceId&&(i={exact:t.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:t,audio:n}).then(function(t){return r.CreateFromStreamAsync(e,t)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:i,width:{min:t&&t.minWidth||256,max:t&&t.maxWidth||640},height:{min:t&&t.minHeight||256,max:t&&t.maxHeight||480}},audio:n},function(t){return r.CreateFromStreamAsync(e,t)},function(e){p.a.Error(e.name)}),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(e,t,n,i){void 0===i&&(i=!1),this.CreateFromWebCamAsync(e,n,i).then(function(e){t&&t(e)}).catch(function(e){p.a.Error(e.name)})},t}(Ge.a),Cr=function(e){function t(n,i,r,a){var s=e.call(this,n,a)||this;s._useDirectMapping=!1,s._videoMode=t.MODE_MONOSCOPIC,s._onBeforeCameraRenderObserver=null,a=s.getScene(),n=n||"videoDome",r.resolution=0|Math.abs(r.resolution)||32,r.clickToPlay=Boolean(r.clickToPlay),r.autoPlay=void 0===r.autoPlay||Boolean(r.autoPlay),r.loop=void 0===r.loop||Boolean(r.loop),r.size=Math.abs(r.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),s._useDirectMapping=void 0===r.useDirectMapping||r.useDirectMapping,void 0===r.faceForward&&(r.faceForward=!0),s._setReady(!1);var l={loop:r.loop,autoPlay:r.autoPlay,autoUpdateTexture:!0,poster:r.poster},c=s._material=new qi(n+"_material",a),u=s._videoTexture=new xr(n+"_texture",i,a,!1,s._useDirectMapping,Ge.a.TRILINEAR_SAMPLINGMODE,l);if(s._mesh=fe.a.CreateSphere(n+"_mesh",r.resolution,r.size,a,!1,fe.a.BACKSIDE),u.onLoadObservable.addOnce(function(){s._setReady(!0)}),c.useEquirectangularFOV=!0,c.fovMultiplier=1,c.opacityFresnel=!1,s._useDirectMapping?(u.wrapU=Ge.a.CLAMP_ADDRESSMODE,u.wrapV=Ge.a.CLAMP_ADDRESSMODE,c.diffuseTexture=u):(u.coordinatesMode=Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,u.wrapV=Ge.a.CLAMP_ADDRESSMODE,c.reflectionTexture=u),s._mesh.material=c,s._mesh.parent=s,r.clickToPlay&&(a.onPointerUp=function(){s._videoTexture.video.play()}),r.faceForward&&a.activeCamera){var h=a.activeCamera,d=o.x.Forward(),f=o.x.TransformNormal(d,h.getViewMatrix());f.normalize(),s.rotation.y=Math.acos(o.x.Dot(d,f))}return s}return c.d(t,e),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this._videoMode},set:function(e){this._videoMode!==e&&this._changeVideoMode(e)},enumerable:!0,configurable:!0}),t.prototype._changeVideoMode=function(e){var n=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._videoMode=e,this._videoTexture.uScale=1,this._videoTexture.vScale=1,this._videoTexture.uOffset=0,this._videoTexture.vOffset=0,e){case t.MODE_SIDEBYSIDE:this._videoTexture.uScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(e){n._videoTexture.uOffset=e.isRightCamera?.5:0});break;case t.MODE_TOPBOTTOM:this._videoTexture.vScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(e){n._videoTexture.vOffset=e.isRightCamera?.5:0})}},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),e.prototype.dispose.call(this,t,n)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}($i.a),Sr=function(){function e(e){this.engine=e,this._captureGPUFrameTime=!1,this._gpuFrameTime=new be.f,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new be.f,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(t._gpuFrameTimeToken){var e=t.engine.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){t._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),Ar=function(){function e(e){var t=this;this.scene=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new be.f,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new be.f,this._captureFrameTime=!1,this._frameTime=new be.f,this._captureRenderTime=!1,this._renderTime=new be.f,this._captureInterFrameTime=!1,this._interFrameTime=new be.f,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new be.f,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new be.f,this._capturePhysicsTime=!1,this._physicsTime=new be.f,this._captureAnimationsTime=!1,this._animationsTime=new be.f,this._captureCameraRenderTime=!1,this._cameraRenderTime=new be.f,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add(function(){t._captureActiveMeshesEvaluationTime&&t._activeMeshesEvaluationTime.fetchNewFrame(),t._captureRenderTargetsRenderTime&&t._renderTargetsRenderTime.fetchNewFrame(),t._captureFrameTime&&(be.h.StartPerformanceCounter("Scene rendering"),t._frameTime.beginMonitoring()),t._captureInterFrameTime&&t._interFrameTime.endMonitoring(),t._captureParticlesRenderTime&&t._particlesRenderTime.fetchNewFrame(),t._captureSpritesRenderTime&&t._spritesRenderTime.fetchNewFrame(),t._captureAnimationsTime&&t._animationsTime.beginMonitoring(),t.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=e.onAfterRenderObservable.add(function(){t._captureFrameTime&&(be.h.EndPerformanceCounter("Scene rendering"),t._frameTime.endMonitoring()),t._captureRenderTime&&t._renderTime.endMonitoring(!1),t._captureInterFrameTime&&t._interFrameTime.beginMonitoring()})}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(e){var t=this;e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){be.h.StartPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){be.h.EndPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(e){var t=this;e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){be.h.StartPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){be.h.EndPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(e){var t=this;e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){be.h.StartPerformanceCounter("Particles"),t._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){be.h.EndPerformanceCounter("Particles"),t._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(e){var t=this;e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.scene.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){be.h.StartPerformanceCounter("Sprites"),t._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){be.h.EndPerformanceCounter("Sprites"),t._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(e){var t=this;e!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){be.h.StartPerformanceCounter("Physics"),t._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){be.h.EndPerformanceCounter("Physics"),t._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){t._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){t._renderTime.beginMonitoring(),be.h.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){t._renderTime.endMonitoring(!1),be.h.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(e){var t=this;e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(e){t._cameraRenderTime.beginMonitoring(),be.h.StartPerformanceCounter("Rendering camera "+e.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(e){t._cameraRenderTime.endMonitoring(!1),be.h.EndPerformanceCounter("Rendering camera "+e.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),Pr=n(20);zt.a.ShadersStore.glowMapGenerationPixelShader="#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform sampler2D opacitySampler;\nuniform float opacityIntensity;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef VERTEXALPHA\nvarying vec4 vColor;\n#endif\nuniform vec4 glowColor;\nvoid main(void)\n{\nvec4 finalColor=glowColor;\n\n#ifdef DIFFUSE\nvec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);\nfinalColor.a*=albedoTexture.a;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vUVOpacity);\n#ifdef OPACITYRGB\nfinalColor.a*=getLuminance(opacityMap.rgb);\n#else\nfinalColor.a*=opacityMap.a;\n#endif\nfinalColor.a*=opacityIntensity;\n#endif\n#ifdef VERTEXALPHA\nfinalColor.a*=vColor.a;\n#endif\n#ifdef ALPHATEST\nif (finalColor.a<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;\n#else\ngl_FragColor=finalColor;\n#endif\n}",zt.a.ShadersStore.glowMapGenerationVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform mat4 opacityMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef VERTEXALPHA\nattribute vec4 color;\nvarying vec4 vColor;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(positionUpdated,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef DIFFUSE\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef OPACITY\n#ifdef OPACITYUV1\nvUVOpacity=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef OPACITYUV2\nvUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef VERTEXALPHA\nvColor=color;\n#endif\n}";var Rr=function(){function e(t,n){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new o.f},this.neutralColor=new o.f,this.isEnabled=!0,this.onDisposeObservable=new r.c,this.onBeforeRenderMainTextureObservable=new r.c,this.onBeforeComposeObservable=new r.c,this.onAfterComposeObservable=new r.c,this.onSizeChangedObservable=new r.c,this.name=t,this._scene=n||A.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),e.prototype._init=function(e){this._effectLayerOptions=c.a({mainTextureRatio:.5,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},e),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)},e.prototype._generateVertexBuffer=function(){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);var t=new Cn.b(this._engine,e,Cn.b.PositionKind,!1,!1,2);this._vertexBuffers[Cn.b.PositionKind]=t},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?be.h.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?be.h.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var e=this;this._mainTexture=new cn("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(t,n,i,r){var o;e.onBeforeRenderMainTextureObservable.notifyObservers(e);var a=e._scene.getEngine();if(r.length){for(a.setColorWrite(!1),o=0;o<r.length;o++)e._renderSubMesh(r.data[o]);a.setColorWrite(!0)}for(o=0;o<t.length;o++)e._renderSubMesh(t.data[o]);for(o=0;o<n.length;o++)e._renderSubMesh(n.data[o]);var s=a.getAlphaMode();for(o=0;o<i.length;o++)e._renderSubMesh(i.data[o],!0);a.setAlphaMode(s)},this._mainTexture.onClearObservable.add(function(t){t.clear(e.neutralColor,!0,!0,!0)})},e.prototype._addCustomEffectDefines=function(e){},e.prototype._isReady=function(e,t,n){var i=e.getMaterial();if(!i)return!1;if(!i.isReadyForSubMesh(e.getMesh(),e,t))return!1;var r=[],o=[Cn.b.PositionKind],a=e.getMesh(),s=!1,l=!1;if(i){var c=i.needAlphaTesting(),u=i.getAlphaTestTexture();u&&(c||u&&u.hasAlpha&&(i.useAlphaFromDiffuseTexture||i._useAlphaFromAlbedoTexture))&&(r.push("#define DIFFUSE"),a.isVerticesDataPresent(Cn.b.UV2Kind)&&1===u.coordinatesIndex?(r.push("#define DIFFUSEUV2"),l=!0):a.isVerticesDataPresent(Cn.b.UVKind)&&(r.push("#define DIFFUSEUV1"),s=!0),c&&(r.push("#define ALPHATEST"),r.push("#define ALPHATESTVALUE 0.4")));var h=i.opacityTexture;h&&(r.push("#define OPACITY"),a.isVerticesDataPresent(Cn.b.UV2Kind)&&1===h.coordinatesIndex?(r.push("#define OPACITYUV2"),l=!0):a.isVerticesDataPresent(Cn.b.UVKind)&&(r.push("#define OPACITYUV1"),s=!0))}n&&(r.push("#define EMISSIVE"),a.isVerticesDataPresent(Cn.b.UV2Kind)&&1===n.coordinatesIndex?(r.push("#define EMISSIVEUV2"),l=!0):a.isVerticesDataPresent(Cn.b.UVKind)&&(r.push("#define EMISSIVEUV1"),s=!0)),a.isVerticesDataPresent(Cn.b.ColorKind)&&a.hasVertexAlpha&&(o.push(Cn.b.ColorKind),r.push("#define VERTEXALPHA")),s&&(o.push(Cn.b.UVKind),r.push("#define UV1")),l&&(o.push(Cn.b.UV2Kind),r.push("#define UV2")),a.useBones&&a.computeBonesUsingShaders?(o.push(Cn.b.MatricesIndicesKind),o.push(Cn.b.MatricesWeightsKind),a.numBoneInfluencers>4&&(o.push(Cn.b.MatricesIndicesExtraKind),o.push(Cn.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),r.push("#define BonesPerMesh "+(a.skeleton?a.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0");var d=a.morphTargetManager,f=0;d&&d.numInfluencers>0&&(r.push("#define MORPHTARGETS"),r.push("#define NUM_MORPH_INFLUENCERS "+(f=d.numInfluencers)),Wi.a.PrepareAttributesForMorphTargets(o,a,{NUM_MORPH_INFLUENCERS:f})),t&&(r.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3")),this._addCustomEffectDefines(r);var p=r.join("\n");return this._cachedDefines!==p&&(this._cachedDefines=p,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",o,["world","mBones","viewProjection","glowColor","morphTargetInfluences","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler"],p,void 0,void 0,void 0,{maxSimultaneousMorphTargets:f})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var e=this._mergeEffect;if(e.isReady()){for(var t=0;t<this._postProcesses.length;t++)if(!this._postProcesses[t].isReady())return;var n=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),n.enableEffect(e),n.setState(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,e);var i=n.getAlphaMode();n.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(e),n.setAlphaMode(i),this.onAfterComposeObservable.notifyObservers(this);var r=this._mainTexture.getSize();this._setMainTextureSize(),r.width===this._mainTextureDesiredSize.width&&r.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(e){return-1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(e){return!0},e.prototype._canRenderMesh=function(e,t){return!t.needAlphaBlendingForMesh(e)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(e,t){var n=this;if(void 0===t&&(t=!1),this.shouldRender()){var i=e.getMaterial(),r=e.getRenderingMesh(),o=this._scene,a=o.getEngine();if(r._internalAbstractMeshDataInfo._isActiveIntermediate=!1,i&&this._canRenderMesh(r,i)){a.setState(i.backFaceCulling);var s=r._getInstancesRenderList(e._id);if(!s.mustReturn&&this._shouldRenderMesh(r)){var l=s.hardwareInstancedRendering[e._id];if(this._setEmissiveTextureAndColor(r,e,i),this._isReady(e,l,this._emissiveTextureAndColor.texture)){a.enableEffect(this._effectLayerMapGenerationEffect),r._bind(e,this._effectLayerMapGenerationEffect,Pr.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var c=i.needAlphaTesting(),u=i.getAlphaTestTexture();u&&(c||u&&u.hasAlpha&&(i.useAlphaFromDiffuseTexture||i._useAlphaFromAlbedoTexture))&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",u),(h=u.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",h));var h,d=i.opacityTexture;d&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",d),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",d.level),(h=d.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",h)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),r.useBones&&r.computeBonesUsingShaders&&r.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",r.skeleton.getTransformMatrices(r)),Wi.a.BindMorphTargetParameters(r,this._effectLayerMapGenerationEffect),t&&a.setAlphaMode(i.alphaMode),r._processRendering(e,this._effectLayerMapGenerationEffect,Pr.a.TriangleFillMode,s,l,function(e,t){return n._effectLayerMapGenerationEffect.setMatrix("world",t)})}else this._mainTexture.resetRefreshCounter()}}}},e.prototype._rebuild=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();for(this._postProcesses=[],e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]},e.prototype.dispose=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Cn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var t=this._scene.effectLayers.indexOf(this,0);t>-1&&this._scene.effectLayers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(e,t,n){return be.h.Instantiate(e.customType).Parse(e,t,n)},e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("EffectLayerSceneComponent")},c.c([Object(D.c)()],e.prototype,"name",void 0),c.c([Object(D.f)()],e.prototype,"neutralColor",void 0),c.c([Object(D.c)()],e.prototype,"isEnabled",void 0),c.c([Object(D.d)()],e.prototype,"camera",null),c.c([Object(D.c)()],e.prototype,"renderingGroupId",null),e}();i.a.AddParser(xe.a.NAME_EFFECTLAYER,function(e,t,n,i){if(e.effectLayers){n.effectLayers||(n.effectLayers=new Array);for(var r=0;r<e.effectLayers.length;r++){var o=Rr.Parse(e.effectLayers[r],t,i);n.effectLayers.push(o)}}}),i.a.prototype.removeEffectLayer=function(e){var t=this.effectLayers.indexOf(e);return-1!==t&&this.effectLayers.splice(t,1),t},i.a.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var Mr=function(){function e(e){this.name=xe.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e,this._engine=e.getEngine(),e.effectLayers=new Array}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(xe.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(xe.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(xe.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(xe.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(xe.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(xe.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.effectLayers;e<t.length;e++)t[e]._rebuild()},e.prototype.serialize=function(e){e.effectLayers=[];for(var t=0,n=this.scene.effectLayers;t<n.length;t++){var i=n[t];i.serialize&&e.effectLayers.push(i.serialize())}},e.prototype.addFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach(function(e){t.scene.addEffectLayer(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;e.effectLayers&&e.effectLayers.forEach(function(e){n.scene.removeEffectLayer(e),t&&e.dispose()})},e.prototype.dispose=function(){for(var e=this.scene.effectLayers;e.length;)e[0].dispose()},e.prototype._isReadyForMesh=function(e,t){for(var n=0,i=this.scene.effectLayers;n<i.length;n++){var r=i[n];if(r.hasMesh(e))for(var o=0,a=e.subMeshes;o<a.length;o++)if(!r.isReady(a[o],t))return!1}return!0},e.prototype._renderMainTexture=function(e){this._renderEffects=!1,this._needStencil=!1;var t=!1,n=this.scene.effectLayers;if(n&&n.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var i=0,r=n;i<r.length;i++){var o=r[i];if(o.shouldRender()&&(!o.camera||o.camera.cameraRigMode===Ne.a.RIG_MODE_NONE&&e===o.camera||o.camera.cameraRigMode!==Ne.a.RIG_MODE_NONE&&o.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||o.needStencil();var a=o._mainTexture;a._shouldRender()&&(this.scene.incrementRenderId(),a.render(!1,!1),t=!0)}}this.scene.incrementRenderId()}return t},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var t=this.scene.effectLayers,n=0;n<t.length;n++){var i=t[n];i.renderingGroupId===e&&i.shouldRender()&&i.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)},e}();Rr._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_EFFECTLAYER);t||(t=new Mr(e),e._addComponent(t))},zt.a.ShadersStore.glowMapMergePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#ifdef EMISSIVE\nuniform sampler2D textureSampler2;\n#endif\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef EMISSIVE\nbaseColor+=texture2D(textureSampler2,vUV);\nbaseColor*=offset;\n#else\nbaseColor.a=abs(offset-baseColor.a);\n#ifdef STROKE\nfloat alpha=smoothstep(.0,.1,baseColor.a);\nbaseColor.a=alpha;\nbaseColor.rgb=baseColor.rgb*alpha;\n#endif\n#endif\ngl_FragColor=baseColor;\n}",zt.a.ShadersStore.glowMapMergeVertexShader="\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",i.a.prototype.getGlowLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===Or.EffectName)return this.effectLayers[t];return null};var Or=function(e){function t(n,i,r){var a=e.call(this,n,i)||this;return a._intensity=1,a._includedOnlyMeshes=[],a._excludedMeshes=[],a.neutralColor=new o.f(0,0,0,1),a._options=c.a({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},r),a._init({alphaBlendingMode:g.a.ALPHA_ADD,camera:a._options.camera,mainTextureFixedSize:a._options.mainTextureFixedSize,mainTextureRatio:a._options.mainTextureRatio,renderingGroupId:a._options.renderingGroupId}),a}return c.d(t,e),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Cn.b.PositionKind],["offset"],["textureSampler","textureSampler2"],"#define EMISSIVE \n")},t.prototype._createTextureAndPostProcesses=function(){var e,t=this,n=this._mainTextureDesiredSize.width,i=this._mainTextureDesiredSize.height;n=this._engine.needPOTTextures?be.h.GetExponentOfTwo(n,this._maxSize):n,i=this._engine.needPOTTextures?be.h.GetExponentOfTwo(i,this._maxSize):i,e=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new cn("GlowLayerBlurRTT",{width:n,height:i},this._scene,!1,!0,e),this._blurTexture1.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var r=Math.floor(n/2),a=Math.floor(i/2);this._blurTexture2=new cn("GlowLayerBlurRTT2",{width:r,height:a},this._scene,!1,!0,e),this._blurTexture2.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new zi("GlowLayerHBP1",new o.w(1,0),this._options.blurKernelSize/2,{width:n,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._horizontalBlurPostprocess1.width=n,this._horizontalBlurPostprocess1.height=i,this._horizontalBlurPostprocess1.onApplyObservable.add(function(e){e.setTexture("textureSampler",t._mainTexture)}),this._verticalBlurPostprocess1=new zi("GlowLayerVBP1",new o.w(0,1),this._options.blurKernelSize/2,{width:n,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._horizontalBlurPostprocess2=new zi("GlowLayerHBP2",new o.w(1,0),this._options.blurKernelSize/2,{width:r,height:a},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._horizontalBlurPostprocess2.width=r,this._horizontalBlurPostprocess2.height=a,this._horizontalBlurPostprocess2.onApplyObservable.add(function(e){e.setTexture("textureSampler",t._blurTexture1)}),this._verticalBlurPostprocess2=new zi("GlowLayerVBP2",new o.w(0,1),this._options.blurKernelSize/2,{width:r,height:a},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var e=t._blurTexture1.getInternalTexture();e&&(t._scene.postProcessManager.directRender(t._postProcesses1,e,!0),(e=t._blurTexture2.getInternalTexture())&&t._scene.postProcessManager.directRender(t._postProcesses2,e,!0))}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.isReady=function(t,n){var i=t.getMaterial(),r=t.getRenderingMesh();return!(!i||!r)&&e.prototype._isReady.call(this,t,n,i.emissiveTexture)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,t){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var t=this._engine,n=t.getStencilBuffer();t.setStencilBuffer(!1),t.drawElementsType(Pr.a.TriangleFillMode,0,6),t.setStencilBuffer(n)},t.prototype._setEmissiveTextureAndColor=function(e,t,n){var i=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,n):n?(this._emissiveTextureAndColor.texture=n.emissiveTexture,this._emissiveTextureAndColor.texture&&(i=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,t,n,this._emissiveTextureAndColor.color):n.emissiveColor?this._emissiveTextureAndColor.color.set(n.emissiveColor.r*i,n.emissiveColor.g*i,n.emissiveColor.b*i,n.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)},t.prototype.addIncludedOnlyMesh=function(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)},t.prototype.hasMesh=function(t){return!!e.prototype.hasMesh.call(this,t)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(t.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(t.uniqueId))},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,t=D.a.Serialize(this);if(t.customType="BABYLON.GlowLayer",t.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++)(n=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&t.includedMeshes.push(n.id);if(t.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var n;(n=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&t.excludedMeshes.push(n.id)}return t},t.Parse=function(e,n,i){var r,o=D.a.Parse(function(){return new t(e.name,n,e.options)},e,n,i);for(r=0;r<e.excludedMeshes.length;r++)(a=n.getMeshByID(e.excludedMeshes[r]))&&o.addExcludedMesh(a);for(r=0;r<e.includedMeshes.length;r++){var a;(a=n.getMeshByID(e.includedMeshes[r]))&&o.addIncludedOnlyMesh(a)}return o},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,c.c([Object(D.c)()],t.prototype,"blurKernelSize",null),c.c([Object(D.c)()],t.prototype,"intensity",null),c.c([Object(D.c)("options")],t.prototype,"_options",void 0),t}(Rr);a.a.RegisteredTypes["BABYLON.GlowLayer"]=Or,zt.a.ShadersStore.glowBlurPostProcessPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",i.a.prototype.getHighlightLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===Ir.EffectName)return this.effectLayers[t];return null};var wr=function(e){function t(t,n,i,r,o,a,s,l){void 0===a&&(a=Ge.a.BILINEAR_SAMPLINGMODE);var c=e.call(this,t,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,r,o,a,s,l)||this;return c.direction=n,c.kernel=i,c.onApplyObservable.add(function(e){e.setFloat2("screenSize",c.width,c.height),e.setVector2("direction",c.direction),e.setFloat("blurWidth",c.kernel)}),c}return c.d(t,e),t}(jt),Ir=function(e){function t(n,i,o){var a=e.call(this,n,i)||this;return a.name=n,a.innerGlow=!0,a.outerGlow=!0,a.onBeforeBlurObservable=new r.c,a.onAfterBlurObservable=new r.c,a._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,a._meshes={},a._excludedMeshes={},a.neutralColor=t.NeutralColor,a._engine.isStencilEnable||p.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),a._options=c.a({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:g.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},o),a._init({alphaBlendingMode:a._options.alphaBlendingMode,camera:a._options.camera,mainTextureFixedSize:a._options.mainTextureFixedSize,mainTextureRatio:a._options.mainTextureRatio,renderingGroupId:a._options.renderingGroupId}),a._shouldRender=!1,a}return c.d(t,e),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Cn.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},t.prototype._createTextureAndPostProcesses=function(){var e,t=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,i=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?be.h.GetExponentOfTwo(n,this._maxSize):n,i=this._engine.needPOTTextures?be.h.GetExponentOfTwo(i,this._maxSize):i,e=this._engine.getCaps().textureHalfFloatRender?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new cn("HighlightLayerBlurRTT",{width:n,height:i},this._scene,!1,!0,e),this._blurTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(Ge.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===g.a.ALPHA_COMBINE?(this._downSamplePostprocess=new Ht("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(e){e.setTexture("textureSampler",t._mainTexture)}),this._horizontalBlurPostprocess=new wr("HighlightLayerHBP",new o.w(1,0),this._options.blurHorizontalSize,1,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,i)}),this._verticalBlurPostprocess=new wr("HighlightLayerVBP",new o.w(0,1),this._options.blurVerticalSize,1,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,i)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new zi("HighlightLayerHBP",new o.w(1,0),this._options.blurHorizontalSize/2,{width:n,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._horizontalBlurPostprocess.width=n,this._horizontalBlurPostprocess.height=i,this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setTexture("textureSampler",t._mainTexture)}),this._verticalBlurPostprocess=new zi("HighlightLayerVBP",new o.w(0,1),this._options.blurVerticalSize/2,{width:n,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){t.onBeforeBlurObservable.notifyObservers(t);var e=t._blurTexture.getInternalTexture();e&&t._scene.postProcessManager.directRender(t._postProcesses,e,!0),t.onAfterBlurObservable.notifyObservers(t)}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(t,n){var i=t.getMaterial(),r=t.getRenderingMesh();if(!i||!r||!this._meshes)return!1;var o=null,a=this._meshes[r.uniqueId];return a&&a.glowEmissiveOnly&&i&&(o=i.emissiveTexture),e.prototype._isReady.call(this,t,n,o)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var t=this._engine;t.cacheStencilState(),t.setStencilOperationPass(g.a.REPLACE),t.setStencilOperationFail(g.a.KEEP),t.setStencilOperationDepthFail(g.a.KEEP),t.setStencilMask(0),t.setStencilBuffer(!0),t.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),t.setStencilFunction(g.a.NOTEQUAL),t.drawElementsType(Pr.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),t.setStencilFunction(g.a.EQUAL),t.drawElementsType(Pr.a.TriangleFillMode,0,6)),t.restoreStencilState()},t.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(t){return!(this._excludedMeshes&&this._excludedMeshes[t.uniqueId]||!e.prototype.hasMesh.call(this,t))},t.prototype._setEmissiveTextureAndColor=function(e,t,n){var i=this._meshes[e.uniqueId];i?this._emissiveTextureAndColor.color.set(i.color.r,i.color.g,i.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),i&&i.glowEmissiveOnly&&n?(this._emissiveTextureAndColor.texture=n.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add(function(e){e.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[e.uniqueId];t&&(t.beforeBind&&e.onBeforeBindObservable.remove(t.beforeBind),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(t){return!!this._meshes&&!!e.prototype.hasMesh.call(this,t)&&null!=this._meshes[t.uniqueId]},t.prototype.addMesh=function(e,t,n){var i=this;if(void 0===n&&(n=!1),this._meshes){var r=this._meshes[e.uniqueId];r?r.color=t:(this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeBindObservable.add(function(e){i._excludedMeshes&&i._excludedMeshes[e.uniqueId]?i._defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(i._instanceGlowingMeshStencilReference)}),observerDefault:e.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:n},e.onDisposeObservable.add(function(){i._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[e.uniqueId];for(var n in t&&(t.observerHighlight&&e.onBeforeBindObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[n]){this._shouldRender=!0;break}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var t in this._meshes)(n=this._meshes[t])&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var t in this._excludedMeshes){var n;(n=this._excludedMeshes[t])&&(n.beforeBind&&n.mesh.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=D.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var t in this._meshes){var n=this._meshes[t];n&&e.meshes.push({glowEmissiveOnly:n.glowEmissiveOnly,color:n.color.asArray(),meshId:n.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var i in this._excludedMeshes){var r=this._excludedMeshes[i];r&&e.excludedMeshes.push(r.mesh.id)}return e},t.Parse=function(e,n,i){var r,a=D.a.Parse(function(){return new t(e.name,n,e.options)},e,n,i);for(r=0;r<e.excludedMeshes.length;r++)(s=n.getMeshByID(e.excludedMeshes[r]))&&a.addExcludedMesh(s);for(r=0;r<e.meshes.length;r++){var s,l=e.meshes[r];(s=n.getMeshByID(l.meshId))&&a.addMesh(s,o.e.FromArray(l.color),l.glowEmissiveOnly)}return a},t.EffectName="HighlightLayer",t.NeutralColor=new o.f(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,c.c([Object(D.c)()],t.prototype,"innerGlow",void 0),c.c([Object(D.c)()],t.prototype,"outerGlow",void 0),c.c([Object(D.c)()],t.prototype,"blurHorizontalSize",null),c.c([Object(D.c)()],t.prototype,"blurVerticalSize",null),c.c([Object(D.c)("options")],t.prototype,"_options",void 0),t}(Rr);a.a.RegisteredTypes["BABYLON.HighlightLayer"]=Ir;var Dr=function(){function e(e){this.name=xe.a.NAME_LAYER,this.scene=e,this._engine=e.getEngine(),e.layers=new Array}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(xe.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(xe.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(xe.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(xe.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++)t[e]._rebuild()},e.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},e.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var n=0,i=t;n<i.length;n++){var r=i[n];e(r)&&r.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(e,t,n){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&n)},e.prototype._drawCameraBackground=function(e){var t=this;this._draw(function(n){return t._drawCameraPredicate(n,!0,e.layerMask)})},e.prototype._drawCameraForeground=function(e){var t=this;this._draw(function(n){return t._drawCameraPredicate(n,!1,e.layerMask)})},e.prototype._drawRenderTargetPredicate=function(e,t,n,i){return e.renderTargetTextures.length>0&&e.isBackground===t&&e.renderTargetTextures.indexOf(i)>-1&&0!=(e.layerMask&n)},e.prototype._drawRenderTargetBackground=function(e){var t=this;this._draw(function(n){return t._drawRenderTargetPredicate(n,!0,t.scene.activeCamera.layerMask,e)})},e.prototype._drawRenderTargetForeground=function(e){var t=this;this._draw(function(n){return t._drawRenderTargetPredicate(n,!1,t.scene.activeCamera.layerMask,e)})},e}();zt.a.ShadersStore.layerPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",zt.a.ShadersStore.layerVertexShader="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";var Lr=function(){function e(e,t,n,i,a){this.name=e,this.scale=new o.w(1,1),this.offset=new o.w(0,0),this.alphaBlendingMode=g.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new r.c,this.onBeforeRenderObservable=new r.c,this.onAfterRenderObservable=new r.c,this.texture=t?new Ge.a(t,n,!0):null,this.isBackground=void 0===i||i,this.color=void 0===a?new o.f(1,1,1,1):a,this._scene=n||A.a.LastCreatedScene;var s=this._scene._getComponent(xe.a.NAME_LAYER);s||(s=new Dr(this._scene),this._scene._addComponent(s)),this._scene.layers.push(this);var l=this._scene.getEngine(),c=[];c.push(1,1),c.push(-1,1),c.push(-1,-1),c.push(1,-1);var u=new Cn.b(l,c,Cn.b.PositionKind,!1,!1,2);this._vertexBuffers[Cn.b.PositionKind]=u,this._createIndexBuffer(),this._effect=l.createEffect("layer",[Cn.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=l.createEffect("layer",[Cn.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},e.prototype._rebuild=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){var t=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(e),t.setState(!1),e.setTexture("textureSampler",this.texture),e.setMatrix("textureMatrix",this.texture.getTextureMatrix()),e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),e.setVector2("offset",this.offset),e.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,e),this.alphaTest?t.drawElementsType(Pr.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(Pr.a.TriangleFillMode,0,6),t.setAlphaMode(g.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},e.prototype.dispose=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Cn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}(),kr=function(){function e(e,t,n,i,r){this.size=e,this.position=t,this.alphaMode=g.a.ALPHA_ONEONE,this.color=n||new o.e(1,1,1),this.texture=i?new Ge.a(i,r.getScene(),!0):null,this._system=r,r.lensFlares.push(this)}return e.AddFlare=function(t,n,i,r,o){return new e(t,n,i,r,o)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},e}();zt.a.ShadersStore.lensFlarePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",zt.a.ShadersStore.lensFlareVertexShader="\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}";var Nr=function(){function e(t,n,i){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=i||A.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=n,this.id=t,i.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return i.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&i.activeCamera.layerMask)};var r=i.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[Cn.b.PositionKind]=new Cn.b(r,o,Cn.b.PositionKind,!1,!1,2);var a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=r.createIndexBuffer(a),this._effect=r.createEffect("lensFlare",[Cn.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(e){this._emitter=e},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(e){var t=this.getEmitterPosition();return t=o.x.Project(t,o.j.Identity(),this._scene.getTransformMatrix(),e),this._positionX=t.x,this._positionY=t.y,t=o.x.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(e.x-=this.viewportBorder,e.y-=this.viewportBorder,e.width+=2*this.viewportBorder,e.height+=2*this.viewportBorder,t.x+=this.viewportBorder,t.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),t.z>0&&!0},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var e=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),t=e.length();e.normalize();var n=new wt.a(this._scene.activeCamera.globalPosition,e),i=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!i||!i.hit||i.distance>t},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var e,t,n=this._scene.getEngine(),i=this._scene.activeCamera.viewport.toGlobal(n.getRenderWidth(!0),n.getRenderHeight(!0));if(!this.computeEffectivePosition(i))return!1;if(!this._isVisible())return!1;var r=(e=this._positionX<this.borderLimit+i.x?this.borderLimit+i.x-this._positionX:this._positionX>i.x+i.width-this.borderLimit?this._positionX-i.x-i.width+this.borderLimit:0)>(t=this._positionY<this.borderLimit+i.y?this.borderLimit+i.y-this._positionY:this._positionY>i.y+i.height-this.borderLimit?this._positionY-i.y-i.height+this.borderLimit:0)?e:t;(r-=this.viewportBorder)>this.borderLimit&&(r=this.borderLimit);var a=1-I.a.Clamp(r/this.borderLimit,0,1);if(a<0)return!1;a>1&&(a=1),this.viewportBorder>0&&(i.x+=this.viewportBorder,i.y+=this.viewportBorder,i.width-=2*this.viewportBorder,i.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var s=i.x+i.width/2,l=i.y+i.height/2,c=s-this._positionX,u=l-this._positionY;n.enableEffect(this._effect),n.setState(!1),n.setDepthBuffer(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var h=0;h<this.lensFlares.length;h++){var d=this.lensFlares[h];n.setAlphaMode(d.alphaMode);var f=s-c*d.position,p=l-u*d.position,m=d.size,_=d.size*n.getAspectRatio(this._scene.activeCamera,!0),v=o.j.FromValues(m/2,0,0,0,0,_/2,0,0,0,0,1,0,f/(i.width+2*i.x)*2-1,1-p/(i.height+2*i.y)*2,0,1);this._effect.setMatrix("viewportMatrix",v),this._effect.setTexture("textureSampler",d.texture),this._effect.setFloat4("color",d.color.r*a,d.color.g*a,d.color.b*a,1),n.drawElementsType(Pr.a.TriangleFillMode,0,6)}return n.setDepthBuffer(!0),n.setAlphaMode(g.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var e=this._vertexBuffers[Cn.b.PositionKind];for(e&&(e.dispose(),this._vertexBuffers[Cn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var t=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(t,1)},e.Parse=function(t,n,i){var r=n.getLastEntryByID(t.emitterId),a=t.name||"lensFlareSystem#"+t.emitterId,s=new e(a,r,n);s.id=t.id||a,s.borderLimit=t.borderLimit;for(var l=0;l<t.flares.length;l++){var c=t.flares[l];kr.AddFlare(c.size,c.position,o.e.FromArray(c.color),c.textureName?i+c.textureName:"",s)}return s},e.prototype.serialize=function(){var e={};e.id=this.id,e.name=this.name,e.emitterId=this.getEmitter().id,e.borderLimit=this.borderLimit,e.flares=[];for(var t=0;t<this.lensFlares.length;t++){var n=this.lensFlares[t];e.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:be.h.GetFilename(n.texture?n.texture.name:"")})}return e},e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("LensFlareSystemSceneComponent")},e}();i.a.AddParser(xe.a.NAME_LENSFLARESYSTEM,function(e,t,n,i){if(null!=e.lensFlareSystems){n.lensFlareSystems||(n.lensFlareSystems=new Array);for(var r=0,o=e.lensFlareSystems.length;r<o;r++){var a=Nr.Parse(e.lensFlareSystems[r],t,i);n.lensFlareSystems.push(a)}}}),i.a.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},i.a.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},i.a.prototype.removeLensFlareSystem=function(e){var t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},i.a.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var Fr=function(){function e(e){this.name=xe.a.NAME_LENSFLARESYSTEM,this.scene=e,e.lensFlareSystems=new Array}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(xe.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){t.scene.addLensFlareSystem(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){n.scene.removeLensFlareSystem(e),t&&e.dispose()})},e.prototype.serialize=function(e){e.lensFlareSystems=[];for(var t=0,n=this.scene.lensFlareSystems;t<n.length;t++)e.lensFlareSystems.push(n[t].serialize())},e.prototype.dispose=function(){for(var e=this.scene.lensFlareSystems;e.length;)e[0].dispose()},e.prototype._draw=function(e){if(this.scene.lensFlaresEnabled){var t=this.scene.lensFlareSystems;be.h.StartPerformanceCounter("Lens flares",t.length>0);for(var n=0,i=t;n<i.length;n++){var r=i[n];0!=(e.layerMask&r.layerMask)&&r.render()}be.h.EndPerformanceCounter("Lens flares",t.length>0)}},e}();Nr._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_LENSFLARESYSTEM);t||(t=new Fr(e),e._addComponent(t))},zt.a.ShadersStore.shadowMapPixelShader="#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",zt.a.ShadersStore.shadowMapVertexShader="\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",zt.a.ShadersStore.depthBoxBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";var Br=function(){function e(t,n,i){this.onBeforeShadowMapRenderObservable=new r.c,this.onBeforeShadowMapRenderMeshObservable=new r.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=o.x.Zero(),this._viewMatrix=o.j.Zero(),this._projectionMatrix=o.j.Zero(),this._transformMatrix=o.j.Zero(),this._cachedPosition=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=o.j.Identity(),this._mapSize=t,this._light=n,this._scene=n.getScene(),n._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var a=this._scene.getEngine().getCaps();this._textureType=i?a.textureFloatRender&&a.textureFloatLinearFiltering?g.a.TEXTURETYPE_FLOAT:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?g.a.TEXTURETYPE_HALF_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?g.a.TEXTURETYPE_HALF_FLOAT:a.textureFloatRender&&a.textureFloatLinearFiltering?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(t){if(this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(t){(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?e.FILTER_POISSONSAMPLING:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_EXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLUREXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_CLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(t){(t||this.filter===e.FILTER_PCF)&&(this.filter=t?e.FILTER_PCF:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(t){(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?e.FILTER_PCSS:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},e.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.addShadowCaster=function(e,t){var n;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(n=this._shadowMap.renderList).push.apply(n,e.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var n=this._shadowMap.renderList.indexOf(e);if(-1!==n&&this._shadowMap.renderList.splice(n,1),t)for(var i=0,r=e.getChildren();i<r.length;i++)this.removeShadowCaster(r[i]);return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._initializeShadowMap=function(){var t=this,n=this._scene.getEngine();n.webGLVersion>1?(this._shadowMap=new cn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(g.a.LESS,!0)):this._shadowMap=new cn(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(i){t._currentFaceIndex=i,t._filter===e.FILTER_PCF&&n.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._filter===e.FILTER_PCF&&n.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var i=t.getShadowMapForRendering();i&&t._scene.postProcessManager.directRender(t._blurPostProcesses,i.getInternalTexture(),!0)}});var i=new o.f(0,0,0,0),r=new o.f(1,1,1,1);this._shadowMap.onClearObservable.add(function(n){t._filter===e.FILTER_PCF?n.clear(r,!1,!0,!1):n.clear(t.useExponentialShadowMap||t.useBlurExponentialShadowMap?i:r,!0,!0,!1)})},e.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,t=this._scene.getEngine(),n=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new cn(this._light.name+"_shadowMap2",n,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new zi(this._light.name+"KernelBlurX",new o.w(1,0),this.blurKernel,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.width=n,this._kernelBlurXPostprocess.height=n,this._kernelBlurXPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._shadowMap)}),this._kernelBlurYPostprocess=new zi(this._light.name+"KernelBlurY",new o.w(0,1),this.blurKernel,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===g.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new jt(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(t){t.setFloat2("screenSize",n,n),t.setTexture("textureSampler",e._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(e,t,n,i){var r,o=this._scene.getEngine();if(i.length){for(o.setColorWrite(!1),r=0;r<i.length;r++)this._renderSubMeshForShadowMap(i.data[r]);o.setColorWrite(!0)}for(r=0;r<e.length;r++)this._renderSubMeshForShadowMap(e.data[r]);for(r=0;r<t.length;r++)this._renderSubMeshForShadowMap(t.data[r]);if(this._transparencyShadow)for(r=0;r<n.length;r++)this._renderSubMeshForShadowMap(n.data[r])},e.prototype._renderSubMeshForShadowMap=function(e){var t=this,n=e.getRenderingMesh(),i=this._scene,r=i.getEngine(),o=e.getMaterial();if(n._internalAbstractMeshDataInfo._isActiveIntermediate=!1,o&&0!==e.verticesCount){r.setState(o.backFaceCulling);var a=n._getInstancesRenderList(e._id);if(!a.mustReturn){var s=r.getCaps().instancedArrays&&null!=a.visibleInstances[e._id];if(this.isReady(e,s)){if(r.enableEffect(this._effect),n._bind(e,this._effect,Pr.a.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===ki.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),i.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(i.activeCamera),this.getLight().getDepthMinZ(i.activeCamera)+this.getLight().getDepthMaxZ(i.activeCamera)),o&&o.needAlphaTesting()){var l=o.getAlphaTestTexture();l&&(this._effect.setTexture("diffuseSampler",l),this._effect.setMatrix("diffuseMatrix",l.getTextureMatrix()||this._defaultTextureMatrix))}if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){var c=n.skeleton;if(c.isUsingTextureForMatrices){var u=c.getTransformMatrixTexture();if(!u)return;this._effect.setTexture("boneSampler",u),this._effect.setFloat("boneTextureWidth",4*(c.bones.length+1))}else this._effect.setMatrices("mBones",c.getTransformMatrices(n))}Wi.a.BindMorphTargetParameters(n,this._effect),this.forceBackFacesOnly&&r.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(n),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),n._processRendering(e,this._effect,Pr.a.TriangleFillMode,a,s,function(e,n){return t._effect.setMatrix("world",n)}),this.forceBackFacesOnly&&r.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&this._shadowMap.updateSamplingMode(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?Ge.a.NEAREST_SAMPLINGMODE:Ge.a.BILINEAR_SAMPLINGMODE)},e.prototype.forceCompilation=function(e,t){var n=this,i=c.a({useInstances:!1},t),r=this.getShadowMap();if(r){var o=r.renderList;if(o){for(var a=new Array,s=0,l=o;s<l.length;s++)a.push.apply(a,l[s].subMeshes);if(0!==a.length){var u=0,h=function(){if(n._scene&&n._scene.getEngine()){for(;n.isReady(a[u],i.useInstances);)if(++u>=a.length)return void(e&&e(n));setTimeout(h,16)}};h()}else e&&e(this)}else e&&e(this)}else e&&e(this)},e.prototype.forceCompilationAsync=function(e){var t=this;return new Promise(function(n){t.forceCompilation(function(){n()},e)})},e.prototype.isReady=function(e,t){var n=[];this._textureType!==g.a.TEXTURETYPE_UNSIGNED_INT&&n.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?n.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&n.push("#define DEPTHTEXTURE");var i=[Cn.b.PositionKind],r=e.getMesh(),o=e.getMaterial();if(this.normalBias&&r.isVerticesDataPresent(Cn.b.NormalKind)&&(i.push(Cn.b.NormalKind),n.push("#define NORMAL"),r.nonUniformScaling&&n.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===ki.a.LIGHTTYPEID_DIRECTIONALLIGHT&&n.push("#define DIRECTIONINLIGHTDATA")),o&&o.needAlphaTesting()){var a=o.getAlphaTestTexture();a&&(n.push("#define ALPHATEST"),r.isVerticesDataPresent(Cn.b.UVKind)&&(i.push(Cn.b.UVKind),n.push("#define UV1")),r.isVerticesDataPresent(Cn.b.UV2Kind)&&1===a.coordinatesIndex&&(i.push(Cn.b.UV2Kind),n.push("#define UV2")))}if(r.useBones&&r.computeBonesUsingShaders&&r.skeleton){i.push(Cn.b.MatricesIndicesKind),i.push(Cn.b.MatricesWeightsKind),r.numBoneInfluencers>4&&(i.push(Cn.b.MatricesIndicesExtraKind),i.push(Cn.b.MatricesWeightsExtraKind));var s=r.skeleton;n.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),n.push(s.isUsingTextureForMatrices?"#define BONETEXTURE":"#define BonesPerMesh "+(s.bones.length+1))}else n.push("#define NUM_BONE_INFLUENCERS 0");var l=r.morphTargetManager,c=0;if(l&&l.numInfluencers>0&&(n.push("#define MORPHTARGETS"),n.push("#define NUM_MORPH_INFLUENCERS "+(c=l.numInfluencers)),Wi.a.PrepareAttributesForMorphTargets(i,r,{NUM_MORPH_INFLUENCERS:c})),t&&(n.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3")),this.customShaderOptions&&this.customShaderOptions.defines)for(var u=0,h=this.customShaderOptions.defines;u<h.length;u++){var d=h[u];-1===n.indexOf(d)&&n.push(d)}var f=n.join("\n");if(this._cachedDefines!==f){this._cachedDefines=f;var p="shadowMap",m=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth"],_=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(p=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var v=0,b=this.customShaderOptions.attributes;v<b.length;v++){var y=b[v];-1===i.indexOf(y)&&i.push(y)}if(this.customShaderOptions.uniforms)for(var T=0,E=this.customShaderOptions.uniforms;T<E.length;T++){var x=E[T];-1===m.indexOf(x)&&m.push(x)}if(this.customShaderOptions.samplers)for(var C=0,S=this.customShaderOptions.samplers;C<S.length;C++){var A=S[C];-1===_.indexOf(A)&&_.push(A)}}this._effect=this._scene.getEngine().createEffect(p,i,m,_,f,void 0,void 0,void 0,{maxSimultaneousMorphTargets:c})}return!(!this._effect.isReady()||((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady()||this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()||this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))},e.prototype.prepareDefines=function(t,n){var i=this._light;this._scene.shadowsEnabled&&i.shadowEnabled&&(t["SHADOW"+n]=!0,this.useContactHardeningShadow&&(t["SHADOWPCSS"+n]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+n]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+n]=!0)),this.usePercentageCloserFiltering?(t["SHADOWPCF"+n]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+n]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+n]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+n]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+n]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+n]=!0),i.needCube()&&(t["SHADOWCUBE"+n]=!0))},e.prototype.bindShadowLight=function(t,n){var i=this._light,r=this._scene;if(r.shadowsEnabled&&i.shadowEnabled){var o=r.activeCamera;if(o){var a=this.getShadowMap();a&&(i.needCube()||n.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(n.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a.getSize().width,1/a.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(n.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),n.setTexture("depthSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/a.getSize().width,this._contactHardeningLightSizeUVRatio*a.getSize().width,this.frustumEdgeFalloff,t)):(n.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/a.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},e.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderID===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),o.x.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(o.x.Dot(this._lightDirection,o.x.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),o.j.LookAtLHToRef(t,t.add(this._lightDirection),o.x.Up(),this._viewMatrix);var n=this.getShadowMap();if(n){var i=n.renderList;i&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,i)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},e.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.filteringQuality=this.filteringQuality,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.renderList=[],t.renderList)for(var n=0;n<t.renderList.length;n++)e.renderList.push(t.renderList[n].id);return e},e.Parse=function(t,n){for(var i=n.getLightByID(t.lightId),r=new e(t.mapSize,i),o=r.getShadowMap(),a=0;a<t.renderList.length;a++)n.getMeshesByID(t.renderList[a]).forEach(function(e){o&&(o.renderList||(o.renderList=[]),o.renderList.push(e))});return t.usePoissonSampling?r.usePoissonSampling=!0:t.useExponentialShadowMap?r.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?r.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?r.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?r.useBlurCloseExponentialShadowMap=!0:t.usePercentageCloserFiltering?r.usePercentageCloserFiltering=!0:t.useContactHardeningShadow&&(r.useContactHardeningShadow=!0),t.filteringQuality&&(r.filteringQuality=t.filteringQuality),t.contactHardeningLightSizeUVRatio?r.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio:t.useVarianceShadowMap?r.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(r.useBlurExponentialShadowMap=!0),t.depthScale&&(r.depthScale=t.depthScale),t.blurScale&&(r.blurScale=t.blurScale),t.blurBoxOffset&&(r.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(r.useKernelBlur=t.useKernelBlur),t.blurKernel&&(r.blurKernel=t.blurKernel),void 0!==t.bias&&(r.bias=t.bias),void 0!==t.normalBias&&(r.normalBias=t.normalBias),void 0!==t.frustumEdgeFalloff&&(r.frustumEdgeFalloff=t.frustumEdgeFalloff),t.darkness&&r.setDarkness(t.darkness),t.transparencyShadow&&r.setTransparencyShadow(!0),r.forceBackFacesOnly=t.forceBackFacesOnly,r},e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("ShadowGeneratorSceneComponent")},e}();i.a.AddParser(xe.a.NAME_SHADOWGENERATOR,function(e,t){if(null!=e.shadowGenerators)for(var n=0,i=e.shadowGenerators.length;n<i;n++)Br.Parse(e.shadowGenerators[n],t)});var Ur=function(){function e(e){this.name=xe.a.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(xe.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,n=this.scene.lights;t<n.length;t++){var i=n[t].getShadowGenerator();i&&e.shadowGenerators.push(i.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e,t){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<t.lights.length;n++){var i=t.lights[n],r=i.getShadowGenerator();if(i.isEnabled()&&i.shadowEnabled&&r){var o=r.getShadowMap();-1!==t.textures.indexOf(o)&&e.push(o)}}},e}();Br._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_SHADOWGENERATOR);t||(t=new Ur(e),e._addComponent(t))},k.a.AddNodeConstructor("Light_Type_0",function(e,t){return function(){return new Vr(e,o.x.Zero(),t)}});var Vr=function(e){function t(t,n,i){var r=e.call(this,t,i)||this;return r._shadowAngle=Math.PI/2,r.position=n,r}return c.d(t,e),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return ki.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(t){if(this.direction)return e.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new o.x(1,0,0);case 1:return new o.x(-1,0,0);case 2:return new o.x(0,-1,0);case 3:return new o.x(0,1,0);case 4:return new o.x(0,0,1);case 5:return new o.x(0,0,-1)}return o.x.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){var i=this.getScene().activeCamera;i&&o.j.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(i),this.getDepthMaxZ(i),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},t.prototype.prepareLightSpecificDefines=function(e,t){e["POINTLIGHT"+t]=!0},c.c([Object(D.c)()],t.prototype,"shadowAngle",null),t}(Ni),Gr=function(){function e(e,t,n){var i=this;void 0===t&&(t=""),void 0===n&&(n="black"),this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=n,this._resizeLoadingUI=function(){var e=i._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(i._renderingCanvas).position;i._loadingDiv&&(i._loadingDiv.style.position="fixed"===t?"fixed":"absolute",i._loadingDiv.style.left=e.left+"px",i._loadingDiv.style.top=e.top+"px",i._loadingDiv.style.width=e.width+"px",i._loadingDiv.style.height=e.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=document.createElement("style");t.type="text/css",t.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(t);var n=new Image;n.src=e.DefaultLogoUrl?e.DefaultLogoUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.width="10vw",n.style.height="10vw",n.style.marginLeft="-5vw",n.style.marginTop="-5vw";var i=new Image;i.src=e.DefaultSpinnerUrl?e.DefaultSpinnerUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==",i.style.position="absolute",i.style.left="50%",i.style.top="50%",i.style.width="18vw",i.style.height="18vw",i.style.marginLeft="-9vw",i.style.marginTop="-9vw",i.style.animation="spin1 0.75s infinite linear",i.style.webkitAnimation="spin1 0.75s infinite linear",i.style.transformOrigin="50% 50%",i.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(n),this._loadingDiv.appendChild(i),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var e=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){e._loadingDiv&&(e._loadingDiv.parentElement&&e._loadingDiv.parentElement.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)}))},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();me.b.DefaultLoadingScreenFactory=function(e){return new Gr(e)};var zr=n(57),jr=n(66),Hr=function(){function e(){}return e.ConvertPanoramaToCubemap=function(e,t,n,i){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*n*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(i,this.FACE_FRONT,e,t,n),back:this.CreateCubemapTexture(i,this.FACE_BACK,e,t,n),left:this.CreateCubemapTexture(i,this.FACE_LEFT,e,t,n),right:this.CreateCubemapTexture(i,this.FACE_RIGHT,e,t,n),up:this.CreateCubemapTexture(i,this.FACE_UP,e,t,n),down:this.CreateCubemapTexture(i,this.FACE_DOWN,e,t,n),size:i,type:g.a.TEXTURETYPE_FLOAT,format:g.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(e,t,n,i,r){for(var o=new ArrayBuffer(e*e*4*3),a=new Float32Array(o),s=t[1].subtract(t[0]).scale(1/e),l=t[3].subtract(t[2]).scale(1/e),c=1/e,u=0,h=0;h<e;h++){for(var d=t[0],f=t[2],p=0;p<e;p++){var g=f.subtract(d).scale(u).add(d);g.normalize();var m=this.CalcProjectionSpherical(g,n,i,r);a[h*e*3+3*p+0]=m.r,a[h*e*3+3*p+1]=m.g,a[h*e*3+3*p+2]=m.b,d=d.add(s),f=f.add(l)}u+=c}return a},e.CalcProjectionSpherical=function(e,t,n,i){for(var r=Math.atan2(e.z,e.x),o=Math.acos(e.y);r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;var a=r/Math.PI,s=o/Math.PI;a=.5*a+.5;var l=Math.round(a*n);l<0?l=0:l>=n&&(l=n-1);var c=Math.round(s*i);c<0?c=0:c>=i&&(c=i-1);var u=i-c-1;return{r:t[u*n*3+3*l+0],g:t[u*n*3+3*l+1],b:t[u*n*3+3*l+2]}},e.FACE_FRONT=[new o.x(-1,-1,-1),new o.x(1,-1,-1),new o.x(-1,1,-1),new o.x(1,1,-1)],e.FACE_BACK=[new o.x(1,-1,1),new o.x(-1,-1,1),new o.x(1,1,1),new o.x(-1,1,1)],e.FACE_RIGHT=[new o.x(1,-1,-1),new o.x(1,-1,1),new o.x(1,1,-1),new o.x(1,1,1)],e.FACE_LEFT=[new o.x(-1,-1,1),new o.x(-1,-1,-1),new o.x(-1,1,1),new o.x(-1,1,-1)],e.FACE_DOWN=[new o.x(-1,1,-1),new o.x(1,1,-1),new o.x(-1,1,1),new o.x(1,1,1)],e.FACE_UP=[new o.x(-1,-1,1),new o.x(1,-1,1),new o.x(-1,-1,-1),new o.x(1,-1,-1)],e}(),Wr=function(){function e(){}return e.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},e.Rgbe2float=function(e,t,n,i,r,o){r>0?(r=this.Ldexp(1,r-136),e[o+0]=t*r,e[o+1]=n*r,e[o+2]=i*r):(e[o+0]=0,e[o+1]=0,e[o+2]=0)},e.readStringLine=function(e,t){for(var n="",i="",r=t;r<e.length-t&&"\n"!=(i=String.fromCharCode(e[r]));r++)n+=i;return n},e.RGBE_ReadHeader=function(e){var t,n,i=this.readStringLine(e,0);if("#"!=i[0]||"?"!=i[1])throw"Bad HDR Format.";var r=!1,o=!1,a=0;do{"FORMAT=32-bit_rle_rgbe"==(i=this.readStringLine(e,a+=i.length+1))?o=!0:0==i.length&&(r=!0)}while(!r);if(!o)throw"HDR Bad header format, unsupported FORMAT";i=this.readStringLine(e,a+=i.length+1);var s=/^\-Y (.*) \+X (.*)$/g.exec(i);if(!s||s.length<3)throw"HDR Bad header format, no size";if(n=parseInt(s[2]),t=parseInt(s[1]),n<8||n>32767)throw"HDR Bad header format, unsupported size";return{height:t,width:n,dataPosition:a+=i.length+1}},e.GetCubeMapTextureData=function(e,t){var n=new Uint8Array(e),i=this.RGBE_ReadHeader(n),r=this.RGBE_ReadPixels_RLE(n,i);return Hr.ConvertPanoramaToCubemap(r,i.width,i.height,t)},e.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},e.RGBE_ReadPixels_RLE=function(e,t){for(var n,i,r,o,a,s=t.height,l=t.width,c=t.dataPosition,u=0,h=0,d=0,f=new ArrayBuffer(4*l),p=new Uint8Array(f),g=new ArrayBuffer(t.width*t.height*4*3),m=new Float32Array(g);s>0;){if(n=e[c++],i=e[c++],r=e[c++],o=e[c++],2!=n||2!=i||128&r)throw"HDR Bad header format, not RLE";if((r<<8|o)!=l)throw"HDR Bad header format, wrong scan line width";for(u=0,d=0;d<4;d++)for(h=(d+1)*l;u<h;)if(n=e[c++],i=e[c++],n>128){if(0==(a=n-128)||a>h-u)throw"HDR Bad Format, bad scanline data (run)";for(;a-- >0;)p[u++]=i}else{if(0==(a=n)||a>h-u)throw"HDR Bad Format, bad scanline data (non-run)";if(p[u++]=i,--a>0)for(var _=0;_<a;_++)p[u++]=e[c++]}for(d=0;d<l;d++)this.Rgbe2float(m,n=p[d],i=p[d+l],r=p[d+2*l],o=p[d+3*l],(t.height-s)*l*3+3*d);s--}return m},e}(),Xr=function(e){function t(t,n,i,r,a,s,l,c,u){void 0===r&&(r=!1),void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===c&&(c=null),void 0===u&&(u=null);var h=e.call(this,n)||this;return h._generateHarmonics=!0,h._onLoad=null,h._onError=null,h.coordinatesMode=Ge.a.CUBIC_MODE,h._isBlocking=!0,h._rotationY=0,h.boundingBoxPosition=o.x.Zero(),t?(h.name=t,h.url=t,h.hasAlpha=!1,h.isCube=!0,h._textureMatrix=o.j.Identity(),h._onLoad=c,h._onError=u,h.gammaSpace=s,h._noMipmap=r,h._size=i,h._texture=h._getFromCache(t,h._noMipmap),h._texture?c&&(h._texture.isReady?be.h.SetImmediate(function(){return c()}):h._texture.onLoadedObservable.add(c)):n.useDelayedTextureLoading?h.delayLoadState=me.b.DELAYLOADSTATE_NOTLOADED:h.loadTexture(),h):h}return c.d(t,e),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(o.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,me.b.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?me.b.TEXTURETYPE_FLOAT:me.b.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(n){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var i=e.getScene();if(!i)return null;var r=Wr.GetCubeMapTextureData(n,e._size);if(e._generateHarmonics){var a=hr.a.ConvertCubeMapToSphericalPolynomial(r);e.sphericalPolynomial=a}for(var s=[],l=null,c=0;c<6;c++){if(!i.getEngine().getCaps().textureFloat){var u=new ArrayBuffer(e._size*e._size*3);l=new Uint8Array(u)}var h=r[t._facesMapping[c]];if(e.gammaSpace||l)for(var d=0;d<e._size*e._size;d++)if(e.gammaSpace&&(h[3*d+0]=Math.pow(h[3*d+0],o.u),h[3*d+1]=Math.pow(h[3*d+1],o.u),h[3*d+2]=Math.pow(h[3*d+2],o.u)),l){var f=Math.max(255*h[3*d+0],0),p=Math.max(255*h[3*d+1],0),g=Math.max(255*h[3*d+2],0),m=Math.max(Math.max(f,p),g);if(m>255){var _=255/m;f*=_,p*=_,g*=_}l[3*d+0]=f,l[3*d+1]=p,l[3*d+2]=g}s.push(l||h)}return s},null,this._onLoad,this._onError))},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t.prototype.delayLoad=function(){this.delayLoadState===me.b.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=me.b.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(g.a.MATERIAL_TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)})},t.Parse=function(e,n,i){var r=null;return e.name&&!e.isRenderTarget&&((r=new t(i+e.name,n,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,r.hasAlpha=e.hasAlpha,r.level=e.level,r.coordinatesMode=e.coordinatesMode,r.isBlocking=e.isBlocking),r&&(e.boundingBoxPosition&&(r.boundingBoxPosition=o.x.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(r.boundingBoxSize=o.x.FromArray(e.boundingBoxSize)),e.rotationY&&(r.rotationY=e.rotationY)),r},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._facesMapping=["right","left","up","down","front","back"],t}(Gi.a);a.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=Xr;var Yr=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=null),this.name=e,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new r.c,this._onDataLayoutChanged=new r.c,this._animationPropertiesOverride=null,this._scene=n||A.a.LastCreatedScene,this.influence=t}return Object.defineProperty(e.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),e.prototype.setPositions=function(e){var t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getPositions=function(){return this._positions},e.prototype.setNormals=function(e){var t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getNormals=function(){return this._normals},e.prototype.setTangents=function(e){var t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getTangents=function(){return this._tangents},e.prototype.serialize=function(){var e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),D.a.AppendSerializedAnimations(this,e),e},e.prototype.getClassName=function(){return"MorphTarget"},e.Parse=function(t){var n=new e(t.name,t.influence);if(n.setPositions(t.positions),null!=t.id&&(n.id=t.id),t.normals&&n.setNormals(t.normals),t.tangents&&n.setTangents(t.tangents),t.animations)for(var i=0;i<t.animations.length;i++){var r=t.animations[i],o=a.a.GetClass("BABYLON.Animation");o&&n.animations.push(o.Parse(r))}return n},e.FromMesh=function(t,n,i){n||(n=t.name);var r=new e(n,i,t.getScene());return r.setPositions(t.getVerticesData(Cn.b.PositionKind)),t.isVerticesDataPresent(Cn.b.NormalKind)&&r.setNormals(t.getVerticesData(Cn.b.NormalKind)),t.isVerticesDataPresent(Cn.b.TangentKind)&&r.setTangents(t.getVerticesData(Cn.b.TangentKind)),r},c.c([Object(D.c)()],e.prototype,"id",void 0),e}(),Kr=function(){function e(e){void 0===e&&(e=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Gt.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,e||(e=A.a.LastCreatedScene),this._scene=e,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),e.prototype.getActiveTarget=function(e){return this._activeTargets.data[e]},e.prototype.getTarget=function(e){return this._targets[e]},e.prototype.addTarget=function(e){var t=this;this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add(function(e){t._syncActiveTargets(e)})),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add(function(){t._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(e){var t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0))},e.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var t=0,n=this._targets;t<n.length;t++)e.targets.push(n[t].serialize());return e},e.prototype._syncActiveTargets=function(e){var t=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var n=0,i=this._targets;n<i.length;n++){var r=i[n];if(0!==r.influence){this._activeTargets.push(r),this._tempInfluences[t++]=r.influence,this._supportsNormals=this._supportsNormals&&r.hasNormals,this._supportsTangents=this._supportsTangents&&r.hasTangents;var o=r.getPositions();if(o){var a=o.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void p.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(var s=0;s<t;s++)this._influences[s]=this._tempInfluences[s];e&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var e=0,t=this._scene.meshes;e<t.length;e++){var n=t[e];n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}},e.Parse=function(t,n){var i=new e(n);i._uniqueId=t.id;for(var r=0,o=t.targets;r<o.length;r++)i.addTarget(Yr.Parse(o[r]));return i},e}(),Qr=n(27),qr=n(37),Zr=function(){function e(t,n){if(void 0===n&&(n=e.DefaultPluginFactory()),this._physicsPlugin=n,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new o.x(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw ye.a.WarnImport("CannonJSPlugin")},e.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.dispose=function(){this._impostors.forEach(function(e){e.dispose()}),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(e){e.uniqueId=this._impostors.push(e),e.parent||this._physicsPlugin.generatePhysicsBody(e)},e.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);t>-1&&this._impostors.splice(t,1).length&&this.getPhysicsPlugin().removePhysicsBody(e)},e.prototype.addJoint=function(e,t,n){var i={mainImpostor:e,connectedImpostor:t,joint:n};n.physicsPlugin=this._physicsPlugin,this._joints.push(i),this._physicsPlugin.generateJoint(i)},e.prototype.removeJoint=function(e,t,n){var i=this._joints.filter(function(i){return i.connectedImpostor===t&&i.joint===n&&i.mainImpostor===e});i.length&&this._physicsPlugin.removeJoint(i[0])},e.prototype._step=function(e){var t=this;this._impostors.forEach(function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)}),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t];return null},e.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t];return null},e.prototype.raycast=function(e,t){return this._physicsPlugin.raycast(e,t)},e.Epsilon=.001,e}(),Jr=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.x.Zero(),this._hitPointWorld=o.x.Zero(),this._rayFromWorld=o.x.Zero(),this._rayToWorld=o.x.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),e.prototype.setHitData=function(e,t){this._hasHit=!0,this._hitNormalWorld=new o.x(e.x,e.y,e.z),this._hitPointWorld=new o.x(t.x,t.y,t.z)},e.prototype.setHitDistance=function(e){this._hitDistance=e},e.prototype.calculateHitDistance=function(){this._hitDistance=o.x.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(e,t){void 0===e&&(e=o.x.Zero()),void 0===t&&(t=o.x.Zero()),this._rayFromWorld=e,this._rayToWorld=t,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.x.Zero(),this._hitPointWorld=o.x.Zero()},e}(),$r=function(){function e(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=10),void 0===n&&(n=CANNON),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._removeAfterStep=new Array,this._minus90X=new o.q(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new o.q(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=o.x.Zero(),this._tmpDeltaPosition=o.x.Zero(),this._tmpUnityRotation=new o.q,this.BJSCANNON=n,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=t,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new Jr):p.a.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(e){this.world.gravity.copy(e)},e.prototype.setTimeStep=function(e){this._fixedTimeStep=e},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(e){var t=this;this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?e:0,3),this._removeAfterStep.length>0&&(this._removeAfterStep.forEach(function(e){t.world.remove(e.physicsBody)}),this._removeAfterStep=[])},e.prototype.applyImpulse=function(e,t,n){var i=new this.BJSCANNON.Vec3(n.x,n.y,n.z),r=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(r,i)},e.prototype.applyForce=function(e,t,n){var i=new this.BJSCANNON.Vec3(n.x,n.y,n.z),r=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyForce(r,i)},e.prototype.generatePhysicsBody=function(e){if(e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var t=this._createShape(e),n=e.physicsBody;n&&this.removePhysicsBody(e);var i=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),r={mass:e.getParam("mass"),material:i},o=e.getParam("nativeOptions");for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);e.physicsBody=new this.BJSCANNON.Body(r),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),this.world.add(e.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(t){e.physicsBody[t].copy(n[t])}),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)}},e.prototype._processChildMeshes=function(e){var t=this,n=e.object.getChildMeshes?e.object.getChildMeshes(!0):[],i=e.object.rotationQuaternion;if(n.length){var r=function(n,a){if(i&&a.rotationQuaternion){var s=a.getPhysicsImpostor();if(s&&s.parent!==e){var l=a.getAbsolutePosition().subtract(e.object.getAbsolutePosition()),c=a.rotationQuaternion.multiply(o.q.Inverse(i));s.physicsBody&&(t.removePhysicsBody(s),s.physicsBody=null),s.parent=e,s.resetUpdateFlags(),e.physicsBody.addShape(t._createShape(s),new t.BJSCANNON.Vec3(l.x,l.y,l.z),new t.BJSCANNON.Quaternion(c.x,c.y,c.z,c.w)),e.physicsBody.mass+=s.getParam("mass")}i.multiplyInPlace(a.rotationQuaternion),a.getChildMeshes(!0).filter(function(e){return!!e.physicsImpostor}).forEach(r.bind(t,a.getAbsolutePosition()))}};n.filter(function(e){return!!e.physicsImpostor}).forEach(r.bind(this,e.object.getAbsolutePosition()))}},e.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),this._removeAfterStep.push(e)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var i,r=e.joint.jointData,o={pivotA:r.mainPivot?(new this.BJSCANNON.Vec3).copy(r.mainPivot):null,pivotB:r.connectedPivot?(new this.BJSCANNON.Vec3).copy(r.connectedPivot):null,axisA:r.mainAxis?(new this.BJSCANNON.Vec3).copy(r.mainAxis):null,axisB:r.connectedAxis?(new this.BJSCANNON.Vec3).copy(r.connectedAxis):null,maxForce:r.nativeParams.maxForce,collideConnected:!!r.collision};switch(e.joint.type){case qr.e.HingeJoint:case qr.e.Hinge2Joint:i=new this.BJSCANNON.HingeConstraint(t,n,o);break;case qr.e.DistanceJoint:i=new this.BJSCANNON.DistanceConstraint(t,n,r.maxDistance||2);break;case qr.e.SpringJoint:i=new this.BJSCANNON.Spring(t,n,{restLength:r.length,stiffness:r.stiffness,damping:r.damping,localAnchorA:o.pivotA,localAnchorB:o.pivotB});break;case qr.e.LockJoint:i=new this.BJSCANNON.LockConstraint(t,n,o);break;case qr.e.PointToPointJoint:case qr.e.BallAndSocketJoint:default:i=new this.BJSCANNON.PointToPointConstraint(t,o.pivotA,n,o.pivotB,o.maxForce)}i.collideConnected=!!r.collision,e.joint.physicsJoint=i,e.joint.type!==qr.e.SpringJoint?this.world.addConstraint(i):(e.joint.jointData.forceApplicationCallback=e.joint.jointData.forceApplicationCallback||function(){i.applyForce()},e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(e){e.joint.type!==qr.e.SpringJoint?this.world.removeConstraint(e.joint.physicsJoint):e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(e,t,n){var i,r;for(i=0;i<this._physicsMaterials.length;i++)if((r=this._physicsMaterials[i]).friction===t&&r.restitution===n)return r;var o=new this.BJSCANNON.Material(e);return o.friction=t,o.restitution=n,this._physicsMaterials.push(o),o},e.prototype._checkWithEpsilon=function(e){return e<Zr.Epsilon?Zr.Epsilon:e},e.prototype._createShape=function(e){var t,n=e.object,i=e.getObjectExtendSize();switch(e.type){case Qr.a.SphereImpostor:var r=i.y,a=i.z;t=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(i.x),this._checkWithEpsilon(r),this._checkWithEpsilon(a))/2);break;case Qr.a.CylinderImpostor:var s=e.getParam("nativeOptions");s||(s={});var l=void 0!==s.radiusTop?s.radiusTop:this._checkWithEpsilon(i.x)/2,c=void 0!==s.radiusBottom?s.radiusBottom:this._checkWithEpsilon(i.x)/2,u=void 0!==s.height?s.height:this._checkWithEpsilon(i.y);t=new this.BJSCANNON.Cylinder(l,c,u,void 0!==s.numSegments?s.numSegments:16);var h=new this.BJSCANNON.Quaternion;h.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var d=new this.BJSCANNON.Vec3(0,0,0);t.transformAllPoints(d,h);break;case Qr.a.BoxImpostor:var f=i.scale(.5);t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(f.x),this._checkWithEpsilon(f.y),this._checkWithEpsilon(f.z)));break;case Qr.a.PlaneImpostor:p.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),t=new this.BJSCANNON.Plane;break;case Qr.a.MeshImpostor:var g=n.getVerticesData?n.getVerticesData(Cn.b.PositionKind):[],m=n.getIndices?n.getIndices():[];if(!g)return;var _=n.position.clone(),v=n.rotation&&n.rotation.clone(),b=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(e.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace();var y,T=n.computeWorldMatrix(!0),E=new Array;for(y=0;y<g.length;y+=3)o.x.TransformCoordinates(o.x.FromArray(g,y),T).toArray(E,y);p.a.Warn("MeshImpostor only collides against spheres."),t=new this.BJSCANNON.Trimesh(E,m),n.position.copyFrom(_),v&&n.rotation&&n.rotation.copyFrom(v),b&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(b);break;case Qr.a.HeightmapImpostor:var x=n.position.clone(),C=n.rotation&&n.rotation.clone(),S=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(e.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace(),n.rotationQuaternion&&n.rotationQuaternion.multiplyInPlace(this._minus90X),t=this._createHeightmap(n),n.position.copyFrom(x),C&&n.rotation&&n.rotation.copyFrom(C),S&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(S),n.computeWorldMatrix(!0);break;case Qr.a.ParticleImpostor:t=new this.BJSCANNON.Particle;break;case Qr.a.NoImpostor:t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return t},e.prototype._createHeightmap=function(e,t){var n,i=e.getVerticesData(Cn.b.PositionKind),r=e.computeWorldMatrix(!0),a=new Array;for(n=0;n<i.length;n+=3)o.x.TransformCoordinates(o.x.FromArray(i,n),r).toArray(a,n);i=a;for(var s=new Array,l=t||~~(Math.sqrt(i.length/3)-1),c=e.getBoundingInfo(),u=Math.min(c.boundingBox.extendSizeWorld.x,c.boundingBox.extendSizeWorld.y),h=c.boundingBox.extendSizeWorld.z,d=2*u/l,f=0;f<i.length;f+=3){var p=Math.round(i[f+0]/d+l/2),g=Math.round(-1*(i[f+1]/d-l/2)),m=-i[f+2]+h;s[p]||(s[p]=[]),s[p][g]||(s[p][g]=m),s[p][g]=Math.max(m,s[p][g])}for(p=0;p<=l;++p){if(!s[p]){for(var _=1;!s[(p+_)%l];)_++;s[p]=s[(p+_)%l].slice()}for(g=0;g<=l;++g)if(!s[p][g]){var v;for(_=1;void 0===v;)v=s[p][(g+_++)%l];s[p][g]=v}}var b=new this.BJSCANNON.Heightfield(s,{elementSize:d});return b.minY=h,b},e.prototype._updatePhysicsBodyTransformation=function(e){var t=e.object;if(t.computeWorldMatrix&&t.computeWorldMatrix(!0),t.getBoundingInfo()){var n=e.getObjectCenter();this._tmpDeltaPosition.copyFrom(t.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(e.object.scaling),this._tmpPosition.copyFrom(n);var i=t.rotationQuaternion;if(i){if(e.type!==Qr.a.PlaneImpostor&&e.type!==Qr.a.HeightmapImpostor||(i=i.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===Qr.a.HeightmapImpostor){var r=t,a=r.getBoundingInfo(),s=r.rotationQuaternion;r.rotationQuaternion=this._tmpUnityRotation,r.computeWorldMatrix(!0);var l=n.clone(),c=r.getPivotMatrix();c=c?c.clone():o.j.Identity();var u=o.j.Translation(a.boundingBox.extendSizeWorld.x,0,-a.boundingBox.extendSizeWorld.z);r.setPreTransformMatrix(u),r.computeWorldMatrix(!0);var h=a.boundingBox.centerWorld.subtract(n).subtract(r.position).negate();this._tmpPosition.copyFromFloats(h.x,h.y-a.boundingBox.extendSizeWorld.y,h.z),this._tmpDeltaPosition.copyFrom(a.boundingBox.centerWorld.subtract(l)),this._tmpDeltaPosition.y+=a.boundingBox.extendSizeWorld.y,r.rotationQuaternion=s,r.setPreTransformMatrix(c),r.computeWorldMatrix(!0)}else e.type===Qr.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpDeltaPosition),e.physicsBody.position.copy(this._tmpPosition),e.physicsBody.quaternion.copy(i)}}},e.prototype.setTransformationFromPhysicsBody=function(e){e.object.position.copyFrom(e.physicsBody.position),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)},e.prototype.setPhysicsBodyTransformation=function(e,t,n){e.physicsBody.position.copy(t),e.physicsBody.quaternion.copy(n)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.copy(t)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.velocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(e){return e.physicsBody.mass},e.prototype.getBodyFriction=function(e){return e.physicsBody.material.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.material.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.material.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(e,t){e.physicsJoint.distance=t},e.prototype.setMotor=function(e,t,n,i){i||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),n&&this.setLimit(e,n))},e.prototype.setLimit=function(e,t,n){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===n?-t:n},e.prototype.syncMeshWithImpostor=function(e,t){var n=t.physicsBody;e.position.x=n.position.x,e.position.y=n.position.y,e.position.z=n.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=n.quaternion.x,e.rotationQuaternion.y=n.quaternion.y,e.rotationQuaternion.z=n.quaternion.z,e.rotationQuaternion.w=n.quaternion.w)},e.prototype.getRadius=function(e){return e.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(e,t){var n=e.physicsBody.shapes[0];t.x=2*n.halfExtents.x,t.y=2*n.halfExtents.y,t.z=2*n.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var e=new this.BJSCANNON.Vec3,t=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,i,r){if(r=r||10,0===(i=i||0))this.internalStep(n),this.time+=n;else{var o=Math.floor((this.time+i)/n)-Math.floor(this.time/n);o=Math.min(o,r)||1;for(var a=performance.now(),s=0;s!==o&&(this.internalStep(n),!(performance.now()-a>1e3*n));s++);this.time+=i;for(var l=this.time%n/n,c=e,u=this.bodies,h=0;h!==u.length;h++){var d=u[h];d.type!==t.Body.STATIC&&d.sleepState!==t.Body.SLEEPING?(d.position.vsub(d.previousPosition,c),c.scale(l,c),d.position.vadd(c,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}}}},e.prototype.raycast=function(e,t){return this._cannonRaycastResult.reset(),this.world.raycastClosest(e,t,{},this._cannonRaycastResult),this._raycastResult.reset(e,t),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();Zr.DefaultPluginFactory=function(){return new $r};var eo=function(){function e(e,t){void 0===t&&(t=OIMO),this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=o.x.Zero(),this.BJSOIMO=t,this.world=new this.BJSOIMO.World({iterations:e}),this.world.clear(),this._raycastResult=new Jr}return e.prototype.setGravity=function(e){this.world.gravity.copy(e)},e.prototype.setTimeStep=function(e){this.world.timeStep=e},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(e,t){var n=this;t.forEach(function(e){e.beforeStep()}),this.world.step(),t.forEach(function(e){e.afterStep(),n._tmpImpostorsArray[e.uniqueId]=e});for(var i=this.world.contacts;null!==i;)if(!i.touching||i.body1.sleeping||i.body2.sleeping){var r=this._tmpImpostorsArray[+i.body1.name],o=this._tmpImpostorsArray[+i.body2.name];r&&o?(r.onCollide({body:o.physicsBody}),o.onCollide({body:r.physicsBody}),i=i.next):i=i.next}else i=i.next},e.prototype.applyImpulse=function(e,t,n){var i=e.physicsBody.mass;e.physicsBody.applyImpulse(n.scale(this.world.invScale),t.scale(this.world.invScale*i))},e.prototype.applyForce=function(e,t,n){p.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(e,t,n)},e.prototype.generatePhysicsBody=function(e){var t=this;if(e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var n={name:e.uniqueId,config:[e.getParam("mass")||1,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==e.getParam("mass"),density:e.getParam("mass"),friction:e.getParam("friction"),restitution:e.getParam("restitution"),world:this.world},i=[e];(s=e.object).getChildMeshes&&s.getChildMeshes().forEach(function(e){e.physicsImpostor&&i.push(e.physicsImpostor)});var r=function(e){return Math.max(e,Zr.Epsilon)},a=new o.q;i.forEach(function(i){if(i.object.rotationQuaternion){var o=i.object.rotationQuaternion;a=o.clone();var s=o.toEulerAngles(),l=i.getObjectExtendSize();if(i===e){var c=e.getObjectCenter();e.object.getAbsolutePivotPoint().subtractToRef(c,t._tmpPositionVector),t._tmpPositionVector.divideInPlace(e.object.scaling),n.pos.push(c.x),n.pos.push(c.y),n.pos.push(c.z),n.posShape.push(0,0,0),n.rotShape.push(0,0,0)}else{var u=i.object.getAbsolutePosition().subtract(e.object.getAbsolutePosition());n.posShape.push(u.x),n.posShape.push(u.y),n.posShape.push(u.z),n.pos.push(0,0,0),n.rotShape.push(57.29577951308232*s.x),n.rotShape.push(57.29577951308232*s.y),n.rotShape.push(57.29577951308232*s.z)}switch(i.type){case Qr.a.ParticleImpostor:p.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case Qr.a.SphereImpostor:var h=l.y,d=l.z,f=Math.max(r(l.x),r(h),r(d))/2;n.type.push("sphere"),n.size.push(f),n.size.push(f),n.size.push(f);break;case Qr.a.CylinderImpostor:var g=r(l.x)/2,m=r(l.y);n.type.push("cylinder"),n.size.push(g),n.size.push(m),n.size.push(m);break;case Qr.a.PlaneImpostor:case Qr.a.BoxImpostor:default:g=r(l.x),m=r(l.y);var _=r(l.z);n.type.push("box"),n.size.push(g),n.size.push(m),n.size.push(_)}i.object.rotationQuaternion=o}}),e.physicsBody=this.world.add(n),e.physicsBody.resetQuaternion(a),e.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var s;e.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var i,r=e.joint.jointData,o=r.nativeParams||{},a={body1:t,body2:n,axe1:o.axe1||(r.mainAxis?r.mainAxis.asArray():null),axe2:o.axe2||(r.connectedAxis?r.connectedAxis.asArray():null),pos1:o.pos1||(r.mainPivot?r.mainPivot.asArray():null),pos2:o.pos2||(r.connectedPivot?r.connectedPivot.asArray():null),min:o.min,max:o.max,collision:o.collision||r.collision,spring:o.spring,world:this.world};switch(e.joint.type){case qr.e.BallAndSocketJoint:i="jointBall";break;case qr.e.SpringJoint:p.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"),a.min=r.length||a.min,a.max=Math.max(a.min,a.max);case qr.e.DistanceJoint:i="jointDistance",a.max=r.maxDistance;break;case qr.e.PrismaticJoint:i="jointPrisme";break;case qr.e.SliderJoint:i="jointSlide";break;case qr.e.WheelJoint:i="jointWheel";break;case qr.e.HingeJoint:default:i="jointHinge"}a.type=i,e.joint.physicsJoint=this.world.add(a)}},e.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(e){p.a.Warn(e)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(e){e.physicsBody.sleeping||(e.object.position.copyFrom(e.physicsBody.getPosition()),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()))},e.prototype.setPhysicsBodyTransformation=function(e,t,n){var i=e.physicsBody;i.position.copy(t),i.orientation.copy(n),i.syncShapes(),i.awake()},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.copy(t)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.linearVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){var n=0===t;e.physicsBody.shapes.density=n?1:t,e.physicsBody.setupMass(n?2:1)},e.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},e.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.shapes.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.shapes.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.awake()},e.prototype.updateDistanceJoint=function(e,t,n){e.physicsJoint.limitMotor.upperLimit=t,void 0!==n&&(e.physicsJoint.limitMotor.lowerLimit=n)},e.prototype.setMotor=function(e,t,n,i){void 0!==n?p.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):n=1e6;var r=i?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;r&&r.setMotor(t*=-1,n)},e.prototype.setLimit=function(e,t,n,i){var r=i?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;r&&r.setLimit(t,void 0===n?-t:n)},e.prototype.syncMeshWithImpostor=function(e,t){var n=t.physicsBody;e.position.x=n.position.x,e.position.y=n.position.y,e.position.z=n.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=n.orientation.x,e.rotationQuaternion.y=n.orientation.y,e.rotationQuaternion.z=n.orientation.z,e.rotationQuaternion.w=n.orientation.s)},e.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(e,t){var n=e.physicsBody.shapes;t.x=2*n.halfWidth,t.y=2*n.halfHeight,t.z=2*n.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(e,t){return p.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(e,t),this._raycastResult},e}();xn.a.CreateRibbon=function(e){var t=e.pathArray,n=e.closeArray||!1,i=e.closePath||!1,r=e.invertUV||!1,o=Math.floor(t[0].length/2),a=e.offset||o;a=a>o?o:Math.floor(a);var s,l,c,u,h=0===e.sideOrientation?0:e.sideOrientation||xn.a.DEFAULTSIDE,d=e.uvs,f=e.colors,p=[],g=[],m=[],_=[],v=[],b=[],y=[],T=[],E=[],x=[];if(t.length<2){var C=[],S=[];for(c=0;c<t[0].length-a;c++)C.push(t[0][c]),S.push(t[0][c+a]);t=[C,S]}var A,P,R,M,O,w=0,I=i?1:0;for(s=t[0].length,l=0;l<t.length;l++){for(y[l]=0,v[l]=[0],s=s<(P=(A=t[l]).length)?s:P,u=0;u<P;)p.push(A[u].x,A[u].y,A[u].z),u>0&&(R=A[u].subtract(A[u-1]).length()+y[l],v[l].push(R),y[l]=R),u++;i&&(u--,p.push(A[0].x,A[0].y,A[0].z),R=A[u].subtract(A[0]).length()+y[l],v[l].push(R),y[l]=R),E[l]=P+I,x[l]=w,w+=P+I}var D,L,k=null,N=null;for(c=0;c<s+I;c++){for(T[c]=0,b[c]=[0],l=0;l<t.length-1;l++)M=t[l],O=t[l+1],c===s?(k=M[0],N=O[0]):(k=M[c],N=O[c]),R=N.subtract(k).length()+T[c],b[c].push(R),T[c]=R;n&&N&&k&&(M=t[l],O=t[0],c===s&&(N=O[0]),R=N.subtract(k).length()+T[c],T[c]=R)}if(d)for(l=0;l<d.length;l++)_.push(d[l].x,d[l].y);else for(l=0;l<t.length;l++)for(c=0;c<s+I;c++)D=0!=y[l]?v[l][c]/y[l]:0,L=0!=T[c]?b[c][l]/T[c]:0,r?_.push(L,D):_.push(D,L);for(var F=0,B=E[l=0]-1,U=E[l+1]-1,V=B<U?B:U,G=x[1]-x[0],z=n?E.length:E.length-1;F<=V&&l<z;)g.push(F,F+G,F+1),g.push(F+G+1,F+1,F+G),(F+=1)===V&&(++l==E.length-1?(G=x[0]-x[l],B=E[l]-1,U=E[0]-1):(G=x[l+1]-x[l],B=E[l]-1,U=E[l+1]-1),F=x[l],V=B<U?B+F:U+F);if(xn.a.ComputeNormals(p,g,m),i){var j=0,H=0;for(l=0;l<t.length;l++)m[j=3*x[l]]=.5*(m[j]+m[H=l+1<t.length?3*(x[l+1]-1):m.length-3]),m[j+1]=.5*(m[j+1]+m[H+1]),m[j+2]=.5*(m[j+2]+m[H+2]),m[H]=m[j],m[H+1]=m[j+1],m[H+2]=m[j+2]}xn.a._ComputeSides(h,p,g,m,_,e.frontUVs,e.backUVs);var W=null;if(f){W=new Float32Array(4*f.length);for(var X=0;X<f.length;X++)W[4*X]=f[X].r,W[4*X+1]=f[X].g,W[4*X+2]=f[X].b,W[4*X+3]=f[X].a}var Y=new xn.a,K=new Float32Array(p),Q=new Float32Array(m),q=new Float32Array(_);return Y.indices=g,Y.positions=K,Y.normals=Q,Y.uvs=q,W&&Y.set(W,Cn.b.ColorKind),i&&(Y._idx=x),Y},fe.a.CreateRibbon=function(e,t,n,i,r,o,a,s,l){return void 0===n&&(n=!1),void 0===a&&(a=!1),to.CreateRibbon(e,{pathArray:t,closeArray:n,closePath:i,offset:r,updatable:a,sideOrientation:s,instance:l},o)};var to=function(){function e(){}return e.CreateRibbon=function(e,t,n){void 0===n&&(n=null);var i=t.pathArray,r=t.closeArray,a=t.closePath,s=fe.a._GetDefaultSideOrientation(t.sideOrientation),l=t.instance,c=t.updatable;if(l){var u=o.t.Vector3[0].setAll(Number.MAX_VALUE),h=o.t.Vector3[1].setAll(-Number.MAX_VALUE),d=l.getVerticesData(Cn.b.PositionKind);if(function(e){for(var t=i[0].length,n=l,r=0,o=n._originalBuilderSideOrientation===fe.a.DOUBLESIDE?2:1,a=1;a<=o;++a)for(var s=0;s<i.length;++s){var c=i[s],d=c.length;t=t<d?t:d;for(var f=0;f<t;++f){var p=c[f];e[r]=p.x,e[r+1]=p.y,e[r+2]=p.z,u.minimizeInPlaceFromFloats(p.x,p.y,p.z),h.maximizeInPlaceFromFloats(p.x,p.y,p.z),r+=3}n._creationDataStorage&&n._creationDataStorage.closePath&&(e[r]=(p=c[0]).x,e[r+1]=p.y,e[r+2]=p.z,r+=3)}}(d),l._boundingInfo?l._boundingInfo.reConstruct(u,h,l._worldMatrix):l._boundingInfo=new Jn.a(u,h,l._worldMatrix),l.updateVerticesData(Cn.b.PositionKind,d,!1,!1),t.colors){for(var f=l.getVerticesData(Cn.b.ColorKind),p=0,g=0;p<t.colors.length;p++,g+=4){var m=t.colors[p];f[g]=m.r,f[g+1]=m.g,f[g+2]=m.b,f[g+3]=m.a}l.updateVerticesData(Cn.b.ColorKind,f,!1,!1)}if(t.uvs){for(var _=l.getVerticesData(Cn.b.UVKind),v=0;v<t.uvs.length;v++)_[2*v]=t.uvs[v].x,_[2*v+1]=t.uvs[v].y;l.updateVerticesData(Cn.b.UVKind,_,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){var b=l.getIndices(),y=l.getVerticesData(Cn.b.NormalKind),T=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(xn.a.ComputeNormals(d,b,y,T),l._creationDataStorage&&l._creationDataStorage.closePath)for(var E=0,x=0,C=0;C<i.length;C++)y[E=3*l._creationDataStorage.idx[C]]=.5*(y[E]+y[x=C+1<i.length?3*(l._creationDataStorage.idx[C+1]-1):y.length-3]),y[E+1]=.5*(y[E+1]+y[x+1]),y[E+2]=.5*(y[E+2]+y[x+2]),y[x]=y[E],y[x+1]=y[E+1],y[x+2]=y[E+2];l.areNormalsFrozen||l.updateVerticesData(Cn.b.NormalKind,y,!1,!1)}return l}var S=new fe.a(e,n);S._originalBuilderSideOrientation=s,S._creationDataStorage=new fe.b;var A=xn.a.CreateRibbon(t);return a&&(S._creationDataStorage.idx=A._idx),S._creationDataStorage.closePath=a,S._creationDataStorage.closeArray=r,A.applyToMesh(S,c),S},e}();fe.a.ExtrudeShape=function(e,t,n,i,r,o,a,s,l,c){return void 0===a&&(a=null),no.ExtrudeShape(e,{shape:t,path:n,scale:i,rotation:r,cap:0===o?0:o||fe.a.NO_CAP,sideOrientation:l,instance:c,updatable:s},a)},fe.a.ExtrudeShapeCustom=function(e,t,n,i,r,o,a,s,l,c,u,h){return no.ExtrudeShapeCustom(e,{shape:t,path:n,scaleFunction:i,rotationFunction:r,ribbonCloseArray:o,ribbonClosePath:a,cap:0===s?0:s||fe.a.NO_CAP,sideOrientation:u,instance:h,updatable:c},l)};var no=function(){function e(){}return e.ExtrudeShape=function(t,n,i){void 0===i&&(i=null);var r=n.path,o=n.shape,a=n.scale||1,s=n.rotation||0,l=0===n.cap?0:n.cap||fe.a.NO_CAP,c=n.updatable,u=fe.a._GetDefaultSideOrientation(n.sideOrientation);return e._ExtrudeShapeGeneric(t,o,r,a,s,null,null,!1,!1,l,!1,i,!!c,u,n.instance||null,n.invertUV||!1,n.frontUVs||null,n.backUVs||null)},e.ExtrudeShapeCustom=function(t,n,i){void 0===i&&(i=null);var r=n.path,o=n.shape,a=n.scaleFunction||function(){return 1},s=n.rotationFunction||function(){return 0},l=n.ribbonCloseArray||!1,c=n.ribbonClosePath||!1,u=0===n.cap?0:n.cap||fe.a.NO_CAP,h=n.updatable,d=fe.a._GetDefaultSideOrientation(n.sideOrientation);return e._ExtrudeShapeGeneric(t,o,r,null,null,a,s,l,c,u,!0,i,!!h,d,n.instance||null,n.invertUV||!1,n.frontUVs||null,n.backUVs||null)},e._ExtrudeShapeGeneric=function(e,t,n,i,r,a,s,l,c,u,h,d,f,p,g,m,_,v){var b,y,T=function(e,t,n,i,r,a,s,l,c,u){for(var h=n.getTangents(),d=n.getNormals(),f=n.getBinormals(),p=n.getDistances(),g=0,m=u&&l?l:function(){return null!==a?a:0},_=u&&s?s:function(){return null!==r?r:1},v=c===fe.a.NO_CAP||c===fe.a.CAP_END?0:2,b=o.t.Matrix[0],y=0;y<t.length;y++){for(var T=new Array,E=m(y,p[y]),x=_(y,p[y]),C=0;C<e.length;C++){o.j.RotationAxisToRef(h[y],g,b);var S=h[y].scale(e[C].z).add(d[y].scale(e[C].x)).add(f[y].scale(e[C].y)),A=T[C]?T[C]:o.x.Zero();o.x.TransformCoordinatesToRef(S,b,A),A.scaleInPlace(x).addInPlace(t[y]),T[C]=A}i[v]=T,g+=E,v++}var P=function(e){var t,n=Array(),i=o.x.Zero();for(t=0;t<e.length;t++)i.addInPlace(e[t]);for(i.scaleInPlace(1/e.length),t=0;t<e.length;t++)n.push(i);return n};switch(c){case fe.a.NO_CAP:break;case fe.a.CAP_START:i[0]=P(i[2]),i[1]=i[2];break;case fe.a.CAP_END:i[v]=i[v-1],i[v+1]=P(i[v-1]);break;case fe.a.CAP_ALL:i[0]=P(i[2]),i[1]=i[2],i[v]=i[v-1],i[v+1]=P(i[v-1])}return i};if(g){var E=g._creationDataStorage;return b=E.path3D.update(n),y=T(t,n,E.path3D,E.pathArray,i,r,a,s,E.cap,h),fe.a.CreateRibbon("",y,!1,!1,0,d||void 0,!1,0,g)}y=T(t,n,b=new o.m(n),new Array,i,r,a,s,u=u<0||u>3?0:u,h);var x=to.CreateRibbon(e,{pathArray:y,closeArray:l,closePath:c,updatable:f,sideOrientation:p,invertUV:m,frontUVs:_||void 0,backUVs:v||void 0},d);return x._creationDataStorage.pathArray=y,x._creationDataStorage.path3D=b,x._creationDataStorage.cap=u,x},e}(),io=function(){function e(e,t){var n=this;void 0===e&&(e=!0),void 0===t&&(t=Ammo),this._useDeltaForWorldStep=e,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new o.q,this._tmpContactCallbackResult=!1,this._tmpVector=new o.x,this._tmpMatrix=new o.j,"function"==typeof t?t(this.bjsAMMO):this.bjsAMMO=t,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){n._tmpContactCallbackResult=!0},this._raycastResult=new Jr,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):p.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},e.prototype.setTimeStep=function(e){this._timeStep=e},e.prototype.setFixedTimeStep=function(e){this._fixedTimeStep=e},e.prototype.setMaxSteps=function(e){this._maxSteps=e},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype._isImpostorInContact=function(e){return this._tmpContactCallbackResult=!1,this.world.contactTest(e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._isImpostorPairInContact=function(e,t){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(e.physicsBody,t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._stepSimulation=function(e,t,n){if(void 0===e&&(e=1/60),void 0===t&&(t=10),void 0===n&&(n=1/60),0==t)this.world.stepSimulation(e,0);else for(;t>0&&e>0;)e-n<n?(this.world.stepSimulation(e,0),e=0):(e-=n,this.world.stepSimulation(n,0)),t--},e.prototype.executeStep=function(e,t){for(var n=0,i=t;n<i.length;n++){var r=i[n];r.soft||r.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?e:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s.soft?this._afterSoftStep(s):s.afterStep(),s._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(s))for(var l=0,c=s._onPhysicsCollideCallbacks;l<c.length;l++)for(var u=0,h=c[l].otherImpostors;u<h.length;u++){var d=h[u];(s.physicsBody.isActive()||d.physicsBody.isActive())&&this._isImpostorPairInContact(s,d)&&(s.onCollide({body:d.physicsBody}),d.onCollide({body:s.physicsBody}))}}},e.prototype._afterSoftStep=function(e){e.type===Qr.a.RopeImpostor?this._ropeStep(e):this._softbodyOrClothStep(e)},e.prototype._ropeStep=function(e){for(var t,n,i,r,a=e.physicsBody.get_m_nodes(),s=a.size(),l=new Array,c=0;c<s;c++)n=(t=a.at(c).get_m_x()).x(),i=t.y(),r=t.z(),l.push(new o.x(n,i,r));var u=e.object,h=e.getParam("shape");e.object=e._isFromLine?Pi.a.CreateLines("lines",{points:l,instance:u}):no.ExtrudeShape("ext",{shape:h,path:l,instance:u})},e.prototype._softbodyOrClothStep=function(e){var t=e.type===Qr.a.ClothImpostor?1:-1,n=e.object,i=n.getVerticesData(Cn.b.PositionKind);i||(i=[]);var r=n.getVerticesData(Cn.b.NormalKind);r||(r=[]);for(var o,a,s,l,c,u,h,d,f=i.length/3,p=e.physicsBody.get_m_nodes(),g=0;g<f;g++){var m;s=(a=(o=p.at(g)).get_m_x()).x(),l=a.y(),c=a.z()*t,u=(m=o.get_m_n()).x(),h=m.y(),d=m.z()*t,i[3*g]=s,i[3*g+1]=l,i[3*g+2]=c,r[3*g]=u,r[3*g+1]=h,r[3*g+2]=d}var _=new xn.a;_.positions=i,_.normals=r,_.uvs=n.getVerticesData(Cn.b.UVKind),_.colors=n.getVerticesData(Cn.b.ColorKind),n&&n.getIndices&&(_.indices=n.getIndices()),_.applyToMesh(n)},e.prototype.applyImpulse=function(e,t,n){if(e.soft)p.a.Warn("Cannot be applied to a soft body");else{e.physicsBody.activate();var i=this._tmpAmmoVectorA,r=this._tmpAmmoVectorB;e.object&&e.object.getWorldMatrix&&(e.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.x.TransformCoordinatesToRef(n,this._tmpMatrix,this._tmpVector),n=this._tmpVector),i.setValue(n.x,n.y,n.z),r.setValue(t.x,t.y,t.z),e.physicsBody.applyImpulse(r,i)}},e.prototype.applyForce=function(e,t,n){if(e.soft)p.a.Warn("Cannot be applied to a soft body");else{e.physicsBody.activate();var i=this._tmpAmmoVectorA,r=this._tmpAmmoVectorB;e.object&&e.object.getWorldMatrix&&(e.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.x.TransformCoordinatesToRef(n,this._tmpMatrix,this._tmpVector),n=this._tmpVector),i.setValue(n.x,n.y,n.z),r.setValue(t.x,t.y,t.z),e.physicsBody.applyForce(r,i)}},e.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){var n=this._createShape(t),i=t.getParam("mass");if(t._pluginData.mass=i,t.soft)n.get_m_cfg().set_collisions(17),n.get_m_cfg().set_kDP(t.getParam("damping")),Ammo.castObject(n,Ammo.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),n.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(n,1,-1),t.physicsBody=n,t._pluginData.toDispose.push(n),this.setBodyPressure(t,0),t.type===Qr.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var r=new Ammo.btVector3(0,0,0),o=new Ammo.btTransform;o.setIdentity(),0!==i&&n.calculateLocalInertia(i,r),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),o.setOrigin(this._tmpAmmoVectorA),o.setRotation(this._tmpAmmoQuaternion);var a=new Ammo.btDefaultMotionState(o),s=new Ammo.btRigidBodyConstructionInfo(i,a,n,r),l=new Ammo.btRigidBody(s);0===i&&(l.setCollisionFlags(l.getCollisionFlags()|e.KINEMATIC_FLAG),l.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),t.type!=Qr.a.NoImpostor||n.getChildShape||l.setCollisionFlags(l.getCollisionFlags()|e.DISABLE_COLLISION_FLAG),this.world.addRigidBody(l),t.physicsBody=l,t._pluginData.toDispose=t._pluginData.toDispose.concat([l,s,a,o,r,n])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},e.prototype.removePhysicsBody=function(e){var t=this;this.world&&(this.world.removeRigidBody(e.physicsBody),e._pluginData&&e._pluginData.toDispose.forEach(function(e){t.bjsAMMO.destroy(e)}))},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var i,r=e.joint.jointData;switch(r.mainPivot||(r.mainPivot=new o.x(0,0,0)),r.connectedPivot||(r.connectedPivot=new o.x(0,0,0)),e.joint.type){case qr.e.DistanceJoint:var a=r.maxDistance;a&&(r.mainPivot=new o.x(0,-a/2,0),r.connectedPivot=new o.x(0,a/2,0)),i=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(r.mainPivot.x,r.mainPivot.y,r.mainPivot.z),new Ammo.btVector3(r.connectedPivot.x,r.connectedPivot.y,r.connectedPivot.z));break;case qr.e.HingeJoint:r.mainAxis||(r.mainAxis=new o.x(0,0,0)),r.connectedAxis||(r.connectedAxis=new o.x(0,0,0));var s=new Ammo.btVector3(r.mainAxis.x,r.mainAxis.y,r.mainAxis.z),l=new Ammo.btVector3(r.connectedAxis.x,r.connectedAxis.y,r.connectedAxis.z);i=new Ammo.btHingeConstraint(t,n,new Ammo.btVector3(r.mainPivot.x,r.mainPivot.y,r.mainPivot.z),new Ammo.btVector3(r.connectedPivot.x,r.connectedPivot.y,r.connectedPivot.z),s,l);break;case qr.e.BallAndSocketJoint:i=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(r.mainPivot.x,r.mainPivot.y,r.mainPivot.z),new Ammo.btVector3(r.connectedPivot.x,r.connectedPivot.y,r.connectedPivot.z));break;default:p.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),i=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(r.mainPivot.x,r.mainPivot.y,r.mainPivot.z),new Ammo.btVector3(r.connectedPivot.x,r.connectedPivot.y,r.connectedPivot.z))}this.world.addConstraint(i,!e.joint.jointData.collision),e.joint.physicsJoint=i}},e.prototype.removeJoint=function(e){this.world&&this.world.removeConstraint(e.joint.physicsJoint)},e.prototype._addMeshVerts=function(e,t,n){var i=this,r=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var a=n.getIndices();a||(a=[]);var s=n.getVerticesData(Cn.b.PositionKind);s||(s=[]),n.computeWorldMatrix(!1);for(var l=a.length/3,c=0;c<l;c++){for(var u=[],h=0;h<3;h++){var d,f=new o.x(s[3*a[3*c+h]+0],s[3*a[3*c+h]+1],s[3*a[3*c+h]+2]);o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),f=o.x.TransformCoordinates(f,this._tmpMatrix),(d=0==h?this._tmpAmmoVectorA:1==h?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),u.push(d)}e.addTriangle(u[0],u[1],u[2]),r++}n.getChildMeshes().forEach(function(n){r+=i._addMeshVerts(e,t,n)})}return r},e.prototype._softVertexData=function(e){var t=e.object;if(t&&t.getIndices&&t.getWorldMatrix&&t.getChildMeshes){var n=t.getIndices();n||(n=[]);var i=t.getVerticesData(Cn.b.PositionKind);i||(i=[]);var r=t.getVerticesData(Cn.b.NormalKind);r||(r=[]),t.computeWorldMatrix(!1);for(var a=[],s=[],l=0;l<i.length;l+=3){var c=new o.x(i[l],i[l+1],i[l+2]),u=new o.x(r[l],r[l+1],r[l+2]);c=o.x.TransformCoordinates(c,t.getWorldMatrix()),u=o.x.TransformNormal(u,t.getWorldMatrix()),a.push(c.x,c.y,c.z),s.push(u.x,u.y,u.z)}var h=new xn.a;return h.positions=a,h.normals=s,h.uvs=t.getVerticesData(Cn.b.UVKind),h.colors=t.getVerticesData(Cn.b.ColorKind),t&&t.getIndices&&(h.indices=t.getIndices()),h.applyToMesh(t),t.position=o.x.Zero(),t.rotationQuaternion=null,t.rotation=o.x.Zero(),t.computeWorldMatrix(!0),h}return xn.a.ExtractFromMesh(t)},e.prototype._createSoftbody=function(e){var t=e.object;if(t&&t.getIndices){var n=t.getIndices();n||(n=[]);var i=this._softVertexData(e),r=i.positions,a=i.normals;if(null===r||null===a)return new Ammo.btCompoundShape;for(var s=[],l=[],c=0;c<r.length;c+=3){var u=new o.x(r[c],r[c+1],r[c+2]),h=new o.x(a[c],a[c+1],a[c+2]);s.push(u.x,u.y,-u.z),l.push(h.x,h.y,-h.z)}var d=(new Ammo.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),s,t.getIndices(),n.length/3,!0),f=r.length/3,p=d.get_m_nodes();for(c=0;c<f;c++){var g;(g=p.at(c).get_m_n()).setX(l[3*c]),g.setY(l[3*c+1]),g.setZ(l[3*c+2])}return d}},e.prototype._createCloth=function(e){var t=e.object;if(t&&t.getIndices){var n=t.getIndices();n||(n=[]);var i=this._softVertexData(e),r=i.positions;if(null===r||null===i.normals)return new Ammo.btCompoundShape;var o=r.length,a=Math.sqrt(o/3);e.segments=a;var s=a-1;return this._tmpAmmoVectorA.setValue(r[0],r[1],r[2]),this._tmpAmmoVectorB.setValue(r[3*s],r[3*s+1],r[3*s+2]),this._tmpAmmoVectorD.setValue(r[o-3],r[o-2],r[o-1]),this._tmpAmmoVectorC.setValue(r[o-3-3*s],r[o-2-3*s],r[o-1-3*s]),(new Ammo.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,a,a,e.getParam("fixedPoints"),!0)}},e.prototype._createRope=function(e){var t,n,i=this._softVertexData(e),r=i.positions,o=i.normals;if(null===r||null===o)return new Ammo.btCompoundShape;if(i.applyToMesh(e.object,!0),e._isFromLine=!0,0===o.map(function(e){return e*e}).reduce(function(e,t){return e+t}))n=(t=r.length)/3-1,this._tmpAmmoVectorA.setValue(r[0],r[1],r[2]),this._tmpAmmoVectorB.setValue(r[t-3],r[t-2],r[t-1]);else{e._isFromLine=!1;var a=e.getParam("path");if(null===e.getParam("shape"))return p.a.Warn("No shape available for extruded mesh"),new Ammo.btCompoundShape;if(r.length%(3*a.length)!=0)return p.a.Warn("Path does not match extrusion"),new Ammo.btCompoundShape;n=(t=a.length)-1,this._tmpAmmoVectorA.setValue(a[0].x,a[0].y,a[0].z),this._tmpAmmoVectorB.setValue(a[t-1].x,a[t-1].y,a[t-1].z)}e.segments=n;var s=e.getParam("fixedPoints");s=s>3?3:s;var l=(new Ammo.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,n-1,s);return l.get_m_cfg().set_collisions(17),l},e.prototype._addHullVerts=function(e,t,n){var i=this,r=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var a=n.getIndices();a||(a=[]);var s=n.getVerticesData(Cn.b.PositionKind);s||(s=[]),n.computeWorldMatrix(!1);for(var l=a.length/3,c=0;c<l;c++){for(var u=[],h=0;h<3;h++){var d,f=new o.x(s[3*a[3*c+h]+0],s[3*a[3*c+h]+1],s[3*a[3*c+h]+2]);o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),f=o.x.TransformCoordinates(f,this._tmpMatrix),(d=0==h?this._tmpAmmoVectorA:1==h?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),u.push(d)}e.addPoint(u[0],!0),e.addPoint(u[1],!0),e.addPoint(u[2],!0),r++}n.getChildMeshes().forEach(function(n){r+=i._addHullVerts(e,t,n)})}return r},e.prototype._createShape=function(e,t){var n=this;void 0===t&&(t=!1);var i,r=e.object,a=e.getObjectExtendSize();if(!t){var s=e.object.getChildMeshes?e.object.getChildMeshes(!0):[];i=new Ammo.btCompoundShape;var l=0;if(s.forEach(function(e){var t=e.getPhysicsImpostor();if(t){if(t.type==Qr.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var r=n._createShape(t),a=e.parent.getWorldMatrix().clone(),s=new o.x;a.decompose(s),n._tmpAmmoTransform.getOrigin().setValue(e.position.x*s.x,e.position.y*s.y,e.position.z*s.z),n._tmpAmmoQuaternion.setValue(e.rotationQuaternion.x,e.rotationQuaternion.y,e.rotationQuaternion.z,e.rotationQuaternion.w),n._tmpAmmoTransform.setRotation(n._tmpAmmoQuaternion),i.addChildShape(n._tmpAmmoTransform,r),t.dispose(),l++}}),l>0){if(e.type!=Qr.a.NoImpostor){var c=this._createShape(e,!0);c&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),i.addChildShape(this._tmpAmmoTransform,c))}return i}Ammo.destroy(i),i=null}switch(e.type){case Qr.a.SphereImpostor:i=new Ammo.btSphereShape(a.x/2);break;case Qr.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),i=new Ammo.btCylinderShape(this._tmpAmmoVectorA);break;case Qr.a.PlaneImpostor:case Qr.a.BoxImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),i=new Ammo.btBoxShape(this._tmpAmmoVectorA);break;case Qr.a.MeshImpostor:if(0==e.getParam("mass")){var u=new Ammo.btTriangleMesh;e._pluginData.toDispose.push(u);var h=this._addMeshVerts(u,r,r);i=0==h?new Ammo.btCompoundShape:new Ammo.btBvhTriangleMeshShape(u);break}case Qr.a.ConvexHullImpostor:var d=new Ammo.btConvexHullShape;0==(h=this._addHullVerts(d,r,r))?(e._pluginData.toDispose.push(d),i=new Ammo.btCompoundShape):i=d;break;case Qr.a.NoImpostor:i=new Ammo.btSphereShape(a.x/2);break;case Qr.a.SoftbodyImpostor:i=this._createSoftbody(e);break;case Qr.a.ClothImpostor:i=this._createCloth(e);break;case Qr.a.RopeImpostor:i=this._createRope(e);break;default:p.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return i},e.prototype.setTransformationFromPhysicsBody=function(e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),e.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),e.object.rotationQuaternion?e.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):e.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(e.object.rotation))},e.prototype.setPhysicsBodyTransformation=function(e,t,n){var i=e.physicsBody.getWorldTransform();if(i.getOrigin().x()!=t.x||i.getOrigin().y()!=t.y||i.getOrigin().z()!=t.z||i.getRotation().x()!=n.x||i.getRotation().y()!=n.y||i.getRotation().z()!=n.z||i.getRotation().w()!=n.w)if(this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),i.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(n.x,n.y,n.z,n.w),i.setRotation(this._tmpAmmoQuaternion),e.physicsBody.setWorldTransform(i),0==e.mass){var r=e.physicsBody.getMotionState();r&&r.setWorldTransform(i)}else e.physicsBody.activate()},e.prototype.isSupported=function(){return void 0!==this.bjsAMMO},e.prototype.setLinearVelocity=function(e,t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),e.soft?e.physicsBody.linearVelocity(this._tmpAmmoVectorA):e.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},e.prototype.setAngularVelocity=function(e,t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),e.soft?e.physicsBody.angularVelocity(this._tmpAmmoVectorA):e.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},e.prototype.getLinearVelocity=function(e){if(e.soft)var t=e.physicsBody.linearVelocity();else t=e.physicsBody.getLinearVelocity();if(!t)return null;var n=new o.x(t.x(),t.y(),t.z());return Ammo.destroy(t),n},e.prototype.getAngularVelocity=function(e){if(e.soft)var t=e.physicsBody.angularVelocity();else t=e.physicsBody.getAngularVelocity();if(!t)return null;var n=new o.x(t.x(),t.y(),t.z());return Ammo.destroy(t),n},e.prototype.setBodyMass=function(e,t){e.soft?e.physicsBody.setTotalMass(t,!1):e.physicsBody.setMassProps(t),e._pluginData.mass=t},e.prototype.getBodyMass=function(e){return e._pluginData.mass||0},e.prototype.getBodyFriction=function(e){return e._pluginData.friction||0},e.prototype.setBodyFriction=function(e,t){e.soft?e.physicsBody.get_m_cfg().set_kDF(t):e.physicsBody.setFriction(t),e._pluginData.friction=t},e.prototype.getBodyRestitution=function(e){return e._pluginData.restitution||0},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.setRestitution(t),e._pluginData.restitution=t},e.prototype.getBodyPressure=function(e){return e.soft?e._pluginData.pressure||0:(p.a.Warn("Pressure is not a property of a rigid body"),0)},e.prototype.setBodyPressure=function(e,t){e.soft?e.type===Qr.a.SoftbodyImpostor?(e.physicsBody.get_m_cfg().set_kPR(t),e._pluginData.pressure=t):(e.physicsBody.get_m_cfg().set_kPR(0),e._pluginData.pressure=0):p.a.Warn("Pressure can only be applied to a softbody")},e.prototype.getBodyStiffness=function(e){return e.soft?e._pluginData.stiffness||0:(p.a.Warn("Stiffness is not a property of a rigid body"),0)},e.prototype.setBodyStiffness=function(e,t){e.soft?(t=(t=t<0?0:t)>1?1:t,e.physicsBody.get_m_materials().at(0).set_m_kLST(t),e._pluginData.stiffness=t):p.a.Warn("Stiffness cannot be applied to a rigid body")},e.prototype.getBodyVelocityIterations=function(e){return e.soft?e._pluginData.velocityIterations||0:(p.a.Warn("Velocity iterations is not a property of a rigid body"),0)},e.prototype.setBodyVelocityIterations=function(e,t){e.soft?(t=t<0?0:t,e.physicsBody.get_m_cfg().set_viterations(t),e._pluginData.velocityIterations=t):p.a.Warn("Velocity iterations cannot be applied to a rigid body")},e.prototype.getBodyPositionIterations=function(e){return e.soft?e._pluginData.positionIterations||0:(p.a.Warn("Position iterations is not a property of a rigid body"),0)},e.prototype.setBodyPositionIterations=function(e,t){e.soft?(t=t<0?0:t,e.physicsBody.get_m_cfg().set_piterations(t),e._pluginData.positionIterations=t):p.a.Warn("Position iterations cannot be applied to a rigid body")},e.prototype.appendAnchor=function(e,t,n,i,r,o){void 0===r&&(r=1),void 0===o&&(o=!1);var a=e.segments,s=Math.round((a-1)*n)+a*(a-1-Math.round((a-1)*i));e.physicsBody.appendAnchor(s,t.physicsBody,o,r)},e.prototype.appendHook=function(e,t,n,i,r){void 0===i&&(i=1),void 0===r&&(r=!1);var o=Math.round(e.segments*n);e.physicsBody.appendAnchor(o,t.physicsBody,r,i)},e.prototype.sleepBody=function(e){p.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},e.prototype.wakeUpBody=function(e){e.physicsBody.activate()},e.prototype.updateDistanceJoint=function(e,t,n){p.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},e.prototype.setMotor=function(e,t,n,i){e.physicsJoint.enableAngularMotor(!0,t,n)},e.prototype.setLimit=function(e,t,n){p.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},e.prototype.syncMeshWithImpostor=function(e,t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),e.position.x=this._tmpAmmoTransform.getOrigin().x(),e.position.y=this._tmpAmmoTransform.getOrigin().y(),e.position.z=this._tmpAmmoTransform.getOrigin().z(),e.rotationQuaternion&&(e.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),e.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),e.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),e.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},e.prototype.getRadius=function(e){return e.getObjectExtendSize().x/2},e.prototype.getBoxSizeToRef=function(e,t){var n=e.getObjectExtendSize();t.x=n.x,t.y=n.y,t.z=n.z},e.prototype.dispose=function(){Ammo.destroy(this.world),Ammo.destroy(this._solver),Ammo.destroy(this._overlappingPairCache),Ammo.destroy(this._dispatcher),Ammo.destroy(this._collisionConfiguration),Ammo.destroy(this._tmpAmmoVectorA),Ammo.destroy(this._tmpAmmoVectorB),Ammo.destroy(this._tmpAmmoVectorC),Ammo.destroy(this._tmpAmmoTransform),Ammo.destroy(this._tmpAmmoQuaternion),Ammo.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},e.prototype.raycast=function(e,t){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(e.x,e.y,e.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(t.x,t.y,t.z);var n=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,n),this._raycastResult.reset(e,t),n.hasHit()&&(this._raycastResult.setHitData({x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()},{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),Ammo.destroy(n),Ammo.destroy(this._tmpAmmoVectorRCA),Ammo.destroy(this._tmpAmmoVectorRCB),this._raycastResult},e.DISABLE_COLLISION_FLAG=4,e.KINEMATIC_FLAG=2,e.DISABLE_DEACTIVATION_FLAG=4,e}();i.a.prototype.removeReflectionProbe=function(e){if(!this.reflectionProbes)return-1;var t=this.reflectionProbes.indexOf(e);return-1!==t&&this.reflectionProbes.splice(t,1),t},i.a.prototype.addReflectionProbe=function(e){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(e)};var ro=function(){function e(e,t,n,i,r){var a=this;void 0===i&&(i=!0),void 0===r&&(r=!1),this.name=e,this._viewMatrix=o.j.Identity(),this._target=o.x.Zero(),this._add=o.x.Zero(),this._invertYAxis=!1,this.position=o.x.Zero(),this._scene=n,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new cn(e,t,n,i,!0,r?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(e){switch(e){case 0:a._add.copyFromFloats(1,0,0);break;case 1:a._add.copyFromFloats(-1,0,0);break;case 2:a._add.copyFromFloats(0,a._invertYAxis?1:-1,0);break;case 3:a._add.copyFromFloats(0,a._invertYAxis?-1:1,0);break;case 4:a._add.copyFromFloats(0,0,1);break;case 5:a._add.copyFromFloats(0,0,-1)}a._attachedMesh&&a.position.copyFrom(a._attachedMesh.getAbsolutePosition()),a.position.addToRef(a._add,a._target),o.j.LookAtLHToRef(a.position,a._target,o.x.Up(),a._viewMatrix),n.activeCamera&&(a._projectionMatrix=o.j.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ),n.setTransformMatrix(a._viewMatrix,a._projectionMatrix)),n._forcedViewPosition=a.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n._forcedViewPosition=null,n.updateTransformMatrix(!0)})}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(e){this._renderTargetTexture.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(e){this._renderTargetTexture.refreshRate=e},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(e){this._attachedMesh=e},e.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderTargetTexture.setRenderingAutoClearDepthStencil(e,t)},e.prototype.dispose=function(){var e=this._scene.reflectionProbes.indexOf(this);-1!==e&&this._scene.reflectionProbes.splice(e,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},e.prototype.toString=function(e){var t="Name: "+this.name;return e&&(t+=", position: "+this.position.toString(),this._attachedMesh&&(t+=", attached mesh: "+this._attachedMesh.name)),t},e.prototype.getClassName=function(){return"ReflectionProbe"},e.prototype.serialize=function(){var e=D.a.Serialize(this,this._renderTargetTexture.serialize());return e.isReflectionProbe=!0,e},e.Parse=function(t,n,i){var r=null;if(n.reflectionProbes)for(var o=0;o<n.reflectionProbes.length;o++){var a=n.reflectionProbes[o];if(a.name===t.name){r=a;break}}return(r=D.a.Parse(function(){return r||new e(t.name,t.renderTargetSize,n,t._generateMipMaps)},t,n,i)).cubeTexture._waitingRenderList=t.renderList,t._attachedMesh&&r.attachToMesh(n.getMeshByID(t._attachedMesh)),r},c.c([Object(D.k)()],e.prototype,"_attachedMesh",void 0),c.c([Object(D.o)()],e.prototype,"position",void 0),e}(),oo=function(e,t,n,i){for(var r=0,o=t.materials.length;r<o;r++){var a=t.materials[r];if(a.id===e)return Pr.a.Parse(a,n,i)}return null},ao=function(e,t,n){for(var i in t)if(e.name===t[i])return n.push(e.id),!0;return!(!e.parentId||-1===n.indexOf(e.parentId)||(n.push(e.id),0))},so=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},lo=function(e,t){var n=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var i=t._waitingData.lods.ids,r=n.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=i.length){var a=o.length>i.length?o[o.length-1]:0;n.setEnabled(!1);for(var s=0;s<i.length;s++){var l=e.getMeshByID(i[s]);null!=l&&n.addLODLevel(o[s],l)}a>0&&n.addLODLevel(a,null),!0===r&&n.setEnabled(!0)}else be.h.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},co=function(e,t,n,r,o){void 0===o&&(o=!1);var s=new ge(e),l="importScene has failed JSON parse";try{var c=JSON.parse(t);l="";var u,h,d=fi.loggingLevel===fi.DETAILED_LOGGING;if(null!=c.environmentTexture){var f=void 0===c.isPBR||c.isPBR;if(c.environmentTextureType&&"BABYLON.HDRCubeTexture"===c.environmentTextureType){var g=c.environmentTextureSize?c.environmentTextureSize:128,m=new Xr((c.environmentTexture.match(/https?:\/\//g)?"":n)+c.environmentTexture,e,g,!0,!f);c.environmentTextureRotationY&&(m.rotationY=c.environmentTextureRotationY),e.environmentTexture=m}else if(be.h.EndsWith(c.environmentTexture,".env")){var _=new Hi((c.environmentTexture.match(/https?:\/\//g)?"":n)+c.environmentTexture,e);c.environmentTextureRotationY&&(_.rotationY=c.environmentTextureRotationY),e.environmentTexture=_}else{var v=Hi.CreateFromPrefilteredData((c.environmentTexture.match(/https?:\/\//g)?"":n)+c.environmentTexture,e);c.environmentTextureRotationY&&(v.rotationY=c.environmentTextureRotationY),e.environmentTexture=v}!0===c.createDefaultSkybox&&e.createDefaultSkybox(e.environmentTexture,f,null!=e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,c.skyboxBlurLevel||0),s.environmentTexture=e.environmentTexture}if(null!=c.lights)for(u=0,h=c.lights.length;u<h;u++){var b=ki.a.Parse(c.lights[u],e);b&&(s.lights.push(b),l+=0===u?"\n\tLights:":"",l+="\n\t\t"+b.toString(d))}if(null!=c.reflectionProbes)for(u=0,h=c.reflectionProbes.length;u<h;u++){var y=ro.Parse(c.reflectionProbes[u],e,n);y&&(s.reflectionProbes.push(y),l+=0===u?"\n\tReflection Probes:":"",l+="\n\t\t"+y.toString(d))}if(null!=c.animations)for(u=0,h=c.animations.length;u<h;u++){var T=c.animations[u],E=a.a.GetClass("BABYLON.Animation");if(E){var x=E.Parse(T);e.animations.push(x),s.animations.push(x),l+=0===u?"\n\tAnimations:":"",l+="\n\t\t"+x.toString(d)}}if(null!=c.materials)for(u=0,h=c.materials.length;u<h;u++){var C=Pr.a.Parse(c.materials[u],e,n);C&&(s.materials.push(C),l+=0===u?"\n\tMaterials:":"",l+="\n\t\t"+C.toString(d),C.getActiveTextures().forEach(function(e){-1==s.textures.indexOf(e)&&s.textures.push(e)}))}if(null!=c.multiMaterials)for(u=0,h=c.multiMaterials.length;u<h;u++){var S=jr.a.ParseMultiMaterial(c.multiMaterials[u],e);s.multiMaterials.push(S),l+=0===u?"\n\tMultiMaterials:":"",l+="\n\t\t"+S.toString(d),S.getActiveTextures().forEach(function(e){-1==s.textures.indexOf(e)&&s.textures.push(e)})}if(null!=c.morphTargetManagers)for(var A=0,P=c.morphTargetManagers;A<P.length;A++)s.morphTargetManagers.push(Kr.Parse(P[A],e));if(null!=c.skeletons)for(u=0,h=c.skeletons.length;u<h;u++){var M=He.Parse(c.skeletons[u],e);s.skeletons.push(M),l+=0===u?"\n\tSkeletons:":"",l+="\n\t\t"+M.toString(d)}var O=c.geometries;if(null!=O){var w=new Array,I=O.vertexData;if(null!=I)for(u=0,h=I.length;u<h;u++)w.push(zr.a.Parse(I[u],e,n));w.forEach(function(e){e&&s.geometries.push(e)})}if(null!=c.transformNodes)for(u=0,h=c.transformNodes.length;u<h;u++){var D=$i.a.Parse(c.transformNodes[u],e,n);s.transformNodes.push(D)}if(null!=c.meshes)for(u=0,h=c.meshes.length;u<h;u++){var L=fe.a.Parse(c.meshes[u],e,n);s.meshes.push(L),l+=0===u?"\n\tMeshes:":"",l+="\n\t\t"+L.toString(d)}if(null!=c.cameras)for(u=0,h=c.cameras.length;u<h;u++){var k=Ne.a.Parse(c.cameras[u],e);s.cameras.push(k),l+=0===u?"\n\tCameras:":"",l+="\n\t\t"+k.toString(d)}if(null!=c.animationGroups)for(u=0,h=c.animationGroups.length;u<h;u++){var N=Z.Parse(c.animationGroups[u],e);s.animationGroups.push(N),l+=0===u?"\n\tAnimationGroups:":"",l+="\n\t\t"+N.toString(d)}for(u=0,h=e.cameras.length;u<h;u++)(k=e.cameras[u])._waitingParentId&&(k.parent=e.getLastEntryByID(k._waitingParentId),k._waitingParentId=null);for(u=0,h=e.lights.length;u<h;u++){var F=e.lights[u];F&&F._waitingParentId&&(F.parent=e.getLastEntryByID(F._waitingParentId),F._waitingParentId=null)}for(u=0,h=e.transformNodes.length;u<h;u++){var B=e.transformNodes[u];B._waitingParentId&&(B.parent=e.getLastEntryByID(B._waitingParentId),B._waitingParentId=null)}for(u=0,h=e.meshes.length;u<h;u++)(L=e.meshes[u])._waitingParentId&&(L.parent=e.getLastEntryByID(L._waitingParentId),L._waitingParentId=null),L._waitingData.lods&&lo(e,L);for(u=0,h=e.skeletons.length;u<h;u++)(M=e.skeletons[u])._hasWaitingData&&(null!=M.bones&&M.bones.forEach(function(t){if(t._waitingTransformNodeId){var n=e.getLastEntryByID(t._waitingTransformNodeId);n&&t.linkTransformNode(n),t._waitingTransformNodeId=null}}),M._hasWaitingData=null);for(u=0,h=e.meshes.length;u<h;u++){var U=e.meshes[u];U._waitingData.freezeWorldMatrix?(U.freezeWorldMatrix(),U._waitingData.freezeWorldMatrix=null):U.computeWorldMatrix(!0)}for(u=0,h=e.lights.length;u<h;u++){var V=e.lights[u];if(V._excludedMeshesIds.length>0){for(var G=0;G<V._excludedMeshesIds.length;G++){var z=e.getMeshByID(V._excludedMeshesIds[G]);z&&V.excludedMeshes.push(z)}V._excludedMeshesIds=[]}if(V._includedOnlyMeshesIds.length>0){for(var j=0;j<V._includedOnlyMeshesIds.length;j++){var H=e.getMeshByID(V._includedOnlyMeshesIds[j]);H&&V.includedOnlyMeshes.push(H)}V._includedOnlyMeshesIds=[]}}for(i.a.Parse(c,e,s,n),u=0,h=e.meshes.length;u<h;u++)(L=e.meshes[u])._waitingData.actions&&(R.Parse(L._waitingData.actions,L,e),L._waitingData.actions=null);null!=c.actions&&R.Parse(c.actions,null,e),o||s.removeAllFromScene()}catch(e){var W=so("loadAssets",c?c.producer:"Unknown")+l;if(!r)throw p.a.Log(W),e;r(W,e)}finally{null!==l&&fi.loggingLevel!==fi.NO_LOGGING&&p.a.Log(so("loadAssets",c?c.producer:"Unknown")+(fi.loggingLevel!==fi.MINIMAL_LOGGING?l:""))}return s};fi.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(e,t,n,r,o,a,s,l){var c="importMesh has failed JSON parse";try{var u=JSON.parse(n);c="";var h=fi.loggingLevel===fi.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;var d=new Array;if(null!=u.meshes){var f,g,m,_=[],v=[];for(f=0,g=u.meshes.length;f<g;f++){var b=u.meshes[f];if(null===e||ao(b,e,d)){if(null!==e&&delete e[e.indexOf(b.name)],null!=b.geometryId&&null!=u.geometries){var y=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(e){!0!==y&&u.geometries[e]&&Array.isArray(u.geometries[e])&&u.geometries[e].forEach(function(n){if(n.id===b.geometryId){switch(e){case"vertexData":zr.a.Parse(n,t,r)}y=!0}})}),!1===y&&p.a.Warn("Geometry not found for mesh "+b.id)}if(b.materialId){var T=-1!==v.indexOf(b.materialId);if(!1===T&&null!=u.multiMaterials)for(var E=0,x=u.multiMaterials.length;E<x;E++){var C=u.multiMaterials[E];if(C.id===b.materialId){for(var S=0,A=C.materials.length;S<A;S++){var P,R=C.materials[S];v.push(R),(P=oo(R,u,t,r))&&(c+="\n\tMaterial "+P.toString(h))}v.push(C.id);var M=jr.a.ParseMultiMaterial(C,t);M&&(T=!0,c+="\n\tMulti-Material "+M.toString(h));break}}!1===T&&(v.push(b.materialId),(P=oo(b.materialId,u,t,r))?c+="\n\tMaterial "+P.toString(h):p.a.Warn("Material not found for mesh "+b.id))}if(b.skeletonId>-1&&null!=u.skeletons&&0==_.indexOf(b.skeletonId)>-1)for(var O=0,w=u.skeletons.length;O<w;O++){var I=u.skeletons[O];if(I.id===b.skeletonId){var D=He.Parse(I,t);s.push(D),_.push(I.id),c+="\n\tSkeleton "+D.toString(h)}}if(null!=u.morphTargetManagers)for(var L=0,k=u.morphTargetManagers;L<k.length;L++)Kr.Parse(k[L],t);var N=fe.a.Parse(b,t,r);o.push(N),c+="\n\tMesh "+N.toString(h)}}for(f=0,g=t.meshes.length;f<g;f++)(m=t.meshes[f])._waitingParentId&&(m.parent=t.getLastEntryByID(m._waitingParentId),m._waitingParentId=null),m._waitingData.lods&&lo(t,m);for(f=0,g=t.skeletons.length;f<g;f++)(D=t.skeletons[f])._hasWaitingData&&(null!=D.bones&&D.bones.forEach(function(e){if(e._waitingTransformNodeId){var n=t.getLastEntryByID(e._waitingTransformNodeId);n&&e.linkTransformNode(n),e._waitingTransformNodeId=null}}),D._hasWaitingData=null);for(f=0,g=t.meshes.length;f<g;f++)(m=t.meshes[f])._waitingData.freezeWorldMatrix?(m.freezeWorldMatrix(),m._waitingData.freezeWorldMatrix=null):m.computeWorldMatrix(!0)}if(null!=u.particleSystems){var F=i.a.GetIndividualParser(xe.a.NAME_PARTICLESYSTEM);if(F)for(f=0,g=u.particleSystems.length;f<g;f++){var B=u.particleSystems[f];-1!==d.indexOf(B.emitterId)&&a.push(F(B,t,r))}}return!0}catch(e){var U=so("importMesh",u?u.producer:"Unknown")+c;if(!l)throw p.a.Log(U),e;l(U,e)}finally{null!==c&&fi.loggingLevel!==fi.NO_LOGGING&&p.a.Log(so("importMesh",u?u.producer:"Unknown")+(fi.loggingLevel!==fi.MINIMAL_LOGGING?c:""))}return!1},load:function(e,t,n,i){var r="importScene has failed JSON parse";try{var a=JSON.parse(t);if(r="",null!=a.useDelayedTextureLoading&&(e.useDelayedTextureLoading=a.useDelayedTextureLoading&&!fi.ForceFullSceneLoadingForIncremental),null!=a.autoClear&&(e.autoClear=a.autoClear),null!=a.clearColor&&(e.clearColor=o.f.FromArray(a.clearColor)),null!=a.ambientColor&&(e.ambientColor=o.e.FromArray(a.ambientColor)),null!=a.gravity&&(e.gravity=o.x.FromArray(a.gravity)),a.fogMode&&0!==a.fogMode)switch(e.fogMode=a.fogMode,e.fogColor=o.e.FromArray(a.fogColor),e.fogStart=a.fogStart,e.fogEnd=a.fogEnd,e.fogDensity=a.fogDensity,r+="\tFog mode for scene:  ",e.fogMode){case 1:r+="exp\n";break;case 2:r+="exp2\n";break;case 3:r+="linear\n"}if(a.physicsEnabled){var s;"cannon"===a.physicsEngine?s=new $r:"oimo"===a.physicsEngine?s=new eo:"ammo"===a.physicsEngine&&(s=new io),r="\tPhysics engine "+(a.physicsEngine?a.physicsEngine:"oimo")+" enabled\n";var l=a.physicsGravity?o.x.FromArray(a.physicsGravity):null;e.enablePhysics(l,s)}if(null!=a.metadata&&(e.metadata=a.metadata),null!=a.collisionsEnabled&&(e.collisionsEnabled=a.collisionsEnabled),!co(e,t,n,i,!0))return!1;if(a.autoAnimate&&e.beginAnimation(e,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),null!=a.activeCameraID&&e.setActiveCameraByID(a.activeCameraID),null!=a.environmentTexture){var c=void 0===a.isPBR||a.isPBR;if(a.environmentTextureType&&"BABYLON.HDRCubeTexture"===a.environmentTextureType){var u=new Xr(n+a.environmentTexture,e,a.environmentTextureSize?a.environmentTextureSize:128,!0,!c);a.environmentTextureRotationY&&(u.rotationY=a.environmentTextureRotationY),e.environmentTexture=u}else if(be.h.EndsWith(a.environmentTexture,".env")){var h=new Hi(n+a.environmentTexture,e);a.environmentTextureRotationY&&(h.rotationY=a.environmentTextureRotationY),e.environmentTexture=h}else{var d=Hi.CreateFromPrefilteredData(n+a.environmentTexture,e);a.environmentTextureRotationY&&(d.rotationY=a.environmentTextureRotationY),e.environmentTexture=d}!0===a.createDefaultSkybox&&e.createDefaultSkybox(e.environmentTexture,c,null!=e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,a.skyboxBlurLevel||0)}return!0}catch(e){var f=so("importScene",a?a.producer:"Unknown")+r;if(!i)throw p.a.Log(f),e;i(f,e)}finally{null!==r&&fi.loggingLevel!==fi.NO_LOGGING&&p.a.Log(so("importScene",a?a.producer:"Unknown")+(fi.loggingLevel!==fi.MINIMAL_LOGGING?r:""))}return!1},loadAssetContainer:function(e,t,n,i){return co(e,t,n,i)}});var uo=n(93),ho=function(){function e(){this._isEnabled=!0,this.leftColor=o.e.White(),this.rightColor=o.e.Black(),this.bias=0,this.power=1}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,me.b.MarkAllMaterialsAsDirty(g.a.MATERIAL_FresnelDirtyFlag|g.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return P.a.DeepCopy(this,t),t},e.prototype.serialize=function(){var e={};return e.isEnabled=this.isEnabled,e.leftColor=this.leftColor.asArray(),e.rightColor=this.rightColor.asArray(),e.bias=this.bias,e.power=this.power,e},e.Parse=function(t){var n=new e;return n.isEnabled=t.isEnabled,n.leftColor=o.e.FromArray(t.leftColor),n.rightColor=o.e.FromArray(t.rightColor),n.bias=t.bias,n.power=t.power||1,n},e}();D.a._FresnelParametersParser=ho.Parse;var fo=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.maxSimultaneousLights=4,i.disableLighting=!1,i.invertNormalMapX=!1,i.invertNormalMapY=!1,i.emissiveColor=new o.e(0,0,0),i.occlusionStrength=1,i.useLightmapAsShadowmap=!1,i._useAlphaFromAlbedoTexture=!0,i._useAmbientInGrayScale=!0,i}return c.d(t,e),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),c.c([Object(D.e)("emissive"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),c.c([Object(D.c)()],t.prototype,"doubleSided",null),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(lr),po=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._useRoughnessFromMetallicTextureAlpha=!1,i._useRoughnessFromMetallicTextureGreen=!0,i._useMetallnessFromMetallicTextureBlue=!0,i.metallic=1,i.roughness=1,i}return c.d(t,e),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var n=this,i=D.a.Clone(function(){return new t(e,n.getScene())},this);return i.id=e,i.name=e,this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),i},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,i){var r=D.a.Parse(function(){return new t(e.name,n)},e,n,i);return e.clearCoat&&r.clearCoat.parse(e.clearCoat),e.anisotropy&&r.anisotropy.parse(e.anisotropy),e.brdf&&r.brdf.parse(e.brdf),e.sheen&&r.sheen.parse(e.brdf),r},c.c([Object(D.e)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(fo);a.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=po;var go=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._useMicroSurfaceFromReflectivityMapAlpha=!0,i}return c.d(t,e),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var n=this,i=D.a.Clone(function(){return new t(e,n.getScene())},this);return i.id=e,i.name=e,this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),i},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,i){var r=D.a.Parse(function(){return new t(e.name,n)},e,n,i);return e.clearCoat&&r.clearCoat.parse(e.clearCoat),e.anisotropy&&r.anisotropy.parse(e.anisotropy),e.brdf&&r.brdf.parse(e.brdf),e.sheen&&r.sheen.parse(e.brdf),r},c.c([Object(D.e)("diffuse"),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),c.c([Object(D.e)("specular"),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),c.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),c.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(fo);a.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=go;var mo=n(76),_o=function(e){function t(t,n){var i=e.call(this,n)||this;return t?(i._engine=n.getEngine(),i._textureMatrix=o.j.Identity(),i.name=t,i.url=t,i.hasAlpha=!1,i.isCube=!1,i.is3D=i._engine.webGLVersion>1,i.wrapU=g.a.TEXTURE_CLAMP_ADDRESSMODE,i.wrapV=g.a.TEXTURE_CLAMP_ADDRESSMODE,i.wrapR=g.a.TEXTURE_CLAMP_ADDRESSMODE,i.anisotropicFilteringLevel=1,i._texture=i._getFromCache(t,!0),i._texture||(n.useDelayedTextureLoading?i.delayLoadState=g.a.DELAYLOADSTATE_NOTLOADED:i.loadTexture()),i):i}return c.d(t,e),t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var e,n=this._engine;e=1===n.webGLVersion?n.createRawTexture(null,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE):n.createRawTexture3D(null,1,1,1,g.a.TEXTUREFORMAT_RGBA,!1,!1,g.a.TEXTURE_BILINEAR_SAMPLINGMODE),this._texture=e;var i=function(i){if("string"==typeof i){for(var r,o=null,a=null,s=i.split("\n"),l=0,c=0,u=0,h=0,d=0,f=0;f<s.length;f++)if(t._noneEmptyLineRegex.test(r=s[f])&&0!==r.indexOf("#")){var p=r.split(" ");if(0!==l){if(0!=l){var m=Math.max(parseInt(p[0]),0),_=Math.max(parseInt(p[1]),0),v=Math.max(parseInt(p[2]),0);d=Math.max(m,d),d=Math.max(_,d),d=Math.max(v,d);var b=4*(c+h*l+u*l*l);a&&(a[b+0]=m,a[b+1]=_,a[b+2]=v),++u%l==0&&(u=0,++h%l==0&&(c++,h=0))}}else l=p.length,o=new Uint8Array(l*l*l*4),a=new Float32Array(l*l*l*4)}if(a&&o)for(f=0;f<a.length;f++)o[f]=f>0&&(f+1)%4==0?255:a[f]/d*255;e.is3D?(e.updateSize(l,l,l),n.updateRawTexture3D(e,o,g.a.TEXTUREFORMAT_RGBA,!1)):(e.updateSize(l*l,l),n.updateRawTexture(e,o,g.a.TEXTUREFORMAT_RGBA,!1))}},r=this.getScene();return r?r._loadFile(this.url,i):this._engine._loadFile(this.url,i),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene());return e.level=this.level,e},t.prototype.delayLoad=function(){this.delayLoadState===g.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=g.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(e,n){var i=null;return e.name&&!e.isRenderTarget&&((i=new t(e.name,n)).name=e.name,i.level=e.level),i},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._noneEmptyLineRegex=/\S+/,t}(Gi.a);a.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=_o;var vo=function(e){function t(t,n,i,r,o,a,s){void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===a&&(a=null),void 0===s&&(s=null);var l=e.call(this,n)||this;if(l._onLoad=null,l._onError=null,l.coordinatesMode=Ge.a.CUBIC_MODE,!t)throw new Error("Image url is not set");return l.name=t,l.url=t,l._size=i,l._noMipmap=r,l.gammaSpace=o,l._onLoad=a,l._onError=s,l.hasAlpha=!1,l.isCube=!0,l._texture=l._getFromCache(t,l._noMipmap),l._texture?a&&(l._texture.isReady?be.h.SetImmediate(function(){return a()}):l._texture.onLoadedObservable.add(a)):n.useDelayedTextureLoading?l.delayLoadState=me.b.DELAYLOADSTATE_NOTLOADED:l.loadImage(l.loadTexture.bind(l),l._onError),l}return c.d(t,e),t.prototype.loadImage=function(e,t){var n=this,i=document.createElement("canvas"),r=new Image;r.addEventListener("load",function(){n._width=r.width,n._height=r.height,i.width=n._width,i.height=n._height;var t=i.getContext("2d");t.drawImage(r,0,0);var o=t.getImageData(0,0,r.width,r.height);n._buffer=o.data.buffer,i.remove(),e()}),r.addEventListener("error",function(e){t&&t(n.getClassName()+" could not be loaded",e)}),r.src=this.url},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,me.b.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?me.b.TEXTURETYPE_FLOAT:me.b.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var n=e.getFloat32ArrayFromArrayBuffer(e._buffer),i=Hr.ConvertPanoramaToCubemap(n,e._width,e._height,e._size),r=[],o=0;o<6;o++)r.push(i[t._FacesMapping[o]]);return r},null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(e){for(var t=new DataView(e),n=new Float32Array(3*e.byteLength/4),i=0,r=0;r<e.byteLength;r++)(r+1)%4!=0&&(n[i++]=t.getUint8(r)/255);return n},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t._FacesMapping=["right","left","up","down","front","back"],t}(Gi.a),bo=function(){function e(){}return e.GetTGAHeader=function(e){var t=0;return{id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]}},e.UploadContent=function(t,n){if(n.length<19)p.a.Error("Unable to load TGA file - Not enough data to contain header");else{var i=18,r=e.GetTGAHeader(n);if(r.id_length+i>n.length)p.a.Error("Unable to load TGA file - Not enough data");else{i+=r.id_length;var o,a=!1,s=!1,l=!1;switch(r.image_type){case e._TYPE_RLE_INDEXED:a=!0;case e._TYPE_INDEXED:s=!0;break;case e._TYPE_RLE_RGB:a=!0;case e._TYPE_RGB:break;case e._TYPE_RLE_GREY:a=!0;case e._TYPE_GREY:l=!0}var c,u,h,d,f,g,m,_=r.pixel_size>>3,v=r.width*r.height*_;if(s&&(c=n.subarray(i,i+=r.colormap_length*(r.colormap_size>>3))),a){var b,y,T;o=new Uint8Array(v);for(var E=0,x=new Uint8Array(_);i<v&&E<v;)if(y=1+(127&(b=n[i++])),128&b){for(T=0;T<_;++T)x[T]=n[i++];for(T=0;T<y;++T)o.set(x,E+T*_);E+=_*y}else{for(y*=_,T=0;T<y;++T)o[E+T]=n[i++];E+=y}}else o=n.subarray(i,i+=s?r.width*r.height:v);switch((r.flags&e._ORIGIN_MASK)>>e._ORIGIN_SHIFT){default:case e._ORIGIN_UL:u=0,d=1,m=r.width,h=0,f=1,g=r.height;break;case e._ORIGIN_BL:u=0,d=1,m=r.width,h=r.height-1,f=-1,g=-1;break;case e._ORIGIN_UR:u=r.width-1,d=-1,m=-1,h=0,f=1,g=r.height;break;case e._ORIGIN_BR:u=r.width-1,d=-1,m=-1,h=r.height-1,f=-1,g=-1}var C=e["_getImageData"+(l?"Grey":"")+r.pixel_size+"bits"](r,c,o,h,f,g,u,d,m);t.getEngine()._uploadDataToTextureDirectly(t,C)}}},e._getImageData8bits=function(e,t,n,i,r,o,a,s,l){var c,u,h,d=n,f=t,p=e.width,g=0,m=new Uint8Array(p*e.height*4);for(h=i;h!==o;h+=r)for(u=a;u!==l;u+=s,g++)c=d[g],m[4*(u+p*h)+3]=255,m[4*(u+p*h)+2]=f[3*c+0],m[4*(u+p*h)+1]=f[3*c+1],m[4*(u+p*h)+0]=f[3*c+2];return m},e._getImageData16bits=function(e,t,n,i,r,o,a,s,l){var c,u,h,d=n,f=e.width,p=0,g=new Uint8Array(f*e.height*4);for(h=i;h!==o;h+=r)for(u=a;u!==l;u+=s,p+=2){var m=255*((31744&(c=d[p+0]+(d[p+1]<<8)))>>10)/31|0,_=255*((992&c)>>5)/31|0,v=255*(31&c)/31|0;g[4*(u+f*h)+0]=m,g[4*(u+f*h)+1]=_,g[4*(u+f*h)+2]=v,g[4*(u+f*h)+3]=32768&c?0:255}return g},e._getImageData24bits=function(e,t,n,i,r,o,a,s,l){var c,u,h=n,d=e.width,f=0,p=new Uint8Array(d*e.height*4);for(u=i;u!==o;u+=r)for(c=a;c!==l;c+=s,f+=3)p[4*(c+d*u)+3]=255,p[4*(c+d*u)+2]=h[f+0],p[4*(c+d*u)+1]=h[f+1],p[4*(c+d*u)+0]=h[f+2];return p},e._getImageData32bits=function(e,t,n,i,r,o,a,s,l){var c,u,h=n,d=e.width,f=0,p=new Uint8Array(d*e.height*4);for(u=i;u!==o;u+=r)for(c=a;c!==l;c+=s,f+=4)p[4*(c+d*u)+2]=h[f+0],p[4*(c+d*u)+1]=h[f+1],p[4*(c+d*u)+0]=h[f+2],p[4*(c+d*u)+3]=h[f+3];return p},e._getImageDataGrey8bits=function(e,t,n,i,r,o,a,s,l){var c,u,h,d=n,f=e.width,p=0,g=new Uint8Array(f*e.height*4);for(h=i;h!==o;h+=r)for(u=a;u!==l;u+=s,p++)g[4*(u+f*h)+0]=c=d[p],g[4*(u+f*h)+1]=c,g[4*(u+f*h)+2]=c,g[4*(u+f*h)+3]=255;return g},e._getImageDataGrey16bits=function(e,t,n,i,r,o,a,s,l){var c,u,h=n,d=e.width,f=0,p=new Uint8Array(d*e.height*4);for(u=i;u!==o;u+=r)for(c=a;c!==l;c+=s,f+=2)p[4*(c+d*u)+0]=h[f+0],p[4*(c+d*u)+1]=h[f+0],p[4*(c+d*u)+2]=h[f+0],p[4*(c+d*u)+3]=h[f+1];return p},e._TYPE_INDEXED=1,e._TYPE_RGB=2,e._TYPE_GREY=3,e._TYPE_RLE_INDEXED=9,e._TYPE_RLE_RGB=10,e._TYPE_RLE_GREY=11,e._ORIGIN_MASK=48,e._ORIGIN_SHIFT=4,e._ORIGIN_BL=0,e._ORIGIN_BR=1,e._ORIGIN_UL=2,e._ORIGIN_UR=3,e}(),yo=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,i,r){return 0===e.indexOf(".tga")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,i,r){throw".env not supported in Cube."},e.prototype.loadData=function(e,t,n){var i=new Uint8Array(e),r=bo.GetTGAHeader(i);n(r.width,r.height,t.generateMipMaps,!1,function(){bo.UploadContent(t,i)})},e}();me.b._TextureLoaders.push(new yo),me.b.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e[0]._MSAAFramebuffer){i.bindFramebuffer(i.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e[0]._framebuffer);var r=e[0]._attachments;r||(r=new Array(e.length),e[0]._attachments=r);for(var o=0;o<e.length;o++){for(var a=e[o],s=0;s<r.length;s++)r[s]=i.NONE;r[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"],i.readBuffer(r[o]),i.drawBuffers(r),i.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,i.COLOR_BUFFER_BIT,i.NEAREST)}for(o=0;o<r.length;o++)r[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"];i.drawBuffers(r)}for(o=0;o<e.length;o++)!(a=e[o]).generateMipMaps||t||a.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,a),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null));n&&(e[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(e[0]._framebuffer),n()),this._bindUnboundFramebuffer(null)},me.b.prototype.createMultipleRenderTarget=function(e,t){var n=!1,i=!0,r=!1,o=!1,a=1,s=me.b.TEXTURETYPE_UNSIGNED_INT,l=me.b.TEXTURE_TRILINEAR_SAMPLINGMODE,c=new Array,u=new Array;void 0!==t&&(n=void 0!==t.generateMipMaps&&t.generateMipMaps,i=void 0===t.generateDepthBuffer||t.generateDepthBuffer,r=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,o=void 0!==t.generateDepthTexture&&t.generateDepthTexture,a=t.textureCount||1,t.types&&(c=t.types),t.samplingModes&&(u=t.samplingModes));var h=this._gl,d=h.createFramebuffer();this._bindUnboundFramebuffer(d);for(var f=e.width||e,g=e.height||e,m=[],_=[],v=this._setupFramebufferDepthAttachments(r,i,f,g),b=0;b<a;b++){var y=u[b]||l,T=c[b]||s;(T!==me.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(T!==me.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(y=me.b.TEXTURE_NEAREST_SAMPLINGMODE);var E=this._getSamplingParameters(y,n);T!==me.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(T=me.b.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var x=new ze.a(this,ze.a.DATASOURCE_MULTIRENDERTARGET),C=h[this.webGLVersion>1?"COLOR_ATTACHMENT"+b:"COLOR_ATTACHMENT"+b+"_WEBGL"];m.push(x),_.push(C),h.activeTexture(h["TEXTURE"+b]),h.bindTexture(h.TEXTURE_2D,x._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,E.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,E.min),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(T),f,g,0,h.RGBA,this._getWebGLTextureType(T),null),h.framebufferTexture2D(h.DRAW_FRAMEBUFFER,C,h.TEXTURE_2D,x._webGLTexture,0),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),x._framebuffer=d,x._depthStencilBuffer=v,x.baseWidth=f,x.baseHeight=g,x.width=f,x.height=g,x.isReady=!0,x.samples=1,x.generateMipMaps=n,x.samplingMode=y,x.type=T,x._generateDepthBuffer=i,x._generateStencilBuffer=r,x._attachments=_,this._internalTexturesCache.push(x)}if(o&&this._caps.depthTextureExtension){var S=new ze.a(this,ze.a.DATASOURCE_MULTIRENDERTARGET);h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,S._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this.webGLVersion<2?h.DEPTH_COMPONENT:h.DEPTH_COMPONENT16,f,g,0,h.DEPTH_COMPONENT,h.UNSIGNED_SHORT,null),h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.TEXTURE_2D,S._webGLTexture,0),S._framebuffer=d,S.baseWidth=f,S.baseHeight=g,S.width=f,S.height=g,S.isReady=!0,S.samples=1,S.generateMipMaps=n,S.samplingMode=h.NEAREST,S._generateDepthBuffer=i,S._generateStencilBuffer=r,m.push(S),this._internalTexturesCache.push(S)}return h.drawBuffers(_),h.bindRenderbuffer(h.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),this.resetTextureCache(),m},me.b.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===t)return t;var n=this._gl;t=Math.min(t,n.getParameter(n.MAX_SAMPLES)),e[0]._depthStencilBuffer&&(n.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(n.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var i=0;i<e.length;i++)e[i]._MSAARenderBuffer&&(n.deleteRenderbuffer(e[i]._MSAARenderBuffer),e[i]._MSAARenderBuffer=null);if(t>1){var r=n.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(r);var o=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,t),a=[];for(i=0;i<e.length;i++){var s=e[i],l=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"],c=n.createRenderbuffer();if(!c)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,c),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(s.type),s.width,s.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,l,n.RENDERBUFFER,c),s._MSAAFramebuffer=r,s._MSAARenderBuffer=c,s.samples=t,s._depthStencilBuffer=o,n.bindRenderbuffer(n.RENDERBUFFER,null),a.push(l)}n.drawBuffers(a)}else this._bindUnboundFramebuffer(e[0]._framebuffer);return this._bindUnboundFramebuffer(null),t};var To=function(e){function t(t,n,i,r,o){var a=this,s=!(!o||!o.generateMipMaps)&&o.generateMipMaps,l=!(!o||!o.generateDepthTexture)&&o.generateDepthTexture;if((a=e.call(this,t,n,r,s,!o||void 0===o.doNotChangeAspectRatio||o.doNotChangeAspectRatio)||this)._engine=r.getEngine(),a.isSupported){for(var c=[],u=[],h=0;h<i;h++)c.push(o&&o.types&&void 0!==o.types[h]?o.types[h]:o&&o.defaultType?o.defaultType:g.a.TEXTURETYPE_UNSIGNED_INT),u.push(o&&o.samplingModes&&void 0!==o.samplingModes[h]?o.samplingModes[h]:Ge.a.BILINEAR_SAMPLINGMODE);var d=!o||void 0===o.generateDepthBuffer||o.generateDepthBuffer,f=!(!o||void 0===o.generateStencilBuffer)&&o.generateStencilBuffer;return a._size=n,a._multiRenderTargetOptions={samplingModes:u,generateMipMaps:s,generateDepthBuffer:d,generateStencilBuffer:f,generateDepthTexture:l,types:c,textureCount:i},a._createInternalTextures(),a._createTextures(),a}a.dispose()}return c.d(t,e),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapU=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapV=e},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var e=0;e<this._internalTextures.length;e++)this._textures[e]._texture=this._internalTextures[e];this._texture=this._internalTextures[0]},t.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var e=0;e<this._internalTextures.length;e++){var t=new Ge.a(null,this.getScene());t._texture=this._internalTextures[e],this._textures.push(t)}this._texture=this._internalTextures[0]},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!0,configurable:!0}),t.prototype.resize=function(e){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(e,this._multiRenderTargetOptions),this._createInternalTextures()},t.prototype.unbindFrameBuffer=function(e,t){var n=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(t)})},t.prototype.dispose=function(){this.releaseInternalTextures(),e.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)void 0!==this._internalTextures[e]&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},t}(cn),Eo=function(){function e(e){this.name=xe.a.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=new Array,e.layers=new Array}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(xe.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){be.h.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var e=0;e<this.scene.proceduralTextures.length;e++){var t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}be.h.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}();zt.a.ShadersStore.proceduralVertexShader="\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";var xo=function(e){function t(t,n,i,o,a,s,l){void 0===a&&(a=null),void 0===s&&(s=!0),void 0===l&&(l=!1);var c=e.call(this,null,o,!s)||this;c.isCube=l,c.isEnabled=!0,c.autoClear=!0,c.onGeneratedObservable=new r.c,c._textures={},c._currentRefreshId=-1,c._refreshRate=1,c._vertexBuffers={},c._uniforms=new Array,c._samplers=new Array,c._floats={},c._ints={},c._floatsArrays={},c._colors3={},c._colors4={},c._vectors2={},c._vectors3={},c._matrices={},c._fallbackTextureUsed=!1,c._cachedDefines="",c._contentUpdateId=-1;var u=(o=c.getScene())._getComponent(xe.a.NAME_PROCEDURALTEXTURE);u||(u=new Eo(o),o._addComponent(u)),o.proceduralTextures.push(c),c._engine=o.getEngine(),c.name=t,c.isRenderTarget=!0,c._size=n,c._generateMipMaps=s,c.setFragment(i),c._fallbackTexture=a,l?(c._texture=c._engine.createRenderTargetCubeTexture(n,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1}),c.setFloat("face",0)):c._texture=c._engine.createRenderTargetTexture(n,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1});var h=[];return h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),c._vertexBuffers[Cn.b.PositionKind]=new Cn.b(c._engine,h,Cn.b.PositionKind,!1,!1,2),c._createIndexBuffer(),c}return c.d(t,e),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._currentRefreshId==this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._currentRefreshId,this._contentData)},t.prototype._createIndexBuffer=function(){var e=this._engine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},t.prototype._rebuild=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===cn.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=cn.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,t=this,n=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var i=this._getDefines();return!(!this._effect||i!==this._cachedDefines||!this._effect.isReady())||(e=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=i,this._effect=n.createEffect(e,[Cn.b.PositionKind],this._uniforms,this._samplers,i,void 0,void 0,function(){t.releaseInternalTexture(),t._fallbackTexture&&(t._texture=t._fallbackTexture._texture,t._texture&&t._texture.incrementReferences()),t._fallbackTextureUsed=!0}),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!(this._fallbackTextureUsed||(-1===this._currentRefreshId?(this._currentRefreshId=1,0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,0):(this._currentRefreshId++,1))):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(e,t),this._size=e,this._generateMipMaps=t)},t.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.render=function(e){var t=this.getScene();if(t){var n=this._engine;for(var i in n.enableEffect(this._effect),n.setState(!1),this._textures)this._effect.setTexture(i,this._textures[i]);for(i in this._ints)this._effect.setInt(i,this._ints[i]);for(i in this._floats)this._effect.setFloat(i,this._floats[i]);for(i in this._floatsArrays)this._effect.setArray(i,this._floatsArrays[i]);for(i in this._colors3)this._effect.setColor3(i,this._colors3[i]);for(i in this._colors4){var r=this._colors4[i];this._effect.setFloat4(i,r.r,r.g,r.b,r.a)}for(i in this._vectors2)this._effect.setVector2(i,this._vectors2[i]);for(i in this._vectors3)this._effect.setVector3(i,this._vectors3[i]);for(i in this._matrices)this._effect.setMatrix(i,this._matrices[i]);if(this._texture){if(this.isCube)for(var o=0;o<6;o++)n.bindFramebuffer(this._texture,o,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",o),this.autoClear&&n.clear(t.clearColor,!0,!1,!1),n.drawElementsType(Pr.a.TriangleFillMode,0,6),5===o&&n.generateMipMapsForCubemap(this._texture);else n.bindFramebuffer(this._texture,0,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&n.clear(t.clearColor,!0,!1,!1),n.drawElementsType(Pr.a.TriangleFillMode,0,6);n.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n},t.prototype.dispose=function(){var t=this.getScene();if(t){var n=t.proceduralTextures.indexOf(this);n>=0&&t.proceduralTextures.splice(n,1);var i=this._vertexBuffers[Cn.b.PositionKind];i&&(i.dispose(),this._vertexBuffers[Cn.b.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),e.prototype.dispose.call(this)}},c.c([Object(D.c)()],t.prototype,"isEnabled",void 0),c.c([Object(D.c)()],t.prototype,"autoClear",void 0),c.c([Object(D.c)()],t.prototype,"_generateMipMaps",void 0),c.c([Object(D.c)()],t.prototype,"_size",void 0),c.c([Object(D.c)()],t.prototype,"refreshRate",null),t}(Ge.a),Co=n(60),So=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t,i,null,r,o,a)||this;return s._animate=!0,s._time=0,s._texturePath=n,s._loadJson(n),s.refreshRate=1,s}return c.d(t,e),t.prototype._loadJson=function(e){var t=this,n=function(){p.a.Log("No config file found in "+e+" trying to use ShadersStore or DOM element");try{t.setFragment(t._texturePath)}catch(e){p.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},i=e+"/config.json",r=new Co.a;r.open("GET",i),r.addEventListener("load",function(){if(200===r.status||r.responseText&&r.responseText.length>0)try{t._config=JSON.parse(r.response),t.updateShaderUniforms(),t.updateTextures(),t.setFragment(t._texturePath+"/custom"),t._animate=t._config.animate,t.refreshRate=t._config.refreshrate}catch(e){n()}else n()},!1),r.addEventListener("error",function(){n()},!1);try{r.send()}catch(e){p.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var t in this._textures)if(!this._textures[t].isReady())return!1;return!0},t.prototype.render=function(t){var n=this.getScene();this._animate&&n&&(this._time+=.03*n.getAnimationRatio(),this.updateShaderUniforms()),e.prototype.render.call(this,t)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new Ge.a(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var t=this._config.uniforms[e];switch(t.type){case"float":this.setFloat(t.name,t.value);break;case"color3":this.setColor3(t.name,new o.e(t.r,t.g,t.b));break;case"color4":this.setColor4(t.name,new o.f(t.r,t.g,t.b,t.a));break;case"vector2":this.setVector2(t.name,new o.w(t.x,t.y));break;case"vector3":this.setVector3(t.name,new o.x(t.x,t.y,t.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),t}(xo);zt.a.ShadersStore.noisePixelShader="\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y);\nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n";var Ao=function(e){function t(t,n,i,r,o){void 0===n&&(n=256),void 0===i&&(i=A.a.LastCreatedScene);var a=e.call(this,t,n,"noise",i,r,o)||this;return a._time=0,a.brightness=.2,a.octaves=3,a.persistence=.8,a.animationSpeedFactor=1,a.autoClear=!1,a._updateShaderUniforms(),a}return c.d(t,e),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this._time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(t){this._updateShaderUniforms(),e.prototype.render.call(this,t)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e},t.Parse=function(e,n){var i=new t(e.name,e.size,n,void 0,e.generateMipMaps);return i.brightness=e.brightness,i.octaves=e.octaves,i.persistence=e.persistence,i.animationSpeedFactor=e.animationSpeedFactor,i},t}(xo);a.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=Ao;var Po=function(e){function t(t,n,i,r,o,a,s,l,c){void 0===r&&(r=g.a.TEXTUREFORMAT_RGBA),void 0===o&&(o=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=g.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===c&&(c=null);var u=e.call(this,"",t)||this;return u._texture=t.getEngine().createRawCubeTexture(n,i,r,o,a,s,l,c),u}return c.d(t,e),t.prototype.update=function(e,t,n,i,r){void 0===r&&(r=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,n,i,r)},t.prototype.updateRGBDAsync=function(e,n,i,r){return void 0===n&&(n=null),void 0===i&&(i=.8),void 0===r&&(r=0),t._UpdateRGBDAsync(this._texture,e,n,i,r)},t.prototype.clone=function(){var e=this;return D.a.Clone(function(){var n=e.getScene(),i=e._texture,r=new t(n,i._bufferViewArray,i.width,i.format,i.type,i.generateMipMaps,i.invertY,i.samplingMode,i._compression);return i.dataSource===ze.a.DATASOURCE_CUBERAW_RGBD&&r.updateRGBDAsync(i._bufferViewArrayArray,i._sphericalPolynomial,i._lodGenerationScale,i._lodGenerationOffset),r},this)},t._UpdateRGBDAsync=function(e,t,n,i,r){return e._dataSource=ze.a.DATASOURCE_CUBERAW_RGBD,e._bufferViewArrayArray=t,e._lodGenerationScale=i,e._lodGenerationOffset=r,e._sphericalPolynomial=n,br.UploadLevelsAsync(e,t).then(function(){e.isReady=!0})},t}(Hi),Ro=function(e){function t(t,n,i,r,o,a,s,l,c,u){void 0===s&&(s=!0),void 0===l&&(l=!1),void 0===c&&(c=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=g.a.TEXTURETYPE_UNSIGNED_INT);var h=e.call(this,null,a,!s,l)||this;return h.format=o,h._engine=a.getEngine(),h._texture=a.getEngine().createRawTexture3D(t,n,i,r,o,s,l,c,void 0,u),h.is3D=!0,h}return c.d(t,e),t.prototype.update=function(e){this._texture&&this._engine.updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Ge.a),Mo=function(e){function t(t,n,i,r){var a=e.call(this,t,n,i,r,!0)||this;return a.refractionPlane=new o.n(0,1,0,1),a.depth=2,a.onBeforeRenderObservable.add(function(){i.clipPlane=a.refractionPlane}),a.onAfterRenderObservable.add(function(){i.clipPlane=null}),a}return c.d(t,e),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),i=new t(this.name,n.width,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.refractionPlane=this.refractionPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i.depth=this.depth,i},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.refractionPlane.asArray(),t.depth=this.depth,t},t}(cn),Oo=function(e){function t(n,i,r){var a=e.call(this,r.scene)||this;return i&&(r.engine||r.scene)?(r=c.a({},t.DefaultOptions,r),a._engine=r.engine||r.scene.getEngine(),a._generateMipMaps=r.generateMipMaps,a._samplingMode=r.samplingMode,a._textureMatrix=o.j.Identity(),a.name=n,a.element=i,a._isVideo=i instanceof HTMLVideoElement,a.anisotropicFilteringLevel=1,a._createInternalTexture(),a):a}return c.d(t,e),t.prototype._createInternalTexture=function(){var e=0,t=0;this._isVideo?(e=this.element.videoWidth,t=this.element.videoHeight):(e=this.element.width,t=this.element.height),this._texture=this._engine.createDynamicTexture(e,t,this._generateMipMaps,this._samplingMode),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){if(void 0===e&&(e=null),null!=this._texture)if(this._isVideo){var t=this.element;if(t.readyState<t.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,t,null===e||e)}else this._engine.updateDynamicTexture(this._texture,this.element,null===e||e,!1)},t.DefaultOptions={generateMipMaps:!1,samplingMode:g.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(Gi.a),wo=function(){function e(e){this._pendingActions=new Array,this._workerInfos=e.map(function(e){return{worker:e,active:!1}})}return e.prototype.dispose=function(){for(var e=0,t=this._workerInfos;e<t.length;e++)t[e].worker.terminate();delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(e){for(var t=0,n=this._workerInfos;t<n.length;t++){var i=n[t];if(!i.active)return void this._execute(i,e)}this._pendingActions.push(e)},e.prototype._execute=function(e,t){var n=this;e.active=!0,t(e.worker,function(){e.active=!1;var t=n._pendingActions.shift();t&&n._execute(e,t)})},e}();function Io(e){return"function"==typeof importScripts?(importScripts(e),Promise.resolve()):new Promise(function(t,n){be.h.LoadScript(e,function(){t()},function(e){n(new Error(e))})})}function Do(e,t,n){var i=t&&e||n;if(i)return Io(i).then(function(){return new Promise(function(e){DracoDecoderModule({wasmBinary:t}).then(function(t){e({module:t})})})})}function Lo(e,t,n,i,r){var o=new e.DecoderBuffer;o.Init(t,t.byteLength);var a,s,l=new e.Decoder;try{var c=l.GetEncodedGeometryType(o);switch(c){case e.TRIANGULAR_MESH:a=new e.Mesh,s=l.DecodeBufferToMesh(o,a);break;case e.POINT_CLOUD:a=new e.PointCloud,s=l.DecodeBufferToPointCloud(o,a);break;default:throw new Error("Invalid geometry type "+c)}if(!s.ok()||!a.ptr)throw new Error(s.error_msg());var u=a.num_points();if(c===e.TRIANGULAR_MESH){var h=a.num_faces(),d=new e.DracoInt32Array;try{for(var f=new Uint32Array(3*h),p=0;p<h;p++){l.GetFaceFromMesh(a,p,d);var g=3*p;f[g+0]=d.GetValue(0),f[g+1]=d.GetValue(1),f[g+2]=d.GetValue(2)}i(f)}finally{e.destroy(d)}}var m=function(t,n){var i=new e.DracoFloat32Array;try{l.GetAttributeFloatForAllPoints(a,n,i);for(var o=new Float32Array(u*n.num_components()),s=0;s<o.length;s++)o[s]=i.GetValue(s);r(t,o)}finally{e.destroy(i)}};if(n)for(var _ in n){var v=n[_];m(_,l.GetAttributeByUniqueId(a,v))}else{var b={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var _ in b)-1!==(v=l.GetAttributeId(a,e[b[_]]))&&m(_,l.GetAttribute(a,v))}}finally{a&&e.destroy(a),e.destroy(l),e.destroy(o)}}function ko(e){return"object"!=typeof document||"string"!=typeof e?e:be.h.GetAbsoluteUrl(e)}var No=function(){function e(t){void 0===t&&(t=e.DefaultNumWorkers);var n,i=e.Configuration.decoder,r=i.wasmUrl&&i.wasmBinaryUrl&&"object"==typeof WebAssembly?(n=ko(i.wasmBinaryUrl),new Promise(function(e,t){be.h.LoadFile(n,function(t){e(t)},void 0,void 0,!0,function(e,n){t(n)})})):Promise.resolve(void 0);t&&"function"==typeof Worker?this._workerPoolPromise=r.then(function(e){for(var n=URL.createObjectURL(new Blob([""+Io+Do+Lo+"("+function(){var e;onmessage=function(t){var n=t.data;switch(n.id){case"init":var i=n.decoder;e=Do(i.wasmUrl,i.wasmBinary,i.fallbackUrl),postMessage("done");break;case"decodeMesh":if(!e)throw new Error("Draco decoder module is not available");e.then(function(e){Lo(e.module,n.dataView,n.attributes,function(e){postMessage({id:"indices",value:e},[e.buffer])},function(e,t){postMessage({id:e,value:t},[t.buffer])}),postMessage("done")})}}}+")()"],{type:"application/javascript"})),r=new Array(t),o=0;o<r.length;o++)r[o]=new Promise(function(t,r){var o=new Worker(n),a=function(e){o.removeEventListener("error",a),o.removeEventListener("message",s),r(e)},s=function(e){"done"===e.data&&(o.removeEventListener("error",a),o.removeEventListener("message",s),t(o))};o.addEventListener("error",a),o.addEventListener("message",s),o.postMessage({id:"init",decoder:{wasmUrl:ko(i.wasmUrl),wasmBinary:e,fallbackUrl:ko(i.fallbackUrl)}})});return Promise.all(r).then(function(e){return new wo(e)})}):this._decoderModulePromise=r.then(function(e){return Do(i.wasmUrl,e,i.fallbackUrl)})}return Object.defineProperty(e,"DecoderAvailable",{get:function(){var t=e.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&"object"==typeof WebAssembly||t.fallbackUrl)},enumerable:!0,configurable:!0}),e.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(e,"Default",{get:function(){return e._Default||(e._Default=new e),e._Default},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(e){e.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},e.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},e.prototype.decodeMeshAsync=function(e,t){var n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(e){return new Promise(function(i,r){e.push(function(e,o){var a=new xn.a,s=function(t){e.removeEventListener("error",s),e.removeEventListener("message",l),r(t),o()},l=function(t){"done"===t.data?(e.removeEventListener("error",s),e.removeEventListener("message",l),i(a),o()):"indices"===t.data.id?a.indices=t.data.value:a.set(t.data.value,t.data.id)};e.addEventListener("error",s),e.addEventListener("message",l);var c=new Uint8Array(n.byteLength);c.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),e.postMessage({id:"decodeMesh",dataView:c,attributes:t},[c.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(e){var i=new xn.a;return Lo(e.module,n,t,function(e){i.indices=e},function(e,t){i.set(t,e)}),i});throw new Error("Draco decoder module is not available")},e.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null,e}(),Fo=n(49),Bo=0,Uo=function(){function e(e,t,n){this.pos=e,this.normal=t,this.uv=n}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(t,n){return new e(o.x.Lerp(this.pos,t.pos,n),o.x.Lerp(this.normal,t.normal,n),o.w.Lerp(this.uv,t.uv,n))},e}(),Vo=function(){function e(e,t){this.normal=e,this.w=t}return e.FromPoints=function(t,n,i){var r=i.subtract(t),a=n.subtract(t);if(0===r.lengthSquared()||0===a.lengthSquared())return null;var s=o.x.Normalize(o.x.Cross(r,a));return new e(s,o.x.Dot(s,t))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(t,n,i,r,a){var s,l,c=0,u=[];for(s=0;s<t.vertices.length;s++){var h=(l=o.x.Dot(this.normal,t.vertices[s].pos)-this.w)<-e.EPSILON?2:l>e.EPSILON?1:0;c|=h,u.push(h)}switch(c){case 0:(o.x.Dot(this.normal,t.plane.normal)>0?n:i).push(t);break;case 1:r.push(t);break;case 2:a.push(t);break;case 3:var d,f=[],p=[];for(s=0;s<t.vertices.length;s++){var g=(s+1)%t.vertices.length,m=u[s],_=u[g],v=t.vertices[s],b=t.vertices[g];if(2!==m&&f.push(v),1!==m&&p.push(2!==m?v.clone():v),3==(m|_)){l=(this.w-o.x.Dot(this.normal,v.pos))/o.x.Dot(this.normal,b.pos.subtract(v.pos));var y=v.interpolate(b,l);f.push(y),p.push(y.clone())}}f.length>=3&&(d=new Go(f,t.shared)).plane&&r.push(d),p.length>=3&&(d=new Go(p,t.shared)).plane&&a.push(d)}},e.EPSILON=1e-5,e}(),Go=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=Vo.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(e){return e.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),zo=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,n=new Array,i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var n=new Array,i=new Array,r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,n,i);n.length&&(this.front||(this.front=new e),this.front.build(n)),i.length&&(this.back||(this.back=new e),this.back.build(i))}},e}(),jo=function(){function e(){this.polygons=new Array}return e.FromMesh=function(t){var n,i,r,a,s,l,c,u,h,d,f=new Array,p=null;if(!(t instanceof fe.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),c=t.getWorldMatrix(),u=t.position.clone(),h=t.rotation.clone(),t.rotationQuaternion&&(p=t.rotationQuaternion.clone()),d=t.scaling.clone();for(var g=t.getIndices(),m=t.getVerticesData(Cn.b.PositionKind),_=t.getVerticesData(Cn.b.NormalKind),v=t.getVerticesData(Cn.b.UVKind),b=t.subMeshes,y=0,T=b.length;y<T;y++)for(var E=b[y].indexStart,x=b[y].indexCount+b[y].indexStart;E<x;E+=3){l=[];for(var C=0;C<3;C++){var S=new o.x(_[3*g[E+C]],_[3*g[E+C]+1],_[3*g[E+C]+2]);r=new o.w(v[2*g[E+C]],v[2*g[E+C]+1]);var A=new o.x(m[3*g[E+C]],m[3*g[E+C]+1],m[3*g[E+C]+2]);a=o.x.TransformCoordinates(A,c),i=o.x.TransformNormal(S,c),n=new Uo(a,i,r),l.push(n)}(s=new Go(l,{subMeshId:y,meshId:Bo,materialIndex:b[y].materialIndex})).plane&&f.push(s)}var P=e.FromPolygons(f);return P.matrix=c,P.position=u,P.rotation=h,P.scaling=d,P.rotationQuaternion=p,Bo++,P},e.FromPolygons=function(t){var n=new e;return n.polygons=t,n},e.prototype.clone=function(){var t=new e;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},e.prototype.union=function(t){var n=new zo(this.clone().polygons),i=new zo(t.clone().polygons);return n.clipTo(i),i.clipTo(n),i.invert(),i.clipTo(n),i.invert(),n.build(i.allPolygons()),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),this.polygons=t.allPolygons()},e.prototype.subtract=function(t){var n=new zo(this.clone().polygons),i=new zo(t.clone().polygons);return n.invert(),n.clipTo(i),i.clipTo(n),i.invert(),i.clipTo(n),i.invert(),n.build(i.allPolygons()),n.invert(),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.intersect=function(t){var n=new zo(this.clone().polygons),i=new zo(t.clone().polygons);return n.invert(),i.clipTo(n),i.invert(),n.clipTo(i),i.clipTo(n),n.build(i.allPolygons()),n.invert(),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},e.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},e.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(e,t,n){var i=this.matrix.clone();i.invert();var r,a,s,l=new fe.a(e,t),c=[],u=[],h=[],d=[],f=o.x.Zero(),p=o.x.Zero(),g=o.w.Zero(),m=this.polygons,_=[0,0,0],v={},b=0,y={};n&&m.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var T=0,E=m.length;T<E;T++){y[(r=m[T]).shared.meshId]||(y[r.shared.meshId]={}),y[r.shared.meshId][r.shared.subMeshId]||(y[r.shared.meshId][r.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:r.shared.materialIndex}),s=y[r.shared.meshId][r.shared.subMeshId];for(var x=2,C=r.vertices.length;x<C;x++){_[0]=0,_[1]=x-1,_[2]=x;for(var S=0;S<3;S++){f.copyFrom(r.vertices[_[S]].pos),p.copyFrom(r.vertices[_[S]].normal),g.copyFrom(r.vertices[_[S]].uv);var A=o.x.TransformCoordinates(f,i),P=o.x.TransformNormal(p,i);void 0!==(a=v[A.x+","+A.y+","+A.z])&&h[3*a]===P.x&&h[3*a+1]===P.y&&h[3*a+2]===P.z&&d[2*a]===g.x&&d[2*a+1]===g.y||(c.push(A.x,A.y,A.z),d.push(g.x,g.y),h.push(p.x,p.y,p.z),a=v[A.x+","+A.y+","+A.z]=c.length/3-1),u.push(a),s.indexStart=Math.min(b,s.indexStart),s.indexEnd=Math.max(b,s.indexEnd),b++}}}if(l.setVerticesData(Cn.b.PositionKind,c),l.setVerticesData(Cn.b.NormalKind,h),l.setVerticesData(Cn.b.UVKind,d),l.setIndices(u,null),n){var R,M=0;for(var O in l.subMeshes=new Array,y){for(var w in R=-1,y[O])Fo.b.CreateFromIndices((s=y[O][w]).materialIndex+M,s.indexStart,s.indexEnd-s.indexStart+1,l),R=Math.max(s.materialIndex,R);M+=++R}}return l},e.prototype.toMesh=function(e,t,n,i){var r=this.buildMeshGeometry(e,n,i);return r.material=t,r.position.copyFrom(this.position),r.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(r.rotationQuaternion=this.rotationQuaternion.clone()),r.scaling.copyFrom(this.scaling),r.computeWorldMatrix(!0),r},e}(),Ho=function(e){function t(t,n,i,r,a,s){void 0===r&&(r=1),void 0===a&&(a=60),void 0===s&&(s=!0);var l=e.call(this,t,i)||this;l._sectionPolygonPointsCount=4,l._running=!1,l._autoStart=s,l._generator=n,l._diameter=r,l._length=a,l._sectionVectors=[],l._sectionNormalVectors=[];for(var c=0;c<l._sectionPolygonPointsCount;c++)l._sectionVectors[c]=o.x.Zero(),l._sectionNormalVectors[c]=o.x.Zero();return l._createMesh(),l}return c.d(t,e),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new xn.a,t=[],n=[],i=[],r=o.x.Zero();this._generator._boundingInfo&&(r=this._generator._boundingInfo.boundingBox.centerWorld);for(var a=2*Math.PI/this._sectionPolygonPointsCount,s=0;s<this._sectionPolygonPointsCount;s++)t.push(r.x+Math.cos(s*a)*this._diameter,r.y+Math.sin(s*a)*this._diameter,r.z);for(s=1;s<=this._length;s++){for(var l=0;l<this._sectionPolygonPointsCount;l++)t.push(r.x+Math.cos(l*a)*this._diameter,r.y+Math.sin(l*a)*this._diameter,r.z);var c=t.length/3-2*this._sectionPolygonPointsCount;for(l=0;l<this._sectionPolygonPointsCount-1;l++)i.push(c+l,c+l+this._sectionPolygonPointsCount,c+l+this._sectionPolygonPointsCount+1),i.push(c+l,c+l+this._sectionPolygonPointsCount+1,c+l+1);i.push(c+this._sectionPolygonPointsCount-1,c+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,c+this._sectionPolygonPointsCount),i.push(c+this._sectionPolygonPointsCount-1,c+this._sectionPolygonPointsCount,c)}xn.a.ComputeNormals(t,i,n),e.positions=t,e.normals=n,e.indices=i,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(Cn.b.PositionKind),t=this.getVerticesData(Cn.b.NormalKind),n=this._generator.getWorldMatrix();if(e&&t){for(var i=3*this._sectionPolygonPointsCount;i<e.length;i++)e[i-3*this._sectionPolygonPointsCount]=e[i]-t[i]/this._length*this._diameter;for(i=3*this._sectionPolygonPointsCount;i<t.length;i++)t[i-3*this._sectionPolygonPointsCount]=t[i];var r=e.length-3*this._sectionPolygonPointsCount,a=2*Math.PI/this._sectionPolygonPointsCount;for(i=0;i<this._sectionPolygonPointsCount;i++)this._sectionVectors[i].copyFromFloats(Math.cos(i*a)*this._diameter,Math.sin(i*a)*this._diameter,0),this._sectionNormalVectors[i].copyFromFloats(Math.cos(i*a),Math.sin(i*a),0),o.x.TransformCoordinatesToRef(this._sectionVectors[i],n,this._sectionVectors[i]),o.x.TransformNormalToRef(this._sectionNormalVectors[i],n,this._sectionNormalVectors[i]);for(i=0;i<this._sectionPolygonPointsCount;i++)e[r+3*i]=this._sectionVectors[i].x,e[r+3*i+1]=this._sectionVectors[i].y,e[r+3*i+2]=this._sectionVectors[i].z,t[r+3*i]=this._sectionNormalVectors[i].x,t[r+3*i+1]=this._sectionNormalVectors[i].y,t[r+3*i+2]=this._sectionNormalVectors[i].z;this.updateVerticesData(Cn.b.PositionKind,e,!0,!1),this.updateVerticesData(Cn.b.NormalKind,t,!0,!1)}},t.prototype.clone=function(e,n){return void 0===e&&(e=""),new t(e,void 0===n?this._generator:n,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t)},t.Parse=function(e,n){return new t(e.name,e._generator,n,e._diameter,e._length,e._autoStart)},t}(fe.a),Wo=n(111),Xo=n(72);xn.a.CreateDisc=function(e){var t=new Array,n=new Array,i=new Array,r=new Array,o=e.radius||.5,a=e.tessellation||64,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=0===e.sideOrientation?0:e.sideOrientation||xn.a.DEFAULTSIDE;t.push(0,0,0),r.push(.5,.5);for(var c=2*Math.PI*s,u=c/a,h=0;h<c;h+=u){var d=Math.cos(h),f=Math.sin(h),p=(d+1)/2,g=(1-f)/2;t.push(o*d,o*f,0),r.push(p,g)}1===s&&(t.push(t[3],t[4],t[5]),r.push(r[2],r[3]));for(var m=t.length/3,_=1;_<m-1;_++)n.push(_+1,0,_);xn.a.ComputeNormals(t,n,i),xn.a._ComputeSides(l,t,n,i,r,e.frontUVs,e.backUVs);var v=new xn.a;return v.indices=n,v.positions=t,v.normals=i,v.uvs=r,v},fe.a.CreateDisc=function(e,t,n,i,r,o){return void 0===i&&(i=null),Yo.CreateDisc(e,{radius:t,tessellation:n,sideOrientation:o,updatable:r},i)};var Yo=function(){function e(){}return e.CreateDisc=function(e,t,n){void 0===n&&(n=null);var i=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreateDisc(t).applyToMesh(i,t.updatable),i},e}();xn.a.CreateTorusKnot=function(e){var t,n,i=new Array,r=new Array,a=new Array,s=new Array,l=e.radius||2,c=e.tube||.5,u=e.radialSegments||32,h=e.tubularSegments||32,d=e.p||2,f=e.q||3,p=0===e.sideOrientation?0:e.sideOrientation||xn.a.DEFAULTSIDE,g=function(e){var t=Math.cos(e),n=Math.sin(e),i=f/d*e,r=Math.cos(i),a=l*(2+r)*.5*t,s=l*(2+r)*n*.5,c=l*Math.sin(i)*.5;return new o.x(a,s,c)};for(t=0;t<=u;t++){var m=t%u/u*2*d*Math.PI,_=g(m),v=g(m+.01),b=v.subtract(_),y=v.add(_),T=o.x.Cross(b,y);for(y=o.x.Cross(T,b),T.normalize(),y.normalize(),n=0;n<h;n++){var E=n%h/h*2*Math.PI,x=-c*Math.cos(E),C=c*Math.sin(E);r.push(_.x+x*y.x+C*T.x),r.push(_.y+x*y.y+C*T.y),r.push(_.z+x*y.z+C*T.z),s.push(t/u),s.push(n/h)}}for(t=0;t<u;t++)for(n=0;n<h;n++){var S=(n+1)%h,A=t*h+n,P=(t+1)*h+n,R=(t+1)*h+S,M=t*h+S;i.push(M),i.push(P),i.push(A),i.push(M),i.push(R),i.push(P)}xn.a.ComputeNormals(r,i,a),xn.a._ComputeSides(p,r,i,a,s,e.frontUVs,e.backUVs);var O=new xn.a;return O.indices=i,O.positions=r,O.normals=a,O.uvs=s,O},fe.a.CreateTorusKnot=function(e,t,n,i,r,o,a,s,l,c){return Ko.CreateTorusKnot(e,{radius:t,tube:n,radialSegments:i,tubularSegments:r,p:o,q:a,sideOrientation:c,updatable:l},s)};var Ko=function(){function e(){}return e.CreateTorusKnot=function(e,t,n){var i=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreateTorusKnot(t).applyToMesh(i,t.updatable),i},e}(),Qo=function(e){function t(t,n){var i=e.call(this,t.x,t.y)||this;return i.index=n,i}return c.d(t,e),t}(o.w),qo=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var i=new Qo(e,t.elements.length);n.push(i),t.elements.push(i)}}),n},e.prototype.computeBounds=function(){var e=new o.w(this.elements[0].x,this.elements[0].y),t=new o.w(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<e.x?e.x=n.x:n.x>t.x&&(t.x=n.x),n.y<e.y?e.y=n.y:n.y>t.y&&(t.y=n.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),Zo=function(){function e(){}return e.Rectangle=function(e,t,n,i){return[new o.w(e,t),new o.w(n,t),new o.w(n,i),new o.w(e,i)]},e.Circle=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=32);for(var r=new Array,a=0,s=2*Math.PI/i,l=0;l<i;l++)r.push(new o.w(t+Math.cos(a)*e,n+Math.sin(a)*e)),a-=s;return r},e.Parse=function(e){var t,n=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),i=[];for(t=0;t<(2147483646&n.length);t+=2)i.push(new o.w(n[t],n[t+1]));return i},e.StartingAt=function(e,t){return o.l.StartingAt(e,t)},e}(),Jo=function(){function e(e,t,n,i){var r;void 0===i&&(i=earcut),this._points=new qo,this._outlinepoints=new qo,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=e,this._scene=n||me.b.LastCreatedScene,r=t instanceof o.l?t.getPoints():t,this._addToepoint(r),this._points.add(r),this._outlinepoints.add(r),void 0===this.bjsEarcut&&p.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];this._epoints.push(i.x,i.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new qo;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);var n=new fe.a(this._name,this._scene),i=this.buildVertexData(t);return n.setVerticesData(Cn.b.PositionKind,i.positions,e),n.setVerticesData(Cn.b.NormalKind,i.normals,e),n.setVerticesData(Cn.b.UVKind,i.uvs,e),n.setIndices(i.indices),n},e.prototype.buildVertexData=function(e){var t=this;void 0===e&&(e=0);var n=new xn.a,i=new Array,r=new Array,o=new Array,a=this._points.computeBounds();this._points.elements.forEach(function(e){i.push(0,1,0),r.push(e.x,0,e.y),o.push((e.x-a.min.x)/a.width,(e.y-a.min.y)/a.height)});for(var s=new Array,l=this.bjsEarcut(this._epoints,this._eholes,2),c=0;c<l.length;c++)s.push(l[c]);if(e>0){var u=r.length/3;this._points.elements.forEach(function(t){i.push(0,-1,0),r.push(t.x,-e,t.y),o.push(1-(t.x-a.min.x)/a.width,1-(t.y-a.min.y)/a.height)});var h=s.length;for(c=0;c<h;c+=3){var d=s[c+0],f=s[c+1];s.push(s[c+2]+u),s.push(f+u),s.push(d+u)}this.addSide(r,i,o,s,a,this._outlinepoints,e,!1),this._holes.forEach(function(n){t.addSide(r,i,o,s,a,n,e,!0)})}return n.indices=s,n.positions=r,n.normals=i,n.uvs=o,n},e.prototype.addSide=function(e,t,n,i,r,a,s,l){for(var c=e.length/3,u=0,h=0;h<a.elements.length;h++){var d,f=a.elements[h];d=h+1>a.elements.length-1?a.elements[0]:a.elements[h+1],e.push(f.x,0,f.y),e.push(f.x,-s,f.y),e.push(d.x,0,d.y),e.push(d.x,-s,d.y);var p=new o.x(f.x,0,f.y),g=new o.x(d.x,0,d.y).subtract(p),m=new o.x(0,1,0),_=o.x.Cross(g,m);_=_.normalize(),n.push(u/r.width,0),n.push(u/r.width,1),u+=g.length(),n.push(u/r.width,0),n.push(u/r.width,1),l?(t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),i.push(c),i.push(c+2),i.push(c+1),i.push(c+1),i.push(c+2),i.push(c+3)):(t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),i.push(c),i.push(c+1),i.push(c+2),i.push(c+1),i.push(c+3),i.push(c+2)),c+=4}},e}();xn.a.CreatePolygon=function(e,t,n,i,r,a){for(var s=n||new Array(3),l=i,c=[],u=0;u<3;u++)void 0===s[u]&&(s[u]=new o.y(0,0,1,1)),l&&void 0===l[u]&&(l[u]=new o.f(1,1,1,1));for(var h=e.getVerticesData(Cn.b.PositionKind),d=e.getVerticesData(Cn.b.NormalKind),f=e.getVerticesData(Cn.b.UVKind),p=e.getIndices(),g=0,m=0,_=0;_<d.length;_+=3)Math.abs(d[_+1])<.001&&(m=1),Math.abs(d[_+1]-1)<.001&&(m=0),Math.abs(d[_+1]+1)<.001&&(m=2),f[2*(g=_/3)]=(1-f[2*g])*s[m].x+f[2*g]*s[m].z,f[2*g+1]=(1-f[2*g+1])*s[m].y+f[2*g+1]*s[m].w,l&&c.push(l[m].r,l[m].g,l[m].b,l[m].a);xn.a._ComputeSides(t,h,p,d,f,r,a);var v=new xn.a;if(v.indices=p,v.positions=h,v.normals=d,v.uvs=f,l){var b=t===xn.a.DOUBLESIDE?c.concat(c):c;v.colors=b}return v},fe.a.CreatePolygon=function(e,t,n,i,r,o,a){return void 0===a&&(a=earcut),$o.CreatePolygon(e,{shape:t,holes:i,updatable:r,sideOrientation:o},n,a)},fe.a.ExtrudePolygon=function(e,t,n,i,r,o,a,s){return void 0===s&&(s=earcut),$o.ExtrudePolygon(e,{shape:t,holes:r,depth:n,updatable:o,sideOrientation:a},i,s)};var $o=function(){function e(){}return e.CreatePolygon=function(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=earcut),t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation);for(var r=t.shape,a=t.holes||[],s=t.depth||0,l=[],c=[],u=0;u<r.length;u++)l[u]=new o.w(r[u].x,r[u].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();for(var h=new Jo(e,l,n||A.a.LastCreatedScene,i),d=0;d<a.length;d++){c=[];for(var f=0;f<a[d].length;f++)c.push(new o.w(a[d][f].x,a[d][f].z));h.addHole(c)}var p=h.build(t.updatable,s);return p._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreatePolygon(p,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs).applyToMesh(p,t.updatable),p},e.ExtrudePolygon=function(t,n,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),e.CreatePolygon(t,n,i,r)},e}();fe.a.CreateLathe=function(e,t,n,i,r,o,a){return ea.CreateLathe(e,{shape:t,radius:n,tessellation:i,sideOrientation:a,updatable:o},r)};var ea=function(){function e(){}return e.CreateLathe=function(e,t,n){void 0===n&&(n=null);var i,r=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,a=void 0===t.closed||t.closed,s=t.shape,l=t.radius||1,c=t.tessellation||64,u=t.clip||0,h=t.updatable,d=fe.a._GetDefaultSideOrientation(t.sideOrientation),f=t.cap||fe.a.NO_CAP,p=2*Math.PI,g=new Array,m=t.invertUV||!1,_=0,v=0,b=p/c*r,y=new Array;for(_=0;_<=c-u;_++){for(y=[],f!=fe.a.CAP_START&&f!=fe.a.CAP_ALL||(y.push(new o.x(0,s[0].y,0)),y.push(new o.x(Math.cos(_*b)*s[0].x*l,s[0].y,Math.sin(_*b)*s[0].x*l))),v=0;v<s.length;v++)i=new o.x(Math.cos(_*b)*s[v].x*l,s[v].y,Math.sin(_*b)*s[v].x*l),y.push(i);f!=fe.a.CAP_END&&f!=fe.a.CAP_ALL||(y.push(new o.x(Math.cos(_*b)*s[s.length-1].x*l,s[s.length-1].y,Math.sin(_*b)*s[s.length-1].x*l)),y.push(new o.x(0,s[s.length-1].y,0))),g.push(y)}return to.CreateRibbon(e,{pathArray:g,closeArray:a,sideOrientation:d,updatable:h,invertUV:m,frontUVs:t.frontUVs,backUVs:t.backUVs},n)},e}();fe.a.CreateTube=function(e,t,n,i,r,o,a,s,l,c){return ta.CreateTube(e,{path:t,radius:n,tessellation:i,radiusFunction:r,arc:1,cap:o,updatable:s,sideOrientation:l,instance:c},a)};var ta=function(){function e(){}return e.CreateTube=function(e,t,n){void 0===n&&(n=null);var i=t.path,r=t.instance,a=1;void 0!==t.radius?a=t.radius:r&&(a=r._creationDataStorage.radius);var s=t.tessellation||64,l=t.radiusFunction||null,c=t.cap||fe.a.NO_CAP,u=t.invertUV||!1,h=t.updatable,d=fe.a._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;var f,p,g=function(e,t,n,i,r,a,s,l){for(var c,u,h,d,f=t.getTangents(),p=t.getNormals(),g=t.getDistances(),m=2*Math.PI/r*l,_=a||function(){return i},v=o.t.Matrix[0],b=s===fe.a.NO_CAP||s===fe.a.CAP_END?0:2,y=0;y<e.length;y++){u=_(y,g[y]),c=Array(),h=p[y];for(var T=0;T<r;T++)o.j.RotationAxisToRef(f[y],m*T,v),d=c[T]?c[T]:o.x.Zero(),o.x.TransformCoordinatesToRef(h,v,d),d.scaleInPlace(u).addInPlace(e[y]),c[T]=d;n[b]=c,b++}var E=function(t,n){for(var i=Array(),r=0;r<t;r++)i.push(e[n]);return i};switch(s){case fe.a.NO_CAP:break;case fe.a.CAP_START:n[0]=E(r,0),n[1]=n[2].slice(0);break;case fe.a.CAP_END:n[b]=n[b-1].slice(0),n[b+1]=E(r,e.length-1);break;case fe.a.CAP_ALL:n[0]=E(r,0),n[1]=n[2].slice(0),n[b]=n[b-1].slice(0),n[b+1]=E(r,e.length-1)}return n};if(r){var m=r._creationDataStorage,_=t.arc||m.arc;return p=g(i,f=m.path3D.update(i),m.pathArray,a,m.tessellation,l,m.cap,_),r=to.CreateRibbon("",{pathArray:p,instance:r}),m.path3D=f,m.pathArray=p,m.arc=_,m.radius=a,r}p=g(i,f=new o.m(i),new Array,a,s,l,c=c<0||c>3?0:c,t.arc);var v=to.CreateRibbon(e,{pathArray:p,closePath:!0,closeArray:!1,updatable:h,sideOrientation:d,invertUV:u,frontUVs:t.frontUVs,backUVs:t.backUVs},n);return v._creationDataStorage.pathArray=p,v._creationDataStorage.path3D=f,v._creationDataStorage.tessellation=s,v._creationDataStorage.cap=c,v._creationDataStorage.arc=t.arc,v._creationDataStorage.radius=a,v},e}();xn.a.CreateIcoSphere=function(e){var t,n=e.sideOrientation||xn.a.DEFAULTSIDE,i=e.radius||1,r=void 0===e.flat||e.flat,a=e.subdivisions||4,s=e.radiusX||i,l=e.radiusY||i,c=e.radiusZ||i,u=(1+Math.sqrt(5))/2,h=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],d=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],f=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=new Array,_=new Array,v=new Array,b=new Array,y=0,T=new Array(3),E=new Array(3);for(t=0;t<3;t++)T[t]=o.x.Zero(),E[t]=o.w.Zero();for(var x=0;x<20;x++){for(t=0;t<3;t++){var C=d[3*x+t];T[t].copyFromFloats(h[3*f[C]],h[3*f[C]+1],h[3*f[C]+2]),T[t].normalize().scaleInPlace(i),E[t].copyFromFloats(p[2*C]*(138/1024)+60/1024+g[x]*(-40/1024),p[2*C+1]*(239/1024)+26/1024+g[x]*(20/1024))}for(var S=function(e,t,n,i){var u,h=o.x.Lerp(T[0],T[2],t/a),d=o.x.Lerp(T[1],T[2],t/a),f=a===t?T[2]:o.x.Lerp(h,d,e/(a-t));if(f.normalize(),r){var p=o.x.Lerp(T[0],T[2],i/a),g=o.x.Lerp(T[1],T[2],i/a);u=o.x.Lerp(p,g,n/(a-i))}else u=new o.x(f.x,f.y,f.z);u.x/=s,u.y/=l,u.z/=c,u.normalize();var x=o.w.Lerp(E[0],E[2],t/a),C=o.w.Lerp(E[1],E[2],t/a),S=a===t?E[2]:o.w.Lerp(x,C,e/(a-t));_.push(f.x*s,f.y*l,f.z*c),v.push(u.x,u.y,u.z),b.push(S.x,S.y),m.push(y),y++},A=0;A<a;A++)for(var P=0;P+A<a;P++)S(P,A,P+1/3,A+1/3),S(P+1,A,P+1/3,A+1/3),S(P,A+1,P+1/3,A+1/3),P+A+1<a&&(S(P+1,A,P+2/3,A+2/3),S(P+1,A+1,P+2/3,A+2/3),S(P,A+1,P+2/3,A+2/3))}xn.a._ComputeSides(n,_,m,v,b,e.frontUVs,e.backUVs);var R=new xn.a;return R.indices=m,R.positions=_,R.normals=v,R.uvs=b,R},fe.a.CreateIcoSphere=function(e,t,n){return na.CreateIcoSphere(e,t,n)};var na=function(){function e(){}return e.CreateIcoSphere=function(e,t,n){void 0===n&&(n=null);var i=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,xn.a.CreateIcoSphere(t).applyToMesh(i,t.updatable),i},e}();fe.a.CreateDecal=function(e,t,n,i,r,o){return ra.CreateDecal(e,t,{position:n,normal:i,size:r,angle:o})};var ia,ra=function(){function e(){}return e.CreateDecal=function(e,t,n){var i=t.getIndices(),r=t.getVerticesData(Cn.b.PositionKind),a=t.getVerticesData(Cn.b.NormalKind),s=n.position||o.x.Zero(),l=n.normal||o.x.Up(),c=n.size||o.x.One(),u=n.angle||0;if(!l){var h=new o.x(0,0,1),d=t.getScene().activeCamera,f=o.x.TransformCoordinates(h,d.getWorldMatrix());l=d.globalPosition.subtract(f)}var p=-Math.atan2(l.z,l.x)-Math.PI/2,g=Math.sqrt(l.x*l.x+l.z*l.z),m=Math.atan2(l.y,g),_=o.j.RotationYawPitchRoll(p,m,u).multiply(o.j.Translation(s.x,s.y,s.z)),v=o.j.Invert(_),b=t.getWorldMatrix().multiply(v),y=new xn.a;y.indices=[],y.positions=[],y.normals=[],y.uvs=[];for(var T=0,E=function(e){var t=new o.p;if(!i||!r||!a)return t;var n=i[e];return t.position=new o.x(r[3*n],r[3*n+1],r[3*n+2]),t.position=o.x.TransformCoordinates(t.position,b),t.normal=new o.x(a[3*n],a[3*n+1],a[3*n+2]),t.normal=o.x.TransformNormal(t.normal,b),t},x=function(e,t){if(0===e.length)return e;for(var n=.5*Math.abs(o.x.Dot(c,t)),i=function(e,i){var r=o.x.GetClipFactor(e.position,i.position,t,n);return new o.p(o.x.Lerp(e.position,i.position,r),o.x.Lerp(e.normal,i.normal,r))},r=new Array,a=0;a<e.length;a+=3){var s,l,u,h=null,d=null,f=null,p=null;switch(((s=o.x.Dot(e[a].position,t)-n>0)?1:0)+((l=o.x.Dot(e[a+1].position,t)-n>0)?1:0)+((u=o.x.Dot(e[a+2].position,t)-n>0)?1:0)){case 0:r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]);break;case 1:if(s&&(d=e[a+2],f=i(e[a],h=e[a+1]),p=i(e[a],d)),l){d=e[a+2],f=i(e[a+1],h=e[a]),p=i(e[a+1],d),r.push(f),r.push(d.clone()),r.push(h.clone()),r.push(d.clone()),r.push(f.clone()),r.push(p);break}u&&(d=e[a+1],f=i(e[a+2],h=e[a]),p=i(e[a+2],d)),h&&d&&f&&p&&(r.push(h.clone()),r.push(d.clone()),r.push(f),r.push(p),r.push(f.clone()),r.push(d.clone()));break;case 2:s||(d=i(h=e[a].clone(),e[a+1]),f=i(h,e[a+2]),r.push(h),r.push(d),r.push(f)),l||(d=i(h=e[a+1].clone(),e[a+2]),f=i(h,e[a]),r.push(h),r.push(d),r.push(f)),u||(d=i(h=e[a+2].clone(),e[a]),f=i(h,e[a+1]),r.push(h),r.push(d),r.push(f))}}return r},C=0;C<i.length;C+=3){var S=new Array;if(S.push(E(C)),S.push(E(C+1)),S.push(E(C+2)),S=x(S,new o.x(1,0,0)),S=x(S,new o.x(-1,0,0)),S=x(S,new o.x(0,1,0)),S=x(S,new o.x(0,-1,0)),S=x(S,new o.x(0,0,1)),0!==(S=x(S,new o.x(0,0,-1))).length)for(var A=0;A<S.length;A++){var P=S[A];y.indices.push(T),P.position.toArray(y.positions,3*T),P.normal.toArray(y.normals,3*T),y.uvs.push(.5+P.position.x/c.x),y.uvs.push(.5+P.position.y/c.y),T++}}var R=new fe.a(e,t.getScene());return y.applyToMesh(R),R.position=s.clone(),R.rotation=new o.x(m,p,u),R},e}(),oa=function(){function e(){}return e.CreateBox=function(e,t,n){return void 0===n&&(n=null),Ei.a.CreateBox(e,t,n)},e.CreateSphere=function(e,t,n){return void 0===n&&(n=null),Ai.a.CreateSphere(e,t,n)},e.CreateDisc=function(e,t,n){return void 0===n&&(n=null),Yo.CreateDisc(e,t,n)},e.CreateIcoSphere=function(e,t,n){return void 0===n&&(n=null),na.CreateIcoSphere(e,t,n)},e.CreateRibbon=function(e,t,n){return void 0===n&&(n=null),to.CreateRibbon(e,t,n)},e.CreateCylinder=function(e,t,n){return void 0===n&&(n=null),Mn.a.CreateCylinder(e,t,n)},e.CreateTorus=function(e,t,n){return void 0===n&&(n=null),Rn.CreateTorus(e,t,n)},e.CreateTorusKnot=function(e,t,n){return void 0===n&&(n=null),Ko.CreateTorusKnot(e,t,n)},e.CreateLineSystem=function(e,t,n){return Pi.a.CreateLineSystem(e,t,n)},e.CreateLines=function(e,t,n){return void 0===n&&(n=null),Pi.a.CreateLines(e,t,n)},e.CreateDashedLines=function(e,t,n){return void 0===n&&(n=null),Pi.a.CreateDashedLines(e,t,n)},e.ExtrudeShape=function(e,t,n){return void 0===n&&(n=null),no.ExtrudeShape(e,t,n)},e.ExtrudeShapeCustom=function(e,t,n){return void 0===n&&(n=null),no.ExtrudeShapeCustom(e,t,n)},e.CreateLathe=function(e,t,n){return void 0===n&&(n=null),ea.CreateLathe(e,t,n)},e.CreatePlane=function(e,t,n){return void 0===n&&(n=null),Zi.a.CreatePlane(e,t,n)},e.CreateGround=function(e,t,n){return void 0===n&&(n=null),An.CreateGround(e,t,n)},e.CreateTiledGround=function(e,t,n){return void 0===n&&(n=null),An.CreateTiledGround(e,t,n)},e.CreateGroundFromHeightMap=function(e,t,n,i){return void 0===i&&(i=null),An.CreateGroundFromHeightMap(e,t,n,i)},e.CreatePolygon=function(e,t,n,i){return void 0===n&&(n=null),void 0===i&&(i=earcut),$o.CreatePolygon(e,t,n,i)},e.ExtrudePolygon=function(e,t,n,i){return void 0===n&&(n=null),void 0===i&&(i=earcut),$o.ExtrudePolygon(e,t,n,i)},e.CreateTube=function(e,t,n){return void 0===n&&(n=null),ta.CreateTube(e,t,n)},e.CreatePolyhedron=function(e,t,n){return void 0===n&&(n=null),Ii.CreatePolyhedron(e,t,n)},e.CreateDecal=function(e,t,n){return ra.CreateDecal(e,t,n)},e}(),aa=function(e,t,n){this.quality=e,this.distance=t,this.optimizeMesh=n},sa=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(e){this._simplificationArray.push(e)},e.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},e.prototype.runSimplification=function(e){var t=this;if(e.parallelProcessing)e.settings.forEach(function(n){t.getSimplifier(e).simplify(n,function(i){e.mesh.addLODLevel(n.distance,i),i.isVisible=!0,n.quality===e.settings[e.settings.length-1].quality&&e.successCallback&&e.successCallback(),t.executeNext()})});else{var n=this.getSimplifier(e);be.a.Run(e.settings.length,function(t){var i,r;r=function(){t.executeNext()},n.simplify(i=e.settings[t.index],function(t){e.mesh.addLODLevel(i.distance,t),t.isVisible=!0,r()})},function(){e.successCallback&&e.successCallback(),t.executeNext()})}},e.prototype.getSimplifier=function(e){switch(e.simplificationType){case ia.QUADRATIC:default:return new da(e.mesh)}},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(ia||(ia={}));var la=function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},ca=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new ua,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}(),ua=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)this.data[t]=e&&e[t]?e[t]:0}return e.prototype.det=function(e,t,n,i,r,o,a,s,l){return this.data[e]*this.data[r]*this.data[l]+this.data[n]*this.data[i]*this.data[s]+this.data[t]*this.data[o]*this.data[a]-this.data[n]*this.data[r]*this.data[a]-this.data[e]*this.data[o]*this.data[s]-this.data[t]*this.data[i]*this.data[l]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var n=new e,i=0;i<10;++i)n.data[i]=this.data[i]+t.data[i];return n},e.FromData=function(t,n,i,r){return new e(e.DataFromNumbers(t,n,i,r))},e.DataFromNumbers=function(e,t,n,i){return[e*e,e*t,e*n,e*i,t*t,t*n,t*i,n*n,n*i,i*i]},e}(),ha=function(e,t){this.vertexId=e,this.triangleId=t},da=function(){function e(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=o.h}return e.prototype.simplify=function(e,t){var n=this;this.initDecimatedMesh(),be.a.Run(this._mesh.subMeshes.length,function(t){n.initWithMesh(t.index,function(){n.runDecimation(e,t.index,function(){t.executeNext()})},e.optimizeMesh)},function(){setTimeout(function(){t(n._reconstructedMesh)},0)})},e.prototype.runDecimation=function(e,t,n){var i=this,r=~~(this.triangles.length*e.quality),a=0,s=this.triangles.length;be.a.Run(this.decimationIterations,function(e){var t,n;s-a<=r?e.breakLoop():(t=e.index,n=function(){e.executeNext()},setTimeout(function(){t%5==0&&i.updateMesh(0===t);for(var e=0;e<i.triangles.length;++e)i.triangles[e].isDirty=!1;var l=1e-9*Math.pow(t+3,i.aggressiveness);be.a.SyncAsyncForLoop(i.triangles.length,i.syncIterations,function(e){var t=i.triangles[~~((i.triangles.length/2+e)%i.triangles.length)];if(t&&!(t.error[3]>l||t.deleted||t.isDirty))for(var n=0;n<3;++n)if(t.error[n]<l){var r=[],s=[],c=t.vertices[n],u=t.vertices[(n+1)%3];if(c.isBorder||u.isBorder)continue;var h=o.x.Zero();i.calculateError(c,u,h);var d=new Array;if(i.isFlipped(c,u,h,r,d))continue;if(i.isFlipped(u,c,h,s,d))continue;if(r.indexOf(!0)<0||s.indexOf(!0)<0)continue;var f=new Array;if(d.forEach(function(e){-1===f.indexOf(e)&&(e.deletePending=!0,f.push(e))}),f.length%2!=0)continue;c.q=u.q.add(c.q),c.updatePosition(h);var p=i.references.length;a=i.updateTriangles(c,c,r,a),a=i.updateTriangles(c,u,s,a);var g=i.references.length-p;if(g<=c.triangleCount){if(g)for(var m=0;m<g;m++)i.references[c.triangleStart+m]=i.references[p+m]}else c.triangleStart=p;c.triangleCount=g;break}},n,function(){return s-a<=r})},0))},function(){setTimeout(function(){i.reconstructMesh(t),n()},0)})},e.prototype.initWithMesh=function(e,t,n){var i=this;this.vertices=[],this.triangles=[];var r=this._mesh.getVerticesData(Cn.b.PositionKind),a=this._mesh.getIndices(),s=this._mesh.subMeshes[e],l=[];be.a.SyncAsyncForLoop(s.verticesCount,this.syncIterations/4>>0,function(e){if(r){var t=e+s.verticesStart,a=o.x.FromArray(r,3*t),c=function(e){if(n)for(var t=0;t<i.vertices.length;++t)if(i.vertices[t].position.equals(e))return i.vertices[t];return null}(a)||new ca(a,i.vertices.length);c.originalOffsets.push(t),c.id===i.vertices.length&&i.vertices.push(c),l.push(c.id)}},function(){be.a.SyncAsyncForLoop(s.indexCount/3,i.syncIterations,function(e){if(a){var t=3*(s.indexStart/3+e),n=new la([i.vertices[l[a[t+0]-s.verticesStart]],i.vertices[l[a[t+1]-s.verticesStart]],i.vertices[l[a[t+2]-s.verticesStart]]]);n.originalOffset=t,i.triangles.push(n)}},function(){i.init(t)})})},e.prototype.init=function(e){var t=this;be.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(e){var n=t.triangles[e];n.normal=o.x.Cross(n.vertices[1].position.subtract(n.vertices[0].position),n.vertices[2].position.subtract(n.vertices[0].position)).normalize();for(var i=0;i<3;i++)n.vertices[i].q.addArrayInPlace(ua.DataFromNumbers(n.normal.x,n.normal.y,n.normal.z,-o.x.Dot(n.normal,n.vertices[0].position)))},function(){be.a.SyncAsyncForLoop(t.triangles.length,t.syncIterations,function(e){for(var n=t.triangles[e],i=0;i<3;++i)n.error[i]=t.calculateError(n.vertices[i],n.vertices[(i+1)%3]);n.error[3]=Math.min(n.error[0],n.error[1],n.error[2])},function(){e()})})},e.prototype.reconstructMesh=function(e){var t,n,i,r=[];for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0;for(t=0;t<this.triangles.length;++t)if(!this.triangles[t].deleted){for(n=this.triangles[t],i=0;i<3;++i)n.vertices[i].triangleCount=1;r.push(n)}var o=this._reconstructedMesh.getVerticesData(Cn.b.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(Cn.b.NormalKind)||[],s=this._reconstructedMesh.getVerticesData(Cn.b.UVKind)||[],l=this._reconstructedMesh.getVerticesData(Cn.b.ColorKind)||[],c=this._mesh.getVerticesData(Cn.b.NormalKind),u=this._mesh.getVerticesData(Cn.b.UVKind),h=this._mesh.getVerticesData(Cn.b.ColorKind),d=0;for(t=0;t<this.vertices.length;++t){var f=this.vertices[t];f.id=d,f.triangleCount&&f.originalOffsets.forEach(function(e){c&&(o.push(f.position.x),o.push(f.position.y),o.push(f.position.z),a.push(c[3*e]),a.push(c[3*e+1]),a.push(c[3*e+2]),u&&u.length&&(s.push(u[2*e]),s.push(u[2*e+1])),h&&h.length&&(l.push(h[4*e]),l.push(h[4*e+1]),l.push(h[4*e+2]),l.push(h[4*e+3])),++d)})}var p=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),m=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var _=this._reconstructedMesh.getIndices(),v=this._mesh.getIndices();for(t=0;t<r.length;++t)n=r[t],[0,1,2].forEach(function(e){var t=n.vertices[e].originalOffsets.indexOf(v[n.originalOffset+e]);t<0&&(t=0),_.push(n.vertices[e].id+t+g)});this._reconstructedMesh.setIndices(_),this._reconstructedMesh.setVerticesData(Cn.b.PositionKind,o),this._reconstructedMesh.setVerticesData(Cn.b.NormalKind,a),s.length>0&&this._reconstructedMesh.setVerticesData(Cn.b.UVKind,s),l.length>0&&this._reconstructedMesh.setVerticesData(Cn.b.ColorKind,l);var b=this._mesh.subMeshes[e];e>0&&(this._reconstructedMesh.subMeshes=[],m.forEach(function(e){Fo.b.AddToMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,e.getMesh())}),Fo.b.AddToMesh(b.materialIndex,g,d,p,3*r.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new fe.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(e,t,n,i,r){for(var a=0;a<e.triangleCount;++a){var s=this.triangles[this.references[e.triangleStart+a].triangleId];if(!s.deleted){var l=this.references[e.triangleStart+a].vertexId,c=s.vertices[(l+1)%3],u=s.vertices[(l+2)%3];if(c!==t&&u!==t){var h=c.position.subtract(n);h=h.normalize();var d=u.position.subtract(n);if(d=d.normalize(),Math.abs(o.x.Dot(h,d))>.999)return!0;var f=o.x.Cross(h,d).normalize();if(i[a]=!1,o.x.Dot(f,s.normal)<.2)return!0}else i[a]=!0,r.push(s)}}return!1},e.prototype.updateTriangles=function(e,t,n,i){for(var r=i,o=0;o<t.triangleCount;++o){var a=this.references[t.triangleStart+o],s=this.triangles[a.triangleId];s.deleted||(n[o]&&s.deletePending?(s.deleted=!0,r++):(s.vertices[a.vertexId]=e,s.isDirty=!0,s.error[0]=this.calculateError(s.vertices[0],s.vertices[1])+s.borderFactor/2,s.error[1]=this.calculateError(s.vertices[1],s.vertices[2])+s.borderFactor/2,s.error[2]=this.calculateError(s.vertices[2],s.vertices[0])+s.borderFactor/2,s.error[3]=Math.min(s.error[0],s.error[1],s.error[2]),this.references.push(a)))}return r},e.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,n=[],i=[],r=this.vertices[e];for(t=0;t<r.triangleCount;++t)for(var o=this.triangles[this.references[r.triangleStart+t].triangleId],a=0;a<3;a++){for(var s=0,l=o.vertices[a];s<n.length&&i[s]!==l.id;)++s;s===n.length?(n.push(1),i.push(l.id)):n[s]++}for(t=0;t<n.length;++t)this.vertices[i[t]].isBorder=1===n[t]}},e.prototype.updateMesh=function(e){var t,n,i,r;if(void 0===e&&(e=!1),!e){var o=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||o.push(this.triangles[t]);this.triangles=o}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],i=0;i<3;++i)(r=n.vertices[i]).triangleCount++;var a=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=a,a+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var s=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],i=0;i<3;++i)s[(r=n.vertices[i]).triangleStart+r.triangleCount]=new ha(i,t),r.triangleCount++;this.references=s,e&&this.identifyBorder()},e.prototype.vertexError=function(e,t){var n=t.x,i=t.y,r=t.z;return e.data[0]*n*n+2*e.data[1]*n*i+2*e.data[2]*n*r+2*e.data[3]*n+e.data[4]*i*i+2*e.data[5]*i*r+2*e.data[6]*i+e.data[7]*r*r+2*e.data[8]*r+e.data[9]},e.prototype.calculateError=function(e,t,n){var i=e.q.add(t.q),r=e.isBorder&&t.isBorder,a=0,s=i.det(0,1,2,1,4,5,2,5,7);if(0===s||r){var l=e.position.add(t.position).divide(new o.x(2,2,2)),c=this.vertexError(i,e.position),u=this.vertexError(i,t.position),h=this.vertexError(i,l);(a=Math.min(c,u,h))===c?n&&n.copyFrom(e.position):a===u?n&&n.copyFrom(t.position):n&&n.copyFrom(l)}else n||(n=o.x.Zero()),n.x=-1/s*i.det(1,2,3,4,5,6,5,7,8),n.y=1/s*i.det(0,2,3,1,5,6,2,7,8),n.z=-1/s*i.det(0,1,3,1,4,6,2,5,8),a=this.vertexError(i,n);return a},e}();Object.defineProperty(W.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new sa;var e=this._getComponent(xe.a.NAME_SIMPLIFICATIONQUEUE);e||(e=new fa(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),fe.a.prototype.simplify=function(e,t,n,i){return void 0===t&&(t=!0),void 0===n&&(n=ia.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:t,mesh:this,simplificationType:n,successCallback:i}),this};var fa=function(){function e(e){this.name=xe.a.NAME_SIMPLIFICATIONQUEUE,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(xe.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),pa=n(110),ga=n(78),ma=n(73);me.b.OfflineProviderFactory=function(e,t,n){return void 0===n&&(n=!1),new va(e,t,n)};var _a,va=function(){function e(t,n,i){var r=this;void 0===i&&(i=!1),this._idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this._callbackManifestChecked=n,this._currentSceneUrl=e._ReturnFullUrlLocation(t),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,e.IDBStorageEnabled?i?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,be.h.SetImmediate(function(){r._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(e.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),e.prototype._checkManifestFile=function(){var t=this,n=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t._callbackManifestChecked(!1)},i=!1,r=this._currentSceneUrl+".manifest",o=new Co.a;navigator.onLine&&(i=!0,r=r+(null==r.match(/\?/)?"?":"&")+Date.now()),o.open("GET",r),o.addEventListener("load",function(){if(200===o.status||e._ValidateXHRData(o,1))try{var i=JSON.parse(o.response);t._enableSceneOffline=i.enableSceneOffline,t._enableTexturesOffline=i.enableTexturesOffline&&e.IsUASupportingBlobStorage,i.version&&!isNaN(parseInt(i.version))&&(t._manifestVersionFound=i.version),t._callbackManifestChecked&&t._callbackManifestChecked(!0)}catch(e){n()}else n()},!1),o.addEventListener("error",function(){i?(i=!1,o.open("GET",t._currentSceneUrl+".manifest"),o.send()):n()},!1);try{o.send()}catch(e){p.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},e.prototype.open=function(e,t){var n=this,i=function(){n._isSupported=!1,t&&t()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)e&&e();else{this._hasReachedQuota=!1,this._isSupported=!0;var r=this._idbFactory.open("babylonjs",1);r.onerror=function(){i()},r.onblocked=function(){p.a.Error("IDB request blocked. Please reload the page."),i()},r.onsuccess=function(){n._db=r.result,e()},r.onupgradeneeded=function(e){if(n._db=e.target.result,n._db)try{n._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),n._db.createObjectStore("versions",{keyPath:"sceneUrl"}),n._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(e){p.a.Error("Error while creating object stores. Exception: "+e.message),i()}}}else this._isSupported=!1,t&&t()},e.prototype.loadImage=function(t,n){var i=this,r=e._ReturnFullUrlLocation(t),o=function(){i._hasReachedQuota||null===i._db?n.src=t:i._saveImageIntoDBAsync(r,n)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(r,n,o)},e.prototype._loadImageFromDBAsync=function(e,t,n){if(this._isSupported&&null!==this._db){var i,r=this._db.transaction(["textures"]);r.onabort=function(){t.src=e},r.oncomplete=function(){var r;if(i){var o=window.URL||window.webkitURL;r=o.createObjectURL(i.data),t.onerror=function(){p.a.Error("Error loading image from blob URL: "+r+" switching back to web url: "+e),t.src=e},t.src=r}else n()};var o=r.objectStore("textures").get(e);o.onsuccess=function(e){i=e.target.result},o.onerror=function(){p.a.Error("Error loading texture "+e+" from DB."),t.src=e}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t.src=e},e.prototype._saveImageIntoDBAsync=function(t,n){var i=this;if(this._isSupported){var r=function(){var e;if(o){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(o)}catch(n){e=t.createObjectURL(o)}}e&&(n.src=e)};if(e.IsUASupportingBlobStorage){var o,a=new Co.a;a.open("GET",t),a.responseType="blob",a.addEventListener("load",function(){if(200===a.status&&i._db){o=a.response;var s=i._db.transaction(["textures"],"readwrite");s.onabort=function(e){try{var t=(e.srcElement||e.target).error;t&&"QuotaExceededError"===t.name&&(i._hasReachedQuota=!0)}catch(e){}r()},s.oncomplete=function(){r()};var l={textureUrl:t,data:o};try{var c=s.objectStore("textures").put(l);c.onsuccess=function(){},c.onerror=function(){r()}}catch(r){25===r.code&&(e.IsUASupportingBlobStorage=!1,i._enableTexturesOffline=!1),n.src=t}}else n.src=t},!1),a.addEventListener("error",function(){p.a.Error("Error in XHR request in BABYLON.Database."),n.src=t},!1),a.send()}else n.src=t}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),n.src=t},e.prototype._checkVersionFromDB=function(e,t){var n=this;this._loadVersionFromDBAsync(e,t,function(){n._saveVersionIntoDBAsync(e,t)})},e.prototype._loadVersionFromDBAsync=function(e,t,n){var i,r=this;if(this._isSupported&&this._db)try{var o=this._db.transaction(["versions"]);o.oncomplete=function(){i?r._manifestVersionFound!==i.data?(r._mustUpdateRessources=!0,n()):t(i.data):(r._mustUpdateRessources=!0,n())},o.onabort=function(){t(-1)};var a=o.objectStore("versions").get(e);a.onsuccess=function(e){i=e.target.result},a.onerror=function(){p.a.Error("Error loading version for scene "+e+" from DB."),t(-1)}}catch(e){p.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+e.message),t(-1)}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t(-1)},e.prototype._saveVersionIntoDBAsync=function(e,t){var n=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var i=this._db.transaction(["versions"],"readwrite");i.onabort=function(e){try{var i=e.srcElement.error;i&&"QuotaExceededError"===i.name&&(n._hasReachedQuota=!0)}catch(e){}t(-1)},i.oncomplete=function(){t(n._manifestVersionFound)};var r={sceneUrl:e,data:this._manifestVersionFound},o=i.objectStore("versions").put(r);o.onsuccess=function(){},o.onerror=function(){p.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(e){p.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+e.message),t(-1)}else t(-1)},e.prototype.loadFile=function(t,n,i,r,o){var a=this,s=e._ReturnFullUrlLocation(t),l=function(){a._saveFileAsync(s,n,i,o,r)};this._checkVersionFromDB(s,function(e){-1!==e?a._mustUpdateRessources?a._saveFileAsync(s,n,i,o,r):a._loadFileAsync(s,n,l):r&&r()})},e.prototype._loadFileAsync=function(e,t,n){if(this._isSupported&&this._db){var i,r;i=-1!==e.indexOf(".babylon")?"scenes":"textures";var o=this._db.transaction([i]);o.oncomplete=function(){r?t(r.data):n()},o.onabort=function(){n()};var a=o.objectStore(i).get(e);a.onsuccess=function(e){r=e.target.result},a.onerror=function(){p.a.Error("Error loading file "+e+" from DB."),n()}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t()},e.prototype._saveFileAsync=function(t,n,i,r,o){var a=this;if(this._isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var l,c=new Co.a;c.open("GET",t+"?"+Date.now()),r&&(c.responseType="arraybuffer"),i&&(c.onprogress=i),c.addEventListener("load",function(){if(200===c.status||c.status<400&&e._ValidateXHRData(c,r?6:1))if(l=r?c.response:c.responseText,!a._hasReachedQuota&&a._db){var i,u=a._db.transaction([s],"readwrite");u.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(a._hasReachedQuota=!0)}catch(e){}n(l)},u.oncomplete=function(){n(l)},i="scenes"===s?{sceneUrl:t,data:l,version:a._manifestVersionFound}:{textureUrl:t,data:l};try{var h=u.objectStore(s).put(i);h.onsuccess=function(){},h.onerror=function(){p.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(e){n(l)}}else n(l);else c.status>=400&&o?o(c):n()},!1),c.addEventListener("error",function(){p.a.Error("error on XHR request."),n()},!1),c.send()}else p.a.Error("Error: IndexedDB not supported by your browser or Babylon.js Database is not open."),n()},e._ValidateXHRData=function(e,t){void 0===t&&(t=7);try{if(1&t){if(e.responseText&&e.responseText.length>0)return!0;if(1===t)return!1}if(2&t){var n=bo.GetTGAHeader(e.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(2===t)return!1}if(4&t){var i=new Uint8Array(e.response,0,3);return 68===i[0]&&68===i[1]&&83===i[2]}}catch(e){}return!1},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!1,e._ParseURL=function(e){document.createElement("a").href=e;var t=e.substring(0,e.lastIndexOf("#")),n=e.substring(t.lastIndexOf("/")+1,e.length);return e.substring(0,e.indexOf(n,0))},e._ReturnFullUrlLocation=function(t){return-1===t.indexOf("http:/")&&-1===t.indexOf("https:/")?e._ParseURL(window.location.href)+t:t},e}(),ba=function(){function e(){this.direction1=new o.x(0,1,0),this.direction2=new o.x(0,1,0),this.minEmitBox=new o.x(-.5,-.5,-.5),this.maxEmitBox=new o.x(.5,.5,.5)}return e.prototype.startDirectionFunction=function(e,t,n){var i=I.a.RandomRange(this.direction1.x,this.direction2.x),r=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(i,r,a,e,t)},e.prototype.startPositionFunction=function(e,t,n){var i=I.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),r=I.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),a=I.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);o.x.TransformCoordinatesFromFloatsToRef(i,r,a,e,t)},e.prototype.clone=function(){var t=new e;return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2),e.setVector3("minEmitBox",this.minEmitBox),e.setVector3("maxEmitBox",this.maxEmitBox)},e.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},e.prototype.getClassName=function(){return"BoxParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.minEmitBox=this.minEmitBox.asArray(),e.maxEmitBox=this.maxEmitBox.asArray(),e},e.prototype.parse=function(e){o.x.FromArrayToRef(e.direction1,0,this.direction1),o.x.FromArrayToRef(e.direction2,0,this.direction2),o.x.FromArrayToRef(e.minEmitBox,0,this.minEmitBox),o.x.FromArrayToRef(e.maxEmitBox,0,this.maxEmitBox)},e}(),ya=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=Math.PI),void 0===n&&(n=0),this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=t,this.radius=e}return Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._buildHeight()},enumerable:!0,configurable:!0}),e.prototype._buildHeight=function(){this._height=0!==this._angle?this._radius/Math.tan(this._angle/2):1},e.prototype.startDirectionFunction=function(e,t,n){if(1===Math.abs(Math.cos(this._angle)))o.x.TransformNormalFromFloatsToRef(0,1,0,e,t);else{var i=n.position.subtract(e.getTranslation()).normalize(),r=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);i.x+=r,i.y+=a,i.z+=s,i.normalize(),o.x.TransformNormalFromFloatsToRef(i.x,i.y,i.z,e,t)}},e.prototype.startPositionFunction=function(e,t,n){var i,r=I.a.RandomRange(0,2*Math.PI);i=this.emitFromSpawnPointOnly?1e-4:1-(i=I.a.RandomRange(0,this.heightRange))*i;var a=this._radius-I.a.RandomRange(0,this._radius*this.radiusRange),s=(a*=i)*Math.sin(r),l=a*Math.cos(r);o.x.TransformCoordinatesFromFloatsToRef(s,i*this._height,l,e,t)},e.prototype.clone=function(){var t=new e(this._radius,this._angle,this.directionRandomizer);return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat2("radius",this._radius,this.radiusRange),e.setFloat("coneAngle",this._angle),e.setFloat2("height",this._height,this.heightRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){var e="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(e+="\n#define CONEEMITTERSPAWNPOINT"),e},e.prototype.getClassName=function(){return"ConeParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this._radius,e.angle=this._angle,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.angle=e.angle,this.directionRandomizer=e.directionRandomizer},e}(),Ta=function(){function e(e,t,n,i){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=0),this.radius=e,this.height=t,this.radiusRange=n,this.directionRandomizer=i}return e.prototype.startDirectionFunction=function(e,t,n){var i=n.position.subtract(e.getTranslation()).normalize(),r=I.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),a=Math.atan2(i.x,i.z);a+=I.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,i.y=r,i.x=Math.sin(a),i.z=Math.cos(a),i.normalize(),o.x.TransformNormalFromFloatsToRef(i.x,i.y,i.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var i=I.a.RandomRange(-this.height/2,this.height/2),r=I.a.RandomRange(0,2*Math.PI),a=I.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(a)*this.radius,l=s*Math.cos(r),c=s*Math.sin(r);o.x.TransformCoordinatesFromFloatsToRef(l,i,c,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},e.prototype.getClassName=function(){return"CylinderParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.height=this.height,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.height=e.height,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),Ea=function(e){function t(t,n,i,r,a){void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=new o.x(0,1,0)),void 0===a&&(a=new o.x(0,1,0));var s=e.call(this,t,n,i)||this;return s.direction1=r,s.direction2=a,s}return c.d(t,e),t.prototype.startDirectionFunction=function(e,t,n){var i=I.a.RandomRange(this.direction1.x,this.direction2.x),r=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(i,r,a,e,t)},t.prototype.clone=function(){var e=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return P.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},t}(Ta),xa=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=n}return e.prototype.startDirectionFunction=function(e,t,n){var i=n.position.subtract(e.getTranslation()).normalize(),r=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);i.x+=r,i.y+=a,i.z+=s,i.normalize(),o.x.TransformNormalFromFloatsToRef(i.x,i.y,i.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var i=this.radius-I.a.RandomRange(0,this.radius*this.radiusRange),r=I.a.RandomRange(0,1),a=I.a.RandomRange(0,2*Math.PI),s=Math.acos(2*r-1),l=i*Math.cos(a)*Math.sin(s),c=i*Math.cos(s),u=i*Math.sin(a)*Math.sin(s);o.x.TransformCoordinatesFromFloatsToRef(l,Math.abs(c),u,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},e.prototype.getClassName=function(){return"HemisphericParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),Ca=function(){function e(){this.direction1=new o.x(0,1,0),this.direction2=new o.x(0,1,0)}return e.prototype.startDirectionFunction=function(e,t,n){var i=I.a.RandomRange(this.direction1.x,this.direction2.x),r=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(i,r,a,e,t)},e.prototype.startPositionFunction=function(e,t,n){o.x.TransformCoordinatesFromFloatsToRef(0,0,0,e,t)},e.prototype.clone=function(){var t=new e;return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},e.prototype.getClassName=function(){return"PointParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},e.prototype.parse=function(e){o.x.FromArrayToRef(e.direction1,0,this.direction1),o.x.FromArrayToRef(e.direction2,0,this.direction2)},e}(),Sa=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=n}return e.prototype.startDirectionFunction=function(e,t,n){var i=n.position.subtract(e.getTranslation()).normalize(),r=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);i.x+=r,i.y+=a,i.z+=s,i.normalize(),o.x.TransformNormalFromFloatsToRef(i.x,i.y,i.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var i=this.radius-I.a.RandomRange(0,this.radius*this.radiusRange),r=I.a.RandomRange(0,1),a=I.a.RandomRange(0,2*Math.PI),s=Math.acos(2*r-1),l=i*Math.cos(a)*Math.sin(s),c=i*Math.cos(s),u=i*Math.sin(a)*Math.sin(s);o.x.TransformCoordinatesFromFloatsToRef(l,c,u,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return P.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},e.prototype.getClassName=function(){return"SphereParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),Aa=function(e){function t(t,n,i){void 0===t&&(t=1),void 0===n&&(n=new o.x(0,1,0)),void 0===i&&(i=new o.x(0,1,0));var r=e.call(this,t)||this;return r.direction1=n,r.direction2=i,r}return c.d(t,e),t.prototype.startDirectionFunction=function(e,t,n){var i=I.a.RandomRange(this.direction1.x,this.direction2.x),r=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(i,r,a,e,t)},t.prototype.clone=function(){var e=new t(this.radius,this.direction1,this.direction2);return P.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},t}(Sa),Pa=function(){function e(t){this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new o.x(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new o.w(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new o.x(0,0,0),this.gravity=o.x.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new o.f(1,1,1,1),this.color2=new o.f(1,1,1,1),this.colorDead=new o.f(0,0,0,1),this.textureMask=new o.f(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=g.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new vn.b,this.id=t,this.name=t}return Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},e.prototype.getDragGradients=function(){return this._dragGradients},e.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},e.prototype.getColorGradients=function(){return this._colorGradients},e.prototype.getSizeGradients=function(){return this._sizeGradients},e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},e.prototype.getVelocityGradients=function(){return this._velocityGradients},e.prototype.getStartSizeGradients=function(){return this._startSizeGradients},e.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.x.Zero()},set:function(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.x.Zero()},set:function(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.x.Zero()},set:function(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.x.Zero()},set:function(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=e||this._scene.imageProcessingConfiguration)},e.prototype._reset=function(){},e.prototype._removeGradientAndTexture=function(e,t,n){if(!t)return this;for(var i=0,r=0,o=t;r<o.length;r++){if(o[r].gradient===e){t.splice(i,1);break}i++}return n&&n.dispose(),this},e.prototype.createPointEmitter=function(e,t){var n=new Ca;return n.direction1=e,n.direction2=t,this.particleEmitterType=n,n},e.prototype.createHemisphericEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=1);var n=new xa(e,t);return this.particleEmitterType=n,n},e.prototype.createSphereEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=1);var n=new Sa(e,t);return this.particleEmitterType=n,n},e.prototype.createDirectedSphereEmitter=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=new o.x(0,1,0)),void 0===n&&(n=new o.x(0,1,0));var i=new Aa(e,t,n);return this.particleEmitterType=i,i},e.prototype.createCylinderEmitter=function(e,t,n,i){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=0);var r=new Ta(e,t,n,i);return this.particleEmitterType=r,r},e.prototype.createDirectedCylinderEmitter=function(e,t,n,i,r){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===i&&(i=new o.x(0,1,0)),void 0===r&&(r=new o.x(0,1,0));var a=new Ea(e,t,n,i,r);return this.particleEmitterType=a,a},e.prototype.createConeEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=Math.PI/4);var n=new ya(e,t);return this.particleEmitterType=n,n},e.prototype.createBoxEmitter=function(e,t,n,i){var r=new ba;return this.particleEmitterType=r,this.direction1=e,this.direction2=t,this.minEmitBox=n,this.maxEmitBox=i,r},e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e}(),Ra=function(){function e(t){this.particleSystem=t,this.position=o.x.Zero(),this.direction=o.x.Zero(),this.color=new o.f(0,0,0,0),this.colorStep=new o.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.w(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new o.f(0,0,0,0),this._currentColor2=new o.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return e.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},e.prototype.updateCellIndex=function(){var e=this.age,t=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===t?(t=1,e=this._randomCellOffset):e+=this._randomCellOffset);var n=this._initialEndSpriteCellID-this._initialStartSpriteCellID,i=I.a.Clamp(e*t%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+i*n|0},e.prototype._inheritParticleInfoToSubEmitter=function(e){if(e.particleSystem.emitter.position){var t=e.particleSystem.emitter;t.position.copyFrom(this.position),e.inheritDirection&&(t.position.subtractToRef(this.direction,o.t.Vector3[0]),t.lookAt(o.t.Vector3[0],0,Math.PI/2))}else e.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(e.inheritedVelocityAmount/2,o.t.Vector3[0]),e.particleSystem._inheritedVelocityOffset.copyFrom(o.t.Vector3[0])},e.prototype._inheritParticleInfoToSubEmitters=function(){var e=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(t){e._inheritParticleInfoToSubEmitter(t)})},e.prototype._reset=function(){this.age=0,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},e.prototype.copyTo=function(e){e.position.copyFrom(this.position),this._initialDirection?e._initialDirection?e._initialDirection.copyFrom(this._initialDirection):e._initialDirection=this._initialDirection.clone():e._initialDirection=null,e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e._randomCellOffset=this._randomCellOffset,e.size=this.size,e.scale.copyFrom(this.scale),e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex,e.id=this.id,e._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(e._currentColorGradient=this._currentColorGradient,e._currentColor1.copyFrom(this._currentColor1),e._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(e._currentSizeGradient=this._currentSizeGradient,e._currentSize1=this._currentSize1,e._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(e._currentAngularSpeedGradient=this._currentAngularSpeedGradient,e._currentAngularSpeed1=this._currentAngularSpeed1,e._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(e._currentVelocityGradient=this._currentVelocityGradient,e._currentVelocity1=this._currentVelocity1,e._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(e._currentLimitVelocityGradient=this._currentLimitVelocityGradient,e._currentLimitVelocity1=this._currentLimitVelocity1,e._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(e._currentDragGradient=this._currentDragGradient,e._currentDrag1=this._currentDrag1,e._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(e._initialStartSpriteCellID=this._initialStartSpriteCellID,e._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&e.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),e._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(e._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),e._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},e._Count=0,e}();!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(_a||(_a={}));var Ma=function(){function e(e){this.particleSystem=e,this.type=_a.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,e.emitter&&e.emitter.dispose||(e.emitter=new ke.a("SubemitterSystemEmitter",e.getScene())),e.onDisposeObservable.add(function(){e.emitter&&e.emitter.dispose&&e.emitter.dispose()})}return e.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof o.x?t=t.clone():t instanceof ke.a&&((t=new fe.a("",t.getScene())).isVisible=!1):t=new o.x;var n=new e(this.particleSystem.clone("",t));return n.type=this.type,n.inheritDirection=this.inheritDirection,n.inheritedVelocityAmount=this.inheritedVelocityAmount,n.particleSystem._disposeEmitterOnDispose=!0,n.particleSystem.disposeOnStop=!0,n},e.prototype.serialize=function(){var e={};return e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem=this.particleSystem.serialize(),e},e._ParseParticleSystem=function(e,t,n){throw ye.a.WarnImport("ParseParticle")},e.Parse=function(t,n,i){var r=new e(e._ParseParticleSystem(t.particleSystem,n,i));return r.type=t.type,r.inheritDirection=t.inheritDirection,r.inheritedVelocityAmount=t.inheritedVelocityAmount,r.particleSystem._isSubEmitter=!0,r},e.prototype.dispose=function(){this.particleSystem.dispose()},e}();zt.a.ShadersStore.particlesPixelShader="\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}",zt.a.ShadersStore.particlesVertexShader="\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos;\n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\nvoid main(void) {\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0);\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}";var Oa=function(e){function t(t,n,i,a,s,l){void 0===a&&(a=null),void 0===s&&(s=!1),void 0===l&&(l=.01);var c=e.call(this,t)||this;return c._inheritedVelocityOffset=new o.x,c.onDisposeObservable=new r.c,c._particles=new Array,c._stockParticles=new Array,c._newPartsExcess=0,c._vertexBuffers={},c._scaledColorStep=new o.f(0,0,0,0),c._colorDiff=new o.f(0,0,0,0),c._scaledDirection=o.x.Zero(),c._scaledGravity=o.x.Zero(),c._currentRenderId=-1,c._useInstancing=!1,c._started=!1,c._stopped=!1,c._actualFrame=0,c._currentEmitRate1=0,c._currentEmitRate2=0,c._currentStartSize1=0,c._currentStartSize2=0,c._rawTextureWidth=256,c._useRampGradients=!1,c._disposeEmitterOnDispose=!1,c.recycleParticle=function(e){var t=c._particles.pop();t!==e&&t.copyTo(e),c._stockParticles.push(t)},c._createParticle=function(){var e;if(0!==c._stockParticles.length?(e=c._stockParticles.pop())._reset():e=new Ra(c),c._subEmitters&&c._subEmitters.length>0){var t=c._subEmitters[Math.floor(Math.random()*c._subEmitters.length)];e._attachedSubEmitters=[],t.forEach(function(t){if(t.type===_a.ATTACHED){var n=t.clone();e._attachedSubEmitters.push(n),n.particleSystem.start()}})}return e},c._emitFromParticle=function(e){if(c._subEmitters&&0!==c._subEmitters.length){var t=Math.floor(Math.random()*c._subEmitters.length);c._subEmitters[t].forEach(function(t){if(t.type===_a.END){var n=t.clone();e._inheritParticleInfoToSubEmitter(n),n.particleSystem._rootParticleSystem=c,c.activeSubSystems.push(n.particleSystem),n.particleSystem.start()}})}},c._capacity=n,c._epsilon=l,c._isAnimationSheetEnabled=s,c._scene=i||A.a.LastCreatedScene,c._attachImageProcessingConfiguration(null),c._customEffect=a,c._scene.particleSystems.push(c),c._useInstancing=c._scene.getEngine().getCaps().instancedArrays,c._createIndexBuffer(),c._createVertexBuffers(),c.particleEmitterType=new ba,c.updateFunction=function(e){var t=null,n=null;c.noiseTexture&&(t=c.noiseTexture.getSize(),n=c.noiseTexture.getContent());for(var i,r=function(){var r=c._scaledUpdateSpeed,s=(i=e[a]).age;i.age+=r,i.age>i.lifeTime&&(r=(i.lifeTime-s)*r/(i.age-s),i.age=i.lifeTime);var l=i.age/i.lifeTime;c._colorGradients&&c._colorGradients.length>0?be.h.GetCurrentGradient(l,c._colorGradients,function(e,t,n){e!==i._currentColorGradient&&(i._currentColor1.copyFrom(i._currentColor2),t.getColorToRef(i._currentColor2),i._currentColorGradient=e),o.f.LerpToRef(i._currentColor1,i._currentColor2,n,i.color)}):(i.colorStep.scaleToRef(r,c._scaledColorStep),i.color.addInPlace(c._scaledColorStep),i.color.a<0&&(i.color.a=0)),c._angularSpeedGradients&&c._angularSpeedGradients.length>0&&be.h.GetCurrentGradient(l,c._angularSpeedGradients,function(e,t,n){e!==i._currentAngularSpeedGradient&&(i._currentAngularSpeed1=i._currentAngularSpeed2,i._currentAngularSpeed2=t.getFactor(),i._currentAngularSpeedGradient=e),i.angularSpeed=I.a.Lerp(i._currentAngularSpeed1,i._currentAngularSpeed2,n)}),i.angle+=i.angularSpeed*r;var u=r;if(c._velocityGradients&&c._velocityGradients.length>0&&be.h.GetCurrentGradient(l,c._velocityGradients,function(e,t,n){e!==i._currentVelocityGradient&&(i._currentVelocity1=i._currentVelocity2,i._currentVelocity2=t.getFactor(),i._currentVelocityGradient=e),u*=I.a.Lerp(i._currentVelocity1,i._currentVelocity2,n)}),i.direction.scaleToRef(u,c._scaledDirection),c._limitVelocityGradients&&c._limitVelocityGradients.length>0&&be.h.GetCurrentGradient(l,c._limitVelocityGradients,function(e,t,n){e!==i._currentLimitVelocityGradient&&(i._currentLimitVelocity1=i._currentLimitVelocity2,i._currentLimitVelocity2=t.getFactor(),i._currentLimitVelocityGradient=e);var r=I.a.Lerp(i._currentLimitVelocity1,i._currentLimitVelocity2,n);i.direction.length()>r&&i.direction.scaleInPlace(c.limitVelocityDamping)}),c._dragGradients&&c._dragGradients.length>0&&be.h.GetCurrentGradient(l,c._dragGradients,function(e,t,n){e!==i._currentDragGradient&&(i._currentDrag1=i._currentDrag2,i._currentDrag2=t.getFactor(),i._currentDragGradient=e);var r=I.a.Lerp(i._currentDrag1,i._currentDrag2,n);c._scaledDirection.scaleInPlace(1-r)}),i.position.addInPlace(c._scaledDirection),n&&t&&i._randomNoiseCoordinates1){var h=c._fetchR(i._randomNoiseCoordinates1.x,i._randomNoiseCoordinates1.y,t.width,t.height,n),d=c._fetchR(i._randomNoiseCoordinates1.z,i._randomNoiseCoordinates2.x,t.width,t.height,n),f=c._fetchR(i._randomNoiseCoordinates2.y,i._randomNoiseCoordinates2.z,t.width,t.height,n),p=o.t.Vector3[0],g=o.t.Vector3[1];p.copyFromFloats((2*h-1)*c.noiseStrength.x,(2*d-1)*c.noiseStrength.y,(2*f-1)*c.noiseStrength.z),p.scaleToRef(r,g),i.direction.addInPlace(g)}if(c.gravity.scaleToRef(r,c._scaledGravity),i.direction.addInPlace(c._scaledGravity),c._sizeGradients&&c._sizeGradients.length>0&&be.h.GetCurrentGradient(l,c._sizeGradients,function(e,t,n){e!==i._currentSizeGradient&&(i._currentSize1=i._currentSize2,i._currentSize2=t.getFactor(),i._currentSizeGradient=e),i.size=I.a.Lerp(i._currentSize1,i._currentSize2,n)}),c._useRampGradients&&(c._colorRemapGradients&&c._colorRemapGradients.length>0&&be.h.GetCurrentGradient(l,c._colorRemapGradients,function(e,t,n){var r=I.a.Lerp(e.factor1,t.factor1,n),o=I.a.Lerp(e.factor2,t.factor2,n);i.remapData.x=r,i.remapData.y=o-r}),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&be.h.GetCurrentGradient(l,c._alphaRemapGradients,function(e,t,n){var r=I.a.Lerp(e.factor1,t.factor1,n),o=I.a.Lerp(e.factor2,t.factor2,n);i.remapData.z=r,i.remapData.w=o-r})),c._isAnimationSheetEnabled&&i.updateCellIndex(),i._inheritParticleInfoToSubEmitters(),i.age>=i.lifeTime)return c._emitFromParticle(i),i._attachedSubEmitters&&(i._attachedSubEmitters.forEach(function(e){e.particleSystem.disposeOnStop=!0,e.particleSystem.stop()}),i._attachedSubEmitters=null),c.recycleParticle(i),a--,"continue"},a=0;a<e.length;a++)r()},c}return c.d(t,e),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype._addFactorGradient=function(e,t,n,i){var r=new be.d;r.gradient=t,r.factor1=n,r.factor2=i,e.push(r),e.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})},t.prototype._removeFactorGradient=function(e,t){if(e)for(var n=0,i=0,r=e;i<r.length;i++){if(r[i].gradient===t){e.splice(n,1);break}n++}},t.prototype.addLifeTimeGradient=function(e,t,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,t,n),this},t.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},t.prototype.addSizeGradient=function(e,t,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t,n),this},t.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},t.prototype.addColorRemapGradient=function(e,t,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,t,n),this},t.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},t.prototype.addAlphaRemapGradient=function(e,t,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,t,n),this},t.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},t.prototype.addAngularSpeedGradient=function(e,t,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t,n),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},t.prototype.addVelocityGradient=function(e,t,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t,n),this},t.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},t.prototype.addLimitVelocityGradient=function(e,t,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t,n),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},t.prototype.addDragGradient=function(e,t,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t,n),this},t.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},t.prototype.addEmitRateGradient=function(e,t,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,t,n),this},t.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype.addStartSizeGradient=function(e,t,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,t,n),this},t.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),t=o.t.Color3[0],n=0;n<this._rawTextureWidth;n++)be.h.GetCurrentGradient(n/this._rawTextureWidth,this._rampGradients,function(i,r,a){o.e.LerpToRef(i.color,r.color,a,t),e[4*n]=255*t.r,e[4*n+1]=255*t.g,e[4*n+2]=255*t.b,e[4*n+3]=255});this._rampGradientsTexture=je.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.addRampGradient=function(e,t){this._rampGradients||(this._rampGradients=[]);var n=new be.b;return n.gradient=e,n.color=t,this._rampGradients.push(n),this._rampGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},t.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(e,t,n){this._colorGradients||(this._colorGradients=[]);var i=new be.c;return i.gradient=e,i.color1=t,i.color2=n,this._colorGradients.push(i),this._colorGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this},t.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var t=0,n=0,i=this._colorGradients;n<i.length;n++){if(i[n].gradient===e){this._colorGradients.splice(t,1);break}t++}return this},t.prototype._fetchR=function(e,t,n,i,r){return r[4*(((e=.5*Math.abs(e)+.5)*n%n|0)+((t=.5*Math.abs(t)+.5)*i%i|0)*n)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new Cn.a(e,this._vertexData,!0,this._vertexBufferSize);var n=0,i=this._vertexBuffer.createVertexBuffer(Cn.b.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Cn.b.PositionKind]=i;var r=this._vertexBuffer.createVertexBuffer(Cn.b.ColorKind,n+=3,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Cn.b.ColorKind]=r;var o=this._vertexBuffer.createVertexBuffer("angle",n+=4,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o;var a,s=this._vertexBuffer.createVertexBuffer("size",n+=1,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=s,n+=2,this._isAnimationSheetEnabled){var l=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=l,n+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var c=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=c,n+=3}if(this._useRampGradients){var u=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=u,n+=4}if(this._useInstancing){var h=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new Cn.a(e,h,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=a},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],t=0,n=0;n<this._capacity;n++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(n){n instanceof t?e._subEmitters.push([new Ma(n)]):n instanceof Ma?e._subEmitters.push([n]):n instanceof Array&&e._subEmitters.push(n)})},t.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){t.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof ke.a&&this.emitter.computeWorldMatrix(!0);var n=this.noiseTexture;if(n&&n.onGeneratedObservable)n.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var e=0;e<t.preWarmCycles;e++)t.animate(!0),n.render()})});else for(var i=0;i<this.preWarmCycles;i++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(e){void 0===e&&(e=!0),this._stopped=!0,e&&this._stopSubEmitters()},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(e,n,i,r){var o=e*this._vertexBufferSize;this._vertexData[o++]=n.position.x+this.worldOffset.x,this._vertexData[o++]=n.position.y+this.worldOffset.y,this._vertexData[o++]=n.position.z+this.worldOffset.z,this._vertexData[o++]=n.color.r,this._vertexData[o++]=n.color.g,this._vertexData[o++]=n.color.b,this._vertexData[o++]=n.color.a,this._vertexData[o++]=n.angle,this._vertexData[o++]=n.scale.x*n.size,this._vertexData[o++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[o++]=n.cellIndex),this._isBillboardBased?this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[o++]=n.direction.x,this._vertexData[o++]=n.direction.y,this._vertexData[o++]=n.direction.z):n._initialDirection?(this._vertexData[o++]=n._initialDirection.x,this._vertexData[o++]=n._initialDirection.y,this._vertexData[o++]=n._initialDirection.z):(this._vertexData[o++]=n.direction.x,this._vertexData[o++]=n.direction.y,this._vertexData[o++]=n.direction.z),this._useRampGradients&&(this._vertexData[o++]=n.remapData.x,this._vertexData[o++]=n.remapData.y,this._vertexData[o++]=n.remapData.z,this._vertexData[o++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon)),this._vertexData[o++]=i,this._vertexData[o++]=r)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},t.prototype._update=function(e){var t,n=this;if(this._alive=this._particles.length>0,this.emitter.position)this._emitterWorldMatrix=this.emitter.getWorldMatrix();else{var i=this.emitter;this._emitterWorldMatrix=o.j.Translation(i.x,i.y,i.z)}this.updateFunction(this._particles);for(var r,a=function(){if(s._particles.length===s._capacity)return"break";t=s._createParticle(),s._particles.push(t);var e=I.a.RandomRange(s.minEmitPower,s.maxEmitPower);if(s.startPositionFunction?s.startPositionFunction(s._emitterWorldMatrix,t.position,t):s.particleEmitterType.startPositionFunction(s._emitterWorldMatrix,t.position,t),s.startDirectionFunction?s.startDirectionFunction(s._emitterWorldMatrix,t.direction,t):s.particleEmitterType.startDirectionFunction(s._emitterWorldMatrix,t.direction,t),0===e?t._initialDirection?t._initialDirection.copyFrom(t.direction):t._initialDirection=t.direction.clone():t._initialDirection=null,t.direction.scaleInPlace(e),s.targetStopDuration&&s._lifeTimeGradients&&s._lifeTimeGradients.length>0){var i=I.a.Clamp(s._actualFrame/s.targetStopDuration);be.h.GetCurrentGradient(i,s._lifeTimeGradients,function(e,n){var r=e,o=n,a=r.getFactor(),s=o.getFactor();t.lifeTime=I.a.Lerp(a,s,(i-r.gradient)/(o.gradient-r.gradient))})}else t.lifeTime=I.a.RandomRange(s.minLifeTime,s.maxLifeTime);s._sizeGradients&&0!==s._sizeGradients.length?(t._currentSizeGradient=s._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,t._currentSize2=s._sizeGradients.length>1?s._sizeGradients[1].getFactor():t._currentSize1):t.size=I.a.RandomRange(s.minSize,s.maxSize),t.scale.copyFromFloats(I.a.RandomRange(s.minScaleX,s.maxScaleX),I.a.RandomRange(s.minScaleY,s.maxScaleY)),s._startSizeGradients&&s._startSizeGradients[0]&&s.targetStopDuration&&be.h.GetCurrentGradient(s._actualFrame/s.targetStopDuration,s._startSizeGradients,function(e,i,r){e!==n._currentStartSizeGradient&&(n._currentStartSize1=n._currentStartSize2,n._currentStartSize2=i.getFactor(),n._currentStartSizeGradient=e);var o=I.a.Lerp(n._currentStartSize1,n._currentStartSize2,r);t.scale.scaleInPlace(o)}),s._angularSpeedGradients&&0!==s._angularSpeedGradients.length?(t._currentAngularSpeedGradient=s._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,t._currentAngularSpeed2=s._angularSpeedGradients.length>1?s._angularSpeedGradients[1].getFactor():t._currentAngularSpeed1):t.angularSpeed=I.a.RandomRange(s.minAngularSpeed,s.maxAngularSpeed),t.angle=I.a.RandomRange(s.minInitialRotation,s.maxInitialRotation),s._velocityGradients&&s._velocityGradients.length>0&&(t._currentVelocityGradient=s._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),t._currentVelocity2=s._velocityGradients.length>1?s._velocityGradients[1].getFactor():t._currentVelocity1),s._limitVelocityGradients&&s._limitVelocityGradients.length>0&&(t._currentLimitVelocityGradient=s._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),t._currentLimitVelocity2=s._limitVelocityGradients.length>1?s._limitVelocityGradients[1].getFactor():t._currentLimitVelocity1),s._dragGradients&&s._dragGradients.length>0&&(t._currentDragGradient=s._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),t._currentDrag2=s._dragGradients.length>1?s._dragGradients[1].getFactor():t._currentDrag1),s._colorGradients&&0!==s._colorGradients.length?(t._currentColorGradient=s._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.copyFrom(t.color),s._colorGradients.length>1?s._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.copyFrom(t.color)):(r=I.a.RandomRange(0,1),o.f.LerpToRef(s.color1,s.color2,r,t.color),s.colorDead.subtractToRef(t.color,s._colorDiff),s._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)),s._isAnimationSheetEnabled&&(t._initialStartSpriteCellID=s.startSpriteCellID,t._initialEndSpriteCellID=s.endSpriteCellID),t.direction.addInPlace(s._inheritedVelocityOffset),s._useRampGradients&&(t.remapData=new o.y(0,1,0,1)),s.noiseTexture&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new o.x(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new o.x(Math.random(),Math.random(),Math.random()))),t._inheritParticleInfoToSubEmitters()},s=this,l=0;l<e&&"break"!==a();l++);},t._GetAttributeNamesOrOptions=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1);var i=[Cn.b.PositionKind,Cn.b.ColorKind,"angle","offset","size"];return e&&i.push("cellIndex"),t||i.push("direction"),n&&i.push("remapData"),i},t._GetEffectCreationOptions=function(e){void 0===e&&(e=!1);var t=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMask","translationPivot","eyePosition"];return e&&t.push("particlesInfos"),t},t.prototype._getEffect=function(e){if(this._customEffect)return this._customEffect;var n=[];if(this._scene.clipPlane&&n.push("#define CLIPPLANE"),this._scene.clipPlane2&&n.push("#define CLIPPLANE2"),this._scene.clipPlane3&&n.push("#define CLIPPLANE3"),this._scene.clipPlane4&&n.push("#define CLIPPLANE4"),this._isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),e===t.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&n.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:n.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:n.push("#define BILLBOARDSTRETCHED")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(this._imageProcessingConfigurationDefines.toString()));var i=n.join("\n");if(this._cachedDefines!==i){this._cachedDefines=i;var r=t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients),o=t._GetEffectCreationOptions(this._isAnimationSheetEnabled),a=["diffuseSampler","rampSampler"];vn.a&&(vn.a.PrepareUniforms(o,this._imageProcessingConfigurationDefines),vn.a.PrepareSamplers(a,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",r,o,a,i)}return this._effect},t.prototype.animate=function(e){var t=this;if(void 0===e&&(e=!1),this._started){if(!e){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var n;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)n=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var i=this.emitRate;this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration&&be.h.GetCurrentGradient(this._actualFrame/this.targetStopDuration,this._emitRateGradients,function(e,n,r){e!==t._currentEmitRateGradient&&(t._currentEmitRate1=t._currentEmitRate2,t._currentEmitRate2=n.getFactor(),t._currentEmitRateGradient=e),i=I.a.Lerp(t._currentEmitRate1,t._currentEmitRate2,r)}),this._newPartsExcess+=i*this._scaledUpdateSpeed-(n=i*this._scaledUpdateSpeed>>0)}if(this._newPartsExcess>1&&(n+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?n=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(n),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!e){for(var r=0,o=0;o<this._particles.length;o++)this._appendParticleVertices(r,this._particles[o]),r+=this._useInstancing?1:4;this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(e,t){this._appendParticleVertex(e++,t,0,0),this._useInstancing||(this._appendParticleVertex(e++,t,1,0),this._appendParticleVertex(e++,t,1,1),this._appendParticleVertex(e++,t,0,1))},t.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},t.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(t.BLENDMODE_ADD).isReady())return!1}return!0},t.prototype._render=function(e){var n=this._getEffect(e),i=this._scene.getEngine();i.enableEffect(n);var r=this._scene.getViewMatrix();if(n.setTexture("diffuseSampler",this.particleTexture),n.setMatrix("view",r),n.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var o=this.particleTexture.getBaseSize();n.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(n.setVector2("translationPivot",this.translationPivot),n.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&n.setVector3("eyePosition",this._scene.activeCamera.globalPosition),this._rampGradientsTexture&&n.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var a=r.clone();a.invert(),n.setMatrix("invView",a),Wi.a.BindClipPlane(n,this._scene)}switch(i.bindBuffers(this._vertexBuffers,this._indexBuffer,n),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),e){case t.BLENDMODE_ADD:i.setAlphaMode(g.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:i.setAlphaMode(g.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:i.setAlphaMode(g.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:i.setAlphaMode(g.a.ALPHA_MULTIPLY)}return this._useInstancing?i.drawArraysType(Pr.a.TriangleFanDrawMode,0,4,this._particles.length):i.drawElementsType(Pr.a.TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._scene.getEngine();e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0);var n=0;return this.blendMode===t.BLENDMODE_MULTIPLYADD&&(n=this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD)),n=this._render(this.blendMode),e.unbindInstanceAttributes(),e.setAlphaMode(g.a.ALPHA_DISABLE),n},t.prototype.dispose=function(e){if(void 0===e&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var t=0;t<this._subEmitters.length;t++)for(var n=0,i=this._subEmitters[t];n<i.length;n++)i[n].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(t=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(t,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},t.prototype.clone=function(e,n){var i=null,r=null;if(null!=this.customShader){var o=(r=this.customShader).shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"";i=this._scene.getEngine().createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,o)}else this._customEffect&&(i=this._customEffect);var a=new t(e,this._capacity,this._scene,i);return a.customShader=r,P.a.DeepCopy(this,a,["particles","customShader","noiseTexture"]),void 0===n&&(n=this.emitter),a.noiseTexture=this.noiseTexture,a.emitter=n,this.particleTexture&&(a.particleTexture=new Ge.a(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach(function(e){a.addColorGradient(e.gradient,e.color1,e.color2)}),this._dragGradients&&this._dragGradients.forEach(function(e){a.addDragGradient(e.gradient,e.factor1,e.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(e){a.addAngularSpeedGradient(e.gradient,e.factor1,e.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(e){a.addEmitRateGradient(e.gradient,e.factor1,e.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(e){a.addLifeTimeGradient(e.gradient,e.factor1,e.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(e){a.addLimitVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(e){a.addSizeGradient(e.gradient,e.factor1,e.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(e){a.addStartSizeGradient(e.gradient,e.factor1,e.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(e){a.addVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(e){a.addRampGradient(e.gradient,e.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(e){a.addColorRemapGradient(e.gradient,e.factor1,e.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(e){a.addAlphaRemapGradient(e.gradient,e.factor1,e.factor2)}),this.preventAutoStart||a.start(),a},t.prototype.serialize=function(){var e={};if(t._Serialize(e,this),e.textureMask=this.textureMask.asArray(),e.customShader=this.customShader,e.preventAutoStart=this.preventAutoStart,this.subEmitters){e.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var n=0,i=this._subEmitters;n<i.length;n++){for(var r=[],o=0,a=i[n];o<a.length;o++)r.push(a[o].serialize());e.subEmitters.push(r)}}return e},t._Serialize=function(e,t){e.name=t.name,e.id=t.id,e.capacity=t.getCapacity(),t.emitter.position?e.emitterId=t.emitter.id:e.emitter=t.emitter.asArray(),t.particleEmitterType&&(e.particleEmitterType=t.particleEmitterType.serialize()),t.particleTexture&&(e.textureName=t.particleTexture.name,e.invertY=t.particleTexture._invertY),D.a.AppendSerializedAnimations(t,e),e.beginAnimationOnStart=t.beginAnimationOnStart,e.beginAnimationFrom=t.beginAnimationFrom,e.beginAnimationTo=t.beginAnimationTo,e.beginAnimationLoop=t.beginAnimationLoop,e.startDelay=t.startDelay,e.renderingGroupId=t.renderingGroupId,e.isBillboardBased=t.isBillboardBased,e.billboardMode=t.billboardMode,e.minAngularSpeed=t.minAngularSpeed,e.maxAngularSpeed=t.maxAngularSpeed,e.minSize=t.minSize,e.maxSize=t.maxSize,e.minScaleX=t.minScaleX,e.maxScaleX=t.maxScaleX,e.minScaleY=t.minScaleY,e.maxScaleY=t.maxScaleY,e.minEmitPower=t.minEmitPower,e.maxEmitPower=t.maxEmitPower,e.minLifeTime=t.minLifeTime,e.maxLifeTime=t.maxLifeTime,e.emitRate=t.emitRate,e.gravity=t.gravity.asArray(),e.noiseStrength=t.noiseStrength.asArray(),e.color1=t.color1.asArray(),e.color2=t.color2.asArray(),e.colorDead=t.colorDead.asArray(),e.updateSpeed=t.updateSpeed,e.targetStopDuration=t.targetStopDuration,e.blendMode=t.blendMode,e.preWarmCycles=t.preWarmCycles,e.preWarmStepOffset=t.preWarmStepOffset,e.minInitialRotation=t.minInitialRotation,e.maxInitialRotation=t.maxInitialRotation,e.startSpriteCellID=t.startSpriteCellID,e.endSpriteCellID=t.endSpriteCellID,e.spriteCellChangeSpeed=t.spriteCellChangeSpeed,e.spriteCellWidth=t.spriteCellWidth,e.spriteCellHeight=t.spriteCellHeight,e.spriteRandomStartCell=t.spriteRandomStartCell,e.isAnimationSheetEnabled=t.isAnimationSheetEnabled;var n=t.getColorGradients();if(n){e.colorGradients=[];for(var i=0,r=n;i<r.length;i++){var o=r[i],a={gradient:o.gradient,color1:o.color1.asArray()};o.color2&&(a.color2=o.color2.asArray()),e.colorGradients.push(a)}}var s=t.getRampGradients();if(s){e.rampGradients=[];for(var l=0,c=s;l<c.length;l++){var u=c[l];a={gradient:u.gradient,color:u.color.asArray()},e.rampGradients.push(a)}e.useRampGradients=t.useRampGradients}var h=t.getColorRemapGradients();if(h){e.colorRemapGradients=[];for(var d=0,f=h;d<f.length;d++){var p=f[d];a={gradient:p.gradient,factor1:p.factor1},void 0!==p.factor2&&(a.factor2=p.factor2),e.colorRemapGradients.push(a)}}var g=t.getAlphaRemapGradients();if(g){e.alphaRemapGradients=[];for(var m=0,_=g;m<_.length;m++){var v=_[m];a={gradient:v.gradient,factor1:v.factor1},void 0!==v.factor2&&(a.factor2=v.factor2),e.alphaRemapGradients.push(a)}}var b=t.getSizeGradients();if(b){e.sizeGradients=[];for(var y=0,T=b;y<T.length;y++){var E=T[y];a={gradient:E.gradient,factor1:E.factor1},void 0!==E.factor2&&(a.factor2=E.factor2),e.sizeGradients.push(a)}}var x=t.getAngularSpeedGradients();if(x){e.angularSpeedGradients=[];for(var C=0,S=x;C<S.length;C++){var A=S[C];a={gradient:A.gradient,factor1:A.factor1},void 0!==A.factor2&&(a.factor2=A.factor2),e.angularSpeedGradients.push(a)}}var P=t.getVelocityGradients();if(P){e.velocityGradients=[];for(var R=0,M=P;R<M.length;R++){var O=M[R];a={gradient:O.gradient,factor1:O.factor1},void 0!==O.factor2&&(a.factor2=O.factor2),e.velocityGradients.push(a)}}var w=t.getDragGradients();if(w){e.dragyGradients=[];for(var I=0,L=w;I<L.length;I++){var k=L[I];a={gradient:k.gradient,factor1:k.factor1},void 0!==k.factor2&&(a.factor2=k.factor2),e.dragGradients.push(a)}}var N=t.getEmitRateGradients();if(N){e.emitRateGradients=[];for(var F=0,B=N;F<B.length;F++){var U=B[F];a={gradient:U.gradient,factor1:U.factor1},void 0!==U.factor2&&(a.factor2=U.factor2),e.emitRateGradients.push(a)}}var V=t.getStartSizeGradients();if(V){e.startSizeGradients=[];for(var G=0,z=V;G<z.length;G++){var j=z[G];a={gradient:j.gradient,factor1:j.factor1},void 0!==j.factor2&&(a.factor2=j.factor2),e.startSizeGradients.push(a)}}var H=t.getLifeTimeGradients();if(H){e.lifeTimeGradients=[];for(var W=0,X=H;W<X.length;W++){var Y=X[W];a={gradient:Y.gradient,factor1:Y.factor1},void 0!==Y.factor2&&(a.factor2=Y.factor2),e.lifeTimeGradients.push(a)}}var K=t.getLimitVelocityGradients();if(K){e.limitVelocityGradients=[];for(var Q=0,q=K;Q<q.length;Q++){var Z=q[Q];a={gradient:Z.gradient,factor1:Z.factor1},void 0!==Z.factor2&&(a.factor2=Z.factor2),e.limitVelocityGradients.push(a)}e.limitVelocityDamping=t.limitVelocityDamping}t.noiseTexture&&(e.noiseTexture=t.noiseTexture.serialize())},t._Parse=function(e,t,n,i){if(e.textureName&&(t.particleTexture=new Ge.a(i+e.textureName,n,!1,void 0===e.invertY||e.invertY),t.particleTexture.name=e.textureName),t.emitter=e.emitterId||0===e.emitterId||void 0!==e.emitter?e.emitterId?n.getLastMeshByID(e.emitterId):o.x.FromArray(e.emitter):o.x.Zero(),void 0!==e.renderingGroupId&&(t.renderingGroupId=e.renderingGroupId),void 0!==e.isBillboardBased&&(t.isBillboardBased=e.isBillboardBased),void 0!==e.billboardMode&&(t.billboardMode=e.billboardMode),e.animations){for(var r=0;r<e.animations.length;r++){var s=e.animations[r],l=a.a.GetClass("BABYLON.Animation");l&&t.animations.push(l.Parse(s))}t.beginAnimationOnStart=e.beginAnimationOnStart,t.beginAnimationFrom=e.beginAnimationFrom,t.beginAnimationTo=e.beginAnimationTo,t.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&n.beginAnimation(t,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),t.startDelay=0|e.startDelay,t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,e.minScaleX&&(t.minScaleX=e.minScaleX,t.maxScaleX=e.maxScaleX,t.minScaleY=e.minScaleY,t.maxScaleY=e.maxScaleY),void 0!==e.preWarmCycles&&(t.preWarmCycles=e.preWarmCycles,t.preWarmStepOffset=e.preWarmStepOffset),void 0!==e.minInitialRotation&&(t.minInitialRotation=e.minInitialRotation,t.maxInitialRotation=e.maxInitialRotation),t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.minEmitPower=e.minEmitPower,t.maxEmitPower=e.maxEmitPower,t.emitRate=e.emitRate,t.gravity=o.x.FromArray(e.gravity),e.noiseStrength&&(t.noiseStrength=o.x.FromArray(e.noiseStrength)),t.color1=o.f.FromArray(e.color1),t.color2=o.f.FromArray(e.color2),t.colorDead=o.f.FromArray(e.colorDead),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.blendMode=e.blendMode,e.colorGradients)for(var c=0,u=e.colorGradients;c<u.length;c++){var h=u[c];t.addColorGradient(h.gradient,o.f.FromArray(h.color1),h.color2?o.f.FromArray(h.color2):void 0)}if(e.rampGradients){for(var d=0,f=e.rampGradients;d<f.length;d++){var p=f[d];t.addRampGradient(p.gradient,o.e.FromArray(p.color))}t.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var g=0,m=e.colorRemapGradients;g<m.length;g++){var _=m[g];t.addColorRemapGradient(_.gradient,void 0!==_.factor1?_.factor1:_.factor,_.factor2)}if(e.alphaRemapGradients)for(var v=0,b=e.alphaRemapGradients;v<b.length;v++){var y=b[v];t.addAlphaRemapGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2)}if(e.sizeGradients)for(var T=0,E=e.sizeGradients;T<E.length;T++){var x=E[T];t.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2)}if(e.sizeGradients)for(var C=0,S=e.sizeGradients;C<S.length;C++)t.addSizeGradient((x=S[C]).gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2);if(e.angularSpeedGradients)for(var A=0,P=e.angularSpeedGradients;A<P.length;A++){var R=P[A];t.addAngularSpeedGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2)}if(e.velocityGradients)for(var M=0,O=e.velocityGradients;M<O.length;M++){var w=O[M];t.addVelocityGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2)}if(e.dragGradients)for(var I=0,D=e.dragGradients;I<D.length;I++){var L=D[I];t.addDragGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2)}if(e.emitRateGradients)for(var k=0,N=e.emitRateGradients;k<N.length;k++){var F=N[k];t.addEmitRateGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2)}if(e.startSizeGradients)for(var B=0,U=e.startSizeGradients;B<U.length;B++){var V=U[B];t.addStartSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2)}if(e.lifeTimeGradients)for(var G=0,z=e.lifeTimeGradients;G<z.length;G++){var j=z[G];t.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2)}if(e.limitVelocityGradients){for(var H=0,W=e.limitVelocityGradients;H<W.length;H++){var X=W[H];t.addLimitVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2)}t.limitVelocityDamping=e.limitVelocityDamping}var Y;if(e.noiseTexture&&(t.noiseTexture=xo.Parse(e.noiseTexture,n,i)),e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":Y=new Sa;break;case"SphereDirectedParticleEmitter":Y=new Aa;break;case"ConeEmitter":case"ConeParticleEmitter":Y=new ya;break;case"CylinderParticleEmitter":Y=new Ta;break;case"HemisphericParticleEmitter":Y=new xa;break;case"BoxEmitter":case"BoxParticleEmitter":default:Y=new ba}Y.parse(e.particleEmitterType)}else(Y=new ba).parse(e);t.particleEmitterType=Y,t.startSpriteCellID=e.startSpriteCellID,t.endSpriteCellID=e.endSpriteCellID,t.spriteCellWidth=e.spriteCellWidth,t.spriteCellHeight=e.spriteCellHeight,t.spriteCellChangeSpeed=e.spriteCellChangeSpeed,t.spriteRandomStartCell=e.spriteRandomStartCell},t.Parse=function(e,n,i,r){void 0===r&&(r=!1);var a=e.name,s=null,l=null;if(e.customShader){var c=(l=e.customShader).shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";s=n.getEngine().createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,c)}var u=new t(a,e.capacity,n,s,e.isAnimationSheetEnabled);if(u.customShader=l,e.id&&(u.id=e.id),e.subEmitters){u.subEmitters=[];for(var h=0,d=e.subEmitters;h<d.length;h++){for(var f=[],p=0,g=d[h];p<g.length;p++)f.push(Ma.Parse(g[p],n,i));u.subEmitters.push(f)}}return t._Parse(e,u,n,i),u.textureMask=o.f.FromArray(e.textureMask),e.preventAutoStart&&(u.preventAutoStart=e.preventAutoStart),r||u.preventAutoStart||u.start(),u},t.BILLBOARDMODE_Y=g.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=g.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=g.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(Pa);Ma._ParseParticleSystem=Oa.Parse,zt.a.ShadersStore.gpuUpdateParticlesPixelShader="#version 300 es\nvoid main() {\ndiscard;\n}\n",zt.a.ShadersStore.gpuUpdateParticlesVertexShader="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\nuniform mat4 emitterWM;\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif\n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta;\n\nif (newAge>=life && stopFactor != 0.) {\nvec3 position;\nvec3 direction;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=mod(newAge,outLife);\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;\n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS\noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif\n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=vec3(0,0,0);\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\ndirection=position+directionRandomizer*randoms3;\n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\ndirection=position+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nposition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\ndirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\ndirection=normalize(direction);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.00001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h;\n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nposition=vec3(randX,randY,randZ);\n\nif (abs(cos(coneAngle)) == 1.0) {\ndirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\ndirection=position+directionRandomizer*randoms3;\n}\n#else\n\nposition=vec3(0.,0.,0.);\n\ndirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\noutPosition=(emitterWM*vec4(position,1.)).xyz;\nvec3 initial=(emitterWM*vec4(direction,0.)).xyz;\noutDirection=initial*power;\n#ifndef BILLBOARD\noutInitialDirection=initial;\n#endif\n#ifdef ANIMATESHEET\noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif\n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\noutPosition=position+direction*directionScale;\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS\noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif\n#ifndef BILLBOARD\noutInitialDirection=initialDirection;\n#endif\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nvec3 localPosition=outPosition-emitterWM[3].xyz;\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET\nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#endif\nfloat ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}",zt.a.IncludesShadersStore.clipPlaneFragmentDeclaration2="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif",zt.a.ShadersStore.gpuRenderParticlesPixelShader="#version 300 es\nuniform sampler2D textureSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment>\nvec4 textureColor=texture(textureSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n",zt.a.IncludesShadersStore.clipPlaneVertexDeclaration2="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif",zt.a.ShadersStore.gpuRenderParticlesVertexShader="#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(worldPos,1.0);\n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*viewPosition;\n#endif\n#include<clipPlaneVertex>\n}";var wa=function(e){function t(t,n,i,o){void 0===o&&(o=!1);var a=e.call(this,t)||this;a.layerMask=268435455,a._accumulatedCount=0,a._targetIndex=0,a._currentRenderId=-1,a._started=!1,a._stopped=!1,a._timeDelta=0,a._actualFrame=0,a._rawTextureWidth=256,a.onDisposeObservable=new r.c,a.forceDepthWrite=!1,a._preWarmDone=!1,a._scene=i||A.a.LastCreatedScene,a._attachImageProcessingConfiguration(null),a._engine=a._scene.getEngine(),n.randomTextureSize||delete n.randomTextureSize;var s=c.a({capacity:5e4,randomTextureSize:a._engine.getCaps().maxTextureSize},n),l=n;isFinite(l)&&(s.capacity=l),a._capacity=s.capacity,a._activeCount=s.capacity,a._currentActiveCount=0,a._isAnimationSheetEnabled=o,a._scene.particleSystems.push(a),a._updateEffectOptions={attributes:["position","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},a.particleEmitterType=new ba;for(var u=Math.min(a._engine.getCaps().maxTextureSize,s.randomTextureSize),h=[],d=0;d<u;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());for(a._randomTexture=new je(new Float32Array(h),u,1,g.a.TEXTUREFORMAT_RGBA,a._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),a._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,a._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE,h=[],d=0;d<u;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());return a._randomTexture2=new je(new Float32Array(h),u,1,g.a.TEXTUREFORMAT_RGBA,a._scene,!1,!1,g.a.TEXTURE_NEAREST_SAMPLINGMODE,g.a.TEXTURETYPE_FLOAT),a._randomTexture2.wrapU=Ge.a.WRAP_ADDRESSMODE,a._randomTexture2.wrapV=Ge.a.WRAP_ADDRESSMODE,a._randomTextureSize=u,a}return c.d(t,e),Object.defineProperty(t,"IsSupported",{get:function(){return!!A.a.LastCreatedEngine&&A.a.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout(function(){t.start(0)},e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype._removeGradientAndTexture=function(t,n,i){return e.prototype._removeGradientAndTexture.call(this,t,n,i),this._releaseBuffers(),this},t.prototype.addColorGradient=function(e,t,n){this._colorGradients||(this._colorGradients=[]);var i=new be.c;return i.gradient=e,i.color1=t,this._colorGradients.push(i),this._colorGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(e,t,n){var i=new be.d;i.gradient=t,i.factor1=n,e.push(i),e.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._releaseBuffers()},t.prototype.addSizeGradient=function(e,t){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype.addAngularSpeedGradient=function(e,t){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(e,t){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(e,t){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(e,t){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(e,t,n){return this},t.prototype.removeEmitRateGradient=function(e){return this},t.prototype.addStartSizeGradient=function(e,t,n){return this},t.prototype.removeStartSizeGradient=function(e){return this},t.prototype.addColorRemapGradient=function(e,t,n){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(e,t,n){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(e,t){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addLifeTimeGradient=function(e,t,n){return this},t.prototype.removeLifeTimeGradient=function(e){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(e){var t={};t.position=e.createVertexBuffer("position",0,3),t.age=e.createVertexBuffer("age",3,1),t.life=e.createVertexBuffer("life",4,1),t.seed=e.createVertexBuffer("seed",5,4),t.size=e.createVertexBuffer("size",9,3);var n=12;this._colorGradientsTexture||(t.color=e.createVertexBuffer("color",n,4),n+=4),t.direction=e.createVertexBuffer("direction",n,3),n+=3,this._isBillboardBased||(t.initialDirection=e.createVertexBuffer("initialDirection",n,3),n+=3),this._angularSpeedGradientsTexture?(t.angle=e.createVertexBuffer("angle",n,1),n+=1):(t.angle=e.createVertexBuffer("angle",n,2),n+=2),this._isAnimationSheetEnabled&&(t.cellIndex=e.createVertexBuffer("cellIndex",n,1),n+=1,this.spriteRandomStartCell&&(t.cellStartOffset=e.createVertexBuffer("cellStartOffset",n,1),n+=1)),this.noiseTexture&&(t.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",n,3),t.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",n+=3,3),n+=3);var i=this._engine.recordVertexArrayObject(t,null,this._updateEffect);return this._engine.bindArrayBuffer(null),i},t.prototype._createRenderVAO=function(e,t){var n={};n.position=e.createVertexBuffer("position",0,3,this._attributesStrideSize,!0),n.age=e.createVertexBuffer("age",3,1,this._attributesStrideSize,!0),n.life=e.createVertexBuffer("life",4,1,this._attributesStrideSize,!0),n.size=e.createVertexBuffer("size",9,3,this._attributesStrideSize,!0);var i=12;this._colorGradientsTexture||(n.color=e.createVertexBuffer("color",i,4,this._attributesStrideSize,!0),i+=4),this.billboardMode===Oa.BILLBOARDMODE_STRETCHED&&(n.direction=e.createVertexBuffer("direction",i,3,this._attributesStrideSize,!0)),i+=3,this._isBillboardBased||(n.initialDirection=e.createVertexBuffer("initialDirection",i,3,this._attributesStrideSize,!0),i+=3),n.angle=e.createVertexBuffer("angle",i,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?i++:i+=2,this._isAnimationSheetEnabled&&(n.cellIndex=e.createVertexBuffer("cellIndex",i,1,this._attributesStrideSize,!0),i+=1,this.spriteRandomStartCell&&(n.cellStartOffset=e.createVertexBuffer("cellStartOffset",i,1,this._attributesStrideSize,!0),i+=1)),this.noiseTexture&&(n.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",i,3,this._attributesStrideSize,!0),n.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",i+=3,3,this._attributesStrideSize,!0),i+=3),n.offset=t.createVertexBuffer("offset",0,2),n.uv=t.createVertexBuffer("uv",2,2);var r=this._engine.recordVertexArrayObject(n,null,this._renderEffect);return this._engine.bindArrayBuffer(null),r},t.prototype._initialize=function(e){if(void 0===e&&(e=!1),!this._buffer0||e){var t=this._scene.getEngine(),n=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var i=0;i<this._capacity;i++)n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(0),n.push(0),n.push(0),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0)),n.push(0),n.push(0),n.push(0),this.isBillboardBased||(n.push(0),n.push(0),n.push(0)),n.push(0),this._angularSpeedGradientsTexture||n.push(0),this._isAnimationSheetEnabled&&(n.push(0),this.spriteRandomStartCell&&n.push(0)),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()));var r=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new Cn.a(t,n,!1,this._attributesStrideSize),this._buffer1=new Cn.a(t,n,!1,this._attributesStrideSize),this._spriteBuffer=new Cn.a(t,r,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(e+="\n#define BILLBOARD"),this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(e+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(e+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(e+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(e+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(e+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(e+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(e+="\n#define NOISE"),this._updateEffect&&this._updateEffectOptions.defines===e||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition","outAge","outLife","outSeed","outSize"],this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=e,this._updateEffect=new zt.a("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},t.prototype._recreateRenderEffect=function(){var e="";if(this._scene.clipPlane&&(e="\n#define CLIPPLANE"),this._scene.clipPlane2&&(e="\n#define CLIPPLANE2"),this._scene.clipPlane3&&(e="\n#define CLIPPLANE3"),this._scene.clipPlane4&&(e="\n#define CLIPPLANE4"),this.blendMode===Oa.BLENDMODE_MULTIPLY&&(e="\n#define BLENDMULTIPLYMODE"),this._isBillboardBased)switch(e+="\n#define BILLBOARD",this.billboardMode){case Oa.BILLBOARDMODE_Y:e+="\n#define BILLBOARDY";break;case Oa.BILLBOARDMODE_STRETCHED:e+="\n#define BILLBOARDSTRETCHED"}if(this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e+="\n"+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==e){var t=["worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","sheetInfos","translationPivot","eyePosition"],n=["textureSampler","colorGradientSampler"];vn.a&&(vn.a.PrepareUniforms(t,this._imageProcessingConfigurationDefines),vn.a.PrepareSamplers(n,this._imageProcessingConfigurationDefines)),this._renderEffect=new zt.a("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],t,n,this._scene.getEngine(),e)}},t.prototype.animate=function(e){void 0===e&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(e,t){if(e&&e.length&&!this[t]){for(var n=new Float32Array(this._rawTextureWidth),i=0;i<this._rawTextureWidth;i++)be.h.GetCurrentGradient(i/this._rawTextureWidth,e,function(e,t,r){n[i]=I.a.Lerp(e.factor1,t.factor1,r)});this[t]=je.CreateRTexture(n,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),t=o.t.Color4[0],n=0;n<this._rawTextureWidth;n++)be.h.GetCurrentGradient(n/this._rawTextureWidth,this._colorGradients,function(i,r,a){o.f.LerpToRef(i.color1,r.color1,a,t),e[4*n]=255*t.r,e[4*n+1]=255*t.g,e[4*n+2]=255*t.b,e[4*n+3]=255*t.a});this._colorGradientsTexture=je.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype.render=function(e){if(void 0===e&&(e=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!e){if(!this._preWarmDone&&this.preWarmCycles){for(var t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var n=0|this._accumulatedCount;this._accumulatedCount-=n,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+n)}if(!this._currentActiveCount)return 0;var i;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)i=this.emitter.getWorldMatrix();else{var r=this.emitter;i=o.j.Translation(r.x,r.y,r.z)}if(this._updateEffect.setMatrix("emitterWM",i),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(Pr.a.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!e){this._engine.enableEffect(this._renderEffect);var a=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",a),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._renderEffect.setVector3("worldOffset",this.worldOffset),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var s=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,s.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._renderEffect.setVector3("eyePosition",this._scene.activeCamera.globalPosition),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var l=a.clone();l.invert(),this._renderEffect.setMatrix("invView",l),Wi.a.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case Oa.BLENDMODE_ADD:this._engine.setAlphaMode(g.a.ALPHA_ADD);break;case Oa.BLENDMODE_ONEONE:this._engine.setAlphaMode(g.a.ALPHA_ONEONE);break;case Oa.BLENDMODE_STANDARD:this._engine.setAlphaMode(g.a.ALPHA_COMBINE);break;case Oa.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(g.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(Pr.a.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(g.a.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var c=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);for(this._updateVAO=[],e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO=[]}},t.prototype.dispose=function(e){void 0===e&&(e=!0);var t=this._scene.particleSystems.indexOf(this);t>-1&&this._scene.particleSystems.splice(t,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,n){var i=new t(e,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return P.a.DeepCopy(this,i),void 0===n&&(n=this.emitter),i.emitter=n,this.particleTexture&&(i.particleTexture=new Ge.a(this.particleTexture.url,this._scene)),i},t.prototype.serialize=function(){var e={};return Oa._Serialize(e,this),e.activeParticleCount=this.activeParticleCount,e},t.Parse=function(e,n,i,r){void 0===r&&(r=!1);var o=new t(e.name,{capacity:e.capacity,randomTextureSize:e.randomTextureSize},n);return e.activeParticleCount&&(o.activeParticleCount=e.activeParticleCount),Oa._Parse(e,o,n,i),e.preventAutoStart&&(o.preventAutoStart=e.preventAutoStart),r||o.preventAutoStart||o.start(),o},t}(Pa),Ia=function(){function e(){this.systems=new Array}return Object.defineProperty(e.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),e.prototype.setEmitterAsSphere=function(e,t,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:e,renderingGroupId:t};var i=Ai.a.CreateSphere("emitterSphere",{diameter:e.diameter,segments:e.segments},n);i.renderingGroupId=t;var r=new bn.a("emitterSphereMaterial",n);r.emissiveColor=e.color,i.material=r;for(var o=0,a=this.systems;o<a.length;o++)a[o].emitter=i;this._emitterNode=i},e.prototype.start=function(e){for(var t=0,n=this.systems;t<n.length;t++){var i=n[t];e&&(i.emitter=e),i.start()}},e.prototype.dispose=function(){for(var e=0,t=this.systems;e<t.length;e++)t[e].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},e.prototype.serialize=function(){for(var e={systems:[]},t=0,n=this.systems;t<n.length;t++)e.systems.push(n[t].serialize());return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},e.Parse=function(t,n,i){void 0===i&&(i=!1);var r=new e,a=g.a.PARTICLES_BaseAssetsUrl+"/textures/";n=n||A.a.LastCreatedScene;for(var s=0,l=t.systems;s<l.length;s++){var c=l[s];r.systems.push(i?wa.Parse(c,n,a,!0):Oa.Parse(c,n,a,!0))}if(t.emitter){var u=t.emitter.options;switch(t.emitter.kind){case"Sphere":r.setEmitterAsSphere({diameter:u.diameter,segments:u.segments,color:o.e.FromArray(u.color)},t.emitter.renderingGroupId,n)}}return r},e}(),Da=function(){function e(){}return e.CreateDefault=function(e,t,n,i){var r;return void 0===t&&(t=500),void 0===i&&(i=!1),(r=i?new wa("default system",{capacity:t},n):new Oa("default system",t,n)).emitter=e,r.particleTexture=new Ge.a("https://www.babylonjs.com/assets/Flare.png",r.getScene()),r.createConeEmitter(.1,Math.PI/4),r.color1=new o.f(1,1,1,1),r.color2=new o.f(1,1,1,1),r.colorDead=new o.f(1,1,1,0),r.minSize=.1,r.maxSize=.1,r.minEmitPower=2,r.maxEmitPower=2,r.updateSpeed=1/60,r.emitRate=30,r},e.CreateAsync=function(t,n,i){void 0===i&&(i=!1),n||(n=A.a.LastCreatedScene);var r={};return n._addPendingData(r),new Promise(function(o,a){if(i&&!wa.IsSupported)return n._removePendingData(r),a("Particle system with GPU is not supported.");be.h.LoadFile(e.BaseAssetsUrl+"/systems/"+t+".json",function(e){n._removePendingData(r);var t=JSON.parse(e.toString());return o(Ia.Parse(t,n,i))},void 0,void 0,void 0,function(){return n._removePendingData(r),a("An error occured while the creation of your particle system. Check if your type '"+t+"' exists.")})})},e.ExportSet=function(e){for(var t=new Ia,n=0,i=e;n<i.length;n++)t.systems.push(i[n]);return t},e.BaseAssetsUrl=g.a.PARTICLES_BaseAssetsUrl,e}();i.a.AddParser(xe.a.NAME_PARTICLESYSTEM,function(e,t,n,r){var o=i.a.GetIndividualParser(xe.a.NAME_PARTICLESYSTEM);if(o&&null!=e.particleSystems)for(var a=0,s=e.particleSystems.length;a<s;a++)n.particleSystems.push(o(e.particleSystems[a],t,r))}),i.a.AddIndividualParser(xe.a.NAME_PARTICLESYSTEM,function(e,t,n){return e.activeParticleCount?wa.Parse(e,t,n):Oa.Parse(e,t,n)}),me.b.prototype.createEffectForParticles=function(e,t,n,i,r,o,a){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");var s=Oa._GetAttributeNamesOrOptions(),l=Oa._GetEffectCreationOptions();return-1===i.indexOf(" BILLBOARD")&&(i+="\n#define BILLBOARD\n"),-1===n.indexOf("diffuseSampler")&&n.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:e},s,l.concat(t),n,i,r,o,a)},fe.a.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var n=this.getScene().particleSystems[t];n.emitter===this&&e.push(n)}return e},fe.a.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var n=0;n<this.getScene().particleSystems.length;n++){var i=this.getScene().particleSystems[n],r=i.emitter;r.position&&-1!==t.indexOf(r)&&e.push(i)}return e};var La=function(){function e(e,t,n,i,r,a,s,l){void 0===l&&(l=null),this.idx=0,this.color=new o.f(1,1,1,1),this.position=o.x.Zero(),this.rotation=o.x.Zero(),this.scaling=o.x.One(),this.uvs=new o.y(0,0,1,1),this.velocity=o.x.Zero(),this.pivot=o.x.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.cullingStrategy=ke.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=o.x.Zero(),this.idx=e,this._pos=t,this._ind=n,this._model=i,this.shapeId=r,this.idxInShape=a,this._sps=s,l&&(this._modelBoundingInfo=l,this._boundingInfo=new Jn.a(l.minimum,l.maximum))}return Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(e){return!(!this._boundingInfo||!e._boundingInfo)&&(this._sps._bSphereOnly?$n.a.Intersects(this._boundingInfo.boundingSphere,e._boundingInfo.boundingSphere):this._boundingInfo.intersects(e._boundingInfo,!1))},e.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},e.prototype.getRotationMatrix=function(e){var t;if(this.rotationQuaternion)t=this.rotationQuaternion;else{var n=this.rotation;o.q.RotationYawPitchRollToRef(n.y,n.x,n.z,t=o.t.Quaternion[0])}t.toRotationMatrix(e)},e}(),ka=function(e,t,n,i,r,o){this._indicesLength=0,this.shapeID=e,this._shape=t,this._indicesLength=n,this._shapeUV=i,this._positionFunction=r,this._vertexFunction=o},Na=function(){this.ind=0,this.indicesLength=0,this.sqDistance=0},Fa=function(e,t){return t.sqDistance-e.sqDistance},Ba=function(){function e(e,t,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new La(0,0,0,null,0,0,this),this._color=new o.f(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this.name=e,this._scene=t||A.a.LastCreatedScene,this._camera=t.activeCamera,this._pickable=!!n&&n.isPickable,this._depthSort=!!n&&n.enableDepthSort,this._particlesIntersect=!!n&&n.particleIntersection,this._bSphereOnly=!!n&&n.boundingSphereOnly,this._bSphereRadiusFactor=n&&n.bSphereRadiusFactor?n.bSphereRadiusFactor:1,this._updatable=!n||void 0===n.updatable||n.updatable,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return e.prototype.buildMesh=function(){if(0===this.nbParticles){var e=Yo.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,1),e.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&xn.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var t=new xn.a;t.indices=this._depthSort?this._indices:this._indices32,t.set(this._positions32,Cn.b.PositionKind),t.set(this._normals32,Cn.b.NormalKind),this._uvs32.length>0&&t.set(this._uvs32,Cn.b.UVKind),this._colors32.length>0&&t.set(this._colors32,Cn.b.ColorKind);var n=new fe.a(this.name,this._scene);return t.applyToMesh(n,this._updatable),this.mesh=n,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),n},e.prototype.digest=function(e,t){var n=t&&t.facetNb||1,i=t&&t.number||0,r=t&&t.delta||0,a=e.getVerticesData(Cn.b.PositionKind),s=e.getIndices(),l=e.getVerticesData(Cn.b.UVKind),c=e.getVerticesData(Cn.b.ColorKind),u=e.getVerticesData(Cn.b.NormalKind),h=0,d=s.length/3;i?(i=i>d?d:i,n=Math.round(d/i),r=0):n=n>d?d:n;for(var f=[],p=[],g=[],m=[],_=o.x.Zero(),v=n;h<d;){h>d-(n=v+Math.floor((1+r)*Math.random()))&&(n=d-h),f.length=0,p.length=0,g.length=0,m.length=0;for(var b=0,y=3*h;y<3*(h+n);y++){p.push(b);var T=s[y];f.push(a[3*T],a[3*T+1],a[3*T+2]),l&&g.push(l[2*T],l[2*T+1]),c&&m.push(c[4*T],c[4*T+1],c[4*T+2],c[4*T+3]),b++}var E,x,C=this.nbParticles,S=this._posToShape(f),A=this._uvsToShapeUV(g);for(E=0;E<S.length;E++)_.addInPlace(S[E]);for(_.scaleInPlace(1/S.length),E=0;E<S.length;E++)S[E].subtractInPlace(_);this._particlesIntersect&&(x=new Jn.a(_,_));var P=new ka(this._shapeCounter,S,3*n,A,null,null),R=this._positions.length,M=this._indices.length;this._meshBuilder(this._index,S,this._positions,p,this._indices,g,this._uvs,m,this._colors,u,this._normals,C,0,null),this._addParticle(C,R,M,P,this._shapeCounter,0,x),this.particles[this.nbParticles].position.addInPlace(_),this._index+=S.length,C++,this.nbParticles++,this._shapeCounter++,h+=n}return this},e.prototype._unrotateFixedNormals=function(){for(var e=0,t=0,n=o.t.Vector3[0],i=o.t.Quaternion[0],r=o.t.Matrix[0],a=0;a<this.particles.length;a++){var s=this.particles[a],l=s._model._shape;if(s.rotationQuaternion)s.rotationQuaternion.conjugateToRef(i);else{var c=s.rotation;o.q.RotationYawPitchRollToRef(c.y,c.x,c.z,i),i.conjugateInPlace()}i.toRotationMatrix(r);for(var u=0;u<l.length;u++)o.x.TransformNormalFromFloatsToRef(this._normals32[t=e+3*u],this._normals32[t+1],this._normals32[t+2],r,n),n.toArray(this._fixedNormal32,t);e=t+3}},e.prototype._resetCopy=function(){var e=this._copy;e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.copyFromFloats(0,0,1,1),e.color=null,e.translateFromPivot=!1},e.prototype._meshBuilder=function(e,t,n,i,r,a,s,l,c,u,h,d,f,p){var g,m=0,_=0,v=0;this._resetCopy();var b=this._copy;p&&p.positionFunction&&(p.positionFunction(b,d,f),this._mustUnrotateFixedNormals=!0);var y=o.t.Matrix[0],T=o.t.Vector3[0],E=o.t.Vector3[1],x=o.t.Vector3[2],C=o.t.Vector3[3];for(b.getRotationMatrix(y),b.pivot.multiplyToRef(b.scaling,C),b.translateFromPivot?x.setAll(0):x.copyFrom(C),g=0;g<t.length;g++){if(T.copyFrom(t[g]),p&&p.vertexFunction&&p.vertexFunction(b,T,g),T.multiplyInPlace(b.scaling).subtractInPlace(C),o.x.TransformCoordinatesToRef(T,y,E),E.addInPlace(x).addInPlace(b.position),n.push(E.x,E.y,E.z),a){var S=b.uvs;s.push((S.z-S.x)*a[m]+S.x,(S.w-S.y)*a[m+1]+S.y),m+=2}if(b.color)this._color=b.color;else{var A=this._color;l&&void 0!==l[_]?(A.r=l[_],A.g=l[_+1],A.b=l[_+2],A.a=l[_+3]):(A.r=1,A.g=1,A.b=1,A.a=1)}c.push(this._color.r,this._color.g,this._color.b,this._color.a),_+=4,!this.recomputeNormals&&u&&(T.x=u[v],T.y=u[v+1],T.z=u[v+2],o.x.TransformNormalToRef(T,y,T),h.push(T.x,T.y,T.z),v+=3)}for(g=0;g<i.length;g++){var P=e+i[g];r.push(P),P>65535&&(this._needs32Bits=!0)}if(this._pickable){var R=i.length/3;for(g=0;g<R;g++)this.pickedParticles.push({idx:d,faceId:g})}return this._depthSort&&this.depthSortedParticles.push(new Na),b},e.prototype._posToShape=function(e){for(var t=[],n=0;n<e.length;n+=3)t.push(o.x.FromArray(e,n));return t},e.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var n=0;n<e.length;n++)t.push(e[n]);return t},e.prototype._addParticle=function(e,t,n,i,r,o,a){void 0===a&&(a=null);var s=new La(e,t,n,i,r,o,this,a);return this.particles.push(s),s},e.prototype.addShape=function(e,t,n){var i,r=e.getVerticesData(Cn.b.PositionKind),o=e.getIndices(),a=e.getVerticesData(Cn.b.UVKind),s=e.getVerticesData(Cn.b.ColorKind),l=e.getVerticesData(Cn.b.NormalKind);this._particlesIntersect&&(i=e.getBoundingInfo());for(var c,u,h=this._posToShape(r),d=this._uvsToShapeUV(a),f=new ka(this._shapeCounter,h,o.length,d,n?n.positionFunction:null,n?n.vertexFunction:null),p=this.nbParticles,g=0;g<t;g++){var m=this._positions.length,_=this._indices.length;u=this._meshBuilder(this._index,h,this._positions,o,this._indices,a,this._uvs,s,this._colors,l,this._normals,p,g,n),this._updatable&&((c=this._addParticle(p,m,_,f,this._shapeCounter,g,i)).position.copyFrom(u.position),c.rotation.copyFrom(u.rotation),u.rotationQuaternion&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(u.rotationQuaternion),u.color&&c.color&&c.color.copyFrom(u.color),c.scaling.copyFrom(u.scaling),c.uvs.copyFrom(u.uvs)),this._index+=h.length,p++}return this.nbParticles+=t,this._shapeCounter++,this._shapeCounter-1},e.prototype._rebuildParticle=function(e){this._resetCopy();var t=this._copy;e._model._positionFunction&&e._model._positionFunction(t,e.idx,e.idxInShape);var n=o.t.Matrix[0],i=o.t.Vector3[0],r=o.t.Vector3[1],a=o.t.Vector3[2],s=o.t.Vector3[3];t.getRotationMatrix(n),e.pivot.multiplyToRef(e.scaling,s),t.translateFromPivot?a.copyFromFloats(0,0,0):a.copyFrom(s);for(var l=e._model._shape,c=0;c<l.length;c++)i.copyFrom(l[c]),e._model._vertexFunction&&e._model._vertexFunction(t,i,c),i.multiplyInPlace(t.scaling).subtractInPlace(s),o.x.TransformCoordinatesToRef(i,n,r),r.addInPlace(a).addInPlace(t.position).toArray(this._positions32,e._pos+3*c);e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.setAll(0),e.pivot.setAll(0),e.translateFromPivot=!1,e.parentId=null},e.prototype.rebuildMesh=function(){for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e]);return this.mesh.updateVerticesData(Cn.b.PositionKind,this._positions32,!1,!1),this},e.prototype.setParticles=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=this.nbParticles-1),void 0===n&&(n=!0),!this._updatable)return this;this.beforeUpdateParticles(e,t,n);var i=o.t.Matrix[0],r=o.t.Matrix[1],a=this.mesh,s=this._colors32,l=this._positions32,c=this._normals32,u=this._uvs32,h=this._indices32,d=this._indices,f=this._fixedNormal32,p=o.t.Vector3,g=p[5].copyFromFloats(1,0,0),m=p[6].copyFromFloats(0,1,0),_=p[7].copyFromFloats(0,0,1),v=p[8].setAll(Number.MAX_VALUE),b=p[9].setAll(-Number.MAX_VALUE),y=p[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(r)),this.billboard){var T=p[0];this._camera.getDirectionToRef(o.c.Z,T),o.x.TransformNormalToRef(T,r,_),_.normalize();var E=this._camera.getViewMatrix(!0);o.x.TransformNormalFromFloatsToRef(E.m[1],E.m[5],E.m[9],r,m),o.x.CrossToRef(m,_,g),m.normalize(),g.normalize()}this._depthSort&&o.x.TransformCoordinatesToRef(this._camera.globalPosition,r,y),o.j.IdentityToRef(i);var x=0,C=0,S=0,A=0,P=0,R=0,M=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),t=t>=this.nbParticles?this.nbParticles-1:t,this._computeBoundingBox&&(0!=e||t!=this.nbParticles-1)){var O=this.mesh._boundingInfo;O&&(v.copyFrom(O.minimum),b.copyFrom(O.maximum))}var w=(C=this.particles[e]._pos)/3|0;A=4*w,R=2*w;for(var I=e;I<=t;I++){var D=this.particles[I];this.updateParticle(D);var L=D._model._shape,k=D._model._shapeUV,N=D._rotationMatrix,F=D.position,B=D.rotation,U=D.scaling,V=D._globalPosition;if(this._depthSort&&this._depthSortParticles){var G=this.depthSortedParticles[I];G.ind=D._ind,G.indicesLength=D._model._indicesLength,G.sqDistance=o.x.DistanceSquared(D.position,y)}if(!D.alive||D._stillInvisible&&!D.isVisible)C+=3*(M=L.length),A+=4*M,R+=2*M;else{if(D.isVisible){D._stillInvisible=!1;var z=p[12];if(D.pivot.multiplyToRef(U,z),this.billboard&&(B.x=0,B.y=0),(this._computeParticleRotation||this.billboard)&&D.getRotationMatrix(i),null!==D.parentId){var j=this.particles[D.parentId],H=j._rotationMatrix,W=j._globalPosition,X=F.x*H[1]+F.y*H[4]+F.z*H[7],Y=F.x*H[0]+F.y*H[3]+F.z*H[6],K=F.x*H[2]+F.y*H[5]+F.z*H[8];if(V.x=W.x+Y,V.y=W.y+X,V.z=W.z+K,this._computeParticleRotation||this.billboard){var Q=i.m;N[0]=Q[0]*H[0]+Q[1]*H[3]+Q[2]*H[6],N[1]=Q[0]*H[1]+Q[1]*H[4]+Q[2]*H[7],N[2]=Q[0]*H[2]+Q[1]*H[5]+Q[2]*H[8],N[3]=Q[4]*H[0]+Q[5]*H[3]+Q[6]*H[6],N[4]=Q[4]*H[1]+Q[5]*H[4]+Q[6]*H[7],N[5]=Q[4]*H[2]+Q[5]*H[5]+Q[6]*H[8],N[6]=Q[8]*H[0]+Q[9]*H[3]+Q[10]*H[6],N[7]=Q[8]*H[1]+Q[9]*H[4]+Q[10]*H[7],N[8]=Q[8]*H[2]+Q[9]*H[5]+Q[10]*H[8]}}else V.x=F.x,V.y=F.y,V.z=F.z,(this._computeParticleRotation||this.billboard)&&(N[0]=(Q=i.m)[0],N[1]=Q[1],N[2]=Q[2],N[3]=Q[4],N[4]=Q[5],N[5]=Q[6],N[6]=Q[8],N[7]=Q[9],N[8]=Q[10]);var q=p[11];for(D.translateFromPivot?q.setAll(0):q.copyFrom(z),M=0;M<L.length;M++){x=C+3*M,S=A+4*M,P=R+2*M,(T=p[0]).copyFrom(L[M]),this._computeParticleVertex&&this.updateParticleVertex(D,T,M);var Z=T.x*U.x-z.x,J=T.y*U.y-z.y,$=T.z*U.z-z.z;Y=Z*N[0]+J*N[3]+$*N[6],X=Z*N[1]+J*N[4]+$*N[7],K=Z*N[2]+J*N[5]+$*N[8];var ee=l[x]=V.x+g.x*(Y+=q.x)+m.x*(X+=q.y)+_.x*(K+=q.z),te=l[x+1]=V.y+g.y*Y+m.y*X+_.y*K,ne=l[x+2]=V.z+g.z*Y+m.z*X+_.z*K;if(this._computeBoundingBox&&(v.minimizeInPlaceFromFloats(ee,te,ne),b.maximizeInPlaceFromFloats(ee,te,ne)),!this._computeParticleVertex){var ie=f[x],re=f[x+1],oe=f[x+2],ae=ie*N[0]+re*N[3]+oe*N[6],se=ie*N[1]+re*N[4]+oe*N[7],le=ie*N[2]+re*N[5]+oe*N[8];c[x]=g.x*ae+m.x*se+_.x*le,c[x+1]=g.y*ae+m.y*se+_.y*le,c[x+2]=g.z*ae+m.z*se+_.z*le}if(this._computeParticleColor&&D.color){var ce=D.color,ue=this._colors32;ue[S]=ce.r,ue[S+1]=ce.g,ue[S+2]=ce.b,ue[S+3]=ce.a}if(this._computeParticleTexture){var he=D.uvs;u[P]=k[2*M]*(he.z-he.x)+he.x,u[P+1]=k[2*M+1]*(he.w-he.y)+he.y}}}else for(D._stillInvisible=!0,M=0;M<L.length;M++)S=A+4*M,P=R+2*M,l[x=C+3*M]=l[x+1]=l[x+2]=0,c[x]=c[x+1]=c[x+2]=0,this._computeParticleColor&&D.color&&(s[S]=(ce=D.color).r,s[S+1]=ce.g,s[S+2]=ce.b,s[S+3]=ce.a),this._computeParticleTexture&&(u[P]=k[2*M]*((he=D.uvs).z-he.x)+he.x,u[P+1]=k[2*M+1]*(he.w-he.y)+he.y);if(this._particlesIntersect){var de=D._boundingInfo,fe=de.boundingBox,pe=de.boundingSphere,ge=D._modelBoundingInfo;if(!this._bSphereOnly){var me=ge.boundingBox.vectors,_e=p[1],ve=p[2];_e.setAll(Number.MAX_VALUE),ve.setAll(-Number.MAX_VALUE);for(var be=0;be<8;be++){var ye=me[be].x*U.x,Te=me[be].y*U.y,Ee=me[be].z*U.z,xe=F.x+g.x*(Y=ye*N[0]+Te*N[3]+Ee*N[6])+m.x*(X=ye*N[1]+Te*N[4]+Ee*N[7])+_.x*(K=ye*N[2]+Te*N[5]+Ee*N[8]),Ce=F.y+g.y*Y+m.y*X+_.y*K,Se=F.z+g.z*Y+m.z*X+_.z*K;_e.minimizeInPlaceFromFloats(xe,Ce,Se),ve.maximizeInPlaceFromFloats(xe,Ce,Se)}fe.reConstruct(_e,ve,a._worldMatrix)}var Ae=ge.minimum.multiplyToRef(U,p[1]),Pe=ge.maximum.multiplyToRef(U,p[2]),Re=Pe.addToRef(Ae,p[3]).scaleInPlace(.5).addInPlace(V),Me=Pe.subtractToRef(Ae,p[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Oe=Re.subtractToRef(Me,p[1]),we=Re.addToRef(Me,p[2]);pe.reConstruct(Oe,we,a._worldMatrix)}C=x+3,A=S+4,R=P+2}}if(n){if(this._computeParticleColor&&a.updateVerticesData(Cn.b.ColorKind,s,!1,!1),this._computeParticleTexture&&a.updateVerticesData(Cn.b.UVKind,u,!1,!1),a.updateVerticesData(Cn.b.PositionKind,l,!1,!1),!a.areNormalsFrozen||a.isFacetDataEnabled){if(this._computeParticleVertex||a.isFacetDataEnabled){var Ie=a.isFacetDataEnabled?a.getFacetDataParameters():null;xn.a.ComputeNormals(l,h,c,Ie);for(var De=0;De<c.length;De++)f[De]=c[De]}a.areNormalsFrozen||a.updateVerticesData(Cn.b.NormalKind,c,!1,!1)}if(this._depthSort&&this._depthSortParticles){var Le=this.depthSortedParticles;Le.sort(Fa);for(var ke=Le.length,Ne=0,Fe=0;Fe<ke;Fe++){var Be=Le[Fe].indicesLength,Ue=Le[Fe].ind;for(De=0;De<Be;De++)h[Ne]=d[Ue+De],Ne++}a.updateIndices(h)}}return this._computeBoundingBox&&(a._boundingInfo?a._boundingInfo.reConstruct(v,b,a._worldMatrix):a._boundingInfo=new Jn.a(v,b,a._worldMatrix)),this.afterUpdateParticles(e,t,n),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(e){var t=e/2;this.mesh._boundingInfo=new Jn.a(new o.x(-t,-t,-t),new o.x(t,t,t))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(e){this._depthSortParticles=e},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(e){return e},e.prototype.updateParticle=function(e){return e},e.prototype.updateParticleVertex=function(e,t,n){return t},e.prototype.beforeUpdateParticles=function(e,t,n){},e.prototype.afterUpdateParticles=function(e,t,n){},e}();W.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},W.a.prototype.enablePhysics=function(e,t){if(void 0===e&&(e=null),this._physicsEngine)return!0;var n=this._getComponent(xe.a.NAME_PHYSICSENGINE);n||(n=new Ga(this),this._addComponent(n));try{return this._physicsEngine=new Zr(e,t),!0}catch(e){return p.a.Error(e.message),!1}},W.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},W.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},W.a.prototype.deleteCompoundImpostor=function(e){var t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},W.a.prototype._advancePhysicsEngineStep=function(e){this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this))},Object.defineProperty(ke.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var t=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),ke.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},ke.a.prototype.applyImpulse=function(e,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,t),this):this},ke.a.prototype.setPhysicsLinkWith=function(e,t,n,i){return this.physicsImpostor&&e.physicsImpostor?(this.physicsImpostor.createJoint(e.physicsImpostor,qr.e.HingeJoint,{mainPivot:t,connectedPivot:n,nativeParams:i}),this):this};var Ua,Va,Ga=function(){function e(e){var t=this;this.name=xe.a.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new r.c,this.scene.onAfterPhysicsObservable=new r.c,this.scene.getDeterministicFrameTime=function(){return t.scene._physicsEngine?1e3*t.scene._physicsEngine.getTimeStep():1e3/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),za=function(){function e(e){this._scene=e,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||p.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(e,t,n,i){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var r=this._physicsEngine.getImpostors();if(0===r.length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=i||t.falloff);var o=new ja(this._scene,t),a=Array();return r.forEach(function(t){var n=o.getImpostorHitData(t,e);n&&(t.applyImpulse(n.force,n.contactPoint),a.push({impostor:t,hitData:n}))}),o.triggerAffectedImpostorsCallback(a),o.dispose(!1),o},e.prototype.applyRadialExplosionForce=function(e,t,n,i){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var r=this._physicsEngine.getImpostors();if(0===r.length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=i||t.falloff);var o=new ja(this._scene,t),a=Array();return r.forEach(function(t){var n=o.getImpostorHitData(t,e);n&&(t.applyForce(n.force,n.contactPoint),a.push({impostor:t,hitData:n}))}),o.triggerAffectedImpostorsCallback(a),o.dispose(!1),o},e.prototype.gravitationalField=function(e,t,n,i){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=i||t.falloff);var r=new Ha(this,this._scene,e,t);return r.dispose(!1),r},e.prototype.updraft=function(e,t,n,i,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new Ka).radius=t,t.strength=n||t.strength,t.height=i||t.height,t.updraftMode=r||t.updraftMode);var o=new Wa(this._scene,e,t);return o.dispose(!1),o},e.prototype.vortex=function(e,t,n,i){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new Qa).radius=t,t.strength=n||t.strength,t.height=i||t.height);var r=new Xa(this._scene,e,t);return r.dispose(!1),r},e}(),ja=function(){function e(e,t){this._scene=e,this._options=t,this._dataFetched=!1,this._options=c.a({},new Ya,this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(e,t){if(0===e.mass)return null;if(!this._intersectsWithSphere(e,t,this._options.radius))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var n=e.getObjectCenter().subtract(t),i=new wt.a(t,n,this._options.radius).intersectsMesh(e.object).pickedPoint;if(!i)return null;var r=o.x.Distance(t,i);if(r>this._options.radius)return null;var a=this._options.falloff===Ua.Constant?this._options.strength:this._options.strength*(1-r/this._options.radius);return{force:n.multiplyByFloats(a,a,a),contactPoint:i,distanceFromOrigin:r}},e.prototype.triggerAffectedImpostorsCallback=function(e){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(e)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=Ai.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(e,t,n){var i=e.object;return this._prepareSphere(),this._sphere.position=t,this._sphere.scaling=new o.x(2*n,2*n,2*n),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(i,!0)},e}(),Ha=function(){function e(e,t,n,i){this._physicsHelper=e,this._scene=t,this._origin=n,this._options=i,this._dataFetched=!1,this._options=c.a({},new Ya,this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var e=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);e&&(this._sphere=e.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),Wa=function(){function e(e,t,n){this._scene=e,this._origin=t,this._options=n,this._originTop=o.x.Zero(),this._originDirection=o.x.Zero(),this._cylinderPosition=o.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=c.a({},new Ka,this._options),this._origin.addToRef(new o.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new o.x(0,this._options.height,0),this._originTop),this._options.updraftMode===Va.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),this._cylinder&&(e?this._cylinder.dispose():setTimeout(function(){t._dataFetched||t._cylinder.dispose()},0))},e.prototype.getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;var t=e.getObjectCenter();if(this._options.updraftMode===Va.Perpendicular)var n=this._originDirection;else n=t.subtract(this._originTop);var i=o.x.Distance(this._origin,t),r=-1*this._options.strength;return{force:n.multiplyByFloats(r,r,r),contactPoint:t,distanceFromOrigin:i}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach(function(t){var n=e.getImpostorHitData(t);n&&t.applyForce(n.force,n.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Mn.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),Xa=function(){function e(e,t,n){this._scene=e,this._origin=t,this._options=n,this._originTop=o.x.Zero(),this._cylinderPosition=o.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=c.a({},new Qa,this._options),this._origin.addToRef(new o.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new o.x(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout(function(){t._dataFetched||t._cylinder.dispose()},0)},e.prototype.getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var t=e.getObjectCenter(),n=new o.x(this._origin.x,t.y,this._origin.z),i=t.subtract(n),r=new wt.a(n,i,this._options.radius).intersectsMesh(e.object),a=r.pickedPoint;if(!a)return null;var s=r.distance/this._options.radius,l=a.normalize();if(s>this._options.centripetalForceThreshold&&(l=l.negate()),s>this._options.centripetalForceThreshold)var c=l.x*this._options.centripetalForceMultiplier,u=l.y*this._options.updraftForceMultiplier,h=l.z*this._options.centripetalForceMultiplier;else{var d=o.x.Cross(n,t).normalize();c=(d.x+l.x)*this._options.centrifugalForceMultiplier,u=this._originTop.y*this._options.updraftForceMultiplier,h=(d.z+l.z)*this._options.centrifugalForceMultiplier}var f=new o.x(c,u,h);return{force:f=f.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:t,distanceFromOrigin:s}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach(function(t){var n=e.getImpostorHitData(t);n&&t.applyForce(n.force,n.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Mn.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),Ya=function(){this.radius=5,this.strength=10,this.falloff=Ua.Constant,this.sphere={segments:32,diameter:1}},Ka=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Va.Center},Qa=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(Ua||(Ua={})),function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(Va||(Va={})),zt.a.ShadersStore.blackAndWhitePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void)\n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11));\nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}";var qa=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t,"blackAndWhite",["degree"],null,n,i,r,o,a)||this;return s.degree=1,s.onApplyObservable.add(function(e){e.setFloat("degree",s.degree)}),s}return c.d(t,e),t}(jt),Za=function(){function e(e,t,n,i){this._name=t,this._singleInstance=i||!0,this._getPostProcesses=n,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(this._postProcesses.hasOwnProperty(e))for(var t=this._postProcesses[e],n=0;n<t.length;n++)if(!t[n].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(e){var t,n=this,i=be.h.MakeArray(e||this._cameras);if(i)for(var r=0;r<i.length;r++){var o=i[r],a=o.name;if(!this._postProcesses[t=this._singleInstance?0:a]){var s=this._getPostProcesses();s&&(this._postProcesses[t]=Array.isArray(s)?s:[s])}this._indicesForCamera[a]||(this._indicesForCamera[a]=[]),this._postProcesses[t].forEach(function(e){var t=o.attachPostProcess(e);n._indicesForCamera[a].push(t)}),this._cameras[a]||(this._cameras[a]=o)}},e.prototype._detachCameras=function(e){var t=be.h.MakeArray(e||this._cameras);if(t)for(var n=0;n<t.length;n++){var i=t[n],r=i.name,o=this._postProcesses[this._singleInstance?0:r];o&&o.forEach(function(e){i.detachPostProcess(e)}),this._cameras[r]&&(this._cameras[r]=null)}},e.prototype._enable=function(e){var t=this,n=be.h.MakeArray(e||this._cameras);if(n)for(var i=0;i<n.length;i++)for(var r=n[i],o=r.name,a=0;a<this._indicesForCamera[o].length;a++)null!=r._postProcesses[this._indicesForCamera[o][a]]||this._postProcesses[this._singleInstance?0:o].forEach(function(e){n[i].attachPostProcess(e,t._indicesForCamera[o][a])})},e.prototype._disable=function(e){var t=be.h.MakeArray(e||this._cameras);if(t)for(var n=0;n<t.length;n++){var i=t[n];this._postProcesses[this._singleInstance?0:i.name].forEach(function(e){i.detachPostProcess(e)})}},e.prototype.getPostProcesses=function(e){return this._singleInstance?this._postProcesses[0]:e?this._postProcesses[e.name]:null},e}();zt.a.ShadersStore.extractHighlightsPixelShader="#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}";var Ja=function(e){function t(t,n,i,r,a,s,l,c){void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var u=e.call(this,t,"extractHighlights",["threshold","exposure"],null,n,i,r,a,s,null,l,void 0,null,c)||this;return u.threshold=.9,u._exposure=1,u._inputPostProcess=null,u.onApplyObservable.add(function(e){u._inputPostProcess&&e.setTextureFromPostProcess("textureSampler",u._inputPostProcess),e.setFloat("threshold",Math.pow(u.threshold,o.u)),e.setFloat("exposure",u._exposure)}),u}return c.d(t,e),t}(jt);zt.a.ShadersStore.bloomMergePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);\n}\n";var $a=function(e){function t(t,n,i,r,o,a,s,l,c,u,h){void 0===u&&(u=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],o,a,s,l,c,null,u,void 0,null,!0)||this;return d.weight=r,d.onApplyObservable.add(function(e){e.setTextureFromPostProcess("textureSampler",n),e.setTextureFromPostProcessOutput("bloomBlur",i),e.setFloat("bloomWeight",d.weight)}),h||d.updateEffect(),d}return c.d(t,e),t}(jt),es=function(e){function t(t,n,i,r,a,s){void 0===a&&(a=0),void 0===s&&(s=!1);var l=e.call(this,t.getEngine(),"bloom",function(){return l._effects},!0)||this;return l.bloomScale=n,l._effects=[],l._downscale=new Ja("highlights",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,s),l._blurX=new zi("horizontal blur",new o.w(1,0),10,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,void 0,s),l._blurX.alwaysForcePOT=!0,l._blurX.autoClear=!1,l._blurY=new zi("vertical blur",new o.w(0,1),10,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,void 0,s),l._blurY.alwaysForcePOT=!0,l._blurY.autoClear=!1,l.kernel=r,l._effects=[l._downscale,l._blurX,l._blurY],l._merge=new $a("bloomMerge",l._downscale,l._blurY,i,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,s),l._merge.autoClear=!1,l._effects.push(l._merge),l}return c.d(t,e),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Za);zt.a.ShadersStore.chromaticAberrationPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}";var ts=function(e){function t(t,n,i,r,a,s,l,c,u,h){void 0===u&&(u=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],r,a,s,l,c,null,u,void 0,null,h)||this;return d.aberrationAmount=30,d.radialIntensity=0,d.direction=new o.w(.707,.707),d.centerPosition=new o.w(.5,.5),d.onApplyObservable.add(function(e){e.setFloat("chromatic_aberration",d.aberrationAmount),e.setFloat("screen_width",n),e.setFloat("screen_height",i),e.setFloat("radialIntensity",d.radialIntensity),e.setFloat2("direction",d.direction.x,d.direction.y),e.setFloat2("centerPosition",d.centerPosition.x,d.centerPosition.y)}),d}return c.d(t,e),t}(jt);zt.a.ShadersStore.circleOfConfusionPixelShader="\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;\nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n";var ns=function(e){function t(t,n,i,r,o,a,s,l,c){void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var u=e.call(this,t,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],i,r,o,a,s,null,l,void 0,null,c)||this;return u.lensSize=50,u.fStop=1.4,u.focusDistance=2e3,u.focalLength=50,u._depthTexture=null,u._depthTexture=n,u.onApplyObservable.add(function(e){if(u._depthTexture){e.setTexture("depthSampler",u._depthTexture);var t=u.lensSize/u.fStop*u.focalLength/(u.focusDistance-u.focalLength);e.setFloat("focusDistance",u.focusDistance),e.setFloat("cocPrecalculation",t),e.setFloat2("cameraMinMaxZ",u._depthTexture.activeCamera.minZ,u._depthTexture.activeCamera.maxZ)}else p.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),u}return c.d(t,e),Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!0,configurable:!0}),t}(jt);zt.a.ShadersStore.colorCorrectionPixelShader="\nuniform sampler2D textureSampler;\nuniform sampler2D colorTable;\n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0;\n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width;\nfloat slicePixelSize=sliceSize/width;\nfloat sliceInnerSize=slicePixelSize*(width-1.0);\nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}";var is=function(e){function t(t,n,i,r,o,a,s){var l=e.call(this,t,"colorCorrection",null,["colorTable"],i,r,o,a,s)||this;return l._colorTableTexture=new Ge.a(n,r.getScene(),!0,!1,Ge.a.TRILINEAR_SAMPLINGMODE),l._colorTableTexture.anisotropicFilteringLevel=1,l._colorTableTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,l._colorTableTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,l.onApply=function(e){e.setTexture("colorTable",l._colorTableTexture)},l}return c.d(t,e),t}(jt);zt.a.ShadersStore.convolutionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}";var rs=function(e){function t(t,n,i,r,o,a,s,l){void 0===l&&(l=g.a.TEXTURETYPE_UNSIGNED_INT);var c=e.call(this,t,"convolution",["kernel","screenSize"],null,i,r,o,a,s,null,l)||this;return c.kernel=n,c.onApply=function(e){e.setFloat2("screenSize",c.width,c.height),e.setArray("kernel",c.kernel)},c}return c.d(t,e),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(jt),os=function(e){function t(t,n,i,r,o,a,s,l,c,u,h,d,f){void 0===l&&(l=null),void 0===c&&(c=Ge.a.BILINEAR_SAMPLINGMODE),void 0===d&&(d=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===f&&(f=!1);var p=e.call(this,t,i,r,o,a,c=g.a.TEXTURE_BILINEAR_SAMPLINGMODE,u,h,d=g.a.TEXTURETYPE_UNSIGNED_INT,"#define DOF 1\r\n",f)||this;return p.direction=i,p.onApplyObservable.add(function(e){null!=l&&e.setTextureFromPostProcess("textureSampler",l),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",s),n.activeCamera&&e.setFloat2("cameraMinMaxZ",n.activeCamera.minZ,n.activeCamera.maxZ)}),p}return c.d(t,e),t}(zi);zt.a.ShadersStore.depthOfFieldMergePixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n";var as,ss=function(){},ls=function(e){function t(t,n,i,r,o,a,s,l,c,u,h){void 0===u&&(u=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],o,a,s,l,c,null,u,void 0,null,!0)||this;return d.blurSteps=r,d.onApplyObservable.add(function(e){e.setTextureFromPostProcess("textureSampler",n),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",i),r.forEach(function(t,n){e.setTextureFromPostProcessOutput("blurStep"+(r.length-n-1),t)})}),h||d.updateEffect(),d}return c.d(t,e),t.prototype.updateEffect=function(t,n,i,r,o,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),t||(t="",t+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+"\n"),e.prototype.updateEffect.call(this,t,n,i,r,o,a)},t}(jt);!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(as||(as={}));var cs=function(e){function t(t,n,i,r,a){void 0===i&&(i=as.Low),void 0===r&&(r=0),void 0===a&&(a=!1);var s=e.call(this,t.getEngine(),"depth of field",function(){return s._effects},!0)||this;s._effects=[],s._circleOfConfusion=new ns("circleOfConfusion",n,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,a),s._depthOfFieldBlurY=[],s._depthOfFieldBlurX=[];var l=1,c=15;switch(i){case as.High:l=3,c=51;break;case as.Medium:l=2,c=31;break;default:c=15,l=1}for(var u=c/Math.pow(2,l-1),h=1,d=0;d<l;d++){var f=new os("verticle blur",t,new o.w(0,1),u,h,null,s._circleOfConfusion,0==d?s._circleOfConfusion:null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,a);f.autoClear=!1,h=.75/Math.pow(2,d);var p=new os("horizontal blur",t,new o.w(1,0),u,h,null,s._circleOfConfusion,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,a);p.autoClear=!1,s._depthOfFieldBlurY.push(f),s._depthOfFieldBlurX.push(p)}for(s._effects=[s._circleOfConfusion],d=0;d<s._depthOfFieldBlurX.length;d++)s._effects.push(s._depthOfFieldBlurY[d]),s._effects.push(s._depthOfFieldBlurX[d]);return s._dofMerge=new ls("dofMerge",s._circleOfConfusion,s._circleOfConfusion,s._depthOfFieldBlurX,h,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,a),s._dofMerge.autoClear=!1,s._effects.push(s._dofMerge),s}return c.d(t,e),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Za);zt.a.ShadersStore.displayPassPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}";var us=function(e){function t(t,n,i,r,o,a){return e.call(this,t,"displayPass",["passSampler"],["passSampler"],n,i,r,o,a)||this}return c.d(t,e),t}(jt);zt.a.ShadersStore.filterPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}";var hs=function(e){function t(t,n,i,r,o,a,s){var l=e.call(this,t,"filter",["kernelMatrix"],null,i,r,o,a,s)||this;return l.kernelMatrix=n,l.onApply=function(e){e.setMatrix("kernelMatrix",l.kernelMatrix)},l}return c.d(t,e),t}(jt);zt.a.ShadersStore.fxaaPixelShader="uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan)\n{\nlumaS=lumaE;\n}\nif (horzSpan)\n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan)\n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN)\n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN)\n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN)\n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP)\n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan)\n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}",zt.a.ShadersStore.fxaaVertexShader="\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}";var ds=function(e){function t(t,n,i,r,o,a,s){void 0===i&&(i=null),void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT);var l=e.call(this,t,"fxaa",["texelSize"],null,n,i,r||Ge.a.BILINEAR_SAMPLINGMODE,o,a,null,s,"fxaa",void 0,!0)||this,c=l._getDefines();return l.updateEffect(c),l.onApplyObservable.add(function(e){var t=l.texelSize;e.setFloat2("texelSize",t.x,t.y)}),l}return c.d(t,e),t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var t=e.getGlInfo();return t&&t.renderer&&t.renderer.toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null},t}(jt);zt.a.ShadersStore.grainPixelShader="#include<helperFunctions>\n\nuniform sampler2D textureSampler;\n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}";var fs=function(e){function t(t,n,i,r,o,a,s,l){void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var c=e.call(this,t,"grain",["intensity","animatedSeed"],[],n,i,r,o,a,null,s,void 0,null,l)||this;return c.intensity=30,c.animated=!1,c.onApplyObservable.add(function(e){e.setFloat("intensity",c.intensity),e.setFloat("animatedSeed",c.animated?Math.random()+1:1)}),c}return c.d(t,e),t}(jt);zt.a.ShadersStore.highlightsPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void)\n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);\n}";var ps=function(e){function t(t,n,i,r,o,a,s){return void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT),e.call(this,t,"highlights",null,null,n,i,r,o,a,null,s)||this}return c.d(t,e),t}(jt);zt.a.IncludesShadersStore.mrtFragmentDeclaration="#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",zt.a.ShadersStore.geometryPixelShader="#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef VELOCITY\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[POSITION_INDEX]=vec4(vPosition,1.0);\n#endif\n#ifdef VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);\n#endif\n}",zt.a.ShadersStore.geometryVertexShader="precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef VELOCITY\nuniform mat4 previousWorld;\nuniform mat4 previousViewProjection;\n#ifdef BONES_VELOCITY_ENABLED\n#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);\n#endif\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(position,1.0);\n#else\nvPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);\n#endif\n#endif\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";var gs=function(){function e(t,n){void 0===n&&(n=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this._enablePosition=!1,this._enableVelocity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._scene=t,this._ratio=n,e._SceneComponentInitialization(this._scene),this._createRenderTargets()}return Object.defineProperty(e.prototype,"renderList",{set:function(e){this._multiRenderTarget.renderList=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),e.prototype.getTextureIndex=function(t){switch(t){case e.POSITION_TEXTURE_TYPE:return this._positionIndex;case e.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;default:return-1}},Object.defineProperty(e.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(e){this._enablePosition=e,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(e){this._enableVelocity=e,e||(this._previousTransformationMatrices={}),this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),e.prototype.isReady=function(e,t){var n=e.getMaterial();if(n&&n.disableDepthWrite)return!1;var i=[],r=[Cn.b.PositionKind,Cn.b.NormalKind],o=e.getMesh();n&&n.needAlphaTesting()&&(i.push("#define ALPHATEST"),o.isVerticesDataPresent(Cn.b.UVKind)&&(r.push(Cn.b.UVKind),i.push("#define UV1")),o.isVerticesDataPresent(Cn.b.UV2Kind)&&(r.push(Cn.b.UV2Kind),i.push("#define UV2"))),this._enablePosition&&(i.push("#define POSITION"),i.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(i.push("#define VELOCITY"),i.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(o)&&i.push("#define BONES_VELOCITY_ENABLED")),o.useBones&&o.computeBonesUsingShaders?(r.push(Cn.b.MatricesIndicesKind),r.push(Cn.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(Cn.b.MatricesIndicesExtraKind),r.push(Cn.b.MatricesWeightsExtraKind)),i.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),i.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):i.push("#define NUM_BONE_INFLUENCERS 0"),t&&(i.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3")),i.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var a=i.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("geometry",r,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones"],["diffuseSampler"],a,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},e.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(e.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(e){this._multiRenderTarget.samples=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.getGBuffer().dispose()},e.prototype._createRenderTargets=function(){var e=this,t=this._scene.getEngine(),n=2;if(this._enablePosition&&(this._positionIndex=n,n++),this._enableVelocity&&(this._velocityIndex=n,n++),this._multiRenderTarget=new To("gBuffer",{width:t.getRenderWidth()*this._ratio,height:t.getRenderHeight()*this._ratio},n,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:g.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(e){e.clear(new o.f(0,0,0,1),!0,!0,!0)});var i=function(t){var n=t.getRenderingMesh(),i=e._scene,r=i.getEngine(),a=t.getMaterial();if(a){if(e._enableVelocity&&!e._previousTransformationMatrices[n.uniqueId]&&(e._previousTransformationMatrices[n.uniqueId]={world:o.j.Identity(),viewProjection:i.getTransformMatrix()},n.skeleton)){var s=n.skeleton.getTransformMatrices(n);e._previousBonesTransformationMatrices[n.uniqueId]=e._copyBonesTransformationMatrices(s,new Float32Array(s.length))}r.setState(a.backFaceCulling,0,!1,i.useRightHandedSystem);var l=n._getInstancesRenderList(t._id);if(!l.mustReturn){var c=r.getCaps().instancedArrays&&null!==l.visibleInstances[t._id];if(e.isReady(t,c)){if(r.enableEffect(e._effect),n._bind(t,e._effect,Pr.a.TriangleFillMode),e._effect.setMatrix("viewProjection",i.getTransformMatrix()),e._effect.setMatrix("view",i.getViewMatrix()),a&&a.needAlphaTesting()){var u=a.getAlphaTestTexture();u&&(e._effect.setTexture("diffuseSampler",u),e._effect.setMatrix("diffuseMatrix",u.getTextureMatrix()))}n.useBones&&n.computeBonesUsingShaders&&n.skeleton&&(e._effect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),e._enableVelocity&&e._effect.setMatrices("mPreviousBones",e._previousBonesTransformationMatrices[n.uniqueId])),e._enableVelocity&&(e._effect.setMatrix("previousWorld",e._previousTransformationMatrices[n.uniqueId].world),e._effect.setMatrix("previousViewProjection",e._previousTransformationMatrices[n.uniqueId].viewProjection)),n._processRendering(t,e._effect,Pr.a.TriangleFillMode,l,c,function(t,n){return e._effect.setMatrix("world",n)})}e._enableVelocity&&(e._previousTransformationMatrices[n.uniqueId].world=n.getWorldMatrix().clone(),e._previousTransformationMatrices[n.uniqueId].viewProjection=e._scene.getTransformMatrix().clone(),n.skeleton&&e._copyBonesTransformationMatrices(n.skeleton.getTransformMatrices(n),e._previousBonesTransformationMatrices[n.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(e,n,r,o){var a;if(o.length){for(t.setColorWrite(!1),a=0;a<o.length;a++)i(o.data[a]);t.setColorWrite(!0)}for(a=0;a<e.length;a++)i(e.data[a]);for(a=0;a<n.length;a++)i(n.data[a])}}},e.prototype._copyBonesTransformationMatrices=function(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t},e.POSITION_TEXTURE_TYPE=1,e.VELOCITY_TEXTURE_TYPE=2,e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("GeometryBufferRendererSceneComponent")},e}();Object.defineProperty(W.a.prototype,"geometryBufferRenderer",{get:function(){},set:function(e){e&&e.isSupported&&(this._geometryBufferRenderer=e)},enumerable:!0,configurable:!0}),W.a.prototype.enableGeometryBufferRenderer=function(e){return void 0===e&&(e=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new gs(this,e),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},W.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var ms=function(){function e(e){this.name=xe.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(xe.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){this.scene._geometryBufferRenderer&&e.push(this.scene._geometryBufferRenderer.getGBuffer())},e}();gs._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_GEOMETRYBUFFERRENDERER);t||(t=new ms(e),e._addComponent(t))},zt.a.ShadersStore.motionBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D velocitySampler;\nuniform float motionStrength;\nuniform float motionScale;\nuniform vec2 screenSize;\nvoid main(void)\n{\n#ifdef GEOMETRY_SUPPORTED\nvec2 texelSize=1.0/screenSize;\nvec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;\nvec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));\nvelocity*=motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint samplesCount=int(clamp(speed,1.0,SAMPLES));\nvelocity=normalize(velocity)*texelSize;\nfloat hlim=float(-samplesCount)*0.5+0.5;\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(SAMPLES); ++i)\n{\nif (i>=samplesCount)\nbreak;\nvec2 offset=vUV+velocity*(hlim+float(i));\nresult+=texture2D(textureSampler,offset);\n}\ngl_FragColor=result/float(samplesCount);\ngl_FragColor.a=1.0;\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";var _s=function(e){function t(t,n,i,r,a,s,l,c,u){void 0===c&&(c=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1);var h=e.call(this,t,"motionBlur",["motionStrength","motionScale","screenSize"],["velocitySampler"],i,r,a,s,l,"#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0",c,void 0,null,u)||this;return h.motionStrength=1,h._motionBlurSamples=32,h._geometryBufferRenderer=n.enableGeometryBufferRenderer(),h._geometryBufferRenderer?(h._geometryBufferRenderer.enableVelocity=!0,h.onApply=function(e){if(e.setVector2("screenSize",new o.w(h.width,h.height)),e.setFloat("motionScale",n.getAnimationRatio()),e.setFloat("motionStrength",h.motionStrength),h._geometryBufferRenderer){var t=h._geometryBufferRenderer.getTextureIndex(gs.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",h._geometryBufferRenderer.getGBuffer().textures[t])}}):(p.a.Warn("Multiple Render Target support needed to compute object based motion blur"),h.updateEffect()),h}return c.d(t,e),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._geometryBufferRenderer&&this.updateEffect("#define GEOMETRY_SUPPORTED\n#define SAMPLES "+e.toFixed(1))},enumerable:!0,configurable:!0}),t.prototype.excludeSkinnedMesh=function(e){this._geometryBufferRenderer&&e.skeleton&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.push(e)},t.prototype.removeExcludedSkinnedMesh=function(e){if(this._geometryBufferRenderer&&e.skeleton){var t=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.indexOf(e);-1!==t&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.splice(t,1)}},t.prototype.dispose=function(t){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),e.prototype.dispose.call(this,t)},t}(jt);zt.a.ShadersStore.refractionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}";var vs=function(e){function t(t,n,i,r,o,a,s,l,c,u){var h=e.call(this,t,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,s,l,c,u)||this;return h.color=i,h.depth=r,h.colorLevel=o,h._ownRefractionTexture=!0,h.onActivateObservable.add(function(e){h._refTexture=h._refTexture||new Ge.a(n,e.getScene())}),h.onApplyObservable.add(function(e){e.setColor3("baseColor",h.color),e.setFloat("depth",h.depth),e.setFloat("colorLevel",h.colorLevel),e.setTexture("refractionSampler",h._refTexture)}),h}return c.d(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),e.prototype.dispose.call(this,t)},t}(jt);zt.a.ShadersStore.sharpenPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}";var bs=function(e){function t(t,n,i,r,o,a,s,l){void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var c=e.call(this,t,"sharpen",["sharpnessAmounts","screenSize"],null,n,i,r,o,a,null,s,void 0,null,l)||this;return c.colorAmount=1,c.edgeAmount=.3,c.onApply=function(e){e.setFloat2("screenSize",c.width,c.height),e.setFloat2("sharpnessAmounts",c.edgeAmount,c.colorAmount)},c}return c.d(t,e),t}(jt),ys=function(){function e(e,t){this.engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(this._renderEffects.hasOwnProperty(e)&&!this._renderEffects[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(e){this._renderEffects[e._name]=e},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(e,t){var n=this._renderEffects[e];n&&n._enable(be.h.MakeArray(t||this._cameras))},e.prototype._disableEffect=function(e,t){var n=this._renderEffects[e];n&&n._disable(be.h.MakeArray(t||this._cameras))},e.prototype._attachCameras=function(e,t){var n=be.h.MakeArray(e||this._cameras);if(n){var i,r=[];for(i=0;i<n.length;i++){var o=n[i],a=o.name;-1===this._cameras.indexOf(o)?this._cameras[a]=o:t&&r.push(i)}for(i=0;i<r.length;i++)e.splice(r[i],1);for(var s in this._renderEffects)this._renderEffects.hasOwnProperty(s)&&this._renderEffects[s]._attachCameras(n)}},e.prototype._detachCameras=function(e){var t=be.h.MakeArray(e||this._cameras);if(t){for(var n in this._renderEffects)this._renderEffects.hasOwnProperty(n)&&this._renderEffects[n]._detachCameras(t);for(var i=0;i<t.length;i++)this._cameras.splice(this._cameras.indexOf(t[i]),1)}},e.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects.hasOwnProperty(e)&&this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t].name;this._renderEffectsForIsolatedPass[n]&&this._renderEffectsForIsolatedPass[n]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},e.prototype._enableMSAAOnFirstPostProcess=function(e){var t=Object.keys(this._renderEffects);if(1===this.engine.webGLVersion)return!1;if(t.length>0){var n=this._renderEffects[t[0]].getPostProcesses();n&&(n[0].samples=e)}return!0},e.prototype.dispose=function(){},c.c([Object(D.c)()],e.prototype,"_name",void 0),e}(),Ts=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var e=[];for(var t in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(t)){var n=this._renderPipelines[t];n.isSupported&&e.push(n)}return e},enumerable:!0,configurable:!0}),e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,n){void 0===n&&(n=!1);var i=this._renderPipelines[e];i&&i._attachCameras(t,n)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var n=this._renderPipelines[e];n&&n._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,n){var i=this._renderPipelines[e];i&&i._enableEffect(t,n)},e.prototype.disableEffectInPipeline=function(e,t,n){var i=this._renderPipelines[e];i&&i._disableEffect(t,n)},e.prototype.update=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[e];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[e])}},e.prototype._rebuild=function(){for(var e in this._renderPipelines)this._renderPipelines.hasOwnProperty(e)&&this._renderPipelines[e]._rebuild()},e.prototype.dispose=function(){for(var e in this._renderPipelines)this._renderPipelines.hasOwnProperty(e)&&this._renderPipelines[e].dispose()},e}();Object.defineProperty(W.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var e=this._getComponent(xe.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new Es(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new Ts}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var Es=function(){function e(e){this.name=xe.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(xe.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),xs=function(e){function t(t,n,i,r,o){void 0===t&&(t=""),void 0===n&&(n=!0),void 0===i&&(i=A.a.LastCreatedScene),void 0===o&&(o=!0);var a=e.call(this,i.getEngine(),t)||this;a._camerasToBeAttached=[],a.SharpenPostProcessId="SharpenPostProcessEffect",a.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",a.FxaaPostProcessId="FxaaPostProcessEffect",a.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",a.GrainPostProcessId="GrainPostProcessEffect",a._glowLayer=null,a.animations=[],a._imageProcessingConfigurationObserver=null,a._sharpenEnabled=!1,a._bloomEnabled=!1,a._depthOfFieldEnabled=!1,a._depthOfFieldBlurLevel=as.Low,a._fxaaEnabled=!1,a._imageProcessingEnabled=!0,a._bloomScale=.5,a._chromaticAberrationEnabled=!1,a._grainEnabled=!1,a._buildAllowed=!0,a._resizeObserver=null,a._hardwareScaleLevel=1,a._bloomKernel=64,a._bloomWeight=.15,a._bloomThreshold=.9,a._samples=1,a._hasCleared=!1,a._prevPostProcess=null,a._prevPrevPostProcess=null,a._depthOfFieldSceneObserver=null,a._cameras=r||i.cameras,a._cameras=a._cameras.slice(),a._camerasToBeAttached=a._cameras.slice(),a._buildAllowed=o,a._scene=i;var s=a._scene.getEngine().getCaps();a._hdr=n&&(s.textureHalfFloatRender||s.textureFloatRender),a._hdr?s.textureHalfFloatRender?a._defaultPipelineTextureType=g.a.TEXTURETYPE_HALF_FLOAT:s.textureFloatRender&&(a._defaultPipelineTextureType=g.a.TEXTURETYPE_FLOAT):a._defaultPipelineTextureType=g.a.TEXTURETYPE_UNSIGNED_INT,i.postProcessRenderPipelineManager.addPipeline(a);var l=a._scene.getEngine();return a.sharpen=new bs("sharpen",1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._sharpenEffect=new Za(l,a.SharpenPostProcessId,function(){return a.sharpen},!0),a.depthOfField=new cs(a._scene,null,a._depthOfFieldBlurLevel,a._defaultPipelineTextureType,!0),a.bloom=new es(a._scene,a._bloomScale,a._bloomWeight,a.bloomKernel,a._defaultPipelineTextureType,!0),a.chromaticAberration=new ts("ChromaticAberration",l.getRenderWidth(),l.getRenderHeight(),1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._chromaticAberrationEffect=new Za(l,a.ChromaticAberrationPostProcessId,function(){return a.chromaticAberration},!0),a.grain=new fs("Grain",1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._grainEffect=new Za(l,a.GrainPostProcessId,function(){return a.grain},!0),a._resizeObserver=l.onResizeObservable.add(function(){a._hardwareScaleLevel=l.getHardwareScalingLevel(),a.bloomKernel=a.bloomKernel}),a._imageProcessingConfigurationObserver=a._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){a.bloom._downscale._exposure=a._scene.imageProcessingConfiguration.exposure}),a._buildPipeline(),a}return c.d(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new es(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var t=0;t<this._cameras.length;t++)e.disposeEffects(this._cameras[t])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var t=this.depthOfField;this.depthOfField=new cs(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=t.focalLength,this.depthOfField.focusDistance=t.focusDistance,this.depthOfField.fStop=t.fStop,this.depthOfField.lensSize=t.lensSize;for(var n=0;n<this._cameras.length;n++)t.disposeEffects(this._cameras[n]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._imageProcessingEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(e){e&&!this._glowLayer?this._glowLayer=new Or("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,t){void 0===t&&(t=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),t||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var t=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var n=0,i=this._cameras;n<i.length;n++)(r=this._scene.enableDepthRenderer(i[n])).useOnlyInActiveCamera=!0;this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(t){e._cameras.indexOf(t.activeCamera)>-1&&(e.depthOfField.depthTexture=t.enableDepthRenderer(t.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var r=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=r.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new En("imageProcessing",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new Za(t,this.ImageProcessingPostProcessId,function(){return e.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new ds("fxaa",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType),this.addEffect(new Za(t,this.FxaaPostProcessId,function(){return e.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},t.prototype._disposePostProcesses=function(e){void 0===e&&(e=!1);for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t];this.imageProcessing&&this.imageProcessing.dispose(n),this.fxaa&&this.fxaa.dispose(n),e&&(this.sharpen&&this.sharpen.dispose(n),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(n)),this.bloom&&this.bloom.disposeEffects(n),this.chromaticAberration&&this.chromaticAberration.dispose(n),this.grain&&this.grain.dispose(n),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var t=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(t,1),this._buildPipeline()},t.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,n,i){return D.a.Parse(function(){return new t(e._name,e._name._hdr,n)},e,n,i)},c.c([Object(D.c)()],t.prototype,"sharpenEnabled",null),c.c([Object(D.c)()],t.prototype,"bloomKernel",null),c.c([Object(D.c)()],t.prototype,"_bloomWeight",void 0),c.c([Object(D.c)()],t.prototype,"_bloomThreshold",void 0),c.c([Object(D.c)()],t.prototype,"_hdr",void 0),c.c([Object(D.c)()],t.prototype,"bloomWeight",null),c.c([Object(D.c)()],t.prototype,"bloomThreshold",null),c.c([Object(D.c)()],t.prototype,"bloomScale",null),c.c([Object(D.c)()],t.prototype,"bloomEnabled",null),c.c([Object(D.c)()],t.prototype,"depthOfFieldEnabled",null),c.c([Object(D.c)()],t.prototype,"depthOfFieldBlurLevel",null),c.c([Object(D.c)()],t.prototype,"fxaaEnabled",null),c.c([Object(D.c)()],t.prototype,"samples",null),c.c([Object(D.c)()],t.prototype,"imageProcessingEnabled",null),c.c([Object(D.c)()],t.prototype,"glowLayerEnabled",null),c.c([Object(D.c)()],t.prototype,"chromaticAberrationEnabled",null),c.c([Object(D.c)()],t.prototype,"grainEnabled",null),t}(ys);a.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=xs,zt.a.ShadersStore.lensHighlightsPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",zt.a.ShadersStore.depthOfFieldPixelShader="\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance;\nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1\n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight;\n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV);\nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);\nfloat depth=texture2D(depthSampler,distorted_coords).r;\nfloat distance=near+(far-near)*depth;\nvec4 color=texture2D(textureSampler,vUV);\n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n";var Cs=function(e){function t(t,n,i,r,o){void 0===r&&(r=1);var a=e.call(this,i.getEngine(),t)||this;return a.LensChromaticAberrationEffect="LensChromaticAberrationEffect",a.HighlightsEnhancingEffect="HighlightsEnhancingEffect",a.LensDepthOfFieldEffect="LensDepthOfFieldEffect",a._pentagonBokehIsEnabled=!1,a._scene=i,a._depthTexture=i.enableDepthRenderer().getDepthMap(),n.grain_texture?a._grainTexture=n.grain_texture:a._createGrainTexture(),a._edgeBlur=n.edge_blur?n.edge_blur:0,a._grainAmount=n.grain_amount?n.grain_amount:0,a._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,a._distortion=n.distortion?n.distortion:0,a._highlightsGain=void 0!==n.dof_gain?n.dof_gain:-1,a._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,a._dofDistance=void 0!==n.dof_focus_distance?n.dof_focus_distance:-1,a._dofAperture=n.dof_aperture?n.dof_aperture:1,a._dofDarken=n.dof_darken?n.dof_darken:0,a._dofPentagon=void 0===n.dof_pentagon||n.dof_pentagon,a._blurNoise=void 0===n.blur_noise||n.blur_noise,a._createChromaticAberrationPostProcess(r),a._createHighlightsPostProcess(r),a._createDepthOfFieldPostProcess(r/4),a.addEffect(new Za(i.getEngine(),a.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),a.addEffect(new Za(i.getEngine(),a.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),a.addEffect(new Za(i.getEngine(),a.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1===a._highlightsGain&&a._disableEffect(a.HighlightsEnhancingEffect,null),i.postProcessRenderPipelineManager.addPipeline(a),o&&i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,o),a}return c.d(t,e),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!0,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n"),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var t=this;this._chromaticAberrationPostProcess=new jt("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",t._chromaticAberration),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("radialIntensity",1),e.setFloat2("direction",17,17),e.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var t=this;this._highlightsPostProcess=new jt("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",t._highlightsGain),e.setFloat("threshold",t._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",t._chromaticAberrationPostProcess),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var t=this;this._depthOfFieldPostProcess=new jt("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",t._depthTexture),e.setTexture("grainSampler",t._grainTexture),e.setTextureFromPostProcess("textureSampler",t._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",t._depthOfFieldPostProcess),e.setFloat("grain_amount",t._grainAmount),e.setBool("blur_noise",t._blurNoise),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("distortion",t._distortion),e.setBool("dof_enabled",-1!==t._dofDistance),e.setFloat("screen_distance",1/(.1-1/t._dofDistance)),e.setFloat("aperture",t._dofAperture),e.setFloat("darken",t._dofDarken),e.setFloat("edge_blur",t._edgeBlur),e.setBool("highlights",-1!==t._highlightsGain),t._scene.activeCamera&&(e.setFloat("near",t._scene.activeCamera.minZ),e.setFloat("far",t._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new yn("LensNoiseTexture",512,this._scene,!1,Ge.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e,t=this._grainTexture.getContext(),n=0;n<512;n++)for(var i=0;i<512;i++)e=Math.floor(255*(Math.random()*(.58-.42)+.42)),t.fillStyle="rgb("+e+", "+e+", "+e+")",t.fillRect(n,i,1,1);this._grainTexture.update(!1)},t}(ys);zt.a.ShadersStore.ssao2PixelShader="\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=texture2D(textureSampler,vUV).r;\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\nvec3 normal=texture2D(normalSampler,vUV).rgb;\nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",zt.a.ShadersStore.ssaoCombinePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n";var Ss=function(e){function t(t,n,i,r){var o=e.call(this,n.getEngine(),t)||this;if(o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.maxZ=100,o.minZAspect=.2,o._samples=8,o._textureSamples=1,o._expensiveBlur=!0,o.radius=2,o.base=0,o._firstUpdate=!0,o._bits=new Uint32Array(1),o._scene=n,o._ratio=i,!o.isSupported)return p.a.Error("SSAO 2 needs WebGL 2 support."),o;var a=o._ratio.ssaoRatio||i,s=o._ratio.blurRatio||i,l=n.enableGeometryBufferRenderer();return o._createRandomTexture(),o._depthTexture=l.getGBuffer().textures[0],o._normalTexture=l.getGBuffer().textures[1],o._originalColorPostProcess=new Ht("SSAOOriginalSceneColor",1,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),o._originalColorPostProcess.samples=o.textureSamples,o._createSSAOPostProcess(1),o._createBlurPostProcess(a,s),o._createSSAOCombinePostProcess(s),o.addEffect(new Za(n.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(o),r&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,r),o}return c.d(t,e),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._ssaoPostProcess.updateEffect("#define SAMPLES "+e+"\n#define SSAO"),this._samples=e,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=e,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=A.a.LastCreatedEngine;return!!e&&e.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var n=0;n<this._scene.cameras.length;n++){var i=this._scene.cameras[n];this._originalColorPostProcess.dispose(i),this._ssaoPostProcess.dispose(i),this._blurHPostProcess.dispose(i),this._blurVPostProcess.dispose(i),this._ssaoCombinePostProcess.dispose(i)}this._randomTexture.dispose(),t&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,t){var n=this;this._samplerOffsets=[];for(var i=this.expensiveBlur,r=-8;r<8;r++)this._samplerOffsets.push(2*r+.5);this._blurHPostProcess=new jt("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(i?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(e){n._scene.activeCamera&&(e.setFloat("outSize",n._ssaoCombinePostProcess.width>0?n._ssaoCombinePostProcess.width:n._originalColorPostProcess.width),e.setFloat("near",n._scene.activeCamera.minZ),e.setFloat("far",n._scene.activeCamera.maxZ),e.setFloat("radius",n.radius),e.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&e.setArray("samplerOffsets",n._samplerOffsets))},this._blurVPostProcess=new jt("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],t,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(i?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(e){n._scene.activeCamera&&(e.setFloat("outSize",n._ssaoCombinePostProcess.height>0?n._ssaoCombinePostProcess.height:n._originalColorPostProcess.height),e.setFloat("near",n._scene.activeCamera.minZ),e.setFloat("far",n._scene.activeCamera.maxZ),e.setFloat("radius",n.radius),e.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&(e.setArray("samplerOffsets",n._samplerOffsets),n._firstUpdate=!1))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},t.prototype._hammersley=function(e,t){return[e/t,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,t){var n=2*t*Math.PI,i=1-(.85*e+.15),r=Math.sqrt(1-i*i);return new o.x(Math.cos(n)*r,Math.sin(n)*r,i)},t.prototype._generateHemisphere=function(){for(var e,t=this.samples,n=[],i=0;i<t;){if(t<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var r=this._hammersley(i,t);e=this._hemisphereSample_uniform(r[0],r[1])}n.push(e.x,e.y,e.z),i++}return n},t.prototype._createSSAOPostProcess=function(e){var t=this,n=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new jt("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+n+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){t._firstUpdate&&(e.setArray3("sampleSphere",t._sampleSphere),e.setFloat("randTextureTiles",32)),t._scene.activeCamera&&(e.setFloat("samplesFactor",1/t.samples),e.setFloat("totalStrength",t.totalStrength),e.setFloat2("texelSize",1/t._ssaoPostProcess.width,1/t._ssaoPostProcess.height),e.setFloat("radius",t.radius),e.setFloat("maxZ",t.maxZ),e.setFloat("minZAspect",t.minZAspect),e.setFloat("base",t.base),e.setFloat("near",t._scene.activeCamera.minZ),e.setFloat("far",t._scene.activeCamera.maxZ),e.setFloat("xViewport",Math.tan(t._scene.activeCamera.fov/2)*t._scene.getEngine().getAspectRatio(t._scene.activeCamera,!0)),e.setFloat("yViewport",Math.tan(t._scene.activeCamera.fov/2)),e.setMatrix("projection",t._scene.getProjectionMatrix()),e.setTexture("textureSampler",t._depthTexture),e.setTexture("normalSampler",t._normalTexture),e.setTexture("randomSampler",t._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(e){var t=this;this._ssaoCombinePostProcess=new jt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){var n=t._scene.activeCamera.viewport;e.setVector4("viewport",o.t.Vector4[0].copyFromFloats(n.x,n.y,n.width,n.height)),e.setTextureFromPostProcess("originalColor",t._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},t.prototype._createRandomTexture=function(){this._randomTexture=new yn("SSAORandomTexture",128,this._scene,!1,Ge.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},n=o.x.Zero(),i=0;i<128;i++)for(var r=0;r<128;r++)n.x=t(0,1),n.y=t(0,1),n.z=0,n.normalize(),n.scaleInPlace(255),n.x=Math.floor(n.x),n.y=Math.floor(n.y),e.fillStyle="rgb("+n.x+", "+n.y+", "+n.z+")",e.fillRect(i,r,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,n,i){return D.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,i)},c.c([Object(D.c)()],t.prototype,"totalStrength",void 0),c.c([Object(D.c)()],t.prototype,"maxZ",void 0),c.c([Object(D.c)()],t.prototype,"minZAspect",void 0),c.c([Object(D.c)("samples")],t.prototype,"_samples",void 0),c.c([Object(D.c)("textureSamples")],t.prototype,"_textureSamples",void 0),c.c([Object(D.c)()],t.prototype,"_ratio",void 0),c.c([Object(D.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),c.c([Object(D.c)()],t.prototype,"radius",void 0),c.c([Object(D.c)()],t.prototype,"base",void 0),t}(ys);a.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=Ss,zt.a.ShadersStore.ssaoPixelShader="\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n";var As=function(e){function t(t,n,i,r){var o=e.call(this,n.getEngine(),t)||this;o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.radius=1e-4,o.area=.0075,o.fallOff=1e-6,o.base=.5,o._firstUpdate=!0,o._scene=n,o._createRandomTexture(),o._depthTexture=n.enableDepthRenderer().getDepthMap();var a=i.ssaoRatio||i,s=i.combineRatio||i;return o._originalColorPostProcess=new Ht("SSAOOriginalSceneColor",s,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),o._createSSAOPostProcess(a),o._createBlurPostProcess(a),o._createSSAOCombinePostProcess(s),o.addEffect(new Za(n.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(o),r&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,r),o}return c.d(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var n=0;n<this._scene.cameras.length;n++){var i=this._scene.cameras[n];this._originalColorPostProcess.dispose(i),this._ssaoPostProcess.dispose(i),this._blurHPostProcess.dispose(i),this._blurVPostProcess.dispose(i),this._ssaoCombinePostProcess.dispose(i)}this._randomTexture.dispose(),t&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var t=this;this._blurHPostProcess=new zi("BlurH",new o.w(1,0),16,e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new zi("BlurV",new o.w(0,1),16,e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var e=t._blurHPostProcess.width/t._scene.getEngine().getRenderWidth();t._blurHPostProcess.kernel=16*e}),this._blurVPostProcess.onActivateObservable.add(function(){var e=t._blurVPostProcess.height/t._scene.getEngine().getRenderHeight();t._blurVPostProcess.kernel=16*e})},t.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var t=this,n=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new jt("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){t._firstUpdate&&(e.setArray3("sampleSphere",n),e.setFloat("samplesFactor",1/16),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",t.totalStrength),e.setFloat("radius",t.radius),e.setFloat("area",t.area),e.setFloat("fallOff",t.fallOff),e.setFloat("base",t.base),e.setTexture("textureSampler",t._depthTexture),e.setTexture("randomSampler",t._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var t=this;this._ssaoCombinePostProcess=new jt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setVector4("viewport",o.t.Vector4[0].copyFromFloats(0,0,1,1)),e.setTextureFromPostProcess("originalColor",t._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new yn("SSAORandomTexture",512,this._scene,!1,Ge.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},n=o.x.Zero(),i=0;i<512;i++)for(var r=0;r<512;r++)n.x=Math.floor(255*t(-1,1)),n.y=Math.floor(255*t(-1,1)),n.z=Math.floor(255*t(-1,1)),e.fillStyle="rgb("+n.x+", "+n.y+", "+n.z+")",e.fillRect(i,r,1,1);this._randomTexture.update(!1)},c.c([Object(D.c)()],t.prototype,"totalStrength",void 0),c.c([Object(D.c)()],t.prototype,"radius",void 0),c.c([Object(D.c)()],t.prototype,"area",void 0),c.c([Object(D.c)()],t.prototype,"fallOff",void 0),c.c([Object(D.c)()],t.prototype,"base",void 0),t}(ys);zt.a.ShadersStore.standardPixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\n#ifndef AUTO_EXPOSURE\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\n#endif\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n";var Ps,Rs=function(e){function t(t,n,i,r,o){void 0===r&&(r=null);var a=e.call(this,n.getEngine(),t)||this;return a.downSampleX4PostProcess=null,a.brightPassPostProcess=null,a.blurHPostProcesses=[],a.blurVPostProcesses=[],a.textureAdderPostProcess=null,a.volumetricLightPostProcess=null,a.volumetricLightSmoothXPostProcess=null,a.volumetricLightSmoothYPostProcess=null,a.volumetricLightMergePostProces=null,a.volumetricLightFinalPostProcess=null,a.luminancePostProcess=null,a.luminanceDownSamplePostProcesses=[],a.hdrPostProcess=null,a.textureAdderFinalPostProcess=null,a.lensFlareFinalPostProcess=null,a.hdrFinalPostProcess=null,a.lensFlarePostProcess=null,a.lensFlareComposePostProcess=null,a.motionBlurPostProcess=null,a.depthOfFieldPostProcess=null,a.fxaaPostProcess=null,a.brightThreshold=1,a.blurWidth=512,a.horizontalBlur=!1,a.lensTexture=null,a.volumetricLightCoefficient=.2,a.volumetricLightPower=4,a.volumetricLightBlurScale=64,a.sourceLight=null,a.hdrMinimumLuminance=1,a.hdrDecreaseRate=.5,a.hdrIncreaseRate=.5,a.lensColorTexture=null,a.lensFlareStrength=20,a.lensFlareGhostDispersal=1.4,a.lensFlareHaloWidth=.7,a.lensFlareDistortionStrength=16,a.lensStarTexture=null,a.lensFlareDirtTexture=null,a.depthOfFieldDistance=10,a.depthOfFieldBlurWidth=64,a.motionStrength=1,a.animations=[],a._currentDepthOfFieldSource=null,a._fixedExposure=1,a._currentExposure=1,a._hdrAutoExposure=!1,a._hdrCurrentLuminance=1,a._bloomEnabled=!1,a._depthOfFieldEnabled=!1,a._vlsEnabled=!1,a._lensFlareEnabled=!1,a._hdrEnabled=!1,a._motionBlurEnabled=!1,a._fxaaEnabled=!1,a._motionBlurSamples=64,a._volumetricLightStepsCount=50,a._samples=1,a._cameras=o||[],a._scene=n,a._basePostProcess=r,a._ratio=i,a._floatTextureType=n.getEngine().getCaps().textureFloatRender?g.a.TEXTURETYPE_FLOAT:g.a.TEXTURETYPE_HALF_FLOAT,n.postProcessRenderPipelineManager.addPipeline(a),a._buildPipeline(),a}return c.d(t,e),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var t=["#define HDR"];e&&t.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(t.join("\n"))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e&&!this._scene.enableGeometryBufferRenderer())return void p.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+e.toFixed(1)),this._motionBlurSamples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,t=this._ratio,n=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new jt("HDRPass","standard",[],[],t,null,g.a.TEXTURE_BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(){e._currentDepthOfFieldSource=e.originalPostProcess}),(this._bloomEnabled||this._vlsEnabled||this._lensFlareEnabled||this._depthOfFieldEnabled||this._motionBlurEnabled)&&this.addEffect(new Za(n.getEngine(),"HDRPassPostProcess",function(){return e.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._bloomEnabled&&(this._createDownSampleX4PostProcess(n,t/2),this._createBrightPassPostProcess(n,t/2),this._createBlurPostProcesses(n,t/4,1),this._createTextureAdderPostProcess(n,t),this.textureAdderFinalPostProcess=new jt("HDRDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRBaseDepthOfFieldSource",function(){return e.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(n,t),this.volumetricLightFinalPostProcess=new jt("HDRVLSFinal","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRVLSFinal",function(){return e.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(n,t),this.lensFlareFinalPostProcess=new jt("HDRPostLensFlareDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return e.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(n,this._floatTextureType),this._createHdrPostProcess(n,t),this.hdrFinalPostProcess=new jt("HDRPostHDReDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return e.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(n,t/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(n,t)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(n,t),this._fxaaEnabled&&(this.fxaaPostProcess=new ds("fxaa",1,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRFxaa",function(){return e.fxaaPostProcess},!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,t){var n=this,i=new Array(32);this.downSampleX4PostProcess=new jt("HDRDownSampleX4","standard",["dsOffsets"],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",g.a.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(e){for(var t=0,r=n.downSampleX4PostProcess.width,o=n.downSampleX4PostProcess.height,a=-2;a<2;a++)for(var s=-2;s<2;s++)i[t]=(a+.5)*(1/r),i[t+1]=(s+.5)*(1/o),t+=2;e.setArray2("dsOffsets",i)},this.addEffect(new Za(e.getEngine(),"HDRDownSampleX4",function(){return n.downSampleX4PostProcess},!0))},t.prototype._createBrightPassPostProcess=function(e,t){var n=this,i=new Array(8);this.brightPassPostProcess=new jt("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",g.a.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(e){var t=1/n.brightPassPostProcess.width,r=1/n.brightPassPostProcess.height;i[0]=-.5*t,i[1]=.5*r,i[2]=.5*t,i[3]=.5*r,i[4]=-.5*t,i[5]=-.5*r,i[6]=.5*t,i[7]=-.5*r,e.setArray2("dsOffsets",i),e.setFloat("brightThreshold",n.brightThreshold)},this.addEffect(new Za(e.getEngine(),"HDRBrightPass",function(){return n.brightPassPostProcess},!0))},t.prototype._createBlurPostProcesses=function(e,t,n,i){var r=this;void 0===i&&(i="blurWidth");var a=e.getEngine(),s=new zi("HDRBlurH_"+n,new o.w(1,0),this[i],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT),l=new zi("HDRBlurV_"+n,new o.w(0,1),this[i],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,g.a.TEXTURETYPE_UNSIGNED_INT);s.onActivateObservable.add(function(){var e=s.width/a.getRenderWidth();s.kernel=r[i]*e}),l.onActivateObservable.add(function(){var e=l.height/a.getRenderHeight();l.kernel=r.horizontalBlur?64*e:r[i]*e}),this.addEffect(new Za(e.getEngine(),"HDRBlurH"+n,function(){return s},!0)),this.addEffect(new Za(e.getEngine(),"HDRBlurV"+n,function(){return l},!0)),this.blurHPostProcesses.push(s),this.blurVPostProcesses.push(l)},t.prototype._createTextureAdderPostProcess=function(e,t){var n=this;this.textureAdderPostProcess=new jt("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",g.a.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._vlsEnabled?n._currentDepthOfFieldSource:n.originalPostProcess),e.setTexture("lensSampler",n.lensTexture),e.setFloat("exposure",n._currentExposure),n._currentDepthOfFieldSource=n.textureAdderFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDRTextureAdder",function(){return n.textureAdderPostProcess},!0))},t.prototype._createVolumetricLightPostProcess=function(e,t){var n=this,i=e.enableGeometryBufferRenderer();i.enablePosition=!0;var r=i.getGBuffer();this.volumetricLightPostProcess=new jt("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],t/8,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var a=o.w.Zero();this.volumetricLightPostProcess.onApply=function(e){if(n.sourceLight&&n.sourceLight.getShadowGenerator()&&n._scene.activeCamera){var t=n.sourceLight.getShadowGenerator();e.setTexture("shadowMapSampler",t.getShadowMap()),e.setTexture("positionSampler",r.textures[2]),e.setColor3("sunColor",n.sourceLight.diffuse),e.setVector3("sunDirection",n.sourceLight.getShadowDirection()),e.setVector3("cameraPosition",n._scene.activeCamera.globalPosition),e.setMatrix("shadowViewProjection",t.getTransformMatrix()),e.setFloat("scatteringCoefficient",n.volumetricLightCoefficient),e.setFloat("scatteringPower",n.volumetricLightPower),a.x=n.sourceLight.getDepthMinZ(n._scene.activeCamera),a.y=n.sourceLight.getDepthMaxZ(n._scene.activeCamera),e.setVector2("depthValues",a)}},this.addEffect(new Za(e.getEngine(),"HDRVLS",function(){return n.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(e,t/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new jt("HDRVLSMerge","standard",[],["originalSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(e){e.setTextureFromPostProcess("originalSampler",n._bloomEnabled?n.textureAdderFinalPostProcess:n.originalPostProcess),n._currentDepthOfFieldSource=n.volumetricLightFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDRVLSMerge",function(){return n.volumetricLightMergePostProces},!0))},t.prototype._createLuminancePostProcesses=function(e,n){var i=this,r=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new jt("HDRLuminance","standard",["lumOffsets"],[],{width:r,height:r},null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",n);var a=[];this.luminancePostProcess.onApply=function(e){var t=1/i.luminancePostProcess.width,n=1/i.luminancePostProcess.height;a[0]=-.5*t,a[1]=.5*n,a[2]=.5*t,a[3]=.5*n,a[4]=-.5*t,a[5]=-.5*n,a[6]=.5*t,a[7]=-.5*n,e.setArray2("lumOffsets",a)},this.addEffect(new Za(e.getEngine(),"HDRLuminance",function(){return i.luminancePostProcess},!0));for(var s=t.LuminanceSteps-1;s>=0;s--){r=Math.pow(3,s);var l="#define LUMINANCE_DOWN_SAMPLE\n";0===s&&(l+="#define FINAL_DOWN_SAMPLER");var c=new jt("HDRLuminanceDownSample"+s,"standard",["dsOffsets","halfDestPixelSize"],[],{width:r,height:r},null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,n);this.luminanceDownSamplePostProcesses.push(c)}var u=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(t,n){var r=new Array(18);t.onApply=function(e){if(u){for(var o=0,a=-1;a<2;a++)for(var s=-1;s<2;s++)r[o]=a/u.width,r[o+1]=s/u.height,o+=2;e.setArray2("dsOffsets",r),e.setFloat("halfDestPixelSize",.5/u.width),u=n===i.luminanceDownSamplePostProcesses.length-1?i.luminancePostProcess:t}},n===i.luminanceDownSamplePostProcesses.length-1&&(t.onAfterRender=function(){var t=e.getEngine().readPixels(0,0,1,1),n=new o.y(1/16581375,1/65025,1/255,1);i._hdrCurrentLuminance=(t[0]*n.x+t[1]*n.y+t[2]*n.z+t[3]*n.w)/100}),i.addEffect(new Za(e.getEngine(),"HDRLuminanceDownSample"+n,function(){return t},!0))})},t.prototype._createHdrPostProcess=function(e,t){var n=this,i=["#define HDR"];this._hdrAutoExposure&&i.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new jt("HDR","standard",["averageLuminance"],["textureAdderSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,i.join("\n"),g.a.TEXTURETYPE_UNSIGNED_INT);var r=1,o=0,a=0;this.hdrPostProcess.onApply=function(t){if(t.setTextureFromPostProcess("textureAdderSampler",n._currentDepthOfFieldSource),o+=e.getEngine().getDeltaTime(),r<0)r=n._hdrCurrentLuminance;else{var i=(a-o)/1e3;n._hdrCurrentLuminance<r+n.hdrDecreaseRate*i?r+=n.hdrDecreaseRate*i:n._hdrCurrentLuminance>r-n.hdrIncreaseRate*i?r-=n.hdrIncreaseRate*i:r=n._hdrCurrentLuminance}n.hdrAutoExposure?n._currentExposure=n._fixedExposure/r:(r=I.a.Clamp(r,n.hdrMinimumLuminance,1e20),t.setFloat("averageLuminance",r)),a=o,n._currentDepthOfFieldSource=n.hdrFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDR",function(){return n.hdrPostProcess},!0))},t.prototype._createLensFlarePostProcess=function(e,t){var n=this;this.lensFlarePostProcess=new jt("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],t/2,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(e.getEngine(),"HDRLensFlare",function(){return n.lensFlarePostProcess},!0)),this._createBlurPostProcesses(e,t/4,2),this.lensFlareComposePostProcess=new jt("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",g.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(e.getEngine(),"HDRLensFlareCompose",function(){return n.lensFlareComposePostProcess},!0));var i=new o.w(0,0);this.lensFlarePostProcess.onApply=function(e){e.setTextureFromPostProcess("textureSampler",n._bloomEnabled?n.blurHPostProcesses[0]:n.originalPostProcess),e.setTexture("lensColorSampler",n.lensColorTexture),e.setFloat("strength",n.lensFlareStrength),e.setFloat("ghostDispersal",n.lensFlareGhostDispersal),e.setFloat("haloWidth",n.lensFlareHaloWidth),i.x=n.lensFlarePostProcess.width,i.y=n.lensFlarePostProcess.height,e.setVector2("resolution",i),e.setFloat("distortionStrength",n.lensFlareDistortionStrength)};var r=o.j.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),a=o.j.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(e){if(n._scene.activeCamera){e.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),e.setTexture("lensDirtSampler",n.lensFlareDirtTexture),e.setTexture("lensStarSampler",n.lensStarTexture);var t=n._scene.activeCamera.getViewMatrix().getRow(0),i=n._scene.activeCamera.getViewMatrix().getRow(2),s=o.x.Dot(t.toVector3(),new o.x(1,0,0))+o.x.Dot(i.toVector3(),new o.x(0,0,1));s*=4;var l=o.j.FromValues(.5*Math.cos(s),-Math.sin(s),0,0,Math.sin(s),.5*Math.cos(s),0,0,0,0,1,0,0,0,0,1),c=a.multiply(l).multiply(r);e.setMatrix("lensStarMatrix",c),n._currentDepthOfFieldSource=n.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,t){var n=this;this.depthOfFieldPostProcess=new jt("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",g.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),e.setTexture("depthSampler",n._getDepthTexture()),e.setFloat("distance",n.depthOfFieldDistance)},this.addEffect(new Za(e.getEngine(),"HDRDepthOfField",function(){return n.depthOfFieldPostProcess},!0))},t.prototype._createMotionBlurPostProcess=function(e,t){var n=this;this.motionBlurPostProcess=new jt("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),g.a.TEXTURETYPE_UNSIGNED_INT);var i=0,r=o.j.Identity(),a=o.j.Identity(),s=o.j.Identity(),l=o.w.Zero();this.motionBlurPostProcess.onApply=function(t){(s=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(a),t.setMatrix("inverseViewProjection",a),t.setMatrix("prevViewProjection",r),r=s,l.x=n.motionBlurPostProcess.width,l.y=n.motionBlurPostProcess.height,t.setVector2("screenSize",l),i=e.getEngine().getFps()/60,t.setFloat("motionScale",i),t.setFloat("motionStrength",n.motionStrength),t.setTexture("depthSampler",n._getDepthTexture())},this.addEffect(new Za(e.getEngine(),"HDRMotionBlur",function(){return n.motionBlurPostProcess},!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(t),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(t),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(t),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(t),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(t),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(t),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(t),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(t),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(t),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(t),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(t),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(t);for(var n=0;n<this.luminanceDownSamplePostProcesses.length;n++)this.luminanceDownSamplePostProcesses[n].dispose(t);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(t),this.hdrPostProcess&&this.hdrPostProcess.dispose(t),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(t),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(t),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(t),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(t),n=0;n<this.blurHPostProcesses.length;n++)this.blurHPostProcesses[n].dispose(t);for(n=0;n<this.blurVPostProcesses.length;n++)this.blurVPostProcesses[n].dispose(t)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,n,i){var r=D.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,i);return e.sourceLightId&&(r.sourceLight=n.getLightByID(e.sourceLightId)),r},t.LuminanceSteps=6,c.c([Object(D.c)()],t.prototype,"brightThreshold",void 0),c.c([Object(D.c)()],t.prototype,"blurWidth",void 0),c.c([Object(D.c)()],t.prototype,"horizontalBlur",void 0),c.c([Object(D.c)()],t.prototype,"exposure",null),c.c([Object(D.m)("lensTexture")],t.prototype,"lensTexture",void 0),c.c([Object(D.c)()],t.prototype,"volumetricLightCoefficient",void 0),c.c([Object(D.c)()],t.prototype,"volumetricLightPower",void 0),c.c([Object(D.c)()],t.prototype,"volumetricLightBlurScale",void 0),c.c([Object(D.c)()],t.prototype,"hdrMinimumLuminance",void 0),c.c([Object(D.c)()],t.prototype,"hdrDecreaseRate",void 0),c.c([Object(D.c)()],t.prototype,"hdrIncreaseRate",void 0),c.c([Object(D.c)()],t.prototype,"hdrAutoExposure",null),c.c([Object(D.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),c.c([Object(D.c)()],t.prototype,"lensFlareStrength",void 0),c.c([Object(D.c)()],t.prototype,"lensFlareGhostDispersal",void 0),c.c([Object(D.c)()],t.prototype,"lensFlareHaloWidth",void 0),c.c([Object(D.c)()],t.prototype,"lensFlareDistortionStrength",void 0),c.c([Object(D.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),c.c([Object(D.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),c.c([Object(D.c)()],t.prototype,"depthOfFieldDistance",void 0),c.c([Object(D.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),c.c([Object(D.c)()],t.prototype,"motionStrength",void 0),c.c([Object(D.c)()],t.prototype,"_ratio",void 0),c.c([Object(D.c)()],t.prototype,"BloomEnabled",null),c.c([Object(D.c)()],t.prototype,"DepthOfFieldEnabled",null),c.c([Object(D.c)()],t.prototype,"LensFlareEnabled",null),c.c([Object(D.c)()],t.prototype,"HDREnabled",null),c.c([Object(D.c)()],t.prototype,"VLSEnabled",null),c.c([Object(D.c)()],t.prototype,"MotionBlurEnabled",null),c.c([Object(D.c)()],t.prototype,"fxaaEnabled",null),c.c([Object(D.c)()],t.prototype,"volumetricLightStepsCount",null),c.c([Object(D.c)()],t.prototype,"motionBlurSamples",null),c.c([Object(D.c)()],t.prototype,"samples",null),t}(ys);a.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=Rs,zt.a.ShadersStore.tonemapPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb);\nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm);\ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(Ps||(Ps={}));var Ms=function(e){function t(t,n,i,r,o,a,s){void 0===o&&(o=g.a.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===s&&(s=g.a.TEXTURETYPE_UNSIGNED_INT);var l=e.call(this,t,"tonemap",["_ExposureAdjustment"],null,1,r,o,a,!0,null,s)||this;l._operator=n,l.exposureAdjustment=i;var c="#define ";return l._operator===Ps.Hable?c+="HABLE_TONEMAPPING":l._operator===Ps.Reinhard?c+="REINHARD_TONEMAPPING":l._operator===Ps.HejiDawson?c+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":l._operator===Ps.Photographic&&(c+="PHOTOGRAPHIC_TONEMAPPING"),l.updateEffect(c),l.onApply=function(e){e.setFloat("_ExposureAdjustment",l.exposureAdjustment)},l}return c.d(t,e),t}(jt);zt.a.ShadersStore.depthVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",zt.a.ShadersStore.volumetricLightScatteringPixelShader="uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",zt.a.ShadersStore.volumetricLightScatteringPassPixelShader="#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n";var Os=function(e){function t(n,i,r,a,s,l,c,u,h){void 0===s&&(s=100),void 0===l&&(l=Ge.a.BILINEAR_SAMPLINGMODE);var d=e.call(this,n,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],i.postProcessRatio||i,r,l,c,u,"#define NUM_SAMPLES "+s)||this;return d._screenCoordinates=o.w.Zero(),d.customMeshPosition=o.x.Zero(),d.useCustomMeshPosition=!1,d.invert=!0,d.excludedMeshes=new Array,d.exposure=.3,d.decay=.96815,d.weight=.58767,d.density=.926,c=(h=null===r?h:r.getScene()).getEngine(),d._viewPort=new o.z(0,0,1,1).toGlobal(c.getRenderWidth(),c.getRenderHeight()),d.mesh=null!==a?a:t.CreateDefaultMesh("VolumetricLightScatteringMesh",h),d._createPass(h,i.passRatio||i),d.onActivate=function(e){d.isSupported||d.dispose(e),d.onActivate=null},d.onApplyObservable.add(function(e){d._updateMeshScreenCoordinates(h),e.setTexture("lightScatteringSampler",d._volumetricLightScatteringRTT),e.setFloat("exposure",d.exposure),e.setFloat("decay",d.decay),e.setFloat("weight",d.weight),e.setFloat("density",d.density),e.setVector2("meshPositionOnScreen",d._screenCoordinates)}),d}return c.d(t,e),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,t){var n=e.getMesh();if(n===this.mesh&&n.material)return n.material.isReady(n);var i=[],r=[Cn.b.PositionKind],o=e.getMaterial();o&&(o.needAlphaTesting()&&i.push("#define ALPHATEST"),n.isVerticesDataPresent(Cn.b.UVKind)&&(r.push(Cn.b.UVKind),i.push("#define UV1")),n.isVerticesDataPresent(Cn.b.UV2Kind)&&(r.push(Cn.b.UV2Kind),i.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders?(r.push(Cn.b.MatricesIndicesKind),r.push(Cn.b.MatricesWeightsKind),i.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),i.push("#define BonesPerMesh "+(n.skeleton?n.skeleton.bones.length+1:0))):i.push("#define NUM_BONE_INFLUENCERS 0"),t&&(i.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=i.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._volumetricLightScatteringPass=n.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},r,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(t){var n=t.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==n&&t.getScene().customRenderTargets.splice(n,1),this._volumetricLightScatteringRTT.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},t.prototype._createPass=function(e,t){var n=this,i=e.getEngine();this._volumetricLightScatteringRTT=new cn("volumetricLightScatteringMap",{width:i.getRenderWidth()*t,height:i.getRenderHeight()*t},e,!1,!0,g.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var r=this.getCamera();r?r.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var a,s=function(e){var t=e.getRenderingMesh();if(!n._meshExcluded(t)){var i=e.getMaterial();if(i){var r=t.getScene(),o=r.getEngine();o.setState(i.backFaceCulling);var a=t._getInstancesRenderList(e._id);if(!a.mustReturn){var s=o.getCaps().instancedArrays&&null!==a.visibleInstances[e._id];if(n._isReady(e,s)){var l=n._volumetricLightScatteringPass;if(t===n.mesh&&(l=e.effect?e.effect:i.getEffect()),o.enableEffect(l),t._bind(e,l,Pr.a.TriangleFillMode),t===n.mesh)i.bind(t.getWorldMatrix(),t);else{if(n._volumetricLightScatteringPass.setMatrix("viewProjection",r.getTransformMatrix()),i&&i.needAlphaTesting()){var c=i.getAlphaTestTexture();n._volumetricLightScatteringPass.setTexture("diffuseSampler",c),c&&n._volumetricLightScatteringPass.setMatrix("diffuseMatrix",c.getTextureMatrix())}t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&n._volumetricLightScatteringPass.setMatrices("mBones",t.skeleton.getTransformMatrices(t))}t._processRendering(e,n._volumetricLightScatteringPass,Pr.a.TriangleFillMode,a,s,function(e,t){return l.setMatrix("world",t)})}}}}},l=new o.f(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){a=e.clearColor,e.clearColor=l}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){e.clearColor=a}),this._volumetricLightScatteringRTT.customRenderFunction=function(t,n,i,r){var o,a=e.getEngine();if(r.length){for(a.setColorWrite(!1),o=0;o<r.length;o++)s(r.data[o]);a.setColorWrite(!0)}for(o=0;o<t.length;o++)s(t.data[o]);for(o=0;o<n.length;o++)s(n.data[o]);if(i.length){for(o=0;o<i.length;o++){var l=i.data[o],c=l.getBoundingInfo();c&&e.activeCamera&&(l._alphaIndex=l.getMesh().alphaIndex,l._distanceToCamera=c.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var u=i.data.slice(0,i.length);for(u.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(g.a.ALPHA_COMBINE),o=0;o<u.length;o++)s(u[o]);a.setAlphaMode(g.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(e){var t,n=e.getTransformMatrix();t=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var i=o.x.Project(t,o.j.Identity(),n,this._viewPort);this._screenCoordinates.x=i.x/this._viewPort.width,this._screenCoordinates.y=i.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,t){var n=fe.a.CreatePlane(e,1,t);n.billboardMode=ke.a.BILLBOARDMODE_ALL;var i=new bn.a(e+"Material",t);return i.emissiveColor=new o.e(1,1,1),n.material=i,n},c.c([Object(D.o)()],t.prototype,"customMeshPosition",void 0),c.c([Object(D.c)()],t.prototype,"useCustomMeshPosition",void 0),c.c([Object(D.c)()],t.prototype,"invert",void 0),c.c([Object(D.k)()],t.prototype,"mesh",void 0),c.c([Object(D.c)()],t.prototype,"excludedMeshes",void 0),c.c([Object(D.c)()],t.prototype,"exposure",void 0),c.c([Object(D.c)()],t.prototype,"decay",void 0),c.c([Object(D.c)()],t.prototype,"weight",void 0),c.c([Object(D.c)()],t.prototype,"density",void 0),t}(jt);n(126),n(127),Object.defineProperty(W.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),W.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new ws(this)),this._boundingBoxRenderer},Object.defineProperty(ke.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var ws=function(){function e(e){this.name=xe.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new o.e(1,1,1),this.backColor=new o.e(.1,.1,.1),this.showBackLines=!0,this.renderList=new Gt.a(32),this._vertexBuffers={},this.scene=e,e._addComponent(this)}return e.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(xe.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(xe.a.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(xe.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(xe.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},e.prototype._evaluateSubMesh=function(e,t){if(e.showSubMeshesBoundingBox){var n=t.getBoundingInfo();null!=n&&(n.boundingBox._tag=e.renderingGroupId,this.renderList.push(n.boundingBox))}},e.prototype._activeMesh=function(e,t){if(e.showBoundingBox||this.scene.forceShowBoundingBoxes){var n=e.getBoundingInfo();n.boundingBox._tag=t.renderingGroupId,this.renderList.push(n.boundingBox)}},e.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new mo.a("colorShader",this.scene,"color",{attributes:[Cn.b.PositionKind],uniforms:["world","viewProjection","color"]});var e=this.scene.getEngine(),t=xn.a.CreateBox({size:1});this._vertexBuffers[Cn.b.PositionKind]=new Cn.b(e,t.positions,Cn.b.PositionKind,!1),this._createIndexBuffer()}},e.prototype._createIndexBuffer=function(){var e=this.scene.getEngine();this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},e.prototype.rebuild=function(){var e=this._vertexBuffers[Cn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.reset=function(){this.renderList.reset()},e.prototype.render=function(e){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var t=this.scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var n=0;n<this.renderList.length;n++){var i=this.renderList.data[n];if(i._tag===e){var r=i.minimum,a=i.maximum.subtract(r),s=r.add(a.scale(.5)),l=o.j.Scaling(a.x,a.y,a.z).multiply(o.j.Translation(s.x,s.y,s.z)).multiply(i.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(l),t.drawElementsType(Pr.a.LineListDrawMode,0,24)),t.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(l),t.drawElementsType(Pr.a.LineListDrawMode,0,24)}}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},e.prototype.renderOcclusionBoundingBox=function(e){if(this._prepareRessources(),this._colorShader.isReady()&&e._boundingInfo){var t=this.scene.getEngine();t.setDepthWrite(!1),t.setColorWrite(!1),this._colorShader._preBind();var n=e._boundingInfo.boundingBox,i=n.minimum,r=n.maximum.subtract(i),a=i.add(r.scale(.5)),s=o.j.Scaling(r.x,r.y,r.z).multiply(o.j.Translation(a.x,a.y,a.z)).multiply(n.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),t.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(s),t.drawElementsType(Pr.a.LineListDrawMode,0,24),this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0),t.setColorWrite(!0)}},e.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var e=this._vertexBuffers[Cn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Cn.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer)}},e}();zt.a.ShadersStore.depthPixelShader="#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}";var Is=function(){function e(t,n,i){var r=this;void 0===n&&(n=g.a.TEXTURETYPE_FLOAT),void 0===i&&(i=null),this.useOnlyInActiveCamera=!1,this._scene=t,e._SceneComponentInitialization(this._scene),this._camera=i;var a=t.getEngine();this._depthMap=new cn("depthMap",{width:a.getRenderWidth(),height:a.getRenderHeight()},this._scene,!1,!0,n),this._depthMap.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(e){e.clear(new o.f(1,1,1,1),!0,!0,!0)});var s=function(e){var t=e.getRenderingMesh(),n=r._scene,i=n.getEngine(),o=e.getMaterial();if(o){i.setState(o.backFaceCulling,0,!1,n.useRightHandedSystem);var a=t._getInstancesRenderList(e._id);if(!a.mustReturn){var s=i.getCaps().instancedArrays&&null!==a.visibleInstances[e._id],l=r._camera||n.activeCamera;if(r.isReady(e,s)&&l){if(i.enableEffect(r._effect),t._bind(e,r._effect,Pr.a.TriangleFillMode),r._effect.setMatrix("viewProjection",n.getTransformMatrix()),r._effect.setFloat2("depthValues",l.minZ,l.minZ+l.maxZ),o&&o.needAlphaTesting()){var c=o.getAlphaTestTexture();c&&(r._effect.setTexture("diffuseSampler",c),r._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()))}t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&r._effect.setMatrices("mBones",t.skeleton.getTransformMatrices(t)),t._processRendering(e,r._effect,Pr.a.TriangleFillMode,a,s,function(e,t){return r._effect.setMatrix("world",t)})}}}};this._depthMap.customRenderFunction=function(e,t,n,i){var r;if(i.length){for(a.setColorWrite(!1),r=0;r<i.length;r++)s(i.data[r]);a.setColorWrite(!0)}for(r=0;r<e.length;r++)s(e.data[r]);for(r=0;r<t.length;r++)s(t.data[r])}}return e.prototype.isReady=function(e,t){var n=e.getMaterial();if(n.disableDepthWrite)return!1;var i=[],r=[Cn.b.PositionKind],o=e.getMesh();n&&n.needAlphaTesting()&&n.getAlphaTestTexture()&&(i.push("#define ALPHATEST"),o.isVerticesDataPresent(Cn.b.UVKind)&&(r.push(Cn.b.UVKind),i.push("#define UV1")),o.isVerticesDataPresent(Cn.b.UV2Kind)&&(r.push(Cn.b.UV2Kind),i.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(r.push(Cn.b.MatricesIndicesKind),r.push(Cn.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(Cn.b.MatricesIndicesExtraKind),r.push(Cn.b.MatricesWeightsExtraKind)),i.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),i.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):i.push("#define NUM_BONE_INFLUENCERS 0"),t&&(i.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=i.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("depth",r,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],a)),this._effect.isReady()},e.prototype.getDepthMap=function(){return this._depthMap},e.prototype.dispose=function(){this._depthMap.dispose()},e._SceneComponentInitialization=function(e){throw ye.a.WarnImport("DepthRendererSceneComponent")},e}();W.a.prototype.enableDepthRenderer=function(e){if(!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){var t=0;if(this.getEngine().getCaps().textureHalfFloatRender)t=g.a.TEXTURETYPE_HALF_FLOAT;else{if(!this.getEngine().getCaps().textureFloatRender)throw"Depth renderer does not support int texture type";t=g.a.TEXTURETYPE_FLOAT}this._depthRenderer[e.id]=new Is(this,t,e)}return this._depthRenderer[e.id]},W.a.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&(this._depthRenderer[e.id].dispose(),delete this._depthRenderer[e.id])};var Ds=function(){function e(e){this.name=xe.a.NAME_DEPTHRENDERER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(xe.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(xe.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){for(var e in this.scene._depthRenderer)this.scene._depthRenderer[e].dispose()},e.prototype._gatherRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var n=this.scene._depthRenderer[t];n.useOnlyInActiveCamera||e.push(n.getDepthMap())}},e.prototype._gatherActiveCameraRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var n=this.scene._depthRenderer[t];n.useOnlyInActiveCamera&&this.scene.activeCamera.id===t&&e.push(n.getDepthMap())}},e}();Is._SceneComponentInitialization=function(e){var t=e._getComponent(xe.a.NAME_DEPTHRENDERER);t||(t=new Ds(e),e._addComponent(t))},zt.a.ShadersStore.linePixelShader="uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",zt.a.ShadersStore.lineVertexShader="\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",ke.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},ke.a.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new ks(this,e,t),this},Object.defineProperty(ke.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),Xo.b.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new Ns(this,e,t),this},Xo.a.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),Xo.b.prototype.enableEdgesRendering.apply(this,arguments),this};var Ls=function(){this.edges=new Array,this.edgesConnectedCount=0},ks=function(){function e(e,t,n,i){var r=this;void 0===t&&(t=.95),void 0===n&&(n=!1),void 0===i&&(i=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=e,this._checkVerticesInsteadOfIndices=n,this._epsilon=t,this._prepareRessources(),i&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){r._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){r.dispose()})}return e.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new mo.a("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype._rebuild=function(){var e=this._buffers[Cn.b.PositionKind];e&&e._rebuild(),(e=this._buffers[Cn.b.NormalKind])&&e._rebuild();var t=this._source.getScene().getEngine();this._ib=t.createIndexBuffer(this._linesIndices)},e.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var e=this._buffers[Cn.b.PositionKind];e&&(e.dispose(),this._buffers[Cn.b.PositionKind]=null),(e=this._buffers[Cn.b.NormalKind])&&(e.dispose(),this._buffers[Cn.b.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(e,t,n,i,r){return e===n&&t===i||e===i&&t===n?0:e===i&&t===r||e===r&&t===i?1:e===r&&t===n||e===n&&t===r?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,n,i,r){return e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)?0:e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)?1:e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)?2:-1},e.prototype._checkEdge=function(e,t,n,i,r){(void 0===t||o.x.Dot(n[e],n[t])<this._epsilon)&&this.createLine(i,r,this._linesPositions.length/3)},e.prototype.createLine=function(e,t,n){this._linesPositions.push(e.x,e.y,e.z,e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z),this._linesNormals.push(t.x,t.y,t.z,-1,t.x,t.y,t.z,1,e.x,e.y,e.z,-1,e.x,e.y,e.z,1),this._linesIndices.push(n,n+1,n+2,n,n+2,n+3)},e.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(Cn.b.PositionKind),t=this._source.getIndices();if(t&&e){var n,i,r=new Array,a=new Array;for(n=0;n<t.length;n+=3){i=new Ls;var s=t[n],l=t[n+1],c=t[n+2];i.p0=new o.x(e[3*s],e[3*s+1],e[3*s+2]),i.p1=new o.x(e[3*l],e[3*l+1],e[3*l+2]),i.p2=new o.x(e[3*c],e[3*c+1],e[3*c+2]);var u=o.x.Cross(i.p1.subtract(i.p0),i.p2.subtract(i.p1));u.normalize(),a.push(u),r.push(i)}for(n=0;n<r.length;n++){i=r[n];for(var h=n+1;h<r.length;h++){var d=r[h];if(3===i.edgesConnectedCount)break;if(3!==d.edgesConnectedCount)for(var f=t[3*h],p=t[3*h+1],g=t[3*h+2],m=0;m<3;m++){var _=0;if(void 0===i.edges[m]){switch(m){case 0:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(i.p0,i.p1,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n],t[3*n+1],f,p,g);break;case 1:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(i.p1,i.p2,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n+1],t[3*n+2],f,p,g);break;case 2:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(i.p2,i.p0,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n+2],t[3*n],f,p,g)}if(-1!==_&&(i.edges[m]=h,d.edges[_]=n,i.edgesConnectedCount++,d.edgesConnectedCount++,3===i.edgesConnectedCount))break}}}}for(n=0;n<r.length;n++){var v=r[n];this._checkEdge(n,v.edges[0],a,v.p0,v.p1),this._checkEdge(n,v.edges[1],a,v.p1,v.p2),this._checkEdge(n,v.edges[2],a,v.p2,v.p0)}var b=this._source.getScene().getEngine();this._buffers[Cn.b.PositionKind]=new Cn.b(b,this._linesPositions,Cn.b.PositionKind,!1),this._buffers[Cn.b.NormalKind]=new Cn.b(b,this._linesNormals,Cn.b.NormalKind,!1,!1,4),this._ib=b.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},e.prototype.isReady=function(){return this._lineShader.isReady()},e.prototype.render=function(){var e=this._source.getScene();if(this.isReady()&&e.activeCamera){var t=e.getEngine();this._lineShader._preBind(),t.setAlphaMode(1!==this._source.edgesColor.a?g.a.ALPHA_COMBINE:g.a.ALPHA_DISABLE),t.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),e.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),this._lineShader.setFloat("width",e.activeCamera.mode===Ne.a.ORTHOGRAPHIC_CAMERA?this._source.edgesWidth/this.edgesWidthScalerForOrthographic:this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",t.getAspectRatio(e.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),t.drawElementsType(Pr.a.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},e}(),Ns=function(e){function t(t,n,i){void 0===n&&(n=.95),void 0===i&&(i=!1);var r=e.call(this,t,n,i,!1)||this;return r._generateEdgesLines(),r}return c.d(t,e),t.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(Cn.b.PositionKind),t=this._source.getIndices();if(t&&e){for(var n=o.t.Vector3[0],i=o.t.Vector3[1],r=t.length-1,a=0,s=0;a<r;a+=2,s+=4)o.x.FromArrayToRef(e,3*t[a],n),o.x.FromArrayToRef(e,3*t[a+1],i),this.createLine(n,i,s);var l=this._source.getScene().getEngine();this._buffers[Cn.b.PositionKind]=new Cn.b(l,this._linesPositions,Cn.b.PositionKind,!1),this._buffers[Cn.b.NormalKind]=new Cn.b(l,this._linesNormals,Cn.b.NormalKind,!1,!1,4),this._ib=l.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(ks);zt.a.ShadersStore.outlinePixelShader="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",zt.a.ShadersStore.outlineVertexShader="\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",W.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new Fs(this)),this._outlineRenderer},Object.defineProperty(ke.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(ke.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var Fs=function(){function e(e){this.name=xe.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=e,this._engine=e.getEngine(),this.scene._addComponent(this)}return e.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(xe.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(xe.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype.render=function(e,t,n){var i=this;void 0===n&&(n=!1);var r=this.scene,o=r.getEngine(),a=o.getCaps().instancedArrays&&null!=t.visibleInstances[e._id];if(this.isReady(e,a)){var s=e.getRenderingMesh(),l=e.getMaterial();if(l&&r.activeCamera){if(o.enableEffect(this._effect),l.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(r.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",n?0:s.outlineWidth),this._effect.setColor4("color",n?s.overlayColor:s.outlineColor,n?s.overlayAlpha:l.alpha),this._effect.setMatrix("viewProjection",r.getTransformMatrix()),s.useBones&&s.computeBonesUsingShaders&&s.skeleton&&this._effect.setMatrices("mBones",s.skeleton.getTransformMatrices(s)),s._bind(e,this._effect,Pr.a.TriangleFillMode),l&&l.needAlphaTesting()){var c=l.getAlphaTestTexture();c&&(this._effect.setTexture("diffuseSampler",c),this._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()))}o.setZOffset(-this.zOffset),s._processRendering(e,this._effect,Pr.a.TriangleFillMode,t,a,function(e,t){i._effect.setMatrix("world",t)}),o.setZOffset(0)}}},e.prototype.isReady=function(e,t){var n=[],i=[Cn.b.PositionKind,Cn.b.NormalKind],r=e.getMesh(),o=e.getMaterial();o&&(o.needAlphaTesting()&&(n.push("#define ALPHATEST"),r.isVerticesDataPresent(Cn.b.UVKind)&&(i.push(Cn.b.UVKind),n.push("#define UV1")),r.isVerticesDataPresent(Cn.b.UV2Kind)&&(i.push(Cn.b.UV2Kind),n.push("#define UV2"))),o.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH")),r.useBones&&r.computeBonesUsingShaders?(i.push(Cn.b.MatricesIndicesKind),i.push(Cn.b.MatricesWeightsKind),r.numBoneInfluencers>4&&(i.push(Cn.b.MatricesIndicesExtraKind),i.push(Cn.b.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),n.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),t&&(n.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this.scene.getEngine().createEffect("outline",i,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],a)),this._effect.isReady()},e.prototype._beforeRenderingMesh=function(t,n,i){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){var r=n.getMaterial();r&&r.needAlphaBlending&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(g.a.REPLACE),this._engine.setStencilFunction(g.a.ALWAYS),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this.render(n,i,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(g.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(n,i),this._engine.setDepthWrite(this._savedDepthWrite),r&&r.needAlphaBlending&&this._engine.restoreStencilState()}},e.prototype._afterRenderingMesh=function(e,t,n){if(e.renderOverlay){var i=this._engine.getAlphaMode();this._engine.setAlphaMode(g.a.ALPHA_COMBINE),this.render(t,n,!0),this._engine.setAlphaMode(i)}e.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(t,n),this._engine.setColorWrite(!0))},e._StencilReference=4,e}(),Bs=n(109),Us=function(){function e(e,t){this.name=e,this.color=new o.f(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=t,this._manager.sprites.push(this),this.position=o.x.Zero()}return Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(e,t,n,i,r){this._fromIndex=e,this._toIndex=t,this._loopAnimation=n,this._delay=i,this._animationStarted=!0,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0,this._onAnimationEnd=r},e.prototype.stopAnimation=function(){this._animationStarted=!1},e.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},e.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},e}();W.a.prototype._internalPickSprites=function(e,t,n,i){if(!Kn.a)return null;var r=null;if(!i){if(!this.activeCamera)return null;i=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var a=this.spriteManagers[o];if(a.isPickable){var s=a.intersects(e,i,t,n);if(s&&s.hit&&(n||null==r||!(s.distance>=r.distance))&&(r=s,n))break}}return r||new Kn.a},W.a.prototype.pickSprite=function(e,t,n,i,r){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,r),this._internalPickSprites(this._tempSpritePickingRay,n,i,r)},W.a.prototype.pickSpriteWithRay=function(e,t,n,i){if(!this._tempSpritePickingRay)return null;if(!i){if(!this.activeCamera)return null;i=this.activeCamera}return wt.a.TransformToRef(e,i.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,t,n,i)},W.a.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOutTrigger,l.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(g.a.ACTION_OnPointerOverTrigger,l.a.CreateNewFromSprite(this._pointerOverSprite,this)))},W.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var Vs=function(){function e(e){this.name=xe.a.NAME_SPRITE,this.scene=e,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=wt.a?wt.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new r.c,this.scene.onAfterSpritesRenderingObservable=new r.c,this._spritePredicate=function(e){return!!e.actionManager&&e.isPickable&&e.actionManager.hasPointerTriggers}}return e.prototype.register=function(){this.scene._pointerMoveStage.registerStep(xe.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(xe.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(xe.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var e=this.scene.spriteManagers;e.length;)e[0].dispose()},e.prototype._pickSpriteButKeepRay=function(e,t,n,i,r){var o=this.scene.pickSprite(t,n,this._spritePredicate,i,r);return o&&(o.ray=e?e.ray:null),o},e.prototype._pointerMove=function(e,t,n,i,r){var o=this.scene;return i?o.setPointerOverSprite(null):(n=this._pickSpriteButKeepRay(n,e,t,!1,o.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite?(o.setPointerOverSprite(n.pickedSprite),r.style.cursor=o._pointerOverSprite&&o._pointerOverSprite.actionManager&&o._pointerOverSprite.actionManager.hoverCursor?o._pointerOverSprite.actionManager.hoverCursor:o.hoverCursor):o.setPointerOverSprite(null),n},e.prototype._pointerDown=function(e,t,n,i){var r=this.scene;if(r._pickedDownSprite=null,r.spriteManagers.length>0&&(n=r.pickSprite(e,t,this._spritePredicate,!1,r.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(r._pickedDownSprite=n.pickedSprite,i.button){case 0:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnLeftPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,r,i));break;case 1:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnCenterPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,r,i));break;case 2:n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnRightPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,r,i))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickDownTrigger,l.a.CreateNewFromSprite(n.pickedSprite,r,i))}return n},e.prototype._pointerUp=function(e,t,n,i){var r=this.scene;if(r.spriteManagers.length>0){var o=r.pickSprite(e,t,this._spritePredicate,!1,r.cameraToUseForPointers||void 0);o&&(o.hit&&o.pickedSprite&&o.pickedSprite.actionManager&&(o.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickUpTrigger,l.a.CreateNewFromSprite(o.pickedSprite,r,i)),o.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||o.pickedSprite.actionManager.processTrigger(g.a.ACTION_OnPickTrigger,l.a.CreateNewFromSprite(o.pickedSprite,r,i)))),r._pickedDownSprite&&r._pickedDownSprite.actionManager&&r._pickedDownSprite!==o.pickedSprite&&r._pickedDownSprite.actionManager.processTrigger(g.a.ACTION_OnPickOutTrigger,l.a.CreateNewFromSprite(r._pickedDownSprite,r,i)))}return n},e}();zt.a.ShadersStore.spritesPixelShader="uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest)\n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",zt.a.ShadersStore.spritesVertexShader="\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) {\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;\nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0);\n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}";var Gs,zs=function(){function e(e,t,n,i,o,a,s){if(void 0===a&&(a=.01),void 0===s&&(s=Ge.a.TRILINEAR_SAMPLINGMODE),this.name=e,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new r.c,this._vertexBuffers={},o._getComponent(xe.a.NAME_SPRITE)||o._addComponent(new Vs(o)),this._capacity=n,this._spriteTexture=new Ge.a(t,o,!0,!1,s),this._spriteTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,i.width&&i.height)this.cellWidth=i.width,this.cellHeight=i.height;else{if(void 0===i)return;this.cellWidth=i,this.cellHeight=i}this._epsilon=a,this._scene=o,this._scene.spriteManagers.push(this);for(var l=[],c=0,u=0;u<n;u++)l.push(c),l.push(c+1),l.push(c+2),l.push(c),l.push(c+2),l.push(c+3),c+=4;this._indexBuffer=o.getEngine().createIndexBuffer(l),this._vertexData=new Float32Array(16*n*4),this._buffer=new Cn.a(o.getEngine(),this._vertexData,!0,16);var h=this._buffer.createVertexBuffer(Cn.b.PositionKind,0,4),d=this._buffer.createVertexBuffer("options",4,4),f=this._buffer.createVertexBuffer("cellInfo",8,4),p=this._buffer.createVertexBuffer(Cn.b.ColorKind,12,4);this._vertexBuffers[Cn.b.PositionKind]=h,this._vertexBuffers.options=d,this._vertexBuffers.cellInfo=f,this._vertexBuffers[Cn.b.ColorKind]=p,this._effectBase=this._scene.getEngine().createEffect("sprites",[Cn.b.PositionKind,"options","cellInfo",Cn.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[Cn.b.PositionKind,"options","cellInfo",Cn.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._spriteTexture},set:function(e){this._spriteTexture=e},enumerable:!0,configurable:!0}),e.prototype._appendSpriteVertex=function(e,t,n,i,r){var o=16*e;0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._vertexData[o+6]=n,this._vertexData[o+7]=i,this._vertexData[o+8]=t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0;var a=t.cellIndex/r>>0;this._vertexData[o+10]=t.cellIndex-a*r,this._vertexData[o+11]=a,this._vertexData[o+12]=t.color.r,this._vertexData[o+13]=t.color.g,this._vertexData[o+14]=t.color.b,this._vertexData[o+15]=t.color.a},e.prototype.intersects=function(e,t,n,i){for(var r=Math.min(this._capacity,this.sprites.length),a=o.x.Zero(),s=o.x.Zero(),l=Number.MAX_VALUE,c=null,u=o.x.Zero(),h=o.x.Zero(),d=t.getViewMatrix(),f=0;f<r;f++){var p=this.sprites[f];if(p){if(n){if(!n(p))continue}else if(!p.isPickable)continue;if(o.x.TransformCoordinatesToRef(p.position,d,h),a.copyFromFloats(h.x-p.width/2,h.y-p.height/2,h.z),s.copyFromFloats(h.x+p.width/2,h.y+p.height/2,h.z),e.intersectsBoxMinMax(a,s)){var g=o.x.Distance(h,e.origin);if(l>g&&(l=g,c=p,i))break}}}if(c){var m=new Kn.a;d.invertToRef(o.t.Matrix[0]),m.hit=!0,m.pickedSprite=c,m.distance=l;var _=o.t.Vector3[0];return _.copyFrom(e.direction),_.normalize(),_.scaleInPlace(l),e.origin.addToRef(_,u),m.pickedPoint=o.x.TransformCoordinates(u,o.t.Matrix[0]),m}return null},e.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()&&this.sprites.length){for(var e=this._scene.getEngine(),t=this._spriteTexture.getBaseSize(),n=e.getDeltaTime(),i=Math.min(this._capacity,this.sprites.length),r=t.width/this.cellWidth,o=0,a=!0,s=0;s<i;s++){var l=this.sprites[s];l&&l.isVisible&&(a=!1,l._animate(n),this._appendSpriteVertex(o++,l,0,0,r),this._appendSpriteVertex(o++,l,1,0,r),this._appendSpriteVertex(o++,l,1,1,r),this._appendSpriteVertex(o++,l,0,1,r))}if(!a){this._buffer.update(this._vertexData);var c=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==W.a.FOGMODE_NONE&&this.fogEnabled&&(c=this._effectFog),e.enableEffect(c);var u=this._scene.getViewMatrix();c.setTexture("diffuseSampler",this._spriteTexture),c.setMatrix("view",u),c.setMatrix("projection",this._scene.getProjectionMatrix()),c.setFloat2("textureInfos",this.cellWidth/t.width,this.cellHeight/t.height),this._scene.fogEnabled&&this._scene.fogMode!==W.a.FOGMODE_NONE&&this.fogEnabled&&(c.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),c.setColor3("vFogColor",this._scene.fogColor)),e.bindBuffers(this._vertexBuffers,this._indexBuffer,c),e.setDepthFunctionToLessOrEqual(),c.setBool("alphaTest",!0),e.setColorWrite(!1),e.drawElementsType(Pr.a.TriangleFillMode,0,o/4*6),e.setColorWrite(!0),c.setBool("alphaTest",!1),e.setAlphaMode(g.a.ALPHA_COMBINE),e.drawElementsType(Pr.a.TriangleFillMode,0,o/4*6),e.setAlphaMode(g.a.ALPHA_DISABLE)}}},e.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e}(),js=n(94),Hs=n(104);!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(Gs||(Gs={}));var Ws,Xs=function(){function e(e){this.name=e,this._isCompleted=!1,this._taskState=Gs.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(e,t){this._errorObject||(this._errorObject={message:e,exception:t})},e.prototype.run=function(e,t,n){var i=this;this._taskState=Gs.RUNNING,this.runTask(e,function(){i.onDoneCallback(t,n)},function(e,t){i.onErrorCallback(n,e,t)})},e.prototype.runTask=function(e,t,n){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=Gs.INIT},e.prototype.onErrorCallback=function(e,t,n){this._taskState=Gs.ERROR,this._errorObject={message:t,exception:n},this.onError&&this.onError(this,t,n),e()},e.prototype.onDoneCallback=function(e,t){try{this._taskState=Gs.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this.onErrorCallback(t,"Task is done, error executing success callback(s)",e)}},e}(),Ys=function(e,t,n){this.remainingCount=e,this.totalCount=t,this.task=n},Ks=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;return o.name=t,o.meshesNames=n,o.rootUrl=i,o.sceneFilename=r,o}return c.d(t,e),t.prototype.runTask=function(e,t,n){var i=this;fi.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(e,n,r,o){i.loadedMeshes=e,i.loadedParticleSystems=n,i.loadedSkeletons=r,i.loadedAnimationGroups=o,t()},null,function(e,t,i){n(t,i)})},t}(Xs),Qs=function(e){function t(t,n){var i=e.call(this,t)||this;return i.name=t,i.url=n,i}return c.d(t,e),t.prototype.runTask=function(e,t,n){var i=this;e._loadFile(this.url,function(e){i.text=e,t()},void 0,!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},t}(Xs),qs=function(e){function t(t,n){var i=e.call(this,t)||this;return i.name=t,i.url=n,i}return c.d(t,e),t.prototype.runTask=function(e,t,n){var i=this;e._loadFile(this.url,function(e){i.data=e,t()},void 0,!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},t}(Xs),Zs=function(e){function t(t,n){var i=e.call(this,t)||this;return i.name=t,i.url=n,i}return c.d(t,e),t.prototype.runTask=function(e,t,n){var i=this,r=new Image;be.h.SetCorsBehavior(this.url,r),r.onload=function(){i.image=r,t()},r.onerror=function(e){n("Error loading image",e)},r.src=this.url},t}(Xs),Js=function(e){function t(t,n,i,r,o){void 0===o&&(o=Ge.a.TRILINEAR_SAMPLINGMODE);var a=e.call(this,t)||this;return a.name=t,a.url=n,a.noMipmap=i,a.invertY=r,a.samplingMode=o,a}return c.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Ge.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){t()},function(e,t){n(e,t)})},t}(Xs),$s=function(e){function t(t,n,i,r,o){var a=e.call(this,t)||this;return a.name=t,a.url=n,a.extensions=i,a.noMipmap=r,a.files=o,a}return c.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Hi(this.url,e,this.extensions,this.noMipmap,this.files,function(){t()},function(e,t){n(e,t)})},t}(Xs),el=function(e){function t(t,n,i,r,o,a,s){void 0===r&&(r=!1),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=!1);var l=e.call(this,t)||this;return l.name=t,l.url=n,l.size=i,l.noMipmap=r,l.generateHarmonics=o,l.gammaSpace=a,l.reserved=s,l}return c.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Xr(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){t()},function(e,t){n(e,t)})},t}(Xs),tl=function(e){function t(t,n,i,r,o){void 0===r&&(r=!1),void 0===o&&(o=!0);var a=e.call(this,t)||this;return a.name=t,a.url=n,a.size=i,a.noMipmap=r,a.gammaSpace=o,a}return c.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new vo(this.url,e,this.size,this.noMipmap,this.gammaSpace,function(){t()},function(e,t){n(e,t)})},t}(Xs),nl=function(){function e(e){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new r.c,this.onTaskErrorObservable=new r.c,this.onTasksDoneObservable=new r.c,this.onProgressObservable=new r.c,this.useDefaultLoadingScreen=!0,this._scene=e}return e.prototype.addMeshTask=function(e,t,n,i){var r=new Ks(e,t,n,i);return this._tasks.push(r),r},e.prototype.addTextFileTask=function(e,t){var n=new Qs(e,t);return this._tasks.push(n),n},e.prototype.addBinaryFileTask=function(e,t){var n=new qs(e,t);return this._tasks.push(n),n},e.prototype.addImageTask=function(e,t){var n=new Zs(e,t);return this._tasks.push(n),n},e.prototype.addTextureTask=function(e,t,n,i,r){void 0===r&&(r=Ge.a.TRILINEAR_SAMPLINGMODE);var o=new Js(e,t,n,i,r);return this._tasks.push(o),o},e.prototype.addCubeTextureTask=function(e,t,n,i,r){var o=new $s(e,t,n,i,r);return this._tasks.push(o),o},e.prototype.addHDRCubeTextureTask=function(e,t,n,i,r,o,a){void 0===i&&(i=!1),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===a&&(a=!1);var s=new el(e,t,n,i,r,o,a);return this._tasks.push(s),s},e.prototype.addEquiRectangularCubeTextureAssetTask=function(e,t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var o=new tl(e,t,n,i,r);return this._tasks.push(o),o},e.prototype.removeTask=function(e){var t=this._tasks.indexOf(e);t>-1&&this._tasks.splice(t,1)},e.prototype._decreaseWaitingTasksCount=function(e){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,e),this.onProgressObservable.notifyObservers(new Ys(this._waitingTasksCount,this._totalTasksCount,e))}catch(e){p.a.Error("Error running progress callbacks."),console.log(e)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var t=this._tasks.slice(),n=0,i=t;n<i.length;n++)if((e=i[n]).taskState===Gs.DONE){var r=this._tasks.indexOf(e);r>-1&&this._tasks.splice(r,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(e){p.a.Error("Error running tasks-done callbacks."),console.log(e)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(e){var t=this,n=function(n,i){e._setErrorObject(n,i),t.onTaskError&&t.onTaskError(e),t.onTaskErrorObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)};e.run(this._scene,function(){try{t.onTaskSuccess&&t.onTaskSuccess(e),t.onTaskSuccessObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)}catch(e){n("Error executing task success callbacks",e)}},n)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];t.taskState===Gs.INIT&&this._runTask(t)}return this},e.prototype.loadAsync=function(){var e=this;return new Promise(function(t,n){e.onTasksDoneObservable.addOnce(function(e){e&&e.length?n(e):t()})})},e}(),il=function(){function e(){var e=this;this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}(),rl=function(){function e(e,t){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=o.x.Zero(),this._newPosition=o.x.Zero(),this._centerPosition=o.x.Zero(),this._meshes=e.slice(),t?this._centerMesh=t:this._setCenterMesh();var n=this._meshes.indexOf(this._centerMesh);n>=0&&this._meshes.splice(n,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var i=0;i<this._meshes.length;i++)if(this._meshes[i]){var r=this._meshes[i];this._meshesOrigins[i]=r.getAbsolutePosition().clone(),this._toCenterVectors[i]=o.x.Zero(),r._boundingInfo&&this._centerMesh._boundingInfo&&r._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[i])}}return e.prototype._setCenterMesh=function(){for(var e=o.x.Zero(),t=o.x.Zero(),n=Number.MAX_VALUE,i=0;i<this._meshes.length;i++)this._meshes[i]&&(a=(r=this._meshes[i]).getBoundingInfo())&&t.addInPlace(a.boundingBox.centerWorld);for(e=t.scale(1/this._meshes.length),i=0;i<this._meshes.length;i++){var r,a;if(this._meshes[i]&&(a=(r=this._meshes[i]).getBoundingInfo())){var s=a.boundingBox.centerWorld.subtract(e).lengthSquared();s<n&&(this._centerMesh=r,n=s)}}},e.prototype.getClassName=function(){return"MeshExploder"},e.prototype.getMeshes=function(){var e=this._meshes.slice();return e.unshift(this._centerMesh),e},e.prototype.explode=function(e){void 0===e&&(e=1);for(var t=0;t<this._meshes.length;t++)this._meshes[t]&&this._meshesOrigins[t]&&this._toCenterVectors[t]&&(this._toCenterVectors[t].scaleToRef(e,this._scaledDirection),this._meshesOrigins[t].addToRef(this._scaledDirection,this._newPosition),this._meshes[t].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},e}(),ol=function(){function e(e,t,n,i,r,o,a,s,l){this.onProcessFileCallback=function(){return!0},this._engine=e,this._currentScene=t,this._sceneLoadedCallback=n,this._progressCallback=i,this._additionalRenderLoopLogicCallback=r,this._textureLoadingCallback=o,this._startingProcessingFilesCallback=a,this._onReloadCallback=s,this._errorCallback=l}return Object.defineProperty(e,"FilesToLoad",{get:function(){return ui.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._dragEnterHandler=function(e){t.drag(e)},this._dragOverHandler=function(e){t.drag(e)},this._dropHandler=function(e){t.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},e.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},e.prototype._traverseFolder=function(e,t,n,i){var r=this,o=e.createReader(),a=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");o.readEntries(function(e){n.count+=e.length;for(var o=0,s=e;o<s.length;o++){var l=s[o];l.isFile?l.file(function(e){e.correctName=a+e.name,t.push(e),0==--n.count&&i()}):l.isDirectory&&r._traverseFolder(l,t,n,i)}--n.count&&i()})},e.prototype._processFiles=function(t){for(var n=0;n<t.length;n++){var i=t[n].correctName.toLowerCase(),r=i.split(".").pop();this.onProcessFileCallback(t[n],i,r)&&("babylon"!==r&&"stl"!==r&&"obj"!==r&&"gltf"!==r&&"glb"!==r||-1!==i.indexOf(".binary.babylon")||-1!==i.indexOf(".incremental.babylon")||(this._sceneFileToLoad=t[n]),e.FilesToLoad[i]=t[n])}},e.prototype.loadFiles=function(e){var t=this;if(e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var n=new Array,i=[],r=e.dataTransfer?e.dataTransfer.items:null,o=0;o<this._filesToLoad.length;o++){var a=this._filesToLoad[o],s=a.name.toLowerCase(),l=void 0;if(a.correctName=s,r){var c=r[o];c.getAsEntry?l=c.getAsEntry():c.webkitGetAsEntry&&(l=c.webkitGetAsEntry())}l&&l.isDirectory?i.push(l):n.push(a)}if(0===i.length)this._processFiles(n),this._processReload();else for(var u={count:i.length},h=0,d=i;h<d.length;h++)this._traverseFolder(d[h],n,u,function(){t._processFiles(n),0===u.count&&t._processReload()})}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var e=this;this._sceneFileToLoad?(this._currentScene&&(p.a.errorsCount>0&&p.a.ClearLogCache(),this._engine.stopRenderLoop()),fi.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(t){e._progressCallback&&e._progressCallback(t)}).then(function(t){e._currentScene&&e._currentScene.dispose(),e._currentScene=t,e._sceneLoadedCallback&&e._sceneLoadedCallback(e._sceneFileToLoad,e._currentScene),e._currentScene.executeWhenReady(function(){e._engine.runRenderLoop(function(){e.renderFunction()})})}).catch(function(t){e._errorCallback&&e._errorCallback(e._sceneFileToLoad,e._currentScene,t.message)})):p.a.Error("Please provide a valid .babylon file.")},e}(),al=n(105),sl=n(106),ll=function(){function e(e){void 0===e&&(e=0),this.priority=e}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(e,t){return!0},e}(),cl=function(e){function t(t,n,i){void 0===t&&(t=0),void 0===n&&(n=1024),void 0===i&&(i=.5);var r=e.call(this,t)||this;return r.priority=t,r.maximumSize=n,r.step=i,r}return c.d(t,e),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,t){for(var n=!0,i=0;i<e.textures.length;i++){var r=e.textures[i];if(r.canRescale&&!r.getContext){var o=r.getSize();Math.max(o.width,o.height)>this.maximumSize&&(r.scale(this.step),n=!1)}}return n},t}(ll),ul=function(e){function t(t,n,i){void 0===t&&(t=0),void 0===n&&(n=2),void 0===i&&(i=.25);var r=e.call(this,t)||this;return r.priority=t,r.maximumScale=n,r.step=i,r._currentScale=-1,r._directionOffset=1,r}return c.d(t,e),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,t){return-1===this._currentScale&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(ll),hl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,t){return e.shadowsEnabled=t.isInImprovementMode,!0},t}(ll),dl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,t){return e.postProcessesEnabled=t.isInImprovementMode,!0},t}(ll),fl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,t){return e.lensFlaresEnabled=t.isInImprovementMode,!0},t}(ll),pl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,t){return!this.onApply||this.onApply(e,t)},t}(ll),gl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,t){return e.particlesEnabled=t.isInImprovementMode,!0},t}(ll),ml=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c.d(t,e),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,t){return e.renderTargetsEnabled=t.isInImprovementMode,!0},t}(ll),_l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._canBeMerged=function(e){if(!(e instanceof fe.a))return!1;var t=e;return!(t.isDisposed()||!t.isVisible||!t.isEnabled()||t.instances.length>0||t.skeleton||t.hasLODLevels)},t}return c.d(t,e),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(e){t._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(e,n,i){for(var r=e.meshes.slice(0),o=r.length,a=0;a<o;a++){var s=new Array,l=r[a];if(this._canBeMerged(l)){s.push(l);for(var c=a+1;c<o;c++){var u=r[c];this._canBeMerged(u)&&u.material===l.material&&u.checkCollisions===l.checkCollisions&&(s.push(u),o--,r.splice(c,1),c--)}s.length<2||fe.a.MergeMeshes(s,void 0,!0)}}var h=e;return h.createOrUpdateSelectionOctree&&(null!=i?i&&h.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&h.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(ll),vl=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.prototype.addOptimization=function(e){return this.optimizations.push(e),this},e.prototype.addCustomOptimization=function(e,t,n){void 0===n&&(n=0);var i=new pl(n);return i.onApply=e,i.onGetDescription=t,this.optimizations.push(i),this},e.LowDegradationAllowed=function(t){var n=new e(t),i=0;return n.addOptimization(new _l(i)),n.addOptimization(new hl(i)),n.addOptimization(new fl(i)),n.addOptimization(new dl(++i)),n.addOptimization(new gl(i)),n.addOptimization(new cl(++i,1024)),n},e.ModerateDegradationAllowed=function(t){var n=new e(t),i=0;return n.addOptimization(new _l(i)),n.addOptimization(new hl(i)),n.addOptimization(new fl(i)),n.addOptimization(new dl(++i)),n.addOptimization(new gl(i)),n.addOptimization(new cl(++i,512)),n.addOptimization(new ml(++i)),n.addOptimization(new ul(++i,2)),n},e.HighDegradationAllowed=function(t){var n=new e(t),i=0;return n.addOptimization(new _l(i)),n.addOptimization(new hl(i)),n.addOptimization(new fl(i)),n.addOptimization(new dl(++i)),n.addOptimization(new gl(i)),n.addOptimization(new cl(++i,256)),n.addOptimization(new ml(++i)),n.addOptimization(new ul(++i,4)),n},e}(),bl=function(){function e(e,t,n,i){var o=this;if(void 0===n&&(n=!0),void 0===i&&(i=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new r.c,this.onNewOptimizationAppliedObservable=new r.c,this.onFailureObservable=new r.c,this._options=t||new vl,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),n)for(var a=0,s=0,l=this._options.optimizations;s<l.length;s++)l[s].priority=a++;this._improvementMode=i,this._scene=e||A.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){o._sceneDisposeObserver=null,o.dispose()})}return Object.defineProperty(e.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(e){this._trackerDuration=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isRunning=!1},e.prototype.reset=function(){this._currentPriorityLevel=0},e.prototype.start=function(){var e=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){e._checkCurrentState()},e._trackerDuration)}))},e.prototype._checkCurrentState=function(){var e=this;if(this._isRunning){var t=this._scene,n=this._options;if(this._currentFrameRate=Math.round(t.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var i=!0,r=!0,o=0;o<n.optimizations.length;o++){var a=n.optimizations[o];a.priority===this._currentPriorityLevel&&(r=!1,i=i&&a.apply(t,this),this.onNewOptimizationAppliedObservable.notifyObservers(a))}if(r)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);i&&this._currentPriorityLevel++,t.executeWhenReady(function(){setTimeout(function(){e._checkCurrentState()},e._trackerDuration)})}},e.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},e.OptimizeAsync=function(t,n,i,r){var o=new e(t,n||vl.ModerateDegradationAllowed(),!1);return i&&o.onSuccessObservable.add(function(){i()}),r&&o.onFailureObservable.add(function(){r()}),o.start(),o},e}(),yl=[],Tl=function(e,t){yl[e.id]||e.doNotSerialize||(t.vertexData.push(e.serializeVerticeData()),yl[e.id]=!0)},El=function(e,t){var n={},i=e._geometry;return i&&(e.getScene().getGeometryByID(i.id)||Tl(i,t.geometries)),e.serialize&&e.serialize(n),n},xl=function(){function e(){}return e.ClearCache=function(){yl=[]},e.Serialize=function(t){var n,i,r,o={};if(e.ClearCache(),o.useDelayedTextureLoading=t.useDelayedTextureLoading,o.autoClear=t.autoClear,o.clearColor=t.clearColor.asArray(),o.ambientColor=t.ambientColor.asArray(),o.gravity=t.gravity.asArray(),o.collisionsEnabled=t.collisionsEnabled,t.fogMode&&0!==t.fogMode&&(o.fogMode=t.fogMode,o.fogColor=t.fogColor.asArray(),o.fogStart=t.fogStart,o.fogEnd=t.fogEnd,o.fogDensity=t.fogDensity),t.isPhysicsEnabled()){var a=t.getPhysicsEngine();a&&(o.physicsEnabled=!0,o.physicsGravity=a.gravity.asArray(),o.physicsEngine=a.getPhysicsPluginName())}t.metadata&&(o.metadata=t.metadata),o.morphTargetManagers=[];for(var s=0,l=t.meshes;s<l.length;s++){var c=(p=l[s]).morphTargetManager;c&&o.morphTargetManagers.push(c.serialize())}for(o.lights=[],n=0;n<t.lights.length;n++)(i=t.lights[n]).doNotSerialize||o.lights.push(i.serialize());for(o.cameras=[],n=0;n<t.cameras.length;n++){var u=t.cameras[n];u.doNotSerialize||o.cameras.push(u.serialize())}if(t.activeCamera&&(o.activeCameraID=t.activeCamera.id),D.a.AppendSerializedAnimations(t,o),t.reflectionProbes&&t.reflectionProbes.length>0)for(o.reflectionProbes=[],n=0;n<t.reflectionProbes.length;n++)o.reflectionProbes.push(t.reflectionProbes[n].serialize());for(o.materials=[],o.multiMaterials=[],n=0;n<t.materials.length;n++)(r=t.materials[n]).doNotSerialize||o.materials.push(r.serialize());for(o.multiMaterials=[],n=0;n<t.multiMaterials.length;n++)o.multiMaterials.push(t.multiMaterials[n].serialize());for(t.environmentTexture&&(o.environmentTexture=t.environmentTexture.name),o.skeletons=[],n=0;n<t.skeletons.length;n++){var h=t.skeletons[n];h.doNotSerialize||o.skeletons.push(h.serialize())}for(o.transformNodes=[],n=0;n<t.transformNodes.length;n++)o.transformNodes.push(t.transformNodes[n].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],yl=[];var d=t.getGeometries();for(n=0;n<d.length;n++){var f=d[n];f.isReady()&&Tl(f,o.geometries)}for(o.meshes=[],n=0;n<t.meshes.length;n++){var p;(p=t.meshes[n])instanceof fe.a&&(p.doNotSerialize||p.delayLoadState!==g.a.DELAYLOADSTATE_LOADED&&p.delayLoadState!==g.a.DELAYLOADSTATE_NONE||o.meshes.push(El(p,o)))}for(o.particleSystems=[],n=0;n<t.particleSystems.length;n++)o.particleSystems.push(t.particleSystems[n].serialize());t.actionManager&&(o.actions=t.actionManager.serialize("scene"));for(var m=0,_=t._serializableComponents;m<_.length;m++)_[m].serialize(o);return o},e.SerializeMesh=function(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var r={};if(e.ClearCache(),t=t instanceof Array?t:[t],n||i)for(var o=0;o<t.length;++o)i&&t[o].getDescendants().forEach(function(e){e instanceof fe.a&&t.indexOf(e)<0&&t.push(e)}),n&&t[o].parent&&t.indexOf(t[o].parent)<0&&t.push(t[o].parent);return t.forEach(function(e){!function(e,t){if(e.delayLoadState===g.a.DELAYLOADSTATE_LOADED||e.delayLoadState===g.a.DELAYLOADSTATE_NONE){if(e.material)if(e.material instanceof jr.a){if(t.multiMaterials=t.multiMaterials||[],t.materials=t.materials||[],!t.multiMaterials.some(function(t){return t.id===e.material.id})){t.multiMaterials.push(e.material.serialize());for(var n=function(e){e&&(t.materials.some(function(t){return t.id===e.id})||t.materials.push(e.serialize()))},i=0,r=e.material.subMaterials;i<r.length;i++)n(r[i])}}else t.materials=t.materials||[],t.materials.some(function(t){return t.id===e.material.id})||t.materials.push(e.material.serialize());var o=e._geometry;o&&(t.geometries||(t.geometries={},t.geometries.boxes=[],t.geometries.spheres=[],t.geometries.cylinders=[],t.geometries.toruses=[],t.geometries.grounds=[],t.geometries.planes=[],t.geometries.torusKnots=[],t.geometries.vertexData=[]),Tl(o,t.geometries)),e.skeleton&&(t.skeletons=t.skeletons||[],t.skeletons.push(e.skeleton.serialize())),t.meshes=t.meshes||[],t.meshes.push(El(e,t))}}(e,r)}),r},e}(),Cl=n(29),Sl=function(){function e(){}return e.CreateResizedCopy=function(e,t,n,i){void 0===i&&(i=!0);var r=e.getScene(),o=r.getEngine(),a=new cn("resized"+e.name,{width:t,height:n},r,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);a.wrapU=e.wrapU,a.wrapV=e.wrapV,a.uOffset=e.uOffset,a.vOffset=e.vOffset,a.uScale=e.uScale,a.vScale=e.vScale,a.uAng=e.uAng,a.vAng=e.vAng,a.wAng=e.wAng,a.coordinatesIndex=e.coordinatesIndex,a.level=e.level,a.anisotropicFilteringLevel=e.anisotropicFilteringLevel,a._texture.isReady=!1,e.wrapU=Ge.a.CLAMP_ADDRESSMODE,e.wrapV=Ge.a.CLAMP_ADDRESSMODE;var s=new Ht("pass",1,null,i?Ge.a.BILINEAR_SAMPLINGMODE:Ge.a.NEAREST_SAMPLINGMODE,o,!1,g.a.TEXTURETYPE_UNSIGNED_INT);return s.getEffect().executeWhenCompiled(function(){s.onApply=function(t){t.setTexture("textureSampler",e)};var t=a.getInternalTexture();t&&(r.postProcessManager.directRender([s],t),o.unBindFramebuffer(t),a.disposeFramebufferObjects(),s.dispose(),t.isReady=!0)}),a},e}(),Al=function(){function e(t,n){if(void 0===n&&(n=null),!e.IsSupported(t))throw"Your browser does not support recording so far.";var i=t.getRenderingCanvas();if(!i)throw"The babylon engine must have a canvas to be recorded";this._canvas=i,this._canvas.isRecording=!1,this._options=c.a({},e._defaultOptions,n);var r=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var o=0,a=this._options.audioTracks;o<a.length;o++)r.addTrack(a[o]);this._mediaRecorder=new MediaRecorder(r,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return e.IsSupported=function(e){var t=e.getRenderingCanvas();return!!t&&"function"==typeof t.captureStream},Object.defineProperty(e.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),e.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},e.prototype.startRecording=function(e,t){var n=this;if(void 0===e&&(e="babylonjs.webm"),void 0===t&&(t=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return t>0&&setTimeout(function(){n.stopRecording()},1e3*t),this._fileName=e,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(e,t){n._resolve=e,n._reject=t})},e.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},e.prototype._handleDataAvailable=function(e){e.data.size>0&&this._recordedChunks.push(e.data)},e.prototype._handleError=function(e){if(this.stopRecording(),!this._reject)throw new e.error;this._reject(e.error)},e.prototype._handleStop=function(){this.stopRecording();var e=new Blob(this._recordedChunks);this._resolve&&this._resolve(e),window.URL.createObjectURL(e),this._fileName&&be.h.Download(e,this._fileName)},e._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},e}(),Pl=function(){function e(){}return e.CreateScreenshot=function(e,t,n,i,r){var o,a;if(void 0===r&&(r="image/png"),n.precision)o=Math.round(e.getRenderWidth()*n.precision),a=Math.round(o/e.getAspectRatio(t));else if(n.width&&n.height)o=n.width,a=n.height;else if(n.width&&!n.height)o=n.width,a=Math.round(o/e.getAspectRatio(t));else if(n.height&&!n.width)a=n.height,o=Math.round(a*e.getAspectRatio(t));else{if(isNaN(n))return void p.a.Error("Invalid 'size' parameter !");a=n,o=n}be.h._ScreenshotCanvas||(be.h._ScreenshotCanvas=document.createElement("canvas")),be.h._ScreenshotCanvas.width=o,be.h._ScreenshotCanvas.height=a;var s=be.h._ScreenshotCanvas.getContext("2d"),l=e.getRenderWidth()/e.getRenderHeight(),c=o,u=c/l;u>a&&(c=(u=a)*l);var h=Math.max(0,o-c)/2,d=Math.max(0,a-u)/2,f=e.getRenderingCanvas();s&&f&&s.drawImage(f,h,d,c,u),be.h.EncodeScreenshotCanvasData(i,r)},e.CreateScreenshotUsingRenderTarget=function(e,t,n,i,r,o,a,s){var l,c;if(void 0===r&&(r="image/png"),void 0===o&&(o=1),void 0===a&&(a=!1),n.precision)l=Math.round(e.getRenderWidth()*n.precision),c=Math.round(l/e.getAspectRatio(t)),n={width:l,height:c};else if(n.width&&n.height)l=n.width,c=n.height;else if(n.width&&!n.height)l=n.width,c=Math.round(l/e.getAspectRatio(t)),n={width:l,height:c};else if(n.height&&!n.width)c=n.height,n={width:l=Math.round(c*e.getAspectRatio(t)),height:c};else{if(isNaN(n))return void p.a.Error("Invalid 'size' parameter !");c=n,l=n}var u=t.getScene(),h=null;u.activeCamera!==t&&(h=u.activeCamera,u.activeCamera=t);var d=e.getRenderingCanvas();if(d){var f={width:d.width,height:d.height};e.setSize(l,c),u.render();var m=new cn("screenShot",n,u,!1,!1,g.a.TEXTURETYPE_UNSIGNED_INT,!1,Ge.a.NEAREST_SAMPLINGMODE);m.renderList=null,m.samples=o,a&&m.addPostProcess(new ds("antialiasing",1,u.activeCamera)),m.onAfterRenderObservable.add(function(){be.h.DumpFramebuffer(l,c,e,i,r,s)}),u.incrementRenderId(),u.resetCachedMaterial(),m.render(!0),m.dispose(),h&&(u.activeCamera=h),e.setSize(f.width,f.height),t.getProjectionMatrix(!0)}else p.a.Error("No rendering canvas found !")},e}();be.h.CreateScreenshot=Pl.CreateScreenshot,be.h.CreateScreenshotUsingRenderTarget=Pl.CreateScreenshotUsingRenderTarget,function(e){e[e.Checkbox=0]="Checkbox",e[e.Slider=1]="Slider",e[e.Vector3=2]="Vector3",e[e.Quaternion=3]="Quaternion",e[e.Color3=4]="Color3"}(Ws||(Ws={})),n.d(t,"AbstractScene",function(){return i.a}),n.d(t,"Action",function(){return s}),n.d(t,"ActionEvent",function(){return l.a}),n.d(t,"ActionManager",function(){return R}),n.d(t,"Condition",function(){return u}),n.d(t,"ValueCondition",function(){return h}),n.d(t,"PredicateCondition",function(){return d}),n.d(t,"StateCondition",function(){return f}),n.d(t,"SwitchBooleanAction",function(){return m}),n.d(t,"SetStateAction",function(){return _}),n.d(t,"SetValueAction",function(){return v}),n.d(t,"IncrementValueAction",function(){return b}),n.d(t,"PlayAnimationAction",function(){return y}),n.d(t,"StopAnimationAction",function(){return T}),n.d(t,"DoNothingAction",function(){return E}),n.d(t,"CombineAction",function(){return x}),n.d(t,"ExecuteCodeAction",function(){return C}),n.d(t,"SetParentAction",function(){return S}),n.d(t,"PlaySoundAction",function(){return M}),n.d(t,"StopSoundAction",function(){return O}),n.d(t,"InterpolateValueAction",function(){return B}),n.d(t,"Animatable",function(){return Q}),n.d(t,"_IAnimationState",function(){return N}),n.d(t,"Animation",function(){return F}),n.d(t,"TargetedAnimation",function(){return q}),n.d(t,"AnimationGroup",function(){return Z}),n.d(t,"AnimationPropertiesOverride",function(){return J}),n.d(t,"EasingFunction",function(){return $}),n.d(t,"CircleEase",function(){return ee}),n.d(t,"BackEase",function(){return te}),n.d(t,"BounceEase",function(){return ne}),n.d(t,"CubicEase",function(){return ie}),n.d(t,"ElasticEase",function(){return re}),n.d(t,"ExponentialEase",function(){return oe}),n.d(t,"PowerEase",function(){return ae}),n.d(t,"QuadraticEase",function(){return se}),n.d(t,"QuarticEase",function(){return le}),n.d(t,"QuinticEase",function(){return ce}),n.d(t,"SineEase",function(){return ue}),n.d(t,"BezierCurveEase",function(){return he}),n.d(t,"RuntimeAnimation",function(){return H}),n.d(t,"AnimationEvent",function(){return de}),n.d(t,"AnimationKeyInterpolation",function(){return w}),n.d(t,"AnimationRange",function(){return L}),n.d(t,"KeepAssets",function(){return pe}),n.d(t,"AssetContainer",function(){return ge}),n.d(t,"Analyser",function(){return _e}),n.d(t,"AudioEngine",function(){return ve}),n.d(t,"AudioSceneComponent",function(){return Ce}),n.d(t,"Sound",function(){return Te}),n.d(t,"SoundTrack",function(){return Ee}),n.d(t,"WeightedSound",function(){return Se}),n.d(t,"AutoRotationBehavior",function(){return Pe}),n.d(t,"BouncingBehavior",function(){return Re}),n.d(t,"FramingBehavior",function(){return Me}),n.d(t,"AttachToBoxBehavior",function(){return we}),n.d(t,"FadeInOutBehavior",function(){return Ie}),n.d(t,"MultiPointerScaleBehavior",function(){return Le}),n.d(t,"PointerDragBehavior",function(){return De.a}),n.d(t,"SixDofDragBehavior",function(){return Be}),n.d(t,"Bone",function(){return K}),n.d(t,"BoneIKController",function(){return Ue}),n.d(t,"BoneLookController",function(){return Ve}),n.d(t,"Skeleton",function(){return He}),n.d(t,"CameraInputTypes",function(){return We}),n.d(t,"CameraInputsManager",function(){return Xe}),n.d(t,"Camera",function(){return Ne.a}),n.d(t,"TargetCamera",function(){return bt}),n.d(t,"FreeCamera",function(){return yt}),n.d(t,"FreeCameraInputsManager",function(){return dt}),n.d(t,"TouchCamera",function(){return Tt}),n.d(t,"ArcRotateCamera",function(){return Et}),n.d(t,"ArcRotateCameraInputsManager",function(){return nt}),n.d(t,"DeviceOrientationCamera",function(){return xt}),n.d(t,"FlyCamera",function(){return St}),n.d(t,"FlyCameraInputsManager",function(){return Ct}),n.d(t,"FollowCamera",function(){return Rt}),n.d(t,"ArcFollowCamera",function(){return Mt}),n.d(t,"GamepadCamera",function(){return Vt}),n.d(t,"UniversalCamera",function(){return Ut}),n.d(t,"VirtualJoysticksCamera",function(){return nn}),n.d(t,"ArcRotateCameraGamepadInput",function(){return qe}),n.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return Je}),n.d(t,"ArcRotateCameraMouseWheelInput",function(){return $e}),n.d(t,"ArcRotateCameraPointersInput",function(){return tt}),n.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return it}),n.d(t,"FlyCameraKeyboardInput",function(){return rt}),n.d(t,"FlyCameraMouseInput",function(){return ot}),n.d(t,"FollowCameraKeyboardMoveInput",function(){return at}),n.d(t,"FollowCameraMouseWheelInput",function(){return st}),n.d(t,"FollowCameraPointersInput",function(){return lt}),n.d(t,"FreeCameraDeviceOrientationInput",function(){return ft}),n.d(t,"FreeCameraGamepadInput",function(){return pt}),n.d(t,"FreeCameraKeyboardMoveInput",function(){return ct}),n.d(t,"FreeCameraMouseInput",function(){return ut}),n.d(t,"FreeCameraTouchInput",function(){return ht}),n.d(t,"FreeCameraVirtualJoystickInput",function(){return vt}),n.d(t,"AnaglyphArcRotateCamera",function(){return Yt}),n.d(t,"AnaglyphFreeCamera",function(){return Kt}),n.d(t,"AnaglyphGamepadCamera",function(){return Qt}),n.d(t,"AnaglyphUniversalCamera",function(){return qt}),n.d(t,"StereoscopicArcRotateCamera",function(){return Jt}),n.d(t,"StereoscopicFreeCamera",function(){return $t}),n.d(t,"StereoscopicGamepadCamera",function(){return en}),n.d(t,"StereoscopicUniversalCamera",function(){return tn}),n.d(t,"VRCameraMetrics",function(){return rn}),n.d(t,"VRDeviceOrientationArcRotateCamera",function(){return dn}),n.d(t,"VRDeviceOrientationFreeCamera",function(){return fn}),n.d(t,"VRDeviceOrientationGamepadCamera",function(){return pn}),n.d(t,"OnAfterEnteringVRObservableEvent",function(){return Dn}),n.d(t,"VRExperienceHelper",function(){return Ln}),n.d(t,"WebVRFreeCamera",function(){return mn}),n.d(t,"WebXRCamera",function(){return kn}),n.d(t,"WebXREnterExitUIButton",function(){return Un}),n.d(t,"WebXREnterExitUIOptions",function(){return Vn}),n.d(t,"WebXREnterExitUI",function(){return Gn}),n.d(t,"WebXRState",function(){return Pn}),n.d(t,"WebXRExperienceHelper",function(){return Bn}),n.d(t,"WebXRController",function(){return zn}),n.d(t,"WebXRInput",function(){return jn}),n.d(t,"WebXRManagedOutputCanvas",function(){return Hn}),n.d(t,"WebXRSessionManager",function(){return Nn}),n.d(t,"Collider",function(){return Xn}),n.d(t,"DefaultCollisionCoordinator",function(){return Yn}),n.d(t,"PickingInfo",function(){return Kn.a}),n.d(t,"IntersectionInfo",function(){return Qn.a}),n.d(t,"_MeshCollisionData",function(){return qn.a}),n.d(t,"BoundingBox",function(){return Zn.a}),n.d(t,"BoundingInfo",function(){return Jn.a}),n.d(t,"BoundingSphere",function(){return $n.a}),n.d(t,"Ray",function(){return wt.a}),n.d(t,"Octree",function(){return ti}),n.d(t,"OctreeBlock",function(){return ei}),n.d(t,"OctreeSceneComponent",function(){return ni}),n.d(t,"AxesViewer",function(){return ii.AxesViewer}),n.d(t,"BoneAxesViewer",function(){return ii.BoneAxesViewer}),n.d(t,"DebugLayer",function(){return ii.DebugLayer}),n.d(t,"PhysicsViewer",function(){return ii.PhysicsViewer}),n.d(t,"RayHelper",function(){return ii.RayHelper}),n.d(t,"SkeletonViewer",function(){return ii.SkeletonViewer}),n.d(t,"Constants",function(){return g.a}),n.d(t,"InstancingAttributeInfo",function(){return me.d}),n.d(t,"DepthTextureCreationOptions",function(){return me.a}),n.d(t,"EngineCapabilities",function(){return me.c}),n.d(t,"Engine",function(){return me.b}),n.d(t,"EngineStore",function(){return A.a}),n.d(t,"NullEngineOptions",function(){return ri.b}),n.d(t,"NullEngine",function(){return ri.a}),n.d(t,"WebGLPipelineContext",function(){return si.a}),n.d(t,"_OcclusionDataStorage",function(){return ai}),n.d(t,"_forceTransformFeedbackToBundle",function(){return!0}),n.d(t,"KeyboardEventTypes",function(){return Ze.a}),n.d(t,"KeyboardInfo",function(){return Ze.b}),n.d(t,"KeyboardInfoPre",function(){return Ze.c}),n.d(t,"PointerEventTypes",function(){return Ae.a}),n.d(t,"PointerInfoBase",function(){return Ae.c}),n.d(t,"PointerInfoPre",function(){return Ae.d}),n.d(t,"PointerInfo",function(){return Ae.b}),n.d(t,"ClipboardEventTypes",function(){return li}),n.d(t,"ClipboardInfo",function(){return ci}),n.d(t,"DaydreamController",function(){return pi}),n.d(t,"GearVRController",function(){return gi}),n.d(t,"GenericController",function(){return mi}),n.d(t,"OculusTouchController",function(){return _i}),n.d(t,"PoseEnabledControllerType",function(){return Pt}),n.d(t,"PoseEnabledControllerHelper",function(){return Lt}),n.d(t,"PoseEnabledController",function(){return kt}),n.d(t,"ViveController",function(){return vi}),n.d(t,"WebVRController",function(){return _n}),n.d(t,"WindowsMotionController",function(){return yi}),n.d(t,"StickValues",function(){return Ye}),n.d(t,"Gamepad",function(){return Ke}),n.d(t,"GenericPad",function(){return Qe}),n.d(t,"GamepadManager",function(){return Ft}),n.d(t,"GamepadSystemSceneComponent",function(){return Bt}),n.d(t,"Xbox360Button",function(){return It}),n.d(t,"Xbox360Dpad",function(){return Dt}),n.d(t,"Xbox360Pad",function(){return Nt}),n.d(t,"AxisDragGizmo",function(){return Ti.a}),n.d(t,"AxisScaleGizmo",function(){return Si}),n.d(t,"BoundingBoxGizmo",function(){return Ri}),n.d(t,"Gizmo",function(){return xi.a}),n.d(t,"GizmoManager",function(){return Li}),n.d(t,"PlaneRotationGizmo",function(){return Mi}),n.d(t,"PositionGizmo",function(){return wi}),n.d(t,"RotationGizmo",function(){return Oi}),n.d(t,"ScaleGizmo",function(){return Di}),n.d(t,"LightGizmo",function(){return Vi}),n.d(t,"EnvironmentHelper",function(){return Ji}),n.d(t,"PhotoDome",function(){return er}),n.d(t,"_forceSceneHelpersToBundle",function(){return!0}),n.d(t,"VideoDome",function(){return Cr}),n.d(t,"EngineInstrumentation",function(){return Sr}),n.d(t,"SceneInstrumentation",function(){return Ar}),n.d(t,"_TimeToken",function(){return oi}),n.d(t,"EffectLayer",function(){return Rr}),n.d(t,"EffectLayerSceneComponent",function(){return Mr}),n.d(t,"GlowLayer",function(){return Or}),n.d(t,"HighlightLayer",function(){return Ir}),n.d(t,"Layer",function(){return Lr}),n.d(t,"LayerSceneComponent",function(){return Dr}),n.d(t,"LensFlare",function(){return kr}),n.d(t,"LensFlareSystem",function(){return Nr}),n.d(t,"LensFlareSystemSceneComponent",function(){return Fr}),n.d(t,"Light",function(){return ki.a}),n.d(t,"ShadowLight",function(){return Ni}),n.d(t,"DirectionalLight",function(){return Fi}),n.d(t,"HemisphericLight",function(){return gn.a}),n.d(t,"PointLight",function(){return Vr}),n.d(t,"SpotLight",function(){return Ui}),n.d(t,"ShadowGenerator",function(){return Br}),n.d(t,"ShadowGeneratorSceneComponent",function(){return Ur}),n.d(t,"DefaultLoadingScreen",function(){return Gr}),n.d(t,"SceneLoaderProgressEvent",function(){return di}),n.d(t,"SceneLoader",function(){return fi}),n.d(t,"SceneLoaderFlags",function(){return hi.a}),n.d(t,"_BabylonLoaderRegistered",function(){return!0}),n.d(t,"ColorCurves",function(){return uo.a}),n.d(t,"EffectFallbacks",function(){return zt.c}),n.d(t,"EffectCreationOptions",function(){return zt.b}),n.d(t,"Effect",function(){return zt.a}),n.d(t,"FresnelParameters",function(){return ho}),n.d(t,"ImageProcessingConfigurationDefines",function(){return vn.b}),n.d(t,"ImageProcessingConfiguration",function(){return vn.a}),n.d(t,"Material",function(){return Pr.a}),n.d(t,"MaterialDefines",function(){return Xi.a}),n.d(t,"MaterialHelper",function(){return Wi.a}),n.d(t,"MultiMaterial",function(){return jr.a}),n.d(t,"PushMaterial",function(){return Yi.a}),n.d(t,"ShaderMaterial",function(){return mo.a}),n.d(t,"StandardMaterialDefines",function(){return bn.b}),n.d(t,"StandardMaterial",function(){return bn.a}),n.d(t,"BaseTexture",function(){return Gi.a}),n.d(t,"CubeTexture",function(){return Hi}),n.d(t,"EquiRectangularCubeTexture",function(){return vo}),n.d(t,"HDRCubeTexture",function(){return Xr}),n.d(t,"InternalTexture",function(){return ze.a}),n.d(t,"MirrorTexture",function(){return ji}),n.d(t,"MultiRenderTarget",function(){return To}),n.d(t,"RenderTargetTexture",function(){return cn}),n.d(t,"Texture",function(){return Ge.a}),n.d(t,"UniformBuffer",function(){return an.a}),n.d(t,"MaterialFlags",function(){return Ki.a}),n.d(t,"BackgroundMaterial",function(){return qi}),n.d(t,"PBRMaterialDefines",function(){return sr}),n.d(t,"PBRBaseMaterial",function(){return lr}),n.d(t,"PBRBaseSimpleMaterial",function(){return fo}),n.d(t,"PBRMaterial",function(){return cr}),n.d(t,"PBRMetallicRoughnessMaterial",function(){return po}),n.d(t,"PBRSpecularGlossinessMaterial",function(){return go}),n.d(t,"ColorGradingTexture",function(){return _o}),n.d(t,"DynamicTexture",function(){return yn}),n.d(t,"ProceduralTexture",function(){return xo}),n.d(t,"RawCubeTexture",function(){return Po}),n.d(t,"RawTexture",function(){return je}),n.d(t,"RawTexture3D",function(){return Ro}),n.d(t,"RefractionTexture",function(){return Mo}),n.d(t,"VideoTexture",function(){return xr}),n.d(t,"HtmlElementTexture",function(){return Oo}),n.d(t,"_DDSTextureLoader",function(){return vr}),n.d(t,"_ENVTextureLoader",function(){return yr}),n.d(t,"_KTXTextureLoader",function(){return Er}),n.d(t,"_TGATextureLoader",function(){return yo}),n.d(t,"CustomProceduralTexture",function(){return So}),n.d(t,"NoiseProceduralTexture",function(){return Ao}),n.d(t,"ProceduralTextureSceneComponent",function(){return Eo}),n.d(t,"Scalar",function(){return I.a}),n.d(t,"ToGammaSpace",function(){return o.u}),n.d(t,"ToLinearSpace",function(){return o.v}),n.d(t,"Epsilon",function(){return o.h}),n.d(t,"Color3",function(){return o.e}),n.d(t,"Color4",function(){return o.f}),n.d(t,"Vector2",function(){return o.w}),n.d(t,"Vector3",function(){return o.x}),n.d(t,"Vector4",function(){return o.y}),n.d(t,"Size",function(){return o.r}),n.d(t,"Quaternion",function(){return o.q}),n.d(t,"Matrix",function(){return o.j}),n.d(t,"Plane",function(){return o.n}),n.d(t,"Viewport",function(){return o.z}),n.d(t,"Frustum",function(){return o.i}),n.d(t,"Space",function(){return o.s}),n.d(t,"Axis",function(){return o.c}),n.d(t,"BezierCurve",function(){return o.d}),n.d(t,"Orientation",function(){return o.k}),n.d(t,"Angle",function(){return o.a}),n.d(t,"Arc2",function(){return o.b}),n.d(t,"Path2",function(){return o.l}),n.d(t,"Path3D",function(){return o.m}),n.d(t,"Curve3",function(){return o.g}),n.d(t,"PositionNormalVertex",function(){return o.p}),n.d(t,"PositionNormalTextureVertex",function(){return o.o}),n.d(t,"Tmp",function(){return o.t}),n.d(t,"SphericalHarmonics",function(){return ur.a}),n.d(t,"SphericalPolynomial",function(){return ur.b}),n.d(t,"AbstractMesh",function(){return ke.a}),n.d(t,"Buffer",function(){return Cn.a}),n.d(t,"VertexBuffer",function(){return Cn.b}),n.d(t,"CSG",function(){return jo}),n.d(t,"Geometry",function(){return zr.a}),n.d(t,"GroundMesh",function(){return Sn}),n.d(t,"TrailMesh",function(){return Ho}),n.d(t,"InstancedMesh",function(){return Wo.a}),n.d(t,"LinesMesh",function(){return Xo.b}),n.d(t,"InstancedLinesMesh",function(){return Xo.a}),n.d(t,"_CreationDataStorage",function(){return fe.b}),n.d(t,"_InstancesBatch",function(){return fe.c}),n.d(t,"Mesh",function(){return fe.a}),n.d(t,"VertexData",function(){return xn.a}),n.d(t,"MeshBuilder",function(){return oa}),n.d(t,"SimplificationSettings",function(){return aa}),n.d(t,"SimplificationQueue",function(){return sa}),n.d(t,"SimplificationType",function(){return ia}),n.d(t,"SimplicationQueueSceneComponent",function(){return fa}),n.d(t,"Polygon",function(){return Zo}),n.d(t,"PolygonMeshBuilder",function(){return Jo}),n.d(t,"BaseSubMesh",function(){return Fo.a}),n.d(t,"SubMesh",function(){return Fo.b}),n.d(t,"MeshLODLevel",function(){return pa.a}),n.d(t,"TransformNode",function(){return $i.a}),n.d(t,"BoxBuilder",function(){return Ei.a}),n.d(t,"SphereBuilder",function(){return Ai.a}),n.d(t,"CylinderBuilder",function(){return Mn.a}),n.d(t,"LinesBuilder",function(){return Pi.a}),n.d(t,"PlaneBuilder",function(){return Zi.a}),n.d(t,"DataBuffer",function(){return ga.a}),n.d(t,"WebGLDataBuffer",function(){return ma.a}),n.d(t,"DracoCompression",function(){return No}),n.d(t,"DiscBuilder",function(){return Yo}),n.d(t,"RibbonBuilder",function(){return to}),n.d(t,"HemisphereBuilder",function(){return Bi}),n.d(t,"TorusBuilder",function(){return Rn}),n.d(t,"TorusKnotBuilder",function(){return Ko}),n.d(t,"PolygonBuilder",function(){return $o}),n.d(t,"ShapeBuilder",function(){return no}),n.d(t,"LatheBuilder",function(){return ea}),n.d(t,"GroundBuilder",function(){return An}),n.d(t,"TubeBuilder",function(){return ta}),n.d(t,"PolyhedronBuilder",function(){return Ii}),n.d(t,"IcoSphereBuilder",function(){return na}),n.d(t,"DecalBuilder",function(){return ra}),n.d(t,"MorphTarget",function(){return Yr}),n.d(t,"MorphTargetManager",function(){return Kr}),n.d(t,"Node",function(){return k.a}),n.d(t,"Database",function(){return va}),n.d(t,"BaseParticleSystem",function(){return Pa}),n.d(t,"GPUParticleSystem",function(){return wa}),n.d(t,"Particle",function(){return Ra}),n.d(t,"ParticleHelper",function(){return Da}),n.d(t,"ParticleSystem",function(){return Oa}),n.d(t,"_IDoNeedToBeInTheBuild",function(){return 42}),n.d(t,"ParticleSystemSet",function(){return Ia}),n.d(t,"SolidParticle",function(){return La}),n.d(t,"ModelShape",function(){return ka}),n.d(t,"DepthSortedParticle",function(){return Na}),n.d(t,"SolidParticleSystem",function(){return Ba}),n.d(t,"SubEmitterType",function(){return _a}),n.d(t,"SubEmitter",function(){return Ma}),n.d(t,"BoxParticleEmitter",function(){return ba}),n.d(t,"ConeParticleEmitter",function(){return ya}),n.d(t,"CylinderParticleEmitter",function(){return Ta}),n.d(t,"CylinderDirectedParticleEmitter",function(){return Ea}),n.d(t,"HemisphericParticleEmitter",function(){return xa}),n.d(t,"PointParticleEmitter",function(){return Ca}),n.d(t,"SphereParticleEmitter",function(){return Sa}),n.d(t,"SphereDirectedParticleEmitter",function(){return Aa}),n.d(t,"PhysicsEngine",function(){return Zr}),n.d(t,"PhysicsEngineSceneComponent",function(){return Ga}),n.d(t,"PhysicsHelper",function(){return za}),n.d(t,"PhysicsRadialExplosionEventOptions",function(){return Ya}),n.d(t,"PhysicsUpdraftEventOptions",function(){return Ka}),n.d(t,"PhysicsVortexEventOptions",function(){return Qa}),n.d(t,"PhysicsRadialImpulseFalloff",function(){return Ua}),n.d(t,"PhysicsUpdraftMode",function(){return Va}),n.d(t,"PhysicsImpostor",function(){return Qr.a}),n.d(t,"PhysicsJoint",function(){return qr.e}),n.d(t,"DistanceJoint",function(){return qr.a}),n.d(t,"MotorEnabledJoint",function(){return qr.d}),n.d(t,"HingeJoint",function(){return qr.c}),n.d(t,"Hinge2Joint",function(){return qr.b}),n.d(t,"CannonJSPlugin",function(){return $r}),n.d(t,"AmmoJSPlugin",function(){return io}),n.d(t,"OimoJSPlugin",function(){return eo}),n.d(t,"AnaglyphPostProcess",function(){return Xt}),n.d(t,"BlackAndWhitePostProcess",function(){return qa}),n.d(t,"BloomEffect",function(){return es}),n.d(t,"BloomMergePostProcess",function(){return $a}),n.d(t,"BlurPostProcess",function(){return zi}),n.d(t,"ChromaticAberrationPostProcess",function(){return ts}),n.d(t,"CircleOfConfusionPostProcess",function(){return ns}),n.d(t,"ColorCorrectionPostProcess",function(){return is}),n.d(t,"ConvolutionPostProcess",function(){return rs}),n.d(t,"DepthOfFieldBlurPostProcess",function(){return os}),n.d(t,"DepthOfFieldEffectBlurLevel",function(){return as}),n.d(t,"DepthOfFieldEffect",function(){return cs}),n.d(t,"DepthOfFieldMergePostProcessOptions",function(){return ss}),n.d(t,"DepthOfFieldMergePostProcess",function(){return ls}),n.d(t,"DisplayPassPostProcess",function(){return us}),n.d(t,"ExtractHighlightsPostProcess",function(){return Ja}),n.d(t,"FilterPostProcess",function(){return hs}),n.d(t,"FxaaPostProcess",function(){return ds}),n.d(t,"GrainPostProcess",function(){return fs}),n.d(t,"HighlightsPostProcess",function(){return ps}),n.d(t,"ImageProcessingPostProcess",function(){return En}),n.d(t,"MotionBlurPostProcess",function(){return _s}),n.d(t,"PassPostProcess",function(){return Ht}),n.d(t,"PassCubePostProcess",function(){return Wt}),n.d(t,"PostProcess",function(){return jt}),n.d(t,"PostProcessManager",function(){return sn.a}),n.d(t,"RefractionPostProcess",function(){return vs}),n.d(t,"SharpenPostProcess",function(){return bs}),n.d(t,"StereoscopicInterlacePostProcess",function(){return Zt}),n.d(t,"TonemappingOperator",function(){return Ps}),n.d(t,"TonemapPostProcess",function(){return Ms}),n.d(t,"VolumetricLightScatteringPostProcess",function(){return Os}),n.d(t,"VRDistortionCorrectionPostProcess",function(){return on}),n.d(t,"VRMultiviewToSingleviewPostProcess",function(){return hn}),n.d(t,"PostProcessRenderEffect",function(){return Za}),n.d(t,"PostProcessRenderPipeline",function(){return ys}),n.d(t,"PostProcessRenderPipelineManager",function(){return Ts}),n.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return Es}),n.d(t,"DefaultRenderingPipeline",function(){return xs}),n.d(t,"LensRenderingPipeline",function(){return Cs}),n.d(t,"SSAO2RenderingPipeline",function(){return Ss}),n.d(t,"SSAORenderingPipeline",function(){return As}),n.d(t,"StandardRenderingPipeline",function(){return Rs}),n.d(t,"ReflectionProbe",function(){return ro}),n.d(t,"BoundingBoxRenderer",function(){return ws}),n.d(t,"DepthRenderer",function(){return Is}),n.d(t,"DepthRendererSceneComponent",function(){return Ds}),n.d(t,"EdgesRenderer",function(){return ks}),n.d(t,"LineEdgesRenderer",function(){return Ns}),n.d(t,"GeometryBufferRenderer",function(){return gs}),n.d(t,"GeometryBufferRendererSceneComponent",function(){return ms}),n.d(t,"OutlineRenderer",function(){return Fs}),n.d(t,"RenderingGroup",function(){return Bs.a}),n.d(t,"RenderingGroupInfo",function(){return ln.a}),n.d(t,"RenderingManager",function(){return ln.b}),n.d(t,"UtilityLayerRenderer",function(){return Ci.a}),n.d(t,"Scene",function(){return W.a}),n.d(t,"SceneComponentConstants",function(){return xe.a}),n.d(t,"Stage",function(){return xe.b}),n.d(t,"Sprite",function(){return Us}),n.d(t,"SpriteManager",function(){return zs}),n.d(t,"SpriteSceneComponent",function(){return Vs}),n.d(t,"_AlphaState",function(){return js.a}),n.d(t,"_DepthCullingState",function(){return js.b}),n.d(t,"_StencilState",function(){return js.c}),n.d(t,"AndOrNotEvaluator",function(){return Hs.a}),n.d(t,"AssetTaskState",function(){return Gs}),n.d(t,"AbstractAssetTask",function(){return Xs}),n.d(t,"AssetsProgressEvent",function(){return Ys}),n.d(t,"MeshAssetTask",function(){return Ks}),n.d(t,"TextFileAssetTask",function(){return Qs}),n.d(t,"BinaryFileAssetTask",function(){return qs}),n.d(t,"ImageAssetTask",function(){return Zs}),n.d(t,"TextureAssetTask",function(){return Js}),n.d(t,"CubeTextureAssetTask",function(){return $s}),n.d(t,"HDRCubeTextureAssetTask",function(){return el}),n.d(t,"EquiRectangularCubeTextureAssetTask",function(){return tl}),n.d(t,"AssetsManager",function(){return nl}),n.d(t,"DDSTools",function(){return _r}),n.d(t,"expandToProperty",function(){return D.b}),n.d(t,"serialize",function(){return D.c}),n.d(t,"serializeAsTexture",function(){return D.m}),n.d(t,"serializeAsColor3",function(){return D.e}),n.d(t,"serializeAsFresnelParameters",function(){return D.h}),n.d(t,"serializeAsVector2",function(){return D.n}),n.d(t,"serializeAsVector3",function(){return D.o}),n.d(t,"serializeAsMeshReference",function(){return D.k}),n.d(t,"serializeAsColorCurves",function(){return D.g}),n.d(t,"serializeAsColor4",function(){return D.f}),n.d(t,"serializeAsImageProcessingConfiguration",function(){return D.i}),n.d(t,"serializeAsQuaternion",function(){return D.l}),n.d(t,"serializeAsMatrix",function(){return D.j}),n.d(t,"serializeAsCameraReference",function(){return D.d}),n.d(t,"SerializationHelper",function(){return D.a}),n.d(t,"Deferred",function(){return il}),n.d(t,"EnvironmentTextureTools",function(){return br}),n.d(t,"MeshExploder",function(){return rl}),n.d(t,"FilesInput",function(){return ol}),n.d(t,"KhronosTextureContainer",function(){return Tr}),n.d(t,"EventState",function(){return r.a}),n.d(t,"Observer",function(){return r.d}),n.d(t,"MultiObserver",function(){return r.b}),n.d(t,"Observable",function(){return r.c}),n.d(t,"PerformanceMonitor",function(){return al.a}),n.d(t,"RollingAverage",function(){return al.b}),n.d(t,"PromisePolyfill",function(){return sl.a}),n.d(t,"SceneOptimization",function(){return ll}),n.d(t,"TextureOptimization",function(){return cl}),n.d(t,"HardwareScalingOptimization",function(){return ul}),n.d(t,"ShadowsOptimization",function(){return hl}),n.d(t,"PostProcessesOptimization",function(){return dl}),n.d(t,"LensFlaresOptimization",function(){return fl}),n.d(t,"CustomOptimization",function(){return pl}),n.d(t,"ParticlesOptimization",function(){return gl}),n.d(t,"RenderTargetsOptimization",function(){return ml}),n.d(t,"MergeMeshesOptimization",function(){return _l}),n.d(t,"SceneOptimizerOptions",function(){return vl}),n.d(t,"SceneOptimizer",function(){return bl}),n.d(t,"SceneSerializer",function(){return xl}),n.d(t,"SmartArray",function(){return Gt.a}),n.d(t,"SmartArrayNoDuplicate",function(){return Gt.b}),n.d(t,"StringDictionary",function(){return mt.a}),n.d(t,"Tags",function(){return Cl.a}),n.d(t,"TextureTools",function(){return Sl}),n.d(t,"TGATools",function(){return bo}),n.d(t,"ColorGradient",function(){return be.c}),n.d(t,"Color3Gradient",function(){return be.b}),n.d(t,"FactorGradient",function(){return be.d}),n.d(t,"LoadFileError",function(){return be.e}),n.d(t,"RetryStrategy",function(){return be.g}),n.d(t,"Tools",function(){return be.h}),n.d(t,"PerfCounter",function(){return be.f}),n.d(t,"className",function(){return be.i}),n.d(t,"AsyncLoop",function(){return be.a}),n.d(t,"VideoRecorder",function(){return Al}),n.d(t,"JoystickAxis",function(){return gt}),n.d(t,"VirtualJoystick",function(){return _t}),n.d(t,"WorkerPool",function(){return wo}),n.d(t,"Logger",function(){return p.a}),n.d(t,"_TypeStore",function(){return a.a}),n.d(t,"FilesInputStore",function(){return ui.a}),n.d(t,"DeepCopier",function(){return P.a}),n.d(t,"PivotTools",function(){return Fe.a}),n.d(t,"PrecisionDate",function(){return X.a}),n.d(t,"ScreenshotTools",function(){return Pl}),n.d(t,"WebRequest",function(){return Co.a}),n.d(t,"InspectableType",function(){return Ws}),n.d(t,"CubeMapToSphericalPolynomialTools",function(){return hr.a}),n.d(t,"HDRTools",function(){return Wr}),n.d(t,"PanoramaToCubeMapTools",function(){return Hr})},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogFragmentDeclaration="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogFragment="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogVertexDeclaration="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertex="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.Eval=function(t,n){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,n)}):e._HandleParenthesisContent(t,n))||"false"!==t&&e.Eval(t,n)},e._HandleParenthesisContent=function(t,n){var i;n=n||function(e){return"true"===e};var r=t.split("||");for(var o in r)if(r.hasOwnProperty(o)){var a=e._SimplifyNegation(r[o].trim()),s=a.split("&&");if(s.length>1)for(var l=0;l<s.length;++l){var c=e._SimplifyNegation(s[l].trim());if(!(i="true"!==c&&"false"!==c?"!"===c[0]?!n(c.substring(1)):n(c):"true"===c)){a="false";break}}if(i||"true"===a){i=!0;break}i="true"!==a&&"false"!==a?"!"===a[0]?!n(a.substring(1)):n(a):"true"===a}return i?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var i=n(47),r=function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new o(e)}return e.prototype.sampleFrame=function(e){void 0===e&&(e=i.a.Now),this._enabled&&(null!=this._lastFrameTimeMs&&this._rollingFrameTime.add(e-this._lastFrameTimeMs),this._lastFrameTimeMs=e)},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),o=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var n=this._samples[this._pos];this.average-=(t=n-this.average)/(this._sampleCount-1),this._m2-=t*(n-this.average)}else this._sampleCount++;this.average+=(t=e-this.average)/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i,r=n(9);!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(i||(i={}));var o=function(){this.count=0,this.target=0,this.results=[]},a=function(){function e(e){var t=this;if(this._state=i.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e(function(e){t._resolve(e)},function(e){t._reject(e)})}catch(e){this._reject(e)}}return Object.defineProperty(e.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.then=function(t,n){var o=this,a=new e;return a._onFulfilled=t,a._onRejected=n,this._children.push(a),a._parent=this,this._state!==i.Pending&&r.h.SetImmediate(function(){if(o._state===i.Fulfilled||o._rejectWasConsumed){var e=a._resolve(o._result);if(null!=e)if(void 0!==e._state){var t=e;a._children.push(t),t._parent=a,a=t}else a._result=e}else a._reject(o._reason)}),a},e.prototype._moveChildren=function(e){var t,n=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach(function(e){e._parent=n}),this._state===i.Fulfilled)for(var r=0,o=this._children;r<o.length;r++)o[r]._resolve(this._result);else if(this._state===i.Rejected)for(var a=0,s=this._children;a<s.length;a++)s[a]._reject(this._reason)},e.prototype._resolve=function(e){try{this._state=i.Fulfilled;var t=null;if(this._onFulfilled&&(t=this._onFulfilled(e)),null!=t)if(void 0!==t._state){var n=t;n._parent=this,n._moveChildren(this._children),e=n._result}else e=t;this._result=e;for(var r=0,o=this._children;r<o.length;r++)o[r]._resolve(e);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},e.prototype._reject=function(e,t){if(void 0===t&&(t=!1),this._state=i.Rejected,this._reason=e,this._onRejected&&!t)try{this._onRejected(e),this._rejectWasConsumed=!0}catch(t){e=t}for(var n=0,r=this._children;n<r.length;n++){var o=r[n];this._rejectWasConsumed?o._resolve(null):o._reject(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},e.resolve=function(t){var n=new e;return n._resolve(t),n},e._RegisterForFulfillment=function(e,t,n){e.then(function(e){return t.results[n]=e,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null},function(e){t.rootPromise._state!==i.Rejected&&t.rootPromise._reject(e)})},e.all=function(t){var n=new e,i=new o;if(i.target=t.length,i.rootPromise=n,t.length)for(var r=0;r<t.length;r++)e._RegisterForFulfillment(t[r],i,r);else n._resolve([]);return n},e.race=function(t){var n=new e;if(t.length)for(var i=0,r=t;i<r.length;i++)r[i].then(function(e){return n&&(n._resolve(e),n=null),null},function(e){n&&(n._reject(e),n=null)});return n},e}(),s=function(){function e(){}return e.Apply=function(e){void 0===e&&(e=!1),(e||"undefined"==typeof Promise)&&(window.Promise=a)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),r=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new i.x(0,0,0),this._diffPositionForCollisions=new i.x(0,0,0)}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(28),r=n(0),o=n(3),a=function(){function e(e,t,n,r,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),this.index=e,this._opaqueSubMeshes=new i.a(256),this._transparentSubMeshes=new i.a(256),this._alphaTestSubMeshes=new i.a(256),this._depthOnlySubMeshes=new i.a(256),this._particleSystems=new i.a(256),this._spriteManagers=new i.a(256),this._edgesRenderers=new i.a(16),this._scene=t,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=o}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t,this._renderOpaque=t?this.renderOpaqueSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t,this._renderAlphaTest=t?this.renderAlphaTestSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t,n,i){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=r.getStencilBuffer();if(r.setStencilBuffer(!1),t&&this._renderSprites(),n&&this._renderParticles(i),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),r.setAlphaMode(o.a.ALPHA_DISABLE)),r.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();r.setAlphaMode(o.a.ALPHA_DISABLE)}r.setStencilBuffer(a)}},e.prototype.renderOpaqueSorted=function(t){return e.renderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderAlphaTestSorted=function(t){return e.renderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderTransparentSorted=function(t){return e.renderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e.renderSorted=function(e,t,n,i){for(var a,s=0,l=n?n.globalPosition:r.x.Zero();s<e.length;s++)(a=e.data[s])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=a.getBoundingInfo().boundingSphere.centerWorld.subtract(l).length();var c=e.data.slice(0,e.length);for(t&&c.sort(t),s=0;s<c.length;s++){if(a=c[s],i){var u=a.getMaterial();if(u&&u.needDepthPrePass){var h=u.getScene().getEngine();h.setColorWrite(!1),h.setAlphaMode(o.a.ALPHA_DISABLE),a.render(!1),h.setColorWrite(!0)}}a.render(i)}},e.renderUnsorted=function(e){for(var t=0;t<e.length;t++)e.data[t].render(!1)},e.defaultTransparentSortCompare=function(t,n){return t._alphaIndex>n._alphaIndex?1:t._alphaIndex<n._alphaIndex?-1:e.backToFrontSortCompare(t,n)},e.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},e.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(e,t,n){void 0===t&&(t=e.getMesh()),void 0===n&&(n=e.getMaterial()),null!=n&&(n.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):n.needAlphaTesting()?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},e.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},e.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},e.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var n=0;n<this._particleSystems.length;n++){var i=this._particleSystems.data[n];if(0!==(t&&t.layerMask&i.layerMask)){var r=i.emitter;r.position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(i.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var n=this._spriteManagers.data[t];0!==(e&&e.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(e,t){this.distance=e,this.mesh=t}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(1),r=n(0),o=n(6),a=n(24),s=n(11),l=n(32),c=n(42);s.a._instancedMeshFactory=function(e,t){return new u(e,t)};var u=function(e){function t(t,n){var i=e.call(this,t,n.getScene())||this;return i._indexInSourceMeshInstanceArray=-1,n.addInstance(i),i._sourceMesh=n,i.position.copyFrom(n.position),i.rotation.copyFrom(n.rotation),i.scaling.copyFrom(n.scaling),n.rotationQuaternion&&(i.rotationQuaternion=n.rotationQuaternion.clone()),i.infiniteDistance=n.infiniteDistance,i.setPivotMatrix(n.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}return i.d(t,e),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),t.prototype._resyncLightSources=function(){},t.prototype._resyncLighSource=function(e){},t.prototype._removeLightSource=function(e){},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&o.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},t.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},t.prototype.setVerticesData=function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,n,i),this.sourceMesh},t.prototype.updateVerticesData=function(e,t,n,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,n,i),this.sourceMesh},t.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},t.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(e,t){if(this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0;return!1},t.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},t.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==c.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,r.t.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD._masterMesh=t,r.t.Matrix[0]}return e.prototype.getWorldMatrix.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype.clone=function(e,t,n){var i=this._sourceMesh.createInstance(e);if(l.a.DeepCopy(this,i,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),t&&(i.parent=t),!n)for(var r=0;r<this.getScene().meshes.length;r++){var o=this.getScene().meshes[r];o.parent===this&&o.clone(o.name,i)}return i.computeWorldMatrix(!0),i},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,n)},t}(a.a)},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.shadowsFragmentFunctions="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.reflectionFunction="#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vec3(reflectionMatrix*vec4(vPositionUVW,0));\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightFragment="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthFragment="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogVertex="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.shadowsVertex="#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif"},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightsFragmentFunctions="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpFragmentFunctions="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv,sampler2D textureSampler,float scale)\n{\nvec3 map=texture2D(textureSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,uv,bumpSampler,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpFragment="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.depthPrePass="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpVertexDeclaration="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpVertex="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif"},function(e,t,n){"use strict";var i=n(5),r=(n(95),n(89),"colorPixelShader");i.a.ShadersStore[r]="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}"},function(e,t,n){"use strict";var i=n(5),r=(n(67),n(96),n(68),n(69),n(70),n(90),"colorVertexShader");i.a.ShadersStore[r]="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}"},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return u}),n.d(t,"a",function(){return h});var i=n(1),r=n(6),o=n(10),a=n(92),s=n(26),l=n(3),c=n(78),u=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},h=function(t){function n(n){void 0===n&&(n=new u);var i=t.call(this,null)||this;void 0===n.deterministicLockstep&&(n.deterministicLockstep=!1),void 0===n.lockstepMaxSteps&&(n.lockstepMaxSteps=4),i._options=n,i._caps=new o.c,i._caps.maxTexturesImageUnits=16,i._caps.maxVertexTextureImageUnits=16,i._caps.maxTextureSize=512,i._caps.maxCubemapTextureSize=512,i._caps.maxRenderTextureSize=512,i._caps.maxVertexAttribs=16,i._caps.maxVaryingVectors=16,i._caps.maxFragmentUniformVectors=16,i._caps.maxVertexUniformVectors=16,i._caps.standardDerivatives=!1,i._caps.astc=null,i._caps.s3tc=null,i._caps.pvrtc=null,i._caps.etc1=null,i._caps.etc2=null,i._caps.textureAnisotropicFilterExtension=null,i._caps.maxAnisotropy=0,i._caps.uintIndices=!1,i._caps.fragmentDepthSupported=!1,i._caps.highPrecisionShaderSupported=!0,i._caps.colorBufferFloat=!1,i._caps.textureFloat=!1,i._caps.textureFloatLinearFiltering=!1,i._caps.textureFloatRender=!1,i._caps.textureHalfFloat=!1,i._caps.textureHalfFloatLinearFiltering=!1,i._caps.textureHalfFloatRender=!1,i._caps.textureLOD=!1,i._caps.drawBuffersExtension=!1,i._caps.depthTextureExtension=!1,i._caps.vertexArrayObject=!1,i._caps.instancedArrays=!1,r.a.Log("Babylon.js v"+o.b.Version+" - Null engine");var a="undefined"!=typeof self?self:void 0!==e?e:window;return"undefined"==typeof URL&&(a.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(a.Blob=function(){}),i}return i.d(n,t),n.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},n.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},n.prototype.getHardwareScalingLevel=function(){return 1},n.prototype.createVertexBuffer=function(e){var t=new c.a;return t.references=1,t},n.prototype.createIndexBuffer=function(e){var t=new c.a;return t.references=1,t},n.prototype.clear=function(e,t,n,i){void 0===i&&(i=!1)},n.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},n.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},n.prototype.setViewport=function(e,t,n){this._cachedViewport=e},n.prototype.createShaderProgram=function(e,t,n,i,r){return{__SPECTOR_rebuildProgram:null}},n.prototype.getUniforms=function(e,t){return[]},n.prototype.getAttributes=function(e,t){return[]},n.prototype.bindSamplers=function(e){this._currentEffect=null},n.prototype.enableEffect=function(e){this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e)},n.prototype.setState=function(e,t,n,i){void 0===t&&(t=0),void 0===i&&(i=!1)},n.prototype.setIntArray=function(e,t){},n.prototype.setIntArray2=function(e,t){},n.prototype.setIntArray3=function(e,t){},n.prototype.setIntArray4=function(e,t){},n.prototype.setFloatArray=function(e,t){},n.prototype.setFloatArray2=function(e,t){},n.prototype.setFloatArray3=function(e,t){},n.prototype.setFloatArray4=function(e,t){},n.prototype.setArray=function(e,t){},n.prototype.setArray2=function(e,t){},n.prototype.setArray3=function(e,t){},n.prototype.setArray4=function(e,t){},n.prototype.setMatrices=function(e,t){},n.prototype.setMatrix=function(e,t){},n.prototype.setMatrix3x3=function(e,t){},n.prototype.setMatrix2x2=function(e,t){},n.prototype.setFloat=function(e,t){},n.prototype.setFloat2=function(e,t,n){},n.prototype.setFloat3=function(e,t,n,i){},n.prototype.setBool=function(e,t){},n.prototype.setFloat4=function(e,t,n,i,r){},n.prototype.setColor3=function(e,t){},n.prototype.setColor4=function(e,t,n){},n.prototype.setAlphaMode=function(e,t){void 0===t&&(t=!1),this._alphaMode!==e&&(this._alphaState.alphaBlend=e!==l.a.ALPHA_DISABLE,t||this.setDepthWrite(e===l.a.ALPHA_DISABLE),this._alphaMode=e)},n.prototype.bindBuffers=function(e,t,n){},n.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},n.prototype.draw=function(e,t,n,i){},n.prototype.drawElementsType=function(e,t,n,i){},n.prototype.drawArraysType=function(e,t,n,i){},n.prototype._createTexture=function(){return{}},n.prototype._releaseTexture=function(e){},n.prototype.createTexture=function(e,t,n,i,r,o,a,c,u,h){void 0===r&&(r=l.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===a&&(a=null),void 0===c&&(c=null);var d=new s.a(this,s.a.DATASOURCE_URL),f=String(e);return d.url=f,d.generateMipMaps=!t,d.samplingMode=r,d.invertY=n,d.baseWidth=this._options.textureSize,d.baseHeight=this._options.textureSize,d.width=this._options.textureSize,d.height=this._options.textureSize,h&&(d.format=h),d.isReady=!0,o&&o(),this._internalTexturesCache.push(d),d},n.prototype.createRenderTargetTexture=function(e,t){var n=new a.a;void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.type=void 0===t.type?l.a.TEXTURETYPE_UNSIGNED_INT:t.type,n.samplingMode=void 0===t.samplingMode?l.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.type=l.a.TEXTURETYPE_UNSIGNED_INT,n.samplingMode=l.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var i=new s.a(this,s.a.DATASOURCE_RENDERTARGET),r=e.width||e,o=e.height||e;return i._depthStencilBuffer={},i._framebuffer={},i.baseWidth=r,i.baseHeight=o,i.width=r,i.height=o,i.isReady=!0,i.samples=1,i.generateMipMaps=!!n.generateMipMaps,i.samplingMode=n.samplingMode,i.type=n.type,i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=!!n.generateStencilBuffer,this._internalTexturesCache.push(i),i},n.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},n.prototype.bindFramebuffer=function(e,t,n,i,r){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer,this._cachedViewport&&!r&&this.setViewport(this._cachedViewport,n,i)},n.prototype.unBindFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null,n&&(e._MSAAFramebuffer&&(this._currentFramebuffer=e._framebuffer),n()),this._currentFramebuffer=null},n.prototype.createDynamicVertexBuffer=function(e){var t=new c.a;return t.references=1,t.capacity=1,t},n.prototype.updateDynamicTexture=function(e,t,n,i,r){void 0===i&&(i=!1)},n.prototype.areAllEffectsReady=function(){return!0},n.prototype.getError=function(){return 0},n.prototype._getUnpackAlignement=function(){return 1},n.prototype._unpackFlipY=function(e){},n.prototype.updateDynamicIndexBuffer=function(e,t,n){void 0===n&&(n=0)},n.prototype.updateDynamicVertexBuffer=function(e,t,n,i){},n.prototype._bindTextureDirectly=function(e,t){return this._boundTexturesCache[this._activeChannel]!==t&&(this._boundTexturesCache[this._activeChannel]=t,!0)},n.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},n.prototype._releaseBuffer=function(e){return e.references--,0===e.references},n.prototype.releaseEffects=function(){},n.prototype.displayLoadingUI=function(){},n.prototype.hideLoadingUI=function(){},n.prototype._uploadCompressedDataToTextureDirectly=function(e,t,n,i,r,o,a){void 0===o&&(o=0),void 0===a&&(a=0)},n.prototype._uploadDataToTextureDirectly=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0)},n.prototype._uploadArrayBufferViewToTexture=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0)},n.prototype._uploadImageToTexture=function(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0)},n}(o.b)}).call(this,n(119))},function(e,t,n){"use strict";n.r(t),(function(e){n.d(t,"Debug",function(){return c});var i=n(97),r=n(74);n.d(t,"AbstractScene",function(){return i.AbstractScene}),n.d(t,"KeepAssets",function(){return i.KeepAssets}),n.d(t,"AssetContainer",function(){return i.AssetContainer}),n.d(t,"Node",function(){return i.Node}),n.d(t,"Scene",function(){return i.Scene}),n.d(t,"SceneComponentConstants",function(){return i.SceneComponentConstants}),n.d(t,"Stage",function(){return i.Stage}),n.d(t,"Action",function(){return i.Action}),n.d(t,"ActionEvent",function(){return i.ActionEvent}),n.d(t,"ActionManager",function(){return i.ActionManager}),n.d(t,"Condition",function(){return i.Condition}),n.d(t,"ValueCondition",function(){return i.ValueCondition}),n.d(t,"PredicateCondition",function(){return i.PredicateCondition}),n.d(t,"StateCondition",function(){return i.StateCondition}),n.d(t,"SwitchBooleanAction",function(){return i.SwitchBooleanAction}),n.d(t,"SetStateAction",function(){return i.SetStateAction}),n.d(t,"SetValueAction",function(){return i.SetValueAction}),n.d(t,"IncrementValueAction",function(){return i.IncrementValueAction}),n.d(t,"PlayAnimationAction",function(){return i.PlayAnimationAction}),n.d(t,"StopAnimationAction",function(){return i.StopAnimationAction}),n.d(t,"DoNothingAction",function(){return i.DoNothingAction}),n.d(t,"CombineAction",function(){return i.CombineAction}),n.d(t,"ExecuteCodeAction",function(){return i.ExecuteCodeAction}),n.d(t,"SetParentAction",function(){return i.SetParentAction}),n.d(t,"PlaySoundAction",function(){return i.PlaySoundAction}),n.d(t,"StopSoundAction",function(){return i.StopSoundAction}),n.d(t,"InterpolateValueAction",function(){return i.InterpolateValueAction}),n.d(t,"Animatable",function(){return i.Animatable}),n.d(t,"_IAnimationState",function(){return i._IAnimationState}),n.d(t,"Animation",function(){return i.Animation}),n.d(t,"TargetedAnimation",function(){return i.TargetedAnimation}),n.d(t,"AnimationGroup",function(){return i.AnimationGroup}),n.d(t,"AnimationPropertiesOverride",function(){return i.AnimationPropertiesOverride}),n.d(t,"EasingFunction",function(){return i.EasingFunction}),n.d(t,"CircleEase",function(){return i.CircleEase}),n.d(t,"BackEase",function(){return i.BackEase}),n.d(t,"BounceEase",function(){return i.BounceEase}),n.d(t,"CubicEase",function(){return i.CubicEase}),n.d(t,"ElasticEase",function(){return i.ElasticEase}),n.d(t,"ExponentialEase",function(){return i.ExponentialEase}),n.d(t,"PowerEase",function(){return i.PowerEase}),n.d(t,"QuadraticEase",function(){return i.QuadraticEase}),n.d(t,"QuarticEase",function(){return i.QuarticEase}),n.d(t,"QuinticEase",function(){return i.QuinticEase}),n.d(t,"SineEase",function(){return i.SineEase}),n.d(t,"BezierCurveEase",function(){return i.BezierCurveEase}),n.d(t,"RuntimeAnimation",function(){return i.RuntimeAnimation}),n.d(t,"AnimationEvent",function(){return i.AnimationEvent}),n.d(t,"AnimationKeyInterpolation",function(){return i.AnimationKeyInterpolation}),n.d(t,"AnimationRange",function(){return i.AnimationRange}),n.d(t,"Analyser",function(){return i.Analyser}),n.d(t,"AudioEngine",function(){return i.AudioEngine}),n.d(t,"AudioSceneComponent",function(){return i.AudioSceneComponent}),n.d(t,"Sound",function(){return i.Sound}),n.d(t,"SoundTrack",function(){return i.SoundTrack}),n.d(t,"WeightedSound",function(){return i.WeightedSound}),n.d(t,"Bone",function(){return i.Bone}),n.d(t,"BoneIKController",function(){return i.BoneIKController}),n.d(t,"BoneLookController",function(){return i.BoneLookController}),n.d(t,"Skeleton",function(){return i.Skeleton}),n.d(t,"CameraInputTypes",function(){return i.CameraInputTypes}),n.d(t,"CameraInputsManager",function(){return i.CameraInputsManager}),n.d(t,"Camera",function(){return i.Camera}),n.d(t,"TargetCamera",function(){return i.TargetCamera}),n.d(t,"FreeCamera",function(){return i.FreeCamera}),n.d(t,"FreeCameraInputsManager",function(){return i.FreeCameraInputsManager}),n.d(t,"TouchCamera",function(){return i.TouchCamera}),n.d(t,"ArcRotateCamera",function(){return i.ArcRotateCamera}),n.d(t,"ArcRotateCameraInputsManager",function(){return i.ArcRotateCameraInputsManager}),n.d(t,"DeviceOrientationCamera",function(){return i.DeviceOrientationCamera}),n.d(t,"FlyCamera",function(){return i.FlyCamera}),n.d(t,"FlyCameraInputsManager",function(){return i.FlyCameraInputsManager}),n.d(t,"FollowCamera",function(){return i.FollowCamera}),n.d(t,"ArcFollowCamera",function(){return i.ArcFollowCamera}),n.d(t,"GamepadCamera",function(){return i.GamepadCamera}),n.d(t,"UniversalCamera",function(){return i.UniversalCamera}),n.d(t,"VirtualJoysticksCamera",function(){return i.VirtualJoysticksCamera}),n.d(t,"Collider",function(){return i.Collider}),n.d(t,"DefaultCollisionCoordinator",function(){return i.DefaultCollisionCoordinator}),n.d(t,"PickingInfo",function(){return i.PickingInfo}),n.d(t,"IntersectionInfo",function(){return i.IntersectionInfo}),n.d(t,"_MeshCollisionData",function(){return i._MeshCollisionData}),n.d(t,"BoundingBox",function(){return i.BoundingBox}),n.d(t,"BoundingInfo",function(){return i.BoundingInfo}),n.d(t,"BoundingSphere",function(){return i.BoundingSphere}),n.d(t,"Ray",function(){return i.Ray}),n.d(t,"AxesViewer",function(){return i.AxesViewer}),n.d(t,"BoneAxesViewer",function(){return i.BoneAxesViewer}),n.d(t,"DebugLayer",function(){return i.DebugLayer}),n.d(t,"PhysicsViewer",function(){return i.PhysicsViewer}),n.d(t,"RayHelper",function(){return i.RayHelper}),n.d(t,"SkeletonViewer",function(){return i.SkeletonViewer}),n.d(t,"Constants",function(){return i.Constants}),n.d(t,"InstancingAttributeInfo",function(){return i.InstancingAttributeInfo}),n.d(t,"DepthTextureCreationOptions",function(){return i.DepthTextureCreationOptions}),n.d(t,"EngineCapabilities",function(){return i.EngineCapabilities}),n.d(t,"Engine",function(){return i.Engine}),n.d(t,"EngineStore",function(){return i.EngineStore}),n.d(t,"NullEngineOptions",function(){return i.NullEngineOptions}),n.d(t,"NullEngine",function(){return i.NullEngine}),n.d(t,"WebGLPipelineContext",function(){return i.WebGLPipelineContext}),n.d(t,"KeyboardEventTypes",function(){return i.KeyboardEventTypes}),n.d(t,"KeyboardInfo",function(){return i.KeyboardInfo}),n.d(t,"KeyboardInfoPre",function(){return i.KeyboardInfoPre}),n.d(t,"PointerEventTypes",function(){return i.PointerEventTypes}),n.d(t,"PointerInfoBase",function(){return i.PointerInfoBase}),n.d(t,"PointerInfoPre",function(){return i.PointerInfoPre}),n.d(t,"PointerInfo",function(){return i.PointerInfo}),n.d(t,"ClipboardEventTypes",function(){return i.ClipboardEventTypes}),n.d(t,"ClipboardInfo",function(){return i.ClipboardInfo}),n.d(t,"DaydreamController",function(){return i.DaydreamController}),n.d(t,"GearVRController",function(){return i.GearVRController}),n.d(t,"GenericController",function(){return i.GenericController}),n.d(t,"OculusTouchController",function(){return i.OculusTouchController}),n.d(t,"PoseEnabledControllerType",function(){return i.PoseEnabledControllerType}),n.d(t,"PoseEnabledControllerHelper",function(){return i.PoseEnabledControllerHelper}),n.d(t,"PoseEnabledController",function(){return i.PoseEnabledController}),n.d(t,"ViveController",function(){return i.ViveController}),n.d(t,"WebVRController",function(){return i.WebVRController}),n.d(t,"WindowsMotionController",function(){return i.WindowsMotionController}),n.d(t,"StickValues",function(){return i.StickValues}),n.d(t,"Gamepad",function(){return i.Gamepad}),n.d(t,"GenericPad",function(){return i.GenericPad}),n.d(t,"GamepadManager",function(){return i.GamepadManager}),n.d(t,"GamepadSystemSceneComponent",function(){return i.GamepadSystemSceneComponent}),n.d(t,"Xbox360Button",function(){return i.Xbox360Button}),n.d(t,"Xbox360Dpad",function(){return i.Xbox360Dpad}),n.d(t,"Xbox360Pad",function(){return i.Xbox360Pad}),n.d(t,"AxisDragGizmo",function(){return i.AxisDragGizmo}),n.d(t,"AxisScaleGizmo",function(){return i.AxisScaleGizmo}),n.d(t,"BoundingBoxGizmo",function(){return i.BoundingBoxGizmo}),n.d(t,"Gizmo",function(){return i.Gizmo}),n.d(t,"GizmoManager",function(){return i.GizmoManager}),n.d(t,"PlaneRotationGizmo",function(){return i.PlaneRotationGizmo}),n.d(t,"PositionGizmo",function(){return i.PositionGizmo}),n.d(t,"RotationGizmo",function(){return i.RotationGizmo}),n.d(t,"ScaleGizmo",function(){return i.ScaleGizmo}),n.d(t,"LightGizmo",function(){return i.LightGizmo}),n.d(t,"EnvironmentHelper",function(){return i.EnvironmentHelper}),n.d(t,"PhotoDome",function(){return i.PhotoDome}),n.d(t,"_forceSceneHelpersToBundle",function(){return i._forceSceneHelpersToBundle}),n.d(t,"VideoDome",function(){return i.VideoDome}),n.d(t,"EngineInstrumentation",function(){return i.EngineInstrumentation}),n.d(t,"SceneInstrumentation",function(){return i.SceneInstrumentation}),n.d(t,"_TimeToken",function(){return i._TimeToken}),n.d(t,"EffectLayer",function(){return i.EffectLayer}),n.d(t,"EffectLayerSceneComponent",function(){return i.EffectLayerSceneComponent}),n.d(t,"GlowLayer",function(){return i.GlowLayer}),n.d(t,"HighlightLayer",function(){return i.HighlightLayer}),n.d(t,"Layer",function(){return i.Layer}),n.d(t,"LayerSceneComponent",function(){return i.LayerSceneComponent}),n.d(t,"LensFlare",function(){return i.LensFlare}),n.d(t,"LensFlareSystem",function(){return i.LensFlareSystem}),n.d(t,"LensFlareSystemSceneComponent",function(){return i.LensFlareSystemSceneComponent}),n.d(t,"Light",function(){return i.Light}),n.d(t,"ShadowLight",function(){return i.ShadowLight}),n.d(t,"DirectionalLight",function(){return i.DirectionalLight}),n.d(t,"HemisphericLight",function(){return i.HemisphericLight}),n.d(t,"PointLight",function(){return i.PointLight}),n.d(t,"SpotLight",function(){return i.SpotLight}),n.d(t,"DefaultLoadingScreen",function(){return i.DefaultLoadingScreen}),n.d(t,"SceneLoaderProgressEvent",function(){return i.SceneLoaderProgressEvent}),n.d(t,"SceneLoader",function(){return i.SceneLoader}),n.d(t,"SceneLoaderFlags",function(){return i.SceneLoaderFlags}),n.d(t,"ColorCurves",function(){return i.ColorCurves}),n.d(t,"EffectFallbacks",function(){return i.EffectFallbacks}),n.d(t,"EffectCreationOptions",function(){return i.EffectCreationOptions}),n.d(t,"Effect",function(){return i.Effect}),n.d(t,"FresnelParameters",function(){return i.FresnelParameters}),n.d(t,"ImageProcessingConfigurationDefines",function(){return i.ImageProcessingConfigurationDefines}),n.d(t,"ImageProcessingConfiguration",function(){return i.ImageProcessingConfiguration}),n.d(t,"Material",function(){return i.Material}),n.d(t,"MaterialDefines",function(){return i.MaterialDefines}),n.d(t,"MaterialHelper",function(){return i.MaterialHelper}),n.d(t,"MultiMaterial",function(){return i.MultiMaterial}),n.d(t,"PushMaterial",function(){return i.PushMaterial}),n.d(t,"ShaderMaterial",function(){return i.ShaderMaterial}),n.d(t,"StandardMaterialDefines",function(){return i.StandardMaterialDefines}),n.d(t,"StandardMaterial",function(){return i.StandardMaterial}),n.d(t,"BaseTexture",function(){return i.BaseTexture}),n.d(t,"CubeTexture",function(){return i.CubeTexture}),n.d(t,"EquiRectangularCubeTexture",function(){return i.EquiRectangularCubeTexture}),n.d(t,"HDRCubeTexture",function(){return i.HDRCubeTexture}),n.d(t,"InternalTexture",function(){return i.InternalTexture}),n.d(t,"MirrorTexture",function(){return i.MirrorTexture}),n.d(t,"MultiRenderTarget",function(){return i.MultiRenderTarget}),n.d(t,"RenderTargetTexture",function(){return i.RenderTargetTexture}),n.d(t,"Texture",function(){return i.Texture}),n.d(t,"UniformBuffer",function(){return i.UniformBuffer}),n.d(t,"MaterialFlags",function(){return i.MaterialFlags}),n.d(t,"Scalar",function(){return i.Scalar}),n.d(t,"ToGammaSpace",function(){return i.ToGammaSpace}),n.d(t,"ToLinearSpace",function(){return i.ToLinearSpace}),n.d(t,"Epsilon",function(){return i.Epsilon}),n.d(t,"Color3",function(){return i.Color3}),n.d(t,"Color4",function(){return i.Color4}),n.d(t,"Vector2",function(){return i.Vector2}),n.d(t,"Vector3",function(){return i.Vector3}),n.d(t,"Vector4",function(){return i.Vector4}),n.d(t,"Size",function(){return i.Size}),n.d(t,"Quaternion",function(){return i.Quaternion}),n.d(t,"Matrix",function(){return i.Matrix}),n.d(t,"Plane",function(){return i.Plane}),n.d(t,"Viewport",function(){return i.Viewport}),n.d(t,"Frustum",function(){return i.Frustum}),n.d(t,"Space",function(){return i.Space}),n.d(t,"Axis",function(){return i.Axis}),n.d(t,"BezierCurve",function(){return i.BezierCurve}),n.d(t,"Orientation",function(){return i.Orientation}),n.d(t,"Angle",function(){return i.Angle}),n.d(t,"Arc2",function(){return i.Arc2}),n.d(t,"Path2",function(){return i.Path2}),n.d(t,"Path3D",function(){return i.Path3D}),n.d(t,"Curve3",function(){return i.Curve3}),n.d(t,"PositionNormalVertex",function(){return i.PositionNormalVertex}),n.d(t,"PositionNormalTextureVertex",function(){return i.PositionNormalTextureVertex}),n.d(t,"Tmp",function(){return i.Tmp}),n.d(t,"SphericalHarmonics",function(){return i.SphericalHarmonics}),n.d(t,"SphericalPolynomial",function(){return i.SphericalPolynomial}),n.d(t,"AbstractMesh",function(){return i.AbstractMesh}),n.d(t,"Buffer",function(){return i.Buffer}),n.d(t,"VertexBuffer",function(){return i.VertexBuffer}),n.d(t,"CSG",function(){return i.CSG}),n.d(t,"Geometry",function(){return i.Geometry}),n.d(t,"GroundMesh",function(){return i.GroundMesh}),n.d(t,"TrailMesh",function(){return i.TrailMesh}),n.d(t,"InstancedMesh",function(){return i.InstancedMesh}),n.d(t,"LinesMesh",function(){return i.LinesMesh}),n.d(t,"InstancedLinesMesh",function(){return i.InstancedLinesMesh}),n.d(t,"_CreationDataStorage",function(){return i._CreationDataStorage}),n.d(t,"_InstancesBatch",function(){return i._InstancesBatch}),n.d(t,"Mesh",function(){return i.Mesh}),n.d(t,"VertexData",function(){return i.VertexData}),n.d(t,"MeshBuilder",function(){return i.MeshBuilder}),n.d(t,"SimplificationSettings",function(){return i.SimplificationSettings}),n.d(t,"SimplificationQueue",function(){return i.SimplificationQueue}),n.d(t,"SimplificationType",function(){return i.SimplificationType}),n.d(t,"SimplicationQueueSceneComponent",function(){return i.SimplicationQueueSceneComponent}),n.d(t,"Polygon",function(){return i.Polygon}),n.d(t,"PolygonMeshBuilder",function(){return i.PolygonMeshBuilder}),n.d(t,"BaseSubMesh",function(){return i.BaseSubMesh}),n.d(t,"SubMesh",function(){return i.SubMesh}),n.d(t,"MeshLODLevel",function(){return i.MeshLODLevel}),n.d(t,"TransformNode",function(){return i.TransformNode}),n.d(t,"BoxBuilder",function(){return i.BoxBuilder}),n.d(t,"SphereBuilder",function(){return i.SphereBuilder}),n.d(t,"CylinderBuilder",function(){return i.CylinderBuilder}),n.d(t,"LinesBuilder",function(){return i.LinesBuilder}),n.d(t,"PlaneBuilder",function(){return i.PlaneBuilder}),n.d(t,"DataBuffer",function(){return i.DataBuffer}),n.d(t,"WebGLDataBuffer",function(){return i.WebGLDataBuffer}),n.d(t,"MorphTarget",function(){return i.MorphTarget}),n.d(t,"MorphTargetManager",function(){return i.MorphTargetManager}),n.d(t,"Database",function(){return i.Database}),n.d(t,"BaseParticleSystem",function(){return i.BaseParticleSystem}),n.d(t,"GPUParticleSystem",function(){return i.GPUParticleSystem}),n.d(t,"Particle",function(){return i.Particle}),n.d(t,"ParticleHelper",function(){return i.ParticleHelper}),n.d(t,"ParticleSystem",function(){return i.ParticleSystem}),n.d(t,"_IDoNeedToBeInTheBuild",function(){return i._IDoNeedToBeInTheBuild}),n.d(t,"ParticleSystemSet",function(){return i.ParticleSystemSet}),n.d(t,"SolidParticle",function(){return i.SolidParticle}),n.d(t,"ModelShape",function(){return i.ModelShape}),n.d(t,"DepthSortedParticle",function(){return i.DepthSortedParticle}),n.d(t,"SolidParticleSystem",function(){return i.SolidParticleSystem}),n.d(t,"SubEmitterType",function(){return i.SubEmitterType}),n.d(t,"SubEmitter",function(){return i.SubEmitter}),n.d(t,"PhysicsEngine",function(){return i.PhysicsEngine}),n.d(t,"PhysicsEngineSceneComponent",function(){return i.PhysicsEngineSceneComponent}),n.d(t,"PhysicsHelper",function(){return i.PhysicsHelper}),n.d(t,"PhysicsRadialExplosionEventOptions",function(){return i.PhysicsRadialExplosionEventOptions}),n.d(t,"PhysicsUpdraftEventOptions",function(){return i.PhysicsUpdraftEventOptions}),n.d(t,"PhysicsVortexEventOptions",function(){return i.PhysicsVortexEventOptions}),n.d(t,"PhysicsRadialImpulseFalloff",function(){return i.PhysicsRadialImpulseFalloff}),n.d(t,"PhysicsUpdraftMode",function(){return i.PhysicsUpdraftMode}),n.d(t,"PhysicsImpostor",function(){return i.PhysicsImpostor}),n.d(t,"PhysicsJoint",function(){return i.PhysicsJoint}),n.d(t,"DistanceJoint",function(){return i.DistanceJoint}),n.d(t,"MotorEnabledJoint",function(){return i.MotorEnabledJoint}),n.d(t,"HingeJoint",function(){return i.HingeJoint}),n.d(t,"Hinge2Joint",function(){return i.Hinge2Joint}),n.d(t,"AnaglyphPostProcess",function(){return i.AnaglyphPostProcess}),n.d(t,"BlackAndWhitePostProcess",function(){return i.BlackAndWhitePostProcess}),n.d(t,"BloomEffect",function(){return i.BloomEffect}),n.d(t,"BloomMergePostProcess",function(){return i.BloomMergePostProcess}),n.d(t,"BlurPostProcess",function(){return i.BlurPostProcess}),n.d(t,"ChromaticAberrationPostProcess",function(){return i.ChromaticAberrationPostProcess}),n.d(t,"CircleOfConfusionPostProcess",function(){return i.CircleOfConfusionPostProcess}),n.d(t,"ColorCorrectionPostProcess",function(){return i.ColorCorrectionPostProcess}),n.d(t,"ConvolutionPostProcess",function(){return i.ConvolutionPostProcess}),n.d(t,"DepthOfFieldBlurPostProcess",function(){return i.DepthOfFieldBlurPostProcess}),n.d(t,"DepthOfFieldEffectBlurLevel",function(){return i.DepthOfFieldEffectBlurLevel}),n.d(t,"DepthOfFieldEffect",function(){return i.DepthOfFieldEffect}),n.d(t,"DepthOfFieldMergePostProcessOptions",function(){return i.DepthOfFieldMergePostProcessOptions}),n.d(t,"DepthOfFieldMergePostProcess",function(){return i.DepthOfFieldMergePostProcess}),n.d(t,"DisplayPassPostProcess",function(){return i.DisplayPassPostProcess}),n.d(t,"ExtractHighlightsPostProcess",function(){return i.ExtractHighlightsPostProcess}),n.d(t,"FilterPostProcess",function(){return i.FilterPostProcess}),n.d(t,"FxaaPostProcess",function(){return i.FxaaPostProcess}),n.d(t,"GrainPostProcess",function(){return i.GrainPostProcess}),n.d(t,"HighlightsPostProcess",function(){return i.HighlightsPostProcess}),n.d(t,"ImageProcessingPostProcess",function(){return i.ImageProcessingPostProcess}),n.d(t,"MotionBlurPostProcess",function(){return i.MotionBlurPostProcess}),n.d(t,"PassPostProcess",function(){return i.PassPostProcess}),n.d(t,"PassCubePostProcess",function(){return i.PassCubePostProcess}),n.d(t,"PostProcess",function(){return i.PostProcess}),n.d(t,"PostProcessManager",function(){return i.PostProcessManager}),n.d(t,"RefractionPostProcess",function(){return i.RefractionPostProcess}),n.d(t,"SharpenPostProcess",function(){return i.SharpenPostProcess}),n.d(t,"StereoscopicInterlacePostProcess",function(){return i.StereoscopicInterlacePostProcess}),n.d(t,"TonemappingOperator",function(){return i.TonemappingOperator}),n.d(t,"TonemapPostProcess",function(){return i.TonemapPostProcess}),n.d(t,"VolumetricLightScatteringPostProcess",function(){return i.VolumetricLightScatteringPostProcess}),n.d(t,"VRDistortionCorrectionPostProcess",function(){return i.VRDistortionCorrectionPostProcess}),n.d(t,"VRMultiviewToSingleviewPostProcess",function(){return i.VRMultiviewToSingleviewPostProcess}),n.d(t,"ReflectionProbe",function(){return i.ReflectionProbe}),n.d(t,"BoundingBoxRenderer",function(){return i.BoundingBoxRenderer}),n.d(t,"DepthRenderer",function(){return i.DepthRenderer}),n.d(t,"DepthRendererSceneComponent",function(){return i.DepthRendererSceneComponent}),n.d(t,"EdgesRenderer",function(){return i.EdgesRenderer}),n.d(t,"LineEdgesRenderer",function(){return i.LineEdgesRenderer}),n.d(t,"GeometryBufferRenderer",function(){return i.GeometryBufferRenderer}),n.d(t,"GeometryBufferRendererSceneComponent",function(){return i.GeometryBufferRendererSceneComponent}),n.d(t,"OutlineRenderer",function(){return i.OutlineRenderer}),n.d(t,"RenderingGroup",function(){return i.RenderingGroup}),n.d(t,"RenderingGroupInfo",function(){return i.RenderingGroupInfo}),n.d(t,"RenderingManager",function(){return i.RenderingManager}),n.d(t,"UtilityLayerRenderer",function(){return i.UtilityLayerRenderer}),n.d(t,"Sprite",function(){return i.Sprite}),n.d(t,"SpriteManager",function(){return i.SpriteManager}),n.d(t,"SpriteSceneComponent",function(){return i.SpriteSceneComponent}),n.d(t,"_AlphaState",function(){return i._AlphaState}),n.d(t,"_DepthCullingState",function(){return i._DepthCullingState}),n.d(t,"_StencilState",function(){return i._StencilState}),n.d(t,"AndOrNotEvaluator",function(){return i.AndOrNotEvaluator}),n.d(t,"AssetTaskState",function(){return i.AssetTaskState}),n.d(t,"AbstractAssetTask",function(){return i.AbstractAssetTask}),n.d(t,"AssetsProgressEvent",function(){return i.AssetsProgressEvent}),n.d(t,"MeshAssetTask",function(){return i.MeshAssetTask}),n.d(t,"TextFileAssetTask",function(){return i.TextFileAssetTask}),n.d(t,"BinaryFileAssetTask",function(){return i.BinaryFileAssetTask}),n.d(t,"ImageAssetTask",function(){return i.ImageAssetTask}),n.d(t,"TextureAssetTask",function(){return i.TextureAssetTask}),n.d(t,"CubeTextureAssetTask",function(){return i.CubeTextureAssetTask}),n.d(t,"HDRCubeTextureAssetTask",function(){return i.HDRCubeTextureAssetTask}),n.d(t,"EquiRectangularCubeTextureAssetTask",function(){return i.EquiRectangularCubeTextureAssetTask}),n.d(t,"AssetsManager",function(){return i.AssetsManager}),n.d(t,"DDSTools",function(){return i.DDSTools}),n.d(t,"expandToProperty",function(){return i.expandToProperty}),n.d(t,"serialize",function(){return i.serialize}),n.d(t,"serializeAsTexture",function(){return i.serializeAsTexture}),n.d(t,"serializeAsColor3",function(){return i.serializeAsColor3}),n.d(t,"serializeAsFresnelParameters",function(){return i.serializeAsFresnelParameters}),n.d(t,"serializeAsVector2",function(){return i.serializeAsVector2}),n.d(t,"serializeAsVector3",function(){return i.serializeAsVector3}),n.d(t,"serializeAsMeshReference",function(){return i.serializeAsMeshReference}),n.d(t,"serializeAsColorCurves",function(){return i.serializeAsColorCurves}),n.d(t,"serializeAsColor4",function(){return i.serializeAsColor4}),n.d(t,"serializeAsImageProcessingConfiguration",function(){return i.serializeAsImageProcessingConfiguration}),n.d(t,"serializeAsQuaternion",function(){return i.serializeAsQuaternion}),n.d(t,"serializeAsMatrix",function(){return i.serializeAsMatrix}),n.d(t,"serializeAsCameraReference",function(){return i.serializeAsCameraReference}),n.d(t,"SerializationHelper",function(){return i.SerializationHelper}),n.d(t,"Deferred",function(){return i.Deferred}),n.d(t,"EnvironmentTextureTools",function(){return i.EnvironmentTextureTools}),n.d(t,"MeshExploder",function(){return i.MeshExploder}),n.d(t,"FilesInput",function(){return i.FilesInput}),n.d(t,"KhronosTextureContainer",function(){return i.KhronosTextureContainer}),n.d(t,"EventState",function(){return i.EventState}),n.d(t,"Observer",function(){return i.Observer}),n.d(t,"MultiObserver",function(){return i.MultiObserver}),n.d(t,"Observable",function(){return i.Observable}),n.d(t,"PerformanceMonitor",function(){return i.PerformanceMonitor}),n.d(t,"RollingAverage",function(){return i.RollingAverage}),n.d(t,"PromisePolyfill",function(){return i.PromisePolyfill}),n.d(t,"SceneOptimization",function(){return i.SceneOptimization}),n.d(t,"TextureOptimization",function(){return i.TextureOptimization}),n.d(t,"HardwareScalingOptimization",function(){return i.HardwareScalingOptimization}),n.d(t,"ShadowsOptimization",function(){return i.ShadowsOptimization}),n.d(t,"PostProcessesOptimization",function(){return i.PostProcessesOptimization}),n.d(t,"LensFlaresOptimization",function(){return i.LensFlaresOptimization}),n.d(t,"CustomOptimization",function(){return i.CustomOptimization}),n.d(t,"ParticlesOptimization",function(){return i.ParticlesOptimization}),n.d(t,"RenderTargetsOptimization",function(){return i.RenderTargetsOptimization}),n.d(t,"MergeMeshesOptimization",function(){return i.MergeMeshesOptimization}),n.d(t,"SceneOptimizerOptions",function(){return i.SceneOptimizerOptions}),n.d(t,"SceneOptimizer",function(){return i.SceneOptimizer}),n.d(t,"SceneSerializer",function(){return i.SceneSerializer}),n.d(t,"SmartArray",function(){return i.SmartArray}),n.d(t,"SmartArrayNoDuplicate",function(){return i.SmartArrayNoDuplicate}),n.d(t,"StringDictionary",function(){return i.StringDictionary}),n.d(t,"Tags",function(){return i.Tags}),n.d(t,"TextureTools",function(){return i.TextureTools}),n.d(t,"TGATools",function(){return i.TGATools}),n.d(t,"ColorGradient",function(){return i.ColorGradient}),n.d(t,"Color3Gradient",function(){return i.Color3Gradient}),n.d(t,"FactorGradient",function(){return i.FactorGradient}),n.d(t,"LoadFileError",function(){return i.LoadFileError}),n.d(t,"RetryStrategy",function(){return i.RetryStrategy}),n.d(t,"Tools",function(){return i.Tools}),n.d(t,"PerfCounter",function(){return i.PerfCounter}),n.d(t,"className",function(){return i.className}),n.d(t,"AsyncLoop",function(){return i.AsyncLoop}),n.d(t,"VideoRecorder",function(){return i.VideoRecorder}),n.d(t,"JoystickAxis",function(){return i.JoystickAxis}),n.d(t,"VirtualJoystick",function(){return i.VirtualJoystick}),n.d(t,"WorkerPool",function(){return i.WorkerPool}),n.d(t,"Logger",function(){return i.Logger}),n.d(t,"_TypeStore",function(){return i._TypeStore}),n.d(t,"FilesInputStore",function(){return i.FilesInputStore}),n.d(t,"DeepCopier",function(){return i.DeepCopier}),n.d(t,"PivotTools",function(){return i.PivotTools}),n.d(t,"PrecisionDate",function(){return i.PrecisionDate}),n.d(t,"ScreenshotTools",function(){return i.ScreenshotTools}),n.d(t,"WebRequest",function(){return i.WebRequest}),n.d(t,"InspectableType",function(){return i.InspectableType}),n.d(t,"AutoRotationBehavior",function(){return i.AutoRotationBehavior}),n.d(t,"BouncingBehavior",function(){return i.BouncingBehavior}),n.d(t,"FramingBehavior",function(){return i.FramingBehavior}),n.d(t,"AttachToBoxBehavior",function(){return i.AttachToBoxBehavior}),n.d(t,"FadeInOutBehavior",function(){return i.FadeInOutBehavior}),n.d(t,"MultiPointerScaleBehavior",function(){return i.MultiPointerScaleBehavior}),n.d(t,"PointerDragBehavior",function(){return i.PointerDragBehavior}),n.d(t,"SixDofDragBehavior",function(){return i.SixDofDragBehavior}),n.d(t,"ArcRotateCameraGamepadInput",function(){return i.ArcRotateCameraGamepadInput}),n.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return i.ArcRotateCameraKeyboardMoveInput}),n.d(t,"ArcRotateCameraMouseWheelInput",function(){return i.ArcRotateCameraMouseWheelInput}),n.d(t,"ArcRotateCameraPointersInput",function(){return i.ArcRotateCameraPointersInput}),n.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return i.ArcRotateCameraVRDeviceOrientationInput}),n.d(t,"FlyCameraKeyboardInput",function(){return i.FlyCameraKeyboardInput}),n.d(t,"FlyCameraMouseInput",function(){return i.FlyCameraMouseInput}),n.d(t,"FollowCameraKeyboardMoveInput",function(){return i.FollowCameraKeyboardMoveInput}),n.d(t,"FollowCameraMouseWheelInput",function(){return i.FollowCameraMouseWheelInput}),n.d(t,"FollowCameraPointersInput",function(){return i.FollowCameraPointersInput}),n.d(t,"FreeCameraDeviceOrientationInput",function(){return i.FreeCameraDeviceOrientationInput}),n.d(t,"FreeCameraGamepadInput",function(){return i.FreeCameraGamepadInput}),n.d(t,"FreeCameraKeyboardMoveInput",function(){return i.FreeCameraKeyboardMoveInput}),n.d(t,"FreeCameraMouseInput",function(){return i.FreeCameraMouseInput}),n.d(t,"FreeCameraTouchInput",function(){return i.FreeCameraTouchInput}),n.d(t,"FreeCameraVirtualJoystickInput",function(){return i.FreeCameraVirtualJoystickInput}),n.d(t,"AnaglyphArcRotateCamera",function(){return i.AnaglyphArcRotateCamera}),n.d(t,"AnaglyphFreeCamera",function(){return i.AnaglyphFreeCamera}),n.d(t,"AnaglyphGamepadCamera",function(){return i.AnaglyphGamepadCamera}),n.d(t,"AnaglyphUniversalCamera",function(){return i.AnaglyphUniversalCamera}),n.d(t,"StereoscopicArcRotateCamera",function(){return i.StereoscopicArcRotateCamera}),n.d(t,"StereoscopicFreeCamera",function(){return i.StereoscopicFreeCamera}),n.d(t,"StereoscopicGamepadCamera",function(){return i.StereoscopicGamepadCamera}),n.d(t,"StereoscopicUniversalCamera",function(){return i.StereoscopicUniversalCamera}),n.d(t,"VRCameraMetrics",function(){return i.VRCameraMetrics}),n.d(t,"VRDeviceOrientationArcRotateCamera",function(){return i.VRDeviceOrientationArcRotateCamera}),n.d(t,"VRDeviceOrientationFreeCamera",function(){return i.VRDeviceOrientationFreeCamera}),n.d(t,"VRDeviceOrientationGamepadCamera",function(){return i.VRDeviceOrientationGamepadCamera}),n.d(t,"OnAfterEnteringVRObservableEvent",function(){return i.OnAfterEnteringVRObservableEvent}),n.d(t,"VRExperienceHelper",function(){return i.VRExperienceHelper}),n.d(t,"WebVRFreeCamera",function(){return i.WebVRFreeCamera}),n.d(t,"WebXRCamera",function(){return i.WebXRCamera}),n.d(t,"WebXREnterExitUIButton",function(){return i.WebXREnterExitUIButton}),n.d(t,"WebXREnterExitUIOptions",function(){return i.WebXREnterExitUIOptions}),n.d(t,"WebXREnterExitUI",function(){return i.WebXREnterExitUI}),n.d(t,"WebXRState",function(){return i.WebXRState}),n.d(t,"WebXRExperienceHelper",function(){return i.WebXRExperienceHelper}),n.d(t,"WebXRController",function(){return i.WebXRController}),n.d(t,"WebXRInput",function(){return i.WebXRInput}),n.d(t,"WebXRManagedOutputCanvas",function(){return i.WebXRManagedOutputCanvas}),n.d(t,"WebXRSessionManager",function(){return i.WebXRSessionManager}),n.d(t,"Octree",function(){return i.Octree}),n.d(t,"OctreeBlock",function(){return i.OctreeBlock}),n.d(t,"OctreeSceneComponent",function(){return i.OctreeSceneComponent}),n.d(t,"_OcclusionDataStorage",function(){return i._OcclusionDataStorage}),n.d(t,"_forceTransformFeedbackToBundle",function(){return i._forceTransformFeedbackToBundle}),n.d(t,"ShadowGenerator",function(){return i.ShadowGenerator}),n.d(t,"ShadowGeneratorSceneComponent",function(){return i.ShadowGeneratorSceneComponent}),n.d(t,"_BabylonLoaderRegistered",function(){return i._BabylonLoaderRegistered}),n.d(t,"BackgroundMaterial",function(){return i.BackgroundMaterial}),n.d(t,"PBRMaterialDefines",function(){return i.PBRMaterialDefines}),n.d(t,"PBRBaseMaterial",function(){return i.PBRBaseMaterial}),n.d(t,"PBRBaseSimpleMaterial",function(){return i.PBRBaseSimpleMaterial}),n.d(t,"PBRMaterial",function(){return i.PBRMaterial}),n.d(t,"PBRMetallicRoughnessMaterial",function(){return i.PBRMetallicRoughnessMaterial}),n.d(t,"PBRSpecularGlossinessMaterial",function(){return i.PBRSpecularGlossinessMaterial}),n.d(t,"ColorGradingTexture",function(){return i.ColorGradingTexture}),n.d(t,"DynamicTexture",function(){return i.DynamicTexture}),n.d(t,"ProceduralTexture",function(){return i.ProceduralTexture}),n.d(t,"RawCubeTexture",function(){return i.RawCubeTexture}),n.d(t,"RawTexture",function(){return i.RawTexture}),n.d(t,"RawTexture3D",function(){return i.RawTexture3D}),n.d(t,"RefractionTexture",function(){return i.RefractionTexture}),n.d(t,"VideoTexture",function(){return i.VideoTexture}),n.d(t,"HtmlElementTexture",function(){return i.HtmlElementTexture}),n.d(t,"DracoCompression",function(){return i.DracoCompression}),n.d(t,"DiscBuilder",function(){return i.DiscBuilder}),n.d(t,"RibbonBuilder",function(){return i.RibbonBuilder}),n.d(t,"HemisphereBuilder",function(){return i.HemisphereBuilder}),n.d(t,"TorusBuilder",function(){return i.TorusBuilder}),n.d(t,"TorusKnotBuilder",function(){return i.TorusKnotBuilder}),n.d(t,"PolygonBuilder",function(){return i.PolygonBuilder}),n.d(t,"ShapeBuilder",function(){return i.ShapeBuilder}),n.d(t,"LatheBuilder",function(){return i.LatheBuilder}),n.d(t,"GroundBuilder",function(){return i.GroundBuilder}),n.d(t,"TubeBuilder",function(){return i.TubeBuilder}),n.d(t,"PolyhedronBuilder",function(){return i.PolyhedronBuilder}),n.d(t,"IcoSphereBuilder",function(){return i.IcoSphereBuilder}),n.d(t,"DecalBuilder",function(){return i.DecalBuilder}),n.d(t,"BoxParticleEmitter",function(){return i.BoxParticleEmitter}),n.d(t,"ConeParticleEmitter",function(){return i.ConeParticleEmitter}),n.d(t,"CylinderParticleEmitter",function(){return i.CylinderParticleEmitter}),n.d(t,"CylinderDirectedParticleEmitter",function(){return i.CylinderDirectedParticleEmitter}),n.d(t,"HemisphericParticleEmitter",function(){return i.HemisphericParticleEmitter}),n.d(t,"PointParticleEmitter",function(){return i.PointParticleEmitter}),n.d(t,"SphereParticleEmitter",function(){return i.SphereParticleEmitter}),n.d(t,"SphereDirectedParticleEmitter",function(){return i.SphereDirectedParticleEmitter}),n.d(t,"CannonJSPlugin",function(){return i.CannonJSPlugin}),n.d(t,"AmmoJSPlugin",function(){return i.AmmoJSPlugin}),n.d(t,"OimoJSPlugin",function(){return i.OimoJSPlugin}),n.d(t,"PostProcessRenderEffect",function(){return i.PostProcessRenderEffect}),n.d(t,"PostProcessRenderPipeline",function(){return i.PostProcessRenderPipeline}),n.d(t,"PostProcessRenderPipelineManager",function(){return i.PostProcessRenderPipelineManager}),n.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return i.PostProcessRenderPipelineManagerSceneComponent}),n.d(t,"CubeMapToSphericalPolynomialTools",function(){return i.CubeMapToSphericalPolynomialTools}),n.d(t,"HDRTools",function(){return i.HDRTools}),n.d(t,"PanoramaToCubeMapTools",function(){return i.PanoramaToCubeMapTools}),n.d(t,"_DDSTextureLoader",function(){return i._DDSTextureLoader}),n.d(t,"_ENVTextureLoader",function(){return i._ENVTextureLoader}),n.d(t,"_KTXTextureLoader",function(){return i._KTXTextureLoader}),n.d(t,"_TGATextureLoader",function(){return i._TGATextureLoader}),n.d(t,"CustomProceduralTexture",function(){return i.CustomProceduralTexture}),n.d(t,"NoiseProceduralTexture",function(){return i.NoiseProceduralTexture}),n.d(t,"ProceduralTextureSceneComponent",function(){return i.ProceduralTextureSceneComponent}),n.d(t,"DefaultRenderingPipeline",function(){return i.DefaultRenderingPipeline}),n.d(t,"LensRenderingPipeline",function(){return i.LensRenderingPipeline}),n.d(t,"SSAO2RenderingPipeline",function(){return i.SSAO2RenderingPipeline}),n.d(t,"SSAORenderingPipeline",function(){return i.SSAORenderingPipeline}),n.d(t,"StandardRenderingPipeline",function(){return i.StandardRenderingPipeline});var o=void 0!==e?e:"undefined"!=typeof window?window:void 0;if(void 0!==o){o.BABYLON=a,o.BABYLON=o.BABYLON||{};var a=o.BABYLON;a.Debug=a.Debug||{};var s=[];for(var l in r)a.Debug[l]=r[l],s.push(l);for(var l in i)a[l]=i[l]}var c={AxesViewer:r.AxesViewer,BoneAxesViewer:r.BoneAxesViewer,PhysicsViewer:r.PhysicsViewer,SkeletonViewer:r.SkeletonViewer}}).call(this,n(119))}])},ZESv:function(e,t,n){var i=n("yp9T"),r=n("0CSc");e.exports=function(e){if(!e)return{};var t={};return r(i(e).split("\n"),function(e){var n=e.indexOf(":"),r=i(e.slice(0,n)).toLowerCase(),o=i(e.slice(n+1));void 0===t[r]?t[r]=o:"[object Array]"===Object.prototype.toString.call(t[r])?t[r].push(o):t[r]=[t[r],o]}),t}},aI7X:function(e,t,n){"use strict";var i=Array.prototype.slice,r=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==r.call(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n,o=i.call(arguments,1),a=Math.max(0,t.length-o.length),s=[],l=0;l<a;l++)s.push("$"+l);if(n=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof n){var r=t.apply(this,o.concat(i.call(arguments)));return Object(r)===r?r:this}return t.apply(e,o.concat(i.call(arguments)))}),t.prototype){var c=function(){};c.prototype=t.prototype,n.prototype=new c,c.prototype=null}return n}},b82y:function(e,t,n){var i;"undefined"!=typeof self?self:"undefined"!=typeof global&&global,e.exports=(i=n("Yzuk"),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,(function(t){return e[t]}).bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=i},function(e,t,n){"use strict";n.r(t);var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}var a,s=n(0),l=function(){function e(t,n,i){void 0===n&&(n=e.UNITMODE_PIXEL),void 0===i&&(i=!0),this.unit=n,this.negativeValueAllowed=i,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=t,this._originalUnit=n}return Object.defineProperty(e.prototype,"isPercentage",{get:function(){return this.unit===e.UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPixel",{get:function(){return this.unit===e.UNITMODE_PIXEL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalValue",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.getValueInPixel=function(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t},e.prototype.updateInPlace=function(t,n){return void 0===n&&(n=e.UNITMODE_PIXEL),this._value=t,this.unit=n,this},e.prototype.getValue=function(t){if(t&&!this.ignoreAdaptiveScaling&&this.unit!==e.UNITMODE_PERCENTAGE){var n=0,i=0;if(t.idealWidth&&(n=this._value*t.getSize().width/t.idealWidth),t.idealHeight&&(i=this._value*t.getSize().height/t.idealHeight),t.useSmallestIdeal&&t.idealWidth&&t.idealHeight)return window.innerWidth<window.innerHeight?n:i;if(t.idealWidth)return n;if(t.idealHeight)return i}return this._value},e.prototype.toString=function(t,n){switch(this.unit){case e.UNITMODE_PERCENTAGE:var i=100*this.getValue(t);return(n?i.toFixed(n):i)+"%";case e.UNITMODE_PIXEL:var r=this.getValue(t);return(n?r.toFixed(n):r)+"px"}return this.unit.toString()},e.prototype.fromString=function(t){var n=e._Regex.exec(t.toString());if(!n||0===n.length)return!1;var i=parseFloat(n[1]),r=this._originalUnit;if(this.negativeValueAllowed||i<0&&(i=0),4===n.length)switch(n[3]){case"px":r=e.UNITMODE_PIXEL;break;case"%":r=e.UNITMODE_PERCENTAGE,i/=100}return(i!==this._value||r!==this.unit)&&(this._value=i,this.unit=r,!0)},Object.defineProperty(e,"UNITMODE_PERCENTAGE",{get:function(){return e._UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UNITMODE_PIXEL",{get:function(){return e._UNITMODE_PIXEL},enumerable:!0,configurable:!0}),e._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,e._UNITMODE_PERCENTAGE=0,e._UNITMODE_PIXEL=1,e}(),c=function(){function e(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}return e.prototype.copyFrom=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i},e.CombineToRef=function(e,t,n){var i=Math.min(e.left,t.left),r=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),a=Math.max(e.top+e.height,t.top+t.height);n.left=i,n.top=r,n.width=o-i,n.height=a-r},e.prototype.transformToRef=function(e,t){for(var n=s.Polygon.Rectangle(this.left,this.top,this.left+this.width,this.top+this.height),i=new s.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),r=new s.Vector2(0,0),o=0;o<4;o++)e.transformCoordinates(n[o].x,n[o].y,n[o]),i.x=Math.floor(Math.min(i.x,n[o].x)),i.y=Math.floor(Math.min(i.y,n[o].y)),r.x=Math.ceil(Math.max(r.x,n[o].x)),r.y=Math.ceil(Math.max(r.y,n[o].y));t.left=i.x,t.top=i.y,t.width=r.x-i.x,t.height=r.y-i.y},e.prototype.isEqualsTo=function(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height},e.Empty=function(){return new e(0,0,0,0)},e}(),u=function(e){function t(t,n){void 0===n&&(n=0);var i=e.call(this,t.x,t.y)||this;return i.buttonIndex=n,i}return r(t,e),t}(s.Vector2),h=function(){function e(e,t,n,i,r,o){this.m=new Float32Array(6),this.fromValues(e,t,n,i,r,o)}return e.prototype.fromValues=function(e,t,n,i,r,o){return this.m[0]=e,this.m[1]=t,this.m[2]=n,this.m[3]=i,this.m[4]=r,this.m[5]=o,this},e.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},e.prototype.invertToRef=function(e){var t=this.m[0],n=this.m[1],i=this.m[2],r=this.m[3],o=this.m[4],a=this.m[5],l=this.determinant();if(l<s.Epsilon*s.Epsilon)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;var c=1/l,u=i*a-r*o,h=n*o-t*a;return e.m[0]=r*c,e.m[1]=-n*c,e.m[2]=-i*c,e.m[3]=t*c,e.m[4]=u*c,e.m[5]=h*c,this},e.prototype.multiplyToRef=function(e,t){var n=this.m[0],i=this.m[1],r=this.m[2],o=this.m[3],a=this.m[4],s=this.m[5],l=e.m[0],c=e.m[1],u=e.m[2],h=e.m[3],d=e.m[4],f=e.m[5];return t.m[0]=n*l+i*u,t.m[1]=n*c+i*h,t.m[2]=r*l+o*u,t.m[3]=r*c+o*h,t.m[4]=a*l+s*u+d,t.m[5]=a*c+s*h+f,this},e.prototype.transformCoordinates=function(e,t,n){return n.x=e*this.m[0]+t*this.m[2]+this.m[4],n.y=e*this.m[1]+t*this.m[3]+this.m[5],this},e.Identity=function(){return new e(1,0,0,1,0,0)},e.TranslationToRef=function(e,t,n){n.fromValues(1,0,0,1,e,t)},e.ScalingToRef=function(e,t,n){n.fromValues(e,0,0,t,0,0)},e.RotationToRef=function(e,t){var n=Math.sin(e),i=Math.cos(e);t.fromValues(i,n,-n,i,0,0)},e.ComposeToRef=function(t,n,i,r,o,a,s){e.TranslationToRef(t,n,e._TempPreTranslationMatrix),e.ScalingToRef(r,o,e._TempScalingMatrix),e.RotationToRef(i,e._TempRotationMatrix),e.TranslationToRef(-t,-n,e._TempPostTranslationMatrix),e._TempPreTranslationMatrix.multiplyToRef(e._TempScalingMatrix,e._TempCompose0),e._TempCompose0.multiplyToRef(e._TempRotationMatrix,e._TempCompose1),a?(e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,e._TempCompose2),e._TempCompose2.multiplyToRef(a,s)):e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,s)},e._TempPreTranslationMatrix=e.Identity(),e._TempPostTranslationMatrix=e.Identity(),e._TempRotationMatrix=e.Identity(),e._TempScalingMatrix=e.Identity(),e._TempCompose0=e.Identity(),e._TempCompose1=e.Identity(),e._TempCompose2=e.Identity(),e}(),d=function(){function e(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=c.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new l(18,l.UNITMODE_PIXEL,!1),this._width=new l(1,l.UNITMODE_PERCENTAGE,!1),this._height=new l(1,l.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=e.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=e.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=c.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=c.Empty(),this._cachedParentMeasure=c.Empty(),this._paddingLeft=new l(0),this._paddingRight=new l(0),this._paddingTop=new l(0),this._paddingBottom=new l(0),this._left=new l(0),this._top=new l(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=h.Identity(),this._invertTransformMatrix=h.Identity(),this._transformedPosition=s.Vector2.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=s.Vector2.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._rebuildLayout=!1,this._isClipped=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new l(0),this._linkOffsetY=new l(0),this.onPointerMoveObservable=new s.Observable,this.onPointerOutObservable=new s.Observable,this.onPointerDownObservable=new s.Observable,this.onPointerUpObservable=new s.Observable,this.onPointerClickObservable=new s.Observable,this.onPointerEnterObservable=new s.Observable,this.onDirtyObservable=new s.Observable,this.onBeforeDrawObservable=new s.Observable,this.onAfterDrawObservable=new s.Observable,this._tmpMeasureA=new c(0,0,0,0)}return Object.defineProperty(e.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(e){this._fontOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.width=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.height=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){var t=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add(function(){t._markAsDirty(),t._resetFontCache()})),this._markAsDirty(),this._resetFontCache()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSizeInPixels",{get:function(){var e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.fontSize=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color!==e&&(this._color=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(e){this._paddingLeft.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingLeft=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(e){this._paddingRight.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingRight=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(e){this._paddingTop.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingTop=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(e){this._paddingBottom.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingBottom=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(e){this._left.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.left=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(e){this._top.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.top=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.linkOffsetX=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.linkOffsetY=e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Control"},e.prototype.getAscendantOfClass=function(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null},e.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},e.prototype.isAscendant=function(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))},e.prototype.getLocalCoordinates=function(e){var t=s.Vector2.Zero();return this.getLocalCoordinatesToRef(e,t),t},e.prototype.getLocalCoordinatesToRef=function(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this},e.prototype.getParentLocalCoordinates=function(e){var t=s.Vector2.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t},e.prototype.moveToVector3=function(t,n){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP;var i=this._host._getGlobalViewport(n),r=s.Vector3.Project(t,s.Matrix.Identity(),n.getTransformMatrix(),i);this._moveToProjectedPosition(r),this.notRenderable=r.z<0||r.z>1}else s.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype._getDescendants=function(e,t,n){void 0===t&&(t=!1)},e.prototype.getDescendants=function(e,t){var n=new Array;return this._getDescendants(n,e,t),n},e.prototype.linkWithMesh=function(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)t&&s.Tools.Error("Cannot link a control to a mesh if the control is not at root level");else{var n=this._host._linkedControls.indexOf(this);if(-1!==n)return this._linkedMesh=t,void(t||this._host._linkedControls.splice(n,1));t&&(this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this))}},e.prototype._moveToProjectedPosition=function(e){var t=this._left.getValue(this._host),n=this._top.getValue(this._host),i=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,r=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(i-t)<.5&&(i=t),Math.abs(r-n)<.5&&(r=n)),this.left=i+"px",this.top=r+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},e.prototype._offsetLeft=function(e){this._isDirty=!0,this._currentMeasure.left+=e},e.prototype._offsetTop=function(e){this._isDirty=!0,this._currentMeasure.top+=e},e.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},e.prototype._flagDescendantsAsMatrixDirty=function(){},e.prototype._intersectsRect=function(e){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=e.left+e.width||this._tmpMeasureA.top>=e.top+e.height||this._tmpMeasureA.left+this._tmpMeasureA.width<=e.left||this._tmpMeasureA.top+this._tmpMeasureA.height<=e.top)},e.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),c.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var e=this.shadowOffsetX,t=this.shadowOffsetY,n=this.shadowBlur,i=Math.min(Math.min(e,0)-2*n,0),r=Math.max(Math.max(e,0)+2*n,0),o=Math.min(Math.min(t,0)-2*n,0),a=Math.max(Math.max(t,0)+2*n,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+i),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+a))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},e.prototype._markAsDirty=function(e){void 0===e&&(e=!1),(this._isVisible||e)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},e.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},e.prototype._link=function(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},e.prototype._transform=function(e){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,n=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,n),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-n)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==n)&&(this._cachedOffsetX=t,this._cachedOffsetY=n,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),h.ComposeToRef(-t,-n,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},e.prototype._renderHighlight=function(e){this.isHighlighted&&(e.save(),e.strokeStyle="#4affff",e.lineWidth=2,this._renderHighlightSpecific(e),e.restore())},e.prototype._renderHighlightSpecific=function(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},e.prototype._applyStates=function(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),this._color&&(t.fillStyle=this._color),e.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},e.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);var n=0;do{this._rebuildLayout=!1,this._processMeasures(e,t),n++}while(this._rebuildLayout&&n<3);n>=3&&s.Logger.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},e.prototype._processMeasures=function(e,t){this._currentMeasure.copyFrom(e),this._preMeasure(e,t),this._measure(),this._computeAlignment(e,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(e,t),this._cachedParentMeasure.copyFrom(e),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},e.prototype._evaluateClippingState=function(e){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>e.left+e.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<e.left)return void(this._isClipped=!0);if(this._currentMeasure.top>e.top+e.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<e.top)return void(this._isClipped=!0)}this._isClipped=!1},e.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host)},e.prototype._computeAlignment=function(t,n){var i=this._currentMeasure.width,r=this._currentMeasure.height,o=t.width,a=t.height,s=0,l=0;switch(this.horizontalAlignment){case e.HORIZONTAL_ALIGNMENT_LEFT:s=0;break;case e.HORIZONTAL_ALIGNMENT_RIGHT:s=o-i;break;case e.HORIZONTAL_ALIGNMENT_CENTER:s=(o-i)/2}switch(this.verticalAlignment){case e.VERTICAL_ALIGNMENT_TOP:l=0;break;case e.VERTICAL_ALIGNMENT_BOTTOM:l=a-r;break;case e.VERTICAL_ALIGNMENT_CENTER:l=(a-r)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=o*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=o*this._paddingLeft.getValue(this._host)),this._currentMeasure.width-=this._paddingRight.isPixel?this._paddingRight.getValue(this._host):o*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=a*this._paddingTop.getValue(this._host),this._currentMeasure.height-=a*this._paddingTop.getValue(this._host)),this._currentMeasure.height-=this._paddingBottom.isPixel?this._paddingBottom.getValue(this._host):a*this._paddingBottom.getValue(this._host),this._currentMeasure.left+=this._left.isPixel?this._left.getValue(this._host):o*this._left.getValue(this._host),this._currentMeasure.top+=this._top.isPixel?this._top.getValue(this._host):a*this._top.getValue(this._host),this._currentMeasure.left+=s,this._currentMeasure.top+=l},e.prototype._preMeasure=function(e,t){},e.prototype._additionalProcessing=function(e,t){},e.prototype._clipForChildren=function(e){},e.prototype._clip=function(t,n){if(t.beginPath(),e._ClipMeasure.copyFrom(this._currentMeasure),n){n.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var i=new c(0,0,0,0);i.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),i.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),i.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-i.left,i.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-i.top,e._ClipMeasure.copyFrom(i)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var r=this.shadowOffsetX,o=this.shadowOffsetY,a=this.shadowBlur,s=Math.min(Math.min(r,0)-2*a,0),l=Math.max(Math.max(r,0)+2*a,0),u=Math.min(Math.min(o,0)-2*a,0),h=Math.max(Math.max(o,0)+2*a,0);t.rect(e._ClipMeasure.left+s,e._ClipMeasure.top+u,e._ClipMeasure.width+l-s,e._ClipMeasure.height+h-u)}else t.rect(e._ClipMeasure.left,e._ClipMeasure.top,e._ClipMeasure.width,e._ClipMeasure.height);t.clip()},e.prototype._render=function(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},e.prototype._draw=function(e,t){},e.prototype.contains=function(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),t=this._transformedPosition.y,!((e=this._transformedPosition.x)<this._currentMeasure.left||e>this._currentMeasure.left+this._currentMeasure.width||t<this._currentMeasure.top||t>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))},e.prototype._processPicking=function(e,t,n,i,r){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(e,t)||(this._processObservables(n,e,t,i,r),0))},e.prototype._onPointerMove=function(e,t,n){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)&&null!=this.parent&&this.parent._onPointerMove(e,t,n)},e.prototype._onPointerEnter=function(e){return!(!this._isEnabled||this._enterCount>0||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this)&&null!=this.parent&&this.parent._onPointerEnter(e),0))},e.prototype._onPointerOut=function(e,t){if(void 0===t&&(t=!1),t||this._isEnabled&&e!==this){this._enterCount=0;var n=!0;e.isAscendant(this)||(n=this.onPointerOutObservable.notifyObservers(this,-1,e,this)),n&&null!=this.parent&&this.parent._onPointerOut(e,t)}},e.prototype._onPointerDown=function(e,t,n,i){return this._onPointerEnter(this),0===this._downCount&&(this._downCount++,this._downPointerIds[n]=!0,this.onPointerDownObservable.notifyObservers(new u(t,i),-1,e,this)&&null!=this.parent&&this.parent._onPointerDown(e,t,n,i),!0)},e.prototype._onPointerUp=function(e,t,n,i,r){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[n];var o=r;r&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new u(t,i),-1,e,this)),this.onPointerUpObservable.notifyObservers(new u(t,i),-1,e,this)&&null!=this.parent&&this.parent._onPointerUp(e,t,n,i,o)}},e.prototype._forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,s.Vector2.Zero(),e,0,!0);else for(var t in this._downPointerIds)this._onPointerUp(this,s.Vector2.Zero(),+t,0,!0)},e.prototype._processObservables=function(e,t,n,i,r){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,n),e===s.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,i);var o=this._host._lastControlOver[i];return o&&o!==this&&o._onPointerOut(this),o!==this&&this._onPointerEnter(this),this._host._lastControlOver[i]=this,!0}return e===s.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,i,r),this._host._registerLastControlDown(this,i),this._host._lastPickedControl=this,!0):e===s.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[i]&&this._host._lastControlDown[i]._onPointerUp(this,this._dummyVector2,i,r,!0),delete this._host._lastControlDown[i],!0)},e.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._font=this._style?this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=e._GetFontOffset(this._font))},e.prototype.dispose=function(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null)},Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return e._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return e._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return e._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_TOP",{get:function(){return e._VERTICAL_ALIGNMENT_TOP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return e._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return e._VERTICAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),e._GetFontOffset=function(t){if(e._FontHeightSizes[t])return e._FontHeightSizes[t];var n=document.createElement("span");n.innerHTML="Hg",n.style.font=t;var i=document.createElement("div");i.style.display="inline-block",i.style.width="1px",i.style.height="0px",i.style.verticalAlign="bottom";var r=document.createElement("div");r.appendChild(n),r.appendChild(i),document.body.appendChild(r);var o=0,a=0;try{a=i.getBoundingClientRect().top-n.getBoundingClientRect().top,i.style.verticalAlign="baseline",o=i.getBoundingClientRect().top-n.getBoundingClientRect().top}finally{document.body.removeChild(r)}var s={ascent:o,height:a,descent:a-o};return e._FontHeightSizes[t]=s,s},e.drawEllipse=function(e,t,n,i,r){r.translate(e,t),r.scale(n,i),r.beginPath(),r.arc(0,0,1,0,2*Math.PI),r.closePath(),r.scale(1/n,1/i),r.translate(-e,-t)},e.AllowAlphaInheritance=!1,e._ClipMeasure=new c(0,0,0,0),e._HORIZONTAL_ALIGNMENT_LEFT=0,e._HORIZONTAL_ALIGNMENT_RIGHT=1,e._HORIZONTAL_ALIGNMENT_CENTER=2,e._VERTICAL_ALIGNMENT_TOP=0,e._VERTICAL_ALIGNMENT_BOTTOM=1,e._VERTICAL_ALIGNMENT_CENTER=2,e._FontHeightSizes={},e.AddHeader=function(){},e}(),f=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._children=new Array,n._measureForChildren=c.Empty(),n._background="",n._adaptWidthToChildren=!1,n._adaptHeightToChildren=!1,n}return r(t,e),Object.defineProperty(t.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Container"},t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this.children;e<t.length;e++)t[e]._markMatrixAsDirty()},t.prototype.getChildByName=function(e){for(var t=0,n=this.children;t<n.length;t++){var i=n[t];if(i.name===e)return i}return null},t.prototype.getChildByType=function(e,t){for(var n=0,i=this.children;n<i.length;n++){var r=i[n];if(r.typeName===t)return r}return null},t.prototype.containsControl=function(e){return-1!==this.children.indexOf(e)},t.prototype.addControl=function(e){return e?-1!==this._children.indexOf(e)?this:(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty(),this):this},t.prototype.clearControls=function(){for(var e=0,t=this.children.slice();e<t.length;e++)this.removeControl(t[e]);return this},t.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this},t.prototype._reOrderControl=function(e){this.removeControl(e);for(var t=!1,n=0;n<this._children.length;n++)if(this._children[n].zIndex>e.zIndex){this._children.splice(n,0,e),t=!0;break}t||this._children.push(e),e.parent=this,this._markAsDirty()},t.prototype._offsetLeft=function(t){e.prototype._offsetLeft.call(this,t);for(var n=0,i=this._children;n<i.length;n++)i[n]._offsetLeft(t)},t.prototype._offsetTop=function(t){e.prototype._offsetTop.call(this,t);for(var n=0,i=this._children;n<i.length;n++)i[n]._offsetTop(t)},t.prototype._markAllAsDirty=function(){e.prototype._markAllAsDirty.call(this);for(var t=0;t<this._children.length;t++)this._children[t]._markAllAsDirty()},t.prototype._localDraw=function(e){this._background&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())},t.prototype._link=function(t){e.prototype._link.call(this,t);for(var n=0,i=this._children;n<i.length;n++)i[n]._link(t)},t.prototype._beforeLayout=function(){},t.prototype._processMeasures=function(t,n){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(t)||(e.prototype._processMeasures.call(this,t,n),this._evaluateClippingState(t))},t.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var n=0;t.save(),this._applyStates(t),this._beforeLayout();do{var i=-1,r=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(var o=0,a=this._children;o<a.length;o++){var l=a[o];l._tempParentMeasure.copyFrom(this._measureForChildren),l._layout(this._measureForChildren,t)&&(this.adaptWidthToChildren&&l._width.isPixel&&(i=Math.max(i,l._currentMeasure.width)),this.adaptHeightToChildren&&l._height.isPixel&&(r=Math.max(r,l._currentMeasure.height)))}this.adaptWidthToChildren&&i>=0&&this.width!==i+"px"&&(this.width=i+"px",this._rebuildLayout=!0),this.adaptHeightToChildren&&r>=0&&this.height!==r+"px"&&(this.height=r+"px",this._rebuildLayout=!0),this._postMeasure()}n++}while(this._rebuildLayout&&n<3);return n>=3&&s.Logger.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},t.prototype._postMeasure=function(){},t.prototype._draw=function(e,t){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);for(var n=0,i=this._children;n<i.length;n++){var r=i[n];t&&!r._intersectsRect(t)||r._render(e,t)}},t.prototype._getDescendants=function(e,t,n){if(void 0===t&&(t=!1),this.children)for(var i=0;i<this.children.length;i++){var r=this.children[i];n&&!n(r)||e.push(r),t||r._getDescendants(e,!1,n)}},t.prototype._processPicking=function(t,n,i,r,o){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,n))return!1;for(var a=this._children.length-1;a>=0;a--){var s=this._children[a];if(s._processPicking(t,n,i,r,o))return s.hoverCursor&&this._host._changeCursor(s.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(i,t,n,r,o)},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._measureForChildren.copyFrom(this._currentMeasure)},t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=this.children.length-1;t>=0;t--)this.children[t].dispose()},t}(d),p=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._thickness=1,n._cornerRadius=0,n}return r(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(e){e<0&&(e=0),this._cornerRadius!==e&&(this._cornerRadius=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Rectangle"},t.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._background&&(e.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},t.prototype._drawRoundedRect=function(e,t){void 0===t&&(t=0);var n=this._currentMeasure.left+t,i=this._currentMeasure.top+t,r=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t,a=Math.min(o/2-2,Math.min(r/2-2,this._cornerRadius));e.beginPath(),e.moveTo(n+a,i),e.lineTo(n+r-a,i),e.quadraticCurveTo(n+r,i,n+r,i+a),e.lineTo(n+r,i+o-a),e.quadraticCurveTo(n+r,i+o,n+r-a,i+o),e.lineTo(n+a,i+o),e.quadraticCurveTo(n,i+o,n,i+o-a),e.lineTo(n,i+a),e.quadraticCurveTo(n,i,n+a,i),e.closePath()},t.prototype._clipForChildren=function(e){this._cornerRadius&&(this._drawRoundedRect(e,this._thickness),e.clip())},t}(f);!function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis"}(a||(a={}));var g=function(e){function t(t,n){void 0===n&&(n="");var i=e.call(this,t)||this;return i.name=t,i._text="",i._textWrapping=a.Clip,i._textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,i._textVerticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,i._resizeToFit=!1,i._lineSpacing=new l(0),i._outlineWidth=0,i._outlineColor="white",i.onTextChangedObservable=new s.Observable,i.onLinesReadyObservable=new s.Observable,i.text=n,i}return r(t,e),Object.defineProperty(t.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(e){this._lineSpacing.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"TextBlock"},t.prototype._processMeasures=function(t,n){this._fontOffset||(this._fontOffset=d._GetFontOffset(n.font)),e.prototype._processMeasures.call(this,t,n),this._lines=this._breakLines(this._currentMeasure.width,n),this.onLinesReadyObservable.notifyObservers(this);for(var i=0,r=0;r<this._lines.length;r++){var o=this._lines[r];o.width>i&&(i=o.width)}if(this._resizeToFit){if(this._textWrapping===a.Clip){var s=this.paddingLeftInPixels+this.paddingRightInPixels+i;s!==this._width.internalValue&&(this._width.updateInPlace(s,l.UNITMODE_PIXEL),this._rebuildLayout=!0)}var c=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length;c!==this._height.internalValue&&(this._height.updateInPlace(c,l.UNITMODE_PIXEL),this._rebuildLayout=!0)}},t.prototype._drawText=function(e,t,n,i){var r=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case d.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case d.HORIZONTAL_ALIGNMENT_RIGHT:o=r-t;break;case d.HORIZONTAL_ALIGNMENT_CENTER:o=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&i.strokeText(e,this._currentMeasure.left+o,n),i.fillText(e,this._currentMeasure.left+o,n)},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._renderLines(e),e.restore()},t.prototype._applyStates=function(t){e.prototype._applyStates.call(this,t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor)},t.prototype._breakLines=function(e,t){var n=[],i=this.text.split("\n");if(this._textWrapping===a.Ellipsis)for(var r=0,o=i;r<o.length;r++){var s=o[r];n.push(this._parseLineEllipsis(s,e,t))}else if(this._textWrapping===a.WordWrap)for(var l=0,c=i;l<c.length;l++)n.push.apply(n,this._parseLineWordWrap(s=c[l],e,t));else for(var u=0,h=i;u<h.length;u++)n.push(this._parseLine(s=h[u],t));return n},t.prototype._parseLine=function(e,t){return void 0===e&&(e=""),{text:e,width:t.measureText(e).width}},t.prototype._parseLineEllipsis=function(e,t,n){void 0===e&&(e="");var i=n.measureText(e).width;for(i>t&&(e+="\u2026");e.length>2&&i>t;)e=e.slice(0,-2)+"\u2026",i=n.measureText(e).width;return{text:e,width:i}},t.prototype._parseLineWordWrap=function(e,t,n){void 0===e&&(e="");for(var i=[],r=e.split(" "),o=0,a=0;a<r.length;a++){var s=a>0?e+" "+r[a]:r[0],l=n.measureText(s).width;l>t&&a>0?(i.push({text:e,width:o}),o=n.measureText(e=r[a]).width):(o=l,e=s)}return i.push({text:e,width:o}),i},t.prototype._renderLines=function(e){var t=this._currentMeasure.height,n=0;switch(this._textVerticalAlignment){case d.VERTICAL_ALIGNMENT_TOP:n=this._fontOffset.ascent;break;case d.VERTICAL_ALIGNMENT_BOTTOM:n=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case d.VERTICAL_ALIGNMENT_CENTER:n=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}n+=this._currentMeasure.top;for(var i=0;i<this._lines.length;i++){var r=this._lines[i];0!==i&&0!==this._lineSpacing.internalValue&&(n+=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(r.text,r.width,n,e),n+=this._fontOffset.height}},t.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var e=document.createElement("canvas").getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=d._GetFontOffset(e.font));var t=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,e);return this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*t.length}}return 0},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTextChangedObservable.clear()},t}(d),m=function(e){function t(n,i){void 0===i&&(i=null);var r=e.call(this,n)||this;return r.name=n,r._loaded=!1,r._stretch=t.STRETCH_FILL,r._autoScale=!1,r._sourceLeft=0,r._sourceTop=0,r._sourceWidth=0,r._sourceHeight=0,r._cellWidth=0,r._cellHeight=0,r._cellId=-1,r._populateNinePatchSlicesFromImage=!1,r.onImageLoadedObservable=new s.Observable,r.source=i,r}return r(t,e),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stretch",{get:function(){return this._stretch},set:function(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"domImage",{get:function(){return this._domImage},set:function(e){var t=this;this._domImage=e,this._loaded=!1,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){t._onImageLoaded()}},enumerable:!0,configurable:!0}),t.prototype._onImageLoaded=function(){this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},t.prototype._extractNinePatchSliceDataFromImage=function(){t._WorkingCanvas||(t._WorkingCanvas=document.createElement("canvas"));var e=t._WorkingCanvas,n=e.getContext("2d"),i=this._domImage.width,r=this._domImage.height;e.width=i,e.height=r,n.drawImage(this._domImage,0,0,i,r);var o=n.getImageData(0,0,i,r);this._sliceLeft=-1,this._sliceRight=-1;for(var a=0;a<i;a++)if((l=o.data[4*a+3])>127&&-1===this._sliceLeft)this._sliceLeft=a;else if(l<127&&this._sliceLeft>-1){this._sliceRight=a;break}this._sliceTop=-1,this._sliceBottom=-1;for(var s=0;s<r;s++){var l;if((l=o.data[s*i*4+3])>127&&-1===this._sliceTop)this._sliceTop=s;else if(l<127&&this._sliceTop>-1){this._sliceBottom=s;break}}},Object.defineProperty(t.prototype,"source",{set:function(e){var t=this;this._source!==e&&(this._loaded=!1,this._source=e,this._domImage=document.createElement("img"),this._domImage.onload=function(){t._onImageLoaded()},e&&(s.Tools.SetCorsBehavior(e,this._domImage),this._domImage.src=e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellId",{get:function(){return this._cellId},set:function(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype.contains=function(n,i){return!!e.prototype.contains.call(this,n,i)&&(!this._detectPointerOnOpaqueOnly||!t._WorkingCanvas||t._WorkingCanvas.getContext("2d").getImageData(0,0,0|this._currentMeasure.width,0|this._currentMeasure.height).data[4*((n=n-this._currentMeasure.left|0)+(i=i-this._currentMeasure.top|0)*this._currentMeasure.width)+3]>0)},t.prototype._getTypeName=function(){return"Image"},t.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},t.prototype._processMeasures=function(n,i){if(this._loaded)switch(this._stretch){case t.STRETCH_NONE:case t.STRETCH_FILL:case t.STRETCH_UNIFORM:case t.STRETCH_NINE_PATCH:break;case t.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}e.prototype._processMeasures.call(this,n,i)},t.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){t._WorkingCanvas||(t._WorkingCanvas=document.createElement("canvas"));var e=t._WorkingCanvas,n=this._currentMeasure.width,i=this._currentMeasure.height,r=e.getContext("2d");e.width=n,e.height=i,r.clearRect(0,0,n,i)}},t.prototype._drawImage=function(e,n,i,r,o,a,s,l,c){e.drawImage(this._domImage,n,i,r,o,a,s,l,c),this._detectPointerOnOpaqueOnly&&(e=t._WorkingCanvas.getContext("2d")).drawImage(this._domImage,n,i,r,o,a-this._currentMeasure.left,s-this._currentMeasure.top,l,c)},t.prototype._draw=function(e){var n,i,r,o;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)n=this._sourceLeft,i=this._sourceTop,r=this._sourceWidth?this._sourceWidth:this._imageWidth,o=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var a=this._domImage.naturalWidth/this.cellWidth;n=this.cellWidth*(this.cellId%a),i=this.cellHeight*(this.cellId/a>>0),r=this.cellWidth,o=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case t.STRETCH_NONE:case t.STRETCH_FILL:this._drawImage(e,n,i,r,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case t.STRETCH_UNIFORM:var s=Math.min(this._currentMeasure.width/r,this._currentMeasure.height/o);this._drawImage(e,n,i,r,o,this._currentMeasure.left+(this._currentMeasure.width-r*s)/2,this._currentMeasure.top+(this._currentMeasure.height-o*s)/2,r*s,o*s);break;case t.STRETCH_EXTEND:this._drawImage(e,n,i,r,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case t.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()},t.prototype._renderCornerPatch=function(e,t,n,i,r,o,a){this._drawImage(e,t,n,i,r,this._currentMeasure.left+o,this._currentMeasure.top+a,i,r)},t.prototype._renderNinePatch=function(e){var t=this._imageHeight,n=this._sliceLeft,i=this._sliceTop,r=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,a=0,s=0;this._populateNinePatchSlicesFromImage&&(a=1,s=1,t-=2,n-=1,i-=1,r-=1,o-=1);var l=this._sliceRight-this._sliceLeft+1,c=this._currentMeasure.width-o-this.sliceLeft+1,u=this._currentMeasure.height-t+this._sliceBottom;this._renderCornerPatch(e,a,s,n,i,0,0),this._renderCornerPatch(e,a,this._sliceBottom,n,t-this._sliceBottom,0,u),this._renderCornerPatch(e,this._sliceRight,s,o,i,this._currentMeasure.width-o,0),this._renderCornerPatch(e,this._sliceRight,this._sliceBottom,o,t-this._sliceBottom,this._currentMeasure.width-o,u),this._drawImage(e,this._sliceLeft,this._sliceTop,l,this._sliceBottom-this._sliceTop+1,this._currentMeasure.left+n,this._currentMeasure.top+i,c,u-i+1),this._drawImage(e,a,this._sliceTop,n,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+i,n,u-i),this._drawImage(e,this._sliceRight,this._sliceTop,n,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+i,n,u-i),this._drawImage(e,this._sliceLeft,s,l,i,this._currentMeasure.left+n,this._currentMeasure.top,c,i),this._drawImage(e,this._sliceLeft,this._sliceBottom,l,r,this._currentMeasure.left+n,this._currentMeasure.top+u,c,r)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onImageLoadedObservable.clear()},t._WorkingCanvas=null,t.STRETCH_NONE=0,t.STRETCH_FILL=1,t.STRETCH_UNIFORM=2,t.STRETCH_EXTEND=3,t.STRETCH_NINE_PATCH=4,t}(d),_=function(e){function t(t){var n=e.call(this,t)||this;n.name=t,n.thickness=1,n.isPointerBlocker=!0;var i=null;return n.pointerEnterAnimation=function(){i=n.alpha,n.alpha-=.1},n.pointerOutAnimation=function(){null!==i&&(n.alpha=i)},n.pointerDownAnimation=function(){n.scaleX-=.05,n.scaleY-=.05},n.pointerUpAnimation=function(){n.scaleX+=.05,n.scaleY+=.05},n}return r(t,e),Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Button"},t.prototype._processPicking=function(t,n,i,r,o){return!(!(this._isEnabled&&this.isHitTestVisible&&this.isVisible)||this.notRenderable||!e.prototype.contains.call(this,t,n)||(this._processObservables(i,t,n,r,o),0))},t.prototype._onPointerEnter=function(t){return!!e.prototype._onPointerEnter.call(this,t)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},t.prototype._onPointerOut=function(t,n){void 0===n&&(n=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),e.prototype._onPointerOut.call(this,t,n)},t.prototype._onPointerDown=function(t,n,i,r){return!!e.prototype._onPointerDown.call(this,t,n,i,r)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},t.prototype._onPointerUp=function(t,n,i,r,o){this.pointerUpAnimation&&this.pointerUpAnimation(),e.prototype._onPointerUp.call(this,t,n,i,r,o)},t.CreateImageButton=function(e,n,i){var r=new t(e),o=new g(e+"_button",n);o.textWrapping=!0,o.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,o.paddingLeft="20%",r.addControl(o);var a=new m(e+"_icon",i);return a.width="20%",a.stretch=m.STRETCH_UNIFORM,a.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(a),r._image=a,r._textBlock=o,r},t.CreateImageOnlyButton=function(e,n){var i=new t(e),r=new m(e+"_icon",n);return r.stretch=m.STRETCH_FILL,r.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(r),i._image=r,i},t.CreateSimpleButton=function(e,n){var i=new t(e),r=new g(e+"_button",n);return r.textWrapping=!0,r.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(r),i._textBlock=r,i},t.CreateImageWithCenterTextButton=function(e,n,i){var r=new t(e),o=new m(e+"_icon",i);o.stretch=m.STRETCH_FILL,r.addControl(o);var a=new g(e+"_button",n);return a.textWrapping=!0,a.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(a),r._image=o,r._textBlock=a,r},t}(p),v=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._isVertical=!0,n._manualWidth=!1,n._manualHeight=!1,n._doNotTrackManualChanges=!1,n}return r(t,e),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"StackPanel"},t.prototype._preMeasure=function(t,n){for(var i=0,r=this._children;i<r.length;i++){var o=r[i];this._isVertical?o.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP:o.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT}e.prototype._preMeasure.call(this,t,n)},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._measureForChildren.copyFrom(t),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},t.prototype._postMeasure=function(){for(var t=0,n=0,i=0,r=this._children;i<r.length;i++){var o=r[i];o.isVisible&&!o.notRenderable&&(this._isVertical?(o.top!==n+"px"&&(o.top=n+"px",this._rebuildLayout=!0,o._top.ignoreAdaptiveScaling=!0),o._height.isPercentage?s.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):n+=o._currentMeasure.height+o.paddingTopInPixels+o.paddingBottomInPixels):(o.left!==t+"px"&&(o.left=t+"px",this._rebuildLayout=!0,o._left.ignoreAdaptiveScaling=!0),o._width.isPercentage?s.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):t+=o._currentMeasure.width+o.paddingLeftInPixels+o.paddingRightInPixels))}this._doNotTrackManualChanges=!0;var a=!1,l=!1;if(!this._manualHeight&&this._isVertical){var c=this.height;this.height=n+"px",l=c!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var u=this.width;this.width=t+"px",a=u!==this.width||!this._width.ignoreAdaptiveScaling}l&&(this._height.ignoreAdaptiveScaling=!0),a&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(a||l)&&(this._rebuildLayout=!0),e.prototype._postMeasure.call(this)},t}(f),b=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._isChecked=!1,n._background="black",n._checkSizeRatio=.8,n._thickness=1,n.onIsCheckedChangedObservable=new s.Observable,n.isPointerBlocker=!0,n}return r(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Checkbox"},t.prototype._draw=function(e){e.save(),this._applyStates(e);var t=this._currentMeasure.width-this._thickness,n=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;var i=t*this._checkSizeRatio,r=n*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(t-i)/2,this._currentMeasure.top+this._thickness/2+(n-r)/2,i,r)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,t,n),e.restore()},t.prototype._onPointerDown=function(t,n,i,r){return!!e.prototype._onPointerDown.call(this,t,n,i,r)&&(this.isChecked=!this.isChecked,!0)},t.AddCheckBoxWithHeader=function(e,n){var i=new v;i.isVertical=!1,i.height="30px";var r=new t;r.width="20px",r.height="20px",r.isChecked=!0,r.color="green",r.onIsCheckedChangedObservable.add(n),i.addControl(r);var o=new g;return o.text=e,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",i.addControl(o),i},t}(d),y=function(e){function t(t,n){void 0===n&&(n="");var i=e.call(this,t)||this;return i.name=t,i._text="",i._placeholderText="",i._background="#222222",i._focusedBackground="#000000",i._focusedColor="white",i._placeholderColor="gray",i._thickness=1,i._margin=new l(10,l.UNITMODE_PIXEL),i._autoStretchWidth=!0,i._maxWidth=new l(1,l.UNITMODE_PERCENTAGE,!1),i._isFocused=!1,i._blinkIsEven=!1,i._cursorOffset=0,i._deadKey=!1,i._addKey=!0,i._currentKey="",i._isTextHighlightOn=!1,i._textHighlightColor="#d5e0ff",i._highligherOpacity=.4,i._highlightedText="",i._startHighlightIndex=0,i._endHighlightIndex=0,i._cursorIndex=-1,i._onFocusSelectAll=!1,i._isPointerDown=!1,i.promptMessage="Please enter text:",i.onTextChangedObservable=new s.Observable,i.onBeforeKeyAddObservable=new s.Observable,i.onFocusObservable=new s.Observable,i.onBlurObservable=new s.Observable,i.onTextHighlightObservable=new s.Observable,i.onTextCopyObservable=new s.Observable,i.onTextCutObservable=new s.Observable,i.onTextPasteObservable=new s.Observable,i.onKeyboardEventProcessedObservable=new s.Observable,i.text=n,i.isPointerBlocker=!0,i}return r(t,e),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deadKey",{get:function(){return this._deadKey},set:function(e){this._deadKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"addKey",{get:function(){return this._addKey},set:function(e){this._addKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentKey",{get:function(){return this._currentKey},set:function(e){this._currentKey=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){var t=e.toString();this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!0,configurable:!0}),t.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)},t.prototype.onFocus=function(){var e=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")){var t=prompt(this.promptMessage);return null!==t&&(this.text=t),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add(function(t){switch(t.type){case s.ClipboardEventTypes.COPY:e._onCopyText(t.event),e.onTextCopyObservable.notifyObservers(e);break;case s.ClipboardEventTypes.CUT:e._onCutText(t.event),e.onTextCutObservable.notifyObservers(e);break;case s.ClipboardEventTypes.PASTE:e._onPasteText(t.event),e.onTextPasteObservable.notifyObservers(e);break;default:return}});var n=this._host.getScene();n&&(this._onPointerDblTapObserver=n.onPointerObservable.add(function(t){e._isFocused&&t.type===s.PointerEventTypes.POINTERDOUBLETAP&&e._processDblClick(t)})),this._onFocusSelectAll&&this._selectAllText()}},t.prototype._getTypeName=function(){return"InputText"},t.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},t.prototype.processKey=function(e,t,n){if(!n||!n.ctrlKey&&!n.metaKey||67!==e&&86!==e&&88!==e){if(n&&(n.ctrlKey||n.metaKey)&&65===e)return this._selectAllText(),void n.preventDefault();switch(e){case 32:t=" ";break;case 191:n&&n.preventDefault();break;case 8:if(this._text&&this._text.length>0){if(this._isTextHighlightOn)return this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,this._blinkIsEven=!1,void(n&&n.preventDefault());0===this._cursorOffset?this.text=this._text.substr(0,this._text.length-1):(r=this._text.length-this._cursorOffset)>0&&(this.text=this._text.slice(0,r-1)+this._text.slice(r))}return void(n&&n.preventDefault());case 46:if(this._isTextHighlightOn){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex);for(var i=this._endHighlightIndex-this._startHighlightIndex;i>0&&this._cursorOffset>0;)this._cursorOffset--;return this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,void(n&&n.preventDefault())}if(this._text&&this._text.length>0&&this._cursorOffset>0){var r=this._text.length-this._cursorOffset;this.text=this._text.slice(0,r)+this._text.slice(r+1),this._cursorOffset--}return void(n&&n.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._text.length&&(this._cursorOffset=this._text.length),n&&n.shiftKey){if(this._blinkIsEven=!1,n.ctrlKey||n.metaKey){if(!this._isTextHighlightOn){if(this._text.length===this._cursorOffset)return;this._endHighlightIndex=this._text.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=this._text.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._text.length:this._text.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._text.length?this._text.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._startHighlightIndex,this._isTextHighlightOn=!1),n&&(n.ctrlKey||n.metaKey)&&(this._cursorOffset=this.text.length,n.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),n&&n.shiftKey){if(this._blinkIsEven=!1,n.ctrlKey||n.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._text.length-this._cursorOffset-1}return this._endHighlightIndex=this._text.length,this._isTextHighlightOn=!0,this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=this._text.length===this._endHighlightIndex?0:this._text.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._endHighlightIndex,this._isTextHighlightOn=!1),n&&(n.ctrlKey||n.metaKey)&&(this._cursorOffset=0,n.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:n&&n.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(t&&(-1===e||32===e||e>47&&e<64||e>64&&e<91||e>159&&e<193||e>218&&e<223||e>95&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey))if(this._isTextHighlightOn)this.text=this._text.slice(0,this._startHighlightIndex)+t+this._text.slice(this._endHighlightIndex),this._cursorOffset=this.text.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=t;else{var o=this._text.length-this._cursorOffset;this.text=this._text.slice(0,o)+t+this._text.slice(o)}}},t.prototype._updateValueFromCursorIndex=function(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},t.prototype._processDblClick=function(e){this._startHighlightIndex=this._text.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;var t,n,i=/\w+/g;do{n=this._endHighlightIndex<this._text.length&&-1!==this._text[this._endHighlightIndex].search(i)?++this._endHighlightIndex:0,t=this._startHighlightIndex>0&&-1!==this._text[this._startHighlightIndex-1].search(i)?--this._startHighlightIndex:0}while(t||n);this._cursorOffset=this.text.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},t.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._text.length,this._cursorOffset=this._text.length,this._cursorIndex=-1,this._markAsDirty()},t.prototype.processKeyboard=function(e){this.processKey(e.keyCode,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e)},t.prototype._onCopyText=function(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText},t.prototype._onCutText=function(e){if(this._highlightedText){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},t.prototype._onPasteText=function(e){var t;t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;var n=this._text.length-this._cursorOffset;this.text=this._text.slice(0,n)+t+this._text.slice(n)},t.prototype._draw=function(e){var t=this;e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset||(this._fontOffset=d._GetFontOffset(e.font));var n=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);var i=this._beforeRenderText(this._text);this._isFocused||this._text||!this._placeholderText||(i=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(i).width;var r=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+r)+"px");var o=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,a=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-r;if(e.save(),e.beginPath(),e.rect(n,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,a+2,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>a?this._scrollLeft||(this._scrollLeft=n-this._textWidth+a):this._scrollLeft=n,e.fillText(i,this._scrollLeft,this._currentMeasure.top+o),this._isFocused){if(this._clickedCoordinate){var s=this._scrollLeft+this._textWidth-this._clickedCoordinate,l=0;this._cursorOffset=0;var c=0;do{this._cursorOffset&&(c=Math.abs(s-l)),this._cursorOffset++,l=e.measureText(i.substr(i.length-this._cursorOffset,this._cursorOffset)).width}while(l<s&&i.length>=this._cursorOffset);Math.abs(s-l)>c&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var u=this.text.substr(this._text.length-this._cursorOffset),h=e.measureText(u).width,f=this._scrollLeft+this._textWidth-h;f<n?(this._scrollLeft+=n-f,f=n,this._markAsDirty()):f>n+a&&(this._scrollLeft+=n+a-f,f=n+a,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(f,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout(function(){t._blinkIsEven=!t._blinkIsEven,t._markAsDirty()},500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var p=e.measureText(this.text.substring(this._startHighlightIndex)).width,g=this._scrollLeft+this._textWidth-p;this._highlightedText=this.text.substring(this._startHighlightIndex,this._endHighlightIndex);var m=e.measureText(this.text.substring(this._startHighlightIndex,this._endHighlightIndex)).width;g<n&&((m-=n-g)||(m=e.measureText(this.text.charAt(this.text.length-this._cursorOffset)).width),g=n),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(g,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,m,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},t.prototype._onPointerDown=function(t,n,i,r){return!(!e.prototype._onPointerDown.call(this,t,n,i,r)||(this._clickedCoordinate=n.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[i]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))},t.prototype._onPointerMove=function(t,n,i){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=n.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),e.prototype._onPointerMove.call(this,t,n,i)},t.prototype._onPointerUp=function(t,n,i,r,o){this._isPointerDown=!1,delete this._host._capturingControl[i],e.prototype._onPointerUp.call(this,t,n,i,r,o)},t.prototype._beforeRenderText=function(e){return e},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},t}(d),T=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._rowDefinitions=new Array,n._columnDefinitions=new Array,n._cells={},n._childControls=new Array,n}return r(t,e),Object.defineProperty(t.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._childControls},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),t.prototype.getRowDefinition=function(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]},t.prototype.getColumnDefinition=function(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]},t.prototype.addRowDefinition=function(e,t){return void 0===t&&(t=!1),this._rowDefinitions.push(new l(e,t?l.UNITMODE_PIXEL:l.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},t.prototype.addColumnDefinition=function(e,t){return void 0===t&&(t=!1),this._columnDefinitions.push(new l(e,t?l.UNITMODE_PIXEL:l.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},t.prototype.setRowDefinition=function(e,t,n){if(void 0===n&&(n=!1),e<0||e>=this._rowDefinitions.length)return this;var i=this._rowDefinitions[e];return i&&i.isPixel===n&&i.internalValue===t?this:(this._rowDefinitions[e]=new l(t,n?l.UNITMODE_PIXEL:l.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},t.prototype.setColumnDefinition=function(e,t,n){if(void 0===n&&(n=!1),e<0||e>=this._columnDefinitions.length)return this;var i=this._columnDefinitions[e];return i&&i.isPixel===n&&i.internalValue===t?this:(this._columnDefinitions[e]=new l(t,n?l.UNITMODE_PIXEL:l.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},t.prototype.getChildrenAt=function(e,t){var n=this._cells[e+":"+t];return n?n.children:null},t.prototype.getChildCellInfo=function(e){return e._tag},t.prototype._removeCell=function(t,n){if(t){e.prototype.removeControl.call(this,t);for(var i=0,r=t.children;i<r.length;i++){var o=this._childControls.indexOf(r[i]);-1!==o&&this._childControls.splice(o,1)}delete this._cells[n]}},t.prototype._offsetCell=function(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(var n=0,i=this._cells[e].children;n<i.length;n++)i[n]._tag=e;delete this._cells[t]}},t.prototype.removeColumnDefinition=function(e){if(e<0||e>=this._columnDefinitions.length)return this;for(var t=0;t<this._rowDefinitions.length;t++){var n=t+":"+e;this._removeCell(this._cells[n],n)}for(t=0;t<this._rowDefinitions.length;t++)for(var i=e+1;i<this._columnDefinitions.length;i++)this._offsetCell(t+":"+(i-1),n=t+":"+i);return this._columnDefinitions.splice(e,1),this._markAsDirty(),this},t.prototype.removeRowDefinition=function(e){if(e<0||e>=this._rowDefinitions.length)return this;for(var t=0;t<this._columnDefinitions.length;t++){var n=e+":"+t;this._removeCell(this._cells[n],n)}for(t=0;t<this._columnDefinitions.length;t++)for(var i=e+1;i<this._rowDefinitions.length;i++)this._offsetCell(i-1+":"+t,n=i+":"+t);return this._rowDefinitions.splice(e,1),this._markAsDirty(),this},t.prototype.addControl=function(t,n,i){if(void 0===n&&(n=0),void 0===i&&(i=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(t))return s.Tools.Warn("Control (Name:"+t.name+", UniqueId:"+t.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var r=Math.min(n,this._rowDefinitions.length-1)+":"+Math.min(i,this._columnDefinitions.length-1),o=this._cells[r];return o||(o=new f(r),this._cells[r]=o,o.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,e.prototype.addControl.call(this,o)),o.addControl(t),this._childControls.push(t),t._tag=r,t.parent=this,this._markAsDirty(),this},t.prototype.removeControl=function(e){var t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);var n=this._cells[e._tag];return n&&(n.removeControl(e),e._tag=null),this._markAsDirty(),this},t.prototype._getTypeName=function(){return"Grid"},t.prototype._getGridDefinitions=function(e){for(var t=[],n=[],i=[],r=[],o=this._currentMeasure.width,a=0,s=this._currentMeasure.height,l=0,c=0,u=0,h=this._rowDefinitions;u<h.length;u++)(m=h[u]).isPixel?(s-=g=m.getValue(this._host),n[c]=g):l+=m.internalValue,c++;var d=0;c=0;for(var f=0,p=this._rowDefinitions;f<p.length;f++){var g,m=p[f];r.push(d),m.isPixel?d+=m.getValue(this._host):(d+=g=m.internalValue/l*s,n[c]=g),c++}c=0;for(var _=0,v=this._columnDefinitions;_<v.length;_++)(m=v[_]).isPixel?(o-=E=m.getValue(this._host),t[c]=E):a+=m.internalValue,c++;var b=0;c=0;for(var y=0,T=this._columnDefinitions;y<T.length;y++){var E;m=T[y],i.push(b),m.isPixel?b+=m.getValue(this._host):(b+=E=m.internalValue/a*o,t[c]=E),c++}e(i,r,t,n)},t.prototype._additionalProcessing=function(t,n){var i=this;this._getGridDefinitions(function(e,t,n,r){for(var o in i._cells)if(i._cells.hasOwnProperty(o)){var a=o.split(":"),s=parseInt(a[0]),l=parseInt(a[1]),c=i._cells[o];c.left=e[l]+"px",c.top=t[s]+"px",c.width=n[l]+"px",c.height=r[s]+"px",c._left.ignoreAdaptiveScaling=!0,c._top.ignoreAdaptiveScaling=!0,c._width.ignoreAdaptiveScaling=!0,c._height.ignoreAdaptiveScaling=!0}}),e.prototype._additionalProcessing.call(this,t,n)},t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e in this._cells)this._cells.hasOwnProperty(e)&&this._cells[e]._markMatrixAsDirty()},t.prototype._renderHighlightSpecific=function(t){var n=this;e.prototype._renderHighlightSpecific.call(this,t),this._getGridDefinitions(function(e,i,r,o){for(var a=0;a<e.length;a++){var s=n._currentMeasure.left+e[a]+r[a];t.beginPath(),t.moveTo(s,n._currentMeasure.top),t.lineTo(s,n._currentMeasure.top+n._currentMeasure.height),t.stroke()}for(a=0;a<i.length;a++){var l=n._currentMeasure.top+i[a]+o[a];t.beginPath(),t.moveTo(n._currentMeasure.left,l),t.lineTo(n._currentMeasure.left+n._currentMeasure.width,l),t.stroke()}}),t.restore()},t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0,n=this._childControls;t<n.length;t++)n[t].dispose();this._childControls=[]},t}(f),E=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._value=s.Color3.Red(),n._tmpColor=new s.Color3,n._pointerStartedOnSquare=!1,n._pointerStartedOnWheel=!1,n._squareLeft=0,n._squareTop=0,n._squareSize=0,n._h=360,n._s=1,n._v=1,n._lastPointerDownID=-1,n.onValueChangedObservable=new s.Observable,n._pointerIsDown=!1,n.value=new s.Color3(.88,.1,.1),n.size="200px",n.isPointerBlocker=!0,n}return r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value.equals(e)||(this._value.copyFrom(e),this._RGBtoHSV(this._value,this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=t._Epsilon&&(this._value.r=0),this._value.g<=t._Epsilon&&(this._value.g=0),this._value.b<=t._Epsilon&&(this._value.b=0),this._value.r>=1-t._Epsilon&&(this._value.r=1),this._value.g>=1-t._Epsilon&&(this._value.g=1),this._value.b>=1-t._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(this._height.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(this._width.fromString(e),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"ColorPicker"},t.prototype._preMeasure=function(e,t){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height},t.prototype._updateSquareProps=function(){var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),n=e-.5*t;this._squareLeft=this._currentMeasure.left+n,this._squareTop=this._currentMeasure.top+n,this._squareSize=t},t.prototype._drawGradientSquare=function(e,t,n,i,r,o){var a=o.createLinearGradient(t,n,i+t,n);a.addColorStop(0,"#fff"),a.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=a,o.fillRect(t,n,i,r);var s=o.createLinearGradient(t,n,t,r+n);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"#000"),o.fillStyle=s,o.fillRect(t,n,i,r)},t.prototype._drawCircle=function(e,t,n,i){i.beginPath(),i.arc(e,t,n+1,0,2*Math.PI,!1),i.lineWidth=3,i.strokeStyle="#333333",i.stroke(),i.beginPath(),i.arc(e,t,n,0,2*Math.PI,!1),i.lineWidth=3,i.strokeStyle="#ffffff",i.stroke()},t.prototype._createColorWheelCanvas=function(e,t){var n=document.createElement("canvas");n.width=2*e,n.height=2*e;for(var i=n.getContext("2d"),r=i.getImageData(0,0,2*e,2*e),o=r.data,a=this._tmpColor,s=e*e,l=e-t,c=l*l,u=-e;u<e;u++)for(var h=-e;h<e;h++){var d=u*u+h*h;if(!(d>s||d<c)){var f=Math.sqrt(d),p=Math.atan2(h,u);this._HSVtoRGB(180*p/Math.PI+180,f/e,1,a);var g=4*(u+e+2*(h+e)*e);o[g]=255*a.r,o[g+1]=255*a.g,o[g+2]=255*a.b;var m,_=(f-l)/(e-l);o[g+3]=_<(m=e<50?.2:e>150?.04:-.16*(e-50)/100+.2)?_/m*255:_>1-m?255*(1-(_-(1-m))/m):255}}return i.putImageData(r,0,0),n},t.prototype._RGBtoHSV=function(e,t){var n=e.r,i=e.g,r=e.b,o=Math.max(n,i,r),a=Math.min(n,i,r),s=0,l=0,c=o,u=o-a;0!==o&&(l=u/o),o!=a&&(o==n?(s=(i-r)/u,i<r&&(s+=6)):o==i?s=(r-n)/u+2:o==r&&(s=(n-i)/u+4),s*=60),t.r=s,t.g=l,t.b=c},t.prototype._HSVtoRGB=function(e,t,n,i){var r=n*t,o=e/60,a=r*(1-Math.abs(o%2-1)),s=0,l=0,c=0;o>=0&&o<=1?(s=r,l=a):o>=1&&o<=2?(s=a,l=r):o>=2&&o<=3?(l=r,c=a):o>=3&&o<=4?(l=a,c=r):o>=4&&o<=5?(s=a,c=r):o>=5&&o<=6&&(s=r,c=a);var u=n-r;i.set(s+u,l+u,c+u)},t.prototype._draw=function(e){e.save(),this._applyStates(e);var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),n=.2*t,i=this._currentMeasure.left,r=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,n)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,i,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);var o=this._squareLeft+this._squareSize*this._s,a=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,a,.04*t,e);var s=t-.5*n;o=i+t+Math.cos((this._h-180)*Math.PI/180)*s,a=r+t+Math.sin((this._h-180)*Math.PI/180)*s,this._drawCircle(o,a,.35*n,e),e.restore()},t.prototype._updateValueFromPointer=function(e,n){if(this._pointerStartedOnWheel){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height);this._h=180*Math.atan2(n-(i+this._currentMeasure.top),e-(i+this._currentMeasure.left))/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(n-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,t._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,t._Epsilon));this._HSVtoRGB(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},t.prototype._isPointOnSquare=function(e,t){this._updateSquareProps();var n=this._squareLeft,i=this._squareTop,r=this._squareSize;return e>=n&&e<=n+r&&t>=i&&t<=i+r},t.prototype._isPointOnWheel=function(e,t){var n=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=n-.2*n,r=e-(n+this._currentMeasure.left),o=t-(n+this._currentMeasure.top),a=r*r+o*o;return a<=n*n&&a>=i*i},t.prototype._onPointerDown=function(t,n,i,r){if(!e.prototype._onPointerDown.call(this,t,n,i,r))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(n.x,n.y,this._transformedPosition);var o=this._transformedPosition.x,a=this._transformedPosition.y;return this._isPointOnSquare(o,a)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(o,a)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(o,a),this._host._capturingControl[i]=this,this._lastPointerDownID=i,!0},t.prototype._onPointerMove=function(t,n,i){i==this._lastPointerDownID&&(this._invertTransformMatrix.transformCoordinates(n.x,n.y,this._transformedPosition),this._pointerIsDown&&this._updateValueFromPointer(this._transformedPosition.x,this._transformedPosition.y),e.prototype._onPointerMove.call(this,t,n,i))},t.prototype._onPointerUp=function(t,n,i,r,o){this._pointerIsDown=!1,delete this._host._capturingControl[i],e.prototype._onPointerUp.call(this,t,n,i,r,o)},t.ShowPickerDialogAsync=function(e,n){return new Promise(function(i,r){n.pickerWidth=n.pickerWidth||"640px",n.pickerHeight=n.pickerHeight||"400px",n.headerHeight=n.headerHeight||"35px",n.lastColor=n.lastColor||"#000000",n.swatchLimit=n.swatchLimit||20,n.numSwatchesPerLine=n.numSwatchesPerLine||10;var o,a,l,c,u,h,f,m,v,b,E,x,C,S,A,P,R,M,O,w=n.swatchLimit/n.numSwatchesPerLine,I=parseFloat(n.pickerWidth)/n.numSwatchesPerLine,D=Math.floor(.25*I),L=D*(n.numSwatchesPerLine+1),k=Math.floor((parseFloat(n.pickerWidth)-L)/n.numSwatchesPerLine),N=k*w+D*(w+1),F=(parseInt(n.pickerHeight)+N+Math.floor(.25*k)).toString()+"px",B="#c0c0c0",U="#535353",V="#414141",G="515151",z="#555555",j="#454545",H=s.Color3.FromHexString("#dddddd"),W=H.r+H.g+H.b,X="#aaaaaa",Y="#ffffff",K=["R","G","B"],Q=!1;function q(e,t){O=t;var n=e.toHexString();if(R.background=n,b.name!=O&&(b.text=Math.floor(255*e.r).toString()),E.name!=O&&(E.text=Math.floor(255*e.g).toString()),x.name!=O&&(x.text=Math.floor(255*e.b).toString()),C.name!=O&&(C.text=e.r.toString()),S.name!=O&&(S.text=e.g.toString()),A.name!=O&&(A.text=e.b.toString()),P.name!=O){var i=n.split("#");P.text=i[1]}v.name!=O&&(v.value=e)}function Z(e,t){var n=e.text;if(/[^0-9]/g.test(n))e.text=M;else if(""!=n&&(Math.floor(parseInt(n))<0?n="0":Math.floor(parseInt(n))>255?n="255":isNaN(parseInt(n))&&(n="0")),O==e.name&&(M=n),""!=n){n=parseInt(n).toString(),e.text=n;var i=s.Color3.FromHexString(R.background);O==e.name&&q("r"==t?new s.Color3(parseInt(n)/255,i.g,i.b):"g"==t?new s.Color3(i.r,parseInt(n)/255,i.b):new s.Color3(i.r,i.g,parseInt(n)/255),e.name)}}function J(e,t){var n=e.text;if(/[^0-9\.]/g.test(n))e.text=M;else{""!=n&&"."!=n&&0!=parseFloat(n)&&(parseFloat(n)<0?n="0.0":parseFloat(n)>1?n="1.0":isNaN(parseFloat(n))&&(n="0.0")),O==e.name&&(M=n),""!=n&&"."!=n&&0!=parseFloat(n)?(n=parseFloat(n).toString(),e.text=n):n="0.0";var i=s.Color3.FromHexString(R.background);O==e.name&&q("r"==t?new s.Color3(parseFloat(n),i.g,i.b):"g"==t?new s.Color3(i.r,parseFloat(n),i.b):new s.Color3(i.r,i.g,parseFloat(n)),e.name)}}function $(){if(n.savedColors&&n.savedColors[f]){if(Q)var e="b";else e="";var t=_.CreateSimpleButton("Swatch_"+f,e);t.fontFamily="BabylonJSglyphs";var i=s.Color3.FromHexString(n.savedColors[f]);t.color=i.r+i.g+i.b>W?X:Y,t.fontSize=Math.floor(.7*k),t.textBlock.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,t.height=t.width=k.toString()+"px",t.background=n.savedColors[f],t.thickness=2;var r=f;return t.pointerDownAnimation=function(){t.thickness=4},t.pointerUpAnimation=function(){t.thickness=3},t.pointerEnterAnimation=function(){t.thickness=3},t.pointerOutAnimation=function(){t.thickness=2},t.onPointerClickObservable.add(function(){Q?(n.savedColors&&n.savedColors.splice(r,1),n.savedColors&&0==n.savedColors.length&&(ne(!1),Q=!1),te("",Ne)):n.savedColors&&q(s.Color3.FromHexString(n.savedColors[r]),t.name)}),t}return null}function ee(e){if(void 0!==e&&(Q=e),Q){for(var t=0;t<m.children.length;t++)m.children[t].textBlock.text="b";void 0!==l&&(l.textBlock.text="Done")}else{for(t=0;t<m.children.length;t++)m.children[t].textBlock.text="";void 0!==l&&(l.textBlock.text="Edit")}}function te(e,t){if(n.savedColors){""!=e&&n.savedColors.push(e),f=0,m.clearControls();var i=Math.ceil(n.savedColors.length/n.numSwatchesPerLine);if(0==i)var r=0;else r=i+1;if(m.rowCount!=i+r){for(var o=m.rowCount,a=0;a<o;a++)m.removeRowDefinition(0);for(a=0;a<i+r;a++)m.addRowDefinition(a%2?k:D,!0)}m.height=(k*i+r*D).toString()+"px";for(var s=1,l=1;s<i+r;s+=2,l++){if(n.savedColors.length>l*n.numSwatchesPerLine)var c=n.numSwatchesPerLine;else c=n.savedColors.length-(l-1)*n.numSwatchesPerLine;for(var u=Math.min(Math.max(c,0),n.numSwatchesPerLine),h=0,d=1;h<u;h++)if(!(h>n.numSwatchesPerLine)){var p=$();null!=p&&(m.addControl(p,s,d),d+=2,f++)}}ie(t,n.savedColors.length>=n.swatchLimit)}}function ne(e){e?((l=_.CreateSimpleButton("butEdit","Edit")).width=c,l.height=u,l.left=Math.floor(.1*parseInt(c)).toString()+"px",l.top=(-1*parseFloat(l.left)).toString()+"px",l.verticalAlignment=d.VERTICAL_ALIGNMENT_BOTTOM,l.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,l.thickness=2,l.color=B,l.fontSize=a,l.background=U,l.onPointerEnterObservable.add(function(){l.background=V}),l.onPointerOutObservable.add(function(){l.background=U}),l.pointerDownAnimation=function(){l.background=G},l.pointerUpAnimation=function(){l.background=V},l.onPointerClickObservable.add(function(){Q=!Q,ee()}),ve.addControl(l,1,0)):ve.removeControl(l)}function ie(e,t){t?(e.color=z,e.background=j):(e.color=B,e.background=U)}function re(t){i(n.savedColors&&n.savedColors.length>0?{savedColors:n.savedColors,pickedColor:t}:{pickedColor:t}),e.removeControl(oe)}var oe=new T;if(oe.name="Dialog Container",oe.width=n.pickerWidth,n.savedColors){oe.height=F;var ae=parseInt(n.pickerHeight)/parseInt(F);oe.addRowDefinition(ae,!1),oe.addRowDefinition(1-ae,!1)}else oe.height=n.pickerHeight,oe.addRowDefinition(1,!1);if(e.addControl(oe),n.savedColors){(m=new T).name="Swatch Drawer",m.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,m.background=U,m.width=n.pickerWidth;var se=n.savedColors.length/n.numSwatchesPerLine;if(0==se)var le=0;else le=se+1;m.height=(k*se+le*D).toString()+"px",m.top=Math.floor(.25*k).toString()+"px";for(var ce=0;ce<2*Math.ceil(n.savedColors.length/n.numSwatchesPerLine)+1;ce++)m.addRowDefinition(ce%2!=0?k:D,!0);for(ce=0;ce<2*n.numSwatchesPerLine+1;ce++)m.addColumnDefinition(ce%2!=0?k:D,!0);oe.addControl(m,1,0)}var ue=new T;ue.name="Picker Panel",ue.height=n.pickerHeight;var he=parseInt(n.headerHeight)/parseInt(n.pickerHeight),de=[he,1-he];ue.addRowDefinition(de[0],!1),ue.addRowDefinition(de[1],!1),oe.addControl(ue,0,0);var fe=new p;fe.name="Dialogue Header Bar",fe.background="#cccccc",fe.thickness=0,ue.addControl(fe,0,0);var pe=_.CreateSimpleButton("closeButton","a");pe.fontFamily="BabylonJSglyphs";var ge=s.Color3.FromHexString(fe.background);o=new s.Color3(1-ge.r,1-ge.g,1-ge.b),pe.color=o.toHexString(),pe.fontSize=Math.floor(.6*parseInt(n.headerHeight)),pe.textBlock.textVerticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,pe.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_RIGHT,pe.height=pe.width=n.headerHeight,pe.background=fe.background,pe.thickness=0,pe.pointerDownAnimation=function(){},pe.pointerUpAnimation=function(){pe.background=fe.background},pe.pointerEnterAnimation=function(){pe.color=fe.background,pe.background="red"},pe.pointerOutAnimation=function(){pe.color=o.toHexString(),pe.background=fe.background},pe.onPointerClickObservable.add(function(){re(Oe.background)}),ue.addControl(pe,0,0);var me=new T;me.name="Dialogue Body",me.background=U;var _e=[.4375,.5625];me.addRowDefinition(1,!1),me.addColumnDefinition(_e[0],!1),me.addColumnDefinition(_e[1],!1),ue.addControl(me,1,0);var ve=new T;ve.name="Picker Grid",ve.addRowDefinition(.85,!1),ve.addRowDefinition(.15,!1),me.addControl(ve,0,0),(v=new t).name="GUI Color Picker",n.pickerHeight<n.pickerWidth?v.width=.89:v.height=.89,v.value=s.Color3.FromHexString(n.lastColor),v.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,v.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,v.onPointerDownObservable.add(function(){O=v.name,M="",ee(!1)}),v.onValueChangedObservable.add(function(e){O==v.name&&q(e,v.name)}),ve.addControl(v,0,0);var be=new T;be.name="Dialogue Right Half",be.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT;var ye=[.514,.486];be.addRowDefinition(ye[0],!1),be.addRowDefinition(ye[1],!1),me.addControl(be,1,1);var Te=new T;Te.name="Swatches and Buttons";var Ee=[.417,.583];Te.addRowDefinition(1,!1),Te.addColumnDefinition(Ee[0],!1),Te.addColumnDefinition(Ee[1],!1),be.addControl(Te,0,0);var xe=new T;xe.name="New and Current Swatches";var Ce=[.04,.16,.64,.16];xe.addRowDefinition(Ce[0],!1),xe.addRowDefinition(Ce[1],!1),xe.addRowDefinition(Ce[2],!1),xe.addRowDefinition(Ce[3],!1),Te.addControl(xe,0,0);var Se=new T;Se.name="Active Swatches",Se.width=.67,Se.addRowDefinition(.5,!1),Se.addRowDefinition(.5,!1),xe.addControl(Se,2,0);var Ae=Math.floor(parseInt(n.pickerWidth)*_e[1]*Ee[0]*.11),Pe=Math.floor(parseInt(n.pickerHeight)*de[1]*ye[0]*Ce[1]*.5);if(n.pickerWidth>n.pickerHeight)var Re=Pe;else Re=Ae;var Me=new g;Me.text="new",Me.name="New Color Label",Me.color=B,Me.fontSize=Re,xe.addControl(Me,1,0),(R=new p).name="New Color Swatch",R.background=n.lastColor,R.thickness=0,Se.addControl(R,0,0);var Oe=_.CreateSimpleButton("currentSwatch","");Oe.background=n.lastColor,Oe.thickness=0,Oe.onPointerClickObservable.add(function(){q(s.Color3.FromHexString(Oe.background),Oe.name),ee(!1)}),Oe.pointerDownAnimation=function(){},Oe.pointerUpAnimation=function(){},Oe.pointerEnterAnimation=function(){},Oe.pointerOutAnimation=function(){},Se.addControl(Oe,1,0);var we=new p;we.name="Swatch Outline",we.width=.67,we.thickness=2,we.color="#404040",we.isHitTestVisible=!1,xe.addControl(we,2,0);var Ie=new g;Ie.name="Current Color Label",Ie.text="current",Ie.color=B,Ie.fontSize=Re,xe.addControl(Ie,3,0);var De=new T;De.name="Button Grid",De.height=.8,De.addRowDefinition(1/3,!1),De.addRowDefinition(1/3,!1),De.addRowDefinition(1/3,!1),Te.addControl(De,0,1),c=Math.floor(parseInt(n.pickerWidth)*_e[1]*Ee[1]*.67).toString()+"px",u=Math.floor(parseInt(n.pickerHeight)*de[1]*ye[0]*(parseFloat(De.height.toString())/100)*(1/3)*.7).toString()+"px",a=parseFloat(c)>parseFloat(u)?Math.floor(.45*parseFloat(u)):Math.floor(.11*parseFloat(c));var Le=_.CreateSimpleButton("butOK","OK");Le.width=c,Le.height=u,Le.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,Le.thickness=2,Le.color=B,Le.fontSize=a,Le.background=U,Le.onPointerEnterObservable.add(function(){Le.background=V}),Le.onPointerOutObservable.add(function(){Le.background=U}),Le.pointerDownAnimation=function(){Le.background=G},Le.pointerUpAnimation=function(){Le.background=V},Le.onPointerClickObservable.add(function(){ee(!1),re(R.background)}),De.addControl(Le,0,0);var ke=_.CreateSimpleButton("butCancel","Cancel");if(ke.width=c,ke.height=u,ke.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,ke.thickness=2,ke.color=B,ke.fontSize=a,ke.background=U,ke.onPointerEnterObservable.add(function(){ke.background=V}),ke.onPointerOutObservable.add(function(){ke.background=U}),ke.pointerDownAnimation=function(){ke.background=G},ke.pointerUpAnimation=function(){ke.background=V},ke.onPointerClickObservable.add(function(){ee(!1),re(Oe.background)}),De.addControl(ke,1,0),n.savedColors){var Ne=_.CreateSimpleButton("butSave","Save");Ne.width=c,Ne.height=u,Ne.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,Ne.thickness=2,Ne.fontSize=a,n.savedColors.length<n.swatchLimit?(Ne.color=B,Ne.background=U):ie(Ne,!0),Ne.onPointerEnterObservable.add(function(){n.savedColors&&n.savedColors.length<n.swatchLimit&&(Ne.background=V)}),Ne.onPointerOutObservable.add(function(){n.savedColors&&n.savedColors.length<n.swatchLimit&&(Ne.background=U)}),Ne.pointerDownAnimation=function(){n.savedColors&&n.savedColors.length<n.swatchLimit&&(Ne.background=G)},Ne.pointerUpAnimation=function(){n.savedColors&&n.savedColors.length<n.swatchLimit&&(Ne.background=V)},Ne.onPointerClickObservable.add(function(){n.savedColors&&(0==n.savedColors.length&&ne(!0),n.savedColors.length<n.swatchLimit&&te(R.background,Ne),ee(!1))}),n.savedColors.length>0&&ne(!0),De.addControl(Ne,2,0)}var Fe=new T;Fe.name="Dialog Lower Right",Fe.addRowDefinition(.02,!1),Fe.addRowDefinition(.63,!1),Fe.addRowDefinition(.21,!1),Fe.addRowDefinition(.14,!1),be.addControl(Fe,1,0),h=s.Color3.FromHexString(n.lastColor);var Be=new T;for(Be.name="RGB Values",Be.width=.82,Be.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,Be.addRowDefinition(1/3,!1),Be.addRowDefinition(1/3,!1),Be.addRowDefinition(1/3,!1),Be.addColumnDefinition(.1,!1),Be.addColumnDefinition(.2,!1),Be.addColumnDefinition(.7,!1),Fe.addControl(Be,1,0),ce=0;ce<K.length;ce++)(Ue=new g).text=K[ce],Ue.color=B,Ue.fontSize=a,Be.addControl(Ue,ce,0);(b=new y).width=.83,b.height=.72,b.name="rIntField",b.fontSize=a,b.text=(255*h.r).toString(),b.color="#f0f0f0",b.background="#454545",b.onFocusObservable.add(function(){O=b.name,M=b.text,ee(!1)}),b.onBlurObservable.add(function(){""==b.text&&(b.text="0"),Z(b,"r"),O==b.name&&(O="")}),b.onTextChangedObservable.add(function(){O==b.name&&Z(b,"r")}),Be.addControl(b,0,1),(E=new y).width=.83,E.height=.72,E.name="gIntField",E.fontSize=a,E.text=(255*h.g).toString(),E.color="#f0f0f0",E.background="#454545",E.onFocusObservable.add(function(){O=E.name,M=E.text,ee(!1)}),E.onBlurObservable.add(function(){""==E.text&&(E.text="0"),Z(E,"g"),O==E.name&&(O="")}),E.onTextChangedObservable.add(function(){O==E.name&&Z(E,"g")}),Be.addControl(E,1,1),(x=new y).width=.83,x.height=.72,x.name="bIntField",x.fontSize=a,x.text=(255*h.b).toString(),x.color="#f0f0f0",x.background="#454545",x.onFocusObservable.add(function(){O=x.name,M=x.text,ee(!1)}),x.onBlurObservable.add(function(){""==x.text&&(x.text="0"),Z(x,"b"),O==x.name&&(O="")}),x.onTextChangedObservable.add(function(){O==x.name&&Z(x,"b")}),Be.addControl(x,2,1),(C=new y).width=.95,C.height=.72,C.name="rDecField",C.fontSize=a,C.text=h.r.toString(),C.color="#f0f0f0",C.background="#454545",C.onFocusObservable.add(function(){O=C.name,M=C.text,ee(!1)}),C.onBlurObservable.add(function(){0!=parseFloat(C.text)&&""!=C.text||(C.text="0",J(C,"r")),O==C.name&&(O="")}),C.onTextChangedObservable.add(function(){O==C.name&&J(C,"r")}),Be.addControl(C,0,2),(S=new y).width=.95,S.height=.72,S.name="gDecField",S.fontSize=a,S.text=h.g.toString(),S.color="#f0f0f0",S.background="#454545",S.onFocusObservable.add(function(){O=S.name,M=S.text,ee(!1)}),S.onBlurObservable.add(function(){0!=parseFloat(S.text)&&""!=S.text||(S.text="0",J(S,"g")),O==S.name&&(O="")}),S.onTextChangedObservable.add(function(){O==S.name&&J(S,"g")}),Be.addControl(S,1,2),(A=new y).width=.95,A.height=.72,A.name="bDecField",A.fontSize=a,A.text=h.b.toString(),A.color="#f0f0f0",A.background="#454545",A.onFocusObservable.add(function(){O=A.name,M=A.text,ee(!1)}),A.onBlurObservable.add(function(){0!=parseFloat(A.text)&&""!=A.text||(A.text="0",J(A,"b")),O==A.name&&(O="")}),A.onTextChangedObservable.add(function(){O==A.name&&J(A,"b")}),Be.addControl(A,2,2);var Ue,Ve=new T;Ve.name="Hex Value",Ve.width=.82,Ve.addRowDefinition(1,!1),Ve.addColumnDefinition(.1,!1),Ve.addColumnDefinition(.9,!1),Fe.addControl(Ve,2,0),(Ue=new g).text="#",Ue.color=B,Ue.fontSize=a,Ve.addControl(Ue,0,0),(P=new y).width=.96,P.height=.72,P.name="hexField",P.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,P.fontSize=a;var Ge=n.lastColor.split("#");P.text=Ge[1],P.color="#f0f0f0",P.background="#454545",P.onFocusObservable.add(function(){O=P.name,M=P.text,ee(!1)}),P.onBlurObservable.add(function(){if(3==P.text.length){var e=P.text.split("");P.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==P.text&&(P.text="000000",q(s.Color3.FromHexString(P.text),"b")),O==P.name&&(O="")}),P.onTextChangedObservable.add(function(){var e=P.text,t=/[^0-9A-F]/i.test(e);if((P.text.length>6||t)&&O==P.name)P.text=M;else{if(P.text.length<6)for(var n=6-P.text.length,i=0;i<n;i++)e="0"+e;if(3==P.text.length){var r=P.text.split("");e=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]}e="#"+e,O==P.name&&(M=P.text,q(s.Color3.FromHexString(e),P.name))}}),Ve.addControl(P,0,1),n.savedColors&&n.savedColors.length>0&&te("",Ne)})},t._Epsilon=1e-6,t}(d),x=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._thickness=1,n}return r(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Ellipse"},t.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),d.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),this._background&&(e.fillStyle=this._background,e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},t.prototype._clipForChildren=function(e){d.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()},t}(f),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._beforeRenderText=function(e){for(var t="",n=0;n<e.length;n++)t+="\u2022";return t},t}(y),S=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._lineWidth=1,n._x1=new l(0),n._y1=new l(0),n._x2=new l(0),n._y2=new l(0),n._dash=new Array,n.isHitTestVisible=!1,n._horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,n._verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,n}return r(t,e),Object.defineProperty(t.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(e){var t=this;this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add(function(){return t._markAsDirty()})),this._connectedControl=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Line"},t.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.left+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.left+this._effectiveY2),e.stroke(),e.restore()},t.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},t.prototype._computeAlignment=function(e,t){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},t.prototype.moveToVector3=function(e,t,n){if(void 0===n&&(n=!1),this._host&&this.parent===this._host._rootContainer){var i=this._host._getGlobalViewport(t),r=s.Vector3.Project(e,s.Matrix.Identity(),t.getTransformMatrix(),i);this._moveToProjectedPosition(r,n),this.notRenderable=r.z<0||r.z>1}else s.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},t.prototype._moveToProjectedPosition=function(e,t){void 0===t&&(t=!1);var n=e.x+this._linkOffsetX.getValue(this._host)+"px",i=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=n,this.y2=i,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=n,this.y1=i,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},t}(d),A=function(){function e(e){this._multiLine=e,this._x=new l(0),this._y=new l(0),this._point=new s.Vector2(0,0)}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"control",{get:function(){return this._control},set:function(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype.resetLinks=function(){this.control=null,this.mesh=null},e.prototype.translate=function(){return this._point=this._translatePoint(),this._point},e.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPosition(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new s.Vector2(this._control.centerX,this._control.centerY);var e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),n=this._y.getValueInPixel(e,Number(e._canvas.height));return new s.Vector2(t,n)},e.prototype.dispose=function(){this.resetLinks()},e}(),P=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._lineWidth=1,n.onPointUpdate=function(){n._markAsDirty()},n.isHitTestVisible=!1,n._horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,n._verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,n._dash=[],n._points=[],n}return r(t,e),Object.defineProperty(t.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype.getAt=function(e){return this._points[e]||(this._points[e]=new A(this)),this._points[e]},t.prototype.add=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.map(function(t){return e.push(t)})},t.prototype.push=function(e){var t=this.getAt(this._points.length);return null==e?t:(e instanceof s.AbstractMesh?t.mesh=e:e instanceof d?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y),t)},t.prototype.remove=function(e){var t;if(e instanceof A){if(-1===(t=this._points.indexOf(e)))return}else t=e;var n=this._points[t];n&&(n.dispose(),this._points.splice(t,1))},t.prototype.reset=function(){for(;this._points.length>0;)this.remove(this._points.length-1)},t.prototype.resetLinks=function(){this._points.forEach(function(e){null!=e&&e.resetLinks()})},Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{set:function(e){},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"MultiLine"},t.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();var t=!0;this._points.forEach(function(n){n&&(t?(e.moveTo(n._point.x,n._point.y),t=!1):e.lineTo(n._point.x,n._point.y))}),e.stroke(),e.restore()},t.prototype._additionalProcessing=function(e,t){var n=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach(function(e,t){e&&(e.translate(),(null==n._minX||e._point.x<n._minX)&&(n._minX=e._point.x),(null==n._minY||e._point.y<n._minY)&&(n._minY=e._point.y),(null==n._maxX||e._point.x>n._maxX)&&(n._maxX=e._point.x),(null==n._maxY||e._point.y>n._maxY)&&(n._maxY=e._point.y))}),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},t.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},t.prototype._computeAlignment=function(e,t){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},t.prototype.dispose=function(){this.reset(),e.prototype.dispose.call(this)},t}(d),R=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._isChecked=!1,n._background="black",n._checkSizeRatio=.8,n._thickness=1,n.group="",n.onIsCheckedChangedObservable=new s.Observable,n.isPointerBlocker=!0,n}return r(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){var t=this;this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls(function(e){e!==t&&void 0!==e.group&&e.group===t.group&&(e.isChecked=!1)}))},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"RadioButton"},t.prototype._draw=function(e){e.save(),this._applyStates(e);var t=this._currentMeasure.width-this._thickness,n=this._currentMeasure.height-this._thickness;(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),d.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked&&(e.fillStyle=this._isEnabled?this.color:this._disabledColor,d.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,t*this._checkSizeRatio/2-this._thickness/2,n*this._checkSizeRatio/2-this._thickness/2,e),e.fill()),e.restore()},t.prototype._onPointerDown=function(t,n,i,r){return!!e.prototype._onPointerDown.call(this,t,n,i,r)&&(this.isChecked||(this.isChecked=!0),!0)},t.AddRadioButtonWithHeader=function(e,n,i,r){var o=new v;o.isVertical=!1,o.height="30px";var a=new t;a.width="20px",a.height="20px",a.isChecked=i,a.color="green",a.group=n,a.onIsCheckedChangedObservable.add(function(e){return r(a,e)}),o.addControl(a);var s=new g;return s.text=e,s.width="180px",s.paddingLeft="5px",s.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,s.color="white",o.addControl(s),o},t}(d),M=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._thumbWidth=new l(20,l.UNITMODE_PIXEL,!1),n._minimum=0,n._maximum=100,n._value=50,n._isVertical=!1,n._barOffset=new l(5,l.UNITMODE_PIXEL,!1),n._isThumbClamped=!1,n._displayThumb=!0,n._step=0,n._lastPointerDownID=-1,n._effectiveBarOffset=0,n.onValueChangedObservable=new s.Observable,n._pointerIsDown=!1,n.isPointerBlocker=!0,n}return r(t,e),Object.defineProperty(t.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"BaseSlider"},t.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},t.prototype._getThumbThickness=function(e){var t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t},t.prototype._prepareRenderingData=function(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._effectiveBarOffset=this._barOffset.isPixel?Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},t.prototype._updateValueFromPointer=function(e,t){var n;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),n=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var i=1/this._step|0;this.value=this._step?(n*i|0)/i:n},t.prototype._onPointerDown=function(t,n,i,r){return!!e.prototype._onPointerDown.call(this,t,n,i,r)&&(this._pointerIsDown=!0,this._updateValueFromPointer(n.x,n.y),this._host._capturingControl[i]=this,this._lastPointerDownID=i,!0)},t.prototype._onPointerMove=function(t,n,i){i==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(n.x,n.y),e.prototype._onPointerMove.call(this,t,n,i))},t.prototype._onPointerUp=function(t,n,i,r,o){this._pointerIsDown=!1,delete this._host._capturingControl[i],e.prototype._onPointerUp.call(this,t,n,i,r,o)},t}(d),O=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._background="black",n._borderColor="white",n._isThumbCircle=!1,n._displayValueBar=!0,n}return r(t,e),Object.defineProperty(t.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Slider"},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var t=this._renderLeft,n=this._renderTop,i=this._renderWidth,r=this._renderHeight,o=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?n+=this._effectiveThumbThickness/2:t+=this._effectiveThumbThickness/2,o=this._backgroundBoxThickness/2):o=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();e.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,n,o,Math.PI,2*Math.PI),e.fill(),e.fillRect(t,n,i,r)):e.fillRect(t,n,i,r+this._effectiveThumbThickness):e.fillRect(t,n,i,r):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxLength,n+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill(),e.fillRect(t,n,i,r)):e.fillRect(t,n,i+this._effectiveThumbThickness,r):e.fillRect(t,n,i,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(t+this._backgroundBoxThickness/2,n+this._backgroundBoxLength,o,0,2*Math.PI),e.fill(),e.fillRect(t,n+a,i,r-a)):e.fillRect(t,n+a,i,r-a+this._effectiveThumbThickness):e.fillRect(t,n+a,i,r-a):this.isThumbClamped&&this.isThumbCircle?(e.beginPath(),e.arc(t,n+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill(),e.fillRect(t,n,a,r)):e.fillRect(t,n,a,r)),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(t+this._backgroundBoxThickness/2,n+a,o,0,2*Math.PI):e.arc(t+a,n+this._backgroundBoxThickness/2,o,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(t-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(t-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()},t}(M),w=function(){function e(e){this.name=e,this._groupPanel=new v,this._selectors=new Array,this._groupPanel.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}return Object.defineProperty(e.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectors",{get:function(){return this._selectors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._groupHeader.text},set:function(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)},enumerable:!0,configurable:!0}),e.prototype._addGroupHeader=function(e){var t=new g("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t},e.prototype._getSelector=function(e){if(!(e<0||e>=this._selectors.length))return this._selectors[e]},e.prototype.removeSelector=function(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))},e}(),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.addCheckbox=function(e,t,n){void 0===t&&(t=function(e){}),void 0===n&&(n=!1),n=n||!1;var i=new b;i.width="20px",i.height="20px",i.color="#364249",i.background="#CCCCCC",i.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,i.onIsCheckedChangedObservable.add(function(e){t(e)});var r=d.AddHeader(i,e,"200px",{isHorizontal:!0,controlFirst:!0});r.height="30px",r.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,r.left="4px",this.groupPanel.addControl(r),this.selectors.push(r),i.isChecked=n,this.groupPanel.parent&&this.groupPanel.parent.parent&&(i.color=this.groupPanel.parent.parent.buttonColor,i.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t},t}(w),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._selectNb=0,t}return r(t,e),t.prototype.addRadio=function(e,t,n){void 0===t&&(t=function(e){}),void 0===n&&(n=!1);var i=this._selectNb++,r=new R;r.name=e,r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.group=this.name,r.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add(function(e){e&&t(i)});var o=d.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),r.isChecked=n,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t},t}(w),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.addSlider=function(e,t,n,i,r,o,a){void 0===t&&(t=function(e){}),void 0===n&&(n="Units"),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=function(e){return 0|e});var s=new O;s.name=n,s.value=o,s.minimum=i,s.maximum=r,s.width=.9,s.height="20px",s.color="#364249",s.background="#CCCCCC",s.borderColor="black",s.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,s.left="4px",s.paddingBottom="4px",s.onValueChangedObservable.add(function(e){s.parent.children[0].text=s.parent.children[0].name+": "+a(e)+" "+s.name,t(e)});var l=d.AddHeader(s,e+": "+a(o)+" "+n,"30px",{isHorizontal:!1,controlFirst:!1});l.height="60px",l.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,l.left="4px",l.children[0].name=e,this.groupPanel.addControl(l),this.selectors.push(l),this.groupPanel.parent&&this.groupPanel.parent.parent&&(s.color=this.groupPanel.parent.parent.buttonColor,s.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[1].background=t},t}(w),k=function(e){function t(t,n){void 0===n&&(n=[]);var i=e.call(this,t)||this;if(i.name=t,i.groups=n,i._buttonColor="#364249",i._buttonBackground="#CCCCCC",i._headerColor="black",i._barColor="white",i._barHeight="2px",i._spacerHeight="20px",i._bars=new Array,i._groups=n,i.thickness=2,i._panel=new v,i._panel.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,i._panel.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,i._panel.top=5,i._panel.left=5,i._panel.width=.95,n.length>0){for(var r=0;r<n.length-1;r++)i._panel.addControl(n[r].groupPanel),i._addSpacer();i._panel.addControl(n[n.length-1].groupPanel)}return i.addControl(i._panel),i}return r(t,e),t.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(t.prototype,"headerColor",{get:function(){return this._headerColor},set:function(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())},enumerable:!0,configurable:!0}),t.prototype._setHeaderColor=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor},Object.defineProperty(t.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())},enumerable:!0,configurable:!0}),t.prototype._setbuttonColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)},Object.defineProperty(t.prototype,"labelColor",{get:function(){return this._labelColor},set:function(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())},enumerable:!0,configurable:!0}),t.prototype._setLabelColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)},Object.defineProperty(t.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())},enumerable:!0,configurable:!0}),t.prototype._setButtonBackground=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)},Object.defineProperty(t.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())},enumerable:!0,configurable:!0}),t.prototype._setBarColor=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor},Object.defineProperty(t.prototype,"barHeight",{get:function(){return this._barHeight},set:function(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())},enumerable:!0,configurable:!0}),t.prototype._setBarHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight},Object.defineProperty(t.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())},enumerable:!0,configurable:!0}),t.prototype._setSpacerHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight},t.prototype._addSpacer=function(){var e=new f;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT;var t=new p;t.width=1,t.height=this._barHeight,t.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)},t.prototype.addGroup=function(e){this._groups.length>0&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(var t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)},t.prototype.removeGroup=function(e){e<0||e>=this._groups.length||(this._panel.removeControl(this._groups[e].groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1)))},t.prototype.setHeaderName=function(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)},t.prototype.relabel=function(e,t,n){if(!(t<0||t>=this._groups.length)){var i=this._groups[t];n<0||n>=i.selectors.length||i._setSelectorLabel(n,e)}},t.prototype.removeFromGroupSelector=function(e,t){if(!(e<0||e>=this._groups.length)){var n=this._groups[e];t<0||t>=n.selectors.length||n.removeSelector(t)}},t.prototype.addToGroupCheckbox=function(e,t,n,i){void 0===n&&(n=function(){}),void 0===i&&(i=!1),e<0||e>=this._groups.length||this._groups[e].addCheckbox(t,n,i)},t.prototype.addToGroupRadio=function(e,t,n,i){void 0===n&&(n=function(){}),void 0===i&&(i=!1),e<0||e>=this._groups.length||this._groups[e].addRadio(t,n,i)},t.prototype.addToGroupSlider=function(e,t,n,i,r,o,a,s){void 0===n&&(n=function(){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=function(e){return 0|e}),e<0||e>=this._groups.length||this._groups[e].addSlider(t,n,i,r,o,a,s)},t}(p),N=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype._getTypeName=function(){return"ScrollViewerWindow"},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=t.width,this._measureForChildren.height=t.height},t.prototype._postMeasure=function(){for(var t=this.parentClientWidth,n=this.parentClientHeight,i=0,r=this.children;i<r.length;i++){var o=r[i];o.isVisible&&!o.notRenderable&&(o.horizontalAlignment===d.HORIZONTAL_ALIGNMENT_CENTER&&o._offsetLeft(this._currentMeasure.left-o._currentMeasure.left),o.verticalAlignment===d.VERTICAL_ALIGNMENT_CENTER&&o._offsetTop(this._currentMeasure.top-o._currentMeasure.top),t=Math.max(t,o._currentMeasure.left-this._currentMeasure.left+o._currentMeasure.width),n=Math.max(n,o._currentMeasure.top-this._currentMeasure.top+o._currentMeasure.height))}this._currentMeasure.width!==t&&(this._width.updateInPlace(t,l.UNITMODE_PIXEL),this._currentMeasure.width=t,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==n&&(this._height.updateInPlace(n,l.UNITMODE_PIXEL),this._currentMeasure.height=n,this._rebuildLayout=!0,this._isDirty=!0),e.prototype._postMeasure.call(this)},t}(f),F=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._background="black",n._borderColor="white",n._thumbMeasure=new c(0,0,0,0),n}return r(t,e),Object.defineProperty(t.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Scrollbar"},t.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._renderLeft,n=this._getThumbPosition();e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this.color,this.isVertical?(this._thumbMeasure.left=t-this._effectiveBarOffset,this._thumbMeasure.top=this._currentMeasure.top+n,this._thumbMeasure.width=this._currentMeasure.width,this._thumbMeasure.height=this._effectiveThumbThickness):(this._thumbMeasure.left=this._currentMeasure.left+n,this._thumbMeasure.top=this._currentMeasure.top,this._thumbMeasure.width=this._effectiveThumbThickness,this._thumbMeasure.height=this._currentMeasure.height),e.fillRect(this._thumbMeasure.left,this._thumbMeasure.top,this._thumbMeasure.width,this._thumbMeasure.height),e.restore()},t.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._thumbMeasure.left||e>this._thumbMeasure.left+this._thumbMeasure.width||t<this._thumbMeasure.top||t>this._thumbMeasure.top+this._thumbMeasure.height)&&(this.value=this.isVertical?this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum))),this.value+=(this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness))*(this.maximum-this.minimum),this._originX=e,this._originY=t},t.prototype._onPointerDown=function(t,n,i,r){return this._first=!0,e.prototype._onPointerDown.call(this,t,n,i,r)},t}(M),B=function(e){function t(t){var n=e.call(this,t)||this;return n._barSize=20,n._pointerIsOver=!1,n._wheelPrecision=.05,n.onDirtyObservable.add(function(){n._horizontalBarSpace.color=n.color,n._verticalBarSpace.color=n.color,n._dragSpace.color=n.color}),n.onPointerEnterObservable.add(function(){n._pointerIsOver=!0}),n.onPointerOutObservable.add(function(){n._pointerIsOver=!1}),n._grid=new T,n._horizontalBar=new F,n._verticalBar=new F,n._window=new N,n._window.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,n._window.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,n._grid.addColumnDefinition(1),n._grid.addColumnDefinition(0,!0),n._grid.addRowDefinition(1),n._grid.addRowDefinition(0,!0),e.prototype.addControl.call(n,n._grid),n._grid.addControl(n._window,0,0),n._verticalBar.paddingLeft=0,n._verticalBar.width="100%",n._verticalBar.height="100%",n._verticalBar.barOffset=0,n._verticalBar.value=0,n._verticalBar.maximum=1,n._verticalBar.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,n._verticalBar.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,n._verticalBar.isVertical=!0,n._verticalBar.rotation=Math.PI,n._verticalBar.isVisible=!1,n._verticalBarSpace=new p,n._verticalBarSpace.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,n._verticalBarSpace.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,n._verticalBarSpace.thickness=1,n._grid.addControl(n._verticalBarSpace,0,1),n._verticalBarSpace.addControl(n._verticalBar),n._verticalBar.onValueChangedObservable.add(function(e){n._window.top=e*n._endTop+"px"}),n._horizontalBar.paddingLeft=0,n._horizontalBar.width="100%",n._horizontalBar.height="100%",n._horizontalBar.barOffset=0,n._horizontalBar.value=0,n._horizontalBar.maximum=1,n._horizontalBar.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_CENTER,n._horizontalBar.verticalAlignment=d.VERTICAL_ALIGNMENT_CENTER,n._horizontalBar.isVisible=!1,n._horizontalBarSpace=new p,n._horizontalBarSpace.horizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,n._horizontalBarSpace.verticalAlignment=d.VERTICAL_ALIGNMENT_TOP,n._horizontalBarSpace.thickness=1,n._grid.addControl(n._horizontalBarSpace,1,0),n._horizontalBarSpace.addControl(n._horizontalBar),n._horizontalBar.onValueChangedObservable.add(function(e){n._window.left=e*n._endLeft+"px"}),n._dragSpace=new p,n._dragSpace.thickness=1,n._grid.addControl(n._dragSpace,1,1),n.barColor="grey",n.barBackground="transparent",n}return r(t,e),Object.defineProperty(t.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),t.prototype.addControl=function(e){return e?(this._window.addControl(e),this):this},t.prototype.removeControl=function(e){return this._window.removeControl(e),this},Object.defineProperty(t.prototype,"children",{get:function(){return this._window.children},enumerable:!0,configurable:!0}),t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this._children;e<t.length;e++)t[e]._markMatrixAsDirty()},t.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},t.prototype._getTypeName=function(){return"ScrollViewer"},t.prototype._buildClientSizes=function(){this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible?this._barSize:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible?this._barSize:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},t.prototype._additionalProcessing=function(t,n){e.prototype._additionalProcessing.call(this,t,n),this._buildClientSizes()},t.prototype._postMeasure=function(){e.prototype._postMeasure.call(this),this._updateScroller()},Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(e){this._wheelPrecision!==e&&(e<0&&(e=0),e>1&&(e=1),this._wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"barSize",{get:function(){return this._barSize},set:function(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"barBackground",{get:function(){return this._barBackground},set:function(e){this._barBackground!==e&&(this._barBackground=e,this._horizontalBar.background=e,this._verticalBar.background=e,this._dragSpace.background=e)},enumerable:!0,configurable:!0}),t.prototype._updateScroller=function(){var e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&e>this._clientWidth&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&t>this._clientHeight&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes(),this._endLeft=this._clientWidth-e,this._endTop=this._clientHeight-t;var n=this._horizontalBar.value*this._endLeft+"px",i=this._verticalBar.value*this._endTop+"px";n!==this._window.left&&(this._window.left=n,this._rebuildLayout=!0),i!==this._window.top&&(this._window.top=i,this._rebuildLayout=!0);var r=this._clientHeight/t;this._horizontalBar.thumbWidth=this._clientWidth*(this._clientWidth/e)+"px",this._verticalBar.thumbWidth=this._clientHeight*r+"px"},t.prototype._link=function(t){e.prototype._link.call(this,t),this._attachWheel()},t.prototype._attachWheel=function(){var e=this;if(this._host&&!this._onPointerObserver){var t=this._host.getScene();this._onPointerObserver=t.onPointerObservable.add(function(t,n){e._pointerIsOver&&t.type===s.PointerEventTypes.POINTERWHEEL&&(1==e._verticalBar.isVisible&&(t.event.deltaY<0&&e._verticalBar.value>0?e._verticalBar.value-=e._wheelPrecision:t.event.deltaY>0&&e._verticalBar.value<e._verticalBar.maximum&&(e._verticalBar.value+=e._wheelPrecision)),1==e._horizontalBar.isVisible&&(t.event.deltaX<0&&e._horizontalBar.value<e._horizontalBar.maximum?e._horizontalBar.value+=e._wheelPrecision:t.event.deltaX>0&&e._horizontalBar.value>0&&(e._horizontalBar.value-=e._wheelPrecision)))})}},t.prototype._renderHighlightSpecific=function(t){this.isHighlighted&&(e.prototype._renderHighlightSpecific.call(this,t),this._grid._renderHighlightSpecific(t),t.restore())},t.prototype.dispose=function(){var t=this._host.getScene();t&&this._onPointerObserver&&(t.onPointerObservable.remove(this._onPointerObserver),this._onPointerObserver=null),e.prototype.dispose.call(this)},t}(p),U=function(){},V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onKeyPressObservable=new s.Observable,t.defaultButtonWidth="40px",t.defaultButtonHeight="40px",t.defaultButtonPaddingLeft="2px",t.defaultButtonPaddingRight="2px",t.defaultButtonPaddingTop="2px",t.defaultButtonPaddingBottom="2px",t.defaultButtonColor="#DDD",t.defaultButtonBackground="#070707",t.shiftButtonColor="#7799FF",t.selectedShiftThickness=1,t.shiftState=0,t._currentlyConnectedInputText=null,t._connectedInputTexts=[],t._onKeyPressObserver=null,t}return r(t,e),t.prototype._getTypeName=function(){return"VirtualKeyboard"},t.prototype._createKey=function(e,t){var n=this,i=_.CreateSimpleButton(e,e);return i.width=t&&t.width?t.width:this.defaultButtonWidth,i.height=t&&t.height?t.height:this.defaultButtonHeight,i.color=t&&t.color?t.color:this.defaultButtonColor,i.background=t&&t.background?t.background:this.defaultButtonBackground,i.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,i.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,i.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,i.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,i.thickness=0,i.isFocusInvisible=!0,i.shadowColor=this.shadowColor,i.shadowBlur=this.shadowBlur,i.shadowOffsetX=this.shadowOffsetX,i.shadowOffsetY=this.shadowOffsetY,i.onPointerUpObservable.add(function(){n.onKeyPressObservable.notifyObservers(e)}),i},t.prototype.addKeysRow=function(e,t){var n=new v;n.isVertical=!1,n.isFocusInvisible=!0;for(var i=null,r=0;r<e.length;r++){var o=null;t&&t.length===e.length&&(o=t[r]);var a=this._createKey(e[r],o);(!i||a.heightInPixels>i.heightInPixels)&&(i=a),n.addControl(a)}n.height=i?i.height:this.defaultButtonHeight,this.addControl(n)},t.prototype.applyShiftState=function(e){if(this.children)for(var t=0;t<this.children.length;t++){var n=this.children[t];if(n&&n.children)for(var i=n,r=0;r<i.children.length;r++){var o=i.children[r];if(o&&o.children[0]){var a=o.children[0];"\u21e7"===a.text&&(o.color=e?this.shiftButtonColor:this.defaultButtonColor,o.thickness=e>1?this.selectedShiftThickness:0),a.text=e>0?a.text.toUpperCase():a.text.toLowerCase()}}}},Object.defineProperty(t.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;if(!this._connectedInputTexts.some(function(t){return t.input===e})){null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add(function(e){if(t._currentlyConnectedInputText){switch(t._currentlyConnectedInputText._host.focusedControl=t._currentlyConnectedInputText,e){case"\u21e7":return t.shiftState++,t.shiftState>2&&(t.shiftState=0),void t.applyShiftState(t.shiftState);case"\u2190":return void t._currentlyConnectedInputText.processKey(8);case"\u21b5":return void t._currentlyConnectedInputText.processKey(13)}t._currentlyConnectedInputText.processKey(-1,t.shiftState?e.toUpperCase():e),1===t.shiftState&&(t.shiftState=0,t.applyShiftState(t.shiftState))}})),this.isVisible=!1,this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this;var n=e.onFocusObservable.add(function(){t._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=t,t.isVisible=!0}),i=e.onBlurObservable.add(function(){e._connectedVirtualKeyboard=null,t._currentlyConnectedInputText=null,t.isVisible=!1});this._connectedInputTexts.push({input:e,onBlurObserver:i,onFocusObserver:n})}},t.prototype.disconnect=function(e){var t=this;if(e){var n=this._connectedInputTexts.filter(function(t){return t.input===e});1===n.length&&(this._removeConnectedInputObservables(n[0]),this._connectedInputTexts=this._connectedInputTexts.filter(function(t){return t.input!==e}),this._currentlyConnectedInputText===e&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach(function(e){t._removeConnectedInputObservables(e)}),this._connectedInputTexts=[];0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},t.prototype._removeConnectedInputObservables=function(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.disconnect()},t.CreateDefaultLayout=function(e){var n=new t(e);return n.addKeysRow(["1","2","3","4","5","6","7","8","9","0","\u2190"]),n.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),n.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","\u21b5"]),n.addKeysRow(["\u21e7","z","x","c","v","b","n","m",",",".","/"]),n.addKeysRow([" "],[{width:"200px"}]),n},t}(v),G=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._cellWidth=20,n._cellHeight=20,n._minorLineTickness=1,n._minorLineColor="DarkGray",n._majorLineTickness=2,n._majorLineColor="White",n._majorLineFrequency=5,n._background="Black",n._displayMajorLines=!0,n._displayMinorLines=!0,n}return r(t,e),Object.defineProperty(t.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(e){this._minorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(e){this._minorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(e){this._majorLineTickness=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(e){this._majorLineColor=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(e){this._majorLineFrequency=e,this._markAsDirty()},enumerable:!0,configurable:!0}),t.prototype._draw=function(e){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var t=this._currentMeasure.width/this._cellWidth,n=this._currentMeasure.height/this._cellHeight,i=this._currentMeasure.left+this._currentMeasure.width/2,r=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(var o=-t/2;o<t/2;o++){var a=i+o*this.cellWidth;e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(var s=-n/2;s<n/2;s++){var l=r+s*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,l),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.stroke()}}if(this._displayMajorLines){for(e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness,o=-t/2+this._majorLineFrequency;o<t/2;o+=this._majorLineFrequency)a=i+o*this.cellWidth,e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke();for(s=-n/2+this._majorLineFrequency;s<n/2;s+=this._majorLineFrequency)e.moveTo(this._currentMeasure.left,l=r+s*this.cellHeight),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,l),e.closePath(),e.stroke()}}e.restore()},t.prototype._getTypeName=function(){return"DisplayGrid"},t}(d),z=function(e){function t(t){var n=e.call(this,t)||this;return n.name=t,n._tempMeasure=new c(0,0,0,0),n}return r(t,e),Object.defineProperty(t.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(e){var t=this;this._backgroundImage!==e&&(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(e){var t=this;this._valueBarImage!==e&&(this._valueBarImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(e){var t=this;this._thumbImage!==e&&(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce(function(){return t._markAsDirty()}),this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"ImageBasedSlider"},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._getThumbPosition(),n=this._renderLeft,i=this._renderTop,r=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(n,i,r,o),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this._tempMeasure.copyFromFloats(n,i+t,r,this.isThumbClamped&&this.displayThumb?o-t+this._effectiveThumbThickness:o-t):this._tempMeasure.copyFromFloats(n,i,this.isThumbClamped&&this.displayThumb?t+this._effectiveThumbThickness/2:t,o),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(n-this._effectiveBarOffset,this._currentMeasure.top+t,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},t}(M);d.AddHeader=function(e,t,n,i){var r=new v("panel"),o=!i||i.isHorizontal,a=!i||i.controlFirst;r.isVertical=!o;var s=new g("header");return s.text=t,s.textHorizontalAlignment=d.HORIZONTAL_ALIGNMENT_LEFT,o?s.width=n:s.height=n,a?(r.addControl(e),r.addControl(s),s.paddingLeft="5px"):(r.addControl(s),r.addControl(e),s.paddingRight="5px"),s.shadowBlur=e.shadowBlur,s.shadowColor=e.shadowColor,s.shadowOffsetX=e.shadowOffsetX,s.shadowOffsetY=e.shadowOffsetY,r};var j=function(){function e(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new l(18,l.UNITMODE_PIXEL,!1),this.onChangedObservable=new s.Observable,this._host=e}return Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.onChangedObservable.clear()},e}(),H=function(e){function t(t,n,i,r,o,a){void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=!1),void 0===a&&(a=s.Texture.NEAREST_SAMPLINGMODE);var l=e.call(this,t,{width:n,height:i},r,o,a,s.Engine.TEXTUREFORMAT_RGBA)||this;return l._isDirty=!1,l._rootContainer=new f("root"),l._lastControlOver={},l._lastControlDown={},l._capturingControl={},l._linkedControls=new Array,l._isFullscreen=!1,l._fullscreenViewport=new s.Viewport(0,0,1,1),l._idealWidth=0,l._idealHeight=0,l._useSmallestIdeal=!1,l._renderAtIdealSize=!1,l._blockNextFocusCheck=!1,l._renderScale=1,l._cursorChanged=!1,l._clipboardData="",l.onClipboardObservable=new s.Observable,l.onControlPickedObservable=new s.Observable,l.onBeginLayoutObservable=new s.Observable,l.onEndLayoutObservable=new s.Observable,l.onBeginRenderObservable=new s.Observable,l.onEndRenderObservable=new s.Observable,l.premulAlpha=!1,l._useInvalidateRectOptimization=!0,l._invalidatedRectangle=null,l._clearMeasure=new c(0,0,0,0),l.onClipboardCopy=function(e){var t=e,n=new s.ClipboardInfo(s.ClipboardEventTypes.COPY,t);l.onClipboardObservable.notifyObservers(n),t.preventDefault()},l.onClipboardCut=function(e){var t=e,n=new s.ClipboardInfo(s.ClipboardEventTypes.CUT,t);l.onClipboardObservable.notifyObservers(n),t.preventDefault()},l.onClipboardPaste=function(e){var t=e,n=new s.ClipboardInfo(s.ClipboardEventTypes.PASTE,t);l.onClipboardObservable.notifyObservers(n),t.preventDefault()},(r=l.getScene())&&l._texture?(l._rootCanvas=r.getEngine().getRenderingCanvas(),l._renderObserver=r.onBeforeCameraRenderObservable.add(function(e){return l._checkUpdate(e)}),l._preKeyboardObserver=r.onPreKeyboardObservable.add(function(e){l._focusedControl&&(e.type===s.KeyboardEventTypes.KEYDOWN&&l._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)}),l._rootContainer._link(l),l.hasAlpha=!0,n&&i||(l._resizeObserver=r.getEngine().onResizeObservable.add(function(){return l._onResize()}),l._onResize()),l._texture.isReady=!0,l):l}return r(t,e),Object.defineProperty(t.prototype,"renderScale",{get:function(){return this._renderScale},set:function(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),t.prototype.getChildren=function(){return[this._rootContainer]},t.prototype.getDescendants=function(e,t){return this._rootContainer.getDescendants(e,t)},Object.defineProperty(t.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(e){this._clipboardData=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"AdvancedDynamicTexture"},t.prototype.executeOnAllControls=function(e,t){t||(t=this._rootContainer),e(t);for(var n=0,i=t.children;n<i.length;n++){var r=i[n];r.children?this.executeOnAllControls(e,r):e(r)}},Object.defineProperty(t.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(e){this._useInvalidateRectOptimization=e},enumerable:!0,configurable:!0}),t.prototype.invalidateRect=function(e,t,n,i){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var r=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,n)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,i));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=r-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new c(e,t,n-e+1,i-t+1)},t.prototype.markAsDirty=function(){this._isDirty=!0},t.prototype.createStyle=function(){return new j(this)},t.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},t.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},t.prototype.dispose=function(){var t=this.getScene();t&&(this._rootCanvas=null,t.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&t.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&t.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&t.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&t.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&t.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),e.prototype.dispose.call(this))},t.prototype._onResize=function(){var e=this.getScene();if(e){var t=e.getEngine(),n=this.getSize(),i=t.getRenderWidth()*this._renderScale,r=t.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/i,i=this._idealWidth):this._idealHeight&&(i=i*this._idealHeight/r,r=this._idealHeight)),n.width===i&&n.height===r||(this.scaleTo(i,r),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,n.width-1,n.height-1)}},t.prototype._getGlobalViewport=function(e){var t=e.getEngine();return this._fullscreenViewport.toGlobal(t.getRenderWidth(),t.getRenderHeight())},t.prototype.getProjectedPosition=function(e,t){var n=this.getScene();if(!n)return s.Vector2.Zero();var i=this._getGlobalViewport(n),r=s.Vector3.Project(e,t,n.getTransformMatrix(),i);return r.scaleInPlace(this.renderScale),new s.Vector2(r.x,r.y)},t.prototype._checkUpdate=function(e){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var t=this.getScene();if(!t)return;for(var n=this._getGlobalViewport(t),i=0,r=this._linkedControls;i<r.length;i++){var o=r[i];if(o.isVisible){var a=o._linkedMesh;if(a&&!a.isDisposed()){var l=a.getBoundingInfo?a.getBoundingInfo().boundingSphere.center:a.getAbsolutePosition(),c=s.Vector3.Project(l,a.getWorldMatrix(),t.getTransformMatrix(),n);c.z<0||c.z>1?o.notRenderable=!0:(o.notRenderable=!1,c.scaleInPlace(this.renderScale),o._moveToProjectedPosition(c))}else s.Tools.SetImmediate(function(){o.linkWithMesh(null)})}}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(!0,this.premulAlpha))}},t.prototype._render=function(){var e=this.getSize(),t=e.width,n=e.height,i=this.getContext();i.font="18px Arial",i.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var r=new c(0,0,t,n);this._rootContainer._layout(r,i),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,t,n),i.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(i.save(),i.fillStyle=this._background,i.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),i.restore()),this.onBeginRenderObservable.notifyObservers(this),this._rootContainer._render(i,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},t.prototype._changeCursor=function(e){this._rootCanvas&&(this._rootCanvas.style.cursor=e,this._cursorChanged=!0)},t.prototype._registerLastControlDown=function(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)},t.prototype._doPicking=function(e,t,n,i,r){var o=this.getScene();if(o){var a=o.getEngine(),l=this.getSize();if(this._isFullscreen){var c=(o.cameraToUseForPointers||o.activeCamera).viewport;e*=l.width/(a.getRenderWidth()*c.width),t*=l.height/(a.getRenderHeight()*c.height)}this._capturingControl[i]?this._capturingControl[i]._processObservables(n,e,t,i,r):(this._cursorChanged=!1,this._rootContainer._processPicking(e,t,n,i,r)||(this._changeCursor(""),n===s.PointerEventTypes.POINTERMOVE&&this._lastControlOver[i]&&(this._lastControlOver[i]._onPointerOut(this._lastControlOver[i]),delete this._lastControlOver[i])),this._cursorChanged||this._changeCursor(""),this._manageFocus())}},t.prototype._cleanControlAfterRemovalFromList=function(e,t){for(var n in e)e.hasOwnProperty(n)&&e[n]===t&&delete e[n]},t.prototype._cleanControlAfterRemoval=function(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)},t.prototype.attach=function(){var e=this,t=this.getScene();if(t){var n=new s.Viewport(0,0,0,0);this._pointerMoveObserver=t.onPrePointerObservable.add(function(i,r){if(!t.isPointerCaptured(i.event.pointerId)&&(i.type===s.PointerEventTypes.POINTERMOVE||i.type===s.PointerEventTypes.POINTERUP||i.type===s.PointerEventTypes.POINTERDOWN)&&t){var o=t.cameraToUseForPointers||t.activeCamera,a=t.getEngine();o?o.viewport.toGlobalToRef(a.getRenderWidth(),a.getRenderHeight(),n):(n.x=0,n.y=0,n.width=a.getRenderWidth(),n.height=a.getRenderHeight());var l=t.pointerX/a.getHardwareScalingLevel()-n.x,c=t.pointerY/a.getHardwareScalingLevel()-(a.getRenderHeight()-n.y-n.height);e._shouldBlockPointer=!1,e._doPicking(l,c,i.type,i.event.pointerId||0,i.event.button),e._shouldBlockPointer&&(i.skipOnPointerObservable=e._shouldBlockPointer)}}),this._attachToOnPointerOut(t)}},t.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},t.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},t.prototype.attachToMesh=function(e,t){var n=this;void 0===t&&(t=!0);var i=this.getScene();i&&(this._pointerObserver=i.onPointerObservable.add(function(t,i){if(t.type===s.PointerEventTypes.POINTERMOVE||t.type===s.PointerEventTypes.POINTERUP||t.type===s.PointerEventTypes.POINTERDOWN){var r=t.event.pointerId||0;if(t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh===e){var o=t.pickInfo.getTextureCoordinates();if(o){var a=n.getSize();n._doPicking(o.x*a.width,(1-o.y)*a.height,t.type,r,t.event.button)}}else if(t.type===s.PointerEventTypes.POINTERUP){if(n._lastControlDown[r]&&n._lastControlDown[r]._forcePointerUp(r),delete n._lastControlDown[r],n.focusedControl){var l=n.focusedControl.keepsFocusWith(),c=!0;if(l)for(var u=0,h=l;u<h.length;u++){var d=h[u];if(n!==d._host){var f=d._host;if(f._lastControlOver[r]&&f._lastControlOver[r].isAscendant(d)){c=!1;break}}}c&&(n.focusedControl=null)}}else t.type===s.PointerEventTypes.POINTERMOVE&&(n._lastControlOver[r]&&n._lastControlOver[r]._onPointerOut(n._lastControlOver[r],!0),delete n._lastControlOver[r])}}),e.enablePointerMoveEvents=t,this._attachToOnPointerOut(i))},t.prototype.moveFocusToControl=function(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0},t.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},t.prototype._attachToOnPointerOut=function(e){var t=this;this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add(function(e){t._lastControlOver[e.pointerId]&&t._lastControlOver[e.pointerId]._onPointerOut(t._lastControlOver[e.pointerId]),delete t._lastControlOver[e.pointerId],t._lastControlDown[e.pointerId]&&t._lastControlDown[e.pointerId]!==t._capturingControl[e.pointerId]&&(t._lastControlDown[e.pointerId]._forcePointerUp(),delete t._lastControlDown[e.pointerId])})},t.CreateForMesh=function(e,n,i,r,o){void 0===n&&(n=1024),void 0===i&&(i=1024),void 0===r&&(r=!0),void 0===o&&(o=!1);var a=new t(e.name+" AdvancedDynamicTexture",n,i,e.getScene(),!0,s.Texture.TRILINEAR_SAMPLINGMODE),l=new s.StandardMaterial("AdvancedDynamicTextureMaterial",e.getScene());return l.backFaceCulling=!1,l.diffuseColor=s.Color3.Black(),l.specularColor=s.Color3.Black(),o?(l.diffuseTexture=a,l.emissiveTexture=a,a.hasAlpha=!0):(l.emissiveTexture=a,l.opacityTexture=a),e.material=l,a.attachToMesh(e,r),a},t.CreateFullscreenUI=function(e,n,i,r){void 0===n&&(n=!0),void 0===i&&(i=null),void 0===r&&(r=s.Texture.BILINEAR_SAMPLINGMODE);var o=new t(e,0,0,i,!1,r),a=new s.Layer(e+"_layer",null,i,!n);return a.texture=o,o._layerToDispose=a,o._isFullscreen=!0,o.attach(),o},t}(s.DynamicTexture),W=function(){function e(e){this.texture=e,this._captureRenderTime=!1,this._renderTime=new s.PerfCounter,this._captureLayoutTime=!1,this._layoutTime=new s.PerfCounter,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}return Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutTimeCounter",{get:function(){return this._layoutTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add(function(){t._renderTime.beginMonitoring()}),this._onEndRenderObserver=this.texture.onEndRenderObservable.add(function(){t._renderTime.endMonitoring(!0)})):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureLayoutTime",{get:function(){return this._captureLayoutTime},set:function(e){var t=this;e!==this._captureLayoutTime&&(this._captureLayoutTime=e,e?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add(function(){t._layoutTime.beginMonitoring()}),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add(function(){t._layoutTime.endMonitoring(!0)})):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null},e}(),X=function(e){function t(t,n){void 0===n&&(n=0);var i=e.call(this,t.x,t.y,t.z)||this;return i.buttonIndex=n,i}return r(t,e),t}(s.Vector3),Y=function(){function e(e){this.name=e,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this.onPointerMoveObservable=new s.Observable,this.onPointerOutObservable=new s.Observable,this.onPointerDownObservable=new s.Observable,this.onPointerUpObservable=new s.Observable,this.onPointerClickObservable=new s.Observable,this.onPointerEnterObservable=new s.Observable,this._behaviors=new Array}return Object.defineProperty(e.prototype,"position",{get:function(){return this._node?this._node.position:s.Vector3.Zero()},set:function(e){this._node&&(this._node.position=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this._node?this._node.scaling:new s.Vector3(1,1,1)},set:function(e){this._node&&(this._node.scaling=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),e.prototype.addBehavior=function(e){var t=this;if(-1!==this._behaviors.indexOf(e))return this;e.init();var n=this._host.scene;return n.isLoading?n.onDataLoadedObservable.addOnce(function(){e.attach(t)}):e.attach(this),this._behaviors.push(e),this},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},e.prototype.getBehaviorByName=function(e){for(var t=0,n=this._behaviors;t<n.length;t++){var i=n[t];if(i.name===e)return i}return null},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){if(this._isVisible!==e){this._isVisible=e;var t=this.mesh;t&&t.setEnabled(e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},e.prototype._getTypeName=function(){return"Control3D"},Object.defineProperty(e.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._node instanceof s.AbstractMesh?this._node:null},enumerable:!0,configurable:!0}),e.prototype.linkToTransformNode=function(e){return this._node&&(this._node.parent=e),this},e.prototype._prepareNode=function(e){if(!this._node){if(this._node=this._createNode(e),!this.node)return;this._node.metadata=this,this._node.position=this.position,this._node.scaling=this.scaling;var t=this.mesh;t&&(t.isPickable=!0,this._affectMaterial(t))}},e.prototype._createNode=function(e){return null},e.prototype._affectMaterial=function(e){e.material=null},e.prototype._onPointerMove=function(e,t){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)},e.prototype._onPointerEnter=function(e){return!(this._enterCount>0||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),0))},e.prototype._onPointerOut=function(e){this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,e,this),this.pointerOutAnimation&&this.pointerOutAnimation()},e.prototype._onPointerDown=function(e,t,n,i){return 0!==this._downCount?(this._downCount++,!1):(this._downCount++,this._downPointerIds[n]=!0,this.onPointerDownObservable.notifyObservers(new X(t,i),-1,e,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},e.prototype._onPointerUp=function(e,t,n,i,r){this._downCount--,delete this._downPointerIds[n],this._downCount<0?this._downCount=0:0==this._downCount&&(r&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new X(t,i),-1,e,this),this.onPointerUpObservable.notifyObservers(new X(t,i),-1,e,this),this.pointerUpAnimation&&this.pointerUpAnimation())},e.prototype.forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,s.Vector3.Zero(),e,0,!0);else{for(var t in this._downPointerIds)this._onPointerUp(this,s.Vector3.Zero(),+t,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,s.Vector3.Zero(),0,0,!0))}},e.prototype._processObservables=function(e,t,n,i){if(e===s.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,t);var r=this._host._lastControlOver[n];return r&&r!==this&&r._onPointerOut(this),r!==this&&this._onPointerEnter(this),this._host._lastControlOver[n]=this,!0}return e===s.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,t,n,i),this._host._lastControlDown[n]=this,this._host._lastPickedControl=this,!0):e===s.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[n]&&this._host._lastControlDown[n]._onPointerUp(this,t,n,i,!0),delete this._host._lastControlDown[n],!0)},e.prototype._disposeNode=function(){this._node&&(this._node.dispose(),this._node=null)},e.prototype.dispose=function(){this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode();for(var e=0,t=this._behaviors;e<t.length;e++)t[e].detach()},e}(),K=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype._getTypeName=function(){return"AbstractButton3D"},t.prototype._createNode=function(e){return new s.TransformNode("button"+this.name)},t}(Y),Q=function(e){function t(t){var n=e.call(this,t)||this;return n._contentResolution=512,n._contentScaleRatio=2,n.pointerEnterAnimation=function(){n.mesh&&(n._currentMaterial.emissiveColor=s.Color3.Red())},n.pointerOutAnimation=function(){n._currentMaterial.emissiveColor=s.Color3.Black()},n.pointerDownAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(.95)},n.pointerUpAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1/.95)},n}return r(t,e),Object.defineProperty(t.prototype,"contentResolution",{get:function(){return this._contentResolution},set:function(e){this._contentResolution!==e&&(this._contentResolution=e,this._resetContent())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentScaleRatio",{get:function(){return this._contentScaleRatio},set:function(e){this._contentScaleRatio!==e&&(this._contentScaleRatio=e,this._resetContent())},enumerable:!0,configurable:!0}),t.prototype._disposeFacadeTexture=function(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)},t.prototype._resetContent=function(){this._disposeFacadeTexture(),this.content=this._content},Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e,this._host&&this._host.utilityLayer&&(this._facadeTexture||(this._facadeTexture=new H("Facade",this._contentResolution,this._contentResolution,this._host.utilityLayer.utilityLayerScene,!0,s.Texture.TRILINEAR_SAMPLINGMODE),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatio,this._facadeTexture.premulAlpha=!0),this._facadeTexture.addControl(e),this._applyFacade(this._facadeTexture))},enumerable:!0,configurable:!0}),t.prototype._applyFacade=function(e){this._currentMaterial.emissiveTexture=e},t.prototype._getTypeName=function(){return"Button3D"},t.prototype._createNode=function(e){for(var t=new Array(6),n=0;n<6;n++)t[n]=new s.Vector4(0,0,0,0);return t[1]=new s.Vector4(0,0,1,1),s.BoxBuilder.CreateBox(this.name+"_rootMesh",{width:1,height:1,depth:.08,faceUV:t},e)},t.prototype._affectMaterial=function(e){var t=new s.StandardMaterial(this.name+"Material",e.getScene());t.specularColor=s.Color3.Black(),e.material=t,this._currentMaterial=t,this._resetContent()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()},t}(K),q=function(e){function t(t){var n=e.call(this,t)||this;return n._blockLayout=!1,n._children=new Array,n}return r(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockLayout",{get:function(){return this._blockLayout},set:function(e){this._blockLayout!==e&&(this._blockLayout=e,this._blockLayout||this._arrangeChildren())},enumerable:!0,configurable:!0}),t.prototype.updateLayout=function(){return this._arrangeChildren(),this},t.prototype.containsControl=function(e){return-1!==this._children.indexOf(e)},t.prototype.addControl=function(e){return-1!==this._children.indexOf(e)?this:(e.parent=this,e._host=this._host,this._children.push(e),this._host.utilityLayer&&(e._prepareNode(this._host.utilityLayer.utilityLayerScene),e.node&&(e.node.parent=this.node),this.blockLayout||this._arrangeChildren()),this)},t.prototype._arrangeChildren=function(){},t.prototype._createNode=function(e){return new s.TransformNode("ContainerNode",e)},t.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null,e._disposeNode()),this},t.prototype._getTypeName=function(){return"Container3D"},t.prototype.dispose=function(){for(var t=0,n=this._children;t<n.length;t++)n[t].dispose();this._children=[],e.prototype.dispose.call(this)},t.UNSET_ORIENTATION=0,t.FACEORIGIN_ORIENTATION=1,t.FACEORIGINREVERSED_ORIENTATION=2,t.FACEFORWARD_ORIENTATION=3,t.FACEFORWARDREVERSED_ORIENTATION=4,t}(Y),Z=function(e){function t(){var t=e.call(this)||this;return t._columns=10,t._rows=0,t._rowThenColum=!0,t._orientation=q.FACEORIGIN_ORIENTATION,t.margin=0,t}return r(t,e),Object.defineProperty(t.prototype,"orientation",{get:function(){return this._orientation},set:function(e){var t=this;this._orientation!==e&&(this._orientation=e,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},set:function(e){var t=this;this._columns!==e&&(this._columns=e,this._rowThenColum=!0,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},set:function(e){var t=this;this._rows!==e&&(this._rows=e,this._rowThenColum=!1,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),t.prototype._arrangeChildren=function(){this._cellWidth=0,this._cellHeight=0;for(var e=0,t=0,n=0,i=s.Matrix.Invert(this.node.computeWorldMatrix(!0)),r=0,o=this._children;r<o.length;r++)if((v=o[r]).mesh){n++,v.mesh.computeWorldMatrix(!0);var a=v.mesh.getHierarchyBoundingVectors(),l=s.Tmp.Vector3[0],c=s.Tmp.Vector3[1];a.max.subtractToRef(a.min,c),c.scaleInPlace(.5),s.Vector3.TransformNormalToRef(c,i,l),this._cellWidth=Math.max(this._cellWidth,2*l.x),this._cellHeight=Math.max(this._cellHeight,2*l.y)}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(t=this._columns,e=Math.ceil(n/this._columns)):(e=this._rows,t=Math.ceil(n/this._rows));var u=.5*t*this._cellWidth,h=.5*e*this._cellHeight,d=[],f=0;if(this._rowThenColum)for(var p=0;p<e;p++)for(var g=0;g<t&&(d.push(new s.Vector3(g*this._cellWidth-u+this._cellWidth/2,p*this._cellHeight-h+this._cellHeight/2,0)),!(++f>n));g++);else for(g=0;g<t;g++)for(p=0;p<e&&(d.push(new s.Vector3(g*this._cellWidth-u+this._cellWidth/2,p*this._cellHeight-h+this._cellHeight/2,0)),!(++f>n));p++);f=0;for(var m=0,_=this._children;m<_.length;m++){var v;(v=_[m]).mesh&&(this._mapGridNode(v,d[f]),f++)}this._finalProcessing()},t.prototype._finalProcessing=function(){},t}(q),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._radius=5,t}return r(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){var t=this;this._radius!==e&&(this._radius=e,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),t.prototype._mapGridNode=function(e,t){var n=e.mesh;if(n){var i=this._cylindricalMapping(t);switch(e.position=i,this.orientation){case q.FACEORIGIN_ORIENTATION:n.lookAt(new s.Vector3(2*i.x,i.y,2*i.z));break;case q.FACEORIGINREVERSED_ORIENTATION:n.lookAt(new s.Vector3(-i.x,i.y,-i.z));break;case q.FACEFORWARD_ORIENTATION:break;case q.FACEFORWARDREVERSED_ORIENTATION:n.rotate(s.Axis.Y,Math.PI,s.Space.LOCAL)}}},t.prototype._cylindricalMapping=function(e){var t=new s.Vector3(0,e.y,this._radius);return s.Matrix.RotationYawPitchRollToRef(e.x/this._radius,0,0,s.Tmp.Matrix[0]),s.Vector3.TransformNormal(t,s.Tmp.Matrix[0])},t}(Z);s.Effect.ShadersStore.fluentVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 world;\nuniform mat4 viewProjection;\nvarying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float borderWidth;\nuniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {\nvUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;\nfloat minScale=min(min(scale.x,scale.y),scale.z);\nfloat maxScale=max(max(scale.x,scale.y),scale.z);\nfloat minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);\nfloat areaYZ=scale.y*scale.z;\nfloat areaXZ=scale.x*scale.z;\nfloat areaXY=scale.x*scale.y;\nfloat scaledBorderWidth=borderWidth;\nif (abs(normal.x) == 1.0)\n{\nscale.x=scale.y;\nscale.y=scale.z;\nif (areaYZ>areaXZ && areaYZ>areaXY)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse if (abs(normal.y) == 1.0)\n{\nscale.x=scale.z;\nif (areaXZ>areaXY && areaXZ>areaYZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse\n{\nif (areaXY>areaYZ && areaXY>areaXZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);\nif (scale.x>scale.y)\n{\nscaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);\nscaleInfo.y=1.0-scaledBorderWidth;\n}\nelse\n{\nscaleInfo.x=1.0-scaledBorderWidth;\nscaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);\n}\n#endif\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;\n}\n",s.Effect.ShadersStore.fluentPixelShader="precision highp float;\nvarying vec2 vUV;\nuniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float edgeSmoothingValue;\nuniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\nuniform vec3 hoverPosition;\nuniform vec4 hoverColor;\nuniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;\n#endif\nvoid main(void) {\nvec3 albedo=albedoColor.rgb;\nfloat alpha=albedoColor.a;\n#ifdef TEXTURE\nalbedo=texture2D(albedoSampler,vUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;\nalbedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER\nfloat borderPower=10.0;\nfloat inverseBorderPower=1.0/borderPower;\nvec3 borderColor=albedo*borderPower;\nvec2 distanceToEdge;\ndistanceToEdge.x=abs(vUV.x-0.5)*2.0;\ndistanceToEdge.y=abs(vUV.y-0.5)*2.0;\nfloat borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));\nborderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover);\nalbedo+=borderColor;\nalpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\n\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);\nuvGlow=uvGlow*uvGlow;\nuvGlow=uvGlow*uvGlow;\nalbedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y);\n#endif\ngl_FragColor=vec4(albedo,alpha);\n}";var $=function(e){function t(){var t=e.call(this)||this;return t.INNERGLOW=!1,t.BORDER=!1,t.HOVERLIGHT=!1,t.TEXTURE=!1,t.rebuild(),t}return r(t,e),t}(s.MaterialDefines),ee=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.innerGlowColorIntensity=.5,i.innerGlowColor=new s.Color3(1,1,1),i.alpha=1,i.albedoColor=new s.Color3(.3,.35,.4),i.renderBorders=!1,i.borderWidth=.5,i.edgeSmoothingValue=.02,i.borderMinValue=.1,i.renderHoverLight=!1,i.hoverRadius=1,i.hoverColor=new s.Color4(.3,.3,.3,1),i.hoverPosition=s.Vector3.Zero(),i}return r(t,e),t.prototype.needAlphaBlending=function(){return 1!==this.alpha},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&this._wasPreviouslyReady&&t.effect)return!0;t._materialDefines||(t._materialDefines=new $);var i=this.getScene(),r=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&r._renderId===i.getRenderId())return!0;if(r._areTexturesDirty)if(r.INNERGLOW=this.innerGlowColorIntensity>0,r.BORDER=this.renderBorders,r.HOVERLIGHT=this.renderHoverLight,this._albedoTexture){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;r.TEXTURE=!0}else r.TEXTURE=!1;var o=i.getEngine();if(r.isDirty){r.markAsProcessed(),i.resetCachedMaterial();var a=[s.VertexBuffer.PositionKind];a.push(s.VertexBuffer.NormalKind),a.push(s.VertexBuffer.UVKind);var l=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius"],c=["albedoSampler"],u=new Array;s.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:l,uniformBuffersNames:u,samplers:c,defines:r,maxSimultaneousLights:4});var h=r.toString();t.setEffect(i.getEngine().createEffect("fluent",{attributes:a,uniformsNames:l,uniformBuffersNames:u,samplers:c,defines:h,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o))}return!(!t.effect||!t.effect.isReady()||(r._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n._materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),this._mustRebind(i,o)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),r.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),r.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),t.getBoundingInfo().boundingBox.extendSize.multiplyToRef(t.scaling,s.Tmp.Vector3[0]),this._activeEffect.setVector3("scaleFactor",s.Tmp.Vector3[0])),r.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),r.TEXTURE&&this._activeEffect.setTexture("albedoSampler",this._albedoTexture)),this._afterBind(t,this._activeEffect))}},t.prototype.getActiveTextures=function(){return e.prototype.getActiveTextures.call(this)},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return s.SerializationHelper.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=s.SerializationHelper.Serialize(this);return e.customType="BABYLON.GUI.FluentMaterial",e},t.prototype.getClassName=function(){return"FluentMaterial"},t.Parse=function(e,n,i){return s.SerializationHelper.Parse(function(){return new t(e.name,n)},e,n,i)},o([Object(s.serialize)(),Object(s.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"innerGlowColorIntensity",void 0),o([Object(s.serializeAsColor3)()],t.prototype,"innerGlowColor",void 0),o([Object(s.serialize)()],t.prototype,"alpha",void 0),o([Object(s.serializeAsColor3)()],t.prototype,"albedoColor",void 0),o([Object(s.serialize)(),Object(s.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"renderBorders",void 0),o([Object(s.serialize)()],t.prototype,"borderWidth",void 0),o([Object(s.serialize)()],t.prototype,"edgeSmoothingValue",void 0),o([Object(s.serialize)()],t.prototype,"borderMinValue",void 0),o([Object(s.serialize)(),Object(s.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"renderHoverLight",void 0),o([Object(s.serialize)()],t.prototype,"hoverRadius",void 0),o([Object(s.serializeAsColor4)()],t.prototype,"hoverColor",void 0),o([Object(s.serializeAsVector3)()],t.prototype,"hoverPosition",void 0),o([Object(s.serializeAsTexture)("albedoTexture")],t.prototype,"_albedoTexture",void 0),o([Object(s.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"albedoTexture",void 0),t}(s.PushMaterial);s._TypeStore.RegisteredTypes["BABYLON.GUI.FluentMaterial"]=ee;var te=function(e){function t(t,n){void 0===n&&(n=!0);var i=e.call(this,t)||this;return i._shareMaterials=!0,i._shareMaterials=n,i.pointerEnterAnimation=function(){i.mesh&&i._frontPlate.setEnabled(!0)},i.pointerOutAnimation=function(){i.mesh&&i._frontPlate.setEnabled(!1)},i}return r(t,e),t.prototype._disposeTooltip=function(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)},Object.defineProperty(t.prototype,"tooltipText",{get:function(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null},set:function(e){var t=this;if(e){if(!this._tooltipFade){this._tooltipMesh=s.PlaneBuilder.CreatePlane("",{size:1},this._backPlate._scene);var n=s.PlaneBuilder.CreatePlane("",{size:1,sideOrientation:s.Mesh.DOUBLESIDE},this._backPlate._scene),i=new s.StandardMaterial("",this._backPlate._scene);i.diffuseColor=s.Color3.FromHexString("#212121"),n.material=i,n.isPickable=!1,this._tooltipMesh.addChild(n),n.position.z=.05,this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position.y=.7,this._tooltipMesh.position.z=-.15,this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=H.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new g,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new s.FadeInOutBehavior,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add(function(){t._tooltipFade&&t._tooltipFade.fadeIn(!0)}),this._tooltipOutObserver=this.onPointerOutObservable.add(function(){t._tooltipFade&&t._tooltipFade.fadeIn(!1)})}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}else this._disposeTooltip()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backMaterial",{get:function(){return this._backMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frontMaterial",{get:function(){return this._frontMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plateMaterial",{get:function(){return this._plateMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"HolographicButton"},t.prototype._rebuildContent=function(){this._disposeFacadeTexture();var e=new v;if(e.isVertical=!0,this._imageUrl){var t=new m;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){var n=new g;n.text=this._text,n.color="white",n.height="30px",n.fontSize=24,e.addControl(n)}this._frontPlate&&(this.content=e)},t.prototype._createNode=function(t){return this._backPlate=s.BoxBuilder.CreateBox(this.name+"BackMesh",{width:1,height:1,depth:.08},t),this._frontPlate=s.BoxBuilder.CreateBox(this.name+"FrontMesh",{width:1,height:1,depth:.08},t),this._frontPlate.parent=this._backPlate,this._frontPlate.position.z=-.08,this._frontPlate.isPickable=!1,this._frontPlate.setEnabled(!1),this._textPlate=e.prototype._createNode.call(this,t),this._textPlate.parent=this._backPlate,this._textPlate.position.z=-.08,this._textPlate.isPickable=!1,this._backPlate},t.prototype._applyFacade=function(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e},t.prototype._createBackMaterial=function(e){var t=this;this._backMaterial=new ee(this.name+"Back Material",e.getScene()),this._backMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add(function(e){e?(t._backMaterial.hoverPosition=e,t._backMaterial.hoverColor.a=1):t._backMaterial.hoverColor.a=0})},t.prototype._createFrontMaterial=function(e){this._frontMaterial=new ee(this.name+"Front Material",e.getScene()),this._frontMaterial.innerGlowColorIntensity=0,this._frontMaterial.alpha=.5,this._frontMaterial.renderBorders=!0},t.prototype._createPlateMaterial=function(e){this._plateMaterial=new s.StandardMaterial(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=s.Color3.Black()},t.prototype._affectMaterial=function(e){this._shareMaterials?(this._host._sharedMaterials.backFluentMaterial?this._backMaterial=this._host._sharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._sharedMaterials.backFluentMaterial=this._backMaterial),this._host._sharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._sharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._sharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._frontPlate.material=this._frontMaterial,this._textPlate.material=this._plateMaterial,this._rebuildContent()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeTooltip(),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))},t}(Q),ne=function(e){function t(t,n){var i=e.call(this,n)||this;return i._currentMesh=t,i.pointerEnterAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1.1)},i.pointerOutAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1/1.1)},i.pointerDownAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(.95)},i.pointerUpAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1/.95)},i}return r(t,e),t.prototype._getTypeName=function(){return"MeshButton3D"},t.prototype._createNode=function(e){var t=this;return this._currentMesh.getChildMeshes().forEach(function(e){e.metadata=t}),this._currentMesh},t.prototype._affectMaterial=function(e){},t}(Q),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._mapGridNode=function(e,t){var n=e.mesh;if(n){e.position=t.clone();var i=s.Tmp.Vector3[0];switch(i.copyFrom(t),this.orientation){case q.FACEORIGIN_ORIENTATION:case q.FACEFORWARD_ORIENTATION:i.addInPlace(new s.Vector3(0,0,1)),n.lookAt(i);break;case q.FACEFORWARDREVERSED_ORIENTATION:case q.FACEORIGINREVERSED_ORIENTATION:i.addInPlace(new s.Vector3(0,0,-1)),n.lookAt(i)}}},t}(Z),re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._iteration=100,t}return r(t,e),Object.defineProperty(t.prototype,"iteration",{get:function(){return this._iteration},set:function(e){var t=this;this._iteration!==e&&(this._iteration=e,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),t.prototype._mapGridNode=function(e,t){var n=e.mesh,i=this._scatterMapping(t);if(n){switch(this.orientation){case q.FACEORIGIN_ORIENTATION:case q.FACEFORWARD_ORIENTATION:n.lookAt(new s.Vector3(0,0,1));break;case q.FACEFORWARDREVERSED_ORIENTATION:case q.FACEORIGINREVERSED_ORIENTATION:n.lookAt(new s.Vector3(0,0,-1))}e.position=i}},t.prototype._scatterMapping=function(e){return e.x=(1-2*Math.random())*this._cellWidth,e.y=(1-2*Math.random())*this._cellHeight,e},t.prototype._finalProcessing=function(){for(var e=[],t=0,n=this._children;t<n.length;t++){var i=n[t];i.mesh&&e.push(i.mesh)}for(var r=0;r<this._iteration;r++){e.sort(function(e,t){var n=e.position.lengthSquared(),i=t.position.lengthSquared();return n<i?1:n>i?-1:0});for(var o=Math.pow(this.margin,2),a=Math.max(this._cellWidth,this._cellHeight),l=s.Tmp.Vector2[0],c=s.Tmp.Vector3[0],u=0;u<e.length-1;u++)for(var h=u+1;h<e.length;h++)if(u!=h){e[h].position.subtractToRef(e[u].position,c),l.x=c.x,l.y=c.y;var d=a,f=l.lengthSquared()-o;(f-=Math.min(f,o))<Math.pow(d,2)&&(l.normalize(),c.scaleInPlace(.5*(d-Math.sqrt(f))),e[h].position.addInPlace(c),e[u].position.subtractInPlace(c))}}},t}(Z),oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._radius=5,t}return r(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){var t=this;this._radius!==e&&(this._radius=e,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),t.prototype._mapGridNode=function(e,t){var n=e.mesh;if(n){var i=this._sphericalMapping(t);switch(e.position=i,this.orientation){case q.FACEORIGIN_ORIENTATION:n.lookAt(new s.Vector3(2*i.x,2*i.y,2*i.z));break;case q.FACEORIGINREVERSED_ORIENTATION:n.lookAt(new s.Vector3(-i.x,-i.y,-i.z));break;case q.FACEFORWARD_ORIENTATION:break;case q.FACEFORWARDREVERSED_ORIENTATION:n.rotate(s.Axis.Y,Math.PI,s.Space.LOCAL)}}},t.prototype._sphericalMapping=function(e){var t=new s.Vector3(0,0,this._radius);return s.Matrix.RotationYawPitchRollToRef(-e.x/this._radius,e.y/this._radius,0,s.Tmp.Matrix[0]),s.Vector3.TransformNormal(t,s.Tmp.Matrix[0])},t}(Z),ae=function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this)||this;return n._isVertical=!1,n.margin=.1,n._isVertical=t,n}return r(t,e),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){var t=this;this._isVertical!==e&&(this._isVertical=e,s.Tools.SetImmediate(function(){t._arrangeChildren()}))},enumerable:!0,configurable:!0}),t.prototype._arrangeChildren=function(){for(var e,t=0,n=0,i=0,r=[],o=s.Matrix.Invert(this.node.computeWorldMatrix(!0)),a=0,l=this._children;a<l.length;a++)if((p=l[a]).mesh){i++,p.mesh.computeWorldMatrix(!0),p.mesh.getWorldMatrix().multiplyToRef(o,s.Tmp.Matrix[0]);var c=p.mesh.getBoundingInfo().boundingBox,u=s.Vector3.TransformNormal(c.extendSize,s.Tmp.Matrix[0]);r.push(u),this._isVertical?n+=u.y:t+=u.x}this._isVertical?n+=(i-1)*this.margin/2:t+=(i-1)*this.margin/2,e=this._isVertical?-n:-t;for(var h=0,d=0,f=this._children;d<f.length;d++){var p;(p=f[d]).mesh&&(i--,u=r[h++],this._isVertical?(p.position.y=e+u.y,p.position.x=0,e+=2*u.y):(p.position.x=e+u.x,p.position.y=0,e+=2*u.x),e+=i>0?this.margin:0)}},t}(q),se=function(){function e(e){var t=this;this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new s.Observable,this._sharedMaterials={},this._scene=e||s.EngineStore.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){t._sceneDisposeObserver=null,t._utilityLayer=null,t.dispose()}),this._utilityLayer=new s.UtilityLayerRenderer(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=function(e){return e&&e.metadata&&e.metadata._node},this._rootContainer=new q("RootContainer"),this._rootContainer._host=this;var n=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add(function(e){t._handlePointerOut(e,!0)}),this._pointerObserver=n.onPointerObservable.add(function(e,n){t._doPicking(e)}),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new s.HemisphericLight("hemi",s.Vector3.Up(),this._utilityLayer.utilityLayerScene)}return Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!0,configurable:!0}),e.prototype._handlePointerOut=function(e,t){var n=this._lastControlOver[e];n&&(n._onPointerOut(n),delete this._lastControlOver[e]),t&&this._lastControlDown[e]&&(this._lastControlDown[e].forcePointerUp(),delete this._lastControlDown[e]),this.onPickedPointChangedObservable.notifyObservers(null)},e.prototype._doPicking=function(e){if(!this._utilityLayer||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;var t=e.event,n=t.pointerId||0,i=t.button,r=e.pickInfo;if(!r||!r.hit)return this._handlePointerOut(n,e.type===s.PointerEventTypes.POINTERUP),!1;var o=r.pickedMesh.metadata;return r.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(r.pickedPoint),o._processObservables(e.type,r.pickedPoint,n,i)||e.type===s.PointerEventTypes.POINTERMOVE&&(this._lastControlOver[n]&&this._lastControlOver[n]._onPointerOut(this._lastControlOver[n]),delete this._lastControlOver[n]),e.type===s.PointerEventTypes.POINTERUP&&(this._lastControlDown[t.pointerId]&&(this._lastControlDown[t.pointerId].forcePointerUp(),delete this._lastControlDown[t.pointerId]),"touch"===t.pointerType&&this._handlePointerOut(n,!1)),!0},Object.defineProperty(e.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),e.prototype.containsControl=function(e){return this._rootContainer.containsControl(e)},e.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},e.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},e.prototype.dispose=function(){for(var e in this._rootContainer.dispose(),this._sharedMaterials)this._sharedMaterials.hasOwnProperty(e)&&this._sharedMaterials[e].dispose();this._sharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear();var t=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;t&&this._pointerObserver&&(t.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()},e}();n.d(t,"AdvancedDynamicTexture",function(){return H}),n.d(t,"AdvancedDynamicTextureInstrumentation",function(){return W}),n.d(t,"Vector2WithInfo",function(){return u}),n.d(t,"Matrix2D",function(){return h}),n.d(t,"Measure",function(){return c}),n.d(t,"MultiLinePoint",function(){return A}),n.d(t,"Style",function(){return j}),n.d(t,"ValueAndUnit",function(){return l}),n.d(t,"Button",function(){return _}),n.d(t,"Checkbox",function(){return b}),n.d(t,"ColorPicker",function(){return E}),n.d(t,"Container",function(){return f}),n.d(t,"Control",function(){return d}),n.d(t,"Ellipse",function(){return x}),n.d(t,"Grid",function(){return T}),n.d(t,"Image",function(){return m}),n.d(t,"InputText",function(){return y}),n.d(t,"InputPassword",function(){return C}),n.d(t,"Line",function(){return S}),n.d(t,"MultiLine",function(){return P}),n.d(t,"RadioButton",function(){return R}),n.d(t,"StackPanel",function(){return v}),n.d(t,"SelectorGroup",function(){return w}),n.d(t,"CheckboxGroup",function(){return I}),n.d(t,"RadioGroup",function(){return D}),n.d(t,"SliderGroup",function(){return L}),n.d(t,"SelectionPanel",function(){return k}),n.d(t,"ScrollViewer",function(){return B}),n.d(t,"TextWrapping",function(){return a}),n.d(t,"TextBlock",function(){return g}),n.d(t,"KeyPropertySet",function(){return U}),n.d(t,"VirtualKeyboard",function(){return V}),n.d(t,"Rectangle",function(){return p}),n.d(t,"DisplayGrid",function(){return G}),n.d(t,"BaseSlider",function(){return M}),n.d(t,"Slider",function(){return O}),n.d(t,"ImageBasedSlider",function(){return z}),n.d(t,"ScrollBar",function(){return F}),n.d(t,"name",function(){return"Statics"}),n.d(t,"GUI3DManager",function(){return se}),n.d(t,"Vector3WithInfo",function(){return X}),n.d(t,"AbstractButton3D",function(){return K}),n.d(t,"Button3D",function(){return Q}),n.d(t,"Container3D",function(){return q}),n.d(t,"Control3D",function(){return Y}),n.d(t,"CylinderPanel",function(){return J}),n.d(t,"HolographicButton",function(){return te}),n.d(t,"MeshButton3D",function(){return ne}),n.d(t,"PlanePanel",function(){return ie}),n.d(t,"ScatterPanel",function(){return re}),n.d(t,"SpherePanel",function(){return oe}),n.d(t,"StackPanel3D",function(){return ae}),n.d(t,"VolumeBasedPanel",function(){return Z}),n.d(t,"FluentMaterialDefines",function(){return $}),n.d(t,"FluentMaterial",function(){return ee})},function(e,t,n){"use strict";n.r(t),(function(e){var i=n(1);n.d(t,"AdvancedDynamicTexture",function(){return i.AdvancedDynamicTexture}),n.d(t,"AdvancedDynamicTextureInstrumentation",function(){return i.AdvancedDynamicTextureInstrumentation}),n.d(t,"Vector2WithInfo",function(){return i.Vector2WithInfo}),n.d(t,"Matrix2D",function(){return i.Matrix2D}),n.d(t,"Measure",function(){return i.Measure}),n.d(t,"MultiLinePoint",function(){return i.MultiLinePoint}),n.d(t,"Style",function(){return i.Style}),n.d(t,"ValueAndUnit",function(){return i.ValueAndUnit}),n.d(t,"GUI3DManager",function(){return i.GUI3DManager}),n.d(t,"Vector3WithInfo",function(){return i.Vector3WithInfo}),n.d(t,"Button",function(){return i.Button}),n.d(t,"Checkbox",function(){return i.Checkbox}),n.d(t,"ColorPicker",function(){return i.ColorPicker}),n.d(t,"Container",function(){return i.Container}),n.d(t,"Control",function(){return i.Control}),n.d(t,"Ellipse",function(){return i.Ellipse}),n.d(t,"Grid",function(){return i.Grid}),n.d(t,"Image",function(){return i.Image}),n.d(t,"InputText",function(){return i.InputText}),n.d(t,"InputPassword",function(){return i.InputPassword}),n.d(t,"Line",function(){return i.Line}),n.d(t,"MultiLine",function(){return i.MultiLine}),n.d(t,"RadioButton",function(){return i.RadioButton}),n.d(t,"StackPanel",function(){return i.StackPanel}),n.d(t,"SelectorGroup",function(){return i.SelectorGroup}),n.d(t,"CheckboxGroup",function(){return i.CheckboxGroup}),n.d(t,"RadioGroup",function(){return i.RadioGroup}),n.d(t,"SliderGroup",function(){return i.SliderGroup}),n.d(t,"SelectionPanel",function(){return i.SelectionPanel}),n.d(t,"ScrollViewer",function(){return i.ScrollViewer}),n.d(t,"TextWrapping",function(){return i.TextWrapping}),n.d(t,"TextBlock",function(){return i.TextBlock}),n.d(t,"KeyPropertySet",function(){return i.KeyPropertySet}),n.d(t,"VirtualKeyboard",function(){return i.VirtualKeyboard}),n.d(t,"Rectangle",function(){return i.Rectangle}),n.d(t,"DisplayGrid",function(){return i.DisplayGrid}),n.d(t,"BaseSlider",function(){return i.BaseSlider}),n.d(t,"Slider",function(){return i.Slider}),n.d(t,"ImageBasedSlider",function(){return i.ImageBasedSlider}),n.d(t,"ScrollBar",function(){return i.ScrollBar}),n.d(t,"name",function(){return i.name}),n.d(t,"AbstractButton3D",function(){return i.AbstractButton3D}),n.d(t,"Button3D",function(){return i.Button3D}),n.d(t,"Container3D",function(){return i.Container3D}),n.d(t,"Control3D",function(){return i.Control3D}),n.d(t,"CylinderPanel",function(){return i.CylinderPanel}),n.d(t,"HolographicButton",function(){return i.HolographicButton}),n.d(t,"MeshButton3D",function(){return i.MeshButton3D}),n.d(t,"PlanePanel",function(){return i.PlanePanel}),n.d(t,"ScatterPanel",function(){return i.ScatterPanel}),n.d(t,"SpherePanel",function(){return i.SpherePanel}),n.d(t,"StackPanel3D",function(){return i.StackPanel3D}),n.d(t,"VolumeBasedPanel",function(){return i.VolumeBasedPanel}),n.d(t,"FluentMaterialDefines",function(){return i.FluentMaterialDefines}),n.d(t,"FluentMaterial",function(){return i.FluentMaterial});var r=void 0!==e?e:"undefined"!=typeof window?window:void 0;void 0!==r&&(r.BABYLON=r.BABYLON||{},r.BABYLON.GUI=i)}).call(this,n(3))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}]))},"f+Ey":function(e,t){e.exports={toUnsigned:function(e){return e>>>0}}},"fhC+":function(e,t){var n,i=[33,16,5,32,164,27],r=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],o=function(e){for(var t=[];e--;)t.push(0);return t},a={96000:[i,[227,64],o(154),[56]],88200:[i,[231],o(170),[56]],64000:[i,[248,192],o(240),[56]],48000:[i,[255,192],o(268),[55,148,128],o(54),[112]],44100:[i,[255,192],o(268),[55,163,128],o(84),[112]],32000:[i,[255,192],o(268),[55,234],o(226),[112]],24000:[i,[255,192],o(268),[55,255,128],o(268),[111,112],o(126),[224]],16000:[i,[255,192],o(268),[55,255,128],o(268),[111,255],o(269),[223,108],o(195),[1,192]],12000:[r,o(268),[3,127,248],o(268),[6,255,240],o(268),[13,255,224],o(268),[27,253,128],o(259),[56]],11025:[r,o(268),[3,127,248],o(268),[6,255,240],o(268),[13,255,224],o(268),[27,255,192],o(268),[55,175,128],o(108),[112]],8000:[r,o(268),[3,121,16],o(47),[7]]};e.exports=(n=a,Object.keys(n).reduce(function(e,t){return e[t]=new Uint8Array(n[t].reduce(function(e,t){return e.concat(t)},[])),e},{}))},g2LC:function(e,t){e.exports=function(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var n=Object.prototype.toString},jBAH:function(e,t){e.exports=function(e,t){var n,i=null;try{n=JSON.parse(e,t)}catch(r){i=r}return[i,n]}},mvqA:function(e,t,n){"use strict";var i,r,o=n("KAYj").parseType,a=function(e){return new Date(1e3*e-20828448e5)},s=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},l=function(e){var t,n,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[];for(t=0;t+4<e.length;t+=n)if(n=i.getUint32(t),t+=4,n<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[t]&31)}return r},c={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:i(e.subarray(78,e.byteLength))}},avcC:function(e){var t,n,i,r,o=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},s=31&e[5];for(i=6,r=0;r<s;r++)n=o.getUint16(i),i+=2,a.sps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;for(t=e[i],i++,r=0;r<t;r++)n=o.getUint16(i),i+=2,a.pps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={majorBrand:o(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;i<e.byteLength;)n.compatibleBrands.push(o(e.subarray(i,i+4))),i+=4;return n},dinf:function(e){return{boxes:i(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:i(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:o(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(0===e[n]){n++;break}t.name+=String.fromCharCode(e[n])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:l(e)}},mdhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===r.version?(r.creationTime=a(n.getUint32(i+=4)),r.modificationTime=a(n.getUint32(i+=8)),r.timescale=n.getUint32(i+=4),r.duration=n.getUint32(i+=8)):(r.creationTime=a(n.getUint32(i)),r.modificationTime=a(n.getUint32(i+=4)),r.timescale=n.getUint32(i+=4),r.duration=n.getUint32(i+=4)),t=n.getUint16(i+=4),r.language+=String.fromCharCode(96+(t>>10)),r.language+=String.fromCharCode(96+((992&t)>>5)),r.language+=String.fromCharCode(96+(31&t)),r},mdia:function(e){return{boxes:i(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:i(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(n.streamDescriptor=i(e.subarray(28))[0]),n},moof:function(e){return{boxes:i(e)}},moov:function(e){return{boxes:i(e)}},mvex:function(e){return{boxes:i(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(i.creationTime=a(t.getUint32(n+=4)),i.modificationTime=a(t.getUint32(n+=8)),i.timescale=t.getUint32(n+=4),i.duration=t.getUint32(n+=8)):(i.creationTime=a(t.getUint32(n)),i.modificationTime=a(t.getUint32(n+=4)),i.timescale=t.getUint32(n+=4),i.duration=t.getUint32(n+=4)),i.rate=t.getUint16(n+=4)+t.getUint16(n+2)/16,i.volume=t.getUint8(n+=4)+t.getUint8(n+1)/8,n+=2,n+=2,n+=8,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,i.nextTrackId=t.getUint32(n+=24),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)n.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return n},sidx:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:n.getUint32(4),timescale:n.getUint32(8),earliestPresentationTime:n.getUint32(12),firstOffset:n.getUint32(16)},r=n.getUint16(22);for(t=24;r;t+=12,r--)i.references.push({referenceType:(128&e[t])>>>7,referencedSize:2147483647&n.getUint32(t),subsegmentDuration:n.getUint32(t+4),startsWithSap:!!(128&e[t+8]),sapType:(112&e[t+8])>>>4,sapDeltaTime:268435455&n.getUint32(t+8)});return i},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:i(e)}},stco:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.chunkOffsets.push(n.getUint32(t));return i},stsc:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=n.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;i;t+=12,i--)r.sampleToChunks.push({firstChunk:n.getUint32(t),samplesPerChunk:n.getUint32(t+4),sampleDescriptionIndex:n.getUint32(t+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:i(e.subarray(8))}},stsz:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:n.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)i.entries.push(n.getUint32(t));return i},stts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.timeToSamples.push({sampleCount:n.getUint32(t),sampleDelta:n.getUint32(t+4)});return i},styp:function(e){return c.ftyp(e)},tfdt:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:e[4]<<24|e[5]<<16|e[6]<<8|e[7]};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),t},tfhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},r=1&i.flags[2],o=2&i.flags[2],a=8&i.flags[2],s=16&i.flags[2],l=32&i.flags[2],c=65536&i.flags[0],u=131072&i.flags[0];return t=8,r&&(t+=4,i.baseDataOffset=n.getUint32(12),t+=4),o&&(i.sampleDescriptionIndex=n.getUint32(t),t+=4),a&&(i.defaultSampleDuration=n.getUint32(t),t+=4),s&&(i.defaultSampleSize=n.getUint32(t),t+=4),l&&(i.defaultSampleFlags=n.getUint32(t)),c&&(i.durationIsEmpty=!0),!r&&u&&(i.baseDataOffsetIsMoof=!0),i},tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(i.creationTime=a(t.getUint32(n+=4)),i.modificationTime=a(t.getUint32(n+=8)),i.trackId=t.getUint32(n+=4),n+=4,i.duration=t.getUint32(n+=8)):(i.creationTime=a(t.getUint32(n)),i.modificationTime=a(t.getUint32(n+=4)),i.trackId=t.getUint32(n+=4),n+=4,i.duration=t.getUint32(n+=4)),n+=4,i.layer=t.getUint16(n+=8),i.alternateGroup=t.getUint16(n+=2),i.volume=t.getUint8(n+=2)+t.getUint8(n+1)/8,n+=2,n+=2,i.matrix=new Uint32Array(e.subarray(n,n+36)),i.width=t.getUint16(n+=36)+t.getUint16(n+2)/16,i.height=t.getUint16(n+=4)+t.getUint16(n+2)/16,i},traf:function(e){return{boxes:i(e)}},trak:function(e){return{boxes:i(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&n.flags[2],o=4&n.flags[2],a=1&n.flags[1],l=2&n.flags[1],c=4&n.flags[1],u=8&n.flags[1],h=i.getUint32(4),d=8;for(r&&(n.dataOffset=i.getInt32(d),d+=4),o&&h&&(t={flags:s(e.subarray(d,d+4))},d+=4,a&&(t.duration=i.getUint32(d),d+=4),l&&(t.size=i.getUint32(d),d+=4),u&&(t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t),h--);h--;)t={},a&&(t.duration=i.getUint32(d),d+=4),l&&(t.size=i.getUint32(d),d+=4),c&&(t.flags=s(e.subarray(d,d+4)),d+=4),u&&(t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t);return n},"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};e.exports={inspect:i=function(e){for(var t,n,i,r,a,s=0,l=[],u=new ArrayBuffer(e.length),h=new Uint8Array(u),d=0;d<e.length;++d)h[d]=e[d];for(t=new DataView(u);s<e.byteLength;)n=t.getUint32(s),i=o(e.subarray(s+4,s+8)),(a=(c[i]||function(e){return{data:e}})(e.subarray(s+8,r=n>1?s+n:e.byteLength))).size=n,a.type=i,l.push(a),s=r;return l},textify:r=function(e,t){var n;return t=t||0,n=new Array(2*t+1).join(" "),e.map(function(e,i){return n+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=n+"  "+t+": ",r=e[t];if(r instanceof Uint8Array||r instanceof Uint32Array){var o=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return o?1===o.length?i+"<"+o.join("").slice(1)+">":i+"<\n"+o.map(function(e){return n+"  "+e}).join("\n")+"\n"+n+"  >":i+"<>"}return i+JSON.stringify(r,null,2).split("\n").map(function(e,t){return 0===t?e:n+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+r(e.boxes,t+1):"")}).join("\n")},parseTfdt:c.tfdt,parseHdlr:c.hdlr,parseTfhd:c.tfhd,parseTrun:c.trun,parseSidx:c.sidx}},nVYC:function(e,t,n){"use strict";var i,r=n("QykG"),o=n("+9CB");(i=function(){var e=new Uint8Array,t=0;i.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var i,r,a,s=0,l=0;for(e.length?(a=e.length,(e=new Uint8Array(n.byteLength+a)).set(e.subarray(0,a)),e.set(n,a)):e=n;e.length-l>=3;)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!=(255&e[l])||240!=(240&e[l+1]))l++;else{if(e.length-l<7)break;if(l+(s=o.parseAdtsSize(e,l))>e.length)break;r={type:"audio",data:e.subarray(l,l+s),pts:t,dts:t},this.trigger("data",r),l+=s}else{if(e.length-l<10)break;if(l+(s=o.parseId3TagSize(e,l))>e.length)break;i={type:"timed-metadata",data:e.subarray(l,l+s)},this.trigger("data",i),l+=s}e=e.length-l>0?e.subarray(l):new Uint8Array}}).prototype=new r,e.exports=i},oNNP:function(e,t,n){"use strict";var i=n("D3zA");e.exports=i.call(Function.call,Object.prototype.hasOwnProperty)},qOD0:function(e,t,n){"use strict";var i=n("3G1x").discardEmulationPreventionBytes,r=n("Tmm6").CaptionStream,o=n("KAYj"),a=n("mvqA"),s=function(e,t){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(n<r.size)return r;n-=r.size}return null},l=function(e,t){var n=o.findBox(e,["moof","traf"]),r=o.findBox(e,["mdat"]),l={},c=[];return r.forEach(function(e,t){c.push({mdat:e,traf:n[t]})}),c.forEach(function(e){var n,r=e.mdat,c=e.traf,u=o.findBox(c,["tfhd"]),h=a.parseTfhd(u[0]),d=h.trackId,f=o.findBox(c,["tfdt"]),p=f.length>0?a.parseTfdt(f[0]).baseMediaDecodeTime:0,g=o.findBox(c,["trun"]);t===d&&g.length>0&&(n=function(e,t,n){var r,o,a,l,c=new DataView(e.buffer,e.byteOffset,e.byteLength),u=[];for(o=0;o+4<e.length;o+=a)if(a=c.getUint32(o),o+=4,!(a<=0))switch(31&e[o]){case 6:var h=e.subarray(o+1,o+1+a),d=s(o,t);r={nalUnitType:"sei_rbsp",size:a,data:h,escapedRBSP:i(h),trackId:n},d?(r.pts=d.pts,r.dts=d.dts,l=d):(r.pts=l.pts,r.dts=l.dts),u.push(r)}return u}(r,function(e,t,n){var i=t,r=h.defaultSampleDuration||0,o=h.defaultSampleSize||0,s=h.trackId,l=[];return e.forEach(function(e){var t=a.parseTrun(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=o),e.trackId=s,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=i+e.compositionTimeOffset,i+=e.duration}),l=l.concat(t)}),l}(g,p),d),l[d]||(l[d]=[]),l[d]=l[d].concat(n))}),l};e.exports=function(){var e,t,n,i,o,a=!1;this.isInitialized=function(){return a},this.init=function(){e=new r,a=!0,e.on("data",function(e){e.startTime=e.startPts/i,e.endTime=e.endPts/i,o.captions.push(e),o.captionStreams[e.stream]=!0})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length||n===e[0]&&i===t[n])},this.parse=function(e,r,a){var s;if(!this.isInitialized())return null;if(!r||!a)return null;if(this.isNewInit(r,a))i=a[n=r[0]];else if(!n||!i)return t.push(e),null;for(;t.length>0;){var c=t.shift();this.parse(c,r,a)}return null!==(s=function(e,t,n){return t?{seiNals:l(e,t)[t],timescale:n}:null}(e,n,i))&&s.seiNals?(this.pushNals(s.seiNals),this.flushStream(),o):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;e.flush()},this.clearParsedCaptions=function(){o.captions=[],o.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,i=null,o?this.clearParsedCaptions():o={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}},rnXk:function(e,t,n){"use strict";e.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},"s/21":function(e,t,n){"use strict";var i=n("82c2"),r=n("G3+v");e.exports=function(){var e=r();return i(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},sDzi:function(e,t){var n="auto",i={"":1,lr:1,rl:1},r={start:1,middle:1,end:1,left:1,right:1};function o(e){return"string"==typeof e&&!!r[e.toLowerCase()]&&e.toLowerCase()}function a(e,t,r){this.hasBeenReset=!1;var a="",s=!1,l=e,c=t,u=r,h=null,d="",f=!0,p="auto",g="start",m=50,_="middle",v=50,b="middle";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return a},set:function(e){a=""+e}},pauseOnExit:{enumerable:!0,get:function(){return s},set:function(e){s=!!e}},startTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");c=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return u},set:function(e){u=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return h},set:function(e){h=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return d},set:function(e){var t=function(e){return"string"==typeof e&&!!i[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");d=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return f},set:function(e){f=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!=typeof e&&e!==n)throw new SyntaxError("An invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return g},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}},position:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");m=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return _},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}},size:{enumerable:!0,get:function(){return v},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");v=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return b},set:function(e){var t=o(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}}}),this.displayState=void 0}a.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.exports=a},sYn3:function(e,t,n){"use strict";var i;if(!Object.keys){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,a=n("1KsK"),s=Object.prototype.propertyIsEnumerable,l=!s.call({toString:null},"toString"),c=s.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&r.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(t){return!0}}catch(t){return!0}return!1}();i=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===o.call(e),i=a(e),s=t&&"[object String]"===o.call(e),d=[];if(!t&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var p=c&&n;if(s&&e.length>0&&!r.call(e,0))for(var g=0;g<e.length;++g)d.push(String(g));if(i&&e.length>0)for(var m=0;m<e.length;++m)d.push(String(m));else for(var _ in e)p&&"prototype"===_||!r.call(e,_)||d.push(String(_));if(l)for(var v=function(e){if("undefined"==typeof window||!f)return h(e);try{return h(e)}catch(t){return!1}}(e),b=0;b<u.length;++b)v&&"constructor"===u[b]||!r.call(e,u[b])||d.push(u[b]);return d}}e.exports=i},u1Mj:function(e,t){e.exports=function(e,t){var n=e%t;return Math.floor(n>=0?n:n+t)}},vgmO:function(e,t){var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e.exports=n},xG2L:function(e,t,n){"use strict";var i=n("6ayh"),r=i("%TypeError%"),o=i("%SyntaxError%"),a=n("oNNP"),s={"Property Descriptor":function(e,t){if("Object"!==e.Type(t))return!1;var n={"[[Configurable]]":!0,"[[Enumerable]]":!0,"[[Get]]":!0,"[[Set]]":!0,"[[Value]]":!0,"[[Writable]]":!0};for(var i in t)if(a(t,i)&&!n[i])return!1;var o=a(t,"[[Value]]"),s=a(t,"[[Get]]")||a(t,"[[Set]]");if(o&&s)throw new r("Property Descriptors may not be both accessor and data descriptors");return!0}};e.exports=function(e,t,n,i){var a=s[t];if("function"!=typeof a)throw new o("unknown record type: "+t);if(!a(e,i))throw new r(n+" must be a "+t);console.log(a(e,i),i)}},xhJ2:function(e,t){var n=Number.isNaN||function(e){return e!=e};e.exports=Number.isFinite||function(e){return"number"==typeof e&&!n(e)&&e!==1/0&&e!==-1/0}},yp9T:function(e,t,n){"use strict";var i=n("D3zA"),r=n("82c2"),o=n("Vi6U"),a=n("G3+v"),s=n("s/21"),l=i.call(Function.call,a());r(l,{getPolyfill:a,implementation:o,shim:s}),e.exports=l},zUnb:function(e,t,n){"use strict";n.r(t);var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}var h=Array.isArray||function(e){return e&&"number"==typeof e.length};function d(e){return null!==e&&"object"==typeof e}function f(e){return"function"==typeof e}function p(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}p.prototype=Object.create(Error.prototype);var g=p,m=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,i=this._parents,r=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var a=-1,s=i?i.length:0;n;)n.remove(this),n=++a<s&&i[a]||null;if(f(r))try{r.call(this)}catch(c){t=!0,e=c instanceof g?_(c.errors):[c]}if(h(o))for(a=-1,s=o.length;++a<s;){var l=o[a];if(d(l))try{l.unsubscribe()}catch(c){t=!0,e=e||[],c instanceof g?e=e.concat(_(c.errors)):e.push(c)}}if(t)throw new g(e)}},e.prototype.add=function(t){var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var i=n;(n=new e)._subscriptions=[i]}break;default:if(!t)return e.EMPTY;throw new Error("unrecognized teardown "+t+" added to Subscription.")}if(n._addParent(this)){var r=this._subscriptions;r?r.push(n):this._subscriptions=[n]}return n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;return t!==e&&(t?n?-1===n.indexOf(e)&&(n.push(e),!0):(this._parents=[e],!0):(this._parent=e,!0))},e.EMPTY=((t=new e).closed=!0,t),e}();function _(e){return e.reduce(function(e,t){return e.concat(t instanceof g?t.errors:t)},[])}var v=!1,b={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){v=e},get useDeprecatedSynchronousErrorHandling(){return v}};function y(e){setTimeout(function(){throw e})}var T={closed:!0,next:function(e){},error:function(e){if(b.useDeprecatedSynchronousErrorHandling)throw e;y(e)},complete:function(){}},E="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),x=function(e){function t(n,i,r){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=T;break;case 1:if(!n){o.destination=T;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new C(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new C(o,n,i,r)}return o}return r(t,e),t.prototype[E]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(m),C=function(e){function t(t,n,i,r){var o,a=e.call(this)||this;a._parentSubscriber=t;var s=a;return f(n)?o=n:n&&(o=n.next,i=n.error,r=n.complete,n!==T&&(f((s=Object.create(n)).unsubscribe)&&a.add(s.unsubscribe.bind(s)),s.unsubscribe=a.unsubscribe.bind(a))),a._context=s,a._next=o,a._error=i,a._complete=r,a}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;b.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=b.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):y(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;y(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};b.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),b.useDeprecatedSynchronousErrorHandling)throw n;y(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!b.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(i){return b.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=i,e.syncErrorThrown=!0,!0):(y(i),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(x),S="function"==typeof Symbol&&Symbol.observable||"@@observable";function A(){}function P(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return R(e)}function R(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:A}var M=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,r=function(e,t,n){if(e){if(e instanceof x)return e;if(e[E])return e[E]()}return e||t||n?new x(e,t,n):new x(T)}(e,t,n);if(r.add(i?i.call(r,this.source):this.source||b.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),b.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){b.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e.destination;if(e.closed||e.isStopped)return!1;e=t&&t instanceof x?t:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=O(t))(function(t,i){var r;r=n.subscribe(function(t){try{e(t)}catch(n){i(n),r&&r.unsubscribe()}},i,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[S]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:R(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=O(e))(function(e,n){var i;t.subscribe(function(e){return i=e},function(e){return n(e)},function(){return e(i)})})},e.create=function(t){return new e(t)},e}();function O(e){if(e||(e=b.Promise||Promise),!e)throw new Error("no Promise impl found");return e}function w(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}w.prototype=Object.create(Error.prototype);var I=w,D=function(e){function t(t,n){var i=e.call(this)||this;return i.subject=t,i.subscriber=n,i.closed=!1,i}return r(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(m),L=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r(t,e),t}(x),k=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r(t,e),t.prototype[E]=function(){return new L(this)},t.prototype.lift=function(e){var t=new N(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new I;if(!this.isStopped)for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new I;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new I;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),i=0;i<t;i++)n[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new I;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new I;return this.hasError?(e.error(this.thrownError),m.EMPTY):this.isStopped?(e.complete(),m.EMPTY):(this.observers.push(e),new D(this,e))},t.prototype.asObservable=function(){var e=new M;return e.source=this,e},t.create=function(e,t){return new N(e,t)},t}(M),N=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return r(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):m.EMPTY},t}(k);function F(e){return e&&"function"==typeof e.schedule}var B=function(e){function t(t,n,i){var r=e.call(this)||this;return r.parent=t,r.outerValue=n,r.outerIndex=i,r.index=0,r}return r(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(x),U=function(e){return function(t){for(var n=0,i=e.length;n<i&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}},V=function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,y),t}};function G(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var z=G(),j=function(e){return function(t){for(var n=e[z]();;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}},H=function(e){return function(t){var n=e[S]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},W=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function X(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var Y=function(e){if(e instanceof M)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[S])return H(e);if(W(e))return U(e);if(X(e))return V(e);if(e&&"function"==typeof e[z])return j(e);var t=d(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function K(e,t,n,i,r){if(void 0===r&&(r=new B(e,n,i)),!r.closed)return Y(t)(r)}var Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(x);function q(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Z(e,t))}}var Z=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new J(e,this.project,this.thisArg))},e}(),J=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return r(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(x);function $(e,t){return new M(t?function(n){var i=new m,r=0;return i.add(t.schedule(function(){r!==e.length?(n.next(e[r++]),n.closed||i.add(this.schedule())):n.complete()})),i}:U(e))}function ee(e,t){if(!t)return e instanceof M?e:new M(Y(e));if(null!=e){if(function(e){return e&&"function"==typeof e[S]}(e))return function(e,t){return new M(t?function(n){var i=new m;return i.add(t.schedule(function(){var r=e[S]();i.add(r.subscribe({next:function(e){i.add(t.schedule(function(){return n.next(e)}))},error:function(e){i.add(t.schedule(function(){return n.error(e)}))},complete:function(){i.add(t.schedule(function(){return n.complete()}))}}))})),i}:H(e))}(e,t);if(X(e))return function(e,t){return new M(t?function(n){var i=new m;return i.add(t.schedule(function(){return e.then(function(e){i.add(t.schedule(function(){n.next(e),i.add(t.schedule(function(){return n.complete()}))}))},function(e){i.add(t.schedule(function(){return n.error(e)}))})})),i}:V(e))}(e,t);if(W(e))return $(e,t);if(function(e){return e&&"function"==typeof e[z]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new M(t?function(n){var i,r=new m;return r.add(function(){i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(function(){i=e[z](),r.add(t.schedule(function(){if(!n.closed){var e,t;try{var r=i.next();e=r.value,t=r.done}catch(o){return void n.error(o)}t?n.complete():(n.next(e),this.schedule())}}))})),r}:j(e))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function te(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(i){return i.pipe(te(function(n,i){return ee(e(n,i)).pipe(q(function(e,r){return t(n,e,i,r)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new ne(e,n))})}var ne=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new ie(e,this.project,this.concurrent))},e}(),ie=function(e){function t(t,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var r=e.call(this,t)||this;return r.project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return r(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var i=new B(this,void 0,void 0);this.destination.add(i),K(this,e,t,n,i)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(Q);function re(e){return e}function oe(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),te(re,e)}function ae(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,i=null,r=e[e.length-1];return F(r)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof r&&(n=e.pop()),null===i&&1===e.length&&e[0]instanceof M?e[0]:oe(n)($(e,i))}function se(){return function(e){return e.lift(new le(e))}}var le=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var i=new ce(e,n),r=t.subscribe(i);return i.closed||(i.connection=n.connect()),r},e}(),ce=function(e){function t(t,n){var i=e.call(this,t)||this;return i.connectable=n,i}return r(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,i=e._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null},t}(x),ue=function(e){function t(t,n){var i=e.call(this)||this;return i.source=t,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return r(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new m).add(this.source.subscribe(new de(this.getSubject(),this))),e.closed?(this._connection=null,e=m.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return se()(this)},t}(M).prototype,he={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:ue._subscribe},_isComplete:{value:ue._isComplete,writable:!0},getSubject:{value:ue.getSubject},connect:{value:ue.connect},refCount:{value:ue.refCount}},de=function(e){function t(t,n){var i=e.call(this,t)||this;return i.connectable=n,i}return r(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(L);function fe(){return new k}var pe="__parameters__",ge="__prop__metadata__";function me(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e){var i=e.apply(void 0,u(t));for(var r in i)this[r]=i[r]}}}function _e(e,t,n){var i=me(t);function r(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this instanceof r)return i.apply(this,t),this;var o=new((e=r).bind.apply(e,u([void 0],t)));return a.annotation=o,a;function a(e,t,n){for(var i=e.hasOwnProperty(pe)?e[pe]:Object.defineProperty(e,pe,{value:[]})[pe];i.length<=n;)i.push(null);return(i[n]=i[n]||[]).push(o),e}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r}function ve(e,t,n,i){var r=me(t);function o(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this instanceof o)return r.apply(this,t),this;var a=new((e=o).bind.apply(e,u([void 0],t)));return function(e,n){var r=e.constructor,o=r.hasOwnProperty(ge)?r[ge]:Object.defineProperty(r,ge,{value:{}})[ge];o[n]=o.hasOwnProperty(n)&&o[n]||[],o[n].unshift(a),i&&i.apply(void 0,u([e,n],t))}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o}var be=_e("Inject",function(e){return{token:e}}),ye=_e("Optional"),Te=_e("Self"),Ee=_e("SkipSelf"),xe=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function Ce(e){for(var t in e)if(e[t]===Ce)return t;throw Error("Could not find renamed property on target object.")}function Se(e){return{providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ae(e){return e&&e.hasOwnProperty(Pe)?e[Pe]:null}var Pe=Ce({ngInjectableDef:Ce});function Re(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(Re).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}var Me=Ce({__forward_ref__:Ce});function Oe(e){return e.__forward_ref__=Oe,e.toString=function(){return Re(this())},e}function we(e){var t=e;return"function"==typeof t&&t.hasOwnProperty(Me)&&t.__forward_ref__===Oe?t():e}function Ie(){var e="undefined"!=typeof globalThis&&globalThis,t="undefined"!=typeof window&&window,n="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i="undefined"!=typeof global&&global;return e||i||t||n}var De,Le=Ie(),ke=void 0;function Ne(e){var t=ke;return ke=e,t}function Fe(e,t){return void 0===t&&(t=xe.Default),(De||function(e,t){if(void 0===t&&(t=xe.Default),void 0===ke)throw new Error("inject() must be called from an injection context");return null===ke?function(e,t,n){var i=Ae(e);if(i&&"root"==i.providedIn)return void 0===i.value?i.value=i.factory():i.value;if(n&xe.Optional)return null;throw new Error("Injector: NOT_FOUND ["+Re(e)+"]")}(e,0,t):ke.get(e,t&xe.Optional?null:void 0,t)})(e,t)}var Be=function(){function e(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.ngInjectableDef=Se({providedIn:t.providedIn||"root",factory:t.factory}))}return e.prototype.toString=function(){return"InjectionToken "+this._desc},e}(),Ue="__source",Ve=new Object,Ge=new Be("INJECTOR",-1),ze=function(){function e(){}return e.prototype.get=function(e,t){if(void 0===t&&(t=Ve),t===Ve){var n=new Error("NullInjectorError: No provider for "+Re(e)+"!");throw n.name="NullInjectorError",n}return t},e}(),je=function(){function e(){}return e.create=function(e,t){return Array.isArray(e)?new Ze(e,t):new Ze(e.providers,e.parent,e.name||null)},e.THROW_IF_NOT_FOUND=Ve,e.NULL=new ze,e.ngInjectableDef=Se({providedIn:"any",factory:function(){return Fe(Ge)}}),e.__NG_ELEMENT_ID__=-1,e}(),He=function(e){return e},We=[],Xe=He,Ye=function(){return Array.prototype.slice.call(arguments)},Ke=Ce({provide:String,useValue:Ce}),Qe=/\n/gm,qe="\u0275",Ze=function(){function e(e,t,n){void 0===t&&(t=je.NULL),void 0===n&&(n=null),this.parent=t,this.source=n;var i=this._records=new Map;i.set(je,{token:je,fn:He,deps:We,value:this,useNew:!1}),i.set(Ge,{token:Ge,fn:He,deps:We,value:this,useNew:!1}),function e(t,n){if(n)if((n=we(n))instanceof Array)for(var i=0;i<n.length;i++)e(t,n[i]);else{if("function"==typeof n)throw et("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw et("Unexpected provider",n);var r=we(n.provide),o=function(e){var t=function(e){var t=We,n=e.deps;if(n&&n.length){t=[];for(var i=0;i<n.length;i++){var r=6;if((l=we(n[i]))instanceof Array)for(var o=0,a=l;o<a.length;o++){var s=a[o];s instanceof ye||s==ye?r|=1:s instanceof Ee||s==Ee?r&=-3:s instanceof Te||s==Te?r&=-5:l=s instanceof be?s.token:we(s)}t.push({token:l,options:r})}}else if(e.useExisting){var l;t=[{token:l=we(e.useExisting),options:6}]}else if(!(n||Ke in e))throw et("'deps' required",e);return t}(e),n=He,i=We,r=!1,o=we(e.provide);if(Ke in e)i=e.useValue;else if(e.useFactory)n=e.useFactory;else if(e.useExisting);else if(e.useClass)r=!0,n=we(e.useClass);else{if("function"!=typeof o)throw et("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);r=!0,n=o}return{deps:t,fn:n,useNew:r,value:i}}(n);if(!0===n.multi){var a=t.get(r);if(a){if(a.fn!==Ye)throw Je(r)}else t.set(r,a={token:n.provide,deps:[],useNew:!1,fn:Ye,value:We});a.deps.push({token:r=n,options:6})}var s=t.get(r);if(s&&s.fn==Ye)throw Je(r);t.set(r,o)}}(i,e)}return e.prototype.get=function(e,t,n){void 0===n&&(n=xe.Default);var i=this._records.get(e);try{return function e(t,n,i,r,o,a){try{return function(t,n,i,r,o,a){var s,l;if(!n||a&xe.SkipSelf)a&xe.Self||(l=r.get(t,o,xe.Default));else{if((l=n.value)==Xe)throw Error(qe+"Circular dependency");if(l===We){n.value=Xe;var c=n.useNew,h=n.fn,d=n.deps,f=We;if(d.length){f=[];for(var p=0;p<d.length;p++){var g=d[p],m=g.options,_=2&m?i.get(g.token):void 0;f.push(e(g.token,_,i,_||4&m?r:je.NULL,1&m?null:je.THROW_IF_NOT_FOUND,xe.Default))}}n.value=l=c?new((s=h).bind.apply(s,u([void 0],f))):h.apply(void 0,f)}}return l}(t,n,i,r,o,a)}catch(s){throw s instanceof Error||(s=new Error(s)),(s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(t),n&&n.value==Xe&&(n.value=We),s}}(e,i,this._records,this.parent,t,n)}catch(r){return function(e,t,n,i){var r=e.ngTempTokenPath;throw t[Ue]&&r.unshift(t[Ue]),e.message=$e("\n"+e.message,r,"StaticInjectorError",i),e.ngTokenPath=r,e.ngTempTokenPath=null,e}(r,e,0,this.source)}},e.prototype.toString=function(){var e=[];return this._records.forEach(function(t,n){return e.push(Re(n))}),"StaticInjector["+e.join(", ")+"]"},e}();function Je(e){return et("Cannot mix multi providers and regular providers",e)}function $e(e,t,n,i){void 0===i&&(i=null),e=e&&"\n"===e.charAt(0)&&e.charAt(1)==qe?e.substr(2):e;var r=Re(t);if(t instanceof Array)r=t.map(Re).join(" -> ");else if("object"==typeof t){var o=[];for(var a in t)if(t.hasOwnProperty(a)){var s=t[a];o.push(a+":"+("string"==typeof s?JSON.stringify(s):Re(s)))}r="{"+o.join(", ")+"}"}return n+(i?"("+i+")":"")+"["+r+"]: "+e.replace(Qe,"\n  ")}function et(e,t){return new Error($e(e,t,"StaticInjectorError"))}var tt="ngDebugContext",nt="ngOriginalError",it="ngErrorLogger",rt=new Be("AnalyzeForEntryComponents"),ot=function(e){return e[e.Emulated=0]="Emulated",e[e.Native=1]="Native",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}({}),at=function(){return("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Le)}();function st(e){return e[tt]}function lt(e){return e[nt]}function ct(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.error.apply(e,u(t))}var ut=function(){function e(){this._console=console}return e.prototype.handleError=function(e){var t=this._findOriginalError(e),n=this._findContext(e),i=function(e){return e[it]||ct}(e);i(this._console,"ERROR",e),t&&i(this._console,"ORIGINAL ERROR",t),n&&i(this._console,"ERROR CONTEXT",n)},e.prototype._findContext=function(e){return e?st(e)?st(e):this._findContext(lt(e)):null},e.prototype._findOriginalError=function(e){for(var t=lt(e);t&&lt(t);)t=lt(t);return t},e}(),ht=!0,dt=!1;function ft(){return dt=!0,ht}var pt=function(){function e(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t),this.inertBodyElement=this.inertDocument.createElement("body"),t.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return e.prototype.getInertBodyElement_XHR=function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(i){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(void 0);var n=t.response.body;return n.removeChild(n.firstChild),n},e.prototype.getInertBodyElement_DOMParser=function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(n){return null}},e.prototype.getInertBodyElement_InertDocument=function(e){var t=this.inertDocument.createElement("template");return"content"in t?(t.innerHTML=e,t):(this.inertBodyElement.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)},e.prototype.stripCustomNsAttrs=function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var i=t.item(n).name;"xmlns:ns1"!==i&&0!==i.indexOf("ns1:")||e.removeAttribute(i)}for(var r=e.firstChild;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling},e}(),gt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,mt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function _t(e){return(e=String(e)).match(gt)||e.match(mt)?e:(ft()&&console.warn("WARNING: sanitizing unsafe URL value "+e+" (see http://g.co/ng/security#xss)"),"unsafe:"+e)}function vt(e){var t,n,i={};try{for(var r=l(e.split(",")),o=r.next();!o.done;o=r.next())i[o.value]=!0}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return i}function bt(){for(var e,t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r={};try{for(var o=l(n),a=o.next();!a.done;a=o.next()){var s=a.value;for(var c in s)s.hasOwnProperty(c)&&(r[c]=!0)}}catch(u){e={error:u}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return r}var yt,Tt=vt("area,br,col,hr,img,wbr"),Et=vt("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),xt=vt("rp,rt"),Ct=bt(xt,Et),St=bt(Tt,bt(Et,vt("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),bt(xt,vt("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ct),At=vt("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Pt=vt("srcset"),Rt=bt(At,Pt,vt("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),vt("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Mt=vt("script,style,template"),Ot=function(){function e(){this.sanitizedSomething=!1,this.buf=[]}return e.prototype.sanitizeChildren=function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var i=this.checkClobberedElement(t,t.nextSibling);if(i){t=i;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")},e.prototype.startElement=function(e){var t,n=e.nodeName.toLowerCase();if(!St.hasOwnProperty(n))return this.sanitizedSomething=!0,!Mt.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);for(var i=e.attributes,r=0;r<i.length;r++){var o=i.item(r),a=o.name,s=a.toLowerCase();if(Rt.hasOwnProperty(s)){var l=o.value;At[s]&&(l=_t(l)),Pt[s]&&(t=l,l=(t=String(t)).split(",").map(function(e){return _t(e.trim())}).join(", ")),this.buf.push(" ",a,'="',Dt(l),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0},e.prototype.endElement=function(e){var t=e.nodeName.toLowerCase();St.hasOwnProperty(t)&&!Tt.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))},e.prototype.chars=function(e){this.buf.push(Dt(e))},e.prototype.checkClobberedElement=function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+e.outerHTML);return t},e}(),wt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,It=/([^\#-~ |!])/g;function Dt(e){return e.replace(/&/g,"&amp;").replace(wt,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(It,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Lt(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var kt=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}({}),Nt=function(){return function(){}}(),Ft=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Bt=/^url\(([^)]+)\)$/,Ut=/([A-Z])/g;function Vt(e){try{return null!=e?e.toString().slice(0,30):e}catch(t){return"[ERROR] Exception while trying to serialize the value"}}function Gt(e){return!!e&&"function"==typeof e.then}function zt(e){return!!e&&"function"==typeof e.subscribe}var jt=null;function Ht(){if(!jt){var e=Le.Symbol;if(e&&e.iterator)jt=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var i=t[n];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(jt=i)}}return jt}function Wt(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function Xt(e,t){var n=Kt(e),i=Kt(t);return n&&i?function(e,t,n){for(var i=e[Ht()](),r=t[Ht()]();;){var o=i.next(),a=r.next();if(o.done&&a.done)return!0;if(o.done||a.done)return!1;if(!n(o.value,a.value))return!1}}(e,t,Xt):!(n||!e||"object"!=typeof e&&"function"!=typeof e||i||!t||"object"!=typeof t&&"function"!=typeof t)||Wt(e,t)}var Yt=function(){function e(e){this.wrapped=e}return e.wrap=function(t){return new e(t)},e.unwrap=function(t){return e.isWrapped(t)?t.wrapped:t},e.isWrapped=function(t){return t instanceof e},e}();function Kt(e){return!!Qt(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ht()in e)}function Qt(e){return null!==e&&("function"==typeof e||"object"==typeof e)}var qt=function(){function e(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}return e.prototype.isFirstChange=function(){return this.firstChange},e}(),Zt=new Be("The presence of this token marks an injector as being the root injector."),Jt=function(){return function(){}}(),$t=function(){return function(){}}();function en(e){var t=Error("No component factory found for "+Re(e)+". Did you add it to @NgModule.entryComponents?");return t[tn]=e,t}var tn="ngComponent",nn=function(){function e(){}return e.prototype.resolveComponentFactory=function(e){throw en(e)},e}(),rn=function(){function e(){}return e.NULL=new nn,e}(),on=function(){function e(e,t,n){this._parent=t,this._ngModule=n,this._factories=new Map;for(var i=0;i<e.length;i++){var r=e[i];this._factories.set(r.componentType,r)}}return e.prototype.resolveComponentFactory=function(e){var t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw en(e);return new an(t,this._ngModule)},e}(),an=function(e){function t(t,n){var i=e.call(this)||this;return i.factory=t,i.ngModule=n,i.selector=t.selector,i.componentType=t.componentType,i.ngContentSelectors=t.ngContentSelectors,i.inputs=t.inputs,i.outputs=t.outputs,i}return r(t,e),t.prototype.create=function(e,t,n,i){return this.factory.create(e,t,n,i||this.ngModule)},t}($t),sn=function(){return function(){}}(),ln=function(){return function(){}}();function cn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}var un=function(){function e(e){this.nativeElement=e}return e.__NG_ELEMENT_ID__=function(){return hn(e)},e}(),hn=cn,dn=function(){return function(){}}(),fn=function(){return function(){}}(),pn=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}({}),gn=function(){function e(){}return e.__NG_ELEMENT_ID__=function(){return mn()},e}(),mn=cn,_n=new(function(){return function(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}())("8.0.3"),vn=function(){function e(){}return e.prototype.supports=function(e){return Kt(e)},e.prototype.create=function(e){return new yn(e)},e}(),bn=function(e,t){return t},yn=function(){function e(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||bn}return e.prototype.forEachItem=function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)},e.prototype.forEachOperation=function(e){for(var t=this._itHead,n=this._removalsHead,i=0,r=null;t||n;){var o=!n||t&&t.currentIndex<Cn(n,i,r)?t:n,a=Cn(o,i,r),s=o.currentIndex;if(o===n)i--,n=n._nextRemoved;else if(t=t._next,null==o.previousIndex)i++;else{r||(r=[]);var l=a-i,c=s-i;if(l!=c){for(var u=0;u<l;u++){var h=u<r.length?r[u]:r[u]=0,d=h+u;c<=d&&d<l&&(r[u]=h+1)}r[o.previousIndex]=c-l}}a!==s&&e(o,a,s)}},e.prototype.forEachPreviousItem=function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)},e.prototype.forEachAddedItem=function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)},e.prototype.forEachMovedItem=function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)},e.prototype.forEachRemovedItem=function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)},e.prototype.forEachIdentityChange=function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)},e.prototype.diff=function(e){if(null==e&&(e=[]),!Kt(e))throw new Error("Error trying to diff '"+Re(e)+"'. Only arrays and iterables are allowed");return this.check(e)?this:null},e.prototype.onDestroy=function(){},e.prototype.check=function(e){var t=this;this._reset();var n,i,r,o=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=this._trackByFn(s,i=e[s]),null!==o&&Wt(o.trackById,r)?(a&&(o=this._verifyReinsertion(o,i,r,s)),Wt(o.item,i)||this._addIdentityChange(o,i)):(o=this._mismatch(o,i,r,s),a=!0),o=o._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var i=e[Ht()](),r=void 0;!(r=i.next()).done;)t(r.value)}(e,function(e){r=t._trackByFn(n,e),null!==o&&Wt(o.trackById,r)?(a&&(o=t._verifyReinsertion(o,e,r,n)),Wt(o.item,e)||t._addIdentityChange(o,e)):(o=t._mismatch(o,e,r,n),a=!0),o=o._next,n++}),this.length=n;return this._truncate(o),this.collection=e,this.isDirty},Object.defineProperty(e.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead},enumerable:!0,configurable:!0}),e.prototype._reset=function(){if(this.isDirty){var e=void 0,t=void 0;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}},e.prototype._mismatch=function(e,t,n,i){var r;return null===e?r=this._itTail:(r=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Wt(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,r,i)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Wt(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,r,i)):e=this._addAfter(new Tn(t,n),r,i),e},e.prototype._verifyReinsertion=function(e,t,n,i){var r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==r?e=this._reinsertAfter(r,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e},e.prototype._truncate=function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)},e.prototype._reinsertAfter=function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var i=e._prevRemoved,r=e._nextRemoved;return null===i?this._removalsHead=r:i._nextRemoved=r,null===r?this._removalsTail=i:r._prevRemoved=i,this._insertAfter(e,t,n),this._addToMoves(e,n),e},e.prototype._moveAfter=function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e},e.prototype._addAfter=function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e},e.prototype._insertAfter=function(e,t,n){var i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new xn),this._linkedRecords.put(e),e.currentIndex=n,e},e.prototype._remove=function(e){return this._addToRemovals(this._unlink(e))},e.prototype._unlink=function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e},e.prototype._addToMoves=function(e,t){return e.previousIndex===t?e:(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e,e)},e.prototype._addToRemovals=function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new xn),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e},e.prototype._addIdentityChange=function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e},e}(),Tn=function(){return function(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}(),En=function(){function e(){this._head=null,this._tail=null}return e.prototype.add=function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)},e.prototype.get=function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Wt(n.trackById,e))return n;return null},e.prototype.remove=function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head},e}(),xn=function(){function e(){this.map=new Map}return e.prototype.put=function(e){var t=e.trackById,n=this.map.get(t);n||(n=new En,this.map.set(t,n)),n.add(e)},e.prototype.get=function(e,t){var n=this.map.get(e);return n?n.get(e,t):null},e.prototype.remove=function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.map.size},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.map.clear()},e}();function Cn(e,t,n){var i=e.previousIndex;if(null===i)return i;var r=0;return n&&i<n.length&&(r=n[i]),i+t+r}var Sn=function(){function e(){}return e.prototype.supports=function(e){return e instanceof Map||Qt(e)},e.prototype.create=function(){return new An},e}(),An=function(){function e(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead},enumerable:!0,configurable:!0}),e.prototype.forEachItem=function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)},e.prototype.forEachPreviousItem=function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)},e.prototype.forEachChangedItem=function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)},e.prototype.forEachAddedItem=function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)},e.prototype.forEachRemovedItem=function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)},e.prototype.diff=function(e){if(e){if(!(e instanceof Map||Qt(e)))throw new Error("Error trying to diff '"+Re(e)+"'. Only maps and objects are allowed")}else e=new Map;return this.check(e)?this:null},e.prototype.onDestroy=function(){},e.prototype.check=function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,function(e,i){if(n&&n.key===i)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var r=t._getOrCreateRecordForKey(i,e);n=t._insertBeforeOrAppend(n,r)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var i=n;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty},e.prototype._insertBeforeOrAppend=function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null},e.prototype._getOrCreateRecordForKey=function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var i=n._prev,r=n._next;return i&&(i._next=r),r&&(r._prev=i),n._next=null,n._prev=null,n}var o=new Pn(e);return this._records.set(e,o),o.currentValue=t,this._addToAdditions(o),o},e.prototype._reset=function(){if(this.isDirty){var e=void 0;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}},e.prototype._maybeAddToChanges=function(e,t){Wt(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))},e.prototype._addToAdditions=function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)},e.prototype._addToChanges=function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)},e.prototype._forEach=function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(function(n){return t(e[n],n)})},e}(),Pn=function(){return function(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}(),Rn=function(){function e(e){this.factories=e}return e.create=function(t,n){if(null!=n){var i=n.factories.slice();t=t.concat(i)}return new e(t)},e.extend=function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ee,new ye]]}},e.prototype.find=function(e){var t,n=this.factories.find(function(t){return t.supports(e)});if(null!=n)return n;throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+((t=e).name||typeof t)+"'")},e.ngInjectableDef=Se({providedIn:"root",factory:function(){return new e([new vn])}}),e}(),Mn=function(){function e(e){this.factories=e}return e.create=function(t,n){if(n){var i=n.factories.slice();t=t.concat(i)}return new e(t)},e.extend=function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ee,new ye]]}},e.prototype.find=function(e){var t=this.factories.find(function(t){return t.supports(e)});if(t)return t;throw new Error("Cannot find a differ supporting object '"+e+"'")},e.ngInjectableDef=Se({providedIn:"root",factory:function(){return new e([new Sn])}}),e}(),On=function(){function e(){}return e.__NG_ELEMENT_ID__=function(){return wn()},e}(),wn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},In=[new Sn],Dn=new Rn([new vn]),Ln=new Mn(In),kn=function(){function e(){}return e.__NG_ELEMENT_ID__=function(){return Nn(e,un)},e}(),Nn=cn,Fn=function(){function e(){}return e.__NG_ELEMENT_ID__=function(){return Bn(e,un)},e}(),Bn=cn;function Un(e,t,n,i){var r="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '"+t+"'. Current value: '"+n+"'.";return i&&(r+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){var n=new Error(e);return Vn(n,t),n}(r,e)}function Vn(e,t){e[tt]=t,e[it]=t.logError.bind(t)}function Gn(e){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+e)}function zn(e,t,n){var i=e.state,r=1792&i;return r===t?(e.state=-1793&i|n,e.initIndex=-1,!0):r===n}function jn(e,t,n){return(1792&e.state)===t&&e.initIndex<=n&&(e.initIndex=n+1,!0)}function Hn(e,t){return e.nodes[t]}function Wn(e,t){return e.nodes[t]}function Xn(e,t){return e.nodes[t]}function Yn(e,t){return e.nodes[t]}function Kn(e,t){return e.nodes[t]}var Qn={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},qn=function(){},Zn=new Map;function Jn(e){var t=Zn.get(e);return t||(t=Re(e)+"_"+Zn.size,Zn.set(e,t)),t}var $n="$$undefined",ei="$$empty";function ti(e){return{id:$n,styles:e.styles,encapsulation:e.encapsulation,data:e.data}}var ni=0;function ii(e,t,n,i){return!(!(2&e.state)&&Wt(e.oldValues[t.bindingIndex+n],i))}function ri(e,t,n,i){return!!ii(e,t,n,i)&&(e.oldValues[t.bindingIndex+n]=i,!0)}function oi(e,t,n,i){var r=e.oldValues[t.bindingIndex+n];if(1&e.state||!Xt(r,i)){var o=t.bindings[n].name;throw Un(Qn.createDebugContext(e,t.nodeIndex),o+": "+r,o+": "+i,0!=(1&e.state))}}function ai(e){for(var t=e;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function si(e,t){for(var n=e;n&&n!==t;)n.state|=64,n=n.viewContainerParent||n.parent}function li(e,t,n,i){try{return ai(33554432&e.def.nodes[t].flags?Wn(e,t).componentView:e),Qn.handleEvent(e,t,n,i)}catch(r){e.root.errorHandler.handleError(r)}}function ci(e){return e.parent?Wn(e.parent,e.parentNodeDef.nodeIndex):null}function ui(e){return e.parent?e.parentNodeDef.parent:null}function hi(e,t){switch(201347067&t.flags){case 1:return Wn(e,t.nodeIndex).renderElement;case 2:return Hn(e,t.nodeIndex).renderText}}function di(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function fi(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function pi(e){return 1<<e%32}function gi(e){var t={},n=0,i={};return e&&e.forEach(function(e){var r=c(e,2),o=r[0],a=r[1];"number"==typeof o?(t[o]=a,n|=pi(o)):i[o]=a}),{matchedQueries:t,references:i,matchedQueryIds:n}}function mi(e,t){return e.map(function(e){var n,i,r;return Array.isArray(e)?(r=(n=c(e,2))[0],i=n[1]):(r=0,i=e),i&&("function"==typeof i||"object"==typeof i)&&t&&Object.defineProperty(i,Ue,{value:t,configurable:!0}),{flags:r,token:i,tokenKey:Jn(i)}})}function _i(e,t,n){var i=n.renderParent;return i?0==(1&i.flags)||0==(33554432&i.flags)||i.element.componentRendererType&&i.element.componentRendererType.encapsulation===ot.Native?Wn(e,n.renderParent.nodeIndex).renderElement:void 0:t}var vi=new WeakMap;function bi(e){var t=vi.get(e);return t||((t=e(function(){return qn})).factory=e,vi.set(e,t)),t}function yi(e,t,n,i,r){3===t&&(n=e.renderer.parentNode(hi(e,e.def.lastRenderRootNode))),Ti(e,t,0,e.def.nodes.length-1,n,i,r)}function Ti(e,t,n,i,r,o,a){for(var s=n;s<=i;s++){var l=e.def.nodes[s];11&l.flags&&xi(e,l,t,r,o,a),s+=l.childCount}}function Ei(e,t,n,i,r,o){for(var a=e;a&&!di(a);)a=a.parent;for(var s=a.parent,l=ui(a),c=l.nodeIndex+l.childCount,u=l.nodeIndex+1;u<=c;u++){var h=s.def.nodes[u];h.ngContentIndex===t&&xi(s,h,n,i,r,o),u+=h.childCount}if(!s.parent){var d=e.root.projectableNodes[t];if(d)for(u=0;u<d.length;u++)Ci(e,d[u],n,i,r,o)}}function xi(e,t,n,i,r,o){if(8&t.flags)Ei(e,t.ngContent.index,n,i,r,o);else{var a=hi(e,t);if(3===n&&33554432&t.flags&&48&t.bindingFlags?(16&t.bindingFlags&&Ci(e,a,n,i,r,o),32&t.bindingFlags&&Ci(Wn(e,t.nodeIndex).componentView,a,n,i,r,o)):Ci(e,a,n,i,r,o),16777216&t.flags)for(var s=Wn(e,t.nodeIndex).viewContainer._embeddedViews,l=0;l<s.length;l++)yi(s[l],n,i,r,o);1&t.flags&&!t.element.name&&Ti(e,n,t.nodeIndex+1,t.nodeIndex+t.childCount,i,r,o)}}function Ci(e,t,n,i,r,o){var a=e.renderer;switch(n){case 1:a.appendChild(i,t);break;case 2:a.insertBefore(i,t,r);break;case 3:a.removeChild(i,t);break;case 0:o.push(t)}}var Si=/^:([^:]+):(.+)$/;function Ai(e){if(":"===e[0]){var t=e.match(Si);return[t[1],t[2]]}return["",e]}function Pi(e){for(var t=0,n=0;n<e.length;n++)t|=e[n].flags;return t}function Ri(e,t,n,i,r,o,a,s,l,c,u,h,d,f,p,g,m,_,v,b){switch(e){case 1:return t+Mi(n)+i;case 2:return t+Mi(n)+i+Mi(r)+o;case 3:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s;case 4:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c;case 5:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c+Mi(u)+h;case 6:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c+Mi(u)+h+Mi(d)+f;case 7:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c+Mi(u)+h+Mi(d)+f+Mi(p)+g;case 8:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c+Mi(u)+h+Mi(d)+f+Mi(p)+g+Mi(m)+_;case 9:return t+Mi(n)+i+Mi(r)+o+Mi(a)+s+Mi(l)+c+Mi(u)+h+Mi(d)+f+Mi(p)+g+Mi(m)+_+Mi(v)+b;default:throw new Error("Does not support more than 9 expressions")}}function Mi(e){return null!=e?e.toString():""}var Oi=new Object,wi=Jn(je),Ii=Jn(Ge),Di=Jn(sn);function Li(e,t,n,i){return n=we(n),{index:-1,deps:mi(i,Re(t)),flags:e,token:t,value:n}}function ki(e,t,n){void 0===n&&(n=je.THROW_IF_NOT_FOUND);var i,r,o=Ne(e);try{if(8&t.flags)return t.token;if(2&t.flags&&(n=null),1&t.flags)return e._parent.get(t.token,n);var a=t.tokenKey;switch(a){case wi:case Ii:case Di:return e}var s,l=e._def.providersByKey[a];if(l){var c=e._providers[l.index];return void 0===c&&(c=e._providers[l.index]=Ni(e,l)),c===Oi?void 0:c}if((s=Ae(t.token))&&(i=e,null!=(r=s).providedIn&&(function(e,t){return e._def.modules.indexOf(r.providedIn)>-1}(i)||"root"===r.providedIn&&i._def.isRoot))){var u=e._providers.length;return e._def.providers[u]=e._def.providersByKey[t.tokenKey]={flags:5120,value:s.factory,deps:[],index:u,token:t.token},e._providers[u]=Oi,e._providers[u]=Ni(e,e._def.providersByKey[t.tokenKey])}return 4&t.flags?n:e._parent.get(t.token,n)}finally{Ne(o)}}function Ni(e,t){var n;switch(201347067&t.flags){case 512:n=function(e,t,n){var i=n.length;switch(i){case 0:return new t;case 1:return new t(ki(e,n[0]));case 2:return new t(ki(e,n[0]),ki(e,n[1]));case 3:return new t(ki(e,n[0]),ki(e,n[1]),ki(e,n[2]));default:for(var r=new Array(i),o=0;o<i;o++)r[o]=ki(e,n[o]);return new(t.bind.apply(t,u([void 0],r)))}}(e,t.value,t.deps);break;case 1024:n=function(e,t,n){var i=n.length;switch(i){case 0:return t();case 1:return t(ki(e,n[0]));case 2:return t(ki(e,n[0]),ki(e,n[1]));case 3:return t(ki(e,n[0]),ki(e,n[1]),ki(e,n[2]));default:for(var r=Array(i),o=0;o<i;o++)r[o]=ki(e,n[o]);return t.apply(void 0,u(r))}}(e,t.value,t.deps);break;case 2048:n=ki(e,t.deps[0]);break;case 256:n=t.value}return n===Oi||null===n||"object"!=typeof n||131072&t.flags||"function"!=typeof n.ngOnDestroy||(t.flags|=131072),void 0===n?Oi:n}function Fi(e,t){var n=e.viewContainer._embeddedViews;if((null==t||t>=n.length)&&(t=n.length-1),t<0)return null;var i=n[t];return i.viewContainerParent=null,Gi(n,t),Qn.dirtyParentQueries(i),Ui(i),i}function Bi(e,t,n){var i=t?hi(t,t.def.lastRenderRootNode):e.renderElement,r=n.renderer.parentNode(i),o=n.renderer.nextSibling(i);yi(n,2,r,o,void 0)}function Ui(e){yi(e,3,null,null,void 0)}function Vi(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Gi(e,t){t>=e.length-1?e.pop():e.splice(t,1)}var zi=new Object;function ji(e,t,n,i,r,o){return new Hi(e,t,n,i,r,o)}var Hi=function(e){function t(t,n,i,r,o,a){var s=e.call(this)||this;return s.selector=t,s.componentType=n,s._inputs=r,s._outputs=o,s.ngContentSelectors=a,s.viewDefFactory=i,s}return r(t,e),Object.defineProperty(t.prototype,"inputs",{get:function(){var e=[],t=this._inputs;for(var n in t)e.push({propName:n,templateName:t[n]});return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){var e=[];for(var t in this._outputs)e.push({propName:t,templateName:this._outputs[t]});return e},enumerable:!0,configurable:!0}),t.prototype.create=function(e,t,n,i){if(!i)throw new Error("ngModule should be provided");var r=bi(this.viewDefFactory),o=r.nodes[0].element.componentProvider.nodeIndex,a=Qn.createRootView(e,t||[],n,r,i,zi),s=Xn(a,o).instance;return n&&a.renderer.setAttribute(Wn(a,0).renderElement,"ng-version",_n.full),new Wi(a,new Qi(a),s)},t}($t),Wi=function(e){function t(t,n,i){var r=e.call(this)||this;return r._view=t,r._viewRef=n,r._component=i,r._elDef=r._view.def.nodes[0],r.hostView=n,r.changeDetectorRef=n,r.instance=i,r}return r(t,e),Object.defineProperty(t.prototype,"location",{get:function(){return new un(Wn(this._view,this._elDef.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"injector",{get:function(){return new $i(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"componentType",{get:function(){return this._component.constructor},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._viewRef.destroy()},t.prototype.onDestroy=function(e){this._viewRef.onDestroy(e)},t}(Jt);function Xi(e,t,n){return new Yi(e,t,n)}var Yi=function(){function e(e,t,n){this._view=e,this._elDef=t,this._data=n,this._embeddedViews=[]}return Object.defineProperty(e.prototype,"element",{get:function(){return new un(this._data.renderElement)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return new $i(this._view,this._elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentInjector",{get:function(){for(var e=this._view,t=this._elDef.parent;!t&&e;)t=ui(e),e=e.parent;return e?new $i(e,t):new $i(this._view,null)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){for(var e=this._embeddedViews.length-1;e>=0;e--){var t=Fi(this._data,e);Qn.destroyView(t)}},e.prototype.get=function(e){var t=this._embeddedViews[e];if(t){var n=new Qi(t);return n.attachToViewContainerRef(this),n}return null},Object.defineProperty(e.prototype,"length",{get:function(){return this._embeddedViews.length},enumerable:!0,configurable:!0}),e.prototype.createEmbeddedView=function(e,t,n){var i=e.createEmbeddedView(t||{});return this.insert(i,n),i},e.prototype.createComponent=function(e,t,n,i,r){var o=n||this.parentInjector;r||e instanceof an||(r=o.get(sn));var a=e.create(o,i,void 0,r);return this.insert(a.hostView,t),a},e.prototype.insert=function(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,i,r,o,a=e;return o=(n=this._data).viewContainer._embeddedViews,null==(i=t)&&(i=o.length),(r=a._view).viewContainerParent=this._view,Vi(o,i,r),function(e,t){var n=ci(t);if(n&&n!==e&&!(16&t.state)){t.state|=16;var i=n.template._projectedViews;i||(i=n.template._projectedViews=[]),i.push(t),function(e,n){if(!(4&n.flags)){t.parent.def.nodeFlags|=4,n.flags|=4;for(var i=n.parent;i;)i.childFlags|=4,i=i.parent}}(0,t.parentNodeDef)}}(n,r),Qn.dirtyParentQueries(r),Bi(n,i>0?o[i-1]:null,r),a.attachToViewContainerRef(this),e},e.prototype.move=function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,i,r,o,a,s=this._embeddedViews.indexOf(e._view);return r=t,a=(o=(n=this._data).viewContainer._embeddedViews)[i=s],Gi(o,i),null==r&&(r=o.length),Vi(o,r,a),Qn.dirtyParentQueries(a),Ui(a),Bi(n,r>0?o[r-1]:null,a),e},e.prototype.indexOf=function(e){return this._embeddedViews.indexOf(e._view)},e.prototype.remove=function(e){var t=Fi(this._data,e);t&&Qn.destroyView(t)},e.prototype.detach=function(e){var t=Fi(this._data,e);return t?new Qi(t):null},e}();function Ki(e){return new Qi(e)}var Qi=function(){function e(e){this._view=e,this._viewContainerRef=null,this._appRef=null}return Object.defineProperty(e.prototype,"rootNodes",{get:function(){return yi(this._view,0,void 0,void 0,e=[]),e;var e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._view.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return 0!=(128&this._view.state)},enumerable:!0,configurable:!0}),e.prototype.markForCheck=function(){ai(this._view)},e.prototype.detach=function(){this._view.state&=-5},e.prototype.detectChanges=function(){var e=this._view.root.rendererFactory;e.begin&&e.begin();try{Qn.checkAndUpdateView(this._view)}finally{e.end&&e.end()}},e.prototype.checkNoChanges=function(){Qn.checkNoChangesView(this._view)},e.prototype.reattach=function(){this._view.state|=4},e.prototype.onDestroy=function(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)},e.prototype.destroy=function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Qn.destroyView(this._view)},e.prototype.detachFromAppRef=function(){this._appRef=null,Ui(this._view),Qn.dirtyParentQueries(this._view)},e.prototype.attachToAppRef=function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e},e.prototype.attachToViewContainerRef=function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e},e}();function qi(e,t){return new Zi(e,t)}var Zi=function(e){function t(t,n){var i=e.call(this)||this;return i._parentView=t,i._def=n,i}return r(t,e),t.prototype.createEmbeddedView=function(e){return new Qi(Qn.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))},Object.defineProperty(t.prototype,"elementRef",{get:function(){return new un(Wn(this._parentView,this._def.nodeIndex).renderElement)},enumerable:!0,configurable:!0}),t}(kn);function Ji(e,t){return new $i(e,t)}var $i=function(){function e(e,t){this.view=e,this.elDef=t}return e.prototype.get=function(e,t){return void 0===t&&(t=je.THROW_IF_NOT_FOUND),Qn.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:e,tokenKey:Jn(e)},t)},e}();function er(e,t){var n=e.def.nodes[t];if(1&n.flags){var i=Wn(e,n.nodeIndex);return n.element.template?i.template:i.renderElement}if(2&n.flags)return Hn(e,n.nodeIndex).renderText;if(20240&n.flags)return Xn(e,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+t)}function tr(e){return new nr(e.renderer)}var nr=function(){function e(e){this.delegate=e}return e.prototype.selectRootElement=function(e){return this.delegate.selectRootElement(e)},e.prototype.createElement=function(e,t){var n=c(Ai(t),2),i=this.delegate.createElement(n[1],n[0]);return e&&this.delegate.appendChild(e,i),i},e.prototype.createViewRoot=function(e){return e},e.prototype.createTemplateAnchor=function(e){var t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t},e.prototype.createText=function(e,t){var n=this.delegate.createText(t);return e&&this.delegate.appendChild(e,n),n},e.prototype.projectNodes=function(e,t){for(var n=0;n<t.length;n++)this.delegate.appendChild(e,t[n])},e.prototype.attachViewAfter=function(e,t){for(var n=this.delegate.parentNode(e),i=this.delegate.nextSibling(e),r=0;r<t.length;r++)this.delegate.insertBefore(n,t[r],i)},e.prototype.detachView=function(e){for(var t=0;t<e.length;t++){var n=e[t],i=this.delegate.parentNode(n);this.delegate.removeChild(i,n)}},e.prototype.destroyView=function(e,t){for(var n=0;n<t.length;n++)this.delegate.destroyNode(t[n])},e.prototype.listen=function(e,t,n){return this.delegate.listen(e,t,n)},e.prototype.listenGlobal=function(e,t,n){return this.delegate.listen(e,t,n)},e.prototype.setElementProperty=function(e,t,n){this.delegate.setProperty(e,t,n)},e.prototype.setElementAttribute=function(e,t,n){var i=c(Ai(t),2),r=i[0],o=i[1];null!=n?this.delegate.setAttribute(e,o,n,r):this.delegate.removeAttribute(e,o,r)},e.prototype.setBindingDebugInfo=function(e,t,n){},e.prototype.setElementClass=function(e,t,n){n?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)},e.prototype.setElementStyle=function(e,t,n){null!=n?this.delegate.setStyle(e,t,n):this.delegate.removeStyle(e,t)},e.prototype.invokeElementMethod=function(e,t,n){e[t].apply(e,n)},e.prototype.setText=function(e,t){this.delegate.setValue(e,t)},e.prototype.animate=function(){throw new Error("Renderer.animate is no longer supported!")},e}();function ir(e,t,n,i){return new rr(e,t,n,i)}var rr=function(){function e(e,t,n,i){this._moduleType=e,this._parent=t,this._bootstrapComponents=n,this._def=i,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){for(var t=e._def,n=e._providers=new Array(t.providers.length),i=0;i<t.providers.length;i++){var r=t.providers[i];4096&r.flags||void 0===n[i]&&(n[i]=Ni(e,r))}}(this)}return e.prototype.get=function(e,t,n){void 0===t&&(t=je.THROW_IF_NOT_FOUND),void 0===n&&(n=xe.Default);var i=0;return n&xe.SkipSelf?i|=1:n&xe.Self&&(i|=4),ki(this,{token:e,tokenKey:Jn(e),flags:i},t)},Object.defineProperty(e.prototype,"instance",{get:function(){return this.get(this._moduleType)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentFactoryResolver",{get:function(){return this.get(rn)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this._destroyed)throw new Error("The ng module "+Re(this.instance.constructor)+" has already been destroyed.");this._destroyed=!0,function(e,t){for(var n=e._def,i=new Set,r=0;r<n.providers.length;r++)if(131072&n.providers[r].flags){var o=e._providers[r];if(o&&o!==Oi){var a=o.ngOnDestroy;"function"!=typeof a||i.has(o)||(a.apply(o),i.add(o))}}}(this),this._destroyListeners.forEach(function(e){return e()})},e.prototype.onDestroy=function(e){this._destroyListeners.push(e)},e}(),or=Jn(dn),ar=Jn(gn),sr=Jn(un),lr=Jn(Fn),cr=Jn(kn),ur=Jn(On),hr=Jn(je),dr=Jn(Ge);function fr(e,t,n,i,r,o,a,s){var l=[];if(a)for(var u in a){var h=c(a[u],2);l[h[0]]={flags:8,name:u,nonMinifiedName:h[1],ns:null,securityContext:null,suffix:null}}var d=[];if(s)for(var f in s)d.push({type:1,propName:f,target:null,eventName:s[f]});return gr(e,t|=16384,n,i,r,r,o,l,d)}function pr(e,t,n,i,r){return gr(-1,e,t,0,n,i,r)}function gr(e,t,n,i,r,o,a,s,l){var c=gi(n),u=c.matchedQueries,h=c.references,d=c.matchedQueryIds;l||(l=[]),s||(s=[]),o=we(o);var f=mi(a,Re(r));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:u,matchedQueryIds:d,references:h,ngContentIndex:-1,childCount:i,bindings:s,bindingFlags:Pi(s),outputs:l,element:null,provider:{token:r,value:o,deps:f},text:null,query:null,ngContent:null}}function mr(e,t){return yr(e,t)}function _r(e,t){for(var n=e;n.parent&&!di(n);)n=n.parent;return Tr(n.parent,ui(n),!0,t.provider.value,t.provider.deps)}function vr(e,t){var n=Tr(e,t.parent,(32768&t.flags)>0,t.provider.value,t.provider.deps);if(t.outputs.length)for(var i=0;i<t.outputs.length;i++){var r=t.outputs[i],o=n[r.propName];if(!zt(o))throw new Error("@Output "+r.propName+" not initialized in '"+n.constructor.name+"'.");var a=o.subscribe(br(e,t.parent.nodeIndex,r.eventName));e.disposables[t.outputIndex+i]=a.unsubscribe.bind(a)}return n}function br(e,t,n){return function(i){return li(e,t,n,i)}}function yr(e,t){var n=(8192&t.flags)>0,i=t.provider;switch(201347067&t.flags){case 512:return Tr(e,t.parent,n,i.value,i.deps);case 1024:return function(e,t,n,i,r){var o=r.length;switch(o){case 0:return i();case 1:return i(xr(e,t,n,r[0]));case 2:return i(xr(e,t,n,r[0]),xr(e,t,n,r[1]));case 3:return i(xr(e,t,n,r[0]),xr(e,t,n,r[1]),xr(e,t,n,r[2]));default:for(var a=Array(o),s=0;s<o;s++)a[s]=xr(e,t,n,r[s]);return i.apply(void 0,u(a))}}(e,t.parent,n,i.value,i.deps);case 2048:return xr(e,t.parent,n,i.deps[0]);case 256:return i.value}}function Tr(e,t,n,i,r){var o=r.length;switch(o){case 0:return new i;case 1:return new i(xr(e,t,n,r[0]));case 2:return new i(xr(e,t,n,r[0]),xr(e,t,n,r[1]));case 3:return new i(xr(e,t,n,r[0]),xr(e,t,n,r[1]),xr(e,t,n,r[2]));default:for(var a=new Array(o),s=0;s<o;s++)a[s]=xr(e,t,n,r[s]);return new(i.bind.apply(i,u([void 0],a)))}}var Er={};function xr(e,t,n,i,r){if(void 0===r&&(r=je.THROW_IF_NOT_FOUND),8&i.flags)return i.token;var o=e;2&i.flags&&(r=null);var a=i.tokenKey;a===ur&&(n=!(!t||!t.element.componentView)),t&&1&i.flags&&(n=!1,t=t.parent);for(var s=e;s;){if(t)switch(a){case or:return tr(Cr(s,t,n));case ar:return Cr(s,t,n).renderer;case sr:return new un(Wn(s,t.nodeIndex).renderElement);case lr:return Wn(s,t.nodeIndex).viewContainer;case cr:if(t.element.template)return Wn(s,t.nodeIndex).template;break;case ur:return Ki(Cr(s,t,n));case hr:case dr:return Ji(s,t);default:var l=(n?t.element.allProviders:t.element.publicProviders)[a];if(l){var c=Xn(s,l.nodeIndex);return c||(c={instance:yr(s,l)},s.nodes[l.nodeIndex]=c),c.instance}}n=di(s),t=ui(s),s=s.parent,4&i.flags&&(s=null)}var u=o.root.injector.get(i.token,Er);return u!==Er||r===Er?u:o.root.ngModule.injector.get(i.token,r)}function Cr(e,t,n){var i;if(n)i=Wn(e,t.nodeIndex).componentView;else for(i=e;i.parent&&!di(i);)i=i.parent;return i}function Sr(e,t,n,i,r,o){if(32768&n.flags){var a=Wn(e,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(t.instance[n.bindings[i].name]=r,524288&n.flags){o=o||{};var s=Yt.unwrap(e.oldValues[n.bindingIndex+i]);o[n.bindings[i].nonMinifiedName]=new qt(s,r,0!=(2&e.state))}return e.oldValues[n.bindingIndex+i]=r,o}function Ar(e,t){if(e.def.nodeFlags&t)for(var n=e.def.nodes,i=0,r=0;r<n.length;r++){var o=n[r],a=o.parent;for(!a&&o.flags&t&&Rr(e,r,o.flags&t,i++),0==(o.childFlags&t)&&(r+=o.childCount);a&&1&a.flags&&r===a.nodeIndex+a.childCount;)a.directChildFlags&t&&(i=Pr(e,a,t,i)),a=a.parent}}function Pr(e,t,n,i){for(var r=t.nodeIndex+1;r<=t.nodeIndex+t.childCount;r++){var o=e.def.nodes[r];o.flags&n&&Rr(e,r,o.flags&n,i++),r+=o.childCount}return i}function Rr(e,t,n,i){var r=Xn(e,t);if(r){var o=r.instance;o&&(Qn.setCurrentNode(e,t),1048576&n&&jn(e,512,i)&&o.ngAfterContentInit(),2097152&n&&o.ngAfterContentChecked(),4194304&n&&jn(e,768,i)&&o.ngAfterViewInit(),8388608&n&&o.ngAfterViewChecked(),131072&n&&o.ngOnDestroy())}}var Mr=new Be("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return at}}),Or=function(e){function t(t){void 0===t&&(t=!1);var n=e.call(this)||this;return n.__isAsync=t,n}return r(t,e),t.prototype.emit=function(t){e.prototype.next.call(this,t)},t.prototype.subscribe=function(t,n,i){var r,o=function(e){return null},a=function(){return null};t&&"object"==typeof t?(r=this.__isAsync?function(e){setTimeout(function(){return t.next(e)})}:function(e){t.next(e)},t.error&&(o=this.__isAsync?function(e){setTimeout(function(){return t.error(e)})}:function(e){t.error(e)}),t.complete&&(a=this.__isAsync?function(){setTimeout(function(){return t.complete()})}:function(){t.complete()})):(r=this.__isAsync?function(e){setTimeout(function(){return t(e)})}:function(e){t(e)},n&&(o=this.__isAsync?function(e){setTimeout(function(){return n(e)})}:function(e){n(e)}),i&&(a=this.__isAsync?function(){setTimeout(function(){return i()})}:function(){i()}));var s=e.prototype.subscribe.call(this,r,o,a);return t instanceof m&&t.add(s),s},t}(k),wr=function(){function e(){this.dirty=!0,this._results=[],this.changes=new Or,this.length=0}return e.prototype.map=function(e){return this._results.map(e)},e.prototype.filter=function(e){return this._results.filter(e)},e.prototype.find=function(e){return this._results.find(e)},e.prototype.reduce=function(e,t){return this._results.reduce(e,t)},e.prototype.forEach=function(e){this._results.forEach(e)},e.prototype.some=function(e){return this._results.some(e)},e.prototype.toArray=function(){return this._results.slice()},e.prototype[Ht()]=function(){return this._results[Ht()]()},e.prototype.toString=function(){return this._results.toString()},e.prototype.reset=function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var i=0;i<t.length;i++){var r=t[i];Array.isArray(r)?(n===t&&(n=t.slice(0,i)),e(r,n)):n!==t&&n.push(r)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]},e.prototype.notifyOnChanges=function(){this.changes.emit(this)},e.prototype.setDirty=function(){this.dirty=!0},e.prototype.destroy=function(){this.changes.complete(),this.changes.unsubscribe()},e}(),Ir=function(){return function(){}}(),Dr=ve("Input",function(e){return{bindingPropertyName:e}}),Lr=ve("HostBinding",function(e){return{hostPropertyName:e}}),kr=new Be("Application Initializer"),Nr=function(){function e(e){var t=this;this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return e.prototype.runInitializers=function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var i=0;i<this.appInits.length;i++){var r=this.appInits[i]();Gt(r)&&t.push(r)}Promise.all(t).then(function(){n()}).catch(function(t){e.reject(t)}),0===t.length&&n(),this.initialized=!0}},e}(),Fr=new Be("AppId");function Br(){return""+Ur()+Ur()+Ur()}function Ur(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Vr=new Be("Platform Initializer"),Gr=new Be("Platform ID"),zr=new Be("appBootstrapListener"),jr=function(){function e(){}return e.prototype.log=function(e){console.log(e)},e.prototype.warn=function(e){console.warn(e)},e}();function Hr(){throw new Error("Runtime compiler is not loaded")}var Wr,Xr,Yr=Hr,Kr=Hr,Qr=Hr,qr=Hr,Zr=function(){function e(){this.compileModuleSync=Yr,this.compileModuleAsync=Kr,this.compileModuleAndAllComponentsSync=Qr,this.compileModuleAndAllComponentsAsync=qr}return e.prototype.clearCache=function(){},e.prototype.clearCacheFor=function(e){},e.prototype.getModuleId=function(e){},e}(),Jr=function(){return function(){}}();function $r(){var e=Le.wtf;return!(!e||!(Wr=e.trace)||(Xr=Wr.events,0))}var eo=$r();function to(e,t){return null}var no=eo?function(e,t){return void 0===t&&(t=null),Xr.createScope(e,t)}:function(e,t){return to},io=eo?function(e,t){return Wr.leaveScope(e,t),t}:function(e,t){return t},ro=function(){return Promise.resolve(0)}();function oo(e){"undefined"==typeof Zone?ro.then(function(){e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var ao=function(){function e(e){var t,n=e.enableLongStackTrace,i=void 0!==n&&n;if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Or(!1),this.onMicrotaskEmpty=new Or(!1),this.onStable=new Or(!1),this.onError=new Or(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(t=this)._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,n,i,r,o,a){try{return uo(t),e.invokeTask(i,r,o,a)}finally{ho(t)}},onInvoke:function(e,n,i,r,o,a,s){try{return uo(t),e.invoke(i,r,o,a,s)}finally{ho(t)}},onHasTask:function(e,n,i,r){e.hasTask(i,r),n===i&&("microTask"==r.change?(t.hasPendingMicrotasks=r.microTask,co(t)):"macroTask"==r.change&&(t.hasPendingMacrotasks=r.macroTask))},onHandleError:function(e,n,i,r){return e.handleError(i,r),t.runOutsideAngular(function(){return t.onError.emit(r)}),!1}})}return e.isInAngularZone=function(){return!0===Zone.current.get("isAngularZone")},e.assertInAngularZone=function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")},e.assertNotInAngularZone=function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")},e.prototype.run=function(e,t,n){return this._inner.run(e,t,n)},e.prototype.runTask=function(e,t,n,i){var r=this._inner,o=r.scheduleEventTask("NgZoneEvent: "+i,e,lo,so,so);try{return r.runTask(o,t,n)}finally{r.cancelTask(o)}},e.prototype.runGuarded=function(e,t,n){return this._inner.runGuarded(e,t,n)},e.prototype.runOutsideAngular=function(e){return this._outer.run(e)},e}();function so(){}var lo={};function co(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(function(){return e.onStable.emit(null)})}finally{e.isStable=!0}}}function uo(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ho(e){e._nesting--,co(e)}var fo,po=function(){function e(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Or,this.onMicrotaskEmpty=new Or,this.onStable=new Or,this.onError=new Or}return e.prototype.run=function(e){return e()},e.prototype.runGuarded=function(e){return e()},e.prototype.runOutsideAngular=function(e){return e()},e.prototype.runTask=function(e){return e()},e}(),go=function(){function e(e){var t=this;this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(function(){t.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return e.prototype._watchAngularEvents=function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){e._ngZone.onStable.subscribe({next:function(){ao.assertNotInAngularZone(),oo(function(){e._isZoneStable=!0,e._runCallbacksIfReady()})}})})},e.prototype.increasePendingRequestCount=function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount},e.prototype.decreasePendingRequestCount=function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount},e.prototype.isStable=function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks},e.prototype._runCallbacksIfReady=function(){var e=this;if(this.isStable())oo(function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1});else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)}),this._didWork=!0}},e.prototype.getPendingTasks=function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}}):[]},e.prototype.addCallback=function(e,t,n){var i=this,r=-1;t&&t>0&&(r=setTimeout(function(){i._callbacks=i._callbacks.filter(function(e){return e.timeoutId!==r}),e(i._didWork,i.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})},e.prototype.whenStable=function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()},e.prototype.getPendingRequestCount=function(){return this._pendingCount},e.prototype.findProviders=function(e,t,n){return[]},e}(),mo=function(){function e(){this._applications=new Map,_o.addToWindow(this)}return e.prototype.registerApplication=function(e,t){this._applications.set(e,t)},e.prototype.unregisterApplication=function(e){this._applications.delete(e)},e.prototype.unregisterAllApplications=function(){this._applications.clear()},e.prototype.getTestability=function(e){return this._applications.get(e)||null},e.prototype.getAllTestabilities=function(){return Array.from(this._applications.values())},e.prototype.getAllRootElements=function(){return Array.from(this._applications.keys())},e.prototype.findTestabilityInTree=function(e,t){return void 0===t&&(t=!0),_o.findTestabilityInTree(this,e,t)},a([s("design:paramtypes",[])],e)}(),_o=new(function(){function e(){}return e.prototype.addToWindow=function(e){},e.prototype.findTestabilityInTree=function(e,t,n){return null},e}()),vo=new Be("AllowMultipleToken"),bo=function(){return function(e,t){this.name=e,this.token=t}}();function yo(e,t,n){void 0===n&&(n=[]);var i="Platform: "+t,r=new Be(i);return function(t){void 0===t&&(t=[]);var o=To();if(!o||o.injector.get(vo,!1))if(e)e(n.concat(t).concat({provide:r,useValue:!0}));else{var a=n.concat(t).concat({provide:r,useValue:!0});!function(e){if(fo&&!fo.destroyed&&!fo.injector.get(vo,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");fo=e.get(Eo);var t=e.get(Vr,null);t&&t.forEach(function(e){return e()})}(je.create({providers:a,name:i}))}return function(e){var t=To();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(r)}}function To(){return fo&&!fo.destroyed?fo:null}var Eo=function(){function e(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return e.prototype.bootstrapModuleFactory=function(e,t){var n,i=this,r="noop"===(n=t?t.ngZone:void 0)?new po:("zone.js"===n?void 0:n)||new ao({enableLongStackTrace:ft()}),o=[{provide:ao,useValue:r}];return r.run(function(){var t=je.create({providers:o,parent:i.injector,name:e.moduleType.name}),n=e.create(t),a=n.injector.get(ut,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy(function(){return So(i._modules,n)}),r.runOutsideAngular(function(){return r.onError.subscribe({next:function(e){a.handleError(e)}})}),function(e,t,r){try{var o=((a=n.injector.get(Nr)).runInitializers(),a.donePromise.then(function(){return i._moduleDoBootstrap(n),n}));return Gt(o)?o.catch(function(n){throw t.runOutsideAngular(function(){return e.handleError(n)}),n}):o}catch(s){throw t.runOutsideAngular(function(){return e.handleError(s)}),s}var a}(a,r)})},e.prototype.bootstrapModule=function(e,t){var n=this;void 0===t&&(t=[]);var i=xo({},t);return function(e,t,n){return e.get(Jr).createCompiler([t]).compileModuleAsync(n)}(this.injector,i,e).then(function(e){return n.bootstrapModuleFactory(e,i)})},e.prototype._moduleDoBootstrap=function(e){var t=e.injector.get(Co);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(function(e){return t.bootstrap(e)});else{if(!e.instance.ngDoBootstrap)throw new Error("The module "+Re(e.instance.constructor)+' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.');e.instance.ngDoBootstrap(t)}this._modules.push(e)},e.prototype.onDestroy=function(e){this._destroyListeners.push(e)},Object.defineProperty(e.prototype,"injector",{get:function(){return this._injector},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(e){return e.destroy()}),this._destroyListeners.forEach(function(e){return e()}),this._destroyed=!0},Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),e}();function xo(e,t){return Array.isArray(t)?t.reduce(xo,e):o({},e,t)}var Co=function(){function e(e,t,n,i,r,o){var a=this;this._zone=e,this._console=t,this._injector=n,this._exceptionHandler=i,this._componentFactoryResolver=r,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=ft(),this._zone.onMicrotaskEmpty.subscribe({next:function(){a._zone.run(function(){a.tick()})}});var s=new M(function(e){a._stable=a._zone.isStable&&!a._zone.hasPendingMacrotasks&&!a._zone.hasPendingMicrotasks,a._zone.runOutsideAngular(function(){e.next(a._stable),e.complete()})}),l=new M(function(e){var t;a._zone.runOutsideAngular(function(){t=a._zone.onStable.subscribe(function(){ao.assertNotInAngularZone(),oo(function(){a._stable||a._zone.hasPendingMacrotasks||a._zone.hasPendingMicrotasks||(a._stable=!0,e.next(!0))})})});var n=a._zone.onUnstable.subscribe(function(){ao.assertInAngularZone(),a._stable&&(a._stable=!1,a._zone.runOutsideAngular(function(){e.next(!1)}))});return function(){t.unsubscribe(),n.unsubscribe()}});this.isStable=ae(s,l.pipe(function(e){return se()((t=fe,function(e){var n;n="function"==typeof t?t:function(){return t};var i=Object.create(e,he);return i.source=e,i.subjectFactory=n,i})(e));var t}))}var t;return t=e,e.prototype.bootstrap=function(e,t){var n,i=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof $t?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var r=n instanceof an?null:this._injector.get(sn),o=n.create(je.NULL,[],t||n.selector,r);o.onDestroy(function(){i._unloadComponent(o)});var a=o.injector.get(go,null);return a&&o.injector.get(mo).registerApplication(o.location.nativeElement,a),this._loadComponent(o),ft()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),o},e.prototype.tick=function(){var e,n,i,r,o=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var a=t._tickScope();try{this._runningTick=!0;try{for(var s=l(this._views),c=s.next();!c.done;c=s.next())c.value.detectChanges()}catch(d){e={error:d}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}if(this._enforceNoNewChanges)try{for(var u=l(this._views),h=u.next();!h.done;h=u.next())h.value.checkNoChanges()}catch(f){i={error:f}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(i)throw i.error}}}catch(p){this._zone.runOutsideAngular(function(){return o._exceptionHandler.handleError(p)})}finally{this._runningTick=!1,io(a)}},e.prototype.attachView=function(e){var t=e;this._views.push(t),t.attachToAppRef(this)},e.prototype.detachView=function(e){var t=e;So(this._views,t),t.detachFromAppRef()},e.prototype._loadComponent=function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(zr,[]).concat(this._bootstrapListeners).forEach(function(t){return t(e)})},e.prototype._unloadComponent=function(e){this.detachView(e.hostView),So(this.components,e)},e.prototype.ngOnDestroy=function(){this._views.slice().forEach(function(e){return e.destroy()})},Object.defineProperty(e.prototype,"viewCount",{get:function(){return this._views.length},enumerable:!0,configurable:!0}),e._tickScope=no("ApplicationRef#tick()"),e}();function So(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var Ao=function(){return function(){}}(),Po={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Ro=function(){function e(e,t){this._compiler=e,this._config=t||Po}return e.prototype.load=function(e){return this._compiler instanceof Zr?this.loadFactory(e):this.loadAndCompile(e)},e.prototype.loadAndCompile=function(e){var t=this,i=c(e.split("#"),2),r=i[0],o=i[1];return void 0===o&&(o="default"),n("zn8P")(r).then(function(e){return e[o]}).then(function(e){return Mo(e,r,o)}).then(function(e){return t._compiler.compileModuleAsync(e)})},e.prototype.loadFactory=function(e){var t=c(e.split("#"),2),i=t[0],r=t[1],o="NgFactory";return void 0===r&&(r="default",o=""),n("zn8P")(this._config.factoryPathPrefix+i+this._config.factoryPathSuffix).then(function(e){return e[r+o]}).then(function(e){return Mo(e,i,r)})},e}();function Mo(e,t,n){if(!e)throw new Error("Cannot find '"+n+"' in '"+t+"'");return e}var Oo=function(){return function(e,t){this.name=e,this.callback=t}}(),wo=function(){function e(e,t,n){this.listeners=[],this.parent=null,this._debugContext=n,this.nativeNode=e,t&&t instanceof Io&&t.addChild(this)}return Object.defineProperty(e.prototype,"injector",{get:function(){return this._debugContext.injector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentInstance",{get:function(){return this._debugContext.component},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._debugContext.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"references",{get:function(){return this._debugContext.references},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"providerTokens",{get:function(){return this._debugContext.providerTokens},enumerable:!0,configurable:!0}),e}(),Io=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.properties={},r.attributes={},r.classes={},r.styles={},r.childNodes=[],r.nativeElement=t,r}return r(t,e),t.prototype.addChild=function(e){e&&(this.childNodes.push(e),e.parent=this)},t.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))},t.prototype.insertChildrenAfter=function(e,t){var n,i=this,r=this.childNodes.indexOf(e);-1!==r&&((n=this.childNodes).splice.apply(n,u([r+1,0],t)),t.forEach(function(t){t.parent&&t.parent.removeChild(t),e.parent=i}))},t.prototype.insertBefore=function(e,t){var n=this.childNodes.indexOf(e);-1===n?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(n,0,t))},t.prototype.query=function(e){return this.queryAll(e)[0]||null},t.prototype.queryAll=function(e){var t=[];return function e(t,n,i){t.childNodes.forEach(function(t){t instanceof Io&&(n(t)&&i.push(t),e(t,n,i))})}(this,e,t),t},t.prototype.queryAllNodes=function(e){var t=[];return function e(t,n,i){t instanceof Io&&t.childNodes.forEach(function(t){n(t)&&i.push(t),t instanceof Io&&e(t,n,i)})}(this,e,t),t},Object.defineProperty(t.prototype,"children",{get:function(){return this.childNodes.filter(function(e){return e instanceof t})},enumerable:!0,configurable:!0}),t.prototype.triggerEventHandler=function(e,t){this.listeners.forEach(function(n){n.name==e&&n.callback(t)})},t}(wo),Do=new Map,Lo=function(e){return Do.get(e)||null};function ko(e){Do.set(e.nativeNode,e)}var No=yo(null,"core",[{provide:Gr,useValue:"unknown"},{provide:Eo,deps:[je]},{provide:mo,deps:[]},{provide:jr,deps:[]}]),Fo=new Be("LocaleId");function Bo(){return Dn}function Uo(){return Ln}function Vo(e){return e||"en-US"}function Go(e){var t=[];return e.onStable.subscribe(function(){for(;t.length;)t.pop()()}),function(e){t.push(e)}}var zo=function(){return function(e){}}();function jo(e,t,n,i,r,o){e|=1;var a=gi(t);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:e,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:a.matchedQueries,matchedQueryIds:a.matchedQueryIds,references:a.references,ngContentIndex:n,childCount:i,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?bi(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:r||qn},provider:null,text:null,query:null,ngContent:null}}function Ho(e,t,n,i,r,o,a,s,l,u,h,d){var f;void 0===a&&(a=[]),u||(u=qn);var p=gi(n),g=p.matchedQueries,m=p.references,_=p.matchedQueryIds,v=null,b=null;o&&(v=(f=c(Ai(o),2))[0],b=f[1]),s=s||[];for(var y=new Array(s.length),T=0;T<s.length;T++){var E=c(s[T],3),x=E[0],C=E[2],S=c(Ai(E[1]),2),A=S[0],P=S[1],R=void 0,M=void 0;switch(15&x){case 4:M=C;break;case 1:case 8:R=C}y[T]={flags:x,ns:A,name:P,nonMinifiedName:P,securityContext:R,suffix:M}}l=l||[];var O=new Array(l.length);for(T=0;T<l.length;T++){var w=c(l[T],2);O[T]={type:0,target:w[0],eventName:w[1],propName:null}}var I=(a=a||[]).map(function(e){var t=c(e,2),n=t[1],i=c(Ai(t[0]),2);return[i[0],i[1],n]});return d=function(e){if(e&&e.id===$n){var t=null!=e.encapsulation&&e.encapsulation!==ot.None||e.styles.length||Object.keys(e.data).length;e.id=t?"c"+ni++:ei}return e&&e.id===ei&&(e=null),e||null}(d),h&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:g,matchedQueryIds:_,references:m,ngContentIndex:i,childCount:r,bindings:y,bindingFlags:Pi(y),outputs:O,element:{ns:v,name:b,attrs:I,template:null,componentProvider:null,componentView:h||null,componentRendererType:d,publicProviders:null,allProviders:null,handleEvent:u||qn},provider:null,text:null,query:null,ngContent:null}}function Wo(e,t,n){var i,r=n.element,o=e.root.selectorOrNode,a=e.renderer;if(e.parent||!o){i=r.name?a.createElement(r.name,r.ns):a.createComment("");var s=_i(e,t,n);s&&a.appendChild(s,i)}else i=a.selectRootElement(o,!!r.componentRendererType&&r.componentRendererType.encapsulation===ot.ShadowDom);if(r.attrs)for(var l=0;l<r.attrs.length;l++){var u=c(r.attrs[l],3);a.setAttribute(i,u[1],u[2],u[0])}return i}function Xo(e,t,n,i){for(var r=0;r<n.outputs.length;r++){var o=n.outputs[r],a=Yo(e,n.nodeIndex,(h=o.eventName,(u=o.target)?u+":"+h:h)),s=o.target,l=e;"component"===o.target&&(s=null,l=t);var c=l.renderer.listen(s||i,o.eventName,a);e.disposables[n.outputIndex+r]=c}var u,h}function Yo(e,t,n){return function(i){return li(e,t,n,i)}}function Ko(e,t,n,i){if(!ri(e,t,n,i))return!1;var r=t.bindings[n],o=Wn(e,t.nodeIndex),a=o.renderElement,s=r.name;switch(15&r.flags){case 1:!function(e,t,n,i,r,o){var a=t.securityContext,s=a?e.root.sanitizer.sanitize(a,o):o;s=null!=s?s.toString():null;var l=e.renderer;null!=o?l.setAttribute(n,r,s,i):l.removeAttribute(n,r,i)}(e,r,a,r.ns,s,i);break;case 2:!function(e,t,n,i){var r=e.renderer;i?r.addClass(t,n):r.removeClass(t,n)}(e,a,s,i);break;case 4:!function(e,t,n,i,r){var o=e.root.sanitizer.sanitize(kt.STYLE,r);if(null!=o){o=o.toString();var a=t.suffix;null!=a&&(o+=a)}else o=null;var s=e.renderer;null!=o?s.setStyle(n,i,o):s.removeStyle(n,i)}(e,r,a,s,i);break;case 8:!function(e,t,n,i,r){var o=t.securityContext,a=o?e.root.sanitizer.sanitize(o,r):r;e.renderer.setProperty(n,i,a)}(33554432&t.flags&&32&r.flags?o.componentView:e,r,a,s,i)}return!0}function Qo(e,t,n){var i=[];for(var r in n)i.push({propName:r,bindingType:n[r]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:t,filterId:pi(t),bindings:i},ngContent:null}}function qo(e){for(var t=e.def.nodeMatchedQueries;e.parent&&fi(e);){var n=e.parentNodeDef;e=e.parent;for(var i=n.nodeIndex+n.childCount,r=0;r<=i;r++)67108864&(o=e.def.nodes[r]).flags&&536870912&o.flags&&(o.query.filterId&t)===o.query.filterId&&Kn(e,r).setDirty(),!(1&o.flags&&r+o.childCount<n.nodeIndex)&&67108864&o.childFlags&&536870912&o.childFlags||(r+=o.childCount)}if(134217728&e.def.nodeFlags)for(r=0;r<e.def.nodes.length;r++){var o;134217728&(o=e.def.nodes[r]).flags&&536870912&o.flags&&Kn(e,r).setDirty(),r+=o.childCount}}function Zo(e,t){var n=Kn(e,t.nodeIndex);if(n.dirty){var i,r=void 0;if(67108864&t.flags){var o=t.parent.parent;r=Jo(e,o.nodeIndex,o.nodeIndex+o.childCount,t.query,[]),i=Xn(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(r=Jo(e,0,e.def.nodes.length-1,t.query,[]),i=e.component);n.reset(r);for(var a=t.query.bindings,s=!1,l=0;l<a.length;l++){var c=a[l],u=void 0;switch(c.bindingType){case 0:u=n.first;break;case 1:u=n,s=!0}i[c.propName]=u}s&&n.notifyOnChanges()}}function Jo(e,t,n,i,r){for(var o=t;o<=n;o++){var a=e.def.nodes[o],s=a.matchedQueries[i.id];if(null!=s&&r.push($o(e,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&i.filterId)===i.filterId){var l=Wn(e,o);if((a.childMatchedQueries&i.filterId)===i.filterId&&(Jo(e,o+1,o+a.childCount,i,r),o+=a.childCount),16777216&a.flags)for(var c=l.viewContainer._embeddedViews,u=0;u<c.length;u++){var h=c[u],d=ci(h);d&&d===l&&Jo(h,0,h.def.nodes.length-1,i,r)}var f=l.template._projectedViews;if(f)for(u=0;u<f.length;u++){var p=f[u];Jo(p,0,p.def.nodes.length-1,i,r)}}(a.childMatchedQueries&i.filterId)!==i.filterId&&(o+=a.childCount)}return r}function $o(e,t,n){if(null!=n)switch(n){case 1:return Wn(e,t.nodeIndex).renderElement;case 0:return new un(Wn(e,t.nodeIndex).renderElement);case 2:return Wn(e,t.nodeIndex).template;case 3:return Wn(e,t.nodeIndex).viewContainer;case 4:return Xn(e,t.nodeIndex).instance}}function ea(e,t){return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:8,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:null,ngContent:{index:t}}}function ta(e,t,n){var i=_i(e,t,n);i&&Ei(e,n.ngContent.index,1,i,null,void 0)}function na(e,t){return ra(32,e,new Array(t))}function ia(e,t){for(var n=Object.keys(t),i=n.length,r=new Array(i),o=0;o<i;o++){var a=n[o];r[t[a]]=a}return ra(64,e,r)}function ra(e,t,n){for(var i=new Array(n.length),r=0;r<n.length;r++){var o=n[r];i[r]={flags:8,name:o,ns:null,nonMinifiedName:o,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:i,bindingFlags:Pi(i),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}function oa(e,t,n){for(var i=new Array(n.length-1),r=1;r<n.length;r++)i[r-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[r]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:i,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function aa(e,t,n){var i,r=e.renderer;i=r.createText(n.text.prefix);var o=_i(e,t,n);return o&&r.appendChild(o,i),{renderText:i}}function sa(e,t){return(null!=e?e.toString():"")+t.suffix}function la(e,t,n,i){for(var r=0,o=0,a=0,s=0,l=0,c=null,u=null,h=!1,d=!1,f=null,p=0;p<t.length;p++){var g=t[p];if(g.nodeIndex=p,g.parent=c,g.bindingIndex=r,g.outputIndex=o,g.renderParent=u,a|=g.flags,l|=g.matchedQueryIds,g.element){var m=g.element;m.publicProviders=c?c.element.publicProviders:Object.create(null),m.allProviders=m.publicProviders,h=!1,d=!1,g.element.template&&(l|=g.element.template.nodeMatchedQueries)}if(ua(c,g,t.length),r+=g.bindings.length,o+=g.outputs.length,!u&&3&g.flags&&(f=g),20224&g.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);var _=0!=(32768&g.flags);0==(8192&g.flags)||_?c.element.publicProviders[Jn(g.provider.token)]=g:(d||(d=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Jn(g.provider.token)]=g),_&&(c.element.componentProvider=g)}if(c?(c.childFlags|=g.flags,c.directChildFlags|=g.flags,c.childMatchedQueries|=g.matchedQueryIds,g.element&&g.element.template&&(c.childMatchedQueries|=g.element.template.nodeMatchedQueries)):s|=g.flags,g.childCount>0)c=g,ca(g)||(u=g);else for(;c&&p===c.nodeIndex+c.childCount;){var v=c.parent;v&&(v.childFlags|=c.childFlags,v.childMatchedQueries|=c.childMatchedQueries),u=(c=v)&&ca(c)?c.renderParent:c}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:l,flags:e,nodes:t,updateDirectives:n||qn,updateRenderer:i||qn,handleEvent:function(e,n,i,r){return t[n].element.handleEvent(e,i,r)},bindingCount:r,outputCount:o,lastRenderRootNode:f}}function ca(e){return 0!=(1&e.flags)&&null===e.element.name}function ua(e,t,n){var i=t.element&&t.element.template;if(i){if(!i.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(i.lastRenderRootNode&&16777216&i.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index "+t.nodeIndex+"!")}if(20224&t.flags&&0==(1&(e?e.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index "+t.nodeIndex+"!");if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index "+t.nodeIndex+"!");if(134217728&t.flags&&e)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index "+t.nodeIndex+"!")}if(t.childCount){var r=e?e.nodeIndex+e.childCount:n-1;if(t.nodeIndex<=r&&t.nodeIndex+t.childCount>r)throw new Error("Illegal State: childCount of node leads outside of parent, at index "+t.nodeIndex+"!")}}function ha(e,t,n,i){var r=pa(e.root,e.renderer,e,t,n);return ga(r,e.component,i),ma(r),r}function da(e,t,n){var i=pa(e,e.renderer,null,null,t);return ga(i,n,n),ma(i),i}function fa(e,t,n,i){var r,o=t.element.componentRendererType;return r=o?e.root.rendererFactory.createRenderer(i,o):e.root.renderer,pa(e.root,r,e,t.element.componentProvider,n)}function pa(e,t,n,i,r){var o=new Array(r.nodes.length),a=r.outputCount?new Array(r.outputCount):null;return{def:r,parent:n,viewContainerParent:null,parentNodeDef:i,context:null,component:null,nodes:o,state:13,root:e,renderer:t,oldValues:new Array(r.bindingCount),disposables:a,initIndex:-1}}function ga(e,t,n){e.component=t,e.context=n}function ma(e){var t;di(e)&&(t=Wn(e.parent,e.parentNodeDef.parent.nodeIndex).renderElement);for(var n=e.def,i=e.nodes,r=0;r<n.nodes.length;r++){var o=n.nodes[r];Qn.setCurrentNode(e,r);var a=void 0;switch(201347067&o.flags){case 1:var s=Wo(e,t,o),l=void 0;if(33554432&o.flags){var c=bi(o.element.componentView);l=Qn.createComponentView(e,o,c,s)}Xo(e,l,o,s),a={renderElement:s,componentView:l,viewContainer:null,template:o.element.template?qi(e,o):void 0},16777216&o.flags&&(a.viewContainer=Xi(e,o,a));break;case 2:a=aa(e,t,o);break;case 512:case 1024:case 2048:case 256:(a=i[r])||4096&o.flags||(a={instance:mr(e,o)});break;case 16:a={instance:_r(e,o)};break;case 16384:(a=i[r])||(a={instance:vr(e,o)}),32768&o.flags&&ga(Wn(e,o.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new wr;break;case 8:ta(e,t,o),a=void 0}i[r]=a}Sa(e,Ca.CreateViewNodes),Ma(e,201326592,268435456,0)}function _a(e){ya(e),Qn.updateDirectives(e,1),Aa(e,Ca.CheckNoChanges),Qn.updateRenderer(e,1),Sa(e,Ca.CheckNoChanges),e.state&=-97}function va(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,zn(e,0,256),ya(e),Qn.updateDirectives(e,0),Aa(e,Ca.CheckAndUpdate),Ma(e,67108864,536870912,0);var t=zn(e,256,512);Ar(e,2097152|(t?1048576:0)),Qn.updateRenderer(e,0),Sa(e,Ca.CheckAndUpdate),Ma(e,134217728,536870912,0),Ar(e,8388608|((t=zn(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,zn(e,768,1024)}function ba(e,t,n,i,r,o,a,s,l,c,h,d,f){return 0===n?function(e,t,n,i,r,o,a,s,l,c,u,h){switch(201347067&t.flags){case 1:return function(e,t,n,i,r,o,a,s,l,c,u,h){var d=t.bindings.length,f=!1;return d>0&&Ko(e,t,0,n)&&(f=!0),d>1&&Ko(e,t,1,i)&&(f=!0),d>2&&Ko(e,t,2,r)&&(f=!0),d>3&&Ko(e,t,3,o)&&(f=!0),d>4&&Ko(e,t,4,a)&&(f=!0),d>5&&Ko(e,t,5,s)&&(f=!0),d>6&&Ko(e,t,6,l)&&(f=!0),d>7&&Ko(e,t,7,c)&&(f=!0),d>8&&Ko(e,t,8,u)&&(f=!0),d>9&&Ko(e,t,9,h)&&(f=!0),f}(e,t,n,i,r,o,a,s,l,c,u,h);case 2:return function(e,t,n,i,r,o,a,s,l,c,u,h){var d=!1,f=t.bindings,p=f.length;if(p>0&&ri(e,t,0,n)&&(d=!0),p>1&&ri(e,t,1,i)&&(d=!0),p>2&&ri(e,t,2,r)&&(d=!0),p>3&&ri(e,t,3,o)&&(d=!0),p>4&&ri(e,t,4,a)&&(d=!0),p>5&&ri(e,t,5,s)&&(d=!0),p>6&&ri(e,t,6,l)&&(d=!0),p>7&&ri(e,t,7,c)&&(d=!0),p>8&&ri(e,t,8,u)&&(d=!0),p>9&&ri(e,t,9,h)&&(d=!0),d){var g=t.text.prefix;p>0&&(g+=sa(n,f[0])),p>1&&(g+=sa(i,f[1])),p>2&&(g+=sa(r,f[2])),p>3&&(g+=sa(o,f[3])),p>4&&(g+=sa(a,f[4])),p>5&&(g+=sa(s,f[5])),p>6&&(g+=sa(l,f[6])),p>7&&(g+=sa(c,f[7])),p>8&&(g+=sa(u,f[8])),p>9&&(g+=sa(h,f[9]));var m=Hn(e,t.nodeIndex).renderText;e.renderer.setValue(m,g)}return d}(e,t,n,i,r,o,a,s,l,c,u,h);case 16384:return function(e,t,n,i,r,o,a,s,l,c,u,h){var d=Xn(e,t.nodeIndex),f=d.instance,p=!1,g=void 0,m=t.bindings.length;return m>0&&ii(e,t,0,n)&&(p=!0,g=Sr(e,d,t,0,n,g)),m>1&&ii(e,t,1,i)&&(p=!0,g=Sr(e,d,t,1,i,g)),m>2&&ii(e,t,2,r)&&(p=!0,g=Sr(e,d,t,2,r,g)),m>3&&ii(e,t,3,o)&&(p=!0,g=Sr(e,d,t,3,o,g)),m>4&&ii(e,t,4,a)&&(p=!0,g=Sr(e,d,t,4,a,g)),m>5&&ii(e,t,5,s)&&(p=!0,g=Sr(e,d,t,5,s,g)),m>6&&ii(e,t,6,l)&&(p=!0,g=Sr(e,d,t,6,l,g)),m>7&&ii(e,t,7,c)&&(p=!0,g=Sr(e,d,t,7,c,g)),m>8&&ii(e,t,8,u)&&(p=!0,g=Sr(e,d,t,8,u,g)),m>9&&ii(e,t,9,h)&&(p=!0,g=Sr(e,d,t,9,h,g)),g&&f.ngOnChanges(g),65536&t.flags&&jn(e,256,t.nodeIndex)&&f.ngOnInit(),262144&t.flags&&f.ngDoCheck(),p}(e,t,n,i,r,o,a,s,l,c,u,h);case 32:case 64:case 128:return function(e,t,n,i,r,o,a,s,l,c,u,h){var d=t.bindings,f=!1,p=d.length;if(p>0&&ri(e,t,0,n)&&(f=!0),p>1&&ri(e,t,1,i)&&(f=!0),p>2&&ri(e,t,2,r)&&(f=!0),p>3&&ri(e,t,3,o)&&(f=!0),p>4&&ri(e,t,4,a)&&(f=!0),p>5&&ri(e,t,5,s)&&(f=!0),p>6&&ri(e,t,6,l)&&(f=!0),p>7&&ri(e,t,7,c)&&(f=!0),p>8&&ri(e,t,8,u)&&(f=!0),p>9&&ri(e,t,9,h)&&(f=!0),f){var g=Yn(e,t.nodeIndex),m=void 0;switch(201347067&t.flags){case 32:m=new Array(d.length),p>0&&(m[0]=n),p>1&&(m[1]=i),p>2&&(m[2]=r),p>3&&(m[3]=o),p>4&&(m[4]=a),p>5&&(m[5]=s),p>6&&(m[6]=l),p>7&&(m[7]=c),p>8&&(m[8]=u),p>9&&(m[9]=h);break;case 64:m={},p>0&&(m[d[0].name]=n),p>1&&(m[d[1].name]=i),p>2&&(m[d[2].name]=r),p>3&&(m[d[3].name]=o),p>4&&(m[d[4].name]=a),p>5&&(m[d[5].name]=s),p>6&&(m[d[6].name]=l),p>7&&(m[d[7].name]=c),p>8&&(m[d[8].name]=u),p>9&&(m[d[9].name]=h);break;case 128:var _=n;switch(p){case 1:m=_.transform(n);break;case 2:m=_.transform(i);break;case 3:m=_.transform(i,r);break;case 4:m=_.transform(i,r,o);break;case 5:m=_.transform(i,r,o,a);break;case 6:m=_.transform(i,r,o,a,s);break;case 7:m=_.transform(i,r,o,a,s,l);break;case 8:m=_.transform(i,r,o,a,s,l,c);break;case 9:m=_.transform(i,r,o,a,s,l,c,u);break;case 10:m=_.transform(i,r,o,a,s,l,c,u,h)}}g.value=m}return f}(e,t,n,i,r,o,a,s,l,c,u,h);default:throw"unreachable"}}(e,t,i,r,o,a,s,l,c,h,d,f):function(e,t,n){switch(201347067&t.flags){case 1:return function(e,t,n){for(var i=!1,r=0;r<n.length;r++)Ko(e,t,r,n[r])&&(i=!0);return i}(e,t,n);case 2:return function(e,t,n){for(var i=t.bindings,r=!1,o=0;o<n.length;o++)ri(e,t,o,n[o])&&(r=!0);if(r){var a="";for(o=0;o<n.length;o++)a+=sa(n[o],i[o]);a=t.text.prefix+a;var s=Hn(e,t.nodeIndex).renderText;e.renderer.setValue(s,a)}return r}(e,t,n);case 16384:return function(e,t,n){for(var i=Xn(e,t.nodeIndex),r=i.instance,o=!1,a=void 0,s=0;s<n.length;s++)ii(e,t,s,n[s])&&(o=!0,a=Sr(e,i,t,s,n[s],a));return a&&r.ngOnChanges(a),65536&t.flags&&jn(e,256,t.nodeIndex)&&r.ngOnInit(),262144&t.flags&&r.ngDoCheck(),o}(e,t,n);case 32:case 64:case 128:return function(e,t,n){for(var i=t.bindings,r=!1,o=0;o<n.length;o++)ri(e,t,o,n[o])&&(r=!0);if(r){var a=Yn(e,t.nodeIndex),s=void 0;switch(201347067&t.flags){case 32:s=n;break;case 64:for(s={},o=0;o<n.length;o++)s[i[o].name]=n[o];break;case 128:var l=n[0],c=n.slice(1);s=l.transform.apply(l,u(c))}a.value=s}return r}(e,t,n);default:throw"unreachable"}}(e,t,i)}function ya(e){var t=e.def;if(4&t.nodeFlags)for(var n=0;n<t.nodes.length;n++){var i=t.nodes[n];if(4&i.flags){var r=Wn(e,n).template._projectedViews;if(r)for(var o=0;o<r.length;o++){var a=r[o];a.state|=32,si(a,e)}}else 0==(4&i.childFlags)&&(n+=i.childCount)}}function Ta(e,t,n,i,r,o,a,s,l,c,u,h,d){return 0===n?function(e,t,n,i,r,o,a,s,l,c,u,h){var d=t.bindings.length;d>0&&oi(e,t,0,n),d>1&&oi(e,t,1,i),d>2&&oi(e,t,2,r),d>3&&oi(e,t,3,o),d>4&&oi(e,t,4,a),d>5&&oi(e,t,5,s),d>6&&oi(e,t,6,l),d>7&&oi(e,t,7,c),d>8&&oi(e,t,8,u),d>9&&oi(e,t,9,h)}(e,t,i,r,o,a,s,l,c,u,h,d):function(e,t,n){for(var i=0;i<n.length;i++)oi(e,t,i,n[i])}(e,t,i),!1}function Ea(e,t){if(Kn(e,t.nodeIndex).dirty)throw Un(Qn.createDebugContext(e,t.nodeIndex),"Query "+t.query.id+" not dirty","Query "+t.query.id+" dirty",0!=(1&e.state))}function xa(e){if(!(128&e.state)){if(Aa(e,Ca.Destroy),Sa(e,Ca.Destroy),Ar(e,131072),e.disposables)for(var t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(16&e.state){var t=ci(e);if(t){var n=t.template._projectedViews;n&&(Gi(n,n.indexOf(e)),Qn.dirtyParentQueries(e))}}}(e),e.renderer.destroyNode&&function(e){for(var t=e.def.nodes.length,n=0;n<t;n++){var i=e.def.nodes[n];1&i.flags?e.renderer.destroyNode(Wn(e,n).renderElement):2&i.flags?e.renderer.destroyNode(Hn(e,n).renderText):(67108864&i.flags||134217728&i.flags)&&Kn(e,n).destroy()}}(e),di(e)&&e.renderer.destroy(),e.state|=128}}var Ca=function(e){return e[e.CreateViewNodes=0]="CreateViewNodes",e[e.CheckNoChanges=1]="CheckNoChanges",e[e.CheckNoChangesProjectedViews=2]="CheckNoChangesProjectedViews",e[e.CheckAndUpdate=3]="CheckAndUpdate",e[e.CheckAndUpdateProjectedViews=4]="CheckAndUpdateProjectedViews",e[e.Destroy=5]="Destroy",e}({});function Sa(e,t){var n=e.def;if(33554432&n.nodeFlags)for(var i=0;i<n.nodes.length;i++){var r=n.nodes[i];33554432&r.flags?Pa(Wn(e,i).componentView,t):0==(33554432&r.childFlags)&&(i+=r.childCount)}}function Aa(e,t){var n=e.def;if(16777216&n.nodeFlags)for(var i=0;i<n.nodes.length;i++){var r=n.nodes[i];if(16777216&r.flags)for(var o=Wn(e,i).viewContainer._embeddedViews,a=0;a<o.length;a++)Pa(o[a],t);else 0==(16777216&r.childFlags)&&(i+=r.childCount)}}function Pa(e,t){var n=e.state;switch(t){case Ca.CheckNoChanges:0==(128&n)&&(12==(12&n)?_a(e):64&n&&Ra(e,Ca.CheckNoChangesProjectedViews));break;case Ca.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?_a(e):64&n&&Ra(e,t));break;case Ca.CheckAndUpdate:0==(128&n)&&(12==(12&n)?va(e):64&n&&Ra(e,Ca.CheckAndUpdateProjectedViews));break;case Ca.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?va(e):64&n&&Ra(e,t));break;case Ca.Destroy:xa(e);break;case Ca.CreateViewNodes:ma(e)}}function Ra(e,t){Aa(e,t),Sa(e,t)}function Ma(e,t,n,i){if(e.def.nodeFlags&t&&e.def.nodeFlags&n)for(var r=e.def.nodes.length,o=0;o<r;o++){var a=e.def.nodes[o];if(a.flags&t&&a.flags&n)switch(Qn.setCurrentNode(e,a.nodeIndex),i){case 0:Zo(e,a);break;case 1:Ea(e,a)}a.childFlags&t&&a.childFlags&n||(o+=a.childCount)}}var Oa=!1;function wa(e,t,n,i,r,o){var a=r.injector.get(fn);return da(Da(e,r,a,t,n),i,o)}function Ia(e,t,n,i,r,o){var a=r.injector.get(fn),s=Da(e,r,new hs(a),t,n),l=ja(i);return cs(Ja.create,da,null,[s,l,o])}function Da(e,t,n,i,r){var o=t.injector.get(Nt),a=t.injector.get(ut),s=n.createRenderer(null,null);return{ngModule:t,injector:e,projectableNodes:i,selectorOrNode:r,sanitizer:o,rendererFactory:n,renderer:s,errorHandler:a}}function La(e,t,n,i){var r=ja(n);return cs(Ja.create,ha,null,[e,t,r,i])}function ka(e,t,n,i){return n=Ua.get(t.element.componentProvider.provider.token)||ja(n),cs(Ja.create,fa,null,[e,t,n,i])}function Na(e,t,n,i){return ir(e,t,n,function(e){var t=function(e){var t=!1,n=!1;return 0===Fa.size?{hasOverrides:t,hasDeprecatedOverrides:n}:(e.providers.forEach(function(e){var i=Fa.get(e.token);3840&e.flags&&i&&(t=!0,n=n||i.deprecatedBehavior)}),e.modules.forEach(function(e){Ba.forEach(function(i,r){Ae(r).providedIn===e&&(t=!0,n=n||i.deprecatedBehavior)})}),{hasOverrides:t,hasDeprecatedOverrides:n})}(e),n=t.hasDeprecatedOverrides;return t.hasOverrides?(function(e){for(var t=0;t<e.providers.length;t++){var i=e.providers[t];n&&(i.flags|=4096);var r=Fa.get(i.token);r&&(i.flags=-3841&i.flags|r.flags,i.deps=mi(r.deps),i.value=r.value)}if(Ba.size>0){var o=new Set(e.modules);Ba.forEach(function(t,i){if(o.has(Ae(i).providedIn)){var r={token:i,flags:t.flags|(n?4096:0),deps:mi(t.deps),value:t.value,index:e.providers.length};e.providers.push(r),e.providersByKey[Jn(i)]=r}})}}(e=e.factory(function(){return qn})),e):e}(i))}var Fa=new Map,Ba=new Map,Ua=new Map;function Va(e){var t;Fa.set(e.token,e),"function"==typeof e.token&&(t=Ae(e.token))&&"function"==typeof t.providedIn&&Ba.set(e.token,e)}function Ga(e,t){var n=bi(t.viewDefFactory),i=bi(n.nodes[0].element.componentView);Ua.set(e,i)}function za(){Fa.clear(),Ba.clear(),Ua.clear()}function ja(e){if(0===Fa.size)return e;var t=function(e){for(var t=[],n=null,i=0;i<e.nodes.length;i++){var r=e.nodes[i];1&r.flags&&(n=r),n&&3840&r.flags&&Fa.has(r.provider.token)&&(t.push(n.nodeIndex),n=null)}return t}(e);if(0===t.length)return e;e=e.factory(function(){return qn});for(var n=0;n<t.length;n++)i(e,t[n]);return e;function i(e,t){for(var n=t+1;n<e.nodes.length;n++){var i=e.nodes[n];if(1&i.flags)return;if(3840&i.flags){var r=i.provider,o=Fa.get(r.token);o&&(i.flags=-3841&i.flags|o.flags,r.deps=mi(o.deps),r.value=o.value)}}}}function Ha(e,t,n,i,r,o,a,s,l,c,u,h,d){var f=e.def.nodes[t];return ba(e,f,n,i,r,o,a,s,l,c,u,h,d),224&f.flags?Yn(e,t).value:void 0}function Wa(e,t,n,i,r,o,a,s,l,c,u,h,d){var f=e.def.nodes[t];return Ta(e,f,n,i,r,o,a,s,l,c,u,h,d),224&f.flags?Yn(e,t).value:void 0}function Xa(e){return cs(Ja.detectChanges,va,null,[e])}function Ya(e){return cs(Ja.checkNoChanges,_a,null,[e])}function Ka(e){return cs(Ja.destroy,xa,null,[e])}var Qa,qa,Za,Ja=function(e){return e[e.create=0]="create",e[e.detectChanges=1]="detectChanges",e[e.checkNoChanges=2]="checkNoChanges",e[e.destroy=3]="destroy",e[e.handleEvent=4]="handleEvent",e}({});function $a(e,t){qa=e,Za=t}function es(e,t,n,i){return $a(e,t),cs(Ja.handleEvent,e.def.handleEvent,null,[e,t,n,i])}function ts(e,t){if(128&e.state)throw Gn(Ja[Qa]);return $a(e,os(e,0)),e.def.updateDirectives(function(e,n,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var a=e.def.nodes[n];return 0===t?is(e,a,i,r):rs(e,a,i,r),16384&a.flags&&$a(e,os(e,n)),224&a.flags?Yn(e,a.nodeIndex).value:void 0},e)}function ns(e,t){if(128&e.state)throw Gn(Ja[Qa]);return $a(e,as(e,0)),e.def.updateRenderer(function(e,n,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var a=e.def.nodes[n];return 0===t?is(e,a,i,r):rs(e,a,i,r),3&a.flags&&$a(e,as(e,n)),224&a.flags?Yn(e,a.nodeIndex).value:void 0},e)}function is(e,t,n,i){if(ba.apply(void 0,u([e,t,n],i))){var r=1===n?i[0]:i;if(16384&t.flags){for(var o={},a=0;a<t.bindings.length;a++){var s=t.bindings[a],l=r[a];8&s.flags&&(o[(f=s.nonMinifiedName,"ng-reflect-"+f.replace(/[$@]/g,"_").replace(Ut,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"-"+e[1].toLowerCase()}))]=Vt(l))}var c=t.parent,h=Wn(e,c.nodeIndex).renderElement;if(c.element.name)for(var d in o)null!=(l=o[d])?e.renderer.setAttribute(h,d,l):e.renderer.removeAttribute(h,d);else e.renderer.setValue(h,"bindings="+JSON.stringify(o,null,2))}}var f}function rs(e,t,n,i){Ta.apply(void 0,u([e,t,n],i))}function os(e,t){for(var n=t;n<e.def.nodes.length;n++){var i=e.def.nodes[n];if(16384&i.flags&&i.bindings&&i.bindings.length)return n}return null}function as(e,t){for(var n=t;n<e.def.nodes.length;n++){var i=e.def.nodes[n];if(3&i.flags&&i.bindings&&i.bindings.length)return n}return null}var ss=function(){function e(e,t){this.view=e,this.nodeIndex=t,null==t&&(this.nodeIndex=t=0),this.nodeDef=e.def.nodes[t];for(var n=this.nodeDef,i=e;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&i;)n=ui(i),i=i.parent;this.elDef=n,this.elView=i}return Object.defineProperty(e.prototype,"elOrCompView",{get:function(){return Wn(this.elView,this.elDef.nodeIndex).componentView||this.view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"injector",{get:function(){return Ji(this.elView,this.elDef)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"component",{get:function(){return this.elOrCompView.component},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this.elOrCompView.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"providerTokens",{get:function(){var e=[];if(this.elDef)for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&e.push(n.provider.token),t+=n.childCount}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"references",{get:function(){var e={};if(this.elDef){ls(this.elView,this.elDef,e);for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&ls(this.elView,n,e),t+=n.childCount}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentRenderElement",{get:function(){var e=function(e){for(;e&&!di(e);)e=e.parent;return e.parent?Wn(e.parent,ui(e).nodeIndex):null}(this.elOrCompView);return e?e.renderElement:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderNode",{get:function(){return 2&this.nodeDef.flags?hi(this.view,this.nodeDef):hi(this.elView,this.elDef)},enumerable:!0,configurable:!0}),e.prototype.logError=function(e){for(var t,n,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];2&this.nodeDef.flags?(t=this.view.def,n=this.nodeDef.nodeIndex):(t=this.elView.def,n=this.elDef.nodeIndex);var o=function(e,t){for(var n=-1,i=0;i<=t;i++)3&e.nodes[i].flags&&n++;return n}(t,n),a=-1;t.factory(function(){var t;return++a===o?(t=e.error).bind.apply(t,u([e],i)):qn}),a<o&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error.apply(e,u(i)))},e}();function ls(e,t,n){for(var i in t.references)n[i]=$o(e,t,t.references[i])}function cs(e,t,n,i){var r=Qa,o=qa,a=Za;try{Qa=e;var s=t.apply(n,i);return qa=o,Za=a,Qa=r,s}catch(l){if(st(l)||!qa)throw l;throw function(e,t){return e instanceof Error||(e=new Error(e.toString())),Vn(e,t),e}(l,us())}}function us(){return qa?new ss(qa,Za):null}var hs=function(){function e(e){this.delegate=e}return e.prototype.createRenderer=function(e,t){return new ds(this.delegate.createRenderer(e,t))},e.prototype.begin=function(){this.delegate.begin&&this.delegate.begin()},e.prototype.end=function(){this.delegate.end&&this.delegate.end()},e.prototype.whenRenderingDone=function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)},e}(),ds=function(){function e(e){this.delegate=e,this.debugContextFactory=us,this.data=this.delegate.data}return e.prototype.createDebugContext=function(e){return this.debugContextFactory(e)},e.prototype.destroyNode=function(e){!function(e){Do.delete(e.nativeNode)}(Lo(e)),this.delegate.destroyNode&&this.delegate.destroyNode(e)},e.prototype.destroy=function(){this.delegate.destroy()},e.prototype.createElement=function(e,t){var n=this.delegate.createElement(e,t),i=this.createDebugContext(n);if(i){var r=new Io(n,null,i);r.name=e,ko(r)}return n},e.prototype.createComment=function(e){var t=this.delegate.createComment(e),n=this.createDebugContext(t);return n&&ko(new wo(t,null,n)),t},e.prototype.createText=function(e){var t=this.delegate.createText(e),n=this.createDebugContext(t);return n&&ko(new wo(t,null,n)),t},e.prototype.appendChild=function(e,t){var n=Lo(e),i=Lo(t);n&&i&&n instanceof Io&&n.addChild(i),this.delegate.appendChild(e,t)},e.prototype.insertBefore=function(e,t,n){var i=Lo(e),r=Lo(t),o=Lo(n);i&&r&&i instanceof Io&&i.insertBefore(o,r),this.delegate.insertBefore(e,t,n)},e.prototype.removeChild=function(e,t){var n=Lo(e),i=Lo(t);n&&i&&n instanceof Io&&n.removeChild(i),this.delegate.removeChild(e,t)},e.prototype.selectRootElement=function(e,t){var n=this.delegate.selectRootElement(e,t),i=us();return i&&ko(new Io(n,null,i)),n},e.prototype.setAttribute=function(e,t,n,i){var r=Lo(e);r&&r instanceof Io&&(r.attributes[i?i+":"+t:t]=n),this.delegate.setAttribute(e,t,n,i)},e.prototype.removeAttribute=function(e,t,n){var i=Lo(e);i&&i instanceof Io&&(i.attributes[n?n+":"+t:t]=null),this.delegate.removeAttribute(e,t,n)},e.prototype.addClass=function(e,t){var n=Lo(e);n&&n instanceof Io&&(n.classes[t]=!0),this.delegate.addClass(e,t)},e.prototype.removeClass=function(e,t){var n=Lo(e);n&&n instanceof Io&&(n.classes[t]=!1),this.delegate.removeClass(e,t)},e.prototype.setStyle=function(e,t,n,i){var r=Lo(e);r&&r instanceof Io&&(r.styles[t]=n),this.delegate.setStyle(e,t,n,i)},e.prototype.removeStyle=function(e,t,n){var i=Lo(e);i&&i instanceof Io&&(i.styles[t]=null),this.delegate.removeStyle(e,t,n)},e.prototype.setProperty=function(e,t,n){var i=Lo(e);i&&i instanceof Io&&(i.properties[t]=n),this.delegate.setProperty(e,t,n)},e.prototype.listen=function(e,t,n){if("string"!=typeof e){var i=Lo(e);i&&i.listeners.push(new Oo(t,n))}return this.delegate.listen(e,t,n)},e.prototype.parentNode=function(e){return this.delegate.parentNode(e)},e.prototype.nextSibling=function(e){return this.delegate.nextSibling(e)},e.prototype.setValue=function(e,t){return this.delegate.setValue(e,t)},e}();function fs(e,t,n){return new ps(e,t,n)}var ps=function(e){function t(t,n,i){var r=e.call(this)||this;return r.moduleType=t,r._bootstrapComponents=n,r._ngModuleDefFactory=i,r}return r(t,e),t.prototype.create=function(e){!function(){if(!Oa){Oa=!0;var e=ft()?{setCurrentNode:$a,createRootView:Ia,createEmbeddedView:La,createComponentView:ka,createNgModuleRef:Na,overrideProvider:Va,overrideComponentView:Ga,clearOverrides:za,checkAndUpdateView:Xa,checkNoChangesView:Ya,destroyView:Ka,createDebugContext:function(e,t){return new ss(e,t)},handleEvent:es,updateDirectives:ts,updateRenderer:ns}:{setCurrentNode:function(){},createRootView:wa,createEmbeddedView:ha,createComponentView:fa,createNgModuleRef:ir,overrideProvider:qn,overrideComponentView:qn,clearOverrides:qn,checkAndUpdateView:va,checkNoChangesView:_a,destroyView:xa,createDebugContext:function(e,t){return new ss(e,t)},handleEvent:function(e,t,n,i){return e.def.handleEvent(e,t,n,i)},updateDirectives:function(e,t){return e.def.updateDirectives(0===t?Ha:Wa,e)},updateRenderer:function(e,t){return e.def.updateRenderer(0===t?Ha:Wa,e)}};Qn.setCurrentNode=e.setCurrentNode,Qn.createRootView=e.createRootView,Qn.createEmbeddedView=e.createEmbeddedView,Qn.createComponentView=e.createComponentView,Qn.createNgModuleRef=e.createNgModuleRef,Qn.overrideProvider=e.overrideProvider,Qn.overrideComponentView=e.overrideComponentView,Qn.clearOverrides=e.clearOverrides,Qn.checkAndUpdateView=e.checkAndUpdateView,Qn.checkNoChangesView=e.checkNoChangesView,Qn.destroyView=e.destroyView,Qn.resolveDep=xr,Qn.createDebugContext=e.createDebugContext,Qn.handleEvent=e.handleEvent,Qn.updateDirectives=e.updateDirectives,Qn.updateRenderer=e.updateRenderer,Qn.dirtyParentQueries=qo}}();var t=function(e){var t=Array.from(e.providers),n=Array.from(e.modules),i={};for(var r in e.providersByKey)i[r]=e.providersByKey[r];return{factory:e.factory,isRoot:e.isRoot,providers:t,modules:n,providersByKey:i}}(bi(this._ngModuleDefFactory));return Qn.createNgModuleRef(this.moduleType,e||je.NULL,this._bootstrapComponents,t)},t}(ln),gs=function(){return function(){}}(),ms=function(){return function(){this.title="FA19-OS01"}}(),_s=function(){return function(){}}(),vs=new Be("Location Initialized"),bs=function(){return function(){}}(),ys=new Be("appBaseHref"),Ts=function(){function e(e,n){var i=this;this._subject=new Or,this._urlChangeListeners=[],this._platformStrategy=e;var r=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=t.stripTrailingSlash(Es(r)),this._platformStrategy.onPopState(function(e){i._subject.emit({url:i.path(!0),pop:!0,state:e.state,type:e.type})})}var t;return t=e,e.prototype.path=function(e){return void 0===e&&(e=!1),this.normalize(this._platformStrategy.path(e))},e.prototype.getState=function(){return this._platformLocation.getState()},e.prototype.isCurrentPathEqualTo=function(e,n){return void 0===n&&(n=""),this.path()==this.normalize(e+t.normalizeQueryParams(n))},e.prototype.normalize=function(e){return t.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Es(e)))},e.prototype.prepareExternalUrl=function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)},e.prototype.go=function(e,n,i){void 0===n&&(n=""),void 0===i&&(i=null),this._platformStrategy.pushState(i,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+t.normalizeQueryParams(n)),i)},e.prototype.replaceState=function(e,n,i){void 0===n&&(n=""),void 0===i&&(i=null),this._platformStrategy.replaceState(i,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+t.normalizeQueryParams(n)),i)},e.prototype.forward=function(){this._platformStrategy.forward()},e.prototype.back=function(){this._platformStrategy.back()},e.prototype.onUrlChange=function(e){var t=this;this._urlChangeListeners.push(e),this.subscribe(function(e){t._notifyUrlChangeListeners(e.url,e.state)})},e.prototype._notifyUrlChangeListeners=function(e,t){void 0===e&&(e=""),this._urlChangeListeners.forEach(function(n){return n(e,t)})},e.prototype.subscribe=function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})},e.normalizeQueryParams=function(e){return e&&"?"!==e[0]?"?"+e:e},e.joinWithSlash=function(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t},e.stripTrailingSlash=function(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)},e}();function Es(e){return e.replace(/\/index.html$/,"")}var xs=function(e){function t(t,n){var i=e.call(this)||this;return i._platformLocation=t,i._baseHref="",null!=n&&(i._baseHref=n),i}return r(t,e),t.prototype.onPopState=function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)},t.prototype.getBaseHref=function(){return this._baseHref},t.prototype.path=function(e){void 0===e&&(e=!1);var t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t},t.prototype.prepareExternalUrl=function(e){var t=Ts.joinWithSlash(this._baseHref,e);return t.length>0?"#"+t:t},t.prototype.pushState=function(e,t,n,i){var r=this.prepareExternalUrl(n+Ts.normalizeQueryParams(i));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.pushState(e,t,r)},t.prototype.replaceState=function(e,t,n,i){var r=this.prepareExternalUrl(n+Ts.normalizeQueryParams(i));0==r.length&&(r=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,r)},t.prototype.forward=function(){this._platformLocation.forward()},t.prototype.back=function(){this._platformLocation.back()},t}(bs),Cs=function(e){function t(t,n){var i=e.call(this)||this;if(i._platformLocation=t,null==n&&(n=i._platformLocation.getBaseHrefFromDOM()),null==n)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return i._baseHref=n,i}return r(t,e),t.prototype.onPopState=function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)},t.prototype.getBaseHref=function(){return this._baseHref},t.prototype.prepareExternalUrl=function(e){return Ts.joinWithSlash(this._baseHref,e)},t.prototype.path=function(e){void 0===e&&(e=!1);var t=this._platformLocation.pathname+Ts.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?""+t+n:t},t.prototype.pushState=function(e,t,n,i){var r=this.prepareExternalUrl(n+Ts.normalizeQueryParams(i));this._platformLocation.pushState(e,t,r)},t.prototype.replaceState=function(e,t,n,i){var r=this.prepareExternalUrl(n+Ts.normalizeQueryParams(i));this._platformLocation.replaceState(e,t,r)},t.prototype.forward=function(){this._platformLocation.forward()},t.prototype.back=function(){this._platformLocation.back()},t}(bs),Ss=void 0,As=["en",[["a","p"],["AM","PM"],Ss],[["AM","PM"],Ss,Ss],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ss,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ss,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ss,"{1} 'at' {0}",Ss],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],Ps={},Rs=function(e){return e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Few=3]="Few",e[e.Many=4]="Many",e[e.Other=5]="Other",e}({}),Ms=new Be("UseV4Plurals"),Os=function(){return function(){}}(),ws=function(e){function t(t,n){var i=e.call(this)||this;return i.locale=t,i.deprecatedPluralFn=n,i}return r(t,e),t.prototype.getPluralCategory=function(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return function(e){var t=e.toLowerCase().replace(/_/g,"-"),n=Ps[t];if(n)return n;var i=t.split("-")[0];if(n=Ps[i])return n;if("en"===i)return As;throw new Error('Missing locale data for the locale "'+e+'".')}(e)[18]}(t||this.locale)(e)){case Rs.Zero:return"zero";case Rs.One:return"one";case Rs.Two:return"two";case Rs.Few:return"few";case Rs.Many:return"many";default:return"other"}},t}(Os),Is=function(){return function(){}}(),Ds=function(){function e(e,t,n,i){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=i,this._initialClasses=[]}return e.prototype.getValue=function(){return null},e.prototype.setClass=function(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)},e.prototype.setNgClass=function(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Kt(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())},e.prototype.applyChanges=function(){if(this._iterableDiffer){var e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){var t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}},e.prototype._applyKeyValueChanges=function(e){var t=this;e.forEachAddedItem(function(e){return t._toggleClass(e.key,e.currentValue)}),e.forEachChangedItem(function(e){return t._toggleClass(e.key,e.currentValue)}),e.forEachRemovedItem(function(e){e.previousValue&&t._toggleClass(e.key,!1)})},e.prototype._applyIterableChanges=function(e){var t=this;e.forEachAddedItem(function(e){if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+Re(e.item));t._toggleClass(e.item,!0)}),e.forEachRemovedItem(function(e){return t._toggleClass(e.item,!1)})},e.prototype._applyClasses=function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach(function(e){return t._toggleClass(e,!0)}):Object.keys(e).forEach(function(n){return t._toggleClass(n,!!e[n])}))},e.prototype._removeClasses=function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach(function(e){return t._toggleClass(e,!1)}):Object.keys(e).forEach(function(e){return t._toggleClass(e,!1)}))},e.prototype._toggleClass=function(e,t){var n=this;(e=e.trim())&&e.split(/\s+/g).forEach(function(e){t?n._renderer.addClass(n._ngEl.nativeElement,e):n._renderer.removeClass(n._ngEl.nativeElement,e)})},e}(),Ls=function(e){function t(t){return e.call(this,t)||this}return r(t,e),Object.defineProperty(t.prototype,"klass",{set:function(e){this._delegate.setClass(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ngClass",{set:function(e){this._delegate.setNgClass(e)},enumerable:!0,configurable:!0}),t.prototype.ngDoCheck=function(){this._delegate.applyChanges()},t}(function(){function e(e){this._delegate=e}return e.prototype.getValue=function(){return this._delegate.getValue()},e.ngDirectiveDef=void 0,e}()),ks=function(){function e(e,t,n,i){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=i}return Object.defineProperty(e.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),e}(),Ns=function(){function e(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOfDirty=!0,this._differ=null}return Object.defineProperty(e.prototype,"ngForOf",{set:function(e){this._ngForOf=e,this._ngForOfDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ngForTrackBy",{get:function(){return this._trackByFn},set:function(e){ft()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(e)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ngForTemplate",{set:function(e){e&&(this._template=e)},enumerable:!0,configurable:!0}),e.prototype.ngDoCheck=function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(i){throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+((t=e).name||typeof t)+"'. NgFor only supports binding to Iterables such as Arrays.")}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}},e.prototype._applyChanges=function(e){var t=this,n=[];e.forEachOperation(function(e,i,r){if(null==e.previousIndex){var o=t._viewContainer.createEmbeddedView(t._template,new ks(null,t._ngForOf,-1,-1),r),a=new Fs(e,o);n.push(a)}else null==r?t._viewContainer.remove(i):(o=t._viewContainer.get(i),t._viewContainer.move(o,r),a=new Fs(e,o),n.push(a))});for(var i=0;i<n.length;i++)this._perViewChange(n[i].view,n[i].record);i=0;for(var r=this._viewContainer.length;i<r;i++){var o=this._viewContainer.get(i);o.context.index=i,o.context.count=r,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange(function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item})},e.prototype._perViewChange=function(e,t){e.context.$implicit=t.item},e.ngTemplateContextGuard=function(e,t){return!0},e}(),Fs=function(){return function(e,t){this.record=e,this.view=t}}(),Bs=function(){function e(e,t){this._viewContainer=e,this._context=new Us,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}return Object.defineProperty(e.prototype,"ngIf",{set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ngIfThen",{set:function(e){Vs("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ngIfElse",{set:function(e){Vs("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()},enumerable:!0,configurable:!0}),e.prototype._updateView=function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))},e.ngTemplateGuard_ngIf=function(e,t){return!0},e}(),Us=function(){return function(){this.$implicit=null,this.ngIf=null}}();function Vs(e,t){if(t&&!t.createEmbeddedView)throw new Error(e+" must be a TemplateRef, but received '"+Re(t)+"'.")}var Gs=function(){return function(){}}(),zs=new Be("DocumentToken"),js="browser",Hs="server";function Ws(e){return e===js}var Xs=function(){function e(){}return e.ngInjectableDef=Se({providedIn:"root",factory:function(){return new Ys(Fe(zs),window,Fe(ut))}}),e}(),Ys=function(){function e(e,t,n){this.document=e,this.window=t,this.errorHandler=n,this.offset=function(){return[0,0]}}return e.prototype.setOffset=function(e){this.offset=Array.isArray(e)?function(){return e}:e},e.prototype.getScrollPosition=function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]},e.prototype.scrollToPosition=function(e){this.supportScrollRestoration()&&this.window.scrollTo(e[0],e[1])},e.prototype.scrollToAnchor=function(e){if(this.supportScrollRestoration()){e=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(e):e.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var t=this.document.querySelector("#"+e);if(t)return void this.scrollToElement(t);var n=this.document.querySelector("[name='"+e+"']");if(n)return void this.scrollToElement(n)}catch(i){this.errorHandler.handleError(i)}}},e.prototype.setHistoryScrollRestoration=function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}},e.prototype.scrollToElement=function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,r=this.offset();this.window.scrollTo(n-r[0],i-r[1])},e.prototype.supportScrollRestoration=function(){try{return!!this.window&&!!this.window.scrollTo}catch(e){return!1}},e}(),Ks=new M(function(e){return e.complete()});function Qs(e){return e?function(e){return new M(function(t){return e.schedule(function(){return t.complete()})})}(e):Ks}function qs(e){var t=new M(function(t){t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}function Zs(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];switch(F(n)?e.pop():n=void 0,e.length){case 0:return Qs(n);case 1:return n?$(e,n):qs(e[0]);default:return $(e,n)}}var Js=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new I;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(k);function $s(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}$s.prototype=Object.create(Error.prototype);var el=$s,tl={},nl=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new il(e,this.resultSelector))},e}(),il=function(e){function t(t,n){var i=e.call(this,t)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return r(t,e),t.prototype._next=function(e){this.values.push(tl),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var i=e[n];this.add(K(this,i,i,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){var o=this.values,a=this.toRespond?o[n]===tl?--this.toRespond:this.toRespond:0;o[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(Q);function rl(e){return new M(function(t){var n;try{n=e()}catch(i){return void t.error(i)}return(n?ee(n):Qs()).subscribe(t)})}function ol(){return oe(1)}function al(e,t){return function(n){return n.lift(new sl(e,t))}}var sl=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ll(e,this.predicate,this.thisArg))},e}(),ll=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.predicate=n,r.thisArg=i,r.count=0,r}return r(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(x);function cl(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}cl.prototype=Object.create(Error.prototype);var ul=cl;function hl(e){return function(t){return 0===e?Qs():t.lift(new dl(e))}}var dl=function(){function e(e){if(this.total=e,this.total<0)throw new ul}return e.prototype.call=function(e,t){return t.subscribe(new fl(e,this.total))},e}(),fl=function(e){function t(t,n){var i=e.call(this,t)||this;return i.total=n,i.ring=new Array,i.count=0,i}return r(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,i=this.count++;t.length<n?t.push(e):t[i%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,i=this.ring,r=0;r<n;r++){var o=t++%n;e.next(i[o])}e.complete()},t}(x);function pl(e,t,n){return function(i){return i.lift(new gl(e,t,n))}}var gl=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new ml(e,this.nextOrObserver,this.error,this.complete))},e}(),ml=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;return o._tapNext=A,o._tapError=A,o._tapComplete=A,o._tapError=i||A,o._tapComplete=r||A,f(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||A,o._tapError=n.error||A,o._tapComplete=n.complete||A),o}return r(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(x),_l=function(e){return void 0===e&&(e=vl),pl({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw e()}})};function vl(){return new el}function bl(e){return void 0===e&&(e=null),function(t){return t.lift(new yl(e))}}var yl=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Tl(e,this.defaultValue))},e}(),Tl=function(e){function t(t,n){var i=e.call(this,t)||this;return i.defaultValue=n,i.isEmpty=!0,i}return r(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(x);function El(e,t){var n=arguments.length>=2;return function(i){return i.pipe(e?al(function(t,n){return e(t,n,i)}):re,hl(1),n?bl(t):_l(function(){return new el}))}}function xl(e){return function(t){var n=new Cl(e),i=t.lift(n);return n.caught=i}}var Cl=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Sl(e,this.selector,this.caught))},e}(),Sl=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.selector=n,r.caught=i,r}return r(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(r){return void e.prototype.error.call(this,r)}this._unsubscribeAndRecycle();var i=new B(this,void 0,void 0);this.add(i),K(this,n,void 0,void 0,i)}},t}(Q);function Al(e){return function(t){return 0===e?Qs():t.lift(new Pl(e))}}var Pl=function(){function e(e){if(this.total=e,this.total<0)throw new ul}return e.prototype.call=function(e,t){return t.subscribe(new Rl(e,this.total))},e}(),Rl=function(e){function t(t,n){var i=e.call(this,t)||this;return i.total=n,i.count=0,i}return r(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(x);function Ml(e,t){var n=arguments.length>=2;return function(i){return i.pipe(e?al(function(t,n){return e(t,n,i)}):re,Al(1),n?bl(t):_l(function(){return new el}))}}var Ol=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new wl(e,this.predicate,this.thisArg,this.source))},e}(),wl=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=i,o.source=r,o.index=0,o.thisArg=i||o,o}return r(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(x);function Il(e,t){return"function"==typeof t?function(n){return n.pipe(Il(function(n,i){return ee(e(n,i)).pipe(q(function(e,r){return t(n,e,i,r)}))}))}:function(t){return t.lift(new Dl(e))}}var Dl=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Ll(e,this.project))},e}(),Ll=function(e){function t(t,n){var i=e.call(this,t)||this;return i.project=n,i.index=0,i}return r(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(i){return void this.destination.error(i)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var i=this.innerSubscription;i&&i.unsubscribe();var r=new B(this,void 0,void 0);this.destination.add(r),this.innerSubscription=K(this,e,t,n,r)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t}(Q);function kl(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(i){return i.lift(new Nl(e,t,n))}}var Nl=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Fl(e,this.accumulator,this.seed,this.hasSeed))},e}(),Fl=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=i,o.hasSeed=r,o.index=0,o}return r(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(i){this.destination.error(i)}this.seed=t,this.destination.next(t)},t}(x);function Bl(e,t){return te(e,t,1)}var Ul=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Vl(e,this.callback))},e}(),Vl=function(e){function t(t,n){var i=e.call(this,t)||this;return i.add(new m(n)),i}return r(t,e),t}(x),Gl=null;function zl(){return Gl}var jl,Hl=function(e){function t(){var t=e.call(this)||this;t._animationPrefix=null,t._transitionEnd=null;try{var n=t.createElement("div",document);if(null!=t.getStyle(n,"animationName"))t._animationPrefix="";else for(var i=["Webkit","Moz","O","ms"],r=0;r<i.length;r++)if(null!=t.getStyle(n,i[r]+"AnimationName")){t._animationPrefix="-"+i[r].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach(function(e){null!=t.getStyle(n,e)&&(t._transitionEnd=o[e])})}catch(a){t._animationPrefix=null,t._transitionEnd=null}return t}return r(t,e),t.prototype.getDistributedNodes=function(e){return e.getDistributedNodes()},t.prototype.resolveAndSetHref=function(e,t,n){e.href=null==n?t:t+"/../"+n},t.prototype.supportsDOMEvents=function(){return!0},t.prototype.supportsNativeShadowDOM=function(){return"function"==typeof document.body.createShadowRoot},t.prototype.getAnimationPrefix=function(){return this._animationPrefix?this._animationPrefix:""},t.prototype.getTransitionEnd=function(){return this._transitionEnd?this._transitionEnd:""},t.prototype.supportsAnimation=function(){return null!=this._animationPrefix&&null!=this._transitionEnd},t}(function(){function e(){this.resourceLoaderType=null}return Object.defineProperty(e.prototype,"attrToPropMap",{get:function(){return this._attrToPropMap},set:function(e){this._attrToPropMap=e},enumerable:!0,configurable:!0}),e}()),Wl={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},Xl={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Yl={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Kl=function(){if(Le.Node)return Le.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))}}(),Ql=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){throw new Error("parse not implemented")},t.makeCurrent=function(){var e;e=new t,Gl||(Gl=e)},t.prototype.hasProperty=function(e,t){return t in e},t.prototype.setProperty=function(e,t,n){e[t]=n},t.prototype.getProperty=function(e,t){return e[t]},t.prototype.invoke=function(e,t,n){var i;(i=e)[t].apply(i,u(n))},t.prototype.logError=function(e){window.console&&(console.error?console.error(e):console.log(e))},t.prototype.log=function(e){window.console&&window.console.log&&window.console.log(e)},t.prototype.logGroup=function(e){window.console&&window.console.group&&window.console.group(e)},t.prototype.logGroupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},Object.defineProperty(t.prototype,"attrToPropMap",{get:function(){return Wl},enumerable:!0,configurable:!0}),t.prototype.contains=function(e,t){return Kl.call(e,t)},t.prototype.querySelector=function(e,t){return e.querySelector(t)},t.prototype.querySelectorAll=function(e,t){return e.querySelectorAll(t)},t.prototype.on=function(e,t,n){e.addEventListener(t,n,!1)},t.prototype.onAndCancel=function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}},t.prototype.dispatchEvent=function(e,t){e.dispatchEvent(t)},t.prototype.createMouseEvent=function(e){var t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t},t.prototype.createEvent=function(e){var t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t},t.prototype.preventDefault=function(e){e.preventDefault(),e.returnValue=!1},t.prototype.isPrevented=function(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue},t.prototype.getInnerHTML=function(e){return e.innerHTML},t.prototype.getTemplateContent=function(e){return"content"in e&&this.isTemplateElement(e)?e.content:null},t.prototype.getOuterHTML=function(e){return e.outerHTML},t.prototype.nodeName=function(e){return e.nodeName},t.prototype.nodeValue=function(e){return e.nodeValue},t.prototype.type=function(e){return e.type},t.prototype.content=function(e){return this.hasProperty(e,"content")?e.content:e},t.prototype.firstChild=function(e){return e.firstChild},t.prototype.nextSibling=function(e){return e.nextSibling},t.prototype.parentElement=function(e){return e.parentNode},t.prototype.childNodes=function(e){return e.childNodes},t.prototype.childNodesAsList=function(e){for(var t=e.childNodes,n=new Array(t.length),i=0;i<t.length;i++)n[i]=t[i];return n},t.prototype.clearNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.prototype.appendChild=function(e,t){e.appendChild(t)},t.prototype.removeChild=function(e,t){e.removeChild(t)},t.prototype.replaceChild=function(e,t,n){e.replaceChild(t,n)},t.prototype.remove=function(e){return e.parentNode&&e.parentNode.removeChild(e),e},t.prototype.insertBefore=function(e,t,n){e.insertBefore(n,t)},t.prototype.insertAllBefore=function(e,t,n){n.forEach(function(n){return e.insertBefore(n,t)})},t.prototype.insertAfter=function(e,t,n){e.insertBefore(n,t.nextSibling)},t.prototype.setInnerHTML=function(e,t){e.innerHTML=t},t.prototype.getText=function(e){return e.textContent},t.prototype.setText=function(e,t){e.textContent=t},t.prototype.getValue=function(e){return e.value},t.prototype.setValue=function(e,t){e.value=t},t.prototype.getChecked=function(e){return e.checked},t.prototype.setChecked=function(e,t){e.checked=t},t.prototype.createComment=function(e){return this.getDefaultDocument().createComment(e)},t.prototype.createTemplate=function(e){var t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t},t.prototype.createElement=function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)},t.prototype.createElementNS=function(e,t,n){return(n=n||this.getDefaultDocument()).createElementNS(e,t)},t.prototype.createTextNode=function(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)},t.prototype.createScriptTag=function(e,t,n){var i=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return i.setAttribute(e,t),i},t.prototype.createStyleElement=function(e,t){var n=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(e,t)),n},t.prototype.createShadowRoot=function(e){return e.createShadowRoot()},t.prototype.getShadowRoot=function(e){return e.shadowRoot},t.prototype.getHost=function(e){return e.host},t.prototype.clone=function(e){return e.cloneNode(!0)},t.prototype.getElementsByClassName=function(e,t){return e.getElementsByClassName(t)},t.prototype.getElementsByTagName=function(e,t){return e.getElementsByTagName(t)},t.prototype.classList=function(e){return Array.prototype.slice.call(e.classList,0)},t.prototype.addClass=function(e,t){e.classList.add(t)},t.prototype.removeClass=function(e,t){e.classList.remove(t)},t.prototype.hasClass=function(e,t){return e.classList.contains(t)},t.prototype.setStyle=function(e,t,n){e.style[t]=n},t.prototype.removeStyle=function(e,t){e.style[t]=""},t.prototype.getStyle=function(e,t){return e.style[t]},t.prototype.hasStyle=function(e,t,n){var i=this.getStyle(e,t)||"";return n?i==n:i.length>0},t.prototype.tagName=function(e){return e.tagName},t.prototype.attributeMap=function(e){for(var t=new Map,n=e.attributes,i=0;i<n.length;i++){var r=n.item(i);t.set(r.name,r.value)}return t},t.prototype.hasAttribute=function(e,t){return e.hasAttribute(t)},t.prototype.hasAttributeNS=function(e,t,n){return e.hasAttributeNS(t,n)},t.prototype.getAttribute=function(e,t){return e.getAttribute(t)},t.prototype.getAttributeNS=function(e,t,n){return e.getAttributeNS(t,n)},t.prototype.setAttribute=function(e,t,n){e.setAttribute(t,n)},t.prototype.setAttributeNS=function(e,t,n,i){e.setAttributeNS(t,n,i)},t.prototype.removeAttribute=function(e,t){e.removeAttribute(t)},t.prototype.removeAttributeNS=function(e,t,n){e.removeAttributeNS(t,n)},t.prototype.templateAwareRoot=function(e){return this.isTemplateElement(e)?this.content(e):e},t.prototype.createHtmlDocument=function(){return document.implementation.createHTMLDocument("fakeTitle")},t.prototype.getDefaultDocument=function(){return document},t.prototype.getBoundingClientRect=function(e){try{return e.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}},t.prototype.getTitle=function(e){return e.title},t.prototype.setTitle=function(e,t){e.title=t||""},t.prototype.elementMatches=function(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))},t.prototype.isTemplateElement=function(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName},t.prototype.isTextNode=function(e){return e.nodeType===Node.TEXT_NODE},t.prototype.isCommentNode=function(e){return e.nodeType===Node.COMMENT_NODE},t.prototype.isElementNode=function(e){return e.nodeType===Node.ELEMENT_NODE},t.prototype.hasShadowRoot=function(e){return null!=e.shadowRoot&&e instanceof HTMLElement},t.prototype.isShadowRoot=function(e){return e instanceof DocumentFragment},t.prototype.importIntoDoc=function(e){return document.importNode(this.templateAwareRoot(e),!0)},t.prototype.adoptNode=function(e){return document.adoptNode(e)},t.prototype.getHref=function(e){return e.getAttribute("href")},t.prototype.getEventKey=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Yl.hasOwnProperty(t)&&(t=Yl[t]))}return Xl[t]||t},t.prototype.getGlobalEventTarget=function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null},t.prototype.getHistory=function(){return window.history},t.prototype.getLocation=function(){return window.location},t.prototype.getBaseHref=function(e){var t,n=ql||(ql=document.querySelector("base"))?ql.getAttribute("href"):null;return null==n?null:(t=n,jl||(jl=document.createElement("a")),jl.setAttribute("href",t),"/"===jl.pathname.charAt(0)?jl.pathname:"/"+jl.pathname)},t.prototype.resetBaseElement=function(){ql=null},t.prototype.getUserAgent=function(){return window.navigator.userAgent},t.prototype.setData=function(e,t,n){this.setAttribute(e,"data-"+t,n)},t.prototype.getData=function(e,t){return this.getAttribute(e,"data-"+t)},t.prototype.getComputedStyle=function(e){return getComputedStyle(e)},t.prototype.supportsWebAnimation=function(){return"function"==typeof Element.prototype.animate},t.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},t.prototype.supportsCookies=function(){return!0},t.prototype.getCookie=function(e){return function(e,t){var n,i;t=encodeURIComponent(t);try{for(var r=l(e.split(";")),o=r.next();!o.done;o=r.next()){var a=o.value,s=a.indexOf("="),u=c(-1==s?[a,""]:[a.slice(0,s),a.slice(s+1)],2),h=u[1];if(u[0].trim()===t)return decodeURIComponent(h)}}catch(d){n={error:d}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return null}(document.cookie,e)},t.prototype.setCookie=function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)},t}(Hl),ql=null;function Zl(){return!!window.history.pushState}var Jl=function(e){function t(t){var n=e.call(this)||this;return n._doc=t,n._init(),n}var n;return r(t,e),t.prototype._init=function(){this.location=zl().getLocation(),this._history=zl().getHistory()},t.prototype.getBaseHrefFromDOM=function(){return zl().getBaseHref(this._doc)},t.prototype.onPopState=function(e){zl().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)},t.prototype.onHashChange=function(e){zl().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)},Object.defineProperty(t.prototype,"href",{get:function(){return this.location.href},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this.location.protocol},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hostname",{get:function(){return this.location.hostname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.location.port},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pathname",{get:function(){return this.location.pathname},set:function(e){this.location.pathname=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"search",{get:function(){return this.location.search},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hash",{get:function(){return this.location.hash},enumerable:!0,configurable:!0}),t.prototype.pushState=function(e,t,n){Zl()?this._history.pushState(e,t,n):this.location.hash=n},t.prototype.replaceState=function(e,t,n){Zl()?this._history.replaceState(e,t,n):this.location.hash=n},t.prototype.forward=function(){this._history.forward()},t.prototype.back=function(){this._history.back()},t.prototype.getState=function(){return this._history.state},a([(n=be(zs),function(e,t){n(e,t,0)}),s("design:paramtypes",[Object])],t)}(_s),$l=new Be("TRANSITION_ID"),ec=[{provide:kr,useFactory:function(e,t,n){return function(){n.get(Nr).donePromise.then(function(){var n=zl();Array.prototype.slice.apply(n.querySelectorAll(t,"style[ng-transition]")).filter(function(t){return n.getAttribute(t,"ng-transition")===e}).forEach(function(e){return n.remove(e)})})}},deps:[$l,zs,je],multi:!0}],tc=function(){function e(){}return e.init=function(){var t;t=new e,_o=t},e.prototype.addToWindow=function(e){Le.getAngularTestability=function(t,n){void 0===n&&(n=!0);var i=e.findTestabilityInTree(t,n);if(null==i)throw new Error("Could not find testability for element.");return i},Le.getAllAngularTestabilities=function(){return e.getAllTestabilities()},Le.getAllAngularRootElements=function(){return e.getAllRootElements()},Le.frameworkStabilizers||(Le.frameworkStabilizers=[]),Le.frameworkStabilizers.push(function(e){var t=Le.getAllAngularTestabilities(),n=t.length,i=!1,r=function(t){i=i||t,0==--n&&e(i)};t.forEach(function(e){e.whenStable(r)})})},e.prototype.findTestabilityInTree=function(e,t,n){if(null==t)return null;var i=e.getTestability(t);return null!=i?i:n?zl().isShadowRoot(t)?this.findTestabilityInTree(e,zl().getHost(t),!0):this.findTestabilityInTree(e,zl().parentElement(t),!0):null},e}();function nc(e,t){"undefined"!=typeof COMPILED&&COMPILED||((Le.ng=Le.ng||{})[e]=t)}var ic=function(){return{ApplicationRef:Co,NgZone:ao}}();function rc(e){return Lo(e)}var oc=new Be("EventManagerPlugins"),ac=function(){function e(e,t){var n=this;this._zone=t,this._eventNameToPlugin=new Map,e.forEach(function(e){return e.manager=n}),this._plugins=e.slice().reverse()}return e.prototype.addEventListener=function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)},e.prototype.addGlobalEventListener=function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)},e.prototype.getZone=function(){return this._zone},e.prototype._findPluginFor=function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,i=0;i<n.length;i++){var r=n[i];if(r.supports(e))return this._eventNameToPlugin.set(e,r),r}throw new Error("No event manager plugin found for event "+e)},e}(),sc=function(){function e(e){this._doc=e}return e.prototype.addGlobalEventListener=function(e,t,n){var i=zl().getGlobalEventTarget(this._doc,e);if(!i)throw new Error("Unsupported event target "+i+" for event "+t);return this.addEventListener(i,t,n)},e}(),lc=function(){function e(){this._stylesSet=new Set}return e.prototype.addStyles=function(e){var t=this,n=new Set;e.forEach(function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))}),this.onStylesAdded(n)},e.prototype.onStylesAdded=function(e){},e.prototype.getAllStyles=function(){return Array.from(this._stylesSet)},e}(),cc=function(e){function t(t){var n=e.call(this)||this;return n._doc=t,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(t.head),n}return r(t,e),t.prototype._addStylesToHost=function(e,t){var n=this;e.forEach(function(e){var i=n._doc.createElement("style");i.textContent=e,n._styleNodes.add(t.appendChild(i))})},t.prototype.addHost=function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)},t.prototype.removeHost=function(e){this._hostNodes.delete(e)},t.prototype.onStylesAdded=function(e){var t=this;this._hostNodes.forEach(function(n){return t._addStylesToHost(e,n)})},t.prototype.ngOnDestroy=function(){this._styleNodes.forEach(function(e){return zl().remove(e)})},t}(lc),uc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},hc=/%COMP%/g,dc="_nghost-%COMP%",fc="_ngcontent-%COMP%";function pc(e,t,n){for(var i=0;i<t.length;i++){var r=t[i];Array.isArray(r)?pc(e,r,n):(r=r.replace(hc,e),n.push(r))}return n}function gc(e){return function(t){!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var mc=function(){function e(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new _c(e)}return e.prototype.createRenderer=function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case ot.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new yc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case ot.Native:case ot.ShadowDom:return new Tc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var i=pc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}},e.prototype.begin=function(){},e.prototype.end=function(){},e}(),_c=function(){function e(e){this.eventManager=e,this.data=Object.create(null)}return e.prototype.destroy=function(){},e.prototype.createElement=function(e,t){return t?document.createElementNS(uc[t]||t,e):document.createElement(e)},e.prototype.createComment=function(e){return document.createComment(e)},e.prototype.createText=function(e){return document.createTextNode(e)},e.prototype.appendChild=function(e,t){e.appendChild(t)},e.prototype.insertBefore=function(e,t,n){e&&e.insertBefore(t,n)},e.prototype.removeChild=function(e,t){e&&e.removeChild(t)},e.prototype.selectRootElement=function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'+e+'" did not match any elements');return t||(n.textContent=""),n},e.prototype.parentNode=function(e){return e.parentNode},e.prototype.nextSibling=function(e){return e.nextSibling},e.prototype.setAttribute=function(e,t,n,i){if(i){t=i+":"+t;var r=uc[i];r?e.setAttributeNS(r,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)},e.prototype.removeAttribute=function(e,t,n){if(n){var i=uc[n];i?e.removeAttributeNS(i,t):e.removeAttribute(n+":"+t)}else e.removeAttribute(t)},e.prototype.addClass=function(e,t){e.classList.add(t)},e.prototype.removeClass=function(e,t){e.classList.remove(t)},e.prototype.setStyle=function(e,t,n,i){i&pn.DashCase?e.style.setProperty(t,n,i&pn.Important?"important":""):e.style[t]=n},e.prototype.removeStyle=function(e,t,n){n&pn.DashCase?e.style.removeProperty(t):e.style[t]=""},e.prototype.setProperty=function(e,t,n){bc(t,"property"),e[t]=n},e.prototype.setValue=function(e,t){e.nodeValue=t},e.prototype.listen=function(e,t,n){return bc(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,gc(n)):this.eventManager.addEventListener(e,t,gc(n))},e}(),vc=function(){return"@".charCodeAt(0)}();function bc(e,t){if(e.charCodeAt(0)===vc)throw new Error("Found the synthetic "+t+" "+e+'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.')}var yc=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;o.component=i;var a=pc(r+"-"+i.id,i.styles,[]);return n.addStyles(a),o.contentAttr=fc.replace(hc,r+"-"+i.id),o.hostAttr=dc.replace(hc,r+"-"+i.id),o}return r(t,e),t.prototype.applyToHost=function(t){e.prototype.setAttribute.call(this,t,this.hostAttr,"")},t.prototype.createElement=function(t,n){var i=e.prototype.createElement.call(this,t,n);return e.prototype.setAttribute.call(this,i,this.contentAttr,""),i},t}(_c),Tc=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;o.sharedStylesHost=n,o.hostEl=i,o.component=r,o.shadowRoot=r.encapsulation===ot.ShadowDom?i.attachShadow({mode:"open"}):i.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var a=pc(r.id,r.styles,[]),s=0;s<a.length;s++){var l=document.createElement("style");l.textContent=a[s],o.shadowRoot.appendChild(l)}return o}return r(t,e),t.prototype.nodeOrShadowRoot=function(e){return e===this.hostEl?this.shadowRoot:e},t.prototype.destroy=function(){this.sharedStylesHost.removeHost(this.shadowRoot)},t.prototype.appendChild=function(t,n){return e.prototype.appendChild.call(this,this.nodeOrShadowRoot(t),n)},t.prototype.insertBefore=function(t,n,i){return e.prototype.insertBefore.call(this,this.nodeOrShadowRoot(t),n,i)},t.prototype.removeChild=function(t,n){return e.prototype.removeChild.call(this,this.nodeOrShadowRoot(t),n)},t.prototype.parentNode=function(t){return this.nodeOrShadowRoot(e.prototype.parentNode.call(this,this.nodeOrShadowRoot(t)))},t}(_c),Ec=function(){return"undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e}}(),xc=Ec("addEventListener"),Cc=Ec("removeEventListener"),Sc={},Ac="__zone_symbol__propagationStopped",Pc=function(){var e="undefined"!=typeof Zone&&Zone[Ec("BLACK_LISTED_EVENTS")];if(e){var t={};return e.forEach(function(e){t[e]=e}),t}}(),Rc=function(e){return!!Pc&&Pc.hasOwnProperty(e)},Mc=function(e){var t=Sc[e.type];if(t){var n=this[t];if(n){var i=[e];if(1===n.length)return(a=n[0]).zone!==Zone.current?a.zone.run(a.handler,this,i):a.handler.apply(this,i);for(var r=n.slice(),o=0;o<r.length&&!0!==e[Ac];o++){var a;(a=r[o]).zone!==Zone.current?a.zone.run(a.handler,this,i):a.handler.apply(this,i)}}}},Oc=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.ngZone=n,i&&function(e){return e===Hs}(i)||r.patchEvent(),r}return r(t,e),t.prototype.patchEvent=function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var e=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[Ac]=!0),e&&e.apply(this,arguments)}}},t.prototype.supports=function(e){return!0},t.prototype.addEventListener=function(e,t,n){var i=this,r=n;if(!e[xc]||ao.isInAngularZone()&&!Rc(t))e.addEventListener(t,r,!1);else{var o=Sc[t];o||(o=Sc[t]=Ec("ANGULAR"+t+"FALSE"));var a=e[o],s=a&&a.length>0;a||(a=e[o]=[]);var l=Rc(t)?Zone.root:Zone.current;if(0===a.length)a.push({zone:l,handler:r});else{for(var c=!1,u=0;u<a.length;u++)if(a[u].handler===r){c=!0;break}c||a.push({zone:l,handler:r})}s||e[xc](t,Mc,!1)}return function(){return i.removeEventListener(e,t,r)}},t.prototype.removeEventListener=function(e,t,n){var i=e[Cc];if(!i)return e.removeEventListener.apply(e,[t,n,!1]);var r=Sc[t],o=r&&e[r];if(!o)return e.removeEventListener.apply(e,[t,n,!1]);for(var a=!1,s=0;s<o.length;s++)if(o[s].handler===n){a=!0,o.splice(s,1);break}a?0===o.length&&i.apply(e,[t,Mc,!1]):e.removeEventListener.apply(e,[t,n,!1])},t}(sc),wc={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Ic=new Be("HammerGestureConfig"),Dc=new Be("HammerLoader"),Lc=function(){function e(){this.events=[],this.overrides={}}return e.prototype.buildHammer=function(e){var t=new Hammer(e,this.options);for(var n in t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),this.overrides)t.get(n).set(this.overrides[n]);return t},e}(),kc=function(e){function t(t,n,i,r){var o=e.call(this,t)||this;return o._config=n,o.console=i,o.loader=r,o}return r(t,e),t.prototype.supports=function(e){return!(!wc.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e)||!window.Hammer&&!this.loader&&(this.console.warn('The "'+e+'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.'),1))},t.prototype.addEventListener=function(e,t,n){var i=this,r=this.manager.getZone();if(t=t.toLowerCase(),!window.Hammer&&this.loader){var o=!1,a=function(){o=!0};return this.loader().then(function(){if(!window.Hammer)return i.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(a=function(){});o||(a=i.addEventListener(e,t,n))}).catch(function(){i.console.warn('The "'+t+'" event cannot be bound because the custom Hammer.JS loader failed.'),a=function(){}}),function(){a()}}return r.runOutsideAngular(function(){var o=i._config.buildHammer(e),a=function(e){r.runGuarded(function(){n(e)})};return o.on(t,a),function(){o.off(t,a),"function"==typeof o.destroy&&o.destroy()}})},t.prototype.isCustomEvent=function(e){return this._config.events.indexOf(e)>-1},t}(sc),Nc=["alt","control","meta","shift"],Fc={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Bc=function(e){function t(t){return e.call(this,t)||this}var n;return r(t,e),n=t,t.prototype.supports=function(e){return null!=n.parseEventName(e)},t.prototype.addEventListener=function(e,t,i){var r=n.parseEventName(t),o=n.eventCallback(r.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return zl().onAndCancel(e,r.domEventName,o)})},t.parseEventName=function(e){var t=e.toLowerCase().split("."),i=t.shift();if(0===t.length||"keydown"!==i&&"keyup"!==i)return null;var r=n._normalizeKey(t.pop()),o="";if(Nc.forEach(function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),o+=e+".")}),o+=r,0!=t.length||0===r.length)return null;var a={};return a.domEventName=i,a.fullKey=o,a},t.getEventFullKey=function(e){var t="",n=zl().getEventKey(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Nc.forEach(function(i){i!=n&&(0,Fc[i])(e)&&(t+=i+".")}),t+=n},t.eventCallback=function(e,t,i){return function(r){n.getEventFullKey(r)===e&&i.runGuarded(function(){return t(r)})}},t._normalizeKey=function(e){switch(e){case"esc":return"escape";default:return e}},t}(sc),Uc=function(){return function(){}}(),Vc=function(e){function t(t){var n=e.call(this)||this;return n._doc=t,n}return r(t,e),t.prototype.sanitize=function(e,t){if(null==t)return null;switch(e){case kt.NONE:return t;case kt.HTML:return t instanceof zc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),function(e,t){var n=null;try{yt=yt||new pt(e);var i=t?String(t):"";n=yt.getInertBodyElement(i);var r=5,o=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=o,o=n.innerHTML,n=yt.getInertBodyElement(i)}while(i!==o);var a=new Ot,s=a.sanitizeChildren(Lt(n)||n);return ft()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var l=Lt(n)||n;l.firstChild;)l.removeChild(l.firstChild)}}(this._doc,String(t)));case kt.STYLE:return t instanceof jc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),function(e){if(!(e=String(e).trim()))return"";var t=e.match(Bt);return t&&_t(t[1])===t[1]||e.match(Ft)&&function(e){for(var t=!0,n=!0,i=0;i<e.length;i++){var r=e.charAt(i);"'"===r&&n?t=!t:'"'===r&&t&&(n=!n)}return t&&n}(e)?e:(ft()&&console.warn("WARNING: sanitizing unsafe style value "+e+" (see http://g.co/ng/security#xss)."),"unsafe")}(t));case kt.SCRIPT:if(t instanceof Hc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case kt.URL:return t instanceof Xc||t instanceof Wc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),_t(String(t)));case kt.RESOURCE_URL:if(t instanceof Xc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext "+e+" (see http://g.co/ng/security#xss)")}},t.prototype.checkNotSafeValue=function(e,t){if(e instanceof Gc)throw new Error("Required a safe "+t+", got a "+e.getTypeName()+" (see http://g.co/ng/security#xss)")},t.prototype.bypassSecurityTrustHtml=function(e){return new zc(e)},t.prototype.bypassSecurityTrustStyle=function(e){return new jc(e)},t.prototype.bypassSecurityTrustScript=function(e){return new Hc(e)},t.prototype.bypassSecurityTrustUrl=function(e){return new Wc(e)},t.prototype.bypassSecurityTrustResourceUrl=function(e){return new Xc(e)},t}(Uc),Gc=function(){function e(e){this.changingThisBreaksApplicationSecurity=e}return e.prototype.toString=function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"},e}(),zc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getTypeName=function(){return"HTML"},t}(Gc),jc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getTypeName=function(){return"Style"},t}(Gc),Hc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getTypeName=function(){return"Script"},t}(Gc),Wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getTypeName=function(){return"URL"},t}(Gc),Xc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getTypeName=function(){return"ResourceURL"},t}(Gc),Yc=yo(No,"browser",[{provide:Gr,useValue:js},{provide:Vr,useValue:function(){Ql.makeCurrent(),tc.init()},multi:!0},{provide:_s,useClass:Jl,deps:[zs]},{provide:zs,useFactory:function(){return document},deps:[]}]);function Kc(){return new ut}var Qc=function(){function e(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}var t;return t=e,e.withServerTransition=function(e){return{ngModule:t,providers:[{provide:Fr,useValue:e.appId},{provide:$l,useExisting:Fr},ec]}},e}();"undefined"!=typeof window&&window;var qc=function(){return function(e,t){this.id=e,this.url=t}}(),Zc=function(e){function t(t,n,i,r){void 0===i&&(i="imperative"),void 0===r&&(r=null);var o=e.call(this,t,n)||this;return o.navigationTrigger=i,o.restoredState=r,o}return r(t,e),t.prototype.toString=function(){return"NavigationStart(id: "+this.id+", url: '"+this.url+"')"},t}(qc),Jc=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.urlAfterRedirects=i,r}return r(t,e),t.prototype.toString=function(){return"NavigationEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"')"},t}(qc),$c=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.reason=i,r}return r(t,e),t.prototype.toString=function(){return"NavigationCancel(id: "+this.id+", url: '"+this.url+"')"},t}(qc),eu=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.error=i,r}return r(t,e),t.prototype.toString=function(){return"NavigationError(id: "+this.id+", url: '"+this.url+"', error: "+this.error+")"},t}(qc),tu=function(e){function t(t,n,i,r){var o=e.call(this,t,n)||this;return o.urlAfterRedirects=i,o.state=r,o}return r(t,e),t.prototype.toString=function(){return"RoutesRecognized(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(qc),nu=function(e){function t(t,n,i,r){var o=e.call(this,t,n)||this;return o.urlAfterRedirects=i,o.state=r,o}return r(t,e),t.prototype.toString=function(){return"GuardsCheckStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(qc),iu=function(e){function t(t,n,i,r,o){var a=e.call(this,t,n)||this;return a.urlAfterRedirects=i,a.state=r,a.shouldActivate=o,a}return r(t,e),t.prototype.toString=function(){return"GuardsCheckEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+", shouldActivate: "+this.shouldActivate+")"},t}(qc),ru=function(e){function t(t,n,i,r){var o=e.call(this,t,n)||this;return o.urlAfterRedirects=i,o.state=r,o}return r(t,e),t.prototype.toString=function(){return"ResolveStart(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(qc),ou=function(e){function t(t,n,i,r){var o=e.call(this,t,n)||this;return o.urlAfterRedirects=i,o.state=r,o}return r(t,e),t.prototype.toString=function(){return"ResolveEnd(id: "+this.id+", url: '"+this.url+"', urlAfterRedirects: '"+this.urlAfterRedirects+"', state: "+this.state+")"},t}(qc),au=function(){function e(e){this.route=e}return e.prototype.toString=function(){return"RouteConfigLoadStart(path: "+this.route.path+")"},e}(),su=function(){function e(e){this.route=e}return e.prototype.toString=function(){return"RouteConfigLoadEnd(path: "+this.route.path+")"},e}(),lu=function(){function e(e){this.snapshot=e}return e.prototype.toString=function(){return"ChildActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},e}(),cu=function(){function e(e){this.snapshot=e}return e.prototype.toString=function(){return"ChildActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},e}(),uu=function(){function e(e){this.snapshot=e}return e.prototype.toString=function(){return"ActivationStart(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},e}(),hu=function(){function e(e){this.snapshot=e}return e.prototype.toString=function(){return"ActivationEnd(path: '"+(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"")+"')"},e}(),du=function(){function e(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}return e.prototype.toString=function(){return"Scroll(anchor: '"+this.anchor+"', position: '"+(this.position?this.position[0]+", "+this.position[1]:null)+"')"},e}(),fu=function(){return function(){}}(),pu="primary",gu=function(){function e(e){this.params=e||{}}return e.prototype.has=function(e){return this.params.hasOwnProperty(e)},e.prototype.get=function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null},e.prototype.getAll=function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]},Object.defineProperty(e.prototype,"keys",{get:function(){return Object.keys(this.params)},enumerable:!0,configurable:!0}),e}();function mu(e){return new gu(e)}var _u="ngNavigationCancelingError";function vu(e){var t=Error("NavigationCancelingError: "+e);return t[_u]=!0,t}function bu(e,t,n){var i=n.path.split("/");if(i.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;for(var r={},o=0;o<i.length;o++){var a=i[o],s=e[o];if(a.startsWith(":"))r[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:e.slice(0,i.length),posParams:r}}var yu=function(){return function(e,t){this.routes=e,this.module=t}}();function Tu(e,t){void 0===t&&(t="");for(var n=0;n<e.length;n++){var i=e[n];Eu(i,xu(t,i))}}function Eu(e,t){if(!e)throw new Error("\n      Invalid configuration of route '"+t+"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    ");if(Array.isArray(e))throw new Error("Invalid configuration of route '"+t+"': Array cannot be specified");if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&e.outlet!==pu)throw new Error("Invalid configuration of route '"+t+"': a componentless route without children or loadChildren cannot have a named outlet set");if(e.redirectTo&&e.children)throw new Error("Invalid configuration of route '"+t+"': redirectTo and children cannot be used together");if(e.redirectTo&&e.loadChildren)throw new Error("Invalid configuration of route '"+t+"': redirectTo and loadChildren cannot be used together");if(e.children&&e.loadChildren)throw new Error("Invalid configuration of route '"+t+"': children and loadChildren cannot be used together");if(e.redirectTo&&e.component)throw new Error("Invalid configuration of route '"+t+"': redirectTo and component cannot be used together");if(e.path&&e.matcher)throw new Error("Invalid configuration of route '"+t+"': path and matcher cannot be used together");if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error("Invalid configuration of route '"+t+"'. One of the following must be provided: component, redirectTo, children or loadChildren");if(void 0===e.path&&void 0===e.matcher)throw new Error("Invalid configuration of route '"+t+"': routes must have either a path or a matcher specified");if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error("Invalid configuration of route '"+t+"': path cannot start with a slash");if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error("Invalid configuration of route '{path: \""+t+'", redirectTo: "'+e.redirectTo+"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.");if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error("Invalid configuration of route '"+t+"': pathMatch can only be set to 'prefix' or 'full'");e.children&&Tu(e.children,t)}function xu(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:e+"/"+t.path:"":e}function Cu(e){var t=e.children&&e.children.map(Cu),n=t?o({},e,{children:t}):o({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==pu&&(n.component=fu),n}function Su(e,t){var n,i=Object.keys(e),r=Object.keys(t);if(!i||!r||i.length!=r.length)return!1;for(var o=0;o<i.length;o++)if(e[n=i[o]]!==t[n])return!1;return!0}function Au(e){return Array.prototype.concat.apply([],e)}function Pu(e){return e.length>0?e[e.length-1]:null}function Ru(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Mu(e){return zt(e)?e:Gt(e)?ee(Promise.resolve(e)):Zs(e)}function Ou(e,t,n){return n?function(e,t){return Su(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Lu(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(var i in n.children){if(!t.children[i])return!1;if(!e(t.children[i],n.children[i]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(function(n){return t[n]===e[n]})}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,i,r){if(n.segments.length>r.length)return!!Lu(a=n.segments.slice(0,r.length),r)&&!i.hasChildren();if(n.segments.length===r.length){if(!Lu(n.segments,r))return!1;for(var o in i.children){if(!n.children[o])return!1;if(!e(n.children[o],i.children[o]))return!1}return!0}var a=r.slice(0,n.segments.length),s=r.slice(n.segments.length);return!!Lu(n.segments,a)&&!!n.children[pu]&&t(n.children[pu],i,s)}(t,n,n.segments)}(e.root,t.root)}var wu=function(){function e(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}return Object.defineProperty(e.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=mu(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return Bu.serialize(this)},e}(),Iu=function(){function e(e,t){var n=this;this.segments=e,this.children=t,this.parent=null,Ru(t,function(e,t){return e.parent=n})}return e.prototype.hasChildren=function(){return this.numberOfChildren>0},Object.defineProperty(e.prototype,"numberOfChildren",{get:function(){return Object.keys(this.children).length},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return Uu(this)},e}(),Du=function(){function e(e,t){this.path=e,this.parameters=t}return Object.defineProperty(e.prototype,"parameterMap",{get:function(){return this._parameterMap||(this._parameterMap=mu(this.parameters)),this._parameterMap},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return Wu(this)},e}();function Lu(e,t){return e.length===t.length&&e.every(function(e,n){return e.path===t[n].path})}function ku(e,t){var n=[];return Ru(e.children,function(e,i){i===pu&&(n=n.concat(t(e,i)))}),Ru(e.children,function(e,i){i!==pu&&(n=n.concat(t(e,i)))}),n}var Nu=function(){return function(){}}(),Fu=function(){function e(){}return e.prototype.parse=function(e){var t=new qu(e);return new wu(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())},e.prototype.serialize=function(e){var t,n;return"/"+function e(t,n){if(!t.hasChildren())return Uu(t);if(n){var i=t.children[pu]?e(t.children[pu],!1):"",r=[];return Ru(t.children,function(t,n){n!==pu&&r.push(n+":"+e(t,!1))}),r.length>0?i+"("+r.join("//")+")":i}var o=ku(t,function(n,i){return i===pu?[e(t.children[pu],!1)]:[i+":"+e(n,!1)]});return Uu(t)+"/("+o.join("//")+")"}(e.root,!0)+(t=e.queryParams,(n=Object.keys(t).map(function(e){var n=t[e];return Array.isArray(n)?n.map(function(t){return Gu(e)+"="+Gu(t)}).join("&"):Gu(e)+"="+Gu(n)})).length?"?"+n.join("&"):"")+("string"==typeof e.fragment?"#"+encodeURI(e.fragment):"")},e}(),Bu=new Fu;function Uu(e){return e.segments.map(function(e){return Wu(e)}).join("/")}function Vu(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Gu(e){return Vu(e).replace(/%3B/gi,";")}function zu(e){return Vu(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ju(e){return decodeURIComponent(e)}function Hu(e){return ju(e.replace(/\+/g,"%20"))}function Wu(e){return""+zu(e.path)+(t=e.parameters,Object.keys(t).map(function(e){return";"+zu(e)+"="+zu(t[e])}).join(""));var t}var Xu=/^[^\/()?;=#]+/;function Yu(e){var t=e.match(Xu);return t?t[0]:""}var Ku=/^[^=?&#]+/,Qu=/^[^?&#]+/,qu=function(){function e(e){this.url=e,this.remaining=e}return e.prototype.parseRootSegment=function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Iu([],{}):new Iu([],this.parseChildren())},e.prototype.parseQueryParams=function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e},e.prototype.parseFragment=function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null},e.prototype.parseChildren=function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[pu]=new Iu(e,t)),n},e.prototype.parseSegment=function(){var e=Yu(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '"+this.remaining+"'.");return this.capture(e),new Du(ju(e),this.parseMatrixParams())},e.prototype.parseMatrixParams=function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e},e.prototype.parseParam=function(e){var t=Yu(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var i=Yu(this.remaining);i&&this.capture(n=i)}e[ju(t)]=ju(n)}},e.prototype.parseQueryParam=function(e){var t,n=(t=this.remaining.match(Ku))?t[0]:"";if(n){this.capture(n);var i="";if(this.consumeOptional("=")){var r=function(e){var t=e.match(Qu);return t?t[0]:""}(this.remaining);r&&this.capture(i=r)}var o=Hu(n),a=Hu(i);if(e.hasOwnProperty(o)){var s=e[o];Array.isArray(s)||(e[o]=s=[s]),s.push(a)}else e[o]=a}},e.prototype.parseParens=function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Yu(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error("Cannot parse url '"+this.url+"'");var r=void 0;n.indexOf(":")>-1?(r=n.substr(0,n.indexOf(":")),this.capture(r),this.capture(":")):e&&(r=pu);var o=this.parseChildren();t[r]=1===Object.keys(o).length?o[pu]:new Iu([],o),this.consumeOptional("//")}return t},e.prototype.peekStartsWith=function(e){return this.remaining.startsWith(e)},e.prototype.consumeOptional=function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)},e.prototype.capture=function(e){if(!this.consumeOptional(e))throw new Error('Expected "'+e+'".')},e}(),Zu=function(){function e(e){this._root=e}return Object.defineProperty(e.prototype,"root",{get:function(){return this._root.value},enumerable:!0,configurable:!0}),e.prototype.parent=function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null},e.prototype.children=function(e){var t=Ju(e,this._root);return t?t.children.map(function(e){return e.value}):[]},e.prototype.firstChild=function(e){var t=Ju(e,this._root);return t&&t.children.length>0?t.children[0].value:null},e.prototype.siblings=function(e){var t=$u(e,this._root);return t.length<2?[]:t[t.length-2].children.map(function(e){return e.value}).filter(function(t){return t!==e})},e.prototype.pathFromRoot=function(e){return $u(e,this._root).map(function(e){return e.value})},e}();function Ju(e,t){var n,i;if(e===t.value)return t;try{for(var r=l(t.children),o=r.next();!o.done;o=r.next()){var a=Ju(e,o.value);if(a)return a}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return null}function $u(e,t){var n,i;if(e===t.value)return[t];try{for(var r=l(t.children),o=r.next();!o.done;o=r.next()){var a=$u(e,o.value);if(a.length)return a.unshift(t),a}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return[]}var eh=function(){function e(e,t){this.value=e,this.children=t}return e.prototype.toString=function(){return"TreeNode("+this.value+")"},e}();function th(e){var t={};return e&&e.children.forEach(function(e){return t[e.value.outlet]=e}),t}var nh=function(e){function t(t,n){var i=e.call(this,t)||this;return i.snapshot=n,lh(i,t),i}return r(t,e),t.prototype.toString=function(){return this.snapshot.toString()},t}(Zu);function ih(e,t){var n=function(e,t){var n=new ah([],{},{},"",{},pu,t,null,e.root,-1,{});return new sh("",new eh(n,[]))}(e,t),i=new Js([new Du("",{})]),r=new Js({}),o=new Js({}),a=new Js({}),s=new Js(""),l=new rh(i,r,a,s,o,pu,t,n.root);return l.snapshot=n.root,new nh(new eh(l,[]),n)}var rh=function(){function e(e,t,n,i,r,o,a,s){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=r,this.outlet=o,this.component=a,this._futureSnapshot=s}return Object.defineProperty(e.prototype,"routeConfig",{get:function(){return this._futureSnapshot.routeConfig},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=this.params.pipe(q(function(e){return mu(e)}))),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(q(function(e){return mu(e)}))),this._queryParamMap},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.snapshot?this.snapshot.toString():"Future("+this._futureSnapshot+")"},e}();function oh(e,t){void 0===t&&(t="emptyOnly");var n=e.pathFromRoot,i=0;if("always"!==t)for(i=n.length-1;i>=1;){var r=n[i],a=n[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(a.component)break;i--}}return function(e){return e.reduce(function(e,t){return{params:o({},e.params,t.params),data:o({},e.data,t.data),resolve:o({},e.resolve,t._resolvedData)}},{params:{},data:{},resolve:{}})}(n.slice(i))}var ah=function(){function e(e,t,n,i,r,o,a,s,l,c,u){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=r,this.outlet=o,this.component=a,this.routeConfig=s,this._urlSegment=l,this._lastPathIndex=c,this._resolve=u}return Object.defineProperty(e.prototype,"root",{get:function(){return this._routerState.root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._routerState.parent(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this._routerState.firstChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._routerState.children(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pathFromRoot",{get:function(){return this._routerState.pathFromRoot(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMap",{get:function(){return this._paramMap||(this._paramMap=mu(this.params)),this._paramMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queryParamMap",{get:function(){return this._queryParamMap||(this._queryParamMap=mu(this.queryParams)),this._queryParamMap},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Route(url:'"+this.url.map(function(e){return e.toString()}).join("/")+"', path:'"+(this.routeConfig?this.routeConfig.path:"")+"')"},e}(),sh=function(e){function t(t,n){var i=e.call(this,n)||this;return i.url=t,lh(i,n),i}return r(t,e),t.prototype.toString=function(){return ch(this._root)},t}(Zu);function lh(e,t){t.value._routerState=e,t.children.forEach(function(t){return lh(e,t)})}function ch(e){var t=e.children.length>0?" { "+e.children.map(ch).join(", ")+" } ":"";return""+e.value+t}function uh(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Su(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Su(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!Su(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Su(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function hh(e,t){var n,i;return Su(e.params,t.params)&&Lu(n=e.url,i=t.url)&&n.every(function(e,t){return Su(e.parameters,i[t].parameters)})&&!(!e.parent!=!t.parent)&&(!e.parent||hh(e.parent,t.parent))}function dh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function fh(e,t,n,i,r){var o={};return i&&Ru(i,function(e,t){o[t]=Array.isArray(e)?e.map(function(e){return""+e}):""+e}),new wu(n.root===e?t:function e(t,n,i){var r={};return Ru(t.children,function(t,o){r[o]=t===n?i:e(t,n,i)}),new Iu(t.segments,r)}(n.root,e,t),o,r)}var ph=function(){function e(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&dh(n[0]))throw new Error("Root segment cannot have matrix parameters");var i=n.find(function(e){return"object"==typeof e&&null!=e&&e.outlets});if(i&&i!==Pu(n))throw new Error("{outlets:{}} has to be the last command")}return e.prototype.toRoot=function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]},e}(),gh=function(){return function(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}();function mh(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets[pu]:""+e}function _h(e,t,n){if(e||(e=new Iu([],{})),0===e.segments.length&&e.hasChildren())return vh(e,t,n);var i=function(e,t,n){for(var i=0,r=t,o={match:!1,pathIndex:0,commandIndex:0};r<e.segments.length;){if(i>=n.length)return o;var a=e.segments[r],s=mh(n[i]),l=i<n.length-1?n[i+1]:null;if(r>0&&void 0===s)break;if(s&&l&&"object"==typeof l&&void 0===l.outlets){if(!Eh(s,l,a))return o;i+=2}else{if(!Eh(s,{},a))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(e,t,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){var o=new Iu(e.segments.slice(0,i.pathIndex),{});return o.children[pu]=new Iu(e.segments.slice(i.pathIndex),e.children),vh(o,0,r)}return i.match&&0===r.length?new Iu(e.segments,{}):i.match&&!e.hasChildren()?bh(e,t,n):i.match?vh(e,0,r):bh(e,t,n)}function vh(e,t,n){if(0===n.length)return new Iu(e.segments,{});var i=function(e){var t,n;return"object"!=typeof e[0]?((t={})[pu]=e,t):void 0===e[0].outlets?((n={})[pu]=e,n):e[0].outlets}(n),r={};return Ru(i,function(n,i){null!==n&&(r[i]=_h(e.children[i],t,n))}),Ru(e.children,function(e,t){void 0===i[t]&&(r[t]=e)}),new Iu(e.segments,r)}function bh(e,t,n){for(var i=e.segments.slice(0,t),r=0;r<n.length;){if("object"==typeof n[r]&&void 0!==n[r].outlets){var o=yh(n[r].outlets);return new Iu(i,o)}if(0===r&&dh(n[0]))i.push(new Du(e.segments[t].path,n[0])),r++;else{var a=mh(n[r]),s=r<n.length-1?n[r+1]:null;a&&s&&dh(s)?(i.push(new Du(a,Th(s))),r+=2):(i.push(new Du(a,{})),r++)}}return new Iu(i,{})}function yh(e){var t={};return Ru(e,function(e,n){null!==e&&(t[n]=bh(new Iu([],{}),0,e))}),t}function Th(e){var t={};return Ru(e,function(e,n){return t[n]=""+e}),t}function Eh(e,t,n){return e==n.path&&Su(t,n.parameters)}var xh=function(){function e(e,t,n,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=i}return e.prototype.activate=function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),uh(this.futureState.root),this.activateChildRoutes(t,n,e)},e.prototype.deactivateChildRoutes=function(e,t,n){var i=this,r=th(t);e.children.forEach(function(e){var t=e.value.outlet;i.deactivateRoutes(e,r[t],n),delete r[t]}),Ru(r,function(e,t){i.deactivateRouteAndItsChildren(e,n)})},e.prototype.deactivateRoutes=function(e,t,n){var i=e.value,r=t?t.value:null;if(i===r)if(i.component){var o=n.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,n);else r&&this.deactivateRouteAndItsChildren(t,n)},e.prototype.deactivateRouteAndItsChildren=function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)},e.prototype.detachAndStoreRouteSubtree=function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var i=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:i,route:e,contexts:r})}},e.prototype.deactivateRouteAndOutlet=function(e,t){var n=this,i=t.getContext(e.value.outlet);if(i){var r=th(e),o=e.value.component?i.children:t;Ru(r,function(e,t){return n.deactivateRouteAndItsChildren(e,o)}),i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated())}},e.prototype.activateChildRoutes=function(e,t,n){var i=this,r=th(t);e.children.forEach(function(e){i.activateRoutes(e,r[e.value.outlet],n),i.forwardEvent(new hu(e.value.snapshot))}),e.children.length&&this.forwardEvent(new cu(e.value.snapshot))},e.prototype.activateRoutes=function(e,t,n){var i=e.value,r=t?t.value:null;if(uh(i),i===r)if(i.component){var o=n.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,n);else if(i.component)if(o=n.getOrCreateContext(i.outlet),this.routeReuseStrategy.shouldAttach(i.snapshot)){var a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Ch(a.route)}else{var s=function(e){for(var t=i.snapshot.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(),l=s?s.module.componentFactoryResolver:null;o.attachRef=null,o.route=i,o.resolver=l,o.outlet&&o.outlet.activateWith(i,l),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,n)},e}();function Ch(e){uh(e.value),e.children.forEach(Ch)}function Sh(e){return"function"==typeof e}function Ah(e){return e instanceof wu}var Ph=function(){return function(e){this.segmentGroup=e||null}}(),Rh=function(){return function(e){this.urlTree=e}}();function Mh(e){return new M(function(t){return t.error(new Ph(e))})}function Oh(e){return new M(function(t){return t.error(new Rh(e))})}function wh(e){return new M(function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '"+e+"'"))})}var Ih=function(){function e(e,t,n,i,r){this.configLoader=t,this.urlSerializer=n,this.urlTree=i,this.config=r,this.allowRedirects=!0,this.ngModule=e.get(sn)}return e.prototype.apply=function(){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,pu).pipe(q(function(t){return e.createUrlTree(t,e.urlTree.queryParams,e.urlTree.fragment)})).pipe(xl(function(t){if(t instanceof Rh)return e.allowRedirects=!1,e.match(t.urlTree);if(t instanceof Ph)throw e.noMatchError(t);throw t}))},e.prototype.match=function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,pu).pipe(q(function(n){return t.createUrlTree(n,e.queryParams,e.fragment)})).pipe(xl(function(e){if(e instanceof Ph)throw t.noMatchError(e);throw e}))},e.prototype.noMatchError=function(e){return new Error("Cannot match any routes. URL Segment: '"+e.segmentGroup+"'")},e.prototype.createUrlTree=function(e,t,n){var i,r=e.segments.length>0?new Iu([],((i={})[pu]=e,i)):e;return new wu(r,t,n)},e.prototype.expandSegmentGroup=function(e,t,n,i){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(q(function(e){return new Iu([],e)})):this.expandSegment(e,n,t,n.segments,i,!0)},e.prototype.expandChildren=function(e,t,n){var i=this;return function(n,r){if(0===Object.keys(n).length)return Zs({});var o=[],a=[],s={};return Ru(n,function(n,r){var l,c,u=(l=r,c=n,i.expandSegmentGroup(e,t,c,l)).pipe(q(function(e){return s[r]=e}));r===pu?o.push(u):a.push(u)}),Zs.apply(null,o.concat(a)).pipe(ol(),El(),q(function(){return s}))}(n.children)},e.prototype.expandSegment=function(e,t,n,i,r,o){var a=this;return Zs.apply(void 0,u(n)).pipe(q(function(s){return a.expandSegmentAgainstRoute(e,t,n,s,i,r,o).pipe(xl(function(e){if(e instanceof Ph)return Zs(null);throw e}))}),ol(),Ml(function(e){return!!e}),xl(function(e,n){if(e instanceof el||"EmptyError"===e.name){if(a.noLeftoversInUrl(t,i,r))return Zs(new Iu([],{}));throw new Ph(t)}throw e}))},e.prototype.noLeftoversInUrl=function(e,t,n){return 0===t.length&&!e.children[n]},e.prototype.expandSegmentAgainstRoute=function(e,t,n,i,r,o,a){return Nh(i)!==o?Mh(t):void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,r):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,i,r,o):Mh(t)},e.prototype.expandSegmentAgainstRouteUsingRedirect=function(e,t,n,i,r,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,i,r,o)},e.prototype.expandWildCardWithParamsAgainstRouteUsingRedirect=function(e,t,n,i){var r=this,o=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Oh(o):this.lineralizeSegments(n,o).pipe(te(function(n){var o=new Iu(n,{});return r.expandSegment(e,o,t,n,i,!1)}))},e.prototype.expandRegularSegmentAgainstRouteUsingRedirect=function(e,t,n,i,r,o){var a=this,s=Dh(t,i,r),l=s.consumedSegments,c=s.lastChild,u=s.positionalParamSegments;if(!s.matched)return Mh(t);var h=this.applyRedirectCommands(l,i.redirectTo,u);return i.redirectTo.startsWith("/")?Oh(h):this.lineralizeSegments(i,h).pipe(te(function(i){return a.expandSegment(e,t,n,i.concat(r.slice(c)),o,!1)}))},e.prototype.matchSegmentAgainstRoute=function(e,t,n,i){var r=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(q(function(e){return n._loadedConfig=e,new Iu(i,{})})):Zs(new Iu(i,{}));var a=Dh(t,n,i),s=a.consumedSegments,c=a.lastChild;if(!a.matched)return Mh(t);var u=i.slice(c);return this.getChildConfig(e,n,i).pipe(te(function(e){var n=e.module,i=e.routes,a=function(e,t,n,i){return n.length>0&&function(e,t,n){return i.some(function(n){return kh(e,t,n)&&Nh(n)!==pu})}(e,n)?{segmentGroup:Lh(new Iu(t,function(e,t){var n,i,r={};r[pu]=t;try{for(var o=l(e),a=o.next();!a.done;a=o.next()){var s=a.value;""===s.path&&Nh(s)!==pu&&(r[Nh(s)]=new Iu([],{}))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r}(i,new Iu(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return i.some(function(n){return kh(e,t,n)})}(e,n)?{segmentGroup:Lh(new Iu(e.segments,function(e,t,n,i){var r,a,s={};try{for(var c=l(n),u=c.next();!u.done;u=c.next()){var h=u.value;kh(e,t,h)&&!i[Nh(h)]&&(s[Nh(h)]=new Iu([],{}))}}catch(d){r={error:d}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return o({},i,s)}(e,n,i,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,s,u,i),c=a.segmentGroup,h=a.slicedSegments;return 0===h.length&&c.hasChildren()?r.expandChildren(n,i,c).pipe(q(function(e){return new Iu(s,e)})):0===i.length&&0===h.length?Zs(new Iu(s,{})):r.expandSegment(n,c,i,h,pu,!0).pipe(q(function(e){return new Iu(s.concat(e.segments),e.children)}))}))},e.prototype.getChildConfig=function(e,t,n){var i=this;return t.children?Zs(new yu(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Zs(t._loadedConfig):function(e,t,n){var i,r=t.canLoad;return r&&0!==r.length?ee(r).pipe(q(function(i){var r,o=e.get(i);if(function(e){return e&&Sh(e.canLoad)}(o))r=o.canLoad(t,n);else{if(!Sh(o))throw new Error("Invalid CanLoad guard");r=o(t,n)}return Mu(r)})).pipe(ol(),(i=function(e){return!0===e},function(e){return e.lift(new Ol(i,void 0,e))})):Zs(!0)}(e.injector,t,n).pipe(te(function(n){return n?i.configLoader.load(e.injector,t).pipe(q(function(e){return t._loadedConfig=e,e})):function(e){return new M(function(t){return t.error(vu("Cannot load children because the guard of the route \"path: '"+e.path+"'\" returned false"))})}(t)})):Zs(new yu([],e))},e.prototype.lineralizeSegments=function(e,t){for(var n=[],i=t.root;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return Zs(n);if(i.numberOfChildren>1||!i.children[pu])return wh(e.redirectTo);i=i.children[pu]}},e.prototype.applyRedirectCommands=function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)},e.prototype.applyRedirectCreatreUrlTree=function(e,t,n,i){var r=this.createSegmentGroup(e,t.root,n,i);return new wu(r,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)},e.prototype.createQueryParams=function(e,t){var n={};return Ru(e,function(e,i){if("string"==typeof e&&e.startsWith(":")){var r=e.substring(1);n[i]=t[r]}else n[i]=e}),n},e.prototype.createSegmentGroup=function(e,t,n,i){var r=this,o=this.createSegments(e,t.segments,n,i),a={};return Ru(t.children,function(t,o){a[o]=r.createSegmentGroup(e,t,n,i)}),new Iu(o,a)},e.prototype.createSegments=function(e,t,n,i){var r=this;return t.map(function(t){return t.path.startsWith(":")?r.findPosParam(e,t,i):r.findOrReturn(t,n)})},e.prototype.findPosParam=function(e,t,n){var i=n[t.path.substring(1)];if(!i)throw new Error("Cannot redirect to '"+e+"'. Cannot find '"+t.path+"'.");return i},e.prototype.findOrReturn=function(e,t){var n,i,r=0;try{for(var o=l(t),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.path===e.path)return t.splice(r),s;r++}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return e},e}();function Dh(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var i=(t.matcher||bu)(n,e,t);return i?{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,positionalParamSegments:i.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Lh(e){if(1===e.numberOfChildren&&e.children[pu]){var t=e.children[pu];return new Iu(e.segments.concat(t.segments),t.children)}return e}function kh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Nh(e){return e.outlet||pu}var Fh=function(){return function(e){this.path=e,this.route=this.path[this.path.length-1]}}(),Bh=function(){return function(e,t){this.component=e,this.route=t}}();function Uh(e,t,n){var i=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(i?i.module.injector:n).get(e)}function Vh(e,t,n,i,r){void 0===r&&(r={canDeactivateChecks:[],canActivateChecks:[]});var o=th(t);return e.children.forEach(function(e){!function(e,t,n,i,r){void 0===r&&(r={canDeactivateChecks:[],canActivateChecks:[]});var o=e.value,a=t?t.value:null,s=n?n.getContext(e.value.outlet):null;if(a&&o.routeConfig===a.routeConfig){var l=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Lu(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Lu(e.url,t.url)||!Su(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!hh(e,t)||!Su(e.queryParams,t.queryParams);case"paramsChange":default:return!hh(e,t)}}(a,o,o.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new Fh(i)):(o.data=a.data,o._resolvedData=a._resolvedData),Vh(e,t,o.component?s?s.children:null:n,i,r),l&&r.canDeactivateChecks.push(new Bh(s&&s.outlet&&s.outlet.component||null,a))}else a&&Gh(t,s,r),r.canActivateChecks.push(new Fh(i)),Vh(e,null,o.component?s?s.children:null:n,i,r)}(e,o[e.value.outlet],n,i.concat([e.value]),r),delete o[e.value.outlet]}),Ru(o,function(e,t){return Gh(e,n.getContext(t),r)}),r}function Gh(e,t,n){var i=th(e),r=e.value;Ru(i,function(e,i){Gh(e,r.component?t?t.children.getContext(i):null:t,n)}),n.canDeactivateChecks.push(new Bh(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}var zh=Symbol("INITIAL_VALUE");function jh(){return Il(function(e){return(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null,i=null;return F(e[e.length-1])&&(i=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&h(e[0])&&(e=e[0]),$(e,i).lift(new nl(n))}).apply(void 0,u(e.map(function(e){return e.pipe(Al(1),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n=e[e.length-1];F(n)?e.pop():n=null;var i=e.length;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ol()(Zs.apply(void 0,e))}(1!==i||n?i>0?$(e,n):Qs(n):qs(e[0]),t)}}(zh))}))).pipe(kl(function(e,t){var n=!1;return t.reduce(function(e,i,r){if(e!==zh)return e;if(i===zh&&(n=!0),!n){if(!1===i)return i;if(r===t.length-1||Ah(i))return i}return e},e)},zh),al(function(e){return e!==zh}),q(function(e){return Ah(e)?e:!0===e}),Al(1))})}function Hh(e,t){return null!==e&&t&&t(new uu(e)),Zs(!0)}function Wh(e,t){return null!==e&&t&&t(new lu(e)),Zs(!0)}function Xh(e,t,n){var i=t.routeConfig?t.routeConfig.canActivate:null;return i&&0!==i.length?Zs(i.map(function(i){return rl(function(){var r,o=Uh(i,t,n);if(function(e){return e&&Sh(e.canActivate)}(o))r=Mu(o.canActivate(t,e));else{if(!Sh(o))throw new Error("Invalid CanActivate guard");r=Mu(o(t,e))}return r.pipe(Ml())})})).pipe(jh()):Zs(!0)}function Yh(e,t,n){var i=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)}).filter(function(e){return null!==e}).map(function(t){return rl(function(){return Zs(t.guards.map(function(r){var o,a=Uh(r,t.node,n);if(function(e){return e&&Sh(e.canActivateChild)}(a))o=Mu(a.canActivateChild(i,e));else{if(!Sh(a))throw new Error("Invalid CanActivateChild guard");o=Mu(a(i,e))}return o.pipe(Ml())})).pipe(jh())})});return Zs(r).pipe(jh())}var Kh=function(){return function(){}}(),Qh=function(){function e(e,t,n,i,r,o){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=i,this.paramsInheritanceStrategy=r,this.relativeLinkResolution=o}return e.prototype.recognize=function(){try{var e=Jh(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,pu),n=new ah([],Object.freeze({}),Object.freeze(o({},this.urlTree.queryParams)),this.urlTree.fragment,{},pu,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new eh(n,t),r=new sh(this.url,i);return this.inheritParamsAndData(r._root),Zs(r)}catch(a){return new M(function(e){return e.error(a)})}},e.prototype.inheritParamsAndData=function(e){var t=this,n=e.value,i=oh(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),e.children.forEach(function(e){return t.inheritParamsAndData(e)})},e.prototype.processSegmentGroup=function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)},e.prototype.processChildren=function(e,t){var n,i=this,r=ku(t,function(t,n){return i.processSegmentGroup(e,t,n)});return n={},r.forEach(function(e){var t=n[e.value.outlet];if(t){var i=t.url.map(function(e){return e.toString()}).join("/"),r=e.value.url.map(function(e){return e.toString()}).join("/");throw new Error("Two segments cannot have the same outlet name: '"+i+"' and '"+r+"'.")}n[e.value.outlet]=e.value}),r.sort(function(e,t){return e.value.outlet===pu?-1:t.value.outlet===pu?1:e.value.outlet.localeCompare(t.value.outlet)}),r},e.prototype.processSegment=function(e,t,n,i){var r,o;try{for(var a=l(e),s=a.next();!s.done;s=a.next()){var c=s.value;try{return this.processSegmentAgainstRoute(c,t,n,i)}catch(u){if(!(u instanceof Kh))throw u}}}catch(h){r={error:h}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}if(this.noLeftoversInUrl(t,n,i))return[];throw new Kh},e.prototype.noLeftoversInUrl=function(e,t,n){return 0===t.length&&!e.children[n]},e.prototype.processSegmentAgainstRoute=function(e,t,n,i){if(e.redirectTo)throw new Kh;if((e.outlet||pu)!==i)throw new Kh;var r,a=[],s=[];if("**"===e.path){var l=n.length>0?Pu(n).parameters:{};r=new ah(n,l,Object.freeze(o({},this.urlTree.queryParams)),this.urlTree.fragment,td(e),i,e.component,e,qh(t),Zh(t)+n.length,nd(e))}else{var c=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new Kh;return{consumedSegments:[],lastChild:0,parameters:{}}}var i=(t.matcher||bu)(n,e,t);if(!i)throw new Kh;var r={};Ru(i.posParams,function(e,t){r[t]=e.path});var a=i.consumed.length>0?o({},r,i.consumed[i.consumed.length-1].parameters):r;return{consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:a}}(t,e,n);a=c.consumedSegments,s=n.slice(c.lastChild),r=new ah(a,c.parameters,Object.freeze(o({},this.urlTree.queryParams)),this.urlTree.fragment,td(e),i,e.component,e,qh(t),Zh(t)+a.length,nd(e))}var u=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),h=Jh(t,a,s,u,this.relativeLinkResolution),d=h.segmentGroup,f=h.slicedSegments;if(0===f.length&&d.hasChildren()){var p=this.processChildren(u,d);return[new eh(r,p)]}if(0===u.length&&0===f.length)return[new eh(r,[])];var g=this.processSegment(u,d,f,pu);return[new eh(r,g)]},e}();function qh(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function Zh(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Jh(e,t,n,i,r){if(n.length>0&&function(e,t,n){return i.some(function(n){return $h(e,t,n)&&ed(n)!==pu})}(e,n)){var a=new Iu(t,function(e,t,n,i){var r,o,a={};a[pu]=i,i._sourceSegment=e,i._segmentIndexShift=t.length;try{for(var s=l(n),c=s.next();!c.done;c=s.next()){var u=c.value;if(""===u.path&&ed(u)!==pu){var h=new Iu([],{});h._sourceSegment=e,h._segmentIndexShift=t.length,a[ed(u)]=h}}}catch(d){r={error:d}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return a}(e,t,i,new Iu(n,e.children)));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return i.some(function(n){return $h(e,t,n)})}(e,n)){var s=new Iu(e.segments,function(e,t,n,i,r,a){var s,c,u={};try{for(var h=l(i),d=h.next();!d.done;d=h.next()){var f=d.value;if($h(e,n,f)&&!r[ed(f)]){var p=new Iu([],{});p._sourceSegment=e,p._segmentIndexShift="legacy"===a?e.segments.length:t.length,u[ed(f)]=p}}}catch(g){s={error:g}}finally{try{d&&!d.done&&(c=h.return)&&c.call(h)}finally{if(s)throw s.error}}return o({},r,u)}(e,t,n,i,e.children,r));return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}var c=new Iu(e.segments,e.children);return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:n}}function $h(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function ed(e){return e.outlet||pu}function td(e){return e.data||{}}function nd(e){return e.resolve||{}}function id(e,t,n,i){var r=Uh(e,t,i);return Mu(r.resolve?r.resolve(t,n):r(t,n))}function rd(e){return function(t){return t.pipe(Il(function(t){var n=e(t);return n?ee(n).pipe(q(function(){return t})):ee([t])}))}}var od=function(){return function(){}}(),ad=function(){function e(){}return e.prototype.shouldDetach=function(e){return!1},e.prototype.store=function(e,t){},e.prototype.shouldAttach=function(e){return!1},e.prototype.retrieve=function(e){return null},e.prototype.shouldReuseRoute=function(e,t){return e.routeConfig===t.routeConfig},e}(),sd=new Be("ROUTES"),ld=function(){function e(e,t,n,i){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=i}return e.prototype.load=function(e,t){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(q(function(i){n.onLoadEndListener&&n.onLoadEndListener(t);var r=i.create(e);return new yu(Au(r.injector.get(sd)).map(Cu),r)}))},e.prototype.loadModuleFactory=function(e){var t=this;return"string"==typeof e?ee(this.loader.load(e)):Mu(e()).pipe(te(function(e){return e instanceof ln?Zs(e):ee(t.compiler.compileModuleAsync(e))}))},e}(),cd=function(){return function(){}}(),ud=function(){function e(){}return e.prototype.shouldProcessUrl=function(e){return!0},e.prototype.extract=function(e){return e},e.prototype.merge=function(e,t){return e},e}();function hd(e){throw e}function dd(e,t,n){return t.parse("/")}function fd(e,t){return Zs(null)}var pd=function(){function e(e,t,n,i,r,o,a,s){var l=this;this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=i,this.config=s,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new k,this.errorHandler=hd,this.malformedUriErrorHandler=dd,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:fd,afterPreactivation:fd},this.urlHandlingStrategy=new ud,this.routeReuseStrategy=new ad,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=r.get(sn),this.console=r.get(jr);var c=r.get(ao);this.isNgZoneEnabled=c instanceof ao,this.resetConfig(s),this.currentUrlTree=new wu(new Iu([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new ld(o,a,function(e){return l.triggerEvent(new au(e))},function(e){return l.triggerEvent(new su(e))}),this.routerState=ih(this.currentUrlTree,this.rootComponentType),this.transitions=new Js({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return e.prototype.setupNavigations=function(e){var t=this,n=this.events;return e.pipe(al(function(e){return 0!==e.id}),q(function(e){return o({},e,{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})}),Il(function(e){var i,r,a,s,c=!1,u=!1;return Zs(e).pipe(pl(function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?o({},t.lastSuccessfulNavigation,{previousNavigation:null}):null}}),Il(function(e){var i,r,a,s,l=!t.navigated||e.extractedUrl.toString()!==t.browserUrlTree.toString();if(("reload"===t.onSameUrlNavigation||l)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return Zs(e).pipe(Il(function(e){var i=t.transitions.getValue();return n.next(new Zc(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),i!==t.transitions.getValue()?Ks:[e]}),Il(function(e){return Promise.resolve(e)}),(i=t.ngModule.injector,r=t.configLoader,a=t.urlSerializer,s=t.config,function(e){return e.pipe(Il(function(e){return function(t,n,i,r,o){return new Ih(t,n,i,e.extractedUrl,o).apply()}(i,r,a,0,s).pipe(q(function(t){return o({},e,{urlAfterRedirects:t})}))}))}),pl(function(e){t.currentNavigation=o({},t.currentNavigation,{finalUrl:e.urlAfterRedirects})}),function(e,n,i,r,a){return function(i){return i.pipe(te(function(i){return function(e,t,n,i,r,o){return void 0===r&&(r="emptyOnly"),void 0===o&&(o="legacy"),new Qh(e,t,n,i,r,o).recognize()}(e,n,i.urlAfterRedirects,(s=i.urlAfterRedirects,t.serializeUrl(s)),r,a).pipe(q(function(e){return o({},i,{targetSnapshot:e})}));var s}))}}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),pl(function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)}),pl(function(e){var i=new tu(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(i)}));if(l&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var c=e.extractedUrl,u=e.source,h=e.restoredState,d=e.extras,f=new Zc(e.id,t.serializeUrl(c),u,h);n.next(f);var p=ih(c,t.rootComponentType).snapshot;return Zs(o({},e,{targetSnapshot:p,urlAfterRedirects:c,extras:o({},d,{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Ks}),rd(function(e){var n=e.extras;return t.hooks.beforePreactivation(e.targetSnapshot,{navigationId:e.id,appliedUrlTree:e.extractedUrl,rawUrlTree:e.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),pl(function(e){var n=new nu(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),q(function(e){return o({},e,{guards:(n=e.targetSnapshot,i=e.currentSnapshot,r=t.rootContexts,a=n._root,Vh(a,i?i._root:null,r,[a.value]))});var n,i,r,a}),function(e,t){return function(n){return n.pipe(te(function(n){var i=n.targetSnapshot,r=n.currentSnapshot,a=n.guards,s=a.canActivateChecks,l=a.canDeactivateChecks;return 0===l.length&&0===s.length?Zs(o({},n,{guardsResult:!0})):function(e,t,n,i){return ee(l).pipe(te(function(e){return function(e,t,n,i,r){var o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?Zs(o.map(function(o){var a,s=Uh(o,t,r);if(function(e){return e&&Sh(e.canDeactivate)}(s))a=Mu(s.canDeactivate(e,t,n,i));else{if(!Sh(s))throw new Error("Invalid CanDeactivate guard");a=Mu(s(e,t,n,i))}return a.pipe(Ml())})).pipe(jh()):Zs(!0)}(e.component,e.route,n,t,i)}),Ml(function(e){return!0!==e},!0))}(0,i,r,e).pipe(te(function(n){return n&&"boolean"==typeof n?function(e,t,n,i){return ee(s).pipe(Bl(function(t){return ee([Wh(t.route.parent,i),Hh(t.route,i),Yh(e,t.path,n),Xh(e,t.route,n)]).pipe(ol(),Ml(function(e){return!0!==e},!0))}),Ml(function(e){return!0!==e},!0))}(i,0,e,t):Zs(n)}),q(function(e){return o({},n,{guardsResult:e})}))}))}}(t.ngModule.injector,function(e){return t.triggerEvent(e)}),pl(function(e){if(Ah(e.guardsResult)){var n=vu('Redirecting to "'+t.serializeUrl(e.guardsResult)+'"');throw n.url=e.guardsResult,n}}),pl(function(e){var n=new iu(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(n)}),al(function(e){if(!e.guardsResult){t.resetUrlToCurrentUrlTree();var i=new $c(e.id,t.serializeUrl(e.extractedUrl),"");return n.next(i),e.resolve(!1),!1}return!0}),rd(function(e){if(e.guards.canActivateChecks.length)return Zs(e).pipe(pl(function(e){var n=new ru(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}),(n=t.paramsInheritanceStrategy,i=t.ngModule.injector,function(e){return e.pipe(te(function(e){var t=e.targetSnapshot,r=e.guards.canActivateChecks;return r.length?ee(r).pipe(Bl(function(e){return function(e,n,i,r){return function(e,t,n,i){var r=Object.keys(e);if(0===r.length)return Zs({});if(1===r.length){var o=r[0];return id(e[o],t,n,i).pipe(q(function(e){var t;return(t={})[o]=e,t}))}var a={};return ee(r).pipe(te(function(r){return id(e[r],t,n,i).pipe(q(function(e){return a[r]=e,e}))})).pipe(El(),q(function(){return a}))}(e._resolve,e,t,r).pipe(q(function(t){return e._resolvedData=t,e.data=o({},e.data,oh(e,i).resolve),null}))}(e.route,0,n,i)}),function(e,t){return arguments.length>=2?function(t){return P(kl(e,void 0),hl(1),bl(void 0))(t)}:function(t){return P(kl(function(t,n,i){return e(t)}),hl(1))(t)}}(function(e,t){return e}),q(function(t){return e})):Zs(e)}))}),pl(function(e){var n=new ou(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)}));var n,i}),rd(function(e){var n=e.extras;return t.hooks.afterPreactivation(e.targetSnapshot,{navigationId:e.id,appliedUrlTree:e.extractedUrl,rawUrlTree:e.rawUrl,skipLocationChange:!!n.skipLocationChange,replaceUrl:!!n.replaceUrl})}),q(function(e){var n,i,r,a=(r=function e(t,n,i){if(i&&t.shouldReuseRoute(n.value,i.value.snapshot)){(c=i.value)._futureSnapshot=n.value;var r=function(t,n,i){return n.children.map(function(n){var r,o;try{for(var a=l(i.children),s=a.next();!s.done;s=a.next()){var c=s.value;if(t.shouldReuseRoute(c.value.snapshot,n.value))return e(t,n,c)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return e(t,n)})}(t,n,i);return new eh(c,r)}var o=t.retrieve(n.value);if(o){var a=o.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(var i=0;i<t.children.length;++i)e(t.children[i],n.children[i])}(n,a),a}var s,c=new rh(new Js((s=n.value).url),new Js(s.params),new Js(s.queryParams),new Js(s.fragment),new Js(s.data),s.outlet,s.component,s);return r=n.children.map(function(n){return e(t,n)}),new eh(c,r)}(t.routeReuseStrategy,(n=e.targetSnapshot)._root,(i=e.currentRouterState)?i._root:void 0),new nh(r,n));return o({},e,{targetRouterState:a})}),pl(function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(t.currentUrlTree,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)}),(r=t.rootContexts,a=t.routeReuseStrategy,s=function(e){return t.triggerEvent(e)},q(function(e){return new xh(a,e.targetRouterState,e.currentRouterState,s).activate(r),e})),pl({next:function(){c=!0},complete:function(){c=!0}}),(i=function(){if(!c&&!u){t.resetUrlToCurrentUrlTree();var i=new $c(e.id,t.serializeUrl(e.extractedUrl),"Navigation ID "+e.id+" is not equal to the current navigation id "+t.navigationId);n.next(i),e.resolve(!1)}t.currentNavigation=null},function(e){return e.lift(new Ul(i))}),xl(function(i){if(u=!0,(s=i)&&s[_u]){var r=Ah(i.url);r||(t.navigated=!0,t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));var o=new $c(e.id,t.serializeUrl(e.extractedUrl),i.message);n.next(o),e.resolve(!1),r&&t.navigateByUrl(i.url)}else{t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);var a=new eu(e.id,t.serializeUrl(e.extractedUrl),i);n.next(a);try{e.resolve(t.errorHandler(i))}catch(l){e.reject(l)}}var s;return Ks}))}))},e.prototype.resetRootComponentType=function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType},e.prototype.getTransition=function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e},e.prototype.setTransition=function(e){this.transitions.next(o({},this.getTransition(),e))},e.prototype.initialNavigation=function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})},e.prototype.setUpLocationChangeListener=function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe(function(t){var n=e.parseUrl(t.url),i="popstate"===t.type?"popstate":"hashchange",r=t.state&&t.state.navigationId?t.state:null;setTimeout(function(){e.scheduleNavigation(n,i,r,{replaceUrl:!0})},0)}))},Object.defineProperty(e.prototype,"url",{get:function(){return this.serializeUrl(this.currentUrlTree)},enumerable:!0,configurable:!0}),e.prototype.getCurrentNavigation=function(){return this.currentNavigation},e.prototype.triggerEvent=function(e){this.events.next(e)},e.prototype.resetConfig=function(e){Tu(e),this.config=e.map(Cu),this.navigated=!1,this.lastSuccessfulId=-1},e.prototype.ngOnDestroy=function(){this.dispose()},e.prototype.dispose=function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)},e.prototype.createUrlTree=function(e,t){void 0===t&&(t={});var n=t.relativeTo,i=t.queryParams,r=t.fragment,a=t.preserveQueryParams,s=t.queryParamsHandling,l=t.preserveFragment;ft()&&a&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var c=n||this.routerState.root,h=l?this.currentUrlTree.fragment:r,d=null;if(s)switch(s){case"merge":d=o({},this.currentUrlTree.queryParams,i);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=i||null}else d=a?this.currentUrlTree.queryParams:i||null;return null!==d&&(d=this.removeEmptyProps(d)),function(e,t,n,i,r){if(0===n.length)return fh(t.root,t.root,t,i,r);var o=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new ph(!0,0,e);var t=0,n=!1,i=e.reduce(function(e,i,r){if("object"==typeof i&&null!=i){if(i.outlets){var o={};return Ru(i.outlets,function(e,t){o[t]="string"==typeof e?e.split("/"):e}),u(e,[{outlets:o}])}if(i.segmentPath)return u(e,[i.segmentPath])}return"string"!=typeof i?u(e,[i]):0===r?(i.split("/").forEach(function(i,r){0==r&&"."===i||(0==r&&""===i?n=!0:".."===i?t++:""!=i&&e.push(i))}),e):u(e,[i])},[]);return new ph(n,t,i)}(n);if(o.toRoot())return fh(t.root,new Iu([],{}),t,i,r);var a=function(e,n,i){if(e.isAbsolute)return new gh(t.root,!0,0);if(-1===i.snapshot._lastPathIndex)return new gh(i.snapshot._urlSegment,!0,0);var r=dh(e.commands[0])?0:1;return function(t,n,o){for(var a=i.snapshot._urlSegment,s=i.snapshot._lastPathIndex+r,l=e.numberOfDoubleDots;l>s;){if(l-=s,!(a=a.parent))throw new Error("Invalid number of '../'");s=a.segments.length}return new gh(a,!1,s-l)}()}(o,0,e),s=a.processChildren?vh(a.segmentGroup,a.index,o.commands):_h(a.segmentGroup,a.index,o.commands);return fh(a.segmentGroup,s,t,i,r)}(c,this.currentUrlTree,e,d,h)},e.prototype.navigateByUrl=function(e,t){void 0===t&&(t={skipLocationChange:!1}),ft()&&this.isNgZoneEnabled&&!ao.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=Ah(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(i,"imperative",null,t)},e.prototype.navigate=function(e,t){return void 0===t&&(t={skipLocationChange:!1}),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains "+n+" segment at index "+t)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)},e.prototype.serializeUrl=function(e){return this.urlSerializer.serialize(e)},e.prototype.parseUrl=function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t},e.prototype.isActive=function(e,t){if(Ah(e))return Ou(this.currentUrlTree,e,t);var n=this.parseUrl(e);return Ou(this.currentUrlTree,n,t)},e.prototype.removeEmptyProps=function(e){return Object.keys(e).reduce(function(t,n){var i=e[n];return null!=i&&(t[n]=i),t},{})},e.prototype.processNavigations=function(){var e=this;this.navigations.subscribe(function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.events.next(new Jc(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,e.currentNavigation=null,t.resolve(!0)},function(t){e.console.warn("Unhandled Navigation Error: ")})},e.prototype.scheduleNavigation=function(e,t,n,i){var r=this.getTransition();if(r&&"imperative"!==t&&"imperative"===r.source&&r.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(r&&"hashchange"==t&&"popstate"===r.source&&r.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(r&&"popstate"==t&&"hashchange"===r.source&&r.rawUrl.toString()===e.toString())return Promise.resolve(!0);var o=null,a=null,s=new Promise(function(e,t){o=e,a=t}),l=++this.navigationId;return this.setTransition({id:l,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:i,resolve:o,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch(function(e){return Promise.reject(e)})},e.prototype.setBrowserUrl=function(e,t,n,i){var r=this.urlSerializer.serialize(e);i=i||{},this.location.isCurrentPathEqualTo(r)||t?this.location.replaceState(r,"",o({},i,{navigationId:n})):this.location.go(r,"",o({},i,{navigationId:n}))},e.prototype.resetStateAndUrl=function(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()},e.prototype.resetUrlToCurrentUrlTree=function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})},e}(),gd=function(){function e(e,t,n){var i=this;this.router=e,this.route=t,this.locationStrategy=n,this.commands=[],this.subscription=e.events.subscribe(function(e){e instanceof Jc&&i.updateTargetUrlAndHref()})}return Object.defineProperty(e.prototype,"routerLink",{set:function(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveQueryParams",{set:function(e){ft()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead."),this.preserve=e},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.updateTargetUrlAndHref()},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.onClick=function(e,t,n,i){if(0!==e||t||n||i)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0;var r={skipLocationChange:md(this.skipLocationChange),replaceUrl:md(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,r),!1},e.prototype.updateTargetUrlAndHref=function(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))},Object.defineProperty(e.prototype,"urlTree",{get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:md(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:md(this.preserveFragment)})},enumerable:!0,configurable:!0}),a([Lr("attr.target"),Dr(),s("design:type",String)],e.prototype,"target",void 0),e}();function md(e){return""===e||!!e}var _d=function(){return function(){this.outlet=null,this.route=null,this.resolver=null,this.children=new vd,this.attachRef=null}}(),vd=function(){function e(){this.contexts=new Map}return e.prototype.onChildOutletCreated=function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)},e.prototype.onChildOutletDestroyed=function(e){var t=this.getContext(e);t&&(t.outlet=null)},e.prototype.onOutletDeactivated=function(){var e=this.contexts;return this.contexts=new Map,e},e.prototype.onOutletReAttached=function(e){this.contexts=e},e.prototype.getOrCreateContext=function(e){var t=this.getContext(e);return t||(t=new _d,this.contexts.set(e,t)),t},e.prototype.getContext=function(e){return this.contexts.get(e)||null},e}(),bd=function(){function e(e,t,n,i,r){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=r,this.activated=null,this._activatedRoute=null,this.activateEvents=new Or,this.deactivateEvents=new Or,this.name=i||pu,e.onChildOutletCreated(this.name,this)}return e.prototype.ngOnDestroy=function(){this.parentContexts.onChildOutletDestroyed(this.name)},e.prototype.ngOnInit=function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}},Object.defineProperty(e.prototype,"isActivated",{get:function(){return!!this.activated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"component",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activatedRoute",{get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activatedRouteData",{get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}},enumerable:!0,configurable:!0}),e.prototype.detach=function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e},e.prototype.attach=function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)},e.prototype.deactivate=function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}},e.prototype.activateWith=function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),i=this.parentContexts.getOrCreateContext(this.name).children,r=new yd(e,i,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,r),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)},e}(),yd=function(){function e(e,t,n){this.route=e,this.childContexts=t,this.parent=n}return e.prototype.get=function(e,t){return e===rh?this.route:e===vd?this.childContexts:this.parent.get(e,t)},e}(),Td=function(){return function(){}}(),Ed=function(){function e(){}return e.prototype.preload=function(e,t){return t().pipe(xl(function(){return Zs(null)}))},e}(),xd=function(){function e(){}return e.prototype.preload=function(e,t){return Zs(null)},e}(),Cd=function(){function e(e,t,n,i,r){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=new ld(t,n,function(t){return e.triggerEvent(new au(t))},function(t){return e.triggerEvent(new su(t))})}return e.prototype.setUpPreloading=function(){var e=this;this.subscription=this.router.events.pipe(al(function(e){return e instanceof Jc}),Bl(function(){return e.preload()})).subscribe(function(){})},e.prototype.preload=function(){var e=this.injector.get(sn);return this.processRoutes(e,this.router.config)},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.processRoutes=function(e,t){var n,i,r=[];try{for(var o=l(t),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.loadChildren&&!s.canLoad&&s._loadedConfig){var c=s._loadedConfig;r.push(this.processRoutes(c.module,c.routes))}else s.loadChildren&&!s.canLoad?r.push(this.preloadConfig(e,s)):s.children&&r.push(this.processRoutes(e,s.children))}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return ee(r).pipe(oe(),q(function(e){}))},e.prototype.preloadConfig=function(e,t){var n=this;return this.preloadingStrategy.preload(t,function(){return n.loader.load(e.injector,t).pipe(te(function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)}))})},e}(),Sd=function(){function e(e,t,n){void 0===n&&(n={}),this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}return e.prototype.init=function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()},e.prototype.createScrollEvents=function(){var e=this;return this.router.events.subscribe(function(t){t instanceof Zc?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Jc&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))})},e.prototype.consumeScrollEvents=function(){var e=this;return this.router.events.subscribe(function(t){t instanceof du&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))})},e.prototype.scheduleScrollEvent=function(e,t){this.router.triggerEvent(new du(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))},e.prototype.ngOnDestroy=function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()},e}(),Ad=new Be("ROUTER_CONFIGURATION"),Pd=new Be("ROUTER_FORROOT_GUARD"),Rd=[Ts,{provide:Nu,useClass:Fu},{provide:pd,useFactory:kd,deps:[Co,Nu,vd,Ts,je,Ir,Zr,sd,Ad,[cd,new ye],[od,new ye]]},vd,{provide:rh,useFactory:Nd,deps:[pd]},{provide:Ir,useClass:Ro},Cd,xd,Ed,{provide:Ad,useValue:{enableTracing:!1}}];function Md(){return new bo("Router",pd)}var Od=function(){function e(e,t){}var t;return t=e,e.forRoot=function(e,n){return{ngModule:t,providers:[Rd,Ld(e),{provide:Pd,useFactory:Dd,deps:[[pd,new ye,new Ee]]},{provide:Ad,useValue:n||{}},{provide:bs,useFactory:Id,deps:[_s,[new be(ys),new ye],Ad]},{provide:Sd,useFactory:wd,deps:[pd,Xs,Ad]},{provide:Td,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:xd},{provide:bo,multi:!0,useFactory:Md},[Fd,{provide:kr,multi:!0,useFactory:Bd,deps:[Fd]},{provide:Vd,useFactory:Ud,deps:[Fd]},{provide:zr,multi:!0,useExisting:Vd}]]}},e.forChild=function(e){return{ngModule:t,providers:[Ld(e)]}},e}();function wd(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Sd(e,t,n)}function Id(e,t,n){return void 0===n&&(n={}),n.useHash?new xs(e,t):new Cs(e,t)}function Dd(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Ld(e){return[{provide:rt,multi:!0,useValue:e},{provide:sd,multi:!0,useValue:e}]}function kd(e,t,n,i,r,o,a,s,l,c,u){void 0===l&&(l={});var h=new pd(null,t,n,i,r,o,a,Au(s));if(c&&(h.urlHandlingStrategy=c),u&&(h.routeReuseStrategy=u),l.errorHandler&&(h.errorHandler=l.errorHandler),l.malformedUriErrorHandler&&(h.malformedUriErrorHandler=l.malformedUriErrorHandler),l.enableTracing){var d=zl();h.events.subscribe(function(e){d.logGroup("Router Event: "+e.constructor.name),d.log(e.toString()),d.log(e),d.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),l.urlUpdateStrategy&&(h.urlUpdateStrategy=l.urlUpdateStrategy),l.relativeLinkResolution&&(h.relativeLinkResolution=l.relativeLinkResolution),h}function Nd(e){return e.routerState.root}var Fd=function(){function e(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new k}return e.prototype.appInitializer=function(){var e=this;return this.injector.get(vs,Promise.resolve(null)).then(function(){var t=null,n=new Promise(function(e){return t=e}),i=e.injector.get(pd),r=e.injector.get(Ad);if(e.isLegacyDisabled(r)||e.isLegacyEnabled(r))t(!0);else if("disabled"===r.initialNavigation)i.setUpLocationChangeListener(),t(!0);else{if("enabled"!==r.initialNavigation)throw new Error("Invalid initialNavigation options: '"+r.initialNavigation+"'");i.hooks.afterPreactivation=function(){return e.initNavigation?Zs(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},i.initialNavigation()}return n})},e.prototype.bootstrapListener=function(e){var t=this.injector.get(Ad),n=this.injector.get(Cd),i=this.injector.get(Sd),r=this.injector.get(pd),o=this.injector.get(Co);e===o.components[0]&&(this.isLegacyEnabled(t)?r.initialNavigation():this.isLegacyDisabled(t)&&r.setUpLocationChangeListener(),n.setUpPreloading(),i.init(),r.resetRootComponentType(o.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())},e.prototype.isLegacyEnabled=function(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation},e.prototype.isLegacyDisabled=function(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation},e}();function Bd(e){return e.appInitializer.bind(e)}function Ud(e){return e.bootstrapListener.bind(e)}var Vd=new Be("Router Initializer"),Gd=ti({encapsulation:2,styles:[],data:{}});function zd(e){return la(0,[(e()(),Ho(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),fr(1,212992,null,0,bd,[vd,Fn,rn,[8,null],On],null,null)],function(e,t){e(t,1,0)},null)}function jd(e){return la(0,[(e()(),Ho(0,0,null,null,1,"ng-component",[],null,null,null,zd,Gd)),fr(1,49152,null,0,fu,[],null,null)],null,null)}var Hd=ji("ng-component",fu,jd,{},{},[]),Wd=function(){return function(){}}(),Xd=ti({encapsulation:0,styles:[["div.startup[_ngcontent-%COMP%]{height:100%;background-position:center;background-repeat:no-repeat;background-size:100% 100%}#startup-nav-container[_ngcontent-%COMP%]{position:fixed;bottom:0;width:100%;height:20%;background-color:#575b5a;opacity:.7;display:flex;justify-content:center;align-items:center}#startup-nav-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:120px;height:48px;margin:0 5px;display:inline-block;background-size:100% 100%}"]],data:{}});function Yd(e){return la(0,[(e()(),Ho(0,0,null,null,13,"div",[["class","startup"],["style","background-image:url('./assets/images/startup-background.jpg')"]],null,null,null,null,null)),(e()(),Ho(1,0,null,null,12,"div",[["id","startup-nav-container"]],null,null,null,null,null)),(e()(),Ho(2,0,null,null,2,"a",[["style","background-image:url('./assets/images/introduction-unclick.png')"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,3).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),i},null,null)),fr(3,671744,null,0,gd,[pd,rh,bs],{routerLink:[0,"routerLink"]},null),na(4,1),(e()(),Ho(5,0,null,null,2,"a",[["style","background-image:url('./assets/images/location-unclick.png')"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,6).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),i},null,null)),fr(6,671744,null,0,gd,[pd,rh,bs],{routerLink:[0,"routerLink"]},null),na(7,1),(e()(),Ho(8,0,null,null,2,"a",[["style","background-image:url('./assets/images/sandbox-unclick.png')"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,9).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),i},null,null)),fr(9,671744,null,0,gd,[pd,rh,bs],{routerLink:[0,"routerLink"]},null),na(10,1),(e()(),Ho(11,0,null,null,2,"a",[["style","background-image:url('./assets/images/panorama-unclick.png')"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,12).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),i},null,null)),fr(12,671744,null,0,gd,[pd,rh,bs],{routerLink:[0,"routerLink"]},null),na(13,1)],function(e,t){var n=e(t,4,0,"/introduction");e(t,3,0,n);var i=e(t,7,0,"/location");e(t,6,0,i);var r=e(t,10,0,"/sandbox");e(t,9,0,r);var o=e(t,13,0,"/panorama");e(t,12,0,o)},function(e,t){e(t,2,0,er(t,3).target,er(t,3).href),e(t,5,0,er(t,6).target,er(t,6).href),e(t,8,0,er(t,9).target,er(t,9).href),e(t,11,0,er(t,12).target,er(t,12).href)})}function Kd(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-startup",[],null,null,null,Yd,Xd)),fr(1,49152,null,0,Wd,[],null,null)],null,null)}var Qd=ji("app-startup",Wd,Kd,{},{},[]),qd=function(){function e(){this._accessors=[]}return e.prototype.add=function(e,t){this._accessors.push([e,t])},e.prototype.remove=function(e){for(var t=this._accessors.length-1;t>=0;--t)if(this._accessors[t][1]===e)return void this._accessors.splice(t,1)},e.prototype.select=function(e){var t=this;this._accessors.forEach(function(n){t._isSameGroup(n,e)&&n[1]!==e&&n[1].fireUncheck(e.value)})},e.prototype._isSameGroup=function(e,t){return!!e[0].control&&e[0]._parent===t._control._parent&&e[1].name===t.name},e}(),Zd=new Be("NgFormSelectorWarning"),Jd=function(){return function(){}}(),$d=function(){function e(){}var t;return t=e,e.withConfig=function(e){return{ngModule:t,providers:[{provide:Zd,useValue:e.warnOnDeprecatedNgFormSelector}]}},e}(),ef=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return r(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,i=void 0;try{this.work(e)}catch(r){n=!0,i=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return r(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(m)),tf=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),nf=function(e){function t(n,i){void 0===i&&(i=tf.now);var r=e.call(this,n,function(){return t.delegate&&t.delegate!==r?t.delegate.now():i()})||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return r(t,e),t.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,i,r):e.prototype.schedule.call(this,n,i,r)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(tf);function rf(e,t,n,i){return f(n)&&(i=n,n=void 0),i?rf(e,t,n).pipe(q(function(e){return h(e)?i.apply(void 0,e):i(e)})):new M(function(i){!function e(t,n,i,r,o){var a;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var s=t;t.addEventListener(n,i,o),a=function(){return s.removeEventListener(n,i,o)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var l=t;t.on(n,i),a=function(){return l.off(n,i)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var c=t;t.addListener(n,i),a=function(){return c.removeListener(n,i)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var u=0,h=t.length;u<h;u++)e(t[u],n,i,r,o)}r.add(a)}(e,t,function(e){i.next(arguments.length>1?Array.prototype.slice.call(arguments):e)},i,n)})}var of=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return r(t,e),t.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),null!==i&&i>0?e.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,i);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(ef),af=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,i=-1,r=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++i<r&&(e=n.shift()));if(this.active=!1,t){for(;++i<r&&(e=n.shift());)e.unsubscribe();throw t}},t}(nf))(of),sf=function(){return function(){}}(),lf=function(){return function(){}}(),cf=function(){function e(e,t){this.el=e,this.renderer=t,this.color="",this.rounded=!1,this.gradient="",this.outline=!1,this.flat=!1,this.size="",this.block=!1,this.floating=!1}return e.prototype.ngOnInit=function(){var e="btn-"+this.color,t=this.gradient+"-gradient",n="btn-outline-"+this.color,i="btn-"+this.size;this.renderer.addClass(this.el.nativeElement,"btn"),""!==this.color&&this.renderer.addClass(this.el.nativeElement,e),this.rounded&&this.renderer.addClass(this.el.nativeElement,"btn-rounded"),this.gradient&&(""!==this.color&&this.renderer.removeClass(this.el.nativeElement,e),this.renderer.addClass(this.el.nativeElement,t)),this.outline&&(this.renderer.removeClass(this.el.nativeElement,e),this.renderer.addClass(this.el.nativeElement,n)),this.flat&&(this.color&&this.renderer.removeClass(this.el.nativeElement,e),this.gradient&&this.renderer.removeClass(this.el.nativeElement,t),this.outline&&this.renderer.removeClass(this.el.nativeElement,n),this.rounded&&this.renderer.removeClass(this.el.nativeElement,"btn-rounded"),this.renderer.addClass(this.el.nativeElement,"btn-flat")),this.size&&this.renderer.addClass(this.el.nativeElement,i),this.block&&this.renderer.addClass(this.el.nativeElement,"btn-block"),this.floating&&(this.renderer.removeClass(this.el.nativeElement,"btn"),this.renderer.addClass(this.el.nativeElement,"btn-floating"))},e}(),uf=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),hf=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),df="undefined"!=typeof window&&window||{},ff=df.document;function pf(){return"bs4"===df.__theme}var gf=function(){function e(e){this.animated=!1,this.directionNext=!1,this.directionLeft=!1,this.directionPrev=!1,this.directionRight=!1,this.el=null,this.el=e}return e.prototype.ngOnInit=function(){},e.prototype.ngOnDestroy=function(){},e}(),mf=function(){return function(){this.interval=5e3,this.noPause=!1,this.noWrap=!1,this.keyboard=!1}}(),_f=function(){var e={UNKNOWN:0,NEXT:1,PREV:2};return e[e.UNKNOWN]="UNKNOWN",e[e.NEXT]="NEXT",e[e.PREV]="PREV",e}(),vf=function(){function e(e,t,n,i,r){this.cdRef=i,this.renderer=r,this.SWIPE_ACTION={LEFT:"swipeleft",RIGHT:"swiperight"},this.destroyed=!1,this.el=null,this.animationEnd=!0,this.isBrowser=!1,this.isControls=!0,this.class="",this.type="",this.animation="",this.activeSlideChange=new Or(!1),this.isBrowser=Ws(n),Object.assign(this,e),this.el=t}return Object.defineProperty(e.prototype,"slides",{get:function(){return this._slidesList.toArray()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeSlide",{get:function(){return this._currentActiveSlide},set:function(e){this._slidesList&&e!==this._currentActiveSlide&&this._select(e)},enumerable:!0,configurable:!0}),e.prototype.checkNavigation=function(){return"carousel-multi-item"!==this.type},e.prototype.checkDots=function(){return"carousel-thumbnails"!==this.type},e.prototype.getImg=function(e){return e.el.nativeElement.querySelector("img").src},Object.defineProperty(e.prototype,"interval",{get:function(){return this._interval},set:function(e){this._interval=e,this.restartTimer()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBs4",{get:function(){return!pf()},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this.destroyed=!0},e.prototype.ngAfterViewInit=function(){var e=this;this._slidesList.changes.subscribe(function(t){e._slidesList=t,setTimeout(function(){e._select(0)},0)}),this.activeSlideIndex?setTimeout(function(){e._select(e.activeSlideIndex),e.activeSlideChange.emit({relatedTarget:e.activeSlide})},0):setTimeout(function(){e._select(0)},0),this.isControls&&(this.carouselIndicators=this.el.nativeElement.querySelectorAll(".carousel-indicators > li"),this.carouselIndicators.length&&this.activeSlideIndex?this.renderer.addClass(this.carouselIndicators[this.activeSlideIndex],"active"):this.carouselIndicators.length&&this.renderer.addClass(this.carouselIndicators[0],"active"))},e.prototype.swipe=function(e){void 0===e&&(e=this.SWIPE_ACTION.RIGHT),e===this.SWIPE_ACTION.RIGHT&&(this.previousSlide(),this.cdRef.markForCheck()),e===this.SWIPE_ACTION.LEFT&&(this.nextSlide(),this.cdRef.markForCheck())},e.prototype.nextSlide=function(e){if(void 0===e&&(e=!1),"slide"===this.animation){this.pause();var t=_f.NEXT;this.slideAnimation(this.findNextSlideIndex(t,e),t),this.cdRef.markForCheck()}else"fade"===this.animation?(this.pause(),this.fadeAnimation(this.findNextSlideIndex(_f.NEXT,e),_f.NEXT),this.cdRef.markForCheck()):(this.activeSlide=this.findNextSlideIndex(_f.NEXT,e),this.cdRef.markForCheck());this.animation||this.activeSlideChange.emit({direction:"Next",relatedTarget:this.activeSlide})},e.prototype.previousSlide=function(e){if(void 0===e&&(e=!1),"slide"===this.animation){this.pause();var t=_f.PREV;this.slideAnimation(this.findNextSlideIndex(t,e),t),this.cdRef.markForCheck()}else"fade"===this.animation?(this.pause(),this.fadeAnimation(this.findNextSlideIndex(_f.PREV,e),_f.PREV),this.cdRef.markForCheck()):(this.activeSlide=this.findNextSlideIndex(_f.PREV,e),this.cdRef.markForCheck());this.animation||this.activeSlideChange.emit({direction:"Prev",relatedTarget:this.activeSlide})},e.prototype.fadeAnimation=function(e,t){var n=this,i=this.slides[e];this.animationEnd&&(this.animationEnd=!1,i.directionNext=!0,this.isBrowser&&setTimeout(function(){var r=n.slides[n._currentActiveSlide].el.nativeElement;n.renderer.setStyle(r,"opacity","0"),n.renderer.setStyle(r,"transition","all 600ms"),n.renderer.setStyle(r,"display","block"),n.renderer.setStyle(i.el.nativeElement,"display","block"),n.renderer.setStyle(i.el.nativeElement,"opacity","1"),n.renderer.setStyle(i.el.nativeElement,"transition","all 600ms"),1===t?n.activeSlideChange.emit({direction:"Next",relatedTarget:n.activeSlide}):2===t&&n.activeSlideChange.emit({direction:"Prev",relatedTarget:n.activeSlide}),i.directionNext=!1,n.animationEnd=!0,n.activeSlide=e,n.activeSlideChange.emit({direction:"Next",relatedTarget:n.activeSlide}),n.play(),n.cdRef.markForCheck()},0))},e.prototype.slideAnimation=function(e,t){var n=this,i=this.slides[this._currentActiveSlide],r=this.slides[e];this.animationEnd&&(t===_f.NEXT&&(this.animationEnd=!1,r.directionNext=!0,this.isBrowser&&setTimeout(function(){r.directionLeft=!0,i.directionLeft=!0,n.cdRef.markForCheck()},100)),t===_f.PREV&&(this.animationEnd=!1,r.directionPrev=!0,this.isBrowser&&setTimeout(function(){r.directionRight=!0,i.directionRight=!0,n.cdRef.markForCheck()},100)),this.isBrowser&&setTimeout(function(){var o;r.directionLeft=!1,r.directionNext=!1,i.directionLeft=!1,i.directionNext=!1,r.directionRight=!1,r.directionPrev=!1,i.directionRight=!1,i.directionPrev=!1,n.animationEnd=!0,n.activeSlide=e,t===_f.NEXT?o="Next":t===_f.PREV&&(o="Prev"),n.activeSlideChange.emit({direction:o,relatedTarget:n.activeSlide}),n.play(),n.cdRef.markForCheck()},700))},e.prototype.selectSlide=function(e){this.pause(),"slide"===this.animation?this.activeSlide<e?this.slideAnimation(e,_f.NEXT):this.activeSlide>e&&this.slideAnimation(e,_f.PREV):"fade"===this.animation&&e!==this.activeSlide&&this.fadeAnimation(e),this.play()},e.prototype.play=function(){this.isPlaying||(this.isPlaying=!0,this.restartTimer())},e.prototype.pause=function(){this.noPause||(this.isPlaying=!1,this.resetTimer())},e.prototype.getCurrentSlideIndex=function(){return this.slides.findIndex(function(e){return e.active})},e.prototype.isLast=function(e){return e+1>=this.slides.length},e.prototype.findNextSlideIndex=function(e,t){var n=0;if(t||!this.isLast(this.activeSlide)||e===_f.PREV||!this.noWrap){switch(e){case _f.NEXT:n=this.isLast(this._currentActiveSlide)?!t&&this.noWrap?this._currentActiveSlide:0:this._currentActiveSlide+1;break;case _f.PREV:n=this._currentActiveSlide>0?this._currentActiveSlide-1:!t&&this.noWrap?this._currentActiveSlide:this.slides.length-1;break;default:throw new Error("Unknown direction")}return n}},e.prototype._select=function(e){if(isNaN(e))this.pause();else{var t=this.slides[this._currentActiveSlide];t&&(t.active=!1);var n=this.slides[e];n&&(this._currentActiveSlide=e,n.active=!0,this.activeSlide=e)}},e.prototype.restartTimer=function(){var e=this;if(this.resetTimer(),this.isBrowser){var t=+this.interval;!isNaN(t)&&t>0&&(this.currentInterval=setInterval(function(){var t=+e.interval;e.isPlaying&&!isNaN(e.interval)&&t>0&&e.slides.length?e.nextSlide():e.pause()},t))}},e.prototype.resetTimer=function(){this.isBrowser&&this.currentInterval&&(clearInterval(this.currentInterval),this.currentInterval=void 0)},e.prototype.hasClass=function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},e.prototype.classAdd=function(e,t){e.classList?e.classList.add(t):this.hasClass(e,t)||(e.className+=" "+t)},e.prototype.removeClass=function(e,t){if(e.classList)e.classList.remove(t);else if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},e.prototype.keyboardControl=function(e){this.keyboard&&(39===e.keyCode&&this.nextSlide(),37===e.keyCode&&this.previousSlide())},e.prototype.focus=function(){this.el.nativeElement.focus()},e}(),bf=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),yf=function(){return function(){}}(),Tf=function(){return function(){}}(),Ef=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),xf=function(){function e(e,t){this.open=e,this.close=t||e}return e.prototype.isManual=function(){return"manual"===this.open||"manual"===this.close},e}(),Cf={hover:["mouseover","mouseout"],focus:["focusin","focusout"]};"undefined"!=typeof window&&window;var Sf=function(){return function(e,t,n){this.nodes=e,this.viewRef=t,this.componentRef=n}}(),Af=function(){function e(e,t,n,i,r,o,a,s){this._viewContainerRef=e,this._renderer=t,this._elementRef=n,this._injector=i,this._componentFactoryResolver=r,this._ngZone=o,this._applicationRef=a,this._posService=s,this.onBeforeShow=new Or,this.onShown=new Or,this.onBeforeHide=new Or,this.onHidden=new Or,this.shown=new Or,this.hidden=new Or,this._providers=[],this._isHiding=!1,this.containerDefaultSelector="body",this._listenOpts={},this._globalListener=Function.prototype}return Object.defineProperty(e.prototype,"isShown",{get:function(){return!this._isHiding&&!!this._componentRef},enumerable:!0,configurable:!0}),e.prototype.attach=function(e){return this._componentFactory=this._componentFactoryResolver.resolveComponentFactory(e),this},e.prototype.to=function(e){return this.container=e||this.container,this},e.prototype.position=function(e){return this.attachment=e.attachment||this.attachment,this._elementRef=e.target||this._elementRef,this},e.prototype.provide=function(e){return this._providers.push(e),this},e.prototype.show=function(e){if(void 0===e&&(e={}),this._subscribePositioning(),this._innerComponent=null,!this._componentRef){this.onBeforeShow.emit(),this._contentRef=this._getContentRef(e.content,e.data);var t=je.create({providers:this._providers,parent:this._injector});if(this._componentRef=this._componentFactory.create(t,this._contentRef.nodes),this._applicationRef.attachView(this._componentRef.hostView),this.instance=this._componentRef.instance,Object.assign(this._componentRef.instance,e),this.container instanceof un&&this.container.nativeElement.appendChild(this._componentRef.location.nativeElement),"string"==typeof this.container&&"undefined"!=typeof document){var n=document.querySelector(this.container)||document.querySelector(this.containerDefaultSelector);n&&n.appendChild(this._componentRef.location.nativeElement)}!this.container&&this._elementRef&&this._elementRef.nativeElement.parentElement&&this._elementRef.nativeElement.parentElement.appendChild(this._componentRef.location.nativeElement),this._contentRef.componentRef&&(this._innerComponent=this._contentRef.componentRef.instance,this._contentRef.componentRef.changeDetectorRef.markForCheck(),this._contentRef.componentRef.changeDetectorRef.detectChanges()),this._componentRef.changeDetectorRef.markForCheck(),this._componentRef.changeDetectorRef.detectChanges(),this.onShown.emit(this._componentRef.instance)}return this._registerOutsideClick(),this._componentRef},e.prototype.hide=function(){if(!this._componentRef)return this;this._posService.deletePositionElement(this._componentRef.location),this.onBeforeHide.emit(this._componentRef.instance);var e=this._componentRef.location.nativeElement;return e.parentNode.removeChild(e),this._contentRef.componentRef&&this._contentRef.componentRef.destroy(),this._componentRef.destroy(),this._viewContainerRef&&this._contentRef.viewRef&&this._viewContainerRef.remove(this._viewContainerRef.indexOf(this._contentRef.viewRef)),this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._contentRef=null,this._componentRef=null,this._removeGlobalListener(),this.onHidden.emit(),this},e.prototype.toggle=function(){this.isShown?this.hide():this.show()},e.prototype.dispose=function(){this.isShown&&this.hide(),this._unsubscribePositioning(),this._unregisterListenersFn&&this._unregisterListenersFn()},e.prototype.listen=function(e){var t=this;this.triggers=e.triggers||this.triggers,this._listenOpts.outsideClick=e.outsideClick,this._listenOpts.outsideEsc=e.outsideEsc,e.target=e.target||this._elementRef.nativeElement;var n=this._listenOpts.hide=function(){return e.hide?e.hide():void t.hide()},i=this._listenOpts.show=function(n){e.show?e.show(n):t.show(n),n()};return this._unregisterListenersFn=function(e,t){var n=function(e,n){void 0===n&&(n=Cf);var i=(t.triggers||"").trim();if(0===i.length)return[];var r=i.split(/\s+/).map(function(e){return e.split(":")}).map(function(e){var t=n[e[0]]||e;return new xf(t[0],t[1])}),o=r.filter(function(e){return e.isManual()});if(o.length>1)throw new Error("Triggers parse error: only one manual trigger is allowed");if(1===o.length&&r.length>1)throw new Error("Triggers parse error: manual trigger can't be mixed with other triggers");return r}(),i=t.target;if(1===n.length&&n[0].isManual())return Function.prototype;var r=[],o=[],a=function(){o.forEach(function(e){return r.push(e())}),o.length=0};return n.forEach(function(n){var s=n.open===n.close,l=s?t.toggle:t.show;s||o.push(function(){return e.listen(i,n.close,t.hide)}),r.push(e.listen(i,n.open,function(){return l(a)}))}),function(){r.forEach(function(e){return e()})}}(this._renderer,{target:e.target,triggers:e.triggers,show:i,hide:n,toggle:function(e){t.isShown?n():i(e)}}),this},e.prototype._removeGlobalListener=function(){this._globalListener&&(this._globalListener(),this._globalListener=null)},e.prototype.attachInline=function(e,t){return this._inlineViewRef=e.createEmbeddedView(t),this},e.prototype._registerOutsideClick=function(){var e=this;if(this._componentRef&&this._componentRef.location){if(this._listenOpts&&this._listenOpts.outsideClick){var t=this._componentRef.location.nativeElement;setTimeout(function(){var n;e._globalListener=(n={targets:[t,e._elementRef.nativeElement],outsideClick:e._listenOpts.outsideClick,hide:function(){return e._listenOpts.hide()}}).outsideClick?e._renderer.listen("document","click",function(e){n.target&&n.target.contains(e.target)||n.targets&&n.targets.some(function(t){return t.contains(e.target)})||n.hide()}):Function.prototype})}var n;this._listenOpts.outsideEsc&&(this._globalListener=(n={targets:[this._componentRef.location.nativeElement,this._elementRef.nativeElement],outsideEsc:this._listenOpts.outsideEsc,hide:function(){return e._listenOpts.hide()}}).outsideEsc?this._renderer.listen("document","keyup.esc",function(e){n.target&&n.target.contains(e.target)||n.targets&&n.targets.some(function(t){return t.contains(e.target)})||n.hide()}):Function.prototype)}},e.prototype.getInnerComponent=function(){return this._innerComponent},e.prototype._subscribePositioning=function(){var e=this;!this._zoneSubscription&&this.attachment&&(this.onShown.subscribe(function(){e._posService.position({element:e._componentRef.location,target:e._elementRef,attachment:e.attachment,appendToBody:"body"===e.container})}),this._zoneSubscription=this._ngZone.onStable.subscribe(function(){e._componentRef&&e._posService.calcPosition()}))},e.prototype._unsubscribePositioning=function(){this._zoneSubscription&&(this._zoneSubscription.unsubscribe(),this._zoneSubscription=null)},e.prototype._getContentRef=function(e,t){if(!e)return new Sf([]);if(e instanceof kn){if(this._viewContainerRef){var n=this._viewContainerRef.createEmbeddedView(e);return n.markForCheck(),new Sf([n.rootNodes],n)}var i=e.createEmbeddedView({});return this._applicationRef.attachView(i),new Sf([i.rootNodes],i)}if("function"==typeof e){var r=this._componentFactoryResolver.resolveComponentFactory(e),o=je.create({providers:this._providers,parent:this._injector}),a=r.create(o);return Object.assign(a.instance,t),this._applicationRef.attachView(a.hostView),new Sf([[a.location.nativeElement]],a.hostView,a)}return new Sf([[this._renderer.createText(""+e)]])},e}();function Pf(e,t){if(1!==e.nodeType)return[];var n=e.ownerDocument.defaultView.getComputedStyle(e,null);return t?n[t]:n}function Rf(e){return"HTML"===e.nodeName?e:e.parentNode||e.host}function Mf(e){if(!e)return document.body;switch(e.nodeName){case"HTML":case"BODY":return e.ownerDocument.body;case"#document":return e.body}var t=Pf(e),n=t.overflowX,i=t.overflowY;return/(auto|scroll|overlay)/.test(String(t.overflow)+String(i)+String(n))?e:Mf(Rf(e))}var Of="undefined"!=typeof window&&"undefined"!=typeof document,wf=Of&&!(!window.MSInputMethodContext||!document.documentMode),If=Of&&!(!window.MSInputMethodContext||!/MSIE 10/.test(navigator.userAgent));function Df(e){return 11===e?wf:10===e?If:wf||If}function Lf(e){if(!e)return document.documentElement;for(var t,n=Df(10)?document.body:null,i=e.offsetParent||null;i===n&&e.nextElementSibling&&"BODY"!==e.nodeName;)i=(t=e.nextElementSibling).offsetParent;var r=i&&i.nodeName;return r&&"BODY"!==r&&"HTML"!==r?-1!==["TH","TD","TABLE"].indexOf(i.nodeName)&&"static"===Pf(i,"position")?Lf(i):i:t?t.ownerDocument.documentElement:document.documentElement}function kf(e){return null!==e.parentNode?kf(e.parentNode):e}function Nf(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))return document.documentElement;var n=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,i=n?e:t,r=n?t:e,o=document.createRange();o.setStart(i,0),o.setEnd(r,0);var a,s,l=o.commonAncestorContainer;if(e!==l&&t!==l||i.contains(r))return"BODY"===(s=(a=l).nodeName)||"HTML"!==s&&Lf(a.firstElementChild)!==a?Lf(l):l;var c=kf(e);return c.host?Nf(c.host,t):Nf(e,kf(t).host)}function Ff(e,t){var n="x"===t?"Left":"Top",i="Left"===n?"Right":"Bottom";return parseFloat(e["border"+n+"Width"])+parseFloat(e["border"+i+"Width"])}function Bf(e,t,n,i){return Math.max(t["offset"+e],t["scroll"+e],n["client"+e],n["offset"+e],n["scroll"+e],Df(10)?parseInt(n["offset"+e],10)+parseInt(i["margin"+("Height"===e?"Top":"Left")],10)+parseInt(i["margin"+("Height"===e?"Bottom":"Right")],10):0)}function Uf(e){var t=e.body,n=e.documentElement,i=Df(10)&&getComputedStyle(n);return{height:Bf("Height",t,n,i),width:Bf("Width",t,n,i)}}function Vf(e,t){void 0===t&&(t="top");var n="top"===t?"scrollTop":"scrollLeft",i=e.nodeName;return"BODY"===i||"HTML"===i?(e.ownerDocument.scrollingElement||e.ownerDocument.documentElement)[n]:e[n]}function Gf(e){return o({},e,{right:e.left+e.width,bottom:e.top+e.height})}function zf(e){var t={};try{if(Df(10)){t=e.getBoundingClientRect();var n=Vf(e,"top"),i=Vf(e,"left");t.top+=n,t.left+=i,t.bottom+=n,t.right+=i}else t=e.getBoundingClientRect()}catch(c){return}var r={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},o="HTML"===e.nodeName?Uf(e.ownerDocument):{},a=e.offsetWidth-(o.width||e.clientWidth||r.right-r.left),s=e.offsetHeight-(o.height||e.clientHeight||r.bottom-r.top);if(a||s){var l=Pf(e);a-=Ff(l,"x"),s-=Ff(l,"y"),r.width-=a,r.height-=s}return Gf(r)}function jf(e,t,n){void 0===n&&(n=!1);var i=Df(10),r="HTML"===t.nodeName,o=zf(e),a=zf(t),s=Mf(e),l=Pf(t),c=parseFloat(l.borderTopWidth),u=parseFloat(l.borderLeftWidth);n&&r&&(a.top=Math.max(a.top,0),a.left=Math.max(a.left,0));var h=Gf({top:o.top-a.top-c,left:o.left-a.left-u,width:o.width,height:o.height});if(h.marginTop=0,h.marginLeft=0,!i&&r){var d=parseFloat(l.marginTop),f=parseFloat(l.marginLeft);h.top-=c-d,h.bottom-=c-d,h.left-=u-f,h.right-=u-f,h.marginTop=d,h.marginLeft=f}return(i&&!n?t.contains(s):t===s&&"BODY"!==s.nodeName)&&(h=function(e,t,n){void 0===n&&(n=!1);var i=Vf(t,"top"),r=Vf(t,"left"),o=n?-1:1;return e.top+=i*o,e.bottom+=i*o,e.left+=r*o,e.right+=r*o,e}(h,t)),h}function Hf(e){if(!e||!e.parentElement||Df())return document.documentElement;for(var t=e.parentElement;t&&"none"===Pf(t,"transform");)t=t.parentElement;return t||document.documentElement}function Wf(e,t,n,i,r){void 0===n&&(n=0),void 0===r&&(r=!1);var o={top:0,left:0},a=r?Hf(e):Nf(e,t);if("viewport"===i)o=function(e,t){void 0===t&&(t=!1);var n=a.ownerDocument.documentElement,i=jf(a,n),r=Math.max(n.clientWidth,window.innerWidth||0),o=Math.max(n.clientHeight,window.innerHeight||0),s=t?0:Vf(n),l=t?0:Vf(n,"left");return Gf({top:s-Number(i.top)+Number(i.marginTop),left:l-Number(i.left)+Number(i.marginLeft),width:r,height:o})}(0,r);else{var s=void 0;"scrollParent"===i?"BODY"===(s=Mf(Rf(t))).nodeName&&(s=e.ownerDocument.documentElement):s="window"===i?e.ownerDocument.documentElement:i;var l=jf(s,a,r);if("HTML"!==s.nodeName||function e(t){var n=t.nodeName;return"BODY"!==n&&"HTML"!==n&&("fixed"===Pf(t,"position")||e(Rf(t)))}(a))o=l;else{var c=Uf(e.ownerDocument),u=c.height,h=c.width;o.top+=l.top-l.marginTop,o.bottom=Number(u)+Number(l.top),o.left+=l.left-l.marginLeft,o.right=Number(h)+Number(l.left)}}return o.left+=n,o.top+=n,o.right-=n,o.bottom-=n,o}function Xf(e,t,n,i,r,a,s){if(void 0===r&&(r=["top","left","bottom","right"]),void 0===a&&(a="viewport"),void 0===s&&(s=0),-1===e.indexOf("auto"))return e;var l=Wf(n,i,s,a),c={top:{width:l.width,height:t.top-l.top},right:{width:l.right-t.right,height:l.height},bottom:{width:l.width,height:l.bottom-t.bottom},left:{width:t.left-l.left,height:l.height}},u=Object.keys(c).map(function(e){return o({key:e},c[e],{area:(t=c[e],t.width*t.height)});var t}).sort(function(e,t){return t.area-e.area}),h=u.filter(function(e){return e.width>=n.clientWidth&&e.height>=n.clientHeight}),d=(h=r.reduce(function(e,t){var n;return o({},e,((n={})[t]=h[t],n))},{})).length>0?h[0].key:u[0].key,f=e.split(" ")[1];return n.className=n.className.replace(/auto/g,d),d+(f?"-"+f:"")}function Yf(e){var t=e.ownerDocument.defaultView.getComputedStyle(e),n=parseFloat(t.marginTop||0)+parseFloat(t.marginBottom||0),i=parseFloat(t.marginLeft||0)+parseFloat(t.marginRight||0);return{width:Number(e.offsetWidth)+i,height:Number(e.offsetHeight)+n}}function Kf(e,t,n){return void 0===n&&(n=null),jf(t,n?Hf(e):Nf(e,t),n)}function Qf(e,t,n){var i,r=n.split(" ")[0],o=Yf(e),a={width:o.width,height:o.height},s=-1!==["right","left"].indexOf(r),l=s?"top":"left",c=s?"left":"top",u=s?"height":"width",h=s?"width":"height";return a[l]=t[l]+t[u]/2-o[u]/2,a[c]=r===c?t[c]-o[h]:t[(i={left:"right",right:"left",bottom:"top",top:"bottom"},c.replace(/left|right|bottom|top/g,function(e){return i[e]}))],a}function qf(e,t){return e&&e.modifiers&&e.modifiers[t]&&e.modifiers[t].enabled}function Zf(e,t,n){Object.keys(t).forEach(function(i){var r,o="";-1!==["width","height","top","right","bottom","left"].indexOf(i)&&""!==(r=t[i])&&!isNaN(parseFloat(r))&&isFinite(r)&&(o="px"),n?n.setStyle(e,i,""+String(t[i])+o):e.style[i]=String(t[i])+o})}function Jf(e){var t,n=e.offsets.target,i=e.instance.target.querySelector(".arrow");if(!i)return e;var r=-1!==["left","right"].indexOf(e.placement),o=r?"height":"width",a=r?"Top":"Left",s=a.toLowerCase(),l=r?"left":"top",c=r?"bottom":"right",u=Yf(i)[o];e.offsets.host[c]-u<n[s]&&(n[s]-=n[s]-(e.offsets.host[c]-u)),Number(e.offsets.host[s])+Number(u)>n[c]&&(n[s]+=Number(e.offsets.host[s])+Number(u)-Number(n[c])),n=Gf(n);var h=Number(e.offsets.host[s])+Number(e.offsets.host[o]/2-u/2),d=Pf(e.instance.target),f=parseFloat(d["margin"+a]),p=parseFloat(d["border"+a+"Width"]),g=h-n[s]-f-p;return g=Math.max(Math.min(n[o]-u,g),0),e.offsets.arrow=((t={})[s]=Math.round(g),t[l]="",t),e.instance.arrow=i,e}function $f(e){if(e.offsets.target=Gf(e.offsets.target),!qf(e.options,"flip"))return e.offsets.target=o({},e.offsets.target,Qf(e.instance.target,e.offsets.host,e.placement)),e;var t=Wf(e.instance.target,e.instance.host,0,"viewport",!1),n=e.placement.split(" ")[0],i=e.placement.split(" ")[1]||"",r=e.offsets.host,a=e.instance.target,s=e.instance.host,l=i?Xf("auto",r,a,s,["top","bottom"]):Xf("auto",r,a,s),c=[n,l];return c.forEach(function(r,a){if(n!==r||c.length===a+1)return e;var s="left"===(n=e.placement.split(" ")[0])&&Math.floor(e.offsets.target.right)>Math.floor(e.offsets.host.left)||"right"===n&&Math.floor(e.offsets.target.left)<Math.floor(e.offsets.host.right)||"top"===n&&Math.floor(e.offsets.target.bottom)>Math.floor(e.offsets.host.top)||"bottom"===n&&Math.floor(e.offsets.target.top)<Math.floor(e.offsets.host.bottom),l=Math.floor(e.offsets.target.left)<Math.floor(t.left),u=Math.floor(e.offsets.target.right)>Math.floor(t.right),h=Math.floor(e.offsets.target.top)<Math.floor(t.top),d=Math.floor(e.offsets.target.bottom)>Math.floor(t.bottom),f="left"===n&&l||"right"===n&&u||"top"===n&&h||"bottom"===n&&d,p=-1!==["top","bottom"].indexOf(n),g=p&&"left"===i&&l||p&&"right"===i&&u||!p&&"left"===i&&h||!p&&"right"===i&&d;(s||f||g)&&((s||f)&&(n=c[a+1]),g&&(i=function(e){return"right"===e?"left":"left"===e?"right":e}(i)),e.placement=n+(i?" "+i:""),e.offsets.target=o({},e.offsets.target,Qf(e.instance.target,e.offsets.host,e.placement)))}),e}function ep(e){if(!qf(e.options,"preventOverflow"))return e;var t=e.instance.target.style,n=t.top,i=t.left,r=t.transform;t.top="",t.left="",t.transform="";var a=Wf(e.instance.target,e.instance.host,0,"scrollParent",!1);t.top=n,t.left=i,t.transform=r;var s,l={primary:function(t){var n,i=e.offsets.target[t];return e.offsets.target[t]<a[t]&&(i=Math.max(e.offsets.target[t],a[t])),(n={})[t]=i,n},secondary:function(t){var n,i="right"===t?"left":"top",r=e.offsets.target[i];return e.offsets.target[t]>a[t]&&(r=Math.min(e.offsets.target[i],a[t]-("right"===t?e.offsets.target.width:e.offsets.target.height))),(n={})[i]=r,n}};return["left","right","top","bottom"].forEach(function(t){s=-1!==["left","top"].indexOf(t)?"primary":"secondary",e.offsets.target=o({},e.offsets.target,l[s](t))}),e}function tp(e){var t,n,i=e.placement,r=i.split(" ")[0],a=i.split(" ")[1];if(a){var s=e.offsets,l=s.host,c=s.target,u=-1!==["bottom","top"].indexOf(r),h=u?"left":"top",d=u?"width":"height",f={left:(t={},t[h]=l[h],t),right:(n={},n[h]=l[h]+l[d]-l[d],n)};e.offsets.target=o({},c,f[a])}return e}var np=new(function(){function e(){}return e.prototype.position=function(e,t){return this.offset(e,t)},e.prototype.offset=function(e,t){return Kf(t,e)},e.prototype.positionElements=function(e,t,n,i,r){return[$f,tp,ep,Jf].reduce(function(e,t){return t(e)},function(e,t,n,i){var r=Kf(e,t),o=!!n.match(/auto/g),a=n.match(/auto\s(left|right|top|bottom)/g)?n.split(" ")[1]||"":n;return{options:i,instance:{target:e,host:t,arrow:null},offsets:{target:Qf(e,r,a),host:r,arrow:null},positionFixed:!1,placement:a=Xf(a,r,e,t),placementAuto:o}}(t,e,n,r))},e}()),ip=function(){function e(e,t){var n=this;this.update$$=new k,this.positionElements=new Map,Ws(t)&&ae(rf(window,"scroll"),rf(window,"resize"),Zs(0,af),this.update$$).subscribe(function(){n.positionElements.forEach(function(t){var i,r,o,a,s,l;i=rp(t.target),r=rp(t.element),o=t.attachment,a=t.appendToBody,s=n.options,l=e.createRenderer(null,null),function(e,t){var n=e.instance.target,i=function(e){return{width:e.offsets.target.width,height:e.offsets.target.height,left:Math.floor(e.offsets.target.left),top:Math.round(e.offsets.target.top),bottom:Math.round(e.offsets.target.bottom),right:Math.floor(e.offsets.target.right)}}(e);Zf(n,{"will-change":"transform",top:"0px",left:"0px",transform:"translate3d("+i.left+"px, "+i.top+"px, 0px)"},t),e.instance.arrow&&Zf(e.instance.arrow,e.offsets.arrow,t),e.placementAuto&&(t?(t.setAttribute(n,"class",n.className.replace(/bs-popover-auto/g,"bs-popover-"+e.placement)),t.setAttribute(n,"class",n.className.replace(/bs-tooltip-auto/g,"bs-tooltip-"+e.placement)),t.setAttribute(n,"class",n.className.replace(/\sauto/g,"s"+e.placement)),n.className.match(/popover/g)&&t.addClass(n,"popover-auto"),n.className.match(/tooltip/g)&&t.addClass(n,"tooltip-auto")):(n.className=n.className.replace(/bs-popover-auto/g,"bs-popover-"+e.placement),n.className=n.className.replace(/bs-tooltip-auto/g,"bs-tooltip-"+e.placement),n.className=n.className.replace(/\sauto/g,"s"+e.placement),n.className.match(/popover/g)&&n.classList.add("popover-auto"),n.className.match(/tooltip/g)&&n.classList.add("tooltip-auto"))),t?t.setAttribute(n,"class",n.className.replace(/left|right|top|bottom/g,""+e.placement.split(" ")[0])):n.className=n.className.replace(/left|right|top|bottom/g,""+e.placement.split(" ")[0])}(np.positionElements(i,r,o,a,s),l)})})}return e.prototype.position=function(e){this.addPositionElement(e)},e.prototype.addPositionElement=function(e){this.positionElements.set(rp(e.element),e)},e.prototype.calcPosition=function(){this.update$$.next()},e.prototype.deletePositionElement=function(e){this.positionElements.delete(rp(e))},e.prototype.setOptions=function(e){this.options=e},e}();function rp(e){return e&&"string"==typeof e?document.querySelector(e):e instanceof un?e.nativeElement:e}var op=function(){function e(e,t,n,i,r){this._componentFactoryResolver=e,this._ngZone=t,this._injector=n,this._posService=i,this._applicationRef=r}return e.prototype.createLoader=function(e,t,n){return new Af(t,n,e,this._injector,this._componentFactoryResolver,this._ngZone,this._applicationRef,this._posService)},e}(),ap=function(){return function(){this.autoClose=!0}}(),sp=function(){return function(){var e=this;this.direction="down",this.isOpenChange=new Or,this.isDisabledChange=new Or,this.toggleClick=new Or,this.dropdownMenu=new Promise(function(t){e.resolveDropdownMenu=t})}}(),lp=function(){function e(e){var t=this;this._state=e,this.isOpen=!1,this.display="block",this.position="absolute",this._subscription=e.isOpenChange.subscribe(function(e){t.isOpen=e})}return Object.defineProperty(e.prototype,"direction",{get:function(){return this._state.direction},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this._subscription.unsubscribe()},e}(),cp=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[op,ip,sp,{provide:ap,useValue:t||{autoClose:!0}}]}},e}(),up=function(){function e(e,t){this._el=e,this._renderer=t,this.fab=!1,this.far=!1,this.fal=!1,this.fas=!0,this.sizeClass=""}return e.prototype.ngOnInit=function(){var e=this;this.size&&(this.sizeClass="fa-"+this.size),this._el.nativeElement.parentElement.classList.contains("md-form")&&this._renderer.addClass(this._el.nativeElement,"prefix");var t=this._el.nativeElement.classList;this.fab=t.contains("fab"),this.far=t.contains("far"),this.fas=t.contains("fas"),this.fal=t.contains("fal");var n=this._getClosestEl(this._el.nativeElement,".md-form")||this._getClosestEl(this._el.nativeElement,".md-outline");n&&n.childNodes.forEach(function(t){"INPUT"===t.tagName&&(e._renderer.listen(t,"focus",function(){e._renderer.addClass(e._el.nativeElement,"active")}),e._renderer.listen(t,"blur",function(){e._renderer.removeClass(e._el.nativeElement,"active")}))})},e.prototype._getClosestEl=function(e,t){for(;e&&e!==ff;e=e.parentNode)if(e.matches&&e.matches(t))return e;return null},e}(),hp=function(){return function(e,t){this._el=e,this._r=t,this._r.addClass(this._el.nativeElement,"fas")}}(),dp=function(){return function(){}}(),fp=function(){return function(){}}(),pp=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),gp=function(){return function(){}}(),mp=function(){function e(){}return e.prototype.hide=function(){},e}(),_p={backdrop:!0,keyboard:!0,focus:!0,show:!1,ignoreBackdropClick:!1,class:"",containerClass:"",animated:!0,scroll:!1,data:{}},vp=function(){function e(){}return e.reflow=function(e){},e.getStyles=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=df),t.getComputedStyle(e)},e.prototype.focusTrapModal=function(e,t){var n,i,r;i=(n=t.nativeElement.querySelectorAll("a[href], button, textarea, input, select, form, mdb-select, mdb-auto-completer, mdb-checkbox, mdb-range-input"))[0],r=n[n.length-1],"Tab"!==e.key&&9!==e.keyCode||(e.shiftKey?ff&&ff.activeElement===i&&(r.focus(),e.preventDefault()):ff&&ff.activeElement===r&&(i.focus(),e.preventDefault()))},e.prototype.getClosestEl=function(e,t){for(;e&&e!==ff;e=e.parentNode)if(e.matches&&e.matches(t))return e;return null},e.prototype.getCoords=function(e){var t=e.getBoundingClientRect(),n=ff.body,i=ff.documentElement,r=t.left+(df.pageXOffset||i.scrollLeft||n.scrollLeft)-(i.clientLeft||n.clientLeft||0);return{top:Math.round(t.top+(df.pageYOffset||i.scrollTop||n.scrollTop)-(i.clientTop||n.clientTop||0)),left:Math.round(r)}},e}(),bp=function(){function e(e,t){this.classNameBackDrop=!0,this._isShown=!1,this.element=e,this.renderer=t}return Object.defineProperty(e.prototype,"isAnimated",{get:function(){return this._isAnimated},set:function(e){this._isAnimated=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isShown",{get:function(){return this._isShown},set:function(e){this._isShown=e,e?(this.renderer.addClass(this.element.nativeElement,"in"),pf()||this.renderer.addClass(this.element.nativeElement,"show")):(this.renderer.removeClass(this.element.nativeElement,"in"),pf()||this.renderer.removeClass(this.element.nativeElement,"show"))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.renderer.addClass(this.element.nativeElement,"fade"),vp.reflow(this.element.nativeElement),this.isShown=!0},e}(),yp={serviceInstance:new Object},Tp=function(){function e(e,t,n){this._renderer=n,this.modalClass="modal",this.tabindex=-1,this.role="dialog",this.modal=!0,this.isShown=!1,this.isModalHiding=!1,this.utils=new vp,this.mdbModalService=yp.serviceInstance,this._element=t,this.config=Object.assign({},e)}return e.prototype.onClick=function(e){this.config.ignoreBackdropClick||"static"===this.config.backdrop||e.target!==this._element.nativeElement||(this.mdbModalService.setDismissReason("backdrop-click"),this.hide())},e.prototype.onEsc=function(){this.config.keyboard&&this.level===this.mdbModalService.getModalsCount()&&(this.mdbModalService.setDismissReason("esc"),this.hide())},e.prototype.onKeyDown=function(e){this.utils.focusTrapModal(e,this._element)},e.prototype.ngOnInit=function(){var e=this;this.config.animated&&this._renderer.addClass(this._element.nativeElement,"fade"),this._renderer.setStyle(this._element.nativeElement,"display","block"),window&&-1!==window.navigator.userAgent.indexOf("Edge")&&this.config&&-1===this.config.toString().indexOf("side-modal")||window&&-1!==window.navigator.userAgent.indexOf("Edge")&&this.config&&-1===this.config.toString().indexOf("modal-full-height")?(this.isShown=!0,this._renderer.addClass(this._element.nativeElement,pf()?"in":"show"),this._renderer.setStyle(this._element.nativeElement,"transition","transform 0.3s ease-out"),this._renderer.setStyle(this._element.nativeElement,"transform","translate(0, 25px)")):setTimeout(function(){e.isShown=!0,e._renderer.addClass(e._element.nativeElement,pf()?"in":"show")},this.isAnimated?150:0),document&&document.body&&(1===this.mdbModalService.getModalsCount()&&(this.mdbModalService.checkScrollbar(),this.mdbModalService.setScrollbar()),this._renderer.addClass(document.body,"modal-open")),this.config.containerClass&&this.updateContainerClass(),this.config.scroll&&this._renderer.setStyle(this._element.nativeElement,"overflow-y","auto")},e.prototype.focusModalElement=function(){this.config.focus&&this._element.nativeElement.focus()},e.prototype.updateContainerClass=function(){if(this.config.containerClass)for(var e=this.config.containerClass.split(" "),t=0;t<e.length;t++)this._renderer.addClass(this._element.nativeElement,e[t])},e.prototype.ngOnDestroy=function(){this.isShown&&this.hide()},e.prototype.hide=function(){var e=this;!this.isModalHiding&&this.isShown&&(this.isModalHiding=!0,this._renderer.removeClass(this._element.nativeElement,pf()?"in":"show"),setTimeout(function(){e.isShown=!1,document&&document.body&&1===e.mdbModalService.getModalsCount()&&e._renderer.removeClass(document.body,"modal-open"),e.mdbModalService.hide(e.level),e.isModalHiding=!1},this.isAnimated?300:0))},e}(),Ep=function(){function e(e,t){this.clf=t,this.config=_p,this.open=new Or,this.opened=new Or,this.close=new Or,this.closed=new Or,this.isBodyOverflowing=!1,this.originalBodyPadding=0,this.scrollbarWidth=0,this.modalsCount=0,this.lastDismissReason="",this.loaders=[],this._backdropLoader=this.clf.createLoader(this.el,this.vcr,this.renderer),this.renderer=e.createRenderer(null,null),yp.serviceInstance=this}return e.prototype.show=function(e,t){return this.modalsCount++,this._createLoaders(),this.config=Object.assign({},_p,t),this._showBackdrop(),this.lastDismissReason=null,this._showModal(e)},e.prototype.hide=function(e){var t=this;1===this.modalsCount&&(this._hideBackdrop(),this.resetScrollbar()),this.modalsCount=this.modalsCount>=1?this.modalsCount-1:0,setTimeout(function(){t._hideModal(e),t.removeLoaders(e)},this.config.animated?150:0)},e.prototype._showBackdrop=function(){var e=this.config.backdrop||"static"===this.config.backdrop,t=!this.backdropRef||!this.backdropRef.instance.isShown;1===this.modalsCount&&(this.removeBackdrop(),e&&t&&(this._backdropLoader.attach(bp).to("body").show({isAnimated:this.config.animated}),this.backdropRef=this._backdropLoader._componentRef))},e.prototype._hideBackdrop=function(){var e=this;this.backdropRef&&(this.backdropRef.instance.isShown=!1,setTimeout(function(){return e.removeBackdrop()},this.config.animated?150:0))},e.prototype._showModal=function(e){var t=this.loaders[this.loaders.length-1],n=new mp,i=t.provide({provide:gp,useValue:this.config}).provide({provide:mp,useValue:n}).attach(Tp).to("body").show({content:e,isAnimated:this.config.animated,data:this.config.data});return i.instance.focusModalElement(),i.instance.level=this.getModalsCount(),n.hide=function(){i.instance.hide()},n.content=t.getInnerComponent()||null,n},e.prototype._hideModal=function(e){var t=this.loaders[e-1];t&&t.hide()},e.prototype.getModalsCount=function(){return this.modalsCount},e.prototype.setDismissReason=function(e){this.lastDismissReason=e},e.prototype.removeBackdrop=function(){this._backdropLoader.hide(),this.backdropRef=null},e.prototype.checkScrollbar=function(){this.isBodyOverflowing=document.body.clientWidth<window.innerWidth,this.scrollbarWidth=this.getScrollbarWidth()},e.prototype.setScrollbar=function(){document&&(this.originalBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")||"0",10),this.isBodyOverflowing&&(document.body.style.paddingRight=this.originalBodyPadding+this.scrollbarWidth+"px"))},e.prototype.resetScrollbar=function(){document.body.style.paddingRight=this.originalBodyPadding+"px"},e.prototype.getScrollbarWidth=function(){var e=this.renderer.createElement("div");this.renderer.addClass(e,"modal-scrollbar-measure"),this.renderer.appendChild(document.body,e);var t=e.offsetWidth-e.clientWidth;return this.renderer.removeChild(document.body,e),t},e.prototype._createLoaders=function(){var e=this.clf.createLoader(this.el,this.vcr,this.renderer);this.copyEvent(e.onBeforeShow,this.open),this.copyEvent(e.onShown,this.opened),this.copyEvent(e.onBeforeHide,this.close),this.copyEvent(e.onHidden,this.closed),this.loaders.push(e)},e.prototype.removeLoaders=function(e){this.loaders.splice(e-1,1),this.loaders.forEach(function(e,t){e.instance.level=t+1})},e.prototype.copyEvent=function(e,t){var n=this;e.subscribe(function(){t.emit(n.lastDismissReason)})},e}(),xp=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[Ep,op,ip]}},e}(),Cp=function(){function e(){this.navbarLinkClicks=new k}return e.prototype.getNavbarLinkClicks=function(){return this.navbarLinkClicks.asObservable()},e.prototype.setNavbarLinkClicks=function(){this.navbarLinkClicks.next()},e}(),Sp=function(){return function(){}}(),Ap=function(){return function(){this.placement="top",this.triggers="click"}}(),Pp=function(){function e(e){this.show="!isBs3",this.role="tooltip",Object.assign(this,e)}return Object.defineProperty(e.prototype,"isBs3",{get:function(){return pf()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.class="popover-fadeIn popover in popover-"+this.placement+" "+this.placement+" bs-popover-"+this.placement},e}(),Rp=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[Ap,op,ip]}},e}(),Mp=function(){function e(){this._dataSource=[],this._dataSourceChanged=new k}return e.prototype.addRow=function(e){this.getDataSource().push(e)},e.prototype.addRowAfter=function(e,t){this.getDataSource().splice(e,0,t)},e.prototype.removeRow=function(e){this.getDataSource().splice(e,1)},e.prototype.rowRemoved=function(){return M.create(function(e){e.next(!0)})},e.prototype.removeLastRow=function(){this.getDataSource().pop()},e.prototype.getDataSource=function(){return this._dataSource},e.prototype.setDataSource=function(e){this._dataSource=e,this._dataSourceChanged.next(this.getDataSource())},e.prototype.dataSourceChange=function(){return this._dataSourceChanged},e.prototype.filterLocalDataBy=function(e){return this.getDataSource().filter(function(t){return Object.keys(t).some(function(n){if(t[n])return t[n].toString().toLowerCase().includes(e)})})},e.prototype.searchLocalDataBy=function(e){return e?e?this.filterLocalDataBy(e.toLowerCase()):void 0:this.getDataSource()},e.prototype.searchDataObservable=function(e){var t=this;return M.create(function(n){n.next(t.searchLocalDataBy(e))})},e.ngInjectableDef=Se({factory:function(){return new e},token:e,providedIn:"root"}),e}(),Op=function(){function e(e){this.cdRef=e,this.searchPagination=!1,this.searchDataSource=null,this.ofKeyword="of",this.dashKeyword="-",this.paginationAlign="",this.hideDescription=!1,this.maxVisibleItems=10,this.firstItemIndex=0,this.lastItemIndex=this.maxVisibleItems,this.lastVisibleItemIndex=5,this.activePageNumber=1,this.allItemsLength=0,this.nextShouldBeDisabled=!1,this.previousShouldBeDisabled=!0,this.searchText="",this.pagination=new k,this.nextPageClick=new Or,this.previousPageClick=new Or}return e.prototype.ngOnInit=function(){this.tableEl&&(this.allItemsLength=this.tableEl.getDataSource().length)},e.prototype.ngAfterViewInit=function(){var e=this;this.tableEl&&this.tableEl.dataSourceChange().subscribe(function(t){e.allItemsLength=t.length,e.lastVisibleItemIndex=t.length,e.calculateFirstItemIndex(),e.calculateLastItemIndex(),e.disableNextButton(t),e.searchDataSource&&setTimeout(function(){e.searchDataSource.length!==t.length&&(e.activePageNumber=1,e.firstItemIndex=1)},0)}),this.paginationChange().subscribe(function(t){e.firstItemIndex=t.first,e.lastVisibleItemIndex=t.last})},e.prototype.ngOnChanges=function(e){var t=e.searchDataSource;0!==t.currentValue.length&&(this.allItemsLength=t.currentValue.length),this.lastVisibleItemIndex>this.allItemsLength&&(this.lastVisibleItemIndex=this.allItemsLength),0===t.currentValue.length&&(this.firstItemIndex=0,this.lastItemIndex=0,this.lastVisibleItemIndex=0,this.allItemsLength=0),!t.isFirstChange()&&t.currentValue.length<=this.maxVisibleItems?(this.nextShouldBeDisabled=!0,this.lastVisibleItemIndex=t.currentValue.length):this.nextShouldBeDisabled=!1},e.prototype.setMaxVisibleItemsNumberTo=function(e){this.lastItemIndex=e,this.lastVisibleItemIndex=e,this.maxVisibleItems=e,this.cdRef.detectChanges()},e.prototype.searchTextObs=function(){var e=this;return M.create(function(t){t.next(e.searchText)})},e.prototype.disableNextButton=function(e){this.nextShouldBeDisabled=e.length<=this.maxVisibleItems},e.prototype.calculateFirstItemIndex=function(){this.firstItemIndex=this.activePageNumber*this.maxVisibleItems-this.maxVisibleItems+1,this.pagination.next({first:this.firstItemIndex,last:this.lastItemIndex})},e.prototype.calculateLastItemIndex=function(){this.lastItemIndex=this.activePageNumber*this.maxVisibleItems,this.lastVisibleItemIndex=this.lastItemIndex,this.searchDataSource&&this.lastItemIndex>this.searchDataSource.length?this.lastVisibleItemIndex=this.searchDataSource.length:this.searchDataSource||(this.lastVisibleItemIndex=this.lastItemIndex),this.lastItemIndex>this.tableEl.getDataSource().length&&(this.lastItemIndex=this.tableEl.getDataSource().length,this.lastVisibleItemIndex=this.tableEl.getDataSource().length),this.pagination.next({first:this.firstItemIndex,last:this.lastItemIndex})},e.prototype.paginationChange=function(){return this.pagination},e.prototype.calculateHowManyPagesShouldBe=function(){return Math.ceil(this.tableEl.getDataSource().length/this.maxVisibleItems)},e.prototype.previousPage=function(){this.activePageNumber--,this.calculateFirstItemIndex(),this.calculateLastItemIndex(),this.previousPageClick.emit({first:this.firstItemIndex,last:this.lastItemIndex})},e.prototype.nextPage=function(){this.activePageNumber++,this.calculateFirstItemIndex(),this.calculateLastItemIndex(),this.lastItemIndex>this.tableEl.getDataSource().length&&(this.lastItemIndex=this.tableEl.getDataSource().length),this.lastVisibleItemIndex>this.allItemsLength&&(this.lastVisibleItemIndex=this.allItemsLength),this.nextPageClick.emit({first:this.firstItemIndex,last:this.lastItemIndex})},e.prototype.nextPageObservable=function(){var e=this;return M.create(function(t){t.next(e.firstItemIndex)})},e.prototype.previousPageObservable=function(){var e=this;return M.create(function(t){t.next(e.lastVisibleItemIndex)})},e.prototype.checkIfNextShouldBeDisabled=function(){return!(!this.searchDataSource||this.lastVisibleItemIndex!==this.searchDataSource.length)||this.activePageNumber>=this.calculateHowManyPagesShouldBe()||(this.nextShouldBeDisabled?this.nextShouldBeDisabled:void 0)},e.prototype.checkIfPreviousShouldBeDisabled=function(){if(1===this.activePageNumber)return!0},e}(),wp=function(){return function(){}}(),Ip=function(){return function(){this.placement="top",this.triggers="hover focus"}}(),Dp=function(){function e(e,t){this.containerClass="",this.show=!this.isBs3,this.el=t,Object.assign(this,e)}return Object.defineProperty(e.prototype,"isBs3",{get:function(){return pf()},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.classMap={in:!1,fade:!1},this.classMap[this.placement]=!0,this.classMap["tooltip-"+this.placement]=!0,this.classMap.in=!0,this.animation&&(this.classMap.fade=!0),this.popupClass&&(this.classMap[this.popupClass]=!0)},e}(),Lp=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[Ip,op,ip]}},e}(),kp=function(){function e(e){this.el=e}return e.prototype.click=function(e){if(!this.el.nativeElement.classList.contains("disabled")){var t=this.el.nativeElement;t.classList.contains("waves-effect")||(t.className+=" waves-effect");var n=e.clientX-t.getBoundingClientRect().left,i=e.clientY-t.getBoundingClientRect().top,r=document.createElement("div");r.className+="waves-ripple waves-rippling";var o=t.appendChild(r),a=n+"px";r.style.top=i+"px",r.style.left=a;var s="scale("+t.clientWidth/100*3+") translate(0,0)";r.style.webkitTransform=s,r.style.transform=s,r.style.opacity="1",r.style.webkitTransitionDuration="750ms",r.style.transitionDuration="750ms",this.removeRipple(t,o)}},e.prototype.removeRipple=function(e,t){t.classList.remove("waves-rippling"),setTimeout(function(){t.style.opacity="0",setTimeout(function(){e.removeChild(t)},750)},200)},e}(),Np=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}(),Fp=function(){return function(){}}(),Bp=function(){return function(){}}(),Up=ti({encapsulation:2,styles:[".mdb-color.lighten-5{background-color:#d0d6e2!important}.mdb-color.lighten-4{background-color:#b1bace!important}.mdb-color.lighten-3{background-color:#929fba!important}.mdb-color.lighten-2{background-color:#7283a7!important}.mdb-color.lighten-1{background-color:#59698d!important}.mdb-color{background-color:#45526e!important}.mdb-color-text{color:#45526e!important}.rgba-mdb-color-slight,.rgba-mdb-color-slight:after{background-color:rgba(69,82,110,.1)}.rgba-mdb-color-light,.rgba-mdb-color-light:after{background-color:rgba(69,82,110,.3)}.rgba-mdb-color-strong,.rgba-mdb-color-strong:after{background-color:rgba(69,82,110,.7)}.mdb-color.darken-1{background-color:#3b465e!important}.mdb-color.darken-2{background-color:#2e3951!important}.mdb-color.darken-3{background-color:#1c2a48!important}.mdb-color.darken-4{background-color:#1c2331!important}.red.lighten-5{background-color:#ffebee!important}.red.lighten-4{background-color:#ffcdd2!important}.red.lighten-3{background-color:#ef9a9a!important}.red.lighten-2{background-color:#e57373!important}.red.lighten-1{background-color:#ef5350!important}.red{background-color:#f44336!important}.red-text{color:#f44336!important}.rgba-red-slight,.rgba-red-slight:after{background-color:rgba(244,67,54,.1)}.rgba-red-light,.rgba-red-light:after{background-color:rgba(244,67,54,.3)}.rgba-red-strong,.rgba-red-strong:after{background-color:rgba(244,67,54,.7)}.red.darken-1{background-color:#e53935!important}.red.darken-2{background-color:#d32f2f!important}.red.darken-3{background-color:#c62828!important}.red.darken-4{background-color:#b71c1c!important}.red.accent-1{background-color:#ff8a80!important}.red.accent-2{background-color:#ff5252!important}.red.accent-3{background-color:#ff1744!important}.red.accent-4{background-color:#d50000!important}.pink.lighten-5{background-color:#fce4ec!important}.pink.lighten-4{background-color:#f8bbd0!important}.pink.lighten-3{background-color:#f48fb1!important}.pink.lighten-2{background-color:#f06292!important}.pink.lighten-1{background-color:#ec407a!important}.pink{background-color:#e91e63!important}.pink-text{color:#e91e63!important}.rgba-pink-slight,.rgba-pink-slight:after{background-color:rgba(233,30,99,.1)}.rgba-pink-light,.rgba-pink-light:after{background-color:rgba(233,30,99,.3)}.rgba-pink-strong,.rgba-pink-strong:after{background-color:rgba(233,30,99,.7)}.pink.darken-1{background-color:#d81b60!important}.pink.darken-2{background-color:#c2185b!important}.pink.darken-3{background-color:#ad1457!important}.pink.darken-4{background-color:#880e4f!important}.pink.accent-1{background-color:#ff80ab!important}.pink.accent-2{background-color:#ff4081!important}.pink.accent-3{background-color:#f50057!important}.pink.accent-4{background-color:#c51162!important}.purple.lighten-5{background-color:#f3e5f5!important}.purple.lighten-4{background-color:#e1bee7!important}.purple.lighten-3{background-color:#ce93d8!important}.purple.lighten-2{background-color:#ba68c8!important}.purple.lighten-1{background-color:#ab47bc!important}.purple{background-color:#9c27b0!important}.purple-text{color:#9c27b0!important}.rgba-purple-slight,.rgba-purple-slight:after{background-color:rgba(156,39,176,.1)}.rgba-purple-light,.rgba-purple-light:after{background-color:rgba(156,39,176,.3)}.rgba-purple-strong,.rgba-purple-strong:after{background-color:rgba(156,39,176,.7)}.purple.darken-1{background-color:#8e24aa!important}.purple.darken-2{background-color:#7b1fa2!important}.purple.darken-3{background-color:#6a1b9a!important}.purple.darken-4{background-color:#4a148c!important}.purple.accent-1{background-color:#ea80fc!important}.purple.accent-2{background-color:#e040fb!important}.purple.accent-3{background-color:#d500f9!important}.purple.accent-4{background-color:#a0f!important}.deep-purple.lighten-5{background-color:#ede7f6!important}.deep-purple.lighten-4{background-color:#d1c4e9!important}.deep-purple.lighten-3{background-color:#b39ddb!important}.deep-purple.lighten-2{background-color:#9575cd!important}.deep-purple.lighten-1{background-color:#7e57c2!important}.deep-purple{background-color:#673ab7!important}.deep-purple-text{color:#673ab7!important}.rgba-deep-purple-slight,.rgba-deep-purple-slight:after{background-color:rgba(103,58,183,.1)}.rgba-deep-purple-light,.rgba-deep-purple-light:after{background-color:rgba(103,58,183,.3)}.rgba-deep-purple-strong,.rgba-deep-purple-strong:after{background-color:rgba(103,58,183,.7)}.deep-purple.darken-1{background-color:#5e35b1!important}.deep-purple.darken-2{background-color:#512da8!important}.deep-purple.darken-3{background-color:#4527a0!important}.deep-purple.darken-4{background-color:#311b92!important}.deep-purple.accent-1{background-color:#b388ff!important}.deep-purple.accent-2{background-color:#7c4dff!important}.deep-purple.accent-3{background-color:#651fff!important}.deep-purple.accent-4{background-color:#6200ea!important}.indigo.lighten-5{background-color:#e8eaf6!important}.indigo.lighten-4{background-color:#c5cae9!important}.indigo.lighten-3{background-color:#9fa8da!important}.indigo.lighten-2{background-color:#7986cb!important}.indigo.lighten-1{background-color:#5c6bc0!important}.indigo{background-color:#3f51b5!important}.indigo-text{color:#3f51b5!important}.rgba-indigo-slight,.rgba-indigo-slight:after{background-color:rgba(63,81,181,.1)}.rgba-indigo-light,.rgba-indigo-light:after{background-color:rgba(63,81,181,.3)}.rgba-indigo-strong,.rgba-indigo-strong:after{background-color:rgba(63,81,181,.7)}.indigo.darken-1{background-color:#3949ab!important}.indigo.darken-2{background-color:#303f9f!important}.indigo.darken-3{background-color:#283593!important}.indigo.darken-4{background-color:#1a237e!important}.indigo.accent-1{background-color:#8c9eff!important}.indigo.accent-2{background-color:#536dfe!important}.indigo.accent-3{background-color:#3d5afe!important}.indigo.accent-4{background-color:#304ffe!important}.blue.lighten-5{background-color:#e3f2fd!important}.blue.lighten-4{background-color:#bbdefb!important}.blue.lighten-3{background-color:#90caf9!important}.blue.lighten-2{background-color:#64b5f6!important}.blue.lighten-1{background-color:#42a5f5!important}.blue{background-color:#2196f3!important}.blue-text{color:#2196f3!important}.rgba-blue-slight,.rgba-blue-slight:after{background-color:rgba(33,150,243,.1)}.rgba-blue-light,.rgba-blue-light:after{background-color:rgba(33,150,243,.3)}.rgba-blue-strong,.rgba-blue-strong:after{background-color:rgba(33,150,243,.7)}.blue.darken-1{background-color:#1e88e5!important}.blue.darken-2{background-color:#1976d2!important}.blue.darken-3{background-color:#1565c0!important}.blue.darken-4{background-color:#0d47a1!important}.blue.accent-1{background-color:#82b1ff!important}.blue.accent-2{background-color:#448aff!important}.blue.accent-3{background-color:#2979ff!important}.blue.accent-4{background-color:#2962ff!important}.light-blue.lighten-5{background-color:#e1f5fe!important}.light-blue.lighten-4{background-color:#b3e5fc!important}.light-blue.lighten-3{background-color:#81d4fa!important}.light-blue.lighten-2{background-color:#4fc3f7!important}.light-blue.lighten-1{background-color:#29b6f6!important}.light-blue{background-color:#03a9f4!important}.light-blue-text{color:#03a9f4!important}.rgba-light-blue-slight,.rgba-light-blue-slight:after{background-color:rgba(3,169,244,.1)}.rgba-light-blue-light,.rgba-light-blue-light:after{background-color:rgba(3,169,244,.3)}.rgba-light-blue-strong,.rgba-light-blue-strong:after{background-color:rgba(3,169,244,.7)}.light-blue.darken-1{background-color:#039be5!important}.light-blue.darken-2{background-color:#0288d1!important}.light-blue.darken-3{background-color:#0277bd!important}.light-blue.darken-4{background-color:#01579b!important}.light-blue.accent-1{background-color:#80d8ff!important}.light-blue.accent-2{background-color:#40c4ff!important}.light-blue.accent-3{background-color:#00b0ff!important}.light-blue.accent-4{background-color:#0091ea!important}.cyan.lighten-5{background-color:#e0f7fa!important}.cyan.lighten-4{background-color:#b2ebf2!important}.cyan.lighten-3{background-color:#80deea!important}.cyan.lighten-2{background-color:#4dd0e1!important}.cyan.lighten-1{background-color:#26c6da!important}.cyan{background-color:#00bcd4!important}.cyan-text{color:#00bcd4!important}.rgba-cyan-slight,.rgba-cyan-slight:after{background-color:rgba(0,188,212,.1)}.rgba-cyan-light,.rgba-cyan-light:after{background-color:rgba(0,188,212,.3)}.rgba-cyan-strong,.rgba-cyan-strong:after{background-color:rgba(0,188,212,.7)}.cyan.darken-1{background-color:#00acc1!important}.cyan.darken-2{background-color:#0097a7!important}.cyan.darken-3{background-color:#00838f!important}.cyan.darken-4{background-color:#006064!important}.cyan.accent-1{background-color:#84ffff!important}.cyan.accent-2{background-color:#18ffff!important}.cyan.accent-3{background-color:#00e5ff!important}.cyan.accent-4{background-color:#00b8d4!important}.teal.lighten-5{background-color:#e0f2f1!important}.teal.lighten-4{background-color:#b2dfdb!important}.teal.lighten-3{background-color:#80cbc4!important}.teal.lighten-2{background-color:#4db6ac!important}.teal.lighten-1{background-color:#26a69a!important}.teal{background-color:#009688!important}.teal-text{color:#009688!important}.rgba-teal-slight,.rgba-teal-slight:after{background-color:rgba(0,150,136,.1)}.rgba-teal-light,.rgba-teal-light:after{background-color:rgba(0,150,136,.3)}.rgba-teal-strong,.rgba-teal-strong:after{background-color:rgba(0,150,136,.7)}.teal.darken-1{background-color:#00897b!important}.teal.darken-2{background-color:#00796b!important}.teal.darken-3{background-color:#00695c!important}.teal.darken-4{background-color:#004d40!important}.teal.accent-1{background-color:#a7ffeb!important}.teal.accent-2{background-color:#64ffda!important}.teal.accent-3{background-color:#1de9b6!important}.teal.accent-4{background-color:#00bfa5!important}.green.lighten-5{background-color:#e8f5e9!important}.green.lighten-4{background-color:#c8e6c9!important}.green.lighten-3{background-color:#a5d6a7!important}.green.lighten-2{background-color:#81c784!important}.green.lighten-1{background-color:#66bb6a!important}.green{background-color:#4caf50!important}.green-text{color:#4caf50!important}.rgba-green-slight,.rgba-green-slight:after{background-color:rgba(76,175,80,.1)}.rgba-green-light,.rgba-green-light:after{background-color:rgba(76,175,80,.3)}.rgba-green-strong,.rgba-green-strong:after{background-color:rgba(76,175,80,.7)}.green.darken-1{background-color:#43a047!important}.green.darken-2{background-color:#388e3c!important}.green.darken-3{background-color:#2e7d32!important}.green.darken-4{background-color:#1b5e20!important}.green.accent-1{background-color:#b9f6ca!important}.green.accent-2{background-color:#69f0ae!important}.green.accent-3{background-color:#00e676!important}.green.accent-4{background-color:#00c853!important}.light-green.lighten-5{background-color:#f1f8e9!important}.light-green.lighten-4{background-color:#dcedc8!important}.light-green.lighten-3{background-color:#c5e1a5!important}.light-green.lighten-2{background-color:#aed581!important}.light-green.lighten-1{background-color:#9ccc65!important}.light-green{background-color:#8bc34a!important}.light-green-text{color:#8bc34a!important}.rgba-light-green-slight,.rgba-light-green-slight:after{background-color:rgba(139,195,74,.1)}.rgba-light-green-light,.rgba-light-green-light:after{background-color:rgba(139,195,74,.3)}.rgba-light-green-strong,.rgba-light-green-strong:after{background-color:rgba(139,195,74,.7)}.light-green.darken-1{background-color:#7cb342!important}.light-green.darken-2{background-color:#689f38!important}.light-green.darken-3{background-color:#558b2f!important}.light-green.darken-4{background-color:#33691e!important}.light-green.accent-1{background-color:#ccff90!important}.light-green.accent-2{background-color:#b2ff59!important}.light-green.accent-3{background-color:#76ff03!important}.light-green.accent-4{background-color:#64dd17!important}.lime.lighten-5{background-color:#f9fbe7!important}.lime.lighten-4{background-color:#f0f4c3!important}.lime.lighten-3{background-color:#e6ee9c!important}.lime.lighten-2{background-color:#dce775!important}.lime.lighten-1{background-color:#d4e157!important}.lime{background-color:#cddc39!important}.lime-text{color:#cddc39!important}.rgba-lime-slight,.rgba-lime-slight:after{background-color:rgba(205,220,57,.1)}.rgba-lime-light,.rgba-lime-light:after{background-color:rgba(205,220,57,.3)}.rgba-lime-strong,.rgba-lime-strong:after{background-color:rgba(205,220,57,.7)}.lime.darken-1{background-color:#c0ca33!important}.lime.darken-2{background-color:#afb42b!important}.lime.darken-3{background-color:#9e9d24!important}.lime.darken-4{background-color:#827717!important}.lime.accent-1{background-color:#f4ff81!important}.lime.accent-2{background-color:#eeff41!important}.lime.accent-3{background-color:#c6ff00!important}.lime.accent-4{background-color:#aeea00!important}.yellow.lighten-5{background-color:#fffde7!important}.yellow.lighten-4{background-color:#fff9c4!important}.yellow.lighten-3{background-color:#fff59d!important}.yellow.lighten-2{background-color:#fff176!important}.yellow.lighten-1{background-color:#ffee58!important}.yellow{background-color:#ffeb3b!important}.yellow-text{color:#ffeb3b!important}.rgba-yellow-slight,.rgba-yellow-slight:after{background-color:rgba(255,235,59,.1)}.rgba-yellow-light,.rgba-yellow-light:after{background-color:rgba(255,235,59,.3)}.rgba-yellow-strong,.rgba-yellow-strong:after{background-color:rgba(255,235,59,.7)}.yellow.darken-1{background-color:#fdd835!important}.yellow.darken-2{background-color:#fbc02d!important}.yellow.darken-3{background-color:#f9a825!important}.yellow.darken-4{background-color:#f57f17!important}.yellow.accent-1{background-color:#ffff8d!important}.yellow.accent-2{background-color:#ff0!important}.yellow.accent-3{background-color:#ffea00!important}.yellow.accent-4{background-color:#ffd600!important}.amber.lighten-5{background-color:#fff8e1!important}.amber.lighten-4{background-color:#ffecb3!important}.amber.lighten-3{background-color:#ffe082!important}.amber.lighten-2{background-color:#ffd54f!important}.amber.lighten-1{background-color:#ffca28!important}.amber{background-color:#ffc107!important}.amber-text{color:#ffc107!important}.rgba-amber-slight,.rgba-amber-slight:after{background-color:rgba(255,193,7,.1)}.rgba-amber-light,.rgba-amber-light:after{background-color:rgba(255,193,7,.3)}.rgba-amber-strong,.rgba-amber-strong:after{background-color:rgba(255,193,7,.7)}.amber.darken-1{background-color:#ffb300!important}.amber.darken-2{background-color:#ffa000!important}.amber.darken-3{background-color:#ff8f00!important}.amber.darken-4{background-color:#ff6f00!important}.amber.accent-1{background-color:#ffe57f!important}.amber.accent-2{background-color:#ffd740!important}.amber.accent-3{background-color:#ffc400!important}.amber.accent-4{background-color:#ffab00!important}.orange.lighten-5{background-color:#fff3e0!important}.orange.lighten-4{background-color:#ffe0b2!important}.orange.lighten-3{background-color:#ffcc80!important}.orange.lighten-2{background-color:#ffb74d!important}.orange.lighten-1{background-color:#ffa726!important}.orange{background-color:#ff9800!important}.orange-text{color:#ff9800!important}.rgba-orange-slight,.rgba-orange-slight:after{background-color:rgba(255,152,0,.1)}.rgba-orange-light,.rgba-orange-light:after{background-color:rgba(255,152,0,.3)}.rgba-orange-strong,.rgba-orange-strong:after{background-color:rgba(255,152,0,.7)}.orange.darken-1{background-color:#fb8c00!important}.orange.darken-2{background-color:#f57c00!important}.orange.darken-3{background-color:#ef6c00!important}.orange.darken-4{background-color:#e65100!important}.orange.accent-1{background-color:#ffd180!important}.orange.accent-2{background-color:#ffab40!important}.orange.accent-3{background-color:#ff9100!important}.orange.accent-4{background-color:#ff6d00!important}.deep-orange.lighten-5{background-color:#fbe9e7!important}.deep-orange.lighten-4{background-color:#ffccbc!important}.deep-orange.lighten-3{background-color:#ffab91!important}.deep-orange.lighten-2{background-color:#ff8a65!important}.deep-orange.lighten-1{background-color:#ff7043!important}.deep-orange{background-color:#ff5722!important}.deep-orange-text{color:#ff5722!important}.rgba-deep-orange-slight,.rgba-deep-orange-slight:after{background-color:rgba(255,87,34,.1)}.rgba-deep-orange-light,.rgba-deep-orange-light:after{background-color:rgba(255,87,34,.3)}.rgba-deep-orange-strong,.rgba-deep-orange-strong:after{background-color:rgba(255,87,34,.7)}.deep-orange.darken-1{background-color:#f4511e!important}.deep-orange.darken-2{background-color:#e64a19!important}.deep-orange.darken-3{background-color:#d84315!important}.deep-orange.darken-4{background-color:#bf360c!important}.deep-orange.accent-1{background-color:#ff9e80!important}.deep-orange.accent-2{background-color:#ff6e40!important}.deep-orange.accent-3{background-color:#ff3d00!important}.deep-orange.accent-4{background-color:#dd2c00!important}.brown.lighten-5{background-color:#efebe9!important}.brown.lighten-4{background-color:#d7ccc8!important}.brown.lighten-3{background-color:#bcaaa4!important}.brown.lighten-2{background-color:#a1887f!important}.brown.lighten-1{background-color:#8d6e63!important}.brown{background-color:#795548!important}.brown-text{color:#795548!important}.rgba-brown-slight,.rgba-brown-slight:after{background-color:rgba(121,85,72,.1)}.rgba-brown-light,.rgba-brown-light:after{background-color:rgba(121,85,72,.3)}.rgba-brown-strong,.rgba-brown-strong:after{background-color:rgba(121,85,72,.7)}.brown.darken-1{background-color:#6d4c41!important}.brown.darken-2{background-color:#5d4037!important}.brown.darken-3{background-color:#4e342e!important}.brown.darken-4{background-color:#3e2723!important}.blue-grey.lighten-5{background-color:#eceff1!important}.blue-grey.lighten-4{background-color:#cfd8dc!important}.blue-grey.lighten-3{background-color:#b0bec5!important}.blue-grey.lighten-2{background-color:#90a4ae!important}.blue-grey.lighten-1{background-color:#78909c!important}.blue-grey{background-color:#607d8b!important}.blue-grey-text{color:#607d8b!important}.rgba-blue-grey-slight,.rgba-blue-grey-slight:after{background-color:rgba(96,125,139,.1)}.rgba-blue-grey-light,.rgba-blue-grey-light:after{background-color:rgba(96,125,139,.3)}.rgba-blue-grey-strong,.rgba-blue-grey-strong:after{background-color:rgba(96,125,139,.7)}.blue-grey.darken-1{background-color:#546e7a!important}.blue-grey.darken-2{background-color:#455a64!important}.blue-grey.darken-3{background-color:#37474f!important}.blue-grey.darken-4{background-color:#263238!important}.grey.lighten-5{background-color:#fafafa!important}.grey.lighten-4{background-color:#f5f5f5!important}.grey.lighten-3{background-color:#eee!important}.grey.lighten-2{background-color:#e0e0e0!important}.grey.lighten-1{background-color:#bdbdbd!important}.grey{background-color:#9e9e9e!important}.grey-text{color:#9e9e9e!important}.rgba-grey-slight,.rgba-grey-slight:after{background-color:rgba(158,158,158,.1)}.rgba-grey-light,.rgba-grey-light:after{background-color:rgba(158,158,158,.3)}.rgba-grey-strong,.rgba-grey-strong:after{background-color:rgba(158,158,158,.7)}.grey.darken-1{background-color:#757575!important}.grey.darken-2{background-color:#616161!important}.grey.darken-3{background-color:#424242!important}.grey.darken-4{background-color:#212121!important}.black{background-color:#000!important}.black-text,.btn.btn-link{color:#000!important}.rgba-black-slight,.rgba-black-slight:after{background-color:rgba(0,0,0,.1)}.rgba-black-light,.rgba-black-light:after{background-color:rgba(0,0,0,.3)}.rgba-black-strong,.rgba-black-strong:after{background-color:rgba(0,0,0,.7)}.white{background-color:#fff!important}.white-text{color:#fff!important}.rgba-white-slight,.rgba-white-slight:after{background-color:rgba(255,255,255,.1)}.rgba-white-light,.rgba-white-light:after{background-color:rgba(255,255,255,.3)}.rgba-white-strong,.rgba-white-strong:after{background-color:rgba(255,255,255,.7)}.rgba-stylish-slight{background-color:rgba(62,69,81,.1)}.rgba-stylish-light{background-color:rgba(62,69,81,.3)}.rgba-stylish-strong{background-color:rgba(62,69,81,.7)}.primary-color{background-color:#4285f4!important}.primary-color-dark{background-color:#0d47a1!important}.secondary-color{background-color:#a6c!important}.secondary-color-dark{background-color:#93c!important}.default-color{background-color:#2bbbad!important}.default-color-dark{background-color:#00695c!important}.info-color{background-color:#33b5e5!important}.info-color-dark{background-color:#09c!important}.success-color{background-color:#00c851!important}.success-color-dark{background-color:#007e33!important}.warning-color{background-color:#fb3!important}.warning-color-dark{background-color:#f80!important}.danger-color{background-color:#ff3547!important}.danger-color-dark{background-color:#c00!important}.elegant-color{background-color:#2e2e2e!important}.elegant-color-dark{background-color:#212121!important}.stylish-color{background-color:#4b515d!important}.stylish-color-dark{background-color:#3e4551!important}.unique-color{background-color:#3f729b!important}.unique-color-dark{background-color:#1c2331!important}.special-color{background-color:#37474f!important}.special-color-dark{background-color:#263238!important}.purple-gradient{background:linear-gradient(40deg,#ff6ec4,#7873f5)!important}.peach-gradient{background:linear-gradient(40deg,#ffd86f,#fc6262)!important}.aqua-gradient{background:linear-gradient(40deg,#2096ff,#05ffa3)!important}.blue-gradient{background:linear-gradient(40deg,#45cafc,#303f9f)!important}.purple-gradient-rgba{background:linear-gradient(40deg,rgba(255,110,196,.9),rgba(120,115,245,.9))!important}.peach-gradient-rgba{background:linear-gradient(40deg,rgba(255,216,111,.9),rgba(252,98,98,.9))!important}.aqua-gradient-rgba{background:linear-gradient(40deg,rgba(32,150,255,.9),rgba(5,255,163,.9))!important}.blue-gradient-rgba{background:linear-gradient(40deg,rgba(69,202,252,.9),rgba(48,63,159,.9))!important}.dark-grey-text,.dark-grey-text:focus,.dark-grey-text:hover{color:#4f4f4f!important}.hoverable{box-shadow:none;transition:.55s ease-in-out}.hoverable:hover{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);transition:.55s ease-in-out}.z-depth-0{box-shadow:none!important}.z-depth-1{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12)!important}.z-depth-1-half{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)!important}.z-depth-2{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)!important}.z-depth-3{box-shadow:0 12px 15px 0 rgba(0,0,0,.24),0 17px 50px 0 rgba(0,0,0,.19)!important}.z-depth-4{box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)!important}.z-depth-5{box-shadow:0 27px 24px 0 rgba(0,0,0,.2),0 40px 77px 0 rgba(0,0,0,.22)!important}.disabled,:disabled{pointer-events:none!important}a{cursor:pointer;text-decoration:none;color:#0275d8;transition:.2s ease-in-out}a:hover{text-decoration:none;color:#014c8c;transition:.2s ease-in-out}a.disabled:hover,a:disabled:hover{color:#0275d8}a:not([href]):not([tabindex]),a:not([href]):not([tabindex]):focus,a:not([href]):not([tabindex]):hover{color:inherit;text-decoration:none}.btn{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12);padding:.84rem 2.14rem;font-size:.81rem;transition:.2s ease-in-out;margin:.375rem;border:0;border-radius:.125rem;cursor:pointer;text-transform:uppercase;white-space:normal;word-wrap:break-word;color:inherit}.btn:active,.btn:focus,.btn:hover{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);outline:0}.btn:not([disabled]):not(.disabled).active,.btn:not([disabled]):not(.disabled):active{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn .fab,.btn .far,.btn .fas{position:relative;font-size:.9rem}.btn .fab.right,.btn .far.right,.btn .fas.right{margin-left:.3rem}.btn .fab.left,.btn .far.left,.btn .fas.left{margin-right:.3rem}.btn.btn-lg .fab,.btn.btn-lg .far,.btn.btn-lg .fas{font-size:1rem}.btn.btn-md .fab,.btn.btn-md .far,.btn.btn-md .fas{font-size:.8rem}.btn.btn-sm .fab,.btn.btn-sm .far,.btn.btn-sm .fas{font-size:.7rem}.btn.btn-tb{padding:.3rem 1rem}.btn.disabled:active,.btn.disabled:focus,.btn.disabled:hover,.btn:disabled:active,.btn:disabled:focus,.btn:disabled:hover{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12)}.btn.btn-block{margin:inherit}.btn.btn-link{box-shadow:none;background-color:transparent}.btn.btn-link:active,.btn.btn-link:focus,.btn.btn-link:hover{box-shadow:none!important;background-color:transparent}.btn[class*=btn-outline-]{padding-top:.7rem;padding-bottom:.7rem}.btn[class*=btn-outline-].btn-lg{padding-top:.88rem;padding-bottom:.88rem}.btn[class*=btn-outline-].btn-md{padding-top:.58rem;padding-bottom:.58rem}.btn[class*=btn-outline-].btn-sm{padding-top:.38rem;padding-bottom:.38rem}.btn-group .btn{margin:0}.btn .fa-lg,.btn-floating .fa-lg{font-size:1.33333em!important}.btn .fa-xs,.btn-floating .fa-xs{font-size:.75em!important}.btn .fa-sm,.btn-floating .fa-sm{font-size:.875em!important}.btn .fa-1x,.btn-floating .fa-1x{font-size:1em!important}.btn .fa-2x,.btn-floating .fa-2x{font-size:2em!important}.btn .fa-3x,.btn-floating .fa-3x{font-size:3em!important}.btn .fa-4x,.btn-floating .fa-4x{font-size:4em!important}.btn .fa-5x,.btn-floating .fa-5x{font-size:5em!important}.btn .fa-6x,.btn-floating .fa-6x{font-size:6em!important}.btn .fa-7x,.btn-floating .fa-7x{font-size:7em!important}.btn .fa-8x,.btn-floating .fa-8x{font-size:8em!important}.btn .fa-9x,.btn-floating .fa-9x{font-size:9em!important}.btn .fa-10x,.btn-floating .fa-10x{font-size:10em!important}.btn-primary{background-color:#4285f4!important;color:#fff}.btn-primary:hover{background-color:#5a95f5;color:#fff}.btn-primary.focus,.btn-primary:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-primary.active,.btn-primary:active,.btn-primary:focus{background-color:#0b51c5}.btn-primary.dropdown-toggle{background-color:#4285f4!important}.btn-primary.dropdown-toggle:focus,.btn-primary.dropdown-toggle:hover{background-color:#5a95f5!important}.btn-primary:not([disabled]):not(.disabled).active,.btn-primary:not([disabled]):not(.disabled):active,.show>.btn-primary.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#0b51c5!important}.btn-primary:not([disabled]):not(.disabled).active:focus,.btn-primary:not([disabled]):not(.disabled):active:focus,.show>.btn-primary.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.primary-ic{color:#4285f4!important}.primary-ic:focus,.primary-ic:hover{color:#4285f4}table.table a.btn.btn-primary{color:#fff}.btn-outline-primary{border:2px solid #4285f4!important;background-color:transparent!important;color:#4285f4!important}.btn-outline-primary.active,.btn-outline-primary:active,.btn-outline-primary:active:focus,.btn-outline-primary:focus,.btn-outline-primary:hover{border-color:#4285f4!important;background-color:transparent!important;color:#4285f4!important}.btn-outline-primary:not([disabled]):not(.disabled).active,.btn-outline-primary:not([disabled]):not(.disabled):active,.show>.btn-outline-primary.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#4285f4!important}.btn-outline-primary:not([disabled]):not(.disabled).active:focus,.btn-outline-primary:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-primary.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-danger{background-color:#ff3547!important;color:#fff}.btn-danger:hover{background-color:#ff4f5e;color:#fff}.btn-danger.focus,.btn-danger:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-danger.active,.btn-danger:active,.btn-danger:focus{background-color:#ce0012}.btn-danger.dropdown-toggle{background-color:#ff3547!important}.btn-danger.dropdown-toggle:focus,.btn-danger.dropdown-toggle:hover{background-color:#ff4f5e!important}.btn-danger:not([disabled]):not(.disabled).active,.btn-danger:not([disabled]):not(.disabled):active,.show>.btn-danger.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#ce0012!important}.btn-danger:not([disabled]):not(.disabled).active:focus,.btn-danger:not([disabled]):not(.disabled):active:focus,.show>.btn-danger.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.danger-ic{color:#ff3547!important}.danger-ic:focus,.danger-ic:hover{color:#ff3547}table.table a.btn.btn-danger{color:#fff}.btn-outline-danger{border:2px solid #ff3547!important;background-color:transparent!important;color:#ff3547!important}.btn-outline-danger.active,.btn-outline-danger:active,.btn-outline-danger:active:focus,.btn-outline-danger:focus,.btn-outline-danger:hover{border-color:#ff3547!important;background-color:transparent!important;color:#ff3547!important}.btn-outline-danger:not([disabled]):not(.disabled).active,.btn-outline-danger:not([disabled]):not(.disabled):active,.show>.btn-outline-danger.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#ff3547!important}.btn-outline-danger:not([disabled]):not(.disabled).active:focus,.btn-outline-danger:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-danger.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-warning{background-color:#fb3!important;color:#fff}.btn-warning:hover{background-color:#ffc44d;color:#fff}.btn-warning.focus,.btn-warning:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-warning.active,.btn-warning:active,.btn-warning:focus{background-color:#c80}.btn-warning.dropdown-toggle{background-color:#fb3!important}.btn-warning.dropdown-toggle:focus,.btn-warning.dropdown-toggle:hover{background-color:#ffc44d!important}.btn-warning:not([disabled]):not(.disabled).active,.btn-warning:not([disabled]):not(.disabled):active,.show>.btn-warning.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#c80!important}.btn-warning:not([disabled]):not(.disabled).active:focus,.btn-warning:not([disabled]):not(.disabled):active:focus,.show>.btn-warning.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.warning-ic{color:#fb3!important}.warning-ic:focus,.warning-ic:hover{color:#fb3}table.table a.btn.btn-warning{color:#fff}.btn-outline-warning{border:2px solid #fb3!important;background-color:transparent!important;color:#fb3!important}.btn-outline-warning.active,.btn-outline-warning:active,.btn-outline-warning:active:focus,.btn-outline-warning:focus,.btn-outline-warning:hover{border-color:#fb3!important;background-color:transparent!important;color:#fb3!important}.btn-outline-warning:not([disabled]):not(.disabled).active,.btn-outline-warning:not([disabled]):not(.disabled):active,.show>.btn-outline-warning.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#fb3!important}.btn-outline-warning:not([disabled]):not(.disabled).active:focus,.btn-outline-warning:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-warning.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-success{background-color:#00c851!important;color:#fff}.btn-success:hover{background-color:#00e25b;color:#fff}.btn-success.focus,.btn-success:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-success.active,.btn-success:active,.btn-success:focus{background-color:#006228}.btn-success.dropdown-toggle{background-color:#00c851!important}.btn-success.dropdown-toggle:focus,.btn-success.dropdown-toggle:hover{background-color:#00e25b!important}.btn-success:not([disabled]):not(.disabled).active,.btn-success:not([disabled]):not(.disabled):active,.show>.btn-success.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#006228!important}.btn-success:not([disabled]):not(.disabled).active:focus,.btn-success:not([disabled]):not(.disabled):active:focus,.show>.btn-success.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.success-ic{color:#00c851!important}.success-ic:focus,.success-ic:hover{color:#00c851}table.table a.btn.btn-success{color:#fff}.btn-outline-success{border:2px solid #00c851!important;background-color:transparent!important;color:#00c851!important}.btn-outline-success.active,.btn-outline-success:active,.btn-outline-success:active:focus,.btn-outline-success:focus,.btn-outline-success:hover{border-color:#00c851!important;background-color:transparent!important;color:#00c851!important}.btn-outline-success:not([disabled]):not(.disabled).active,.btn-outline-success:not([disabled]):not(.disabled):active,.show>.btn-outline-success.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#00c851!important}.btn-outline-success:not([disabled]):not(.disabled).active:focus,.btn-outline-success:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-success.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-info{background-color:#33b5e5!important;color:#fff}.btn-info:hover{background-color:#4abde8;color:#fff}.btn-info.focus,.btn-info:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-info.active,.btn-info:active,.btn-info:focus{background-color:#14799e}.btn-info.dropdown-toggle{background-color:#33b5e5!important}.btn-info.dropdown-toggle:focus,.btn-info.dropdown-toggle:hover{background-color:#4abde8!important}.btn-info:not([disabled]):not(.disabled).active,.btn-info:not([disabled]):not(.disabled):active,.show>.btn-info.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#14799e!important}.btn-info:not([disabled]):not(.disabled).active:focus,.btn-info:not([disabled]):not(.disabled):active:focus,.show>.btn-info.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.info-ic{color:#33b5e5!important}.info-ic:focus,.info-ic:hover{color:#33b5e5}table.table a.btn.btn-info{color:#fff}.btn-outline-info{border:2px solid #33b5e5!important;background-color:transparent!important;color:#33b5e5!important}.btn-outline-info.active,.btn-outline-info:active,.btn-outline-info:active:focus,.btn-outline-info:focus,.btn-outline-info:hover{border-color:#33b5e5!important;background-color:transparent!important;color:#33b5e5!important}.btn-outline-info:not([disabled]):not(.disabled).active,.btn-outline-info:not([disabled]):not(.disabled):active,.show>.btn-outline-info.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#33b5e5!important}.btn-outline-info:not([disabled]):not(.disabled).active:focus,.btn-outline-info:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-info.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-default{background-color:#2bbbad!important;color:#fff}.btn-default:hover{background-color:#30cfc0;color:#fff}.btn-default.focus,.btn-default:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-default.active,.btn-default:active,.btn-default:focus{background-color:#186860}.btn-default.dropdown-toggle{background-color:#2bbbad!important}.btn-default.dropdown-toggle:focus,.btn-default.dropdown-toggle:hover{background-color:#30cfc0!important}.btn-default:not([disabled]):not(.disabled).active,.btn-default:not([disabled]):not(.disabled):active,.show>.btn-default.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#186860!important}.btn-default:not([disabled]):not(.disabled).active:focus,.btn-default:not([disabled]):not(.disabled):active:focus,.show>.btn-default.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.default-ic{color:#2bbbad!important}.default-ic:focus,.default-ic:hover{color:#2bbbad}table.table a.btn.btn-default{color:#fff}.btn-outline-default{border:2px solid #2bbbad!important;background-color:transparent!important;color:#2bbbad!important}.btn-outline-default.active,.btn-outline-default:active,.btn-outline-default:active:focus,.btn-outline-default:focus,.btn-outline-default:hover{border-color:#2bbbad!important;background-color:transparent!important;color:#2bbbad!important}.btn-outline-default:not([disabled]):not(.disabled).active,.btn-outline-default:not([disabled]):not(.disabled):active,.show>.btn-outline-default.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#2bbbad!important}.btn-outline-default:not([disabled]):not(.disabled).active:focus,.btn-outline-default:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-default.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-secondary{background-color:#a6c!important;color:#fff}.btn-secondary:hover{background-color:#b579d2;color:#fff}.btn-secondary.focus,.btn-secondary:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-secondary.active,.btn-secondary:active,.btn-secondary:focus{background-color:#739}.btn-secondary.dropdown-toggle{background-color:#a6c!important}.btn-secondary.dropdown-toggle:focus,.btn-secondary.dropdown-toggle:hover{background-color:#b579d2!important}.btn-secondary:not([disabled]):not(.disabled).active,.btn-secondary:not([disabled]):not(.disabled):active,.show>.btn-secondary.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#739!important}.btn-secondary:not([disabled]):not(.disabled).active:focus,.btn-secondary:not([disabled]):not(.disabled):active:focus,.show>.btn-secondary.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.secondary-ic{color:#a6c!important}.secondary-ic:focus,.secondary-ic:hover{color:#a6c}table.table a.btn.btn-secondary{color:#fff}.btn-outline-secondary{border:2px solid #a6c!important;background-color:transparent!important;color:#a6c!important}.btn-outline-secondary.active,.btn-outline-secondary:active,.btn-outline-secondary:active:focus,.btn-outline-secondary:focus,.btn-outline-secondary:hover{border-color:#a6c!important;background-color:transparent!important;color:#a6c!important}.btn-outline-secondary:not([disabled]):not(.disabled).active,.btn-outline-secondary:not([disabled]):not(.disabled):active,.show>.btn-outline-secondary.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#a6c!important}.btn-outline-secondary:not([disabled]):not(.disabled).active:focus,.btn-outline-secondary:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-secondary.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-elegant{background-color:#2e2e2e!important;color:#fff}.btn-elegant:hover{background-color:#3b3b3b;color:#fff}.btn-elegant.focus,.btn-elegant:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-elegant.active,.btn-elegant:active,.btn-elegant:focus{background-color:#000}.btn-elegant.dropdown-toggle{background-color:#2e2e2e!important}.btn-elegant.dropdown-toggle:focus,.btn-elegant.dropdown-toggle:hover{background-color:#3b3b3b!important}.btn-elegant:not([disabled]):not(.disabled).active,.btn-elegant:not([disabled]):not(.disabled):active,.show>.btn-elegant.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#000!important}.btn-elegant:not([disabled]):not(.disabled).active:focus,.btn-elegant:not([disabled]):not(.disabled):active:focus,.show>.btn-elegant.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.elegant-ic{color:#2e2e2e!important}.elegant-ic:focus,.elegant-ic:hover{color:#2e2e2e}table.table a.btn.btn-elegant{color:#fff}.btn-outline-elegant{border:2px solid #2e2e2e!important;background-color:transparent!important;color:#2e2e2e!important}.btn-outline-elegant.active,.btn-outline-elegant:active,.btn-outline-elegant:active:focus,.btn-outline-elegant:focus,.btn-outline-elegant:hover{border-color:#2e2e2e!important;background-color:transparent!important;color:#2e2e2e!important}.btn-outline-elegant:not([disabled]):not(.disabled).active,.btn-outline-elegant:not([disabled]):not(.disabled):active,.show>.btn-outline-elegant.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#2e2e2e!important}.btn-outline-elegant:not([disabled]):not(.disabled).active:focus,.btn-outline-elegant:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-elegant.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-unique{background-color:#880e4f!important;color:#fff}.btn-unique:hover{background-color:#9f105c;color:#fff}.btn-unique.focus,.btn-unique:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-unique.active,.btn-unique:active,.btn-unique:focus{background-color:#2c0419}.btn-unique.dropdown-toggle{background-color:#880e4f!important}.btn-unique.dropdown-toggle:focus,.btn-unique.dropdown-toggle:hover{background-color:#9f105c!important}.btn-unique:not([disabled]):not(.disabled).active,.btn-unique:not([disabled]):not(.disabled):active,.show>.btn-unique.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#2c0419!important}.btn-unique:not([disabled]):not(.disabled).active:focus,.btn-unique:not([disabled]):not(.disabled):active:focus,.show>.btn-unique.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.unique-ic{color:#880e4f!important}.unique-ic:focus,.unique-ic:hover{color:#880e4f}table.table a.btn.btn-unique{color:#fff}.btn-outline-unique{border:2px solid #880e4f!important;background-color:transparent!important;color:#880e4f!important}.btn-outline-unique.active,.btn-outline-unique:active,.btn-outline-unique:active:focus,.btn-outline-unique:focus,.btn-outline-unique:hover{border-color:#880e4f!important;background-color:transparent!important;color:#880e4f!important}.btn-outline-unique:not([disabled]):not(.disabled).active,.btn-outline-unique:not([disabled]):not(.disabled):active,.show>.btn-outline-unique.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#880e4f!important}.btn-outline-unique:not([disabled]):not(.disabled).active:focus,.btn-outline-unique:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-unique.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-dark-green{background-color:#388e3c!important;color:#fff}.btn-dark-green:hover{background-color:#3fa044;color:#fff}.btn-dark-green.focus,.btn-dark-green:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-dark-green.active,.btn-dark-green:active,.btn-dark-green:focus{background-color:#1b451d}.btn-dark-green.dropdown-toggle{background-color:#388e3c!important}.btn-dark-green.dropdown-toggle:focus,.btn-dark-green.dropdown-toggle:hover{background-color:#3fa044!important}.btn-dark-green:not([disabled]):not(.disabled).active,.btn-dark-green:not([disabled]):not(.disabled):active,.show>.btn-dark-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#1b451d!important}.btn-dark-green:not([disabled]):not(.disabled).active:focus,.btn-dark-green:not([disabled]):not(.disabled):active:focus,.show>.btn-dark-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.dark-green-ic{color:#388e3c!important}.dark-green-ic:focus,.dark-green-ic:hover{color:#388e3c}table.table a.btn.btn-dark-green{color:#fff}.btn-outline-dark-green{border:2px solid #388e3c!important;background-color:transparent!important;color:#388e3c!important}.btn-outline-dark-green.active,.btn-outline-dark-green:active,.btn-outline-dark-green:active:focus,.btn-outline-dark-green:focus,.btn-outline-dark-green:hover{border-color:#388e3c!important;background-color:transparent!important;color:#388e3c!important}.btn-outline-dark-green:not([disabled]):not(.disabled).active,.btn-outline-dark-green:not([disabled]):not(.disabled):active,.show>.btn-outline-dark-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#388e3c!important}.btn-outline-dark-green:not([disabled]):not(.disabled).active:focus,.btn-outline-dark-green:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-dark-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-mdb-color{background-color:#59698d!important;color:#fff}.btn-mdb-color:hover{background-color:#63759d;color:#fff}.btn-mdb-color.focus,.btn-mdb-color:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-mdb-color.active,.btn-mdb-color:active,.btn-mdb-color:focus{background-color:#323a4e}.btn-mdb-color.dropdown-toggle{background-color:#59698d!important}.btn-mdb-color.dropdown-toggle:focus,.btn-mdb-color.dropdown-toggle:hover{background-color:#63759d!important}.btn-mdb-color:not([disabled]):not(.disabled).active,.btn-mdb-color:not([disabled]):not(.disabled):active,.show>.btn-mdb-color.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#323a4e!important}.btn-mdb-color:not([disabled]):not(.disabled).active:focus,.btn-mdb-color:not([disabled]):not(.disabled):active:focus,.show>.btn-mdb-color.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.mdb-color-ic{color:#59698d!important}.mdb-color-ic:focus,.mdb-color-ic:hover{color:#59698d}table.table a.btn.btn-mdb-color{color:#fff}.btn-outline-mdb-color{border:2px solid #59698d!important;background-color:transparent!important;color:#59698d!important}.btn-outline-mdb-color.active,.btn-outline-mdb-color:active,.btn-outline-mdb-color:active:focus,.btn-outline-mdb-color:focus,.btn-outline-mdb-color:hover{border-color:#59698d!important;background-color:transparent!important;color:#59698d!important}.btn-outline-mdb-color:not([disabled]):not(.disabled).active,.btn-outline-mdb-color:not([disabled]):not(.disabled):active,.show>.btn-outline-mdb-color.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#59698d!important}.btn-outline-mdb-color:not([disabled]):not(.disabled).active:focus,.btn-outline-mdb-color:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-mdb-color.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-red{background-color:#d32f2f!important;color:#fff}.btn-red:hover{background-color:#d74444;color:#fff}.btn-red.focus,.btn-red:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-red.active,.btn-red:active,.btn-red:focus{background-color:#811b1b}.btn-red.dropdown-toggle{background-color:#d32f2f!important}.btn-red.dropdown-toggle:focus,.btn-red.dropdown-toggle:hover{background-color:#d74444!important}.btn-red:not([disabled]):not(.disabled).active,.btn-red:not([disabled]):not(.disabled):active,.show>.btn-red.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#811b1b!important}.btn-red:not([disabled]):not(.disabled).active:focus,.btn-red:not([disabled]):not(.disabled):active:focus,.show>.btn-red.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.red-ic{color:#d32f2f!important}.red-ic:focus,.red-ic:hover{color:#d32f2f}table.table a.btn.btn-red{color:#fff}.btn-outline-red{border:2px solid #d32f2f!important;background-color:transparent!important;color:#d32f2f!important}.btn-outline-red.active,.btn-outline-red:active,.btn-outline-red:active:focus,.btn-outline-red:focus,.btn-outline-red:hover{border-color:#d32f2f!important;background-color:transparent!important;color:#d32f2f!important}.btn-outline-red:not([disabled]):not(.disabled).active,.btn-outline-red:not([disabled]):not(.disabled):active,.show>.btn-outline-red.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#d32f2f!important}.btn-outline-red:not([disabled]):not(.disabled).active:focus,.btn-outline-red:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-red.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-pink{background-color:#ec407a!important;color:#fff}.btn-pink:hover{background-color:#ee578a;color:#fff}.btn-pink.focus,.btn-pink:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-pink.active,.btn-pink:active,.btn-pink:focus{background-color:#b41249}.btn-pink.dropdown-toggle{background-color:#ec407a!important}.btn-pink.dropdown-toggle:focus,.btn-pink.dropdown-toggle:hover{background-color:#ee578a!important}.btn-pink:not([disabled]):not(.disabled).active,.btn-pink:not([disabled]):not(.disabled):active,.show>.btn-pink.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#b41249!important}.btn-pink:not([disabled]):not(.disabled).active:focus,.btn-pink:not([disabled]):not(.disabled):active:focus,.show>.btn-pink.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.pink-ic{color:#ec407a!important}.pink-ic:focus,.pink-ic:hover{color:#ec407a}table.table a.btn.btn-pink{color:#fff}.btn-outline-pink{border:2px solid #ec407a!important;background-color:transparent!important;color:#ec407a!important}.btn-outline-pink.active,.btn-outline-pink:active,.btn-outline-pink:active:focus,.btn-outline-pink:focus,.btn-outline-pink:hover{border-color:#ec407a!important;background-color:transparent!important;color:#ec407a!important}.btn-outline-pink:not([disabled]):not(.disabled).active,.btn-outline-pink:not([disabled]):not(.disabled):active,.show>.btn-outline-pink.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#ec407a!important}.btn-outline-pink:not([disabled]):not(.disabled).active:focus,.btn-outline-pink:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-pink.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-purple{background-color:#8e24aa!important;color:#fff}.btn-purple:hover{background-color:#a028bf;color:#fff}.btn-purple.focus,.btn-purple:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-purple.active,.btn-purple:active,.btn-purple:focus{background-color:#481256}.btn-purple.dropdown-toggle{background-color:#8e24aa!important}.btn-purple.dropdown-toggle:focus,.btn-purple.dropdown-toggle:hover{background-color:#a028bf!important}.btn-purple:not([disabled]):not(.disabled).active,.btn-purple:not([disabled]):not(.disabled):active,.show>.btn-purple.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#481256!important}.btn-purple:not([disabled]):not(.disabled).active:focus,.btn-purple:not([disabled]):not(.disabled):active:focus,.show>.btn-purple.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.purple-ic{color:#8e24aa!important}.purple-ic:focus,.purple-ic:hover{color:#8e24aa}table.table a.btn.btn-purple{color:#fff}.btn-outline-purple{border:2px solid #8e24aa!important;background-color:transparent!important;color:#8e24aa!important}.btn-outline-purple.active,.btn-outline-purple:active,.btn-outline-purple:active:focus,.btn-outline-purple:focus,.btn-outline-purple:hover{border-color:#8e24aa!important;background-color:transparent!important;color:#8e24aa!important}.btn-outline-purple:not([disabled]):not(.disabled).active,.btn-outline-purple:not([disabled]):not(.disabled):active,.show>.btn-outline-purple.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#8e24aa!important}.btn-outline-purple:not([disabled]):not(.disabled).active:focus,.btn-outline-purple:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-purple.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-deep-purple{background-color:#512da8!important;color:#fff}.btn-deep-purple:hover{background-color:#5b32bc;color:#fff}.btn-deep-purple.focus,.btn-deep-purple:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-deep-purple.active,.btn-deep-purple:active,.btn-deep-purple:focus{background-color:#2a1758}.btn-deep-purple.dropdown-toggle{background-color:#512da8!important}.btn-deep-purple.dropdown-toggle:focus,.btn-deep-purple.dropdown-toggle:hover{background-color:#5b32bc!important}.btn-deep-purple:not([disabled]):not(.disabled).active,.btn-deep-purple:not([disabled]):not(.disabled):active,.show>.btn-deep-purple.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#2a1758!important}.btn-deep-purple:not([disabled]):not(.disabled).active:focus,.btn-deep-purple:not([disabled]):not(.disabled):active:focus,.show>.btn-deep-purple.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.deep-purple-ic{color:#512da8!important}.deep-purple-ic:focus,.deep-purple-ic:hover{color:#512da8}table.table a.btn.btn-deep-purple{color:#fff}.btn-outline-deep-purple{border:2px solid #512da8!important;background-color:transparent!important;color:#512da8!important}.btn-outline-deep-purple.active,.btn-outline-deep-purple:active,.btn-outline-deep-purple:active:focus,.btn-outline-deep-purple:focus,.btn-outline-deep-purple:hover{border-color:#512da8!important;background-color:transparent!important;color:#512da8!important}.btn-outline-deep-purple:not([disabled]):not(.disabled).active,.btn-outline-deep-purple:not([disabled]):not(.disabled):active,.show>.btn-outline-deep-purple.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#512da8!important}.btn-outline-deep-purple:not([disabled]):not(.disabled).active:focus,.btn-outline-deep-purple:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-deep-purple.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-indigo{background-color:#3f51b5!important;color:#fff}.btn-indigo:hover{background-color:#4d5ec1;color:#fff}.btn-indigo.focus,.btn-indigo:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-indigo.active,.btn-indigo:active,.btn-indigo:focus{background-color:#252f69}.btn-indigo.dropdown-toggle{background-color:#3f51b5!important}.btn-indigo.dropdown-toggle:focus,.btn-indigo.dropdown-toggle:hover{background-color:#4d5ec1!important}.btn-indigo:not([disabled]):not(.disabled).active,.btn-indigo:not([disabled]):not(.disabled):active,.show>.btn-indigo.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#252f69!important}.btn-indigo:not([disabled]):not(.disabled).active:focus,.btn-indigo:not([disabled]):not(.disabled):active:focus,.show>.btn-indigo.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.indigo-ic{color:#3f51b5!important}.indigo-ic:focus,.indigo-ic:hover{color:#3f51b5}table.table a.btn.btn-indigo{color:#fff}.btn-outline-indigo{border:2px solid #3f51b5!important;background-color:transparent!important;color:#3f51b5!important}.btn-outline-indigo.active,.btn-outline-indigo:active,.btn-outline-indigo:active:focus,.btn-outline-indigo:focus,.btn-outline-indigo:hover{border-color:#3f51b5!important;background-color:transparent!important;color:#3f51b5!important}.btn-outline-indigo:not([disabled]):not(.disabled).active,.btn-outline-indigo:not([disabled]):not(.disabled):active,.show>.btn-outline-indigo.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#3f51b5!important}.btn-outline-indigo:not([disabled]):not(.disabled).active:focus,.btn-outline-indigo:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-indigo.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-blue{background-color:#1976d2!important;color:#fff}.btn-blue:hover{background-color:#2083e4;color:#fff}.btn-blue.focus,.btn-blue:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-blue.active,.btn-blue:active,.btn-blue:focus{background-color:#0e4377}.btn-blue.dropdown-toggle{background-color:#1976d2!important}.btn-blue.dropdown-toggle:focus,.btn-blue.dropdown-toggle:hover{background-color:#2083e4!important}.btn-blue:not([disabled]):not(.disabled).active,.btn-blue:not([disabled]):not(.disabled):active,.show>.btn-blue.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#0e4377!important}.btn-blue:not([disabled]):not(.disabled).active:focus,.btn-blue:not([disabled]):not(.disabled):active:focus,.show>.btn-blue.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.blue-ic{color:#1976d2!important}.blue-ic:focus,.blue-ic:hover{color:#1976d2}table.table a.btn.btn-blue{color:#fff}.btn-outline-blue{border:2px solid #1976d2!important;background-color:transparent!important;color:#1976d2!important}.btn-outline-blue.active,.btn-outline-blue:active,.btn-outline-blue:active:focus,.btn-outline-blue:focus,.btn-outline-blue:hover{border-color:#1976d2!important;background-color:transparent!important;color:#1976d2!important}.btn-outline-blue:not([disabled]):not(.disabled).active,.btn-outline-blue:not([disabled]):not(.disabled):active,.show>.btn-outline-blue.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#1976d2!important}.btn-outline-blue:not([disabled]):not(.disabled).active:focus,.btn-outline-blue:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-blue.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light-blue{background-color:#82b1ff!important;color:#fff}.btn-light-blue:hover{background-color:#9cc1ff;color:#fff}.btn-light-blue.focus,.btn-light-blue:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light-blue.active,.btn-light-blue:active,.btn-light-blue:focus{background-color:#1c71ff}.btn-light-blue.dropdown-toggle{background-color:#82b1ff!important}.btn-light-blue.dropdown-toggle:focus,.btn-light-blue.dropdown-toggle:hover{background-color:#9cc1ff!important}.btn-light-blue:not([disabled]):not(.disabled).active,.btn-light-blue:not([disabled]):not(.disabled):active,.show>.btn-light-blue.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#1c71ff!important}.btn-light-blue:not([disabled]):not(.disabled).active:focus,.btn-light-blue:not([disabled]):not(.disabled):active:focus,.show>.btn-light-blue.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.light-blue-ic{color:#82b1ff!important}.light-blue-ic:focus,.light-blue-ic:hover{color:#82b1ff}table.table a.btn.btn-light-blue{color:#fff}.btn-outline-light-blue{border:2px solid #82b1ff!important;background-color:transparent!important;color:#82b1ff!important}.btn-outline-light-blue.active,.btn-outline-light-blue:active,.btn-outline-light-blue:active:focus,.btn-outline-light-blue:focus,.btn-outline-light-blue:hover{border-color:#82b1ff!important;background-color:transparent!important;color:#82b1ff!important}.btn-outline-light-blue:not([disabled]):not(.disabled).active,.btn-outline-light-blue:not([disabled]):not(.disabled):active,.show>.btn-outline-light-blue.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#82b1ff!important}.btn-outline-light-blue:not([disabled]):not(.disabled).active:focus,.btn-outline-light-blue:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-light-blue.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-cyan{background-color:#00bcd4!important;color:#fff}.btn-cyan:hover{background-color:#00d3ee;color:#fff}.btn-cyan.focus,.btn-cyan:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-cyan.active,.btn-cyan:active,.btn-cyan:focus{background-color:#00626e}.btn-cyan.dropdown-toggle{background-color:#00bcd4!important}.btn-cyan.dropdown-toggle:focus,.btn-cyan.dropdown-toggle:hover{background-color:#00d3ee!important}.btn-cyan:not([disabled]):not(.disabled).active,.btn-cyan:not([disabled]):not(.disabled):active,.show>.btn-cyan.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#00626e!important}.btn-cyan:not([disabled]):not(.disabled).active:focus,.btn-cyan:not([disabled]):not(.disabled):active:focus,.show>.btn-cyan.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.cyan-ic{color:#00bcd4!important}.cyan-ic:focus,.cyan-ic:hover{color:#00bcd4}table.table a.btn.btn-cyan{color:#fff}.btn-outline-cyan{border:2px solid #00bcd4!important;background-color:transparent!important;color:#00bcd4!important}.btn-outline-cyan.active,.btn-outline-cyan:active,.btn-outline-cyan:active:focus,.btn-outline-cyan:focus,.btn-outline-cyan:hover{border-color:#00bcd4!important;background-color:transparent!important;color:#00bcd4!important}.btn-outline-cyan:not([disabled]):not(.disabled).active,.btn-outline-cyan:not([disabled]):not(.disabled):active,.show>.btn-outline-cyan.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#00bcd4!important}.btn-outline-cyan:not([disabled]):not(.disabled).active:focus,.btn-outline-cyan:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-cyan.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-teal{background-color:#00796b!important;color:#fff}.btn-teal:hover{background-color:#009382;color:#fff}.btn-teal.focus,.btn-teal:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-teal.active,.btn-teal:active,.btn-teal:focus{background-color:#001311}.btn-teal.dropdown-toggle{background-color:#00796b!important}.btn-teal.dropdown-toggle:focus,.btn-teal.dropdown-toggle:hover{background-color:#009382!important}.btn-teal:not([disabled]):not(.disabled).active,.btn-teal:not([disabled]):not(.disabled):active,.show>.btn-teal.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#001311!important}.btn-teal:not([disabled]):not(.disabled).active:focus,.btn-teal:not([disabled]):not(.disabled):active:focus,.show>.btn-teal.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.teal-ic{color:#00796b!important}.teal-ic:focus,.teal-ic:hover{color:#00796b}table.table a.btn.btn-teal{color:#fff}.btn-outline-teal{border:2px solid #00796b!important;background-color:transparent!important;color:#00796b!important}.btn-outline-teal.active,.btn-outline-teal:active,.btn-outline-teal:active:focus,.btn-outline-teal:focus,.btn-outline-teal:hover{border-color:#00796b!important;background-color:transparent!important;color:#00796b!important}.btn-outline-teal:not([disabled]):not(.disabled).active,.btn-outline-teal:not([disabled]):not(.disabled):active,.show>.btn-outline-teal.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#00796b!important}.btn-outline-teal:not([disabled]):not(.disabled).active:focus,.btn-outline-teal:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-teal.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-green{background-color:#388e3c!important;color:#fff}.btn-green:hover{background-color:#3fa044;color:#fff}.btn-green.focus,.btn-green:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-green.active,.btn-green:active,.btn-green:focus{background-color:#1b451d}.btn-green.dropdown-toggle{background-color:#388e3c!important}.btn-green.dropdown-toggle:focus,.btn-green.dropdown-toggle:hover{background-color:#3fa044!important}.btn-green:not([disabled]):not(.disabled).active,.btn-green:not([disabled]):not(.disabled):active,.show>.btn-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#1b451d!important}.btn-green:not([disabled]):not(.disabled).active:focus,.btn-green:not([disabled]):not(.disabled):active:focus,.show>.btn-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.green-ic{color:#388e3c!important}.green-ic:focus,.green-ic:hover{color:#388e3c}table.table a.btn.btn-green{color:#fff}.btn-outline-green{border:2px solid #388e3c!important;background-color:transparent!important;color:#388e3c!important}.btn-outline-green.active,.btn-outline-green:active,.btn-outline-green:active:focus,.btn-outline-green:focus,.btn-outline-green:hover{border-color:#388e3c!important;background-color:transparent!important;color:#388e3c!important}.btn-outline-green:not([disabled]):not(.disabled).active,.btn-outline-green:not([disabled]):not(.disabled):active,.show>.btn-outline-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#388e3c!important}.btn-outline-green:not([disabled]):not(.disabled).active:focus,.btn-outline-green:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light-green{background-color:#8bc34a!important;color:#fff}.btn-light-green:hover{background-color:#97c95d;color:#fff}.btn-light-green.focus,.btn-light-green:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light-green.active,.btn-light-green:active,.btn-light-green:focus{background-color:#577d2a}.btn-light-green.dropdown-toggle{background-color:#8bc34a!important}.btn-light-green.dropdown-toggle:focus,.btn-light-green.dropdown-toggle:hover{background-color:#97c95d!important}.btn-light-green:not([disabled]):not(.disabled).active,.btn-light-green:not([disabled]):not(.disabled):active,.show>.btn-light-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#577d2a!important}.btn-light-green:not([disabled]):not(.disabled).active:focus,.btn-light-green:not([disabled]):not(.disabled):active:focus,.show>.btn-light-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.light-green-ic{color:#8bc34a!important}.light-green-ic:focus,.light-green-ic:hover{color:#8bc34a}table.table a.btn.btn-light-green{color:#fff}.btn-outline-light-green{border:2px solid #8bc34a!important;background-color:transparent!important;color:#8bc34a!important}.btn-outline-light-green.active,.btn-outline-light-green:active,.btn-outline-light-green:active:focus,.btn-outline-light-green:focus,.btn-outline-light-green:hover{border-color:#8bc34a!important;background-color:transparent!important;color:#8bc34a!important}.btn-outline-light-green:not([disabled]):not(.disabled).active,.btn-outline-light-green:not([disabled]):not(.disabled):active,.show>.btn-outline-light-green.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#8bc34a!important}.btn-outline-light-green:not([disabled]):not(.disabled).active:focus,.btn-outline-light-green:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-light-green.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-lime{background-color:#afb42b!important;color:#fff}.btn-lime:hover{background-color:#c3c930;color:#fff}.btn-lime.focus,.btn-lime:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-lime.active,.btn-lime:active,.btn-lime:focus{background-color:#5f6217}.btn-lime.dropdown-toggle{background-color:#afb42b!important}.btn-lime.dropdown-toggle:focus,.btn-lime.dropdown-toggle:hover{background-color:#c3c930!important}.btn-lime:not([disabled]):not(.disabled).active,.btn-lime:not([disabled]):not(.disabled):active,.show>.btn-lime.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#5f6217!important}.btn-lime:not([disabled]):not(.disabled).active:focus,.btn-lime:not([disabled]):not(.disabled):active:focus,.show>.btn-lime.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.lime-ic{color:#afb42b!important}.lime-ic:focus,.lime-ic:hover{color:#afb42b}table.table a.btn.btn-lime{color:#fff}.btn-outline-lime{border:2px solid #afb42b!important;background-color:transparent!important;color:#afb42b!important}.btn-outline-lime.active,.btn-outline-lime:active,.btn-outline-lime:active:focus,.btn-outline-lime:focus,.btn-outline-lime:hover{border-color:#afb42b!important;background-color:transparent!important;color:#afb42b!important}.btn-outline-lime:not([disabled]):not(.disabled).active,.btn-outline-lime:not([disabled]):not(.disabled):active,.show>.btn-outline-lime.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#afb42b!important}.btn-outline-lime:not([disabled]):not(.disabled).active:focus,.btn-outline-lime:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-lime.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-yellow{background-color:#fbc02d!important;color:#fff}.btn-yellow:hover{background-color:#fbc846;color:#fff}.btn-yellow.focus,.btn-yellow:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-yellow.active,.btn-yellow:active,.btn-yellow:focus{background-color:#be8904}.btn-yellow.dropdown-toggle{background-color:#fbc02d!important}.btn-yellow.dropdown-toggle:focus,.btn-yellow.dropdown-toggle:hover{background-color:#fbc846!important}.btn-yellow:not([disabled]):not(.disabled).active,.btn-yellow:not([disabled]):not(.disabled):active,.show>.btn-yellow.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#be8904!important}.btn-yellow:not([disabled]):not(.disabled).active:focus,.btn-yellow:not([disabled]):not(.disabled):active:focus,.show>.btn-yellow.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.yellow-ic{color:#fbc02d!important}.yellow-ic:focus,.yellow-ic:hover{color:#fbc02d}table.table a.btn.btn-yellow{color:#fff}.btn-outline-yellow{border:2px solid #fbc02d!important;background-color:transparent!important;color:#fbc02d!important}.btn-outline-yellow.active,.btn-outline-yellow:active,.btn-outline-yellow:active:focus,.btn-outline-yellow:focus,.btn-outline-yellow:hover{border-color:#fbc02d!important;background-color:transparent!important;color:#fbc02d!important}.btn-outline-yellow:not([disabled]):not(.disabled).active,.btn-outline-yellow:not([disabled]):not(.disabled):active,.show>.btn-outline-yellow.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#fbc02d!important}.btn-outline-yellow:not([disabled]):not(.disabled).active:focus,.btn-outline-yellow:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-yellow.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-amber{background-color:#ffa000!important;color:#fff}.btn-amber:hover{background-color:#ffaa1a;color:#fff}.btn-amber.focus,.btn-amber:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-amber.active,.btn-amber:active,.btn-amber:focus{background-color:#996000}.btn-amber.dropdown-toggle{background-color:#ffa000!important}.btn-amber.dropdown-toggle:focus,.btn-amber.dropdown-toggle:hover{background-color:#ffaa1a!important}.btn-amber:not([disabled]):not(.disabled).active,.btn-amber:not([disabled]):not(.disabled):active,.show>.btn-amber.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#996000!important}.btn-amber:not([disabled]):not(.disabled).active:focus,.btn-amber:not([disabled]):not(.disabled):active:focus,.show>.btn-amber.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.amber-ic{color:#ffa000!important}.amber-ic:focus,.amber-ic:hover{color:#ffa000}table.table a.btn.btn-amber{color:#fff}.btn-outline-amber{border:2px solid #ffa000!important;background-color:transparent!important;color:#ffa000!important}.btn-outline-amber.active,.btn-outline-amber:active,.btn-outline-amber:active:focus,.btn-outline-amber:focus,.btn-outline-amber:hover{border-color:#ffa000!important;background-color:transparent!important;color:#ffa000!important}.btn-outline-amber:not([disabled]):not(.disabled).active,.btn-outline-amber:not([disabled]):not(.disabled):active,.show>.btn-outline-amber.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#ffa000!important}.btn-outline-amber:not([disabled]):not(.disabled).active:focus,.btn-outline-amber:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-amber.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-orange{background-color:#f57c00!important;color:#fff}.btn-orange:hover{background-color:#ff8910;color:#fff}.btn-orange.focus,.btn-orange:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-orange.active,.btn-orange:active,.btn-orange:focus{background-color:#8f4800}.btn-orange.dropdown-toggle{background-color:#f57c00!important}.btn-orange.dropdown-toggle:focus,.btn-orange.dropdown-toggle:hover{background-color:#ff8910!important}.btn-orange:not([disabled]):not(.disabled).active,.btn-orange:not([disabled]):not(.disabled):active,.show>.btn-orange.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#8f4800!important}.btn-orange:not([disabled]):not(.disabled).active:focus,.btn-orange:not([disabled]):not(.disabled):active:focus,.show>.btn-orange.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.orange-ic{color:#f57c00!important}.orange-ic:focus,.orange-ic:hover{color:#f57c00}table.table a.btn.btn-orange{color:#fff}.btn-outline-orange{border:2px solid #f57c00!important;background-color:transparent!important;color:#f57c00!important}.btn-outline-orange.active,.btn-outline-orange:active,.btn-outline-orange:active:focus,.btn-outline-orange:focus,.btn-outline-orange:hover{border-color:#f57c00!important;background-color:transparent!important;color:#f57c00!important}.btn-outline-orange:not([disabled]):not(.disabled).active,.btn-outline-orange:not([disabled]):not(.disabled):active,.show>.btn-outline-orange.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#f57c00!important}.btn-outline-orange:not([disabled]):not(.disabled).active:focus,.btn-outline-orange:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-orange.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-deep-orange{background-color:#ff7043!important;color:#fff}.btn-deep-orange:hover{background-color:#ff835d;color:#fff}.btn-deep-orange.focus,.btn-deep-orange:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-deep-orange.active,.btn-deep-orange:active,.btn-deep-orange:focus{background-color:#dc3500}.btn-deep-orange.dropdown-toggle{background-color:#ff7043!important}.btn-deep-orange.dropdown-toggle:focus,.btn-deep-orange.dropdown-toggle:hover{background-color:#ff835d!important}.btn-deep-orange:not([disabled]):not(.disabled).active,.btn-deep-orange:not([disabled]):not(.disabled):active,.show>.btn-deep-orange.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#dc3500!important}.btn-deep-orange:not([disabled]):not(.disabled).active:focus,.btn-deep-orange:not([disabled]):not(.disabled):active:focus,.show>.btn-deep-orange.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.deep-orange-ic{color:#ff7043!important}.deep-orange-ic:focus,.deep-orange-ic:hover{color:#ff7043}table.table a.btn.btn-deep-orange{color:#fff}.btn-outline-deep-orange{border:2px solid #ff7043!important;background-color:transparent!important;color:#ff7043!important}.btn-outline-deep-orange.active,.btn-outline-deep-orange:active,.btn-outline-deep-orange:active:focus,.btn-outline-deep-orange:focus,.btn-outline-deep-orange:hover{border-color:#ff7043!important;background-color:transparent!important;color:#ff7043!important}.btn-outline-deep-orange:not([disabled]):not(.disabled).active,.btn-outline-deep-orange:not([disabled]):not(.disabled):active,.show>.btn-outline-deep-orange.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#ff7043!important}.btn-outline-deep-orange:not([disabled]):not(.disabled).active:focus,.btn-outline-deep-orange:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-deep-orange.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-brown{background-color:#795548!important;color:#fff}.btn-brown:hover{background-color:#896052;color:#fff}.btn-brown.focus,.btn-brown:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-brown.active,.btn-brown:active,.btn-brown:focus{background-color:#392822}.btn-brown.dropdown-toggle{background-color:#795548!important}.btn-brown.dropdown-toggle:focus,.btn-brown.dropdown-toggle:hover{background-color:#896052!important}.btn-brown:not([disabled]):not(.disabled).active,.btn-brown:not([disabled]):not(.disabled):active,.show>.btn-brown.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#392822!important}.btn-brown:not([disabled]):not(.disabled).active:focus,.btn-brown:not([disabled]):not(.disabled):active:focus,.show>.btn-brown.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.brown-ic{color:#795548!important}.brown-ic:focus,.brown-ic:hover{color:#795548}table.table a.btn.btn-brown{color:#fff}.btn-outline-brown{border:2px solid #795548!important;background-color:transparent!important;color:#795548!important}.btn-outline-brown.active,.btn-outline-brown:active,.btn-outline-brown:active:focus,.btn-outline-brown:focus,.btn-outline-brown:hover{border-color:#795548!important;background-color:transparent!important;color:#795548!important}.btn-outline-brown:not([disabled]):not(.disabled).active,.btn-outline-brown:not([disabled]):not(.disabled):active,.show>.btn-outline-brown.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#795548!important}.btn-outline-brown:not([disabled]):not(.disabled).active:focus,.btn-outline-brown:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-brown.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-grey{background-color:#616161!important;color:#fff}.btn-grey:hover{background-color:#6e6e6e;color:#fff}.btn-grey.focus,.btn-grey:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-grey.active,.btn-grey:active,.btn-grey:focus{background-color:#2e2e2e}.btn-grey.dropdown-toggle{background-color:#616161!important}.btn-grey.dropdown-toggle:focus,.btn-grey.dropdown-toggle:hover{background-color:#6e6e6e!important}.btn-grey:not([disabled]):not(.disabled).active,.btn-grey:not([disabled]):not(.disabled):active,.show>.btn-grey.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#2e2e2e!important}.btn-grey:not([disabled]):not(.disabled).active:focus,.btn-grey:not([disabled]):not(.disabled):active:focus,.show>.btn-grey.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.grey-ic{color:#616161!important}.grey-ic:focus,.grey-ic:hover{color:#616161}table.table a.btn.btn-grey{color:#fff}.btn-outline-grey{border:2px solid #616161!important;background-color:transparent!important;color:#616161!important}.btn-outline-grey.active,.btn-outline-grey:active,.btn-outline-grey:active:focus,.btn-outline-grey:focus,.btn-outline-grey:hover{border-color:#616161!important;background-color:transparent!important;color:#616161!important}.btn-outline-grey:not([disabled]):not(.disabled).active,.btn-outline-grey:not([disabled]):not(.disabled):active,.show>.btn-outline-grey.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#616161!important}.btn-outline-grey:not([disabled]):not(.disabled).active:focus,.btn-outline-grey:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-grey.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-blue-grey{background-color:#78909c!important;color:#fff}.btn-blue-grey:hover{background-color:#879ca7;color:#fff}.btn-blue-grey.focus,.btn-blue-grey:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-blue-grey.active,.btn-blue-grey:active,.btn-blue-grey:focus{background-color:#4a5b64}.btn-blue-grey.dropdown-toggle{background-color:#78909c!important}.btn-blue-grey.dropdown-toggle:focus,.btn-blue-grey.dropdown-toggle:hover{background-color:#879ca7!important}.btn-blue-grey:not([disabled]):not(.disabled).active,.btn-blue-grey:not([disabled]):not(.disabled):active,.show>.btn-blue-grey.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#4a5b64!important}.btn-blue-grey:not([disabled]):not(.disabled).active:focus,.btn-blue-grey:not([disabled]):not(.disabled):active:focus,.show>.btn-blue-grey.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.blue-grey-ic{color:#78909c!important}.blue-grey-ic:focus,.blue-grey-ic:hover{color:#78909c}table.table a.btn.btn-blue-grey{color:#fff}.btn-outline-blue-grey{border:2px solid #78909c!important;background-color:transparent!important;color:#78909c!important}.btn-outline-blue-grey.active,.btn-outline-blue-grey:active,.btn-outline-blue-grey:active:focus,.btn-outline-blue-grey:focus,.btn-outline-blue-grey:hover{border-color:#78909c!important;background-color:transparent!important;color:#78909c!important}.btn-outline-blue-grey:not([disabled]):not(.disabled).active,.btn-outline-blue-grey:not([disabled]):not(.disabled):active,.show>.btn-outline-blue-grey.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#78909c!important}.btn-outline-blue-grey:not([disabled]):not(.disabled).active:focus,.btn-outline-blue-grey:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-blue-grey.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-dark{background-color:#212121!important;color:#fff}.btn-dark:hover{background-color:#2e2e2e;color:#fff}.btn-dark.focus,.btn-dark:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-dark.active,.btn-dark:active,.btn-dark:focus{background-color:#000}.btn-dark.dropdown-toggle{background-color:#212121!important}.btn-dark.dropdown-toggle:focus,.btn-dark.dropdown-toggle:hover{background-color:#2e2e2e!important}.btn-dark:not([disabled]):not(.disabled).active,.btn-dark:not([disabled]):not(.disabled):active,.show>.btn-dark.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#000!important}.btn-dark:not([disabled]):not(.disabled).active:focus,.btn-dark:not([disabled]):not(.disabled):active:focus,.show>.btn-dark.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.dark-ic{color:#212121!important}.dark-ic:focus,.dark-ic:hover{color:#212121}table.table a.btn.btn-dark{color:#fff}.btn-outline-dark{border:2px solid #212121!important;background-color:transparent!important;color:#212121!important}.btn-outline-dark.active,.btn-outline-dark:active,.btn-outline-dark:active:focus,.btn-outline-dark:focus,.btn-outline-dark:hover{border-color:#212121!important;background-color:transparent!important;color:#212121!important}.btn-outline-dark:not([disabled]):not(.disabled).active,.btn-outline-dark:not([disabled]):not(.disabled):active,.show>.btn-outline-dark.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#212121!important}.btn-outline-dark:not([disabled]):not(.disabled).active:focus,.btn-outline-dark:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-dark.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light{background-color:#e0e0e0!important;color:#000}.btn-light:hover{background-color:#ededed;color:#000}.btn-light.focus,.btn-light:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-light.active,.btn-light:active,.btn-light:focus{background-color:#adadad}.btn-light.dropdown-toggle{background-color:#e0e0e0!important}.btn-light.dropdown-toggle:focus,.btn-light.dropdown-toggle:hover{background-color:#ededed!important}.btn-light:not([disabled]):not(.disabled).active,.btn-light:not([disabled]):not(.disabled):active,.show>.btn-light.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#adadad!important}.btn-light:not([disabled]):not(.disabled).active:focus,.btn-light:not([disabled]):not(.disabled):active:focus,.show>.btn-light.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.light-ic{color:#e0e0e0!important}.light-ic:focus,.light-ic:hover{color:#e0e0e0}table.table a.btn.btn-light{color:#000}.btn-outline-light{border:2px solid #e0e0e0!important;background-color:transparent!important;color:#e0e0e0!important}.btn-outline-light.active,.btn-outline-light:active,.btn-outline-light:active:focus,.btn-outline-light:focus,.btn-outline-light:hover{border-color:#e0e0e0!important;background-color:transparent!important;color:#e0e0e0!important}.btn-outline-light:not([disabled]):not(.disabled).active,.btn-outline-light:not([disabled]):not(.disabled):active,.show>.btn-outline-light.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#e0e0e0!important}.btn-outline-light:not([disabled]):not(.disabled).active:focus,.btn-outline-light:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-light.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-white{background-color:#fff!important;color:#000}.btn-white:hover{background-color:#fff;color:#000}.btn-white.focus,.btn-white:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-white.active,.btn-white:active,.btn-white:focus{background-color:#ccc}.btn-white.dropdown-toggle,.btn-white.dropdown-toggle:focus,.btn-white.dropdown-toggle:hover{background-color:#fff!important}.btn-white:not([disabled]):not(.disabled).active,.btn-white:not([disabled]):not(.disabled):active,.show>.btn-white.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#ccc!important}.btn-white:not([disabled]):not(.disabled).active:focus,.btn-white:not([disabled]):not(.disabled):active:focus,.show>.btn-white.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.white-ic{color:#fff!important}.white-ic:focus,.white-ic:hover{color:#fff}a.btn:not([href]):not([tabindex]),a.btn:not([href]):not([tabindex]):focus,a.btn:not([href]):not([tabindex]):hover,table.table a.btn.btn-white{color:#000}.btn-outline-white{border:2px solid #fff!important;background-color:transparent!important;color:#fff!important}.btn-outline-white.active,.btn-outline-white:active,.btn-outline-white:active:focus,.btn-outline-white:focus,.btn-outline-white:hover{border-color:#fff!important;background-color:transparent!important;color:#fff!important}.btn-outline-white:not([disabled]):not(.disabled).active,.btn-outline-white:not([disabled]):not(.disabled):active,.show>.btn-outline-white.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#fff!important}.btn-outline-white:not([disabled]):not(.disabled).active:focus,.btn-outline-white:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-white.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-black{background-color:#000!important;color:#fff}.btn-black:hover{background-color:#0d0d0d;color:#fff}.btn-black.focus,.btn-black:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-black.active,.btn-black:active,.btn-black:focus{background-color:#000}.btn-black.dropdown-toggle{background-color:#000!important}.btn-black.dropdown-toggle:focus,.btn-black.dropdown-toggle:hover{background-color:#0d0d0d!important}.btn-black:not([disabled]):not(.disabled).active,.btn-black:not([disabled]):not(.disabled):active,.show>.btn-black.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:#000!important}.btn-black:not([disabled]):not(.disabled).active:focus,.btn-black:not([disabled]):not(.disabled):active:focus,.show>.btn-black.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.black-ic{color:#000!important}.black-ic:focus,.black-ic:hover{color:#000}a.btn:not([href]):not([tabindex]),a.btn:not([href]):not([tabindex]):focus,a.btn:not([href]):not([tabindex]):hover,table.table a.btn.btn-black{color:#fff}.btn-outline-black{border:2px solid #000!important;background-color:transparent!important;color:#000!important}.btn-outline-black.active,.btn-outline-black:active,.btn-outline-black:active:focus,.btn-outline-black:focus,.btn-outline-black:hover{border-color:#000!important;background-color:transparent!important;color:#000!important}.btn-outline-black:not([disabled]):not(.disabled).active,.btn-outline-black:not([disabled]):not(.disabled):active,.show>.btn-outline-black.dropdown-toggle{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);background-color:transparent!important;border-color:#000!important}.btn-outline-black:not([disabled]):not(.disabled).active:focus,.btn-outline-black:not([disabled]):not(.disabled):active:focus,.show>.btn-outline-black.dropdown-toggle:focus{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}.btn-warning:not(:disabled):not(.disabled).active,.btn-warning:not(:disabled):not(.disabled):active,.show>.btn-warning.dropdown-toggle{color:#fff}.btn.purple-gradient{transition:.5s;color:#fff}.btn.purple-gradient:active,.btn.purple-gradient:active:focus .btn.purple-gradient.active,.btn.purple-gradient:focus,.btn.purple-gradient:hover{background:linear-gradient(#ff88ce,#8f8bf7)}.btn.peach-gradient{transition:.5s;color:#fff}.btn.peach-gradient:active,.btn.peach-gradient:active:focus .btn.peach-gradient.active,.btn.peach-gradient:focus,.btn.peach-gradient:hover{background:linear-gradient(#ffdf89,#fc7b7b)}.btn.aqua-gradient{transition:.5s;color:#fff}.btn.aqua-gradient:active,.btn.aqua-gradient:active:focus .btn.aqua-gradient.active,.btn.aqua-gradient:focus,.btn.aqua-gradient:hover{background:linear-gradient(#3aa2ff,#1fffac)}.btn.blue-gradient{transition:.5s;color:#fff}.btn.blue-gradient:active,.btn.blue-gradient:active:focus .btn.blue-gradient.active,.btn.blue-gradient:focus,.btn.blue-gradient:hover{background:linear-gradient(#5ed1fc,#3647b3)}.btn mdb-icon{position:relative;font-size:.9rem}.btn mdb-icon.right{margin-left:.3rem}.btn mdb-icon.left{margin-right:.3rem}.btn.btn-lg{padding:1rem 2.4rem;font-size:.94rem}.btn.btn-lg mdb-icon{font-size:1rem}.btn.btn-md{padding:.7rem 1.6rem;font-size:.7rem}.btn.btn-md mdb-icon{font-size:.8rem}.btn.btn-sm{padding:.5rem 1.6rem;font-size:.64rem}.btn.btn-sm mdb-icon{font-size:.7rem}"],data:{}});function Vp(e){return la(0,[ea(null,0)],null,null)}var Gp=ti({encapsulation:2,styles:[".mdb-color.lighten-5{background-color:#d0d6e2!important}.mdb-color.lighten-4{background-color:#b1bace!important}.mdb-color.lighten-3{background-color:#929fba!important}.mdb-color.lighten-2{background-color:#7283a7!important}.mdb-color.lighten-1{background-color:#59698d!important}.mdb-color{background-color:#45526e!important}.mdb-color-text{color:#45526e!important}.rgba-mdb-color-slight,.rgba-mdb-color-slight:after{background-color:rgba(69,82,110,.1)}.rgba-mdb-color-light,.rgba-mdb-color-light:after{background-color:rgba(69,82,110,.3)}.rgba-mdb-color-strong,.rgba-mdb-color-strong:after{background-color:rgba(69,82,110,.7)}.mdb-color.darken-1{background-color:#3b465e!important}.mdb-color.darken-2{background-color:#2e3951!important}.mdb-color.darken-3{background-color:#1c2a48!important}.mdb-color.darken-4{background-color:#1c2331!important}.red.lighten-5{background-color:#ffebee!important}.red.lighten-4{background-color:#ffcdd2!important}.red.lighten-3{background-color:#ef9a9a!important}.red.lighten-2{background-color:#e57373!important}.red.lighten-1{background-color:#ef5350!important}.red{background-color:#f44336!important}.red-text{color:#f44336!important}.rgba-red-slight,.rgba-red-slight:after{background-color:rgba(244,67,54,.1)}.rgba-red-light,.rgba-red-light:after{background-color:rgba(244,67,54,.3)}.rgba-red-strong,.rgba-red-strong:after{background-color:rgba(244,67,54,.7)}.red.darken-1{background-color:#e53935!important}.red.darken-2{background-color:#d32f2f!important}.red.darken-3{background-color:#c62828!important}.red.darken-4{background-color:#b71c1c!important}.red.accent-1{background-color:#ff8a80!important}.red.accent-2{background-color:#ff5252!important}.red.accent-3{background-color:#ff1744!important}.red.accent-4{background-color:#d50000!important}.pink.lighten-5{background-color:#fce4ec!important}.pink.lighten-4{background-color:#f8bbd0!important}.pink.lighten-3{background-color:#f48fb1!important}.pink.lighten-2{background-color:#f06292!important}.pink.lighten-1{background-color:#ec407a!important}.pink{background-color:#e91e63!important}.pink-text{color:#e91e63!important}.rgba-pink-slight,.rgba-pink-slight:after{background-color:rgba(233,30,99,.1)}.rgba-pink-light,.rgba-pink-light:after{background-color:rgba(233,30,99,.3)}.rgba-pink-strong,.rgba-pink-strong:after{background-color:rgba(233,30,99,.7)}.pink.darken-1{background-color:#d81b60!important}.pink.darken-2{background-color:#c2185b!important}.pink.darken-3{background-color:#ad1457!important}.pink.darken-4{background-color:#880e4f!important}.pink.accent-1{background-color:#ff80ab!important}.pink.accent-2{background-color:#ff4081!important}.pink.accent-3{background-color:#f50057!important}.pink.accent-4{background-color:#c51162!important}.purple.lighten-5{background-color:#f3e5f5!important}.purple.lighten-4{background-color:#e1bee7!important}.purple.lighten-3{background-color:#ce93d8!important}.purple.lighten-2{background-color:#ba68c8!important}.purple.lighten-1{background-color:#ab47bc!important}.purple{background-color:#9c27b0!important}.purple-text{color:#9c27b0!important}.rgba-purple-slight,.rgba-purple-slight:after{background-color:rgba(156,39,176,.1)}.rgba-purple-light,.rgba-purple-light:after{background-color:rgba(156,39,176,.3)}.rgba-purple-strong,.rgba-purple-strong:after{background-color:rgba(156,39,176,.7)}.purple.darken-1{background-color:#8e24aa!important}.purple.darken-2{background-color:#7b1fa2!important}.purple.darken-3{background-color:#6a1b9a!important}.purple.darken-4{background-color:#4a148c!important}.purple.accent-1{background-color:#ea80fc!important}.purple.accent-2{background-color:#e040fb!important}.purple.accent-3{background-color:#d500f9!important}.purple.accent-4{background-color:#a0f!important}.deep-purple.lighten-5{background-color:#ede7f6!important}.deep-purple.lighten-4{background-color:#d1c4e9!important}.deep-purple.lighten-3{background-color:#b39ddb!important}.deep-purple.lighten-2{background-color:#9575cd!important}.deep-purple.lighten-1{background-color:#7e57c2!important}.deep-purple{background-color:#673ab7!important}.deep-purple-text{color:#673ab7!important}.rgba-deep-purple-slight,.rgba-deep-purple-slight:after{background-color:rgba(103,58,183,.1)}.rgba-deep-purple-light,.rgba-deep-purple-light:after{background-color:rgba(103,58,183,.3)}.rgba-deep-purple-strong,.rgba-deep-purple-strong:after{background-color:rgba(103,58,183,.7)}.deep-purple.darken-1{background-color:#5e35b1!important}.deep-purple.darken-2{background-color:#512da8!important}.deep-purple.darken-3{background-color:#4527a0!important}.deep-purple.darken-4{background-color:#311b92!important}.deep-purple.accent-1{background-color:#b388ff!important}.deep-purple.accent-2{background-color:#7c4dff!important}.deep-purple.accent-3{background-color:#651fff!important}.deep-purple.accent-4{background-color:#6200ea!important}.indigo.lighten-5{background-color:#e8eaf6!important}.indigo.lighten-4{background-color:#c5cae9!important}.indigo.lighten-3{background-color:#9fa8da!important}.indigo.lighten-2{background-color:#7986cb!important}.indigo.lighten-1{background-color:#5c6bc0!important}.indigo{background-color:#3f51b5!important}.indigo-text{color:#3f51b5!important}.rgba-indigo-slight,.rgba-indigo-slight:after{background-color:rgba(63,81,181,.1)}.rgba-indigo-light,.rgba-indigo-light:after{background-color:rgba(63,81,181,.3)}.rgba-indigo-strong,.rgba-indigo-strong:after{background-color:rgba(63,81,181,.7)}.indigo.darken-1{background-color:#3949ab!important}.indigo.darken-2{background-color:#303f9f!important}.indigo.darken-3{background-color:#283593!important}.indigo.darken-4{background-color:#1a237e!important}.indigo.accent-1{background-color:#8c9eff!important}.indigo.accent-2{background-color:#536dfe!important}.indigo.accent-3{background-color:#3d5afe!important}.indigo.accent-4{background-color:#304ffe!important}.blue.lighten-5{background-color:#e3f2fd!important}.blue.lighten-4{background-color:#bbdefb!important}.blue.lighten-3{background-color:#90caf9!important}.blue.lighten-2{background-color:#64b5f6!important}.blue.lighten-1{background-color:#42a5f5!important}.blue{background-color:#2196f3!important}.blue-text{color:#2196f3!important}.rgba-blue-slight,.rgba-blue-slight:after{background-color:rgba(33,150,243,.1)}.rgba-blue-light,.rgba-blue-light:after{background-color:rgba(33,150,243,.3)}.rgba-blue-strong,.rgba-blue-strong:after{background-color:rgba(33,150,243,.7)}.blue.darken-1{background-color:#1e88e5!important}.blue.darken-2{background-color:#1976d2!important}.blue.darken-3{background-color:#1565c0!important}.blue.darken-4{background-color:#0d47a1!important}.blue.accent-1{background-color:#82b1ff!important}.blue.accent-2{background-color:#448aff!important}.blue.accent-3{background-color:#2979ff!important}.blue.accent-4{background-color:#2962ff!important}.light-blue.lighten-5{background-color:#e1f5fe!important}.light-blue.lighten-4{background-color:#b3e5fc!important}.light-blue.lighten-3{background-color:#81d4fa!important}.light-blue.lighten-2{background-color:#4fc3f7!important}.light-blue.lighten-1{background-color:#29b6f6!important}.light-blue{background-color:#03a9f4!important}.light-blue-text{color:#03a9f4!important}.rgba-light-blue-slight,.rgba-light-blue-slight:after{background-color:rgba(3,169,244,.1)}.rgba-light-blue-light,.rgba-light-blue-light:after{background-color:rgba(3,169,244,.3)}.rgba-light-blue-strong,.rgba-light-blue-strong:after{background-color:rgba(3,169,244,.7)}.light-blue.darken-1{background-color:#039be5!important}.light-blue.darken-2{background-color:#0288d1!important}.light-blue.darken-3{background-color:#0277bd!important}.light-blue.darken-4{background-color:#01579b!important}.light-blue.accent-1{background-color:#80d8ff!important}.light-blue.accent-2{background-color:#40c4ff!important}.light-blue.accent-3{background-color:#00b0ff!important}.light-blue.accent-4{background-color:#0091ea!important}.cyan.lighten-5{background-color:#e0f7fa!important}.cyan.lighten-4{background-color:#b2ebf2!important}.cyan.lighten-3{background-color:#80deea!important}.cyan.lighten-2{background-color:#4dd0e1!important}.cyan.lighten-1{background-color:#26c6da!important}.cyan{background-color:#00bcd4!important}.cyan-text{color:#00bcd4!important}.rgba-cyan-slight,.rgba-cyan-slight:after{background-color:rgba(0,188,212,.1)}.rgba-cyan-light,.rgba-cyan-light:after{background-color:rgba(0,188,212,.3)}.rgba-cyan-strong,.rgba-cyan-strong:after{background-color:rgba(0,188,212,.7)}.cyan.darken-1{background-color:#00acc1!important}.cyan.darken-2{background-color:#0097a7!important}.cyan.darken-3{background-color:#00838f!important}.cyan.darken-4{background-color:#006064!important}.cyan.accent-1{background-color:#84ffff!important}.cyan.accent-2{background-color:#18ffff!important}.cyan.accent-3{background-color:#00e5ff!important}.cyan.accent-4{background-color:#00b8d4!important}.teal.lighten-5{background-color:#e0f2f1!important}.teal.lighten-4{background-color:#b2dfdb!important}.teal.lighten-3{background-color:#80cbc4!important}.teal.lighten-2{background-color:#4db6ac!important}.teal.lighten-1{background-color:#26a69a!important}.teal{background-color:#009688!important}.teal-text{color:#009688!important}.rgba-teal-slight,.rgba-teal-slight:after{background-color:rgba(0,150,136,.1)}.rgba-teal-light,.rgba-teal-light:after{background-color:rgba(0,150,136,.3)}.rgba-teal-strong,.rgba-teal-strong:after{background-color:rgba(0,150,136,.7)}.teal.darken-1{background-color:#00897b!important}.teal.darken-2{background-color:#00796b!important}.teal.darken-3{background-color:#00695c!important}.teal.darken-4{background-color:#004d40!important}.teal.accent-1{background-color:#a7ffeb!important}.teal.accent-2{background-color:#64ffda!important}.teal.accent-3{background-color:#1de9b6!important}.teal.accent-4{background-color:#00bfa5!important}.green.lighten-5{background-color:#e8f5e9!important}.green.lighten-4{background-color:#c8e6c9!important}.green.lighten-3{background-color:#a5d6a7!important}.green.lighten-2{background-color:#81c784!important}.green.lighten-1{background-color:#66bb6a!important}.green{background-color:#4caf50!important}.green-text{color:#4caf50!important}.rgba-green-slight,.rgba-green-slight:after{background-color:rgba(76,175,80,.1)}.rgba-green-light,.rgba-green-light:after{background-color:rgba(76,175,80,.3)}.rgba-green-strong,.rgba-green-strong:after{background-color:rgba(76,175,80,.7)}.green.darken-1{background-color:#43a047!important}.green.darken-2{background-color:#388e3c!important}.green.darken-3{background-color:#2e7d32!important}.green.darken-4{background-color:#1b5e20!important}.green.accent-1{background-color:#b9f6ca!important}.green.accent-2{background-color:#69f0ae!important}.green.accent-3{background-color:#00e676!important}.green.accent-4{background-color:#00c853!important}.light-green.lighten-5{background-color:#f1f8e9!important}.light-green.lighten-4{background-color:#dcedc8!important}.light-green.lighten-3{background-color:#c5e1a5!important}.light-green.lighten-2{background-color:#aed581!important}.light-green.lighten-1{background-color:#9ccc65!important}.light-green{background-color:#8bc34a!important}.light-green-text{color:#8bc34a!important}.rgba-light-green-slight,.rgba-light-green-slight:after{background-color:rgba(139,195,74,.1)}.rgba-light-green-light,.rgba-light-green-light:after{background-color:rgba(139,195,74,.3)}.rgba-light-green-strong,.rgba-light-green-strong:after{background-color:rgba(139,195,74,.7)}.light-green.darken-1{background-color:#7cb342!important}.light-green.darken-2{background-color:#689f38!important}.light-green.darken-3{background-color:#558b2f!important}.light-green.darken-4{background-color:#33691e!important}.light-green.accent-1{background-color:#ccff90!important}.light-green.accent-2{background-color:#b2ff59!important}.light-green.accent-3{background-color:#76ff03!important}.light-green.accent-4{background-color:#64dd17!important}.lime.lighten-5{background-color:#f9fbe7!important}.lime.lighten-4{background-color:#f0f4c3!important}.lime.lighten-3{background-color:#e6ee9c!important}.lime.lighten-2{background-color:#dce775!important}.lime.lighten-1{background-color:#d4e157!important}.lime{background-color:#cddc39!important}.lime-text{color:#cddc39!important}.rgba-lime-slight,.rgba-lime-slight:after{background-color:rgba(205,220,57,.1)}.rgba-lime-light,.rgba-lime-light:after{background-color:rgba(205,220,57,.3)}.rgba-lime-strong,.rgba-lime-strong:after{background-color:rgba(205,220,57,.7)}.lime.darken-1{background-color:#c0ca33!important}.lime.darken-2{background-color:#afb42b!important}.lime.darken-3{background-color:#9e9d24!important}.lime.darken-4{background-color:#827717!important}.lime.accent-1{background-color:#f4ff81!important}.lime.accent-2{background-color:#eeff41!important}.lime.accent-3{background-color:#c6ff00!important}.lime.accent-4{background-color:#aeea00!important}.yellow.lighten-5{background-color:#fffde7!important}.yellow.lighten-4{background-color:#fff9c4!important}.yellow.lighten-3{background-color:#fff59d!important}.yellow.lighten-2{background-color:#fff176!important}.yellow.lighten-1{background-color:#ffee58!important}.yellow{background-color:#ffeb3b!important}.yellow-text{color:#ffeb3b!important}.rgba-yellow-slight,.rgba-yellow-slight:after{background-color:rgba(255,235,59,.1)}.rgba-yellow-light,.rgba-yellow-light:after{background-color:rgba(255,235,59,.3)}.rgba-yellow-strong,.rgba-yellow-strong:after{background-color:rgba(255,235,59,.7)}.yellow.darken-1{background-color:#fdd835!important}.yellow.darken-2{background-color:#fbc02d!important}.yellow.darken-3{background-color:#f9a825!important}.yellow.darken-4{background-color:#f57f17!important}.yellow.accent-1{background-color:#ffff8d!important}.yellow.accent-2{background-color:#ff0!important}.yellow.accent-3{background-color:#ffea00!important}.yellow.accent-4{background-color:#ffd600!important}.amber.lighten-5{background-color:#fff8e1!important}.amber.lighten-4{background-color:#ffecb3!important}.amber.lighten-3{background-color:#ffe082!important}.amber.lighten-2{background-color:#ffd54f!important}.amber.lighten-1{background-color:#ffca28!important}.amber{background-color:#ffc107!important}.amber-text{color:#ffc107!important}.rgba-amber-slight,.rgba-amber-slight:after{background-color:rgba(255,193,7,.1)}.rgba-amber-light,.rgba-amber-light:after{background-color:rgba(255,193,7,.3)}.rgba-amber-strong,.rgba-amber-strong:after{background-color:rgba(255,193,7,.7)}.amber.darken-1{background-color:#ffb300!important}.amber.darken-2{background-color:#ffa000!important}.amber.darken-3{background-color:#ff8f00!important}.amber.darken-4{background-color:#ff6f00!important}.amber.accent-1{background-color:#ffe57f!important}.amber.accent-2{background-color:#ffd740!important}.amber.accent-3{background-color:#ffc400!important}.amber.accent-4{background-color:#ffab00!important}.orange.lighten-5{background-color:#fff3e0!important}.orange.lighten-4{background-color:#ffe0b2!important}.orange.lighten-3{background-color:#ffcc80!important}.orange.lighten-2{background-color:#ffb74d!important}.orange.lighten-1{background-color:#ffa726!important}.orange{background-color:#ff9800!important}.orange-text{color:#ff9800!important}.rgba-orange-slight,.rgba-orange-slight:after{background-color:rgba(255,152,0,.1)}.rgba-orange-light,.rgba-orange-light:after{background-color:rgba(255,152,0,.3)}.rgba-orange-strong,.rgba-orange-strong:after{background-color:rgba(255,152,0,.7)}.orange.darken-1{background-color:#fb8c00!important}.orange.darken-2{background-color:#f57c00!important}.orange.darken-3{background-color:#ef6c00!important}.orange.darken-4{background-color:#e65100!important}.orange.accent-1{background-color:#ffd180!important}.orange.accent-2{background-color:#ffab40!important}.orange.accent-3{background-color:#ff9100!important}.orange.accent-4{background-color:#ff6d00!important}.deep-orange.lighten-5{background-color:#fbe9e7!important}.deep-orange.lighten-4{background-color:#ffccbc!important}.deep-orange.lighten-3{background-color:#ffab91!important}.deep-orange.lighten-2{background-color:#ff8a65!important}.deep-orange.lighten-1{background-color:#ff7043!important}.deep-orange{background-color:#ff5722!important}.deep-orange-text{color:#ff5722!important}.rgba-deep-orange-slight,.rgba-deep-orange-slight:after{background-color:rgba(255,87,34,.1)}.rgba-deep-orange-light,.rgba-deep-orange-light:after{background-color:rgba(255,87,34,.3)}.rgba-deep-orange-strong,.rgba-deep-orange-strong:after{background-color:rgba(255,87,34,.7)}.deep-orange.darken-1{background-color:#f4511e!important}.deep-orange.darken-2{background-color:#e64a19!important}.deep-orange.darken-3{background-color:#d84315!important}.deep-orange.darken-4{background-color:#bf360c!important}.deep-orange.accent-1{background-color:#ff9e80!important}.deep-orange.accent-2{background-color:#ff6e40!important}.deep-orange.accent-3{background-color:#ff3d00!important}.deep-orange.accent-4{background-color:#dd2c00!important}.brown.lighten-5{background-color:#efebe9!important}.brown.lighten-4{background-color:#d7ccc8!important}.brown.lighten-3{background-color:#bcaaa4!important}.brown.lighten-2{background-color:#a1887f!important}.brown.lighten-1{background-color:#8d6e63!important}.brown{background-color:#795548!important}.brown-text{color:#795548!important}.rgba-brown-slight,.rgba-brown-slight:after{background-color:rgba(121,85,72,.1)}.rgba-brown-light,.rgba-brown-light:after{background-color:rgba(121,85,72,.3)}.rgba-brown-strong,.rgba-brown-strong:after{background-color:rgba(121,85,72,.7)}.brown.darken-1{background-color:#6d4c41!important}.brown.darken-2{background-color:#5d4037!important}.brown.darken-3{background-color:#4e342e!important}.brown.darken-4{background-color:#3e2723!important}.blue-grey.lighten-5{background-color:#eceff1!important}.blue-grey.lighten-4{background-color:#cfd8dc!important}.blue-grey.lighten-3{background-color:#b0bec5!important}.blue-grey.lighten-2{background-color:#90a4ae!important}.blue-grey.lighten-1{background-color:#78909c!important}.blue-grey{background-color:#607d8b!important}.blue-grey-text{color:#607d8b!important}.rgba-blue-grey-slight,.rgba-blue-grey-slight:after{background-color:rgba(96,125,139,.1)}.rgba-blue-grey-light,.rgba-blue-grey-light:after{background-color:rgba(96,125,139,.3)}.rgba-blue-grey-strong,.rgba-blue-grey-strong:after{background-color:rgba(96,125,139,.7)}.blue-grey.darken-1{background-color:#546e7a!important}.blue-grey.darken-2{background-color:#455a64!important}.blue-grey.darken-3{background-color:#37474f!important}.blue-grey.darken-4{background-color:#263238!important}.grey.lighten-5{background-color:#fafafa!important}.grey.lighten-4{background-color:#f5f5f5!important}.grey.lighten-3{background-color:#eee!important}.grey.lighten-2{background-color:#e0e0e0!important}.grey.lighten-1{background-color:#bdbdbd!important}.grey{background-color:#9e9e9e!important}.grey-text{color:#9e9e9e!important}.rgba-grey-slight,.rgba-grey-slight:after{background-color:rgba(158,158,158,.1)}.rgba-grey-light,.rgba-grey-light:after{background-color:rgba(158,158,158,.3)}.rgba-grey-strong,.rgba-grey-strong:after{background-color:rgba(158,158,158,.7)}.grey.darken-1{background-color:#757575!important}.grey.darken-2{background-color:#616161!important}.grey.darken-3{background-color:#424242!important}.grey.darken-4{background-color:#212121!important}.black{background-color:#000!important}.black-text{color:#000!important}.rgba-black-slight,.rgba-black-slight:after{background-color:rgba(0,0,0,.1)}.rgba-black-light,.rgba-black-light:after{background-color:rgba(0,0,0,.3)}.rgba-black-strong,.rgba-black-strong:after{background-color:rgba(0,0,0,.7)}.white{background-color:#fff!important}.white-text{color:#fff!important}.rgba-white-slight,.rgba-white-slight:after{background-color:rgba(255,255,255,.1)}.rgba-white-light,.rgba-white-light:after{background-color:rgba(255,255,255,.3)}.rgba-white-strong,.rgba-white-strong:after{background-color:rgba(255,255,255,.7)}.rgba-stylish-slight{background-color:rgba(62,69,81,.1)}.rgba-stylish-light{background-color:rgba(62,69,81,.3)}.rgba-stylish-strong{background-color:rgba(62,69,81,.7)}.primary-color{background-color:#4285f4!important}.primary-color-dark{background-color:#0d47a1!important}.secondary-color{background-color:#a6c!important}.secondary-color-dark{background-color:#93c!important}.default-color{background-color:#2bbbad!important}.default-color-dark{background-color:#00695c!important}.info-color{background-color:#33b5e5!important}.info-color-dark{background-color:#09c!important}.success-color{background-color:#00c851!important}.success-color-dark{background-color:#007e33!important}.warning-color{background-color:#fb3!important}.warning-color-dark{background-color:#f80!important}.danger-color{background-color:#ff3547!important}.danger-color-dark{background-color:#c00!important}.elegant-color{background-color:#2e2e2e!important}.elegant-color-dark{background-color:#212121!important}.stylish-color{background-color:#4b515d!important}.stylish-color-dark{background-color:#3e4551!important}.unique-color{background-color:#3f729b!important}.unique-color-dark{background-color:#1c2331!important}.special-color{background-color:#37474f!important}.special-color-dark{background-color:#263238!important}.purple-gradient{background:linear-gradient(40deg,#ff6ec4,#7873f5)!important}.peach-gradient{background:linear-gradient(40deg,#ffd86f,#fc6262)!important}.aqua-gradient{background:linear-gradient(40deg,#2096ff,#05ffa3)!important}.blue-gradient{background:linear-gradient(40deg,#45cafc,#303f9f)!important}.purple-gradient-rgba{background:linear-gradient(40deg,rgba(255,110,196,.9),rgba(120,115,245,.9))!important}.peach-gradient-rgba{background:linear-gradient(40deg,rgba(255,216,111,.9),rgba(252,98,98,.9))!important}.aqua-gradient-rgba{background:linear-gradient(40deg,rgba(32,150,255,.9),rgba(5,255,163,.9))!important}.blue-gradient-rgba{background:linear-gradient(40deg,rgba(69,202,252,.9),rgba(48,63,159,.9))!important}.dark-grey-text,.dark-grey-text:focus,.dark-grey-text:hover{color:#4f4f4f!important}.hoverable{box-shadow:none;transition:.55s ease-in-out}.hoverable:hover{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);transition:.55s ease-in-out}.z-depth-0{box-shadow:none!important}.z-depth-1{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12)!important}.z-depth-1-half{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)!important}.z-depth-2{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)!important}.z-depth-3{box-shadow:0 12px 15px 0 rgba(0,0,0,.24),0 17px 50px 0 rgba(0,0,0,.19)!important}.z-depth-4{box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)!important}.z-depth-5{box-shadow:0 27px 24px 0 rgba(0,0,0,.2),0 40px 77px 0 rgba(0,0,0,.22)!important}.disabled,:disabled{pointer-events:none!important}a{cursor:pointer;text-decoration:none;color:#0275d8;transition:.2s ease-in-out}a:hover{text-decoration:none;color:#014c8c;transition:.2s ease-in-out}a.disabled:hover,a:disabled:hover{color:#0275d8}a:not([href]):not([tabindex]),a:not([href]):not([tabindex]):focus,a:not([href]):not([tabindex]):hover{color:inherit;text-decoration:none}.carousel .carousel-control-next-icon,.carousel .carousel-control-prev-icon{width:2.25rem;height:2.25rem}.carousel .carousel-indicators li{width:.625rem;height:.625rem;border-radius:50%;cursor:pointer}.carousel-fade .carousel-item{opacity:0;transition-duration:.6s;transition-property:opacity}.carousel-fade .carousel-item-next.carousel-item-left,.carousel-fade .carousel-item-prev.carousel-item-right,.carousel-fade .carousel-item.active{opacity:1}.carousel-fade .carousel-item-left.active,.carousel-fade .carousel-item-right.active{opacity:0}.carousel-fade .carousel-item-left.active,.carousel-fade .carousel-item-next,.carousel-fade .carousel-item-prev,.carousel-fade .carousel-item-prev.active,.carousel-fade .carousel-item.active{-webkit-transform:translateX(0);transform:translateX(0)}@supports ((-webkit-transform-style:preserve-3d) or (transform-style:preserve-3d)){.carousel-fade .carousel-item-left.active,.carousel-fade .carousel-item-next,.carousel-fade .carousel-item-prev,.carousel-fade .carousel-item-prev.active,.carousel-fade .carousel-item.active{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}}.carousel-control-next,.carousel-control-prev,.carousel-item-next,.carousel-item-prev,.carousel-item.active{display:flex;overflow:hidden}.carousel,.carousel-multi-item,.carousel-thumbnails{outline:0}.carousel-fade .carousel-inner .carousel-item{opacity:0;transition-property:opacity}.carousel-fade .carousel-inner .active{opacity:1;transition:.6s}.carousel-fade .carousel-inner>.carousel-item.active,.carousel-fade .carousel-inner>.carousel-item.next.left,.carousel-fade .carousel-inner>.carousel-item.prev.right{opacity:1;transition:.6s;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}"],data:{}});function zp(e){return la(0,[(e()(),Ho(0,0,null,null,6,"div",[["class","controls-top"]],null,null,null,null,null)),(e()(),Ho(1,0,null,null,2,"a",[["floating","true"],["mdbBtn",""]],[[2,"disabled",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.previousSlide()&&i),i},Vp,Up)),fr(2,114688,null,0,cf,[un,gn],{floating:[0,"floating"]},null),(e()(),Ho(3,0,null,0,0,"i",[["class","fas fa-chevron-left"]],null,null,null,null,null)),(e()(),Ho(4,0,null,null,2,"a",[["floating","true"],["mdbBtn",""]],[[2,"disabled",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.nextSlide()&&i),i},Vp,Up)),fr(5,114688,null,0,cf,[un,gn],{floating:[0,"floating"]},null),(e()(),Ho(6,0,null,0,0,"i",[["class","fas fa-chevron-right"]],null,null,null,null,null))],function(e,t){e(t,2,0,"true"),e(t,5,0,"true")},function(e,t){var n=t.component;e(t,1,0,0===n.activeSlide&&n.noWrap),e(t,4,0,n.isLast(n.activeSlide)&&n.noWrap)})}function jp(e){return la(0,[(e()(),Ho(0,0,null,null,0,"li",[],[[2,"active",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.selectSlide(e.context.index)&&i),i},null,null))],null,function(e,t){e(t,0,0,!0===t.context.$implicit.active)})}function Hp(e){return la(0,[(e()(),Ho(0,0,null,null,2,"ol",[["class","carousel-indicators"]],null,null,null,null,null)),(e()(),jo(16777216,null,null,1,null,jp)),fr(2,278528,null,0,Ns,[Fn,kn,Rn],{ngForOf:[0,"ngForOf"]},null)],function(e,t){e(t,2,0,t.component.slides)},null)}function Wp(e){return la(0,[(e()(),Ho(0,0,null,null,1,"li",[],[[2,"active",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.selectSlide(e.context.index)&&i),i},null,null)),(e()(),Ho(1,0,null,null,0,"img",[["class","d-block w-100 img-fluid"]],[[8,"src",4]],null,null,null,null))],null,function(e,t){var n=t.component;e(t,0,0,!0===t.context.$implicit.active),e(t,1,0,Ri(1,"",n.getImg(t.context.$implicit),""))})}function Xp(e){return la(0,[(e()(),Ho(0,0,null,null,2,"ol",[["class","carousel-indicators"]],null,null,null,null,null)),(e()(),jo(16777216,null,null,1,null,Wp)),fr(2,278528,null,0,Ns,[Fn,kn,Rn],{ngForOf:[0,"ngForOf"]},null)],function(e,t){e(t,2,0,t.component.slides)},null)}function Yp(e){return la(0,[(e()(),Ho(0,0,null,null,3,"a",[["class","carousel-control-prev"]],[[2,"disabled",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.previousSlide()&&i),i},null,null)),(e()(),Ho(1,0,null,null,0,"span",[["aria-hidden","true"],["class","carousel-control-prev-icon"]],null,null,null,null,null)),(e()(),Ho(2,0,null,null,1,"span",[["class","sr-only"]],null,null,null,null,null)),(e()(),oa(-1,null,["Previous"]))],null,function(e,t){var n=t.component;e(t,0,0,0===n.activeSlide&&n.noWrap)})}function Kp(e){return la(0,[(e()(),Ho(0,0,null,null,3,"a",[["class","carousel-control-next"]],[[2,"disabled",null]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.nextSlide()&&i),i},null,null)),(e()(),Ho(1,0,null,null,0,"span",[["aria-hidden","true"],["class","carousel-control-next-icon"]],null,null,null,null,null)),(e()(),Ho(2,0,null,null,1,"span",[["class","sr-only"]],null,null,null,null,null)),(e()(),oa(-1,null,["Next"]))],null,function(e,t){var n=t.component;e(t,0,0,n.isLast(n.activeSlide)&&n.noWrap)})}function Qp(e){return la(0,[(e()(),Ho(0,0,null,null,12,"div",[["tabindex","0"]],[[8,"className",0]],[[null,"swipeleft"],[null,"swiperight"],[null,"mouseenter"],[null,"mouseleave"],[null,"mouseup"]],function(e,t,n){var i=!0,r=e.component;return"swipeleft"===t&&(i=!1!==r.swipe(n.type)&&i),"swiperight"===t&&(i=!1!==r.swipe(n.type)&&i),"mouseenter"===t&&(i=!1!==r.pause()&&i),"mouseleave"===t&&(i=!1!==r.play()&&i),"mouseup"===t&&(i=!1!==r.play()&&i),i},null,null)),(e()(),jo(16777216,null,null,1,null,zp)),fr(2,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),jo(16777216,null,null,1,null,Hp)),fr(4,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),jo(16777216,null,null,1,null,Xp)),fr(6,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),Ho(7,0,null,null,1,"div",[["class","carousel-inner"]],null,null,null,null,null)),ea(null,0),(e()(),jo(16777216,null,null,1,null,Yp)),fr(10,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),jo(16777216,null,null,1,null,Kp)),fr(12,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null)],function(e,t){var n=t.component;e(t,2,0,n.slides.length>1&&!n.checkNavigation()&&n.isControls),e(t,4,0,n.slides.length>1&&n.checkDots()&&n.isControls),e(t,6,0,n.slides.length>1&&!n.checkDots()&&n.isControls),e(t,10,0,n.slides.length>1&&n.checkNavigation()&&n.isControls),e(t,12,0,n.slides.length>1&&n.checkNavigation()&&n.isControls)},function(e,t){var n=t.component;e(t,0,0,Ri(2,"carousel ",n.class," ",n.type,""))})}var qp=ti({encapsulation:2,styles:[],data:{}});function Zp(e){return la(0,[ea(null,0)],null,null)}var Jp=ti({encapsulation:2,styles:[],data:{}});function $p(e){return la(2,[(e()(),Ho(0,0,null,null,1,"div",[],[[2,"dropup",null],[2,"dropdown",null],[2,"show",null],[2,"open",null]],null,null,null,null)),ea(null,0)],null,function(e,t){var n=t.component;e(t,0,0,"up"===n.direction,"down"===n.direction,n.isOpen,n.isOpen)})}function eg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-dropdown-container",[],[[4,"display",null],[4,"position",null]],null,null,$p,Jp)),fr(1,180224,null,0,lp,[sp],null,null)],null,function(e,t){e(t,0,0,er(t,1).display,er(t,1).position)})}var tg=ji("mdb-dropdown-container",lp,eg,{},{},["*"]),ng=ti({encapsulation:2,styles:[],data:{}});function ig(e){return la(0,[(e()(),Ho(0,0,null,null,3,"i",[],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(2,278528,null,0,Ls,[Is],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ia(3,{fas:0,far:1,fab:2,fal:3})],function(e,t){var n=t.component,i=Ri(4,"fa-",n.icon," ",n.class," ",n.classInside," ",n.sizeClass,""),r=e(t,3,0,n.fas,n.far,n.fab,n.fal);e(t,2,0,i,r)},null)}var rg=ti({encapsulation:2,styles:[],data:{}});function og(e){return la(0,[],null,null)}function ag(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-modal-backdrop",[],[[2,"modal-backdrop",null]],null,null,og,rg)),fr(1,114688,null,0,bp,[un,gn],null,null)],function(e,t){e(t,1,0)},function(e,t){e(t,0,0,er(t,1).classNameBackDrop)})}var sg=ji("mdb-modal-backdrop",bp,ag,{},{},[]),lg=ti({encapsulation:2,styles:[".img-fluid,.modal-dialog.cascading-modal.modal-avatar .modal-header,.video-fluid{max-width:100%;height:auto}.flex-center{display:flex;justify-content:center;align-items:center;height:100%}.flex-center p{margin:0}.flex-center ul{text-align:center}.flex-center ul li{margin-bottom:1rem}.flex-center ul li:last-of-type{margin-bottom:0}.hr-light{border-top:1px solid #fff}.hr-dark{border-top:1px solid #666}.w-responsive{width:75%}@media (max-width:740px){.w-responsive{width:100%}}.collapsible-body{display:none}.jumbotron{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12);border-radius:.125rem;background-color:#fff}.bg-primary{background-color:#4285f4!important}a.bg-primary:focus,a.bg-primary:hover,button.bg-primary:focus,button.bg-primary:hover{background-color:#1266f1!important}.border-primary{border-color:#4285f4!important}.bg-danger{background-color:#ff3547!important}a.bg-danger:focus,a.bg-danger:hover,button.bg-danger:focus,button.bg-danger:hover{background-color:#ff0219!important}.border-danger{border-color:#ff3547!important}.bg-warning{background-color:#fb3!important}a.bg-warning:focus,a.bg-warning:hover,button.bg-warning:focus,button.bg-warning:hover{background-color:#fa0!important}.border-warning{border-color:#fb3!important}.bg-success{background-color:#00c851!important}a.bg-success:focus,a.bg-success:hover,button.bg-success:focus,button.bg-success:hover{background-color:#00953c!important}.border-success{border-color:#00c851!important}.bg-info{background-color:#33b5e5!important}a.bg-info:focus,a.bg-info:hover,button.bg-info:focus,button.bg-info:hover{background-color:#1a9bcb!important}.border-info{border-color:#33b5e5!important}.bg-default{background-color:#2bbbad!important}a.bg-default:focus,a.bg-default:hover,button.bg-default:focus,button.bg-default:hover{background-color:#219287!important}.border-default{border-color:#2bbbad!important}.bg-secondary{background-color:#a6c!important}a.bg-secondary:focus,a.bg-secondary:hover,button.bg-secondary:focus,button.bg-secondary:hover{background-color:#9540bf!important}.border-secondary{border-color:#a6c!important}.bg-dark{background-color:#212121!important}a.bg-dark:focus,a.bg-dark:hover,button.bg-dark:focus,button.bg-dark:hover{background-color:#080808!important}.border-dark{border-color:#212121!important}.bg-light{background-color:#e0e0e0!important}a.bg-light:focus,a.bg-light:hover,button.bg-light:focus,button.bg-light:hover{background-color:#c7c7c7!important}.border-light{border-color:#e0e0e0!important}.card-img-100{width:100px;height:100px}.card-img-64{width:64px;height:64px}.mml-1{margin-left:-.25rem!important}.flex-1{flex:1}body.modal-open{overflow:auto}.modal-dialog .modal-content .modal-header{border-top-left-radius:.125rem;border-top-right-radius:.125rem}.modal-dialog.cascading-modal .close{opacity:1;text-shadow:none;color:#fff;outline:0}.modal-dialog.cascading-modal .modal-header{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);border-radius:.125rem}.modal-dialog.cascading-modal .modal-header .title .fab,.modal-dialog.cascading-modal .modal-header .title .far,.modal-dialog.cascading-modal .modal-header .title .fas{margin-right:9px}.modal-dialog.cascading-modal .modal-c-tabs .md-tabs{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12);display:flex}.modal-dialog.cascading-modal .modal-c-tabs .md-tabs li{flex:1}.modal-dialog.cascading-modal .modal-c-tabs .md-tabs li a{text-align:center}.modal-dialog.cascading-modal .modal-c-tabs .tab-content{box-shadow:unset;padding:1.7rem 0 0}.modal-dialog.cascading-modal.modal-avatar .modal-header img{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);margin-left:auto;margin-right:auto;width:130px}.modal-dialog.modal-notify.modal-primary .modal-header{background-color:#4285f4}.modal-dialog.modal-notify.modal-primary .fab,.modal-dialog.modal-notify.modal-primary .far,.modal-dialog.modal-notify.modal-primary .fas{color:#4285f4}.modal-dialog.modal-notify.modal-primary .badge{background-color:#4285f4}.modal-dialog.modal-notify.modal-primary .btn .fab,.modal-dialog.modal-notify.modal-primary .btn .far,.modal-dialog.modal-notify.modal-primary .btn .fas{color:#fff}.modal-dialog.modal-notify.modal-primary .btn.btn-outline-primary .fab,.modal-dialog.modal-notify.modal-primary .btn.btn-outline-primary .far,.modal-dialog.modal-notify.modal-primary .btn.btn-outline-primary .fas{color:#4285f4}.modal-dialog.modal-notify.modal-danger .fab,.modal-dialog.modal-notify.modal-danger .far,.modal-dialog.modal-notify.modal-danger .fas{color:#ff3547}.modal-dialog.modal-notify.modal-danger .btn .fab,.modal-dialog.modal-notify.modal-danger .btn .far,.modal-dialog.modal-notify.modal-danger .btn .fas{color:#fff}.modal-dialog.modal-notify.modal-danger .btn.btn-outline-danger .fab,.modal-dialog.modal-notify.modal-danger .btn.btn-outline-danger .far,.modal-dialog.modal-notify.modal-danger .btn.btn-outline-danger .fas{color:#ff3547}.modal-dialog.modal-notify.modal-warning .fab,.modal-dialog.modal-notify.modal-warning .far,.modal-dialog.modal-notify.modal-warning .fas{color:#fb3}.modal-dialog.modal-notify.modal-warning .btn .fab,.modal-dialog.modal-notify.modal-warning .btn .far,.modal-dialog.modal-notify.modal-warning .btn .fas{color:#fff}.modal-dialog.modal-notify.modal-warning .btn.btn-outline-warning .fab,.modal-dialog.modal-notify.modal-warning .btn.btn-outline-warning .far,.modal-dialog.modal-notify.modal-warning .btn.btn-outline-warning .fas{color:#fb3}.modal-dialog.modal-notify.modal-success .fab,.modal-dialog.modal-notify.modal-success .far,.modal-dialog.modal-notify.modal-success .fas{color:#00c851}.modal-dialog.modal-notify.modal-success .btn .fab,.modal-dialog.modal-notify.modal-success .btn .far,.modal-dialog.modal-notify.modal-success .btn .fas{color:#fff}.modal-dialog.modal-notify.modal-success .btn.btn-outline-success .fab,.modal-dialog.modal-notify.modal-success .btn.btn-outline-success .far,.modal-dialog.modal-notify.modal-success .btn.btn-outline-success .fas{color:#00c851}.modal-dialog.modal-notify.modal-info .fab,.modal-dialog.modal-notify.modal-info .far,.modal-dialog.modal-notify.modal-info .fas{color:#33b5e5}.modal-dialog.modal-notify.modal-info .btn .fab,.modal-dialog.modal-notify.modal-info .btn .far,.modal-dialog.modal-notify.modal-info .btn .fas{color:#fff}.modal-dialog.modal-notify.modal-info .btn.btn-outline-info .fab,.modal-dialog.modal-notify.modal-info .btn.btn-outline-info .far,.modal-dialog.modal-notify.modal-info .btn.btn-outline-info .fas{color:#33b5e5}@media (min-width:768px){.modal .modal-dialog.modal-top{top:0}.modal .modal-dialog.modal-left{left:0}.modal .modal-dialog.modal-right{right:0}.modal .modal-dialog.modal-bottom{bottom:0}.modal .modal-dialog.modal-top-left{top:10px;left:10px}.modal .modal-dialog.modal-top-right{top:10px;right:10px}.modal .modal-dialog.modal-bottom-left{bottom:10px;left:10px}.modal .modal-dialog.modal-bottom-right{bottom:10px;right:10px}}@media (min-width:992px){.modal.modal-scrolling{position:relative}.modal.modal-scrolling .modal-dialog{position:fixed;z-index:1050}.modal.modal-content-clickable{top:auto;bottom:auto}.modal.modal-content-clickable .modal-dialog{position:fixed}.modal .modal-fluid{width:100%;max-width:100%}.modal .modal-fluid .modal-content{width:100%}.modal .modal-frame{position:absolute;margin:0!important;width:100%;max-width:100%!important}.modal .modal-frame.modal-bottom{bottom:0}.modal .modal-frame.modal-dialog{height:inherit}.modal .modal-full-height{position:absolute;display:flex;margin:0;width:400px;min-height:100%;height:auto;min-height:100%;top:0;right:0}.modal .modal-full-height.modal-bottom,.modal .modal-full-height.modal-top{display:block;width:100%;max-width:100%;height:auto}.modal .modal-full-height.modal-top{bottom:auto}.modal .modal-full-height.modal-bottom{min-height:0;top:auto}.modal .modal-full-height .modal-content{width:100%}.modal .modal-full-height.modal-lg{width:90%;max-width:90%}.modal .modal-side{position:absolute;bottom:10px;right:10px;margin:0;width:400px}}@media (min-width:992px) and (min-width:992px){.modal .modal-full-height.modal-lg{width:800px;max-width:800px}}@media (min-width:992px) and (min-width:1200px){.modal .modal-full-height.modal-lg{width:1000px;max-width:1000px}}body.scrollable{overflow-y:auto}.modal-dialog .modal-content{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15);border-radius:.125rem;border:0}.modal{padding-right:0!important}@media (min-width:768px){.modal .modal-dialog.modal-top{top:0;left:0;right:0}.modal .modal-dialog.modal-left{left:0}.modal .modal-dialog.modal-right{right:0}.modal .modal-dialog.modal-bottom>.modal-content{position:absolute;bottom:0}.modal .modal-dialog.modal-top-left{top:10px;left:10px}.modal .modal-dialog.modal-top-right{top:10px;right:10px}.modal .modal-dialog.modal-bottom-left{left:10px;bottom:10px}.modal .modal-dialog.modal-bottom-right{right:10px;bottom:10px}.modal-sm{max-width:300px}}.modal .modal-side.modal-top{top:0}.modal .modal-side.modal-left{left:0}.modal .modal-side.modal-right{right:0}.modal .modal-side.modal-bottom{bottom:0}.modal .modal-side.modal-top-left{top:10px;left:10px}.modal .modal-side.modal-top-right{top:10px;right:10px}.modal .modal-side.modal-bottom-left{left:10px;bottom:10px}.modal .modal-side.modal-bottom-right{right:10px;bottom:10px}.modal.fade.top:not(.show) .modal-dialog{-webkit-transform:translate3d(0,-25%,0);transform:translate3d(0,-25%,0)}.modal.fade.left:not(.show) .modal-dialog{-webkit-transform:translate3d(-25%,0,0);transform:translate3d(-25%,0,0)}.modal.fade.right:not(.show) .modal-dialog{-webkit-transform:translate3d(25%,0,0);transform:translate3d(25%,0,0)}.modal.fade.bottom:not(.show) .modal-dialog{-webkit-transform:translate3d(0,25%,0);transform:translate3d(0,25%,0)}.modal.fade.in{opacity:1}.modal.fade.in .modal-dialog{-webkit-transform:translate(0,0);transform:translate(0,0)}.modal.fade.in .modal-dialog .relative{display:inline-block}.modal.modal-scrolling{position:relative}.modal.modal-scrolling .modal-dialog{position:fixed;z-index:1050}.modal.modal-content-clickable{top:auto;bottom:auto}.modal.modal-content-clickable .modal-dialog{position:fixed}.modal .modal-fluid{max-width:100%}.modal .modal-fluid .modal-content{width:100%}.modal .modal-frame{position:absolute;max-width:100%;margin:0}@media (max-width:767px){.modal .modal-frame{padding:.5rem}}.modal .modal-frame.modal-bottom{bottom:0}.modal .modal-full-height{display:flex;position:absolute;width:400px;min-height:100%;margin:0;top:0;right:0}@media (max-width:576px){.modal .modal-full-height{width:100%;padding:.5rem}}@media (max-width:992px){.modal .modal-full-height{width:100%;height:unset;position:unset}.modal .modal-full-height.modal-left,.modal .modal-full-height.modal-right,.modal .modal-full-height.modal-top{margin:1.75rem auto;min-height:unset}.modal .modal-full-height.modal-bottom,.modal .modal-full-height.modal-left,.modal .modal-full-height.modal-right,.modal .modal-full-height.modal-top{margin-left:auto;margin-right:auto}}@media (min-width:768px) and (max-width:992px){.modal .modal-full-height.modal-bottom{margin-bottom:1.75rem}.modal .modal-full-height.modal-bottom .modal-content{bottom:1rem}}.modal .modal-full-height.modal-bottom,.modal .modal-full-height.modal-top{display:block;width:100%;height:auto}.modal .modal-full-height.modal-top{bottom:auto}.modal .modal-full-height.modal-bottom{bottom:0}.modal .modal-full-height .modal-content{width:100%}.modal .modal-full-height.modal-lg{max-width:90%;width:90%}@media (min-width:992px){.modal .modal-full-height.modal-lg{max-width:800px;width:800px}}@media (min-width:1200px){.modal .modal-full-height.modal-lg{max-width:1000px;width:1000px}}.modal .modal-side{position:absolute;right:10px;bottom:10px;margin:0;min-width:100px}@media (max-width:768px){.modal .modal-full-height.modal-bottom{margin-top:1.75rem}.modal .modal-side{padding-left:.5rem}}.modal-dialog.cascading-modal{margin-top:10%}.modal-dialog.cascading-modal .modal-header{text-align:center;margin:-2rem 1rem 1rem;padding:1.5rem;border:none;flex-direction:column}.modal-dialog.cascading-modal .modal-header .close{margin-right:2.5rem}.modal-dialog.cascading-modal .modal-header.white-text .close{color:#fff;opacity:1}.modal-dialog.cascading-modal .modal-header .title{width:100%;margin-bottom:0;font-size:1.25rem}.modal-dialog.cascading-modal .modal-header .title .fa{margin-right:9px}.modal-dialog.cascading-modal .modal-header .social-buttons{margin-top:1.5rem}.modal-dialog.cascading-modal .modal-header .social-buttons a{font-size:1rem}.modal-dialog.cascading-modal .modal-c-tabs .md-tabs{margin:-1.5rem 1rem 0}.modal-dialog.cascading-modal .modal-body,.modal-dialog.cascading-modal .modal-footer{color:#616161;padding-right:2rem;padding-left:2rem}.modal-dialog.cascading-modal .modal-body .additional-option,.modal-dialog.cascading-modal .modal-footer .additional-option{text-align:center;margin-top:1rem}.modal-dialog.cascading-modal.modal-avatar{margin-top:6rem}.modal-dialog.cascading-modal.modal-avatar .modal-header{box-shadow:none;margin:-6rem 2rem -1rem}.modal-dialog.modal-notify .heading{margin:0;padding:.3rem;color:#fff;font-size:1.15rem}.modal-dialog.modal-notify .modal-header{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12);border:0}.modal-dialog.modal-notify .close{opacity:1}.modal-dialog.modal-notify .modal-body{padding:1.5rem;color:#616161}.modal-dialog.modal-notify .btn-outline-secondary-modal{background-color:transparent}.modal-dialog.modal-notify.modal-info .modal-header{background-color:#5394ff}.modal-dialog.modal-notify.modal-info .fa{color:#5394ff}.modal-dialog.modal-notify.modal-info .badge{background-color:#5394ff}.modal-dialog.modal-notify.modal-info .btn-primary-modal{background:#5394ff}.modal-dialog.modal-notify.modal-info .btn-primary-modal:active,.modal-dialog.modal-notify.modal-info .btn-primary-modal:focus,.modal-dialog.modal-notify.modal-info .btn-primary-modal:hover{background-color:#6da4ff!important}.modal-dialog.modal-notify.modal-info .btn-primary-modal.active{background-color:#0059ec!important}.modal-dialog.modal-notify.modal-info .btn-outline-secondary-modal{border:2px solid #5394ff;color:#5394ff!important}.modal-dialog.modal-notify.modal-warning .modal-header{background-color:#ff8e38}.modal-dialog.modal-notify.modal-warning .fa{color:#ff8e38}.modal-dialog.modal-notify.modal-warning .badge{background-color:#ff8e38}.modal-dialog.modal-notify.modal-warning .btn-primary-modal{background:#ff8e38}.modal-dialog.modal-notify.modal-warning .btn-primary-modal:active,.modal-dialog.modal-notify.modal-warning .btn-primary-modal:focus,.modal-dialog.modal-notify.modal-warning .btn-primary-modal:hover{background-color:#ff9c52!important}.modal-dialog.modal-notify.modal-warning .btn-primary-modal.active{background-color:#d15a00!important}.modal-dialog.modal-notify.modal-warning .btn-outline-secondary-modal{border:2px solid #ff8e38;color:#ff8e38!important}.modal-dialog.modal-notify.modal-success .modal-header{background-color:#01d36b}.modal-dialog.modal-notify.modal-success .fa{color:#01d36b}.modal-dialog.modal-notify.modal-success .badge{background-color:#01d36b}.modal-dialog.modal-notify.modal-success .btn-primary-modal{background:#01d36b}.modal-dialog.modal-notify.modal-success .btn-primary-modal:active,.modal-dialog.modal-notify.modal-success .btn-primary-modal:focus,.modal-dialog.modal-notify.modal-success .btn-primary-modal:hover{background-color:#01ec78!important}.modal-dialog.modal-notify.modal-success .btn-primary-modal.active{background-color:#016d38!important}.modal-dialog.modal-notify.modal-success .btn-outline-secondary-modal{border:2px solid #01d36b;color:#01d36b!important}.modal-dialog.modal-notify.modal-danger .modal-header{background-color:#ff4b4b}.modal-dialog.modal-notify.modal-danger .fa{color:#ff4b4b}.modal-dialog.modal-notify.modal-danger .badge{background-color:#ff4b4b}.modal-dialog.modal-notify.modal-danger .btn-primary-modal{background:#ff4b4b}.modal-dialog.modal-notify.modal-danger .btn-primary-modal:active,.modal-dialog.modal-notify.modal-danger .btn-primary-modal:focus,.modal-dialog.modal-notify.modal-danger .btn-primary-modal:hover{background-color:#ff6565!important}.modal-dialog.modal-notify.modal-danger .btn-primary-modal.active{background-color:#e40000!important}.modal-dialog.modal-notify.modal-danger .btn-outline-secondary-modal{border:2px solid #ff4b4b;color:#ff4b4b!important}.modal-sm .modal-content{margin:0 auto;max-width:300px}.modal .modal-fluid,.modal .modal-frame{width:100%;max-width:100%}.modal-ext .modal-content .modal-header{text-align:center}.modal-ext .modal-content .options{float:left}.modal-ext .modal-content .modal-body .text-xs-center fieldset{margin-top:20px}.modal-ext .modal-content .call{margin-top:1rem}.modal-ext .modal-content .modal-body{padding:2rem 2rem 1rem}.modal-content:not(.card-image) .close{position:absolute;right:15px}.modal-cart li p{margin:5px;font-weight:400}.modal-cart li p .badge{margin-left:10px;margin-top:3px;font-weight:400;position:absolute}.modal-cart li p .quantity{font-size:16px;margin-right:7px;font-weight:300}.modal-cart .cartPageLink{margin-left:10px}.modal-cart .cartPageLink a{text-decoration:underline;color:#666}.modal-cart .total{float:right;font-weight:400}.cf-phone{margin-left:7px}.side-modal{position:fixed;height:100%;width:100%;z-index:9999}.side-modal .modal-dialog{position:absolute;bottom:10px;right:10px;width:400px;margin:10px}@media (max-width:760px){.side-modal .modal-dialog{display:none}}.side-modal .modal-header{padding:1rem}.side-modal .modal-header .heading{margin:0;padding:0}.side-modal .modal-content{border:none}.side-modal.fade:not(.show) .modal-dialog{-webkit-transform:translate3d(25%,0,0);transform:translate3d(25%,0,0)}.transparent-bd{opacity:0!important}.modal-backdrop,.modal-backdrop.in{opacity:.5}#exampleModalScroll{overflow-x:hidden;overflow-y:auto}.modal-open .modal{overflow-x:hidden;overflow-y:hidden}.form-dark .card-image{background-size:100%}"],data:{}});function cg(e){return la(0,[(e()(),Ho(0,0,null,null,2,"div",[["role","document"]],[[8,"className",0]],null,null,null,null)),(e()(),Ho(1,0,null,null,1,"div",[["class","modal-content"]],null,null,null,null,null)),ea(null,0)],null,function(e,t){var n=t.component;e(t,0,0,"modal-dialog"+(n.config.class?" "+n.config.class:""))})}function ug(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-modal-container",[],[[8,"tabIndex",0],[8,"role",0],[2,"modal",null]],[[null,"click"],["window","keydown.esc"],[null,"keydown"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,1).onClick(n)&&i),"window:keydown.esc"===t&&(i=!1!==er(e,1).onEsc()&&i),"keydown"===t&&(i=!1!==er(e,1).onKeyDown(n)&&i),i},cg,lg)),fr(1,245760,null,0,Tp,[gp,un,gn],null,null)],function(e,t){e(t,1,0)},function(e,t){e(t,0,0,er(t,1).tabindex,er(t,1).role,er(t,1).modal)})}var hg=ji("mdb-modal-container",Tp,ug,{},{},["*"]),dg=ti({encapsulation:2,styles:[".popover.bs-tether-element-attached-bottom,.popover.popover-top{margin-top:-10px}.popover.bs-tether-element-attached-bottom::after,.popover.bs-tether-element-attached-bottom::before,.popover.popover-top::after,.popover.popover-top::before{left:50%;border-bottom-width:0}.popover.bs-tether-element-attached-bottom::before,.popover.popover-top::before{bottom:-11px;margin-left:-11px;border-top-color:rgba(0,0,0,.25)}.popover.bs-tether-element-attached-bottom::after,.popover.popover-top::after{bottom:-10px;margin-left:-10px;border-top-color:#fff}.popover.bs-tether-element-attached-left,.popover.popover-right{margin-left:10px}.popover.bs-tether-element-attached-left::after,.popover.bs-tether-element-attached-left::before,.popover.popover-right::after,.popover.popover-right::before{top:50%;border-left-width:0}.popover.bs-tether-element-attached-left::before,.popover.popover-right::before{left:-11px;margin-top:-11px;border-right-color:rgba(0,0,0,.25)}.popover.bs-tether-element-attached-left::after,.popover.popover-right::after{left:-10px;margin-top:-10px;border-right-color:#fff}.popover.bs-tether-element-attached-top,.popover.popover-bottom{margin-top:10px}.popover.bs-tether-element-attached-top::after,.popover.bs-tether-element-attached-top::before,.popover.popover-bottom::after,.popover.popover-bottom::before{left:50%;border-top-width:0}.popover.bs-tether-element-attached-top::before,.popover.popover-bottom::before{top:-11px;margin-left:-11px;border-bottom-color:rgba(0,0,0,.25)}.popover.bs-tether-element-attached-top::after,.popover.popover-bottom::after{top:-10px;margin-left:-10px;border-bottom-color:#f7f7f7}.popover.bs-tether-element-attached-top .popover-title::before,.popover.popover-bottom .popover-title::before{position:absolute;top:0;left:50%;display:block;width:20px;margin-left:-10px;content:'';border-bottom:1px solid #f7f7f7}.popover.bs-tether-element-attached-right,.popover.popover-left{margin-left:-10px}.popover.bs-tether-element-attached-right::after,.popover.bs-tether-element-attached-right::before,.popover.popover-left::after,.popover.popover-left::before{top:50%;border-right-width:0}.popover.bs-tether-element-attached-right::before,.popover.popover-left::before{right:-11px;margin-top:-11px;border-left-color:rgba(0,0,0,.25)}.popover.bs-tether-element-attached-right::after,.popover.popover-left::after{right:-10px;margin-top:-10px;border-left-color:#fff}.popover::after,.popover::before{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid}.popover::before{content:'';border-width:11px}.popover::after{content:'';border-width:10px}@-webkit-keyframes fadeInPopover{from{opacity:0}to{opacity:1}}@keyframes fadeInPopover{from{opacity:0}to{opacity:1}}.popover-fadeIn{-webkit-animation-name:fadeInPopover;animation-name:fadeInPopover;-webkit-animation-delay:.2s;animation-delay:.2s;-webkit-animation-duration:.2s;animation-duration:.2s;-webkit-animation-fill-mode:both;animation-fill-mode:both}"],data:{}});function fg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"h3",[["class","popover-header"]],null,null,null,null,null)),(e()(),oa(1,null,["",""]))],null,function(e,t){e(t,1,0,t.component.title)})}function pg(e){return la(2,[(e()(),jo(16777216,null,null,1,null,fg)),fr(1,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),Ho(2,0,null,null,1,"div",[["class","popover-body"]],null,null,null,null,null)),ea(null,0)],function(e,t){e(t,1,0,t.component.title)},null)}function gg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-popover-container",[],[[2,"show",null],[1,"role",0],[8,"className",0]],null,null,pg,dg)),fr(1,114688,null,0,Pp,[Ap],null,null)],function(e,t){e(t,1,0)},function(e,t){e(t,0,0,er(t,1).show,er(t,1).role,er(t,1).class)})}var mg=ji("mdb-popover-container",Pp,gg,{placement:"placement",title:"title"},{},["*"]),_g=ti({encapsulation:2,styles:[],data:{}});function vg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"li",[],null,null,null,null,null)),(e()(),oa(1,null,[""," "," "," "," ",""]))],null,function(e,t){var n=t.component;e(t,1,0,n.firstItemIndex,n.dashKeyword,n.lastVisibleItemIndex,n.ofKeyword,n.allItemsLength)})}function bg(e){return la(0,[(e()(),Ho(0,0,null,null,20,"nav",[],null,null,null,null,null)),(e()(),Ho(1,0,null,null,19,"ul",[["class","pagination pagination-circle pg-blue d-flex flex-center"]],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(3,278528,null,0,Ls,[Is],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ia(4,{"justify-content-end":0,"justify-content-start":1}),(e()(),jo(16777216,null,null,1,null,vg)),fr(6,16384,null,0,Bs,[Fn,kn],{ngIf:[0,"ngIf"]},null),(e()(),Ho(7,0,null,null,6,"li",[["class","page-item"]],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(9,278528,null,0,Ls,[Is],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ia(10,{disabled:0}),(e()(),Ho(11,0,null,null,2,"a",[["aria-label","Previous"],["class","page-link"],["mdbWavesEffect",""]],null,[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.previousPage()&&i),i},null,null)),(e()(),Ho(12,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(e()(),oa(-1,null,["\xab"])),(e()(),Ho(14,0,null,null,6,"li",[["class","page-item"]],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(16,278528,null,0,Ls,[Is],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ia(17,{disabled:0}),(e()(),Ho(18,0,null,null,2,"a",[["aria-label","Next"],["class","page-link"],["mdbWavesEffect",""]],null,[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==e.component.nextPage()&&i),i},null,null)),(e()(),Ho(19,0,null,null,1,"span",[["aria-hidden","true"]],null,null,null,null,null)),(e()(),oa(-1,null,["\xbb"]))],function(e,t){var n=t.component,i=e(t,4,0,"end"==n.paginationAlign,"start"==n.paginationAlign);e(t,3,0,"pagination pagination-circle pg-blue d-flex flex-center",i),e(t,6,0,!n.hideDescription);var r=e(t,10,0,n.checkIfPreviousShouldBeDisabled());e(t,9,0,"page-item",r);var o=e(t,17,0,n.checkIfNextShouldBeDisabled());e(t,16,0,"page-item",o)},null)}function yg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-table-pagination",[],null,null,null,bg,_g)),fr(1,4833280,null,0,Op,[On],null,null)],function(e,t){e(t,1,0)},null)}var Tg=ji("mdb-table-pagination",Op,yg,{tableEl:"tableEl",searchPagination:"searchPagination",searchDataSource:"searchDataSource",ofKeyword:"ofKeyword",dashKeyword:"dashKeyword",paginationAlign:"paginationAlign",hideDescription:"hideDescription"},{nextPageClick:"nextPageClick",previousPageClick:"previousPageClick"},[]),Eg=ti({encapsulation:2,styles:['.mdb-color.lighten-5{background-color:#d0d6e2!important}.mdb-color.lighten-4{background-color:#b1bace!important}.mdb-color.lighten-3{background-color:#929fba!important}.mdb-color.lighten-2{background-color:#7283a7!important}.mdb-color.lighten-1{background-color:#59698d!important}.mdb-color{background-color:#45526e!important}.mdb-color-text{color:#45526e!important}.rgba-mdb-color-slight,.rgba-mdb-color-slight:after{background-color:rgba(69,82,110,.1)}.rgba-mdb-color-light,.rgba-mdb-color-light:after{background-color:rgba(69,82,110,.3)}.rgba-mdb-color-strong,.rgba-mdb-color-strong:after{background-color:rgba(69,82,110,.7)}.mdb-color.darken-1{background-color:#3b465e!important}.mdb-color.darken-2{background-color:#2e3951!important}.mdb-color.darken-3{background-color:#1c2a48!important}.mdb-color.darken-4{background-color:#1c2331!important}.red.lighten-5{background-color:#ffebee!important}.red.lighten-4{background-color:#ffcdd2!important}.red.lighten-3{background-color:#ef9a9a!important}.red.lighten-2{background-color:#e57373!important}.red.lighten-1{background-color:#ef5350!important}.red{background-color:#f44336!important}.red-text{color:#f44336!important}.rgba-red-slight,.rgba-red-slight:after{background-color:rgba(244,67,54,.1)}.rgba-red-light,.rgba-red-light:after{background-color:rgba(244,67,54,.3)}.rgba-red-strong,.rgba-red-strong:after{background-color:rgba(244,67,54,.7)}.red.darken-1{background-color:#e53935!important}.red.darken-2{background-color:#d32f2f!important}.red.darken-3{background-color:#c62828!important}.red.darken-4{background-color:#b71c1c!important}.red.accent-1{background-color:#ff8a80!important}.red.accent-2{background-color:#ff5252!important}.red.accent-3{background-color:#ff1744!important}.red.accent-4{background-color:#d50000!important}.pink.lighten-5{background-color:#fce4ec!important}.pink.lighten-4{background-color:#f8bbd0!important}.pink.lighten-3{background-color:#f48fb1!important}.pink.lighten-2{background-color:#f06292!important}.pink.lighten-1{background-color:#ec407a!important}.pink{background-color:#e91e63!important}.pink-text{color:#e91e63!important}.rgba-pink-slight,.rgba-pink-slight:after{background-color:rgba(233,30,99,.1)}.rgba-pink-light,.rgba-pink-light:after{background-color:rgba(233,30,99,.3)}.rgba-pink-strong,.rgba-pink-strong:after{background-color:rgba(233,30,99,.7)}.pink.darken-1{background-color:#d81b60!important}.pink.darken-2{background-color:#c2185b!important}.pink.darken-3{background-color:#ad1457!important}.pink.darken-4{background-color:#880e4f!important}.pink.accent-1{background-color:#ff80ab!important}.pink.accent-2{background-color:#ff4081!important}.pink.accent-3{background-color:#f50057!important}.pink.accent-4{background-color:#c51162!important}.purple.lighten-5{background-color:#f3e5f5!important}.purple.lighten-4{background-color:#e1bee7!important}.purple.lighten-3{background-color:#ce93d8!important}.purple.lighten-2{background-color:#ba68c8!important}.purple.lighten-1{background-color:#ab47bc!important}.purple{background-color:#9c27b0!important}.purple-text{color:#9c27b0!important}.rgba-purple-slight,.rgba-purple-slight:after{background-color:rgba(156,39,176,.1)}.rgba-purple-light,.rgba-purple-light:after{background-color:rgba(156,39,176,.3)}.rgba-purple-strong,.rgba-purple-strong:after{background-color:rgba(156,39,176,.7)}.purple.darken-1{background-color:#8e24aa!important}.purple.darken-2{background-color:#7b1fa2!important}.purple.darken-3{background-color:#6a1b9a!important}.purple.darken-4{background-color:#4a148c!important}.purple.accent-1{background-color:#ea80fc!important}.purple.accent-2{background-color:#e040fb!important}.purple.accent-3{background-color:#d500f9!important}.purple.accent-4{background-color:#a0f!important}.deep-purple.lighten-5{background-color:#ede7f6!important}.deep-purple.lighten-4{background-color:#d1c4e9!important}.deep-purple.lighten-3{background-color:#b39ddb!important}.deep-purple.lighten-2{background-color:#9575cd!important}.deep-purple.lighten-1{background-color:#7e57c2!important}.deep-purple{background-color:#673ab7!important}.deep-purple-text{color:#673ab7!important}.rgba-deep-purple-slight,.rgba-deep-purple-slight:after{background-color:rgba(103,58,183,.1)}.rgba-deep-purple-light,.rgba-deep-purple-light:after{background-color:rgba(103,58,183,.3)}.rgba-deep-purple-strong,.rgba-deep-purple-strong:after{background-color:rgba(103,58,183,.7)}.deep-purple.darken-1{background-color:#5e35b1!important}.deep-purple.darken-2{background-color:#512da8!important}.deep-purple.darken-3{background-color:#4527a0!important}.deep-purple.darken-4{background-color:#311b92!important}.deep-purple.accent-1{background-color:#b388ff!important}.deep-purple.accent-2{background-color:#7c4dff!important}.deep-purple.accent-3{background-color:#651fff!important}.deep-purple.accent-4{background-color:#6200ea!important}.indigo.lighten-5{background-color:#e8eaf6!important}.indigo.lighten-4{background-color:#c5cae9!important}.indigo.lighten-3{background-color:#9fa8da!important}.indigo.lighten-2{background-color:#7986cb!important}.indigo.lighten-1{background-color:#5c6bc0!important}.indigo{background-color:#3f51b5!important}.indigo-text{color:#3f51b5!important}.rgba-indigo-slight,.rgba-indigo-slight:after{background-color:rgba(63,81,181,.1)}.rgba-indigo-light,.rgba-indigo-light:after{background-color:rgba(63,81,181,.3)}.rgba-indigo-strong,.rgba-indigo-strong:after{background-color:rgba(63,81,181,.7)}.indigo.darken-1{background-color:#3949ab!important}.indigo.darken-2{background-color:#303f9f!important}.indigo.darken-3{background-color:#283593!important}.indigo.darken-4{background-color:#1a237e!important}.indigo.accent-1{background-color:#8c9eff!important}.indigo.accent-2{background-color:#536dfe!important}.indigo.accent-3{background-color:#3d5afe!important}.indigo.accent-4{background-color:#304ffe!important}.blue.lighten-5{background-color:#e3f2fd!important}.blue.lighten-4{background-color:#bbdefb!important}.blue.lighten-3{background-color:#90caf9!important}.blue.lighten-2{background-color:#64b5f6!important}.blue.lighten-1{background-color:#42a5f5!important}.blue{background-color:#2196f3!important}.blue-text{color:#2196f3!important}.rgba-blue-slight,.rgba-blue-slight:after{background-color:rgba(33,150,243,.1)}.rgba-blue-light,.rgba-blue-light:after{background-color:rgba(33,150,243,.3)}.rgba-blue-strong,.rgba-blue-strong:after{background-color:rgba(33,150,243,.7)}.blue.darken-1{background-color:#1e88e5!important}.blue.darken-2{background-color:#1976d2!important}.blue.darken-3{background-color:#1565c0!important}.blue.darken-4{background-color:#0d47a1!important}.blue.accent-1{background-color:#82b1ff!important}.blue.accent-2{background-color:#448aff!important}.blue.accent-3{background-color:#2979ff!important}.blue.accent-4{background-color:#2962ff!important}.light-blue.lighten-5{background-color:#e1f5fe!important}.light-blue.lighten-4{background-color:#b3e5fc!important}.light-blue.lighten-3{background-color:#81d4fa!important}.light-blue.lighten-2{background-color:#4fc3f7!important}.light-blue.lighten-1{background-color:#29b6f6!important}.light-blue{background-color:#03a9f4!important}.light-blue-text{color:#03a9f4!important}.rgba-light-blue-slight,.rgba-light-blue-slight:after{background-color:rgba(3,169,244,.1)}.rgba-light-blue-light,.rgba-light-blue-light:after{background-color:rgba(3,169,244,.3)}.rgba-light-blue-strong,.rgba-light-blue-strong:after{background-color:rgba(3,169,244,.7)}.light-blue.darken-1{background-color:#039be5!important}.light-blue.darken-2{background-color:#0288d1!important}.light-blue.darken-3{background-color:#0277bd!important}.light-blue.darken-4{background-color:#01579b!important}.light-blue.accent-1{background-color:#80d8ff!important}.light-blue.accent-2{background-color:#40c4ff!important}.light-blue.accent-3{background-color:#00b0ff!important}.light-blue.accent-4{background-color:#0091ea!important}.cyan.lighten-5{background-color:#e0f7fa!important}.cyan.lighten-4{background-color:#b2ebf2!important}.cyan.lighten-3{background-color:#80deea!important}.cyan.lighten-2{background-color:#4dd0e1!important}.cyan.lighten-1{background-color:#26c6da!important}.cyan{background-color:#00bcd4!important}.cyan-text{color:#00bcd4!important}.rgba-cyan-slight,.rgba-cyan-slight:after{background-color:rgba(0,188,212,.1)}.rgba-cyan-light,.rgba-cyan-light:after{background-color:rgba(0,188,212,.3)}.rgba-cyan-strong,.rgba-cyan-strong:after{background-color:rgba(0,188,212,.7)}.cyan.darken-1{background-color:#00acc1!important}.cyan.darken-2{background-color:#0097a7!important}.cyan.darken-3{background-color:#00838f!important}.cyan.darken-4{background-color:#006064!important}.cyan.accent-1{background-color:#84ffff!important}.cyan.accent-2{background-color:#18ffff!important}.cyan.accent-3{background-color:#00e5ff!important}.cyan.accent-4{background-color:#00b8d4!important}.teal.lighten-5{background-color:#e0f2f1!important}.teal.lighten-4{background-color:#b2dfdb!important}.teal.lighten-3{background-color:#80cbc4!important}.teal.lighten-2{background-color:#4db6ac!important}.teal.lighten-1{background-color:#26a69a!important}.teal{background-color:#009688!important}.teal-text{color:#009688!important}.rgba-teal-slight,.rgba-teal-slight:after{background-color:rgba(0,150,136,.1)}.rgba-teal-light,.rgba-teal-light:after{background-color:rgba(0,150,136,.3)}.rgba-teal-strong,.rgba-teal-strong:after{background-color:rgba(0,150,136,.7)}.teal.darken-1{background-color:#00897b!important}.teal.darken-2{background-color:#00796b!important}.teal.darken-3{background-color:#00695c!important}.teal.darken-4{background-color:#004d40!important}.teal.accent-1{background-color:#a7ffeb!important}.teal.accent-2{background-color:#64ffda!important}.teal.accent-3{background-color:#1de9b6!important}.teal.accent-4{background-color:#00bfa5!important}.green.lighten-5{background-color:#e8f5e9!important}.green.lighten-4{background-color:#c8e6c9!important}.green.lighten-3{background-color:#a5d6a7!important}.green.lighten-2{background-color:#81c784!important}.green.lighten-1{background-color:#66bb6a!important}.green{background-color:#4caf50!important}.green-text{color:#4caf50!important}.rgba-green-slight,.rgba-green-slight:after{background-color:rgba(76,175,80,.1)}.rgba-green-light,.rgba-green-light:after{background-color:rgba(76,175,80,.3)}.rgba-green-strong,.rgba-green-strong:after{background-color:rgba(76,175,80,.7)}.green.darken-1{background-color:#43a047!important}.green.darken-2{background-color:#388e3c!important}.green.darken-3{background-color:#2e7d32!important}.green.darken-4{background-color:#1b5e20!important}.green.accent-1{background-color:#b9f6ca!important}.green.accent-2{background-color:#69f0ae!important}.green.accent-3{background-color:#00e676!important}.green.accent-4{background-color:#00c853!important}.light-green.lighten-5{background-color:#f1f8e9!important}.light-green.lighten-4{background-color:#dcedc8!important}.light-green.lighten-3{background-color:#c5e1a5!important}.light-green.lighten-2{background-color:#aed581!important}.light-green.lighten-1{background-color:#9ccc65!important}.light-green{background-color:#8bc34a!important}.light-green-text{color:#8bc34a!important}.rgba-light-green-slight,.rgba-light-green-slight:after{background-color:rgba(139,195,74,.1)}.rgba-light-green-light,.rgba-light-green-light:after{background-color:rgba(139,195,74,.3)}.rgba-light-green-strong,.rgba-light-green-strong:after{background-color:rgba(139,195,74,.7)}.light-green.darken-1{background-color:#7cb342!important}.light-green.darken-2{background-color:#689f38!important}.light-green.darken-3{background-color:#558b2f!important}.light-green.darken-4{background-color:#33691e!important}.light-green.accent-1{background-color:#ccff90!important}.light-green.accent-2{background-color:#b2ff59!important}.light-green.accent-3{background-color:#76ff03!important}.light-green.accent-4{background-color:#64dd17!important}.lime.lighten-5{background-color:#f9fbe7!important}.lime.lighten-4{background-color:#f0f4c3!important}.lime.lighten-3{background-color:#e6ee9c!important}.lime.lighten-2{background-color:#dce775!important}.lime.lighten-1{background-color:#d4e157!important}.lime{background-color:#cddc39!important}.lime-text{color:#cddc39!important}.rgba-lime-slight,.rgba-lime-slight:after{background-color:rgba(205,220,57,.1)}.rgba-lime-light,.rgba-lime-light:after{background-color:rgba(205,220,57,.3)}.rgba-lime-strong,.rgba-lime-strong:after{background-color:rgba(205,220,57,.7)}.lime.darken-1{background-color:#c0ca33!important}.lime.darken-2{background-color:#afb42b!important}.lime.darken-3{background-color:#9e9d24!important}.lime.darken-4{background-color:#827717!important}.lime.accent-1{background-color:#f4ff81!important}.lime.accent-2{background-color:#eeff41!important}.lime.accent-3{background-color:#c6ff00!important}.lime.accent-4{background-color:#aeea00!important}.yellow.lighten-5{background-color:#fffde7!important}.yellow.lighten-4{background-color:#fff9c4!important}.yellow.lighten-3{background-color:#fff59d!important}.yellow.lighten-2{background-color:#fff176!important}.yellow.lighten-1{background-color:#ffee58!important}.yellow{background-color:#ffeb3b!important}.yellow-text{color:#ffeb3b!important}.rgba-yellow-slight,.rgba-yellow-slight:after{background-color:rgba(255,235,59,.1)}.rgba-yellow-light,.rgba-yellow-light:after{background-color:rgba(255,235,59,.3)}.rgba-yellow-strong,.rgba-yellow-strong:after{background-color:rgba(255,235,59,.7)}.yellow.darken-1{background-color:#fdd835!important}.yellow.darken-2{background-color:#fbc02d!important}.yellow.darken-3{background-color:#f9a825!important}.yellow.darken-4{background-color:#f57f17!important}.yellow.accent-1{background-color:#ffff8d!important}.yellow.accent-2{background-color:#ff0!important}.yellow.accent-3{background-color:#ffea00!important}.yellow.accent-4{background-color:#ffd600!important}.amber.lighten-5{background-color:#fff8e1!important}.amber.lighten-4{background-color:#ffecb3!important}.amber.lighten-3{background-color:#ffe082!important}.amber.lighten-2{background-color:#ffd54f!important}.amber.lighten-1{background-color:#ffca28!important}.amber{background-color:#ffc107!important}.amber-text{color:#ffc107!important}.rgba-amber-slight,.rgba-amber-slight:after{background-color:rgba(255,193,7,.1)}.rgba-amber-light,.rgba-amber-light:after{background-color:rgba(255,193,7,.3)}.rgba-amber-strong,.rgba-amber-strong:after{background-color:rgba(255,193,7,.7)}.amber.darken-1{background-color:#ffb300!important}.amber.darken-2{background-color:#ffa000!important}.amber.darken-3{background-color:#ff8f00!important}.amber.darken-4{background-color:#ff6f00!important}.amber.accent-1{background-color:#ffe57f!important}.amber.accent-2{background-color:#ffd740!important}.amber.accent-3{background-color:#ffc400!important}.amber.accent-4{background-color:#ffab00!important}.orange.lighten-5{background-color:#fff3e0!important}.orange.lighten-4{background-color:#ffe0b2!important}.orange.lighten-3{background-color:#ffcc80!important}.orange.lighten-2{background-color:#ffb74d!important}.orange.lighten-1{background-color:#ffa726!important}.orange{background-color:#ff9800!important}.orange-text{color:#ff9800!important}.rgba-orange-slight,.rgba-orange-slight:after{background-color:rgba(255,152,0,.1)}.rgba-orange-light,.rgba-orange-light:after{background-color:rgba(255,152,0,.3)}.rgba-orange-strong,.rgba-orange-strong:after{background-color:rgba(255,152,0,.7)}.orange.darken-1{background-color:#fb8c00!important}.orange.darken-2{background-color:#f57c00!important}.orange.darken-3{background-color:#ef6c00!important}.orange.darken-4{background-color:#e65100!important}.orange.accent-1{background-color:#ffd180!important}.orange.accent-2{background-color:#ffab40!important}.orange.accent-3{background-color:#ff9100!important}.orange.accent-4{background-color:#ff6d00!important}.deep-orange.lighten-5{background-color:#fbe9e7!important}.deep-orange.lighten-4{background-color:#ffccbc!important}.deep-orange.lighten-3{background-color:#ffab91!important}.deep-orange.lighten-2{background-color:#ff8a65!important}.deep-orange.lighten-1{background-color:#ff7043!important}.deep-orange{background-color:#ff5722!important}.deep-orange-text{color:#ff5722!important}.rgba-deep-orange-slight,.rgba-deep-orange-slight:after{background-color:rgba(255,87,34,.1)}.rgba-deep-orange-light,.rgba-deep-orange-light:after{background-color:rgba(255,87,34,.3)}.rgba-deep-orange-strong,.rgba-deep-orange-strong:after{background-color:rgba(255,87,34,.7)}.deep-orange.darken-1{background-color:#f4511e!important}.deep-orange.darken-2{background-color:#e64a19!important}.deep-orange.darken-3{background-color:#d84315!important}.deep-orange.darken-4{background-color:#bf360c!important}.deep-orange.accent-1{background-color:#ff9e80!important}.deep-orange.accent-2{background-color:#ff6e40!important}.deep-orange.accent-3{background-color:#ff3d00!important}.deep-orange.accent-4{background-color:#dd2c00!important}.brown.lighten-5{background-color:#efebe9!important}.brown.lighten-4{background-color:#d7ccc8!important}.brown.lighten-3{background-color:#bcaaa4!important}.brown.lighten-2{background-color:#a1887f!important}.brown.lighten-1{background-color:#8d6e63!important}.brown{background-color:#795548!important}.brown-text{color:#795548!important}.rgba-brown-slight,.rgba-brown-slight:after{background-color:rgba(121,85,72,.1)}.rgba-brown-light,.rgba-brown-light:after{background-color:rgba(121,85,72,.3)}.rgba-brown-strong,.rgba-brown-strong:after{background-color:rgba(121,85,72,.7)}.brown.darken-1{background-color:#6d4c41!important}.brown.darken-2{background-color:#5d4037!important}.brown.darken-3{background-color:#4e342e!important}.brown.darken-4{background-color:#3e2723!important}.blue-grey.lighten-5{background-color:#eceff1!important}.blue-grey.lighten-4{background-color:#cfd8dc!important}.blue-grey.lighten-3{background-color:#b0bec5!important}.blue-grey.lighten-2{background-color:#90a4ae!important}.blue-grey.lighten-1{background-color:#78909c!important}.blue-grey{background-color:#607d8b!important}.blue-grey-text{color:#607d8b!important}.rgba-blue-grey-slight,.rgba-blue-grey-slight:after{background-color:rgba(96,125,139,.1)}.rgba-blue-grey-light,.rgba-blue-grey-light:after{background-color:rgba(96,125,139,.3)}.rgba-blue-grey-strong,.rgba-blue-grey-strong:after{background-color:rgba(96,125,139,.7)}.blue-grey.darken-1{background-color:#546e7a!important}.blue-grey.darken-2{background-color:#455a64!important}.blue-grey.darken-3{background-color:#37474f!important}.blue-grey.darken-4{background-color:#263238!important}.grey.lighten-5{background-color:#fafafa!important}.grey.lighten-4{background-color:#f5f5f5!important}.grey.lighten-3{background-color:#eee!important}.grey.lighten-2{background-color:#e0e0e0!important}.grey.lighten-1{background-color:#bdbdbd!important}.grey{background-color:#9e9e9e!important}.grey-text{color:#9e9e9e!important}.rgba-grey-slight,.rgba-grey-slight:after{background-color:rgba(158,158,158,.1)}.rgba-grey-light,.rgba-grey-light:after{background-color:rgba(158,158,158,.3)}.rgba-grey-strong,.rgba-grey-strong:after{background-color:rgba(158,158,158,.7)}.grey.darken-1{background-color:#757575!important}.grey.darken-2{background-color:#616161!important}.grey.darken-3{background-color:#424242!important}.grey.darken-4{background-color:#212121!important}.black{background-color:#000!important}.black-text{color:#000!important}.rgba-black-slight,.rgba-black-slight:after{background-color:rgba(0,0,0,.1)}.rgba-black-light,.rgba-black-light:after{background-color:rgba(0,0,0,.3)}.rgba-black-strong,.rgba-black-strong:after{background-color:rgba(0,0,0,.7)}.white{background-color:#fff!important}.white-text{color:#fff!important}.rgba-white-slight,.rgba-white-slight:after{background-color:rgba(255,255,255,.1)}.rgba-white-light,.rgba-white-light:after{background-color:rgba(255,255,255,.3)}.rgba-white-strong,.rgba-white-strong:after{background-color:rgba(255,255,255,.7)}.rgba-stylish-slight{background-color:rgba(62,69,81,.1)}.rgba-stylish-light{background-color:rgba(62,69,81,.3)}.rgba-stylish-strong{background-color:rgba(62,69,81,.7)}.primary-color{background-color:#4285f4!important}.primary-color-dark{background-color:#0d47a1!important}.secondary-color{background-color:#a6c!important}.secondary-color-dark{background-color:#93c!important}.default-color{background-color:#2bbbad!important}.default-color-dark{background-color:#00695c!important}.info-color{background-color:#33b5e5!important}.info-color-dark{background-color:#09c!important}.success-color{background-color:#00c851!important}.success-color-dark{background-color:#007e33!important}.warning-color{background-color:#fb3!important}.warning-color-dark{background-color:#f80!important}.danger-color{background-color:#ff3547!important}.danger-color-dark{background-color:#c00!important}.elegant-color{background-color:#2e2e2e!important}.elegant-color-dark{background-color:#212121!important}.stylish-color{background-color:#4b515d!important}.stylish-color-dark{background-color:#3e4551!important}.unique-color{background-color:#3f729b!important}.unique-color-dark{background-color:#1c2331!important}.special-color{background-color:#37474f!important}.special-color-dark{background-color:#263238!important}.purple-gradient{background:linear-gradient(40deg,#ff6ec4,#7873f5)!important}.peach-gradient{background:linear-gradient(40deg,#ffd86f,#fc6262)!important}.aqua-gradient{background:linear-gradient(40deg,#2096ff,#05ffa3)!important}.blue-gradient{background:linear-gradient(40deg,#45cafc,#303f9f)!important}.purple-gradient-rgba{background:linear-gradient(40deg,rgba(255,110,196,.9),rgba(120,115,245,.9))!important}.peach-gradient-rgba{background:linear-gradient(40deg,rgba(255,216,111,.9),rgba(252,98,98,.9))!important}.aqua-gradient-rgba{background:linear-gradient(40deg,rgba(32,150,255,.9),rgba(5,255,163,.9))!important}.blue-gradient-rgba{background:linear-gradient(40deg,rgba(69,202,252,.9),rgba(48,63,159,.9))!important}.dark-grey-text,.dark-grey-text:focus,.dark-grey-text:hover{color:#4f4f4f!important}.hoverable{box-shadow:none;transition:.55s ease-in-out}.hoverable:hover{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19);transition:.55s ease-in-out}.z-depth-0{box-shadow:none!important}.z-depth-1{box-shadow:0 2px 5px 0 rgba(0,0,0,.16),0 2px 10px 0 rgba(0,0,0,.12)!important}.tooltip-inner,.z-depth-1-half{box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)!important}.z-depth-2{box-shadow:0 8px 17px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)!important}.z-depth-3{box-shadow:0 12px 15px 0 rgba(0,0,0,.24),0 17px 50px 0 rgba(0,0,0,.19)!important}.z-depth-4{box-shadow:0 16px 28px 0 rgba(0,0,0,.22),0 25px 55px 0 rgba(0,0,0,.21)!important}.z-depth-5{box-shadow:0 27px 24px 0 rgba(0,0,0,.2),0 40px 77px 0 rgba(0,0,0,.22)!important}.disabled,:disabled{pointer-events:none!important}a{cursor:pointer;text-decoration:none;color:#0275d8;transition:.2s ease-in-out}a:hover{text-decoration:none;color:#014c8c;transition:.2s ease-in-out}a.disabled:hover,a:disabled:hover{color:#0275d8}a:not([href]):not([tabindex]),a:not([href]):not([tabindex]):focus,a:not([href]):not([tabindex]):hover{color:inherit;text-decoration:none}a .tooltip{position:absolute;z-index:1070;display:block;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-style:normal;font-weight:400;letter-spacing:normal;line-break:auto;line-height:1.5;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;white-space:normal;word-break:normal;word-spacing:normal;font-size:.875rem;word-wrap:break-word;opacity:0}a .tooltip.show{opacity:.9}a .tooltip.bs-tether-element-attached-bottom,a .tooltip.tooltip-top{padding:.8rem 0;margin-top:0}a .tooltip.bs-tether-element-attached-bottom .tooltip-inner::before,a .tooltip.tooltip-top .tooltip-inner::before{bottom:0;left:50%;margin-left:-.8rem;content:\'\';border-width:.8rem .8rem 0}a .tooltip.bs-tether-element-attached-left,a .tooltip.tooltip-right{padding:0 .8rem;margin-left:0}a .tooltip.bs-tether-element-attached-left .tooltip-inner::before,a .tooltip.tooltip-right .tooltip-inner::before{top:50%;left:0;margin-top:-.8rem;content:\'\';border-width:.8rem .8rem .8rem 0}a .tooltip.bs-tether-element-attached-top,a .tooltip.tooltip-bottom{padding:.8rem 0;margin-top:0}a .tooltip.bs-tether-element-attached-top .tooltip-inner::before,a .tooltip.tooltip-bottom .tooltip-inner::before{top:0;left:50%;margin-left:-.8rem;content:\'\';border-width:0 .8rem .8rem}a .tooltip.bs-tether-element-attached-right,a .tooltip.tooltip-left{padding:0 .8rem;margin-left:0}a .tooltip.bs-tether-element-attached-right .tooltip-inner::before,a .tooltip.tooltip-left .tooltip-inner::before{top:50%;right:0;margin-top:-.8rem;content:\'\';border-width:.8rem 0 .8rem .8rem}.tooltip-inner{max-width:200px;padding:.2rem .4rem;text-align:center;border-radius:.25rem}.tooltip-inner::before{position:absolute;width:0;height:0;border-color:transparent;border-style:solid}@-webkit-keyframes fadeInTooltip{from{opacity:0}to{opacity:1}}@keyframes fadeInTooltip{from{opacity:0}to{opacity:1}}.tooltip-fadeIn{-webkit-animation-name:fadeInTooltip;animation-name:fadeInTooltip;-webkit-animation-delay:.2s;animation-delay:.2s;-webkit-animation-duration:.2s;animation-duration:.2s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.single-tooltip{padding:.75rem 0 0}.single-tooltip a{padding:0!important}a[tooltip]{margin-left:0!important;padding:0 .5rem}.tooltip-arrow.left{position:relative;margin-right:-.6rem;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.tooltip-arrow.right{position:relative;margin-left:-.6rem;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.tooltip-arrow.top{position:relative;-webkit-transform:rotate(-180deg);transform:rotate(-180deg)}.tooltip-top{padding:.4rem 0}.tooltip-top .arrow{bottom:0}.tooltip-top .arrow::before{top:0;border-width:.4rem .4rem 0;border-top-color:#000}.tooltip-right{padding:0 .4rem}.tooltip-right .arrow{left:0}.tooltip-right .arrow::before{right:0;border-width:.4rem .4rem .4rem 0;border-right-color:#000}.tooltip-bottom{padding:.4rem 0}.tooltip-bottom .arrow{top:0}.tooltip-bottom .arrow::before{bottom:0;border-width:0 .4rem .4rem;border-bottom-color:#000}.tooltip-left{padding:0 .4rem}.tooltip-left .arrow{right:0}.tooltip-left .arrow::before{left:0;border-width:.4rem 0 .4rem .4rem;border-left-color:#000}'],data:{}});function xg(e){return la(2,[Qo(402653184,1,{tooltipInner:0}),Qo(402653184,2,{tooltipArrow:0}),(e()(),Ho(2,0,[[2,0],["tooltipArrow",1]],null,0,"div",[["class","tooltip-arrow arrow"]],null,null,null,null,null)),(e()(),Ho(3,0,[[1,0],["tooltipInner",1]],null,1,"div",[["class","tooltip-inner"]],null,null,null,null,null)),ea(null,0)],null,null)}function Cg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"mdb-tooltip-container",[],[[8,"className",0],[2,"show",null]],null,null,xg,Eg)),fr(1,4243456,null,0,Dp,[Ip,un],null,null)],null,function(e,t){e(t,0,0,"tooltip-fadeIn tooltip in tooltip-"+er(t,1).placement+" bs-tooltip-"+er(t,1).placement+" "+er(t,1).placement+" "+er(t,1).containerClass,er(t,1).show)})}var Sg=ji("mdb-tooltip-container",Dp,Cg,{containerClass:"containerClass"},{},["*"]),Ag=function(){return function(){}}(),Pg=ti({encapsulation:0,styles:[["a.backwardButton[_ngcontent-%COMP%]{position:fixed;z-index:9}"]],data:{}});function Rg(e){return la(0,[(e()(),Ho(0,0,null,null,7,"a",[["class","backwardButton"],["color","light"],["mdbBtn",""],["mdbWavesEffect",""],["size","sm"]],[[1,"target",0],[8,"href",4]],[[null,"click"]],function(e,t,n){var i=!0;return"click"===t&&(i=!1!==er(e,1).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&i),"click"===t&&(i=!1!==er(e,4).click(n)&&i),i},Vp,Up)),fr(1,671744,null,0,gd,[pd,rh,bs],{routerLink:[0,"routerLink"]},null),na(2,1),fr(3,114688,null,0,cf,[un,gn],{color:[0,"color"],size:[1,"size"]},null),fr(4,16384,null,0,kp,[un],null,null),(e()(),Ho(5,0,null,0,2,"mdb-icon",[["fas",""],["icon","reply"]],null,null,null,ig,ng)),fr(6,114688,null,0,up,[un,gn],{icon:[0,"icon"]},null),fr(7,16384,null,0,hp,[un,gn],null,null)],function(e,t){var n=e(t,2,0,"");e(t,1,0,n),e(t,3,0,"light","sm"),e(t,6,0,"reply")},function(e,t){e(t,0,0,er(t,1).target,er(t,1).href)})}var Mg=function(){return function(){this.images=[{src:"./assets/images/introduction-02.png"},{src:"./assets/images/introduction-03.png"},{src:"./assets/images/introduction-04.png"},{src:"./assets/images/introduction-05.png"},{src:"./assets/images/introduction-06.png"},{src:"./assets/images/introduction-07.png"},{src:"./assets/images/introduction-01.png"}]}}(),Og=ti({encapsulation:0,styles:[[".carousel[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%]   .carousel-item[_ngcontent-%COMP%], .view[_ngcontent-%COMP%], body[_ngcontent-%COMP%], html[_ngcontent-%COMP%], img.d-block[_ngcontent-%COMP%]{height:100vh;width:100vw}"]],data:{}});function wg(e){return la(0,[(e()(),Ho(0,0,null,null,5,"div",[],null,null,null,null,null)),(e()(),Ho(1,0,null,null,4,"mdb-carousel-item",[],[[2,"active",null],[2,"animated",null],[2,"carousel-item-next",null],[2,"carousel-item-left",null],[2,"carousel-item-prev",null],[2,"carousel-item-right",null],[2,"carousel-item",null]],null,null,Zp,qp)),fr(2,245760,[[1,4]],0,gf,[un],null,null),(e()(),Ho(3,0,null,0,2,"div",[["class","view"]],null,null,null,null,null)),(e()(),Ho(4,0,null,null,0,"img",[["alt","\u56fe\u7247\u4ecb\u7ecd"],["class","d-block"]],[[8,"src",4]],null,null,null,null)),(e()(),Ho(5,0,null,null,0,"div",[["class","mask flex-center rgba-black-light"]],null,null,null,null,null))],function(e,t){e(t,2,0)},function(e,t){e(t,1,0,er(t,2).active,er(t,2).animated,er(t,2).directionNext,er(t,2).directionLeft,er(t,2).directionPrev,er(t,2).directionRight,er(t,2).el),e(t,4,0,t.context.$implicit.src)})}function Ig(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-backward",[],null,null,null,Rg,Pg)),fr(1,49152,null,0,Ag,[],null,null),(e()(),Ho(2,0,null,null,4,"mdb-carousel",[],null,[[null,"mouseleave"],[null,"mouseenter"],[null,"keyup"],[null,"click"]],function(e,t,n){var i=!0;return"mouseleave"===t&&(i=!1!==er(e,3).play()&&i),"mouseenter"===t&&(i=!1!==er(e,3).pause()&&i),"keyup"===t&&(i=!1!==er(e,3).keyboardControl(n)&&i),"click"===t&&(i=!1!==er(e,3).focus()&&i),i},Qp,Gp)),fr(3,4374528,null,1,vf,[mf,un,Gr,On,gn],{isControls:[0,"isControls"],animation:[1,"animation"]},null),Qo(603979776,1,{_slidesList:1}),(e()(),jo(16777216,null,0,1,null,wg)),fr(6,278528,null,0,Ns,[Fn,kn,Rn],{ngForOf:[0,"ngForOf"]},null)],function(e,t){var n=t.component;e(t,3,0,!0,"slide"),e(t,6,0,n.images)},null)}function Dg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-introduction",[],null,null,null,Ig,Og)),fr(1,49152,null,0,Mg,[],null,null)],null,null)}var Lg=ji("app-introduction",Mg,Dg,{},{},[]),kg=function(){return function(){this.images=[{src:"./assets/images/location-02.png"},{src:"./assets/images/location-03.png"},{src:"./assets/images/location-04.png"},{src:"./assets/images/location-05.png"},{src:"./assets/images/location-06.png"},{src:"./assets/images/location-07.png"},{src:"./assets/images/location-08.png"},{src:"./assets/images/location-09.png"},{src:"./assets/images/location-10.png"},{src:"./assets/images/location-01.png"}]}}(),Ng=ti({encapsulation:0,styles:[[".carousel[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%], .carousel[_ngcontent-%COMP%]   .carousel-inner[_ngcontent-%COMP%]   .carousel-item[_ngcontent-%COMP%], .view[_ngcontent-%COMP%], body[_ngcontent-%COMP%], html[_ngcontent-%COMP%], img.d-block[_ngcontent-%COMP%]{height:100vh;width:100vw}"]],data:{}});function Fg(e){return la(0,[(e()(),Ho(0,0,null,null,5,"div",[],null,null,null,null,null)),(e()(),Ho(1,0,null,null,4,"mdb-carousel-item",[],[[2,"active",null],[2,"animated",null],[2,"carousel-item-next",null],[2,"carousel-item-left",null],[2,"carousel-item-prev",null],[2,"carousel-item-right",null],[2,"carousel-item",null]],null,null,Zp,qp)),fr(2,245760,[[1,4]],0,gf,[un],null,null),(e()(),Ho(3,0,null,0,2,"div",[["class","view"]],null,null,null,null,null)),(e()(),Ho(4,0,null,null,0,"img",[["alt","\u56fe\u7247\u4ecb\u7ecd"],["class","d-block"]],[[8,"src",4]],null,null,null,null)),(e()(),Ho(5,0,null,null,0,"div",[["class","mask flex-center rgba-black-light"]],null,null,null,null,null))],function(e,t){e(t,2,0)},function(e,t){e(t,1,0,er(t,2).active,er(t,2).animated,er(t,2).directionNext,er(t,2).directionLeft,er(t,2).directionPrev,er(t,2).directionRight,er(t,2).el),e(t,4,0,t.context.$implicit.src)})}function Bg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-backward",[],null,null,null,Rg,Pg)),fr(1,49152,null,0,Ag,[],null,null),(e()(),Ho(2,0,null,null,4,"mdb-carousel",[],null,[[null,"mouseleave"],[null,"mouseenter"],[null,"keyup"],[null,"click"]],function(e,t,n){var i=!0;return"mouseleave"===t&&(i=!1!==er(e,3).play()&&i),"mouseenter"===t&&(i=!1!==er(e,3).pause()&&i),"keyup"===t&&(i=!1!==er(e,3).keyboardControl(n)&&i),"click"===t&&(i=!1!==er(e,3).focus()&&i),i},Qp,Gp)),fr(3,4374528,null,1,vf,[mf,un,Gr,On,gn],{isControls:[0,"isControls"],animation:[1,"animation"]},null),Qo(603979776,1,{_slidesList:1}),(e()(),jo(16777216,null,0,1,null,Fg)),fr(6,278528,null,0,Ns,[Fn,kn,Rn],{ngForOf:[0,"ngForOf"]},null)],function(e,t){var n=t.component;e(t,3,0,!0,"slide"),e(t,6,0,n.images)},null)}function Ug(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-location",[],null,null,null,Bg,Ng)),fr(1,49152,null,0,kg,[],null,null)],null,null)}var Vg=ji("app-location",kg,Ug,{},{},[]),Gg=function(){function e(){}return e.prototype.ngAfterViewInit=function(){},e}(),zg=ti({encapsulation:0,styles:[[""]],data:{}});function jg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-backward",[],null,null,null,Rg,Pg)),fr(1,49152,null,0,Ag,[],null,null),(e()(),Ho(2,0,null,null,1,"h1",[],null,null,null,null,null)),(e()(),oa(-1,null,["Type"]))],null,null)}function Hg(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-type",[],null,null,null,jg,zg)),fr(1,4243456,null,0,Gg,[],null,null)],null,null)}var Wg=ji("app-type",Gg,Hg,{},{},[]),Xg=n("Yzuk"),Yg=function(){return function(e){var t=this;this.GetScene=function(){return t.scene},this.GetCanvas=function(){return t.canvas},this.Animate=function(){t.engine.runRenderLoop(function(){t.scene.render()}),window.addEventListener("resize",function(){t.engine.resize()})},this.canvas=document.getElementById(e),this.engine=new Xg.Engine(this.canvas,!0),this.scene=new Xg.Scene(this.engine),this.light=new Xg.HemisphericLight("BasicLight",new Xg.Vector3(0,1,0),this.scene)}}(),Kg=function(){return function(e,t,n){var i=this;this.SetTarget=function(e){i.camera.setTarget(e)},this.AttachControl=function(e){i.camera.attachControl(e,!0)},this.camera=new Xg.FreeCamera(e,t,n)}}(),Qg=function(){return function(e,t){var n=this;this.GetPosition=function(){return n.camera.position.clone()},this.SetTarget=function(e){n.camera.setTarget(e)},this.AttachControl=function(e){n.camera.attachControl(e,!0)},this.SetRadius=function(e){n.camera.radius=e},this.SetMaxDistance=function(e){n.camera.maxZ=e},this.SetLongitudinalAxis=function(e){n.camera.alpha=e},this.SetLatitudinalAxis=function(e){n.camera.beta=e},this.LimitLongitudinalAxis=function(e,t){n.camera.lowerAlphaLimit=e,n.camera.upperAlphaLimit=t},this.LimitLatitudinalAxis=function(e,t){n.camera.lowerBetaLimit=e,n.camera.upperBetaLimit=t},this.camera=new Xg.ArcRotateCamera(e,0,0,100,Xg.Vector3.Zero(),t)}}(),qg=function(){return function(e){var t=this;this.ImportMesh=function(e,n,i){Xg.SceneLoader.ImportMesh("",e,n,t.scene,i)},this.scene=e}}(),Zg=n("b82y"),Jg=function(){return function(e,t,n){var i=this;this.LookAt=function(e){i.buttonPlane.lookAt(e)},this.ClearWidgets=function(){var e,t;try{for(var n=l(i.widgets),r=n.next();!r.done;r=n.next())r.value.dispose()}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i.buttonPlane.dispose()},this.widgets=new Array,this.buttonPlane=Xg.MeshBuilder.CreatePlane("plane",{size:2e4},t),this.buttonPlane.position=e;var r=Zg.AdvancedDynamicTexture.CreateForMesh(this.buttonPlane),o=new Zg.StackPanel;o.width=1,o.horizontalAlignment=Zg.Control.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(o),this.widgets.push(o);var a=Zg.Button.CreateSimpleButton("but1","1");a.width=.4,a.height="200px",a.color="white",a.fontSize=48,a.background="green",a.onPointerUpObservable.add(n),o.addControl(a),this.widgets.push(a)}}(),$g=function(){function e(){}return e.prototype.ngAfterViewInit=function(){var e=new Yg("renderCanvas"),t=new Qg("MainCamera",e.GetScene());t.AttachControl(e.GetCanvas()),t.LimitLongitudinalAxis(1,1),t.LimitLatitudinalAxis(1.2,1.2),t.SetRadius(12e4),t.SetMaxDistance(3e5),new qg(e.GetScene()).ImportMesh("./assets/meshes/","shapan.babylon",function(n){var i,r,o=function(i){var r=n[i].position.clone();r.y+=15e3;var o=new Jg(r,e.GetScene(),function(){t.LimitLongitudinalAxis(null,null),t.SetTarget(r),t.SetRadius(4e4)});e.GetScene().registerBeforeRender(function(){var e=new Xg.Vector3;e.x=t.GetPosition().x,e.z=t.GetPosition().z,e.y=r.y,o.LookAt(e)})};try{for(var a=l([30,41,58]),s=a.next();!s.done;s=a.next())o(s.value)}catch(c){i={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}),e.Animate()},e}(),em=ti({encapsulation:0,styles:[["#renderCanvas[_ngcontent-%COMP%]{width:100%;height:100%;touch-action:none}"]],data:{}});function tm(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-backward",[],null,null,null,Rg,Pg)),fr(1,49152,null,0,Ag,[],null,null),(e()(),Ho(2,0,null,null,0,"canvas",[["id","renderCanvas"]],null,null,null,null,null))],null,null)}function nm(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-sandbox",[],null,null,null,tm,em)),fr(1,4243456,null,0,$g,[],null,null)],null,null)}var im=ji("app-sandbox",$g,nm,{},{},[]),rm=n("vgmO"),om=n.n(rm),am=n("7zRj"),sm=n.n(am),lm=n("G43f"),cm=n.n(lm),um=n("jBAH"),hm=n.n(um),dm=n("3zPy"),fm=n.n(dm),pm=n("7sdD"),gm=n.n(pm),mm=n("K4wu"),_m=n.n(mm),vm=n("0Tbm"),bm=n.n(vm);function ym(){return(ym=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function Tm(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function Em(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var xm=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t,n,i,r=this.listeners[e];if(r)if(2===arguments.length)for(n=r.length,t=0;t<n;++t)r[t].call(this,arguments[1]);else for(i=Array.prototype.slice.call(arguments,1),n=r.length,t=0;t<n;++t)r[t].apply(this,i)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),Cm=function(e){function t(){var t;return(t=e.call(this)||this).buffer="",t}return Tm(t,e),t.prototype.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(xm),Sm=function(e){for(var t,n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},r=n.length;r--;)""!==n[r]&&((t=/([^=]*)=(.*)/.exec(n[r]).slice(1))[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),i[t[0]]=t[1]);return i},Am=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}Tm(t,e);var n=t.prototype;return n.push=function(e){var t,n,i=this;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(function(t,n){var i=n(e);return i===e?t:t.concat([i])},[e]).forEach(function(e){for(var r=0;r<i.customParsers.length;r++)if(i.customParsers[r].call(i,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e))return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void i.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"totalduration"},t[1]&&(n.duration=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e))return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void i.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e))return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void i.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e))return n={type:"tag",tagType:"byterange"},t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),void i.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e))return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-MAP:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"map"},t[1]){var o=Sm(t[1]);if(o.URI&&(n.uri=o.URI),o.BYTERANGE){var a=o.BYTERANGE.split("@"),s=a[0],l=a[1];n.byterange={},s&&(n.byterange.length=parseInt(s,10)),l&&(n.byterange.offset=parseInt(l,10))}}i.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e)){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=Sm(t[1]),n.attributes.RESOLUTION){var c=n.attributes.RESOLUTION.split("x"),u={};c[0]&&(u.width=parseInt(c[0],10)),c[1]&&(u.height=parseInt(c[1],10)),n.attributes.RESOLUTION=u}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}i.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:?(.*)$/.exec(e))return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=Sm(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e))i.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e))return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void i.trigger("data",n);if(t=/^#EXT-X-KEY:?(.*)$/.exec(e))return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=Sm(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void i.trigger("data",n);if(t=/^#EXT-X-START:?(.*)$/.exec(e))return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=Sm(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void i.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out-cont"}).data=t[1]?t[1]:"",void i.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-out"}).data=t[1]?t[1]:"",void i.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e))return(n={type:"tag",tagType:"cue-in"}).data=t[1]?t[1]:"",void i.trigger("data",n);i.trigger("data",{type:"tag",data:e.slice(4)})}}}else i.trigger("data",{type:"comment",text:e.slice(1)})}):this.trigger("data",{type:"uri",uri:e}))},n.addParser=function(e){var t=this,n=e.expression,i=e.customType,r=e.dataParser,o=e.segment;"function"!=typeof r&&(r=function(e){return e}),this.customParsers.push(function(e){if(n.exec(e))return t.trigger("data",{type:"custom",data:r(e),customType:i,segment:o}),!0})},n.addTagMapper=function(e){var t=e.expression,n=e.map;this.tagMappers.push(function(e){return t.test(e)?n(e):e})},t}(xm),Pm=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new Cm,t.parseStream=new Am,t.lineStream.pipe(t.parseStream);var n,i,r=Em(Em(t)),o=[],a={},s={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},l=0;return t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},t.parseStream.on("data",function(e){var t,c;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(a.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(a.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(a.duration=e.duration),0===e.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=o},key:function(){e.attributes?"NONE"!==e.attributes.METHOD?e.attributes.URI?(e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(i.iv=e.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):i=null:this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,l=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){n={},e.uri&&(n.uri=e.uri),e.byterange&&(n.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=o,this.manifest.mediaGroups=this.manifest.mediaGroups||s,e.attributes?(a.attributes||(a.attributes={}),ym(a.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||s,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(c={default:/yes/i.test(e.attributes.DEFAULT)}).autoselect=!!c.default||/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(c.language=e.attributes.LANGUAGE),e.attributes.URI&&(c.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(c.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(c.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(c.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=c}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){l+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(o.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),a.dateTimeString=e.dateTimeString,a.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=e.data},"cue-out-cont":function(){a.cueOutCont=e.data},"cue-in":function(){a.cueIn=e.data}}[e.tagType]||function(){}).call(r)},uri:function(){a.uri=e.uri,o.push(a),!this.manifest.targetDuration||"duration"in a||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),i&&(a.key=i),a.timeline=l,n&&(a.map=n),a={}},comment:function(){},custom:function(){e.segment?(a.custom=a.custom||{},a.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(r)}),t}Tm(t,e);var n=t.prototype;return n.push=function(e){this.lineStream.push(e)},n.end=function(){this.lineStream.push("\n")},n.addParser=function(e){this.parseStream.addParser(e)},n.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(xm),Rm=function(e){return!!e&&"object"==typeof e},Mm=function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.reduce(function(t,n){return Object.keys(n).forEach(function(i){t[i]=Array.isArray(t[i])&&Array.isArray(n[i])?t[i].concat(n[i]):Rm(t[i])&&Rm(n[i])?e(t[i],n[i]):n[i]}),t},{})},Om=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},wm=function(e){if(!e.length)return[];for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Im=function(e,t){return function(e,t){var n,i,r,o,a;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,e.exports=a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):t;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var c={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(c.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var u=s.path,h=u.substring(0,u.lastIndexOf("/")+1)+o.path;c.path=a.normalizePath(h)}else c.path=s.path,o.params||(c.params=s.params,o.query||(c.query=s.query));return null===c.path&&(c.path=n.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(c)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(r,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}}}(t={exports:{}}),t.exports}(),Dm=function(e,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=Im.buildAbsoluteURL(om.a.location.href,e)),Im.buildAbsoluteURL(e,t))},Lm=function(e){var t=e.baseUrl,n=e.source,i=void 0===n?"":n,r=e.range,o=void 0===r?"":r,a=e.indexRange,s=void 0===a?"":a,l={uri:i,resolvedUri:Dm((void 0===t?"":t)||"",i)};if(o||s){var c=(o||s).split("-"),u=parseInt(c[0],10),h=parseInt(c[1],10);l.byterange={length:h-u+1,offset:u}}return l},km={static:function(e){var t=e.timescale;return{start:0,end:Math.ceil(e.sourceDuration/(e.duration/(void 0===t?1:t)))}},dynamic:function(e){var t=e.timescale,n=void 0===t?1:t,i=e.duration,r=e.start,o=e.minimumUpdatePeriod,a=e.timeShiftBufferDepth,s=void 0===a?1/0:a,l=(e.NOW+e.clientOffset)/1e3,c=e.availabilityStartTime+(void 0===r?0:r),u=Math.ceil((l+(void 0===o?0:o)-c)*n/i),h=Math.floor((l-c-s)*n/i),d=Math.floor((l-c)*n/i);return{start:Math.max(0,h),end:Math.min(u,d)}}},Nm=function(e){var t=e.type,n=void 0===t?"static":t,i=e.duration,r=e.timescale,o=void 0===r?1:r,a=e.sourceDuration,s=km[n](e),l=function(e,t){for(var n=[],i=s.start;i<t;i++)n.push(i);return n}(0,s.end).map(function(e){return function(t,n){var i=e.duration,r=e.timescale,o=e.startNumber;return{number:(void 0===o?1:o)+t,duration:i/(void 0===r?1:r),timeline:e.periodIndex,time:n*i}}}(e));if("static"===n){var c=l.length-1;l[c].duration=a-i/o*c}return l},Fm=function(e){var t=e.baseUrl,n=e.initialization,i=void 0===n?{}:n,r=e.sourceDuration,o=e.timescale,a=void 0===o?1:o,s=e.indexRange,l=void 0===s?"":s,c=e.duration;if(!t)throw new Error("NO_BASE_URL");var u=Lm({baseUrl:t,source:i.sourceURL,range:i.range}),h=Lm({baseUrl:t,source:t,indexRange:l});if(h.map=u,c){var d=Nm(e);d.length&&(h.duration=d[0].duration,h.timeline=d[0].timeline)}else r&&(h.duration=r/a,h.timeline=0);return h.number=0,[h]},Bm=function(e,t,n){for(var i=e.sidx.map?e.sidx.map:null,r=e.sidx.duration,o=e.timeline||0,a=e.sidx.byterange,s=a.offset+a.length,l=t.timescale,c=t.references.filter(function(e){return 1!==e.referenceType}),u=[],h=s+t.firstOffset,d=0;d<c.length;d++){var f=t.references[d],p=f.referencedSize,g=Fm({baseUrl:n,timescale:l,timeline:o,periodIndex:o,duration:f.subsegmentDuration,sourceDuration:r,indexRange:h+"-"+(h+p-1)})[0];i&&(g.map=i),u.push(g),h+=p}return e.segments=u,e},Um=function(e){var t;return(t=e.reduce(function(e,t){var n,i=t.attributes.id+(t.attributes.lang||"");return e[i]?(t.segments[0]&&(t.segments[0].discontinuity=!0),(n=e[i].segments).push.apply(n,t.segments),t.attributes.contentProtection&&(e[i].attributes.contentProtection=t.attributes.contentProtection)):e[i]=t,e},{}),Object.keys(t).map(function(e){return t[e]})).map(function(e){return e.discontinuityStarts=e.segments.reduce(function(e,t,n){return t.discontinuity&&e.push(n),e},[]),e})},Vm=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var n in e){var i=e[n];if(i.sidx){var r=i.sidx.uri+"-"+(a=i.sidx.byterange).offset+"-"+(a.offset+a.length-1),o=t[r]&&t[r].sidx;i.sidx&&o&&Bm(i,o,i.sidx.resolvedUri)}}var a;return e},Gm=function(e){var t,n=e.attributes,i=e.segments,r=e.sidx,o={attributes:(t={NAME:n.id,BANDWIDTH:n.bandwidth,CODECS:n.codecs},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(n.type||"static"),timeline:n.periodIndex,resolvedUri:"",targetDuration:n.duration,segments:i,mediaSequence:i.length?i[0].number:1};return n.contentProtection&&(o.contentProtection=n.contentProtection),r&&(o.sidx=r),o},zm=function(e){var t,n=e.attributes,i=e.segments,r=e.sidx,o={attributes:(t={NAME:n.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:n.width,height:n.height},CODECS:n.codecs,BANDWIDTH:n.bandwidth},t["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(n.type||"static"),timeline:n.periodIndex,resolvedUri:"",targetDuration:n.duration,segments:i,mediaSequence:i.length?i[0].number:1};return n.contentProtection&&(o.contentProtection=n.contentProtection),r&&(o.sidx=r),o},jm=function(e,t,n){var i=e.timescale,r=e.start,o=e.minimumUpdatePeriod;return Math.ceil((((e.NOW+e.clientOffset)/1e3+(void 0===o?0:o)-(e.availabilityStartTime+(void 0===r?0:r)))*(void 0===i?1:i)-t)/n)},Hm=function(e,t){for(var n=e.type,i=void 0===n?"static":n,r=e.minimumUpdatePeriod,o=void 0===r?0:r,a=e.media,s=void 0===a?"":a,l=e.sourceDuration,c=e.timescale,u=void 0===c?1:c,h=e.startNumber,d=void 0===h?1:h,f=e.periodIndex,p=[],g=-1,m=0;m<t.length;m++){var _=t[m],v=_.d,b=_.r||0,y=_.t||0;g<0&&(g=y),y&&y>g&&(g=y);var T=void 0;if(b<0){var E=m+1;T=E===t.length?"dynamic"===i&&o>0&&s.indexOf("$Number$")>0?jm(e,g,v):(l*u-g)/v:(t[E].t-g)/v}else T=b+1;for(var x=d+p.length+T,C=d+p.length;C<x;)p.push({number:C,duration:v/u,time:g,timeline:f}),g+=v,C++}return p},Wm=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Xm=function(e,t){return e.replace(Wm,function(e){return function(t,n,i,r){if("$$"===t)return"$";if(void 0===e[n])return t;var o=""+e[n];return"RepresentationID"===n?o:(r=i?parseInt(r,10):1,o.length>=r?o:""+new Array(r-o.length+1).join("0")+o)}}(t))},Ym=function(e,t){var n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},i=e.initialization,r=void 0===i?{sourceURL:"",range:""}:i,o=Lm({baseUrl:e.baseUrl,source:Xm(r.sourceURL,n),range:r.range});return function(e,t){return e.duration||t?e.duration?Nm(e):Hm(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodIndex}]}(e,t).map(function(t){n.Number=t.number,n.Time=t.time;var i=Xm(e.media||"",n);return{uri:i,timeline:t.timeline,duration:t.duration,resolvedUri:Dm(e.baseUrl||"",i),map:o,number:t.number}})},Km=function(e,t){var n=e.duration,i=e.segmentUrls,r=void 0===i?[]:i;if(!n&&!t||n&&t)throw new Error("SEGMENT_TIME_UNSPECIFIED");var o,a=r.map(function(t){return function(e,t){var n=e.baseUrl,i=e.initialization,r=void 0===i?{}:i,o=Lm({baseUrl:n,source:r.sourceURL,range:r.range}),a=Lm({baseUrl:n,source:t.media,range:t.mediaRange});return a.map=o,a}(e,t)});return n&&(o=Nm(e)),t&&(o=Hm(e,t)),o.map(function(e,t){if(a[t]){var n=a[t];return n.timeline=e.timeline,n.duration=e.duration,n.number=e.number,n}}).filter(function(e){return e})},Qm=function(e){var t,n,i=e.attributes,r=e.segmentInfo;r.template?(n=Ym,t=Mm(i,r.template)):r.base?(n=Fm,t=Mm(i,r.base)):r.list&&(n=Km,t=Mm(i,r.list));var o={attributes:i};if(!n)return o;var a=n(t,r.timeline);if(t.duration){var s=t.timescale;t.duration=t.duration/(void 0===s?1:s)}else t.duration=a.length?a.reduce(function(e,t){return Math.max(e,Math.ceil(t.duration))},0):0;return o.attributes=t,o.segments=a,r.base&&t.indexRange&&(o.sidx=a[0],o.segments=[]),o},qm=function(e,t){return wm(e.childNodes).filter(function(e){return e.tagName===t})},Zm=function(e){return e.textContent.trim()},Jm=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(e);if(!t)return 0;var n=t.slice(1),i=n[1],r=n[2],o=n[3],a=n[4],s=n[5];return 31536e3*parseFloat(n[0]||0)+2592e3*parseFloat(i||0)+86400*parseFloat(r||0)+3600*parseFloat(o||0)+60*parseFloat(a||0)+parseFloat(s||0)},$m={mediaPresentationDuration:function(e){return Jm(e)},availabilityStartTime:function(e){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=e)&&(t+="Z"),Date.parse(t)/1e3;var t},minimumUpdatePeriod:function(e){return Jm(e)},timeShiftBufferDepth:function(e){return Jm(e)},start:function(e){return Jm(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?Jm(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},e_=function(e){return e&&e.attributes?wm(e.attributes).reduce(function(e,t){return e[t.name]=($m[t.name]||$m.DEFAULT)(t.value),e},{}):{}},t_={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},n_=function(e,t){return t.length?Om(e.map(function(e){return t.map(function(t){return Dm(e,Zm(t))})})):e},i_=function(e){var t=qm(e,"SegmentTemplate")[0],n=qm(e,"SegmentList")[0],i=n&&qm(n,"SegmentURL").map(function(e){return Mm({tag:"SegmentURL"},e_(e))}),r=qm(e,"SegmentBase")[0],o=n||t,a=o&&qm(o,"SegmentTimeline")[0],s=n||r||t,l=s&&qm(s,"Initialization")[0],c=t&&e_(t);c&&l?c.initialization=l&&e_(l):c&&c.initialization&&(c.initialization={sourceURL:c.initialization});var u={template:c,timeline:a&&qm(a,"S").map(function(e){return e_(e)}),list:n&&Mm(e_(n),{segmentUrls:i,initialization:e_(l)}),base:r&&Mm(e_(r),{initialization:e_(l)})};return Object.keys(u).forEach(function(e){u[e]||delete u[e]}),u},r_=function(e){if(""===e)throw new Error("DASH_EMPTY_MANIFEST");var t=(new om.a.DOMParser).parseFromString(e,"application/xml"),n=t&&"MPD"===t.documentElement.tagName?t.documentElement:null;if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error("DASH_INVALID_XML");return n},o_=function(e,t){return void 0===t&&(t={}),function(e,t){var n;if(void 0===t&&(t={}),!e.length)return{};var i=e[0].attributes,r=i.sourceDuration,o=i.minimumUpdatePeriod,a=void 0===o?0:o,s=Um(e.filter(function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video"===t.contentType})).map(zm),l=Um(e.filter(function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio"===t.contentType})),c=e.filter(function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType}),u={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(n={AUDIO:{},VIDEO:{}},n["CLOSED-CAPTIONS"]={},n.SUBTITLES={},n),uri:"",duration:r,playlists:Vm(s,t),minimumUpdatePeriod:1e3*a};return l.length&&(u.mediaGroups.AUDIO.audio=function(e,t){var n;void 0===t&&(t={});var i=l.reduce(function(e,i){var r=i.attributes.role&&i.attributes.role.value||"",o=i.attributes.lang||"",a="main";return o&&(a=i.attributes.lang+(r?" ("+r+")":"")),e[a]&&e[a].playlists[0].attributes.BANDWIDTH>i.attributes.bandwidth?e:(e[a]={language:o,autoselect:!0,default:"main"===r,playlists:Vm([Gm(i)],t),uri:""},void 0===n&&"main"===r&&((n=i).default=!0),e)},{});return n||(i[Object.keys(i)[0]].default=!0),i}(0,t)),c.length&&(u.mediaGroups.SUBTITLES.subs=function(e,t){return void 0===t&&(t={}),c.reduce(function(e,n){var i,r,o,a,s=n.attributes.lang||"text";return e[s]?e:(e[s]={language:s,default:!1,autoselect:!1,playlists:Vm([(i=n,o=i.attributes,a=i.segments,void 0===a&&(a=[{uri:o.baseUrl,timeline:o.periodIndex,resolvedUri:o.baseUrl||"",duration:o.sourceDuration,number:0}],o.duration=o.sourceDuration),{attributes:(r={NAME:o.id,BANDWIDTH:o.bandwidth},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===(o.type||"static"),timeline:o.periodIndex,resolvedUri:o.baseUrl||"",targetDuration:o.duration,segments:a,mediaSequence:a.length?a[0].number:1})],t),uri:""},e)},{})}(0,t)),u}(function(e,t){void 0===t&&(t={});var n=t,i=n.manifestUri,r=void 0===i?"":i,o=n.NOW,a=void 0===o?Date.now():o,s=n.clientOffset,l=void 0===s?0:s,c=qm(e,"Period");if(!c.length)throw new Error("INVALID_NUMBER_OF_PERIOD");var u=e_(e),h=n_([r],qm(e,"BaseURL"));return u.sourceDuration=u.mediaPresentationDuration||0,u.NOW=a,u.clientOffset=l,Om(c.map(function(e,t){return function(n,i){var r=n_(t,qm(n,"BaseURL")),o=e_(n),a=parseInt(o.id,10),s=om.a.isNaN(a)?i:a,l=Mm(e,{periodIndex:s}),c=qm(n,"AdaptationSet"),u=i_(n);return Om(c.map(function(e,t,n){return function(i){var r=e_(i),o=n_(t,qm(i,"BaseURL")),a=qm(i,"Role")[0],s={role:e_(a)},l=Mm(e,r,s),c=qm(i,"ContentProtection").reduce(function(e,t){var n=e_(t),i=t_[n.schemeIdUri];if(i){e[i]={attributes:n};var r=qm(t,"cenc:pssh")[0];if(r){var o=Zm(r),a=o&&function(e){for(var t=om.a.atob(o),n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}();e[i].pssh=a}}return e},{});Object.keys(c).length&&(l=Mm(l,{contentProtection:c}));var u=i_(i),h=qm(i,"Representation"),d=Mm(n,u);return Om(h.map(function(e,t,n){return function(i){var r=qm(i,"BaseURL"),o=n_(t,r),a=Mm(e,e_(i)),s=i_(i);return o.map(function(e){return{segmentInfo:Mm(n,s),attributes:Mm(a,{baseUrl:e})}})}}(l,o,d)))}}(l,r,u)))}}(u,h)))}(r_(e),t).map(Qm),t.sidxMapping)},a_=n("mvqA"),s_=n.n(a_),l_=n("KAYj"),c_=n.n(l_),u_=n("KOUu"),h_=n("3D7k"),d_=n.n(h_),f_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p_=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},m_=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],i=t[4],r=n[4],o=void 0,a=void 0,s=void 0,l=[],c=[],u=void 0,h=void 0,d=void 0,f=void 0,p=void 0;for(o=0;o<256;o++)c[(l[o]=o<<1^283*(o>>7))^o]=o;for(a=s=0;!i[a];a^=u||1,s=c[s]||1)for(i[a]=d=(d=s^s<<1^s<<2^s<<3^s<<4)>>8^255&d^99,r[d]=a,p=16843009*l[h=l[u=l[a]]]^65537*h^257*u^16843008*a,f=257*l[d]^16843008*d,o=0;o<4;o++)t[o][a]=f=f<<24^f>>>8,n[o][d]=p=p<<24^p>>>8;for(o=0;o<5;o++)t[o]=t[o].slice(0),n[o]=n[o].slice(0);return e},__=null,v_=function(){function e(t){f_(this,e),__||(__=m_()),this._tables=[[__[0][0].slice(),__[0][1].slice(),__[0][2].slice(),__[0][3].slice(),__[0][4].slice()],[__[1][0].slice(),__[1][1].slice(),__[1][2].slice(),__[1][3].slice(),__[1][4].slice()]];var n=void 0,i=void 0,r=void 0,o=void 0,a=void 0,s=this._tables[0][4],l=this._tables[1],c=t.length,u=1;if(4!==c&&6!==c&&8!==c)throw new Error("Invalid aes key size");for(o=t.slice(0),this._key=[o,a=[]],n=c;n<4*c+28;n++)r=o[n-1],(n%c==0||8===c&&n%c==4)&&(r=s[r>>>24]<<24^s[r>>16&255]<<16^s[r>>8&255]<<8^s[255&r],n%c==0&&(r=r<<8^r>>>24^u<<24,u=u<<1^283*(u>>7))),o[n]=o[n-c]^r;for(i=0;n;i++,n--)r=o[3&i?n:n-4],a[i]=n<=4||i<4?r:l[0][s[r>>>24]]^l[1][s[r>>16&255]]^l[2][s[r>>8&255]]^l[3][s[255&r]]}return e.prototype.decrypt=function(e,t,n,i,r,o){var a=this._key[1],s=e^a[0],l=i^a[1],c=n^a[2],u=t^a[3],h=void 0,d=void 0,f=void 0,p=a.length/4-2,g=void 0,m=4,_=this._tables[1],v=_[0],b=_[1],y=_[2],T=_[3],E=_[4];for(g=0;g<p;g++)h=v[s>>>24]^b[l>>16&255]^y[c>>8&255]^T[255&u]^a[m],d=v[l>>>24]^b[c>>16&255]^y[u>>8&255]^T[255&s]^a[m+1],f=v[c>>>24]^b[u>>16&255]^y[s>>8&255]^T[255&l]^a[m+2],u=v[u>>>24]^b[s>>16&255]^y[l>>8&255]^T[255&c]^a[m+3],m+=4,s=h,l=d,c=f;for(g=0;g<4;g++)r[(3&-g)+o]=E[s>>>24]<<24^E[l>>16&255]<<16^E[c>>8&255]<<8^E[255&u]^a[m++],h=s,s=l,l=c,c=u,u=h},e}(),b_=function(){function e(){f_(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1},e.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),o=t.length,a=0;a<o;++a)t[a].apply(this,r)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),y_=function(e){function t(){f_(this,t);var n=g_(this,e.call(this,b_));return n.jobs=[],n.delay=1,n.timeout_=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},t.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(b_),T_=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},E_=function(e,t,n){var i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),r=new v_(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),a=new Int32Array(o.buffer),s=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0,g=void 0;for(s=n[0],l=n[1],c=n[2],u=n[3],g=0;g<i.length;g+=4)h=T_(i[g]),d=T_(i[g+1]),f=T_(i[g+2]),p=T_(i[g+3]),r.decrypt(h,d,f,p,a,g),a[g]=T_(a[g]^s),a[g+1]=T_(a[g+1]^l),a[g+2]=T_(a[g+2]^c),a[g+3]=T_(a[g+3]^u),s=h,l=d,c=f,u=p;return o},x_=function(){function e(t,n,i,r){f_(this,e);var o=e.STEP,a=new Int32Array(t.buffer),s=new Uint8Array(t.byteLength),l=0;for(this.asyncStream_=new y_,this.asyncStream_.push(this.decryptChunk_(a.subarray(l,l+o),n,i,s)),l=o;l<a.length;l+=o)i=new Uint32Array([T_(a[l-4]),T_(a[l-3]),T_(a[l-2]),T_(a[l-1])]),this.asyncStream_.push(this.decryptChunk_(a.subarray(l,l+o),n,i,s));this.asyncStream_.push(function(){var e;r(null,(e=s).subarray(0,e.byteLength-e[e.byteLength-1]))})}return e.prototype.decryptChunk_=function(e,t,n,i){return function(){var r=E_(e,t,n);i.set(r,e.byteOffset)}},p_(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}(),C_="7.6.0";function S_(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function A_(e,t){return(A_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P_(e,t,n){return(P_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&A_(r,n.prototype),r}).apply(null,arguments)}function R_(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M_(e,t){return t||(t=e.slice(0)),e.raw=t,e}var O_=[],w_=function e(t){var n,i="info",r=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n("log",i,t)};return n=function(e,t){return function(n,i,r){var o=t.levels[i],a=new RegExp("^("+o+")$");if("log"!==n&&r.unshift(n.toUpperCase()+":"),r.unshift(e+":"),O_&&O_.push([].concat(r)),om.a.console){var s=om.a.console[n];s||"debug"!==n||(s=om.a.console.info||om.a.console.log),s&&o&&a.test(n)&&s[Array.isArray(r)?"apply":"call"](om.a.console,r)}}}(t,r),r.createLogger=function(n){return e(t+": "+n)},r.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:i},r.level=function(e){if("string"==typeof e){if(!r.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');i=e}return i},(r.history=function(){return O_?[].concat(O_):[]}).filter=function(e){return(O_||[]).filter(function(t){return new RegExp(".*"+e+".*").test(t[0])})},r.history.clear=function(){O_&&(O_.length=0)},r.history.disable=function(){null!==O_&&(O_.length=0,O_=null)},r.history.enable=function(){null===O_&&(O_=[])},r.error=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n("error",i,t)},r.warn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n("warn",i,t)},r.debug=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n("debug",i,t)},r}("VIDEOJS"),I_=w_.createLogger,D_=Object.prototype.toString,L_=function(e){return F_(e)?Object.keys(e):[]};function k_(e,t){L_(e).forEach(function(n){return t(e[n],n)})}function N_(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Object.assign?Object.assign.apply(Object,[e].concat(n)):(n.forEach(function(t){t&&k_(t,function(t,n){e[n]=t})}),e)}function F_(e){return!!e&&"object"==typeof e}function B_(e){return F_(e)&&"[object Object]"===D_.call(e)&&e.constructor===Object}function U_(e,t){if(!e||!t)return"";if("function"==typeof om.a.getComputedStyle){var n=om.a.getComputedStyle(e);return n?n[t]:""}return""}function V_(){var e=M_(["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."]);return V_=function(){return e},e}function G_(e){return"string"==typeof e&&/\S/.test(e)}function z_(e){if(/\s/.test(e))throw new Error("class has illegal whitespace characters")}function j_(){return sm.a===om.a.document}function H_(e){return F_(e)&&1===e.nodeType}function W_(){try{return om.a.parent!==om.a.self}catch(e){return!0}}function X_(e){return function(t,n){if(!G_(t))return sm.a[e](null);G_(n)&&(n=sm.a.querySelector(n));var i=H_(n)?n:sm.a;return i[e]&&i[e](t)}}function Y_(e,t,n,i){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===n&&(n={});var r=sm.a.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?(w_.warn(cm()(V_(),e,n)),r.setAttribute(e,n)):"textContent"===e?K_(r,n):r[e]=n}),Object.getOwnPropertyNames(n).forEach(function(e){r.setAttribute(e,n[e])}),i&&fv(r,i),r}function K_(e,t){return void 0===e.textContent?e.innerText=t:e.textContent=t,e}function Q_(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function q_(e,t){return z_(t),e.classList?e.classList.contains(t):(n=t,new RegExp("(^|\\s)"+n+"($|\\s)")).test(e.className);var n}function Z_(e,t){return e.classList?e.classList.add(t):q_(e,t)||(e.className=(e.className+" "+t).trim()),e}function J_(e,t){return e.classList?e.classList.remove(t):(z_(t),e.className=e.className.split(/\s+/).filter(function(e){return e!==t}).join(" ")),e}function $_(e,t,n){var i=q_(e,t);if("function"==typeof n&&(n=n(e,t)),"boolean"!=typeof n&&(n=!i),n!==i)return n?Z_(e,t):J_(e,t),e}function ev(e,t){Object.getOwnPropertyNames(t).forEach(function(n){var i=t[n];null==i||!1===i?e.removeAttribute(n):e.setAttribute(n,!0===i?"":i)})}function tv(e){var t={};if(e&&e.attributes&&e.attributes.length>0)for(var n=e.attributes,i=n.length-1;i>=0;i--){var r=n[i].name,o=n[i].value;"boolean"!=typeof e[r]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+r+",")||(o=null!==o),t[r]=o}return t}function nv(e,t){return e.getAttribute(t)}function iv(e,t,n){e.setAttribute(t,n)}function rv(e,t){e.removeAttribute(t)}function ov(){sm.a.body.focus(),sm.a.onselectstart=function(){return!1}}function av(){sm.a.onselectstart=function(){return!0}}function sv(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n.height||(n.height=parseFloat(U_(e,"height"))),n.width||(n.width=parseFloat(U_(e,"width"))),n}}function lv(e){var t;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var n=sm.a.documentElement,i=sm.a.body,r=t.top+(om.a.pageYOffset||i.scrollTop)-(n.clientTop||i.clientTop||0);return{left:Math.round(t.left+(om.a.pageXOffset||i.scrollLeft)-(n.clientLeft||i.clientLeft||0)),top:Math.round(r)}}function cv(e,t){var n={},i=lv(e),r=e.offsetWidth,o=e.offsetHeight,a=i.left,s=t.pageY,l=t.pageX;return t.changedTouches&&(l=t.changedTouches[0].pageX,s=t.changedTouches[0].pageY),n.y=Math.max(0,Math.min(1,(i.top-s+o)/o)),n.x=Math.max(0,Math.min(1,(l-a)/r)),n}function uv(e){return F_(e)&&3===e.nodeType}function hv(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function dv(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(function(e){return"function"==typeof e&&(e=e()),H_(e)||uv(e)?e:"string"==typeof e&&/\S/.test(e)?sm.a.createTextNode(e):void 0}).filter(function(e){return e})}function fv(e,t){return dv(t).forEach(function(t){return e.appendChild(t)}),e}function pv(e,t){return fv(hv(e),t)}function gv(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||0===e.button&&0===e.buttons||0===e.button&&1===e.buttons}var mv=X_("querySelector"),_v=X_("querySelectorAll"),vv=Object.freeze({isReal:j_,isEl:H_,isInFrame:W_,createEl:Y_,textContent:K_,prependTo:Q_,hasClass:q_,addClass:Z_,removeClass:J_,toggleClass:$_,setAttributes:ev,getAttributes:tv,getAttribute:nv,setAttribute:iv,removeAttribute:rv,blockTextSelection:ov,unblockTextSelection:av,getBoundingClientRect:sv,findPosition:lv,getPointerPosition:cv,isTextNode:uv,emptyEl:hv,normalizeContent:dv,appendContent:fv,insertContent:pv,isSingleLeftClick:gv,$:mv,$$:_v}),bv=1;function yv(){return bv++}var Tv={},Ev="vdata"+Math.floor(om.a.performance&&om.a.performance.now()||Date.now());function xv(e){var t=e[Ev];return t||(t=e[Ev]=yv()),Tv[t]||(Tv[t]={}),Tv[t]}function Cv(e){var t=e[Ev];return!!t&&!!Object.getOwnPropertyNames(Tv[t]).length}function Sv(e){var t=e[Ev];if(t){delete Tv[t];try{delete e[Ev]}catch(n){e.removeAttribute?e.removeAttribute(Ev):e[Ev]=null}}}function Av(e,t){var n=xv(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&Sv(e)}function Pv(e,t,n,i){n.forEach(function(n){e(t,n,i)})}function Rv(e){function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped){var i=e||om.a.event;for(var r in e={},i)"layerX"!==r&&"layerY"!==r&&"keyLocation"!==r&&"webkitMovementX"!==r&&"webkitMovementY"!==r&&("returnValue"===r&&i.preventDefault||(e[r]=i[r]));if(e.target||(e.target=e.srcElement||sm.a),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!=e.clientX){var o=sm.a.documentElement,a=sm.a.body;e.pageX=e.clientX+(o&&o.scrollLeft||a&&a.scrollLeft||0)-(o&&o.clientLeft||a&&a.clientLeft||0),e.pageY=e.clientY+(o&&o.scrollTop||a&&a.scrollTop||0)-(o&&o.clientTop||a&&a.clientTop||0)}e.which=e.charCode||e.keyCode,null!=e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e}var Mv=!1;!function(){try{var e=Object.defineProperty({},"passive",{get:function(){Mv=!0}});om.a.addEventListener("test",null,e),om.a.removeEventListener("test",null,e)}catch(t){}}();var Ov=["touchstart","touchmove"];function wv(e,t,n){if(Array.isArray(t))return Pv(wv,e,t,n);var i=xv(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),n.guid||(n.guid=yv()),i.handlers[t].push(n),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,n){if(!i.disabled){t=Rv(t);var r=i.handlers[t.type];if(r)for(var o=r.slice(0),a=0,s=o.length;a<s&&!t.isImmediatePropagationStopped();a++)try{o[a].call(e,t,n)}catch(l){w_.error(l)}}}),1===i.handlers[t].length)if(e.addEventListener){var r=!1;Mv&&Ov.indexOf(t)>-1&&(r={passive:!0}),e.addEventListener(t,i.dispatcher,r)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function Iv(e,t,n){if(Cv(e)){var i=xv(e);if(i.handlers){if(Array.isArray(t))return Pv(Iv,e,t,n);var r=function(e,t){i.handlers[t]=[],Av(e,t)};if(void 0!==t){var o=i.handlers[t];if(o)if(n){if(n.guid)for(var a=0;a<o.length;a++)o[a].guid===n.guid&&o.splice(a--,1);Av(e,t)}else r(e,t)}else for(var s in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},s)&&r(e,s)}}}function Dv(e,t,n){var i=Cv(e)?xv(e):{},r=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=Rv(t),i.dispatcher&&i.dispatcher.call(e,t,n),r&&!t.isPropagationStopped()&&!0===t.bubbles)Dv.call(null,r,t,n);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){var o=xv(t.target);t.target[t.type]&&(o.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),o.disabled=!1)}return!t.defaultPrevented}function Lv(e,t,n){if(Array.isArray(t))return Pv(Lv,e,t,n);var i=function i(){Iv(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||yv(),wv(e,t,i)}function kv(e,t,n){var i=function i(){Iv(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||yv(),wv(e,t,i)}var Nv,Fv=Object.freeze({fixEvent:Rv,on:wv,off:Iv,trigger:Dv,one:Lv,any:kv}),Bv=!1,Uv=function(){if(j_()&&!1!==Nv.options.autoSetup){var e=Array.prototype.slice.call(sm.a.getElementsByTagName("video")),t=Array.prototype.slice.call(sm.a.getElementsByTagName("audio")),n=Array.prototype.slice.call(sm.a.getElementsByTagName("video-js")),i=e.concat(t,n);if(i&&i.length>0)for(var r=0,o=i.length;r<o;r++){var a=i[r];if(!a||!a.getAttribute){Vv(1);break}void 0===a.player&&null!==a.getAttribute("data-setup")&&Nv(a)}else Bv||Vv(1)}};function Vv(e,t){t&&(Nv=t),om.a.setTimeout(Uv,e)}j_()&&"complete"===sm.a.readyState?Bv=!0:Lv(om.a,"load",function(){Bv=!0});var Gv,zv=function(e){var t=sm.a.createElement("style");return t.className=e,t},jv=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t},Hv=function(e,t,n){t.guid||(t.guid=yv());var i=function(){return t.apply(e,arguments)};return i.guid=n?n+"_"+t.guid:t.guid,i},Wv=function(e,t){var n=om.a.performance.now();return function(){var i=om.a.performance.now();i-n>=t&&(e.apply(void 0,arguments),n=i)}},Xv=function(e,t,n,i){var r;void 0===i&&(i=om.a);var o=function(){var o=this,a=arguments,s=function(){r=null,s=null,n||e.apply(o,a)};!r&&n&&e.apply(o,a),i.clearTimeout(r),r=i.setTimeout(s,t)};return o.cancel=function(){i.clearTimeout(r),r=null},o},Yv=function(){};Yv.prototype.allowedEvents_={},Yv.prototype.addEventListener=Yv.prototype.on=function(e,t){var n=this.addEventListener;this.addEventListener=function(){},wv(this,e,t),this.addEventListener=n},Yv.prototype.removeEventListener=Yv.prototype.off=function(e,t){Iv(this,e,t)},Yv.prototype.one=function(e,t){var n=this.addEventListener;this.addEventListener=function(){},Lv(this,e,t),this.addEventListener=n},Yv.prototype.any=function(e,t){var n=this.addEventListener;this.addEventListener=function(){},kv(this,e,t),this.addEventListener=n},Yv.prototype.dispatchEvent=Yv.prototype.trigger=function(e){var t=e.type||e;"string"==typeof e&&(e={type:t}),e=Rv(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),Dv(this,e)},Yv.prototype.queueTrigger=function(e){var t=this;Gv||(Gv=new Map);var n=e.type||e,i=Gv.get(this);i||(i=new Map,Gv.set(this,i));var r=i.get(n);i.delete(n),om.a.clearTimeout(r);var o=om.a.setTimeout(function(){0===i.size&&(i=null,Gv.delete(t)),t.trigger(e)},0);i.set(n,o)};var Kv=function(e){return e instanceof Yv||!!e.eventBusEl_&&["on","one","off","trigger"].every(function(t){return"function"==typeof e[t]})},Qv=function(e){return"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length},qv=function(e){if(!e.nodeName&&!Kv(e))throw new Error("Invalid target; must be a DOM node or evented object.")},Zv=function(e){if(!Qv(e))throw new Error("Invalid event type; must be a non-empty string or array.")},Jv=function(e){if("function"!=typeof e)throw new Error("Invalid listener; must be a function.")},$v=function(e,t){var n,i,r,o=t.length<3||t[0]===e||t[0]===e.eventBusEl_;return o?(n=e.eventBusEl_,t.length>=3&&t.shift(),i=t[0],r=t[1]):(n=t[0],i=t[1],r=t[2]),qv(n),Zv(i),Jv(r),{isTargetingSelf:o,target:n,type:i,listener:r=Hv(e,r)}},eb=function(e,t,n,i){qv(e),e.nodeName?Fv[t](e,n,i):e[t](n,i)},tb={on:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=$v(this,n),o=r.isTargetingSelf,a=r.target,s=r.type,l=r.listener;if(eb(a,"on",s,l),!o){var c=function(){return e.off(a,s,l)};c.guid=l.guid;var u=function(){return e.off("dispose",c)};u.guid=l.guid,eb(this,"on","dispose",c),eb(a,"on","dispose",u)}},one:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=$v(this,n),o=r.target,a=r.type,s=r.listener;if(r.isTargetingSelf)eb(o,"one",a,s);else{var l=function t(){e.off(o,a,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];s.apply(null,i)};l.guid=s.guid,eb(o,"one",a,l)}},any:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var r=$v(this,n),o=r.target,a=r.type,s=r.listener;if(r.isTargetingSelf)eb(o,"any",a,s);else{var l=function t(){e.off(o,a,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];s.apply(null,i)};l.guid=s.guid,eb(o,"any",a,l)}},off:function(e,t,n){if(!e||Qv(e))Iv(this.eventBusEl_,e,t);else{var i=e,r=t;qv(i),Zv(r),Jv(n),n=Hv(this,n),this.off("dispose",n),i.nodeName?(Iv(i,r,n),Iv(i,"dispose",n)):Kv(i)&&(i.off(r,n),i.off("dispose",n))}},trigger:function(e,t){return Dv(this.eventBusEl_,e,t)}};function nb(e,t){void 0===t&&(t={});var n=t.eventBusKey;if(n){if(!e[n].nodeName)throw new Error('The eventBusKey "'+n+'" does not refer to an element.');e.eventBusEl_=e[n]}else e.eventBusEl_=Y_("span",{className:"vjs-event-bus"});return N_(e,tb),e.eventedCallbacks&&e.eventedCallbacks.forEach(function(e){e()}),e.on("dispose",function(){e.off(),om.a.setTimeout(function(){e.eventBusEl_=null},0)}),e}var ib={state:{},setState:function(e){var t,n=this;return"function"==typeof e&&(e=e()),k_(e,function(e,i){n.state[i]!==e&&((t=t||{})[i]={from:n.state[i],to:e}),n.state[i]=e}),t&&Kv(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function rb(e,t){return N_(e,ib),e.state=N_({},e.state,t),"function"==typeof e.handleStateChanged&&Kv(e)&&e.on("statechanged",e.handleStateChanged),e}function ob(e){return"string"!=typeof e?e:e.charAt(0).toUpperCase()+e.slice(1)}function ab(){for(var e={},t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){t&&k_(t,function(t,n){B_(t)?(B_(e[n])||(e[n]={}),e[n]=ab(e[n],t)):e[n]=t})}),e}var sb=function(){function e(e,t,n){if(this.player_=!e&&this.play?e=this:e,this.parentComponent_=null,this.options_=ab({},this.options_),t=this.options_=ab(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){var i=e&&e.id&&e.id()||"no_player";this.id_=i+"_component_"+yv()}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),!1!==t.evented&&nb(this,{eventBusKey:this.el_?"el_":null}),rb(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}var t=e.prototype;return t.dispose=function(){if(this.trigger({type:"dispose",bubbles:!1}),this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),Sv(this.el_),this.el_=null),this.player_=null},t.player=function(){return this.player_},t.options=function(e){return e?(this.options_=ab(this.options_,e),this.options_):this.options_},t.el=function(){return this.el_},t.createEl=function(e,t,n){return Y_(e,t,n)},t.localize=function(e,t,n){void 0===n&&(n=e);var i=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),o=r&&r[i],a=i&&i.split("-")[0],s=r&&r[a],l=n;return o&&o[e]?l=o[e]:s&&s[e]&&(l=s[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,n){var i=t[n-1],r=i;return void 0===i&&(r=e),r})),l},t.contentEl=function(){return this.contentEl_||this.el_},t.id=function(){return this.id_},t.name=function(){return this.name_},t.children=function(){return this.children_},t.getChildById=function(e){return this.childIndex_[e]},t.getChild=function(e){if(e)return e=ob(e),this.childNameIndex_[e]},t.addChild=function(t,n,i){var r,o;if(void 0===n&&(n={}),void 0===i&&(i=this.children_.length),"string"==typeof t){o=ob(t);var a=n.componentClass||o;n.name=o;var s=e.getComponent(a);if(!s)throw new Error("Component "+a+" does not exist");if("function"!=typeof s)return null;r=new s(this.player_||this,n)}else r=t;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(i,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),(o=o||r.name&&ob(r.name()))&&(this.childNameIndex_[o]=r),"function"==typeof r.el&&r.el()){var l=this.contentEl().children[i]||null;this.contentEl().insertBefore(r.el(),l)}return r},t.removeChild=function(e){if("string"==typeof e&&(e=this.getChild(e)),e&&this.children_){for(var t=!1,n=this.children_.length-1;n>=0;n--)if(this.children_[n]===e){t=!0,this.children_.splice(n,1);break}if(t){e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[e.name()]=null;var i=e.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}}},t.initChildren=function(){var t=this,n=this.options_.children;if(n){var i,r=this.options_,o=e.getComponent("Tech");(i=Array.isArray(n)?n:Object.keys(n)).concat(Object.keys(this.options_).filter(function(e){return!i.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(function(e){var i,r;return"string"==typeof e?r=n[i=e]||t.options_[i]||{}:(i=e.name,r=e),{name:i,opts:r}}).filter(function(t){var n=e.getComponent(t.opts.componentClass||ob(t.name));return n&&!o.isTech(n)}).forEach(function(e){var n=e.name,i=e.opts;if(void 0!==r[n]&&(i=r[n]),!1!==i){!0===i&&(i={}),i.playerOptions=t.options_.playerOptions;var o=t.addChild(n,i);o&&(t[n]=o)}})}},t.buildCSSClass=function(){return""},t.ready=function(e,t){if(void 0===t&&(t=!1),e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))},t.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},t.$=function(e,t){return mv(e,t||this.contentEl())},t.$$=function(e,t){return _v(e,t||this.contentEl())},t.hasClass=function(e){return q_(this.el_,e)},t.addClass=function(e){Z_(this.el_,e)},t.removeClass=function(e){J_(this.el_,e)},t.toggleClass=function(e,t){$_(this.el_,e,t)},t.show=function(){this.removeClass("vjs-hidden")},t.hide=function(){this.addClass("vjs-hidden")},t.lockShowing=function(){this.addClass("vjs-lock-showing")},t.unlockShowing=function(){this.removeClass("vjs-lock-showing")},t.getAttribute=function(e){return nv(this.el_,e)},t.setAttribute=function(e,t){iv(this.el_,e,t)},t.removeAttribute=function(e){rv(this.el_,e)},t.width=function(e,t){return this.dimension("width",e,t)},t.height=function(e,t){return this.dimension("height",e,t)},t.dimensions=function(e,t){this.width(e,!0),this.height(t)},t.dimension=function(e,t,n){if(void 0!==t)return null!==t&&t==t||(t=0),this.el_.style[e]=-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?t:"auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;var i=this.el_.style[e],r=i.indexOf("px");return-1!==r?parseInt(i.slice(0,r),10):parseInt(this.el_["offset"+ob(e)],10)},t.currentDimension=function(e){var t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if("function"==typeof om.a.getComputedStyle){var n=om.a.getComputedStyle(this.el_);t=n.getPropertyValue(e)||n[e]}if(0===(t=parseFloat(t))){var i="offset"+ob(e);t=this.el_[i]}return t},t.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},t.currentWidth=function(){return this.currentDimension("width")},t.currentHeight=function(){return this.currentDimension("height")},t.focus=function(){this.el_.focus()},t.blur=function(){this.el_.blur()},t.handleKeyDown=function(e){this.player_&&(e.stopPropagation(),this.player_.handleKeyDown(e))},t.handleKeyPress=function(e){this.handleKeyDown(e)},t.emitTapEvents=function(){var e,t=0,n=null;this.on("touchstart",function(i){1===i.touches.length&&(n={pageX:i.touches[0].pageX,pageY:i.touches[0].pageY},t=om.a.performance.now(),e=!0)}),this.on("touchmove",function(t){if(t.touches.length>1)e=!1;else if(n){var i=t.touches[0].pageX-n.pageX,r=t.touches[0].pageY-n.pageY;Math.sqrt(i*i+r*r)>10&&(e=!1)}});var i=function(){e=!1};this.on("touchleave",i),this.on("touchcancel",i),this.on("touchend",function(i){n=null,!0===e&&om.a.performance.now()-t<200&&(i.preventDefault(),this.trigger("tap"))})},t.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,t=Hv(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){t(),this.clearInterval(e),e=this.setInterval(t,250)});var n=function(n){t(),this.clearInterval(e)};this.on("touchmove",t),this.on("touchend",n),this.on("touchcancel",n)}},t.setTimeout=function(e,t){var n,i,r=this;return e=Hv(this,e),n=om.a.setTimeout(function(){r.off("dispose",i),e()},t),(i=function(){return r.clearTimeout(n)}).guid="vjs-timeout-"+n,this.on("dispose",i),n},t.clearTimeout=function(e){om.a.clearTimeout(e);var t=function(){};return t.guid="vjs-timeout-"+e,this.off("dispose",t),e},t.setInterval=function(e,t){var n=this;e=Hv(this,e);var i=om.a.setInterval(e,t),r=function(){return n.clearInterval(i)};return r.guid="vjs-interval-"+i,this.on("dispose",r),i},t.clearInterval=function(e){om.a.clearInterval(e);var t=function(){};return t.guid="vjs-interval-"+e,this.off("dispose",t),e},t.requestAnimationFrame=function(e){var t,n,i=this;return this.supportsRaf_?(e=Hv(this,e),t=om.a.requestAnimationFrame(function(){i.off("dispose",n),e()}),(n=function(){return i.cancelAnimationFrame(t)}).guid="vjs-raf-"+t,this.on("dispose",n),t):this.setTimeout(e,1e3/60)},t.cancelAnimationFrame=function(e){if(this.supportsRaf_){om.a.cancelAnimationFrame(e);var t=function(){};return t.guid="vjs-raf-"+e,this.off("dispose",t),e}return this.clearTimeout(e)},e.registerComponent=function(t,n){if("string"!=typeof t||!t)throw new Error('Illegal component name, "'+t+'"; must be a non-empty string.');var i=e.getComponent("Tech"),r=i&&i.isTech(n),o=e===n||e.prototype.isPrototypeOf(n.prototype);if(r||!o)throw new Error('Illegal component, "'+t+'"; '+(r?"techs must be registered using Tech.registerTech()":"must be a Component subclass")+".");t=ob(t),e.components_||(e.components_={});var a=e.getComponent("Player");if("Player"===t&&a&&a.players){var s=a.players,l=Object.keys(s);if(s&&l.length>0&&l.map(function(e){return s[e]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return e.components_[t]=n,n},e.getComponent=function(t){if(t)return t=ob(t),e.components_&&e.components_[t]?e.components_[t]:void 0},e}();sb.prototype.supportsRaf_="function"==typeof om.a.requestAnimationFrame&&"function"==typeof om.a.cancelAnimationFrame,sb.registerComponent("Component",sb);var lb,cb=om.a.navigator&&om.a.navigator.userAgent||"",ub=/AppleWebKit\/([\d.]+)/i.exec(cb),hb=ub?parseFloat(ub.pop()):null,db=/iPad/i.test(cb),fb=/iPhone/i.test(cb)&&!db,pb=/iPod/i.test(cb),gb=fb||db||pb,mb=(lb=cb.match(/OS (\d+)_/i))&&lb[1]?lb[1]:null,_b=/Android/i.test(cb),vb=function(){var e=cb.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),bb=_b&&vb<5&&hb<537,yb=/Firefox/i.test(cb),Tb=/Edge/i.test(cb),Eb=!Tb&&(/Chrome/i.test(cb)||/CriOS/i.test(cb)),xb=function(){var e=cb.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),Cb=function(){var e=/MSIE\s(\d+)\.\d/.exec(cb),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(cb)&&/rv:11.0/.test(cb)&&(t=11),t}(),Sb=/Safari/i.test(cb)&&!Eb&&!_b&&!Tb,Ab=(Sb||gb)&&!Eb,Pb=/Windows/i.test(cb),Rb=j_()&&("ontouchstart"in om.a||om.a.navigator.maxTouchPoints||om.a.DocumentTouch&&om.a.document instanceof om.a.DocumentTouch),Mb=Object.freeze({IS_IPAD:db,IS_IPHONE:fb,IS_IPOD:pb,IS_IOS:gb,IOS_VERSION:mb,IS_ANDROID:_b,ANDROID_VERSION:vb,IS_NATIVE_ANDROID:bb,IS_FIREFOX:yb,IS_EDGE:Tb,IS_CHROME:Eb,CHROME_VERSION:xb,IE_VERSION:Cb,IS_SAFARI:Sb,IS_ANY_SAFARI:Ab,IS_WINDOWS:Pb,TOUCH_ENABLED:Rb});function Ob(e,t,n,i){return function(e,t,n){if("number"!=typeof i||i<0||i>n)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+i+") is non-numeric or out of bounds (0-"+n+").")}(e,0,n.length-1),n[i][t]}function wb(e){return void 0===e||0===e.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Ob.bind(null,"start",0,e),end:Ob.bind(null,"end",1,e)}}function Ib(e,t){return Array.isArray(e)?wb(e):void 0===e||void 0===t?wb():wb([[e,t]])}function Db(e,t){var n,i,r=0;if(!t)return 0;e&&e.length||(e=Ib(0,0));for(var o=0;o<e.length;o++)n=e.start(o),(i=e.end(o))>t&&(i=t),r+=i-n;return r/t}for(var Lb,kb={prefixed:!0},Nb=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],Fb=Nb[0],Bb=0;Bb<Nb.length;Bb++)if(Nb[Bb][1]in sm.a){Lb=Nb[Bb];break}if(Lb){for(var Ub=0;Ub<Lb.length;Ub++)kb[Fb[Ub]]=Lb[Ub];kb.prefixed=Lb[0]!==Fb[0]}function Vb(e){if(e instanceof Vb)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:F_(e)&&("number"==typeof e.code&&(this.code=e.code),N_(this,e)),this.message||(this.message=Vb.defaultMessages[this.code]||"")}Vb.prototype.code=0,Vb.prototype.message="",Vb.prototype.status=null,Vb.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Vb.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Gb=0;Gb<Vb.errorTypes.length;Gb++)Vb[Vb.errorTypes[Gb]]=Gb,Vb.prototype[Vb.errorTypes[Gb]]=Gb;function zb(e){return null!=e&&"function"==typeof e.then}function jb(e){zb(e)&&e.then(null,function(e){})}var Hb=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,n,i){return e[n]&&(t[n]=e[n]),t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})})},Wb="vjs-modal-dialog",Xb=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).opened_=i.hasBeenOpened_=i.hasBeenFilled_=!1,i.closeable(!i.options_.uncloseable),i.content(i.options_.content),i.contentEl_=Y_("div",{className:Wb+"-content"},{role:"document"}),i.descEl_=Y_("p",{className:Wb+"-description vjs-control-text",id:i.el().getAttribute("aria-describedby")}),K_(i.descEl_,i.description()),i.el_.appendChild(i.descEl_),i.el_.appendChild(i.contentEl_),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},n.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,e.prototype.dispose.call(this)},n.buildCSSClass=function(){return Wb+" vjs-hidden "+e.prototype.buildCSSClass.call(this)},n.label=function(){return this.localize(this.options_.label||"Modal Window")},n.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},n.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},n.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},n.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},n.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,n=this.getChild("closeButton");if(t&&!n){var i=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=i,this.on(n,"close",this.close)}!t&&n&&(this.off(n,"close",this.close),this.removeChild(n),n.dispose())}return this.closeable_},n.fill=function(){this.fillWith(this.content())},n.fillWith=function(e){var t=this.contentEl(),n=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),pv(t,e),this.trigger("modalfill"),i?n.insertBefore(t,i):n.appendChild(t);var r=this.getChild("closeButton");r&&n.appendChild(r.el_)},n.empty=function(){this.trigger("beforemodalempty"),hv(this.contentEl()),this.trigger("modalempty")},n.content=function(e){return void 0!==e&&(this.content_=e),this.content_},n.conditionalFocus_=function(){var e=sm.a.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())},n.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},n.handleKeyDown=function(e){if(e.stopPropagation(),fm.a.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(fm.a.isEventKey(e,"Tab")){for(var t,n=this.focusableEls_(),i=this.el_.querySelector(":focus"),r=0;r<n.length;r++)if(i===n[r]){t=r;break}sm.a.activeElement===this.el_&&(t=0),e.shiftKey&&0===t?(n[n.length-1].focus(),e.preventDefault()):e.shiftKey||t!==n.length-1||(n[0].focus(),e.preventDefault())}},n.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(e){return(e instanceof om.a.HTMLAnchorElement||e instanceof om.a.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof om.a.HTMLInputElement||e instanceof om.a.HTMLSelectElement||e instanceof om.a.HTMLTextAreaElement||e instanceof om.a.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof om.a.HTMLIFrameElement||e instanceof om.a.HTMLObjectElement||e instanceof om.a.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")})},t}(sb);Xb.prototype.options_={pauseOnOpen:!0,temporary:!0},sb.registerComponent("ModalDialog",Xb);var Yb=function(e){function t(t){var n;void 0===t&&(t=[]),(n=e.call(this)||this).tracks_=[],Object.defineProperty(R_(n),"length",{get:function(){return this.tracks_.length}});for(var i=0;i<t.length;i++)n.addTrack(t[i]);return n}S_(t,e);var n=t.prototype;return n.addTrack=function(e){var t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this}))},n.removeTrack=function(e){for(var t,n=0,i=this.length;n<i;n++)if(this[n]===e){(t=this[n]).off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})},n.getTrackById=function(e){for(var t=null,n=0,i=this.length;n<i;n++){var r=this[n];if(r.id===e){t=r;break}}return t},t}(Yv);for(var Kb in Yb.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack"},Yb.prototype.allowedEvents_)Yb.prototype["on"+Kb]=null;var Qb=function(e,t){for(var n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)},qb=function(e){function t(t){var n;void 0===t&&(t=[]);for(var i=t.length-1;i>=0;i--)if(t[i].enabled){Qb(t,t[i]);break}return(n=e.call(this,t)||this).changing_=!1,n}S_(t,e);var n=t.prototype;return n.addTrack=function(t){var n=this;t.enabled&&Qb(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.enabledChange_=function(){n.changing_||(n.changing_=!0,Qb(n,t),n.changing_=!1,n.trigger("change"))},t.addEventListener("enabledchange",t.enabledChange_))},n.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.enabledChange_&&(t.removeEventListener("enabledchange",t.enabledChange_),t.enabledChange_=null)},t}(Yb),Zb=function(e,t){for(var n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)},Jb=function(e){function t(t){var n;void 0===t&&(t=[]);for(var i=t.length-1;i>=0;i--)if(t[i].selected){Zb(t,t[i]);break}return(n=e.call(this,t)||this).changing_=!1,Object.defineProperty(R_(n),"selectedIndex",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),n}S_(t,e);var n=t.prototype;return n.addTrack=function(t){var n=this;t.selected&&Zb(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.selectedChange_=function(){n.changing_||(n.changing_=!0,Zb(n,t),n.changing_=!1,n.trigger("change"))},t.addEventListener("selectedchange",t.selectedChange_))},n.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.selectedChange_&&(t.removeEventListener("selectedchange",t.selectedChange_),t.selectedChange_=null)},t}(Yb),$b=function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.addTrack=function(t){var n=this;e.prototype.addTrack.call(this,t),this.queueChange_||(this.queueChange_=function(){return n.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return n.trigger("selectedlanguagechange")}),t.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",this.triggerSelectedlanguagechange_)},n.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&(this.queueChange_&&t.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&t.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},t}(Yb),ey=function(){function e(e){void 0===e&&(e=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}var t=e.prototype;return t.addTrackElement_=function(e){var t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},t.getTrackElementByTrack_=function(e){for(var t,n=0,i=this.trackElements_.length;n<i;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t},t.removeTrackElement_=function(e){for(var t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}},e}(),ty=function(){function e(t){e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var t=e.prototype;return t.setCues_=function(e){var t=this.length||0,n=0,i=e.length;this.cues_=e,this.length_=e.length;var r=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<i)for(n=t;n<i;n++)r.call(this,n)},t.getCueById=function(e){for(var t=null,n=0,i=this.length;n<i;n++){var r=this[n];if(r.id===e){t=r;break}}return t},e}(),ny={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},iy={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},ry={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},oy={disabled:"disabled",hidden:"hidden",showing:"showing"},ay=function(e){function t(t){var n;void 0===t&&(t={}),n=e.call(this)||this;var i={id:t.id||"vjs_track_"+yv(),kind:t.kind||"",label:t.label||"",language:t.language||""},r=function(e){Object.defineProperty(R_(n),e,{get:function(){return i[e]},set:function(){}})};for(var o in i)r(o);return n}return S_(t,e),t}(Yv),sy=function(e){var t=["protocol","hostname","port","pathname","search","hash","host"],n=sm.a.createElement("a");n.href=e;var i,r=""===n.host&&"file:"!==n.protocol;r&&((i=sm.a.createElement("div")).innerHTML='<a href="'+e+'"></a>',n=i.firstChild,i.setAttribute("style","display:none; position:absolute;"),sm.a.body.appendChild(i));for(var o={},a=0;a<t.length;a++)o[t[a]]=n[t[a]];return"http:"===o.protocol&&(o.host=o.host.replace(/:80$/,"")),"https:"===o.protocol&&(o.host=o.host.replace(/:443$/,"")),o.protocol||(o.protocol=om.a.location.protocol),r&&sm.a.body.removeChild(i),o},ly=function(e){if(!e.match(/^https?:\/\//)){var t=sm.a.createElement("div");t.innerHTML='<a href="'+e+'">x</a>',e=t.firstChild.href}return e},cy=function(e){if("string"==typeof e){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/i.exec(e);if(t)return t.pop().toLowerCase()}return""},uy=function(e){var t=om.a.location,n=sy(e);return(":"===n.protocol?t.protocol:n.protocol)+n.host!==t.protocol+t.host},hy=Object.freeze({parseUrl:sy,getAbsoluteURL:ly,getFileExtension:cy,isCrossOrigin:uy}),dy=function(e,t){var n=new om.a.WebVTT.Parser(om.a,om.a.vttjs,om.a.WebVTT.StringDecoder()),i=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){i.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),i.length>0&&(om.a.console&&om.a.console.groupCollapsed&&om.a.console.groupCollapsed("Text Track parsing errors for "+t.src),i.forEach(function(e){return w_.error(e)}),om.a.console&&om.a.console.groupEnd&&om.a.console.groupEnd()),n.flush()},fy=function(e,t){var n={uri:e},i=uy(e);i&&(n.cors=i),gm()(n,Hv(this,function(e,n,i){if(e)return w_.error(e,n);if(t.loaded_=!0,"function"!=typeof om.a.WebVTT){if(t.tech_){var r,o=function(){w_.error("vttjs failed to load, stopping trying to process "+t.src),t.tech_.off("vttjsloaded",r)};r=function(){return t.tech_.off("vttjserror",o),dy(i,t)},t.tech_.one("vttjsloaded",r),t.tech_.one("vttjserror",o)}}else dy(i,t)}))},py=function(e){function t(t){var n;if(void 0===t&&(t={}),!t.tech)throw new Error("A tech was not provided.");var i=ab(t,{kind:ry[t.kind]||"subtitles",language:t.language||t.srclang||""}),r=oy[i.mode]||"disabled",o=i.default;"metadata"!==i.kind&&"chapters"!==i.kind||(r="hidden"),(n=e.call(this,i)||this).tech_=i.tech,n.cues_=[],n.activeCues_=[];var a=new ty(n.cues_),s=new ty(n.activeCues_),l=!1,c=Hv(R_(n),function(){this.activeCues=this.activeCues,l&&(this.trigger("cuechange"),l=!1)});return"disabled"!==r&&n.tech_.ready(function(){n.tech_.on("timeupdate",c)},!0),Object.defineProperties(R_(n),{default:{get:function(){return o},set:function(){}},mode:{get:function(){return r},set:function(e){var t=this;oy[e]&&("disabled"!==(r=e)?this.tech_.ready(function(){t.tech_.on("timeupdate",c)},!0):this.tech_.off("timeupdate",c),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?a:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return s;for(var e=this.tech_.currentTime(),t=[],n=0,i=this.cues.length;n<i;n++){var r=this.cues[n];r.startTime<=e&&r.endTime>=e?t.push(r):r.startTime===r.endTime&&r.startTime<=e&&r.startTime+.5>=e&&t.push(r)}if(l=!1,t.length!==this.activeCues_.length)l=!0;else for(var o=0;o<t.length;o++)-1===this.activeCues_.indexOf(t[o])&&(l=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set:function(){}}}),i.src?(n.src=i.src,fy(i.src,R_(n))):n.loaded_=!0,n}S_(t,e);var n=t.prototype;return n.addCue=function(e){var t=e;if(om.a.vttjs&&!(e instanceof om.a.vttjs.VTTCue)){for(var n in t=new om.a.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}for(var i=this.tech_.textTracks(),r=0;r<i.length;r++)i[r]!==this&&i[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},n.removeCue=function(e){for(var t=this.cues_.length;t--;){var n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},t}(ay);py.prototype.allowedEvents_={cuechange:"cuechange"};var gy=function(e){function t(t){var n;void 0===t&&(t={});var i=ab(t,{kind:iy[t.kind]||""});n=e.call(this,i)||this;var r=!1;return Object.defineProperty(R_(n),"enabled",{get:function(){return r},set:function(e){"boolean"==typeof e&&e!==r&&(r=e,this.trigger("enabledchange"))}}),i.enabled&&(n.enabled=i.enabled),n.loaded_=!0,n}return S_(t,e),t}(ay),my=function(e){function t(t){var n;void 0===t&&(t={});var i=ab(t,{kind:ny[t.kind]||""});n=e.call(this,i)||this;var r=!1;return Object.defineProperty(R_(n),"selected",{get:function(){return r},set:function(e){"boolean"==typeof e&&e!==r&&(r=e,this.trigger("selectedchange"))}}),i.selected&&(n.selected=i.selected),n}return S_(t,e),t}(ay),_y=0,vy=2,by=function(e){function t(t){var n,i;void 0===t&&(t={}),n=e.call(this)||this;var r=new py(t);return n.kind=r.kind,n.src=r.src,n.srclang=r.language,n.label=r.label,n.default=r.default,Object.defineProperties(R_(n),{readyState:{get:function(){return i}},track:{get:function(){return r}}}),i=_y,r.addEventListener("loadeddata",function(){i=vy,n.trigger({type:"load",target:R_(n)})}),n}return S_(t,e),t}(Yv);by.prototype.allowedEvents_={load:"load"},by.NONE=_y,by.LOADING=1,by.LOADED=vy,by.ERROR=3;var yy={audio:{ListClass:qb,TrackClass:gy,capitalName:"Audio"},video:{ListClass:Jb,TrackClass:my,capitalName:"Video"},text:{ListClass:$b,TrackClass:py,capitalName:"Text"}};Object.keys(yy).forEach(function(e){yy[e].getterName=e+"Tracks",yy[e].privateName=e+"Tracks_"});var Ty={remoteText:{ListClass:$b,TrackClass:py,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:ey,TrackClass:by,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Ey=ab(yy,Ty);Ty.names=Object.keys(Ty),yy.names=Object.keys(yy),Ey.names=[].concat(Ty.names).concat(yy.names);var xy=function(e){function t(t,n){var i;return void 0===t&&(t={}),void 0===n&&(n=function(){}),t.reportTouchActivity=!1,(i=e.call(this,null,t,n)||this).hasStarted_=!1,i.on("playing",function(){this.hasStarted_=!0}),i.on("loadstart",function(){this.hasStarted_=!1}),Ey.names.forEach(function(e){var n=Ey[e];t&&t[n.getterName]&&(i[n.privateName]=t[n.getterName])}),i.featuresProgressEvents||i.manualProgressOn(),i.featuresTimeupdateEvents||i.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(e){!1===t["native"+e+"Tracks"]&&(i["featuresNative"+e+"Tracks"]=!1)}),!1===t.nativeCaptions||!1===t.nativeTextTracks?i.featuresNativeTextTracks=!1:!0!==t.nativeCaptions&&!0!==t.nativeTextTracks||(i.featuresNativeTextTracks=!0),i.featuresNativeTextTracks||i.emulateTextTracks(),i.autoRemoteTextTracks_=new Ey.text.ListClass,i.initTrackListeners(),t.nativeControlsForTouch||i.emitTapEvents(),i.constructor&&(i.name_=i.constructor.name||"Unknown Tech"),i}S_(t,e);var n=t.prototype;return n.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},n.manualProgressOn=function(){this.on("durationchange",this.onDurationChange),this.manualProgress=!0,this.one("ready",this.trackProgress)},n.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange)},n.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Hv(this,function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)},n.onDurationChange=function(e){this.duration_=this.duration()},n.buffered=function(){return Ib(0,0)},n.bufferedPercent=function(){return Db(this.buffered(),this.duration_)},n.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},n.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime),this.on("pause",this.stopTrackingCurrentTime)},n.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime),this.off("pause",this.stopTrackingCurrentTime)},n.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},n.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},n.dispose=function(){this.clearTracks(yy.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),e.prototype.dispose.call(this)},n.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach(function(e){for(var n=t[e+"Tracks"]()||[],i=n.length;i--;){var r=n[i];"text"===e&&t.removeRemoteTextTrack(r),n.removeTrack(r)}})},n.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;)this.removeRemoteTextTrack(e[t])},n.reset=function(){},n.error=function(e){return void 0!==e&&(this.error_=new Vb(e),this.trigger("error")),this.error_},n.played=function(){return this.hasStarted_?Ib(0,0):Ib()},n.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},n.initTrackListeners=function(){var e=this;yy.names.forEach(function(t){var n=function(){e.trigger(t+"trackchange")},i=e[yy[t].getterName]();i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),e.on("dispose",function(){i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n)})})},n.addWebVttScript_=function(){var e=this;if(!om.a.WebVTT)if(sm.a.body.contains(this.el())){if(!this.options_["vtt.js"]&&B_(_m.a)&&Object.keys(_m.a).length>0)return void this.trigger("vttjsloaded");var t=sm.a.createElement("script");t.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){t.onload=null,t.onerror=null}),om.a.WebVTT=!0,this.el().parentNode.appendChild(t)}else this.ready(this.addWebVttScript_)},n.emulateTextTracks=function(){var e=this,t=this.textTracks(),n=this.remoteTextTracks(),i=function(e){return t.addTrack(e.track)},r=function(e){return t.removeTrack(e.track)};n.on("addtrack",i),n.on("removetrack",r),this.addWebVttScript_();var o=function(){return e.trigger("texttrackchange")},a=function(){o();for(var e=0;e<t.length;e++){var n=t[e];n.removeEventListener("cuechange",o),"showing"===n.mode&&n.addEventListener("cuechange",o)}};a(),t.addEventListener("change",a),t.addEventListener("addtrack",a),t.addEventListener("removetrack",a),this.on("dispose",function(){n.off("addtrack",i),n.off("removetrack",r),t.removeEventListener("change",a),t.removeEventListener("addtrack",a),t.removeEventListener("removetrack",a);for(var e=0;e<t.length;e++)t[e].removeEventListener("cuechange",o)})},n.addTextTrack=function(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return function(e,t,n,i,r){void 0===r&&(r={});var o=e.textTracks();r.kind=t,n&&(r.label=n),i&&(r.language=i),r.tech=e;var a=new Ey.text.TrackClass(r);return o.addTrack(a),a}(this,e,t,n)},n.createRemoteTextTrack=function(e){var t=ab(e,{tech:this});return new Ty.remoteTextEl.TrackClass(t)},n.addRemoteTextTrack=function(e,t){var n=this;void 0===e&&(e={});var i=this.createRemoteTextTrack(e);return!0!==t&&!1!==t&&(w_.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(i),this.remoteTextTracks().addTrack(i.track),!0!==t&&this.ready(function(){return n.autoRemoteTextTracks_.addTrack(i.track)}),i},n.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},n.getVideoPlaybackQuality=function(){return{}},n.requestPictureInPicture=function(){var e=this.options_.Promise||om.a.Promise;if(e)return e.reject()},n.setPoster=function(){},n.playsinline=function(){},n.setPlaysinline=function(){},n.overrideNativeAudioTracks=function(){},n.overrideNativeVideoTracks=function(){},n.canPlayType=function(){return""},t.canPlayType=function(){return""},t.canPlaySource=function(e,n){return t.canPlayType(e.type)},t.isTech=function(e){return e.prototype instanceof t||e instanceof t||e===t},t.registerTech=function(e,n){if(t.techs_||(t.techs_={}),!t.isTech(n))throw new Error("Tech "+e+" must be a Tech");if(!t.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!t.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=ob(e),t.techs_[e]=n,"Tech"!==e&&t.defaultTechOrder_.push(e),n},t.getTech=function(e){if(e)return e=ob(e),t.techs_&&t.techs_[e]?t.techs_[e]:om.a&&om.a.videojs&&om.a.videojs[e]?(w_.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),om.a.videojs[e]):void 0},t}(sb);Ey.names.forEach(function(e){var t=Ey[e];xy.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),xy.prototype.featuresVolumeControl=!0,xy.prototype.featuresMuteControl=!0,xy.prototype.featuresFullscreenResize=!1,xy.prototype.featuresPlaybackRate=!1,xy.prototype.featuresProgressEvents=!1,xy.prototype.featuresSourceset=!1,xy.prototype.featuresTimeupdateEvents=!1,xy.prototype.featuresNativeTextTracks=!1,xy.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){var i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===n&&(n=i.length),i.splice(n,0,t)},e.canPlayType=function(t){for(var n,i=e.sourceHandlers||[],r=0;r<i.length;r++)if(n=i[r].canPlayType(t))return n;return""},e.selectSourceHandler=function(t,n){for(var i=e.sourceHandlers||[],r=0;r<i.length;r++)if(i[r].canHandleSource(t,n))return i[r];return null},e.canPlaySource=function(t,n){var i=e.selectSourceHandler(t,n);return i?i.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach(function(e){var t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){var n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:w_.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},sb.registerComponent("Tech",xy),xy.registerTech("Tech",xy),xy.defaultTechOrder_=[];var Cy={},Sy={},Ay={};function Py(e,t,n,i){void 0===i&&(i=null);var r="call"+ob(n),o=e.reduce(wy(r),i),a=o===Ay,s=a?null:t[n](o);return function(e,t,n,i){for(var r=e.length-1;r>=0;r--){var o=e[r];o[t]&&o[t](i,n)}}(e,n,s,a),s}var Ry={buffered:1,currentTime:1,duration:1,seekable:1,played:1,paused:1,volume:1},My={setCurrentTime:1,setVolume:1},Oy={play:1,pause:1};function wy(e){return function(t,n){return t===Ay?Ay:n[e]?n[e](t):t}}var Iy={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",oga:"audio/ogg",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Dy=function(e){void 0===e&&(e="");var t=cy(e);return Iy[t.toLowerCase()]||""};function Ly(e){var t=Dy(e.src);return!e.type&&t&&(e.type=t),e}var ky=function(e){function t(t,n,i){var r,o=ab({createEl:!1},n);if(r=e.call(this,t,o,i)||this,n.playerOptions.sources&&0!==n.playerOptions.sources.length)t.src(n.playerOptions.sources);else for(var a=0,s=n.playerOptions.techOrder;a<s.length;a++){var l=ob(s[a]),c=xy.getTech(l);if(l||(c=sb.getComponent(l)),c&&c.isSupported()){t.loadTech_(l);break}}return r}return S_(t,e),t}(sb);sb.registerComponent("MediaLoader",ky);var Ny=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).emitTapEvents(),i.enable(),i}S_(t,e);var n=t.prototype;return n.createEl=function(t,n,i){void 0===t&&(t="div"),void 0===n&&(n={}),void 0===i&&(i={}),n=N_({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass(),tabIndex:0},n),"button"===t&&w_.error("Creating a ClickableComponent with an HTML element of "+t+" is not supported; use a Button instead."),i=N_({role:"button"},i),this.tabIndex_=n.tabIndex;var r=e.prototype.createEl.call(this,t,n,i);return this.createControlTextEl(r),r},n.dispose=function(){this.controlTextEl_=null,e.prototype.dispose.call(this)},n.createControlTextEl=function(e){return this.controlTextEl_=Y_("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},n.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||"Need Text";var n=this.localize(e);this.controlText_=e,K_(this.controlTextEl_,n),this.nonIconControl||t.setAttribute("title",n)},n.buildCSSClass=function(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)},n.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick),this.on("keydown",this.handleKeyDown))},n.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off(["tap","click"],this.handleClick),this.off("keydown",this.handleKeyDown)},n.handleClick=function(e){},n.handleKeyDown=function(t){fm.a.isEventKey(t,"Space")||fm.a.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(sb);sb.registerComponent("ClickableComponent",Ny),sb.registerComponent("PosterImage",function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).update(),t.on("posterchange",Hv(R_(i),i.update)),i}S_(t,e);var n=t.prototype;return n.dispose=function(){this.player().off("posterchange",this.update),e.prototype.dispose.call(this)},n.createEl=function(){return Y_("div",{className:"vjs-poster",tabIndex:-1})},n.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},n.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},n.handleClick=function(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?jb(this.player_.play()):this.player_.pause())},t}(Ny));var Fy={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function By(e,t){var n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function Uy(e,t,n){try{e.style[t]=n}catch(i){return}}sb.registerComponent("TextTrackDisplay",function(e){function t(t,n,i){var r;r=e.call(this,t,n,i)||this;var o=Hv(R_(r),r.updateDisplay);return t.on("loadstart",Hv(R_(r),r.toggleDisplay)),t.on("texttrackchange",o),t.on("loadedmetadata",Hv(R_(r),r.preselectTrack)),t.ready(Hv(R_(r),function(){if(t.tech_&&t.tech_.featuresNativeTextTracks)this.hide();else{t.on("fullscreenchange",o),t.on("playerresize",o),om.a.addEventListener("orientationchange",o),t.on("dispose",function(){return om.a.removeEventListener("orientationchange",o)});for(var e=this.options_.playerOptions.tracks||[],n=0;n<e.length;n++)this.player_.addRemoteTextTrack(e[n],!0);this.preselectTrack()}})),r}S_(t,e);var n=t.prototype;return n.preselectTrack=function(){for(var e,t,n,i={captions:1,subtitles:1},r=this.player_.textTracks(),o=this.player_.cache_.selectedLanguage,a=0;a<r.length;a++){var s=r[a];o&&o.enabled&&o.language&&o.language===s.language&&s.kind in i?s.kind===o.kind?n=s:n||(n=s):o&&!o.enabled?(n=null,e=null,t=null):s.default&&("descriptions"!==s.kind||e?s.kind in i&&!t&&(t=s):e=s)}n?n.mode="showing":t?t.mode="showing":e&&(e.mode="showing")},n.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})},n.clearDisplay=function(){"function"==typeof om.a.WebVTT&&om.a.WebVTT.processCues(om.a,[],this.el_)},n.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var n=[],i=0;i<e.length;++i){var r=e[i];"showing"===r.mode&&n.push(r)}this.updateForTrack(n)}else{for(var o=null,a=null,s=e.length;s--;){var l=e[s];"showing"===l.mode&&("descriptions"===l.kind?o=l:a=l)}a?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(a)):o&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(o))}},n.updateDisplayState=function(e){for(var t=this.player_.textTrackSettings.getValues(),n=e.activeCues,i=n.length;i--;){var r=n[i];if(r){var o=r.displayState;if(t.color&&(o.firstChild.style.color=t.color),t.textOpacity&&Uy(o.firstChild,"color",By(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(o.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Uy(o.firstChild,"backgroundColor",By(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Uy(o,"backgroundColor",By(t.windowColor,t.windowOpacity)):o.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?o.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px #222":"raised"===t.edgeStyle?o.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px #222":"depressed"===t.edgeStyle?o.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px #222":"uniform"===t.edgeStyle&&(o.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px #222")),t.fontPercent&&1!==t.fontPercent){var a=om.a.parseFloat(o.style.fontSize);o.style.fontSize=a*t.fontPercent+"px",o.style.height="auto",o.style.top="auto",o.style.bottom="2px"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?o.firstChild.style.fontVariant="small-caps":o.firstChild.style.fontFamily=Fy[t.fontFamily])}}},n.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),"function"==typeof om.a.WebVTT&&!e.every(function(e){return!e.activeCues})){for(var t=[],n=0;n<e.length;++n)for(var i=e[n],r=0;r<i.activeCues.length;++r)t.push(i.activeCues[r]);om.a.WebVTT.processCues(om.a,t,this.el_);for(var o=0;o<e.length;++o){for(var a=e[o],s=0;s<a.activeCues.length;++s){var l=a.activeCues[s].displayState;Z_(l,"vjs-text-track-cue"),Z_(l,"vjs-text-track-cue-"+(a.language?a.language:o))}this.player_.textTrackSettings&&this.updateDisplayState(a)}}},t}(sb)),sb.registerComponent("LoadingSpinner",function(e){function t(){return e.apply(this,arguments)||this}return S_(t,e),t.prototype.createEl=function(){var t=this.player_.isAudio(),n=this.localize(t?"Audio Player":"Video Player"),i=Y_("span",{className:"vjs-control-text",innerHTML:this.localize("{1} is loading.",[n])}),r=e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(i),r},t}(sb));var Vy=function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.createEl=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={}),t=N_({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass()},t),n=N_({type:"button"},n);var i=sb.prototype.createEl.call(this,"button",t,n);return this.createControlTextEl(i),i},n.addChild=function(e,t){return void 0===t&&(t={}),w_.warn("Adding an actionable (user controllable) child to a Button ("+this.constructor.name+") is not supported; use a ClickableComponent instead."),sb.prototype.addChild.call(this,e,t)},n.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},n.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},n.handleKeyDown=function(t){fm.a.isEventKey(t,"Space")||fm.a.isEventKey(t,"Enter")?t.stopPropagation():e.prototype.handleKeyDown.call(this,t)},t}(Ny);sb.registerComponent("Button",Vy);var Gy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).mouseused_=!1,i.on("mousedown",i.handleMouseDown),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-big-play-button"},n.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY)return jb(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());var n=this.player_.getChild("controlBar"),i=n&&n.getChild("playToggle");if(i){var r=function(){return i.focus()};zb(t)?t.then(r,function(){}):this.setTimeout(r,1)}else this.player_.tech(!0).focus()},n.handleKeyDown=function(t){this.mouseused_=!1,e.prototype.handleKeyDown.call(this,t)},n.handleMouseDown=function(e){this.mouseused_=!0},t}(Vy);Gy.prototype.controlText_="Play Video",sb.registerComponent("BigPlayButton",Gy),sb.registerComponent("CloseButton",function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).controlText(n&&n.controlText||i.localize("Close")),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)},n.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},n.handleKeyDown=function(t){fm.a.isEventKey(t,"Esc")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(Vy));var zy=function(e){function t(t,n){var i;return void 0===n&&(n={}),i=e.call(this,t,n)||this,n.replay=void 0===n.replay||n.replay,i.on(t,"play",i.handlePlay),i.on(t,"pause",i.handlePause),n.replay&&i.on(t,"ended",i.handleEnded),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},n.handleClick=function(e){this.player_.paused()?this.player_.play():this.player_.pause(),e.stopPropagation()},n.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},n.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},n.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},n.handleEnded=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",this.handleSeeked)},t}(Vy);zy.prototype.controlText_="Play",sb.registerComponent("PlayToggle",zy);var jy=function(e,t){e=e<0?0:e;var n=Math.floor(e%60),i=Math.floor(e/60%60),r=Math.floor(e/3600),o=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=i=n="-"),(r=r>0||a>0?r+":":"")+(i=((r||o>=10)&&i<10?"0"+i:i)+":")+(n<10?"0"+n:n)},Hy=jy;function Wy(e,t){return void 0===t&&(t=e),Hy(e,t)}var Xy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).throttledUpdateContent=Wv(Hv(R_(i),i.updateContent),25),i.on(t,"timeupdate",i.throttledUpdateContent),i}S_(t,e);var n=t.prototype;return n.createEl=function(){var t=this.buildCSSClass(),n=e.prototype.createEl.call(this,"div",{className:t+" vjs-time-control vjs-control",innerHTML:'<span class="vjs-control-text" role="presentation">'+this.localize(this.labelText_)+"\xa0</span>"});return this.contentEl_=Y_("span",{className:t+"-display"},{"aria-live":"off",role:"presentation"}),this.updateTextNode_(),n.appendChild(this.contentEl_),n},n.dispose=function(){this.contentEl_=null,this.textNode_=null,e.prototype.dispose.call(this)},n.updateTextNode_=function(){if(this.contentEl_){for(;this.contentEl_.firstChild;)this.contentEl_.removeChild(this.contentEl_.firstChild);this.textNode_=sm.a.createTextNode(this.formattedTime_||this.formatTime_(0)),this.contentEl_.appendChild(this.textNode_)}},n.formatTime_=function(e){return Wy(e)},n.updateFormattedTime_=function(e){var t=this.formatTime_(e);t!==this.formattedTime_&&(this.formattedTime_=t,this.requestAnimationFrame(this.updateTextNode_))},n.updateContent=function(e){},t}(sb);Xy.prototype.labelText_="Time",Xy.prototype.controlText_="Time",sb.registerComponent("TimeDisplay",Xy);var Yy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,"ended",i.handleEnded),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-current-time"},n.updateContent=function(e){var t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.updateFormattedTime_(t)},n.handleEnded=function(e){this.player_.duration()&&this.updateFormattedTime_(this.player_.duration())},t}(Xy);Yy.prototype.labelText_="Current Time",Yy.prototype.controlText_="Current Time",sb.registerComponent("CurrentTimeDisplay",Yy);var Ky=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,"durationchange",i.updateContent),i.on(t,"loadstart",i.updateContent),i.on(t,"loadedmetadata",i.throttledUpdateContent),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-duration"},n.updateContent=function(e){var t=this.player_.duration();this.duration_!==t&&(this.duration_=t,this.updateFormattedTime_(t))},t}(Xy);Ky.prototype.labelText_="Duration",Ky.prototype.controlText_="Duration",sb.registerComponent("DurationDisplay",Ky),sb.registerComponent("TimeDivider",function(e){function t(){return e.apply(this,arguments)||this}return S_(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"},{"aria-hidden":!0})},t}(sb));var Qy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,"durationchange",i.throttledUpdateContent),i.on(t,"ended",i.handleEnded),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-remaining-time"},n.createEl=function(){var t=e.prototype.createEl.call(this);return t.insertBefore(Y_("span",{},{"aria-hidden":!0},"-"),this.contentEl_),t},n.updateContent=function(e){"number"==typeof this.player_.duration()&&this.updateFormattedTime_(this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime())},n.handleEnded=function(e){this.player_.duration()&&this.updateFormattedTime_(0)},t}(Xy);Qy.prototype.labelText_="Remaining Time",Qy.prototype.controlText_="Remaining Time",sb.registerComponent("RemainingTimeDisplay",Qy),sb.registerComponent("LiveDisplay",function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).updateShowing(),i.on(i.player(),"durationchange",i.updateShowing),i}S_(t,e);var n=t.prototype;return n.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Y_("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+"\xa0</span>"+this.localize("LIVE")},{"aria-live":"off"}),t.appendChild(this.contentEl_),t},n.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},n.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},t}(sb));var qy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).updateLiveEdgeStatus(),i.player_.liveTracker&&i.on(i.player_.liveTracker,"liveedgechange",i.updateLiveEdgeStatus),i}S_(t,e);var n=t.prototype;return n.createEl=function(){var t=e.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Y_("span",{className:"vjs-seek-to-live-text",innerHTML:this.localize("LIVE")},{"aria-hidden":"true"}),t.appendChild(this.textEl_),t},n.updateLiveEdgeStatus=function(e){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},n.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},n.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatus),this.textEl_=null,e.prototype.dispose.call(this)},t}(Vy);qy.prototype.controlText_="Seek to live, currently playing live",sb.registerComponent("SeekToLive",qy);var Zy=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).bar=i.getChild(i.options_.barName),i.vertical(!!i.options_.vertical),i.enable(),i}S_(t,e);var n=t.prototype;return n.enabled=function(){return this.enabled_},n.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown),this.on("touchstart",this.handleMouseDown),this.on("keydown",this.handleKeyDown),this.on("click",this.handleClick),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},n.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown),this.off("touchstart",this.handleMouseDown),this.off("keydown",this.handleKeyDown),this.off("click",this.handleClick),this.off(this.player_,"controlsvisible",this.update),this.off(e,"mousemove",this.handleMouseMove),this.off(e,"mouseup",this.handleMouseUp),this.off(e,"touchmove",this.handleMouseMove),this.off(e,"touchend",this.handleMouseUp),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},n.createEl=function(t,n,i){return void 0===n&&(n={}),void 0===i&&(i={}),n.className=n.className+" vjs-slider",n=N_({tabIndex:0},n),i=N_({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},i),e.prototype.createEl.call(this,t,n,i)},n.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||Eb||e.preventDefault(),ov(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchmove",this.handleMouseMove),this.on(t,"touchend",this.handleMouseUp),this.handleMouseMove(e)},n.handleMouseMove=function(e){},n.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;av(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove),this.off(e,"mouseup",this.handleMouseUp),this.off(e,"touchmove",this.handleMouseMove),this.off(e,"touchend",this.handleMouseUp),this.update()},n.update=function(){if(this.el_){var e=this.getPercent(),t=this.bar;if(t){("number"!=typeof e||e!=e||e<0||e===1/0)&&(e=0);var n=(100*e).toFixed(2)+"%",i=t.el().style;return this.vertical()?i.height=n:i.width=n,e}}},n.calculateDistance=function(e){var t=cv(this.el_,e);return this.vertical()?t.y:t.x},n.handleKeyDown=function(t){fm.a.isEventKey(t,"Left")||fm.a.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepBack()):fm.a.isEventKey(t,"Right")||fm.a.isEventKey(t,"Up")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):e.prototype.handleKeyDown.call(this,t)},n.handleClick=function(e){e.stopPropagation(),e.preventDefault()},n.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.addClass(this.vertical_?"vjs-slider-vertical":"vjs-slider-horizontal")},t}(sb);sb.registerComponent("Slider",Zy),sb.registerComponent("LoadProgressBar",function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).partEls_=[],i.on(t,"progress",i.update),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+'</span>: <span class="vjs-control-text-loaded-percentage">0%</span></span>'})},n.dispose=function(){this.partEls_=null,e.prototype.dispose.call(this)},n.update=function(e){var t=this.player_.liveTracker,n=this.player_.buffered(),i=t&&t.isLive()?t.seekableEnd():this.player_.duration(),r=this.player_.bufferedEnd(),o=this.partEls_,a=this.$(".vjs-control-text-loaded-percentage"),s=function(e,t,n){var i=e/t||0;return i=100*(i>=1?1:i),n&&(i=i.toFixed(2)),i+"%"};this.el_.style.width=s(r,i),K_(a,s(r,i,!0));for(var l=0;l<n.length;l++){var c=n.start(l),u=n.end(l),h=o[l];h||(h=this.el_.appendChild(Y_()),o[l]=h),h.style.left=s(c,r),h.style.width=s(u-c,r)}for(var d=o.length;d>n.length;d--)this.el_.removeChild(o[d-1]);o.length=n.length},t}(sb)),sb.registerComponent("TimeTooltip",function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},n.update=function(e,t,n){var i=sv(this.el_),r=sv(this.player_.el()),o=e.width*t;if(r&&i){var a=e.left-r.left+o,s=e.width-o+(r.right-e.right),l=i.width/2;a<l?l+=l-a:s<l&&(l=s),l<0?l=0:l>i.width&&(l=i.width),this.el_.style.right="-"+l+"px",this.write(n)}},n.write=function(e){K_(this.el_,e)},n.updateTime=function(e,t,n,i){var r=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var o,a=r.player_.duration();if(r.player_.liveTracker&&r.player_.liveTracker.isLive()){var s=r.player_.liveTracker.liveWindow(),l=s-t*s;o=(l<1?"":"-")+Wy(l,s)}else o=Wy(n,a);r.update(e,t,o),i&&i()})},t}(sb));var Jy=function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},n.update=function(e,t){var n=this.getChild("timeTooltip");if(n){var i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,i)}},t}(sb);Jy.prototype.options_={children:[]},gb||_b||Jy.prototype.options_.children.push("timeTooltip"),sb.registerComponent("PlayProgressBar",Jy);var $y=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).update=Wv(Hv(R_(i),i.update),25),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},n.update=function(e,t){var n=this,i=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,i,function(){n.el_.style.left=e.width*t+"px"})},t}(sb);$y.prototype.options_={children:["timeTooltip"]},sb.registerComponent("MouseTimeDisplay",$y);var eT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).setEventHandlers_(),i}S_(t,e);var n=t.prototype;return n.setEventHandlers_=function(){this.update=Wv(Hv(this,this.update),30),this.on(this.player_,"timeupdate",this.update),this.on(this.player_,"ended",this.handleEnded),this.on(this.player_,"durationchange",this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.on(this.player_,["playing"],this.enableInterval_),this.on(this.player_,["ended","pause","waiting"],this.disableInterval_),"hidden"in sm.a&&"visibilityState"in sm.a&&this.on(sm.a,"visibilitychange",this.toggleVisibility_)},n.toggleVisibility_=function(e){sm.a.hidden?this.disableInterval_(e):(this.enableInterval_(),this.requestAnimationFrame(this.update))},n.enableInterval_=function(){var e=this;this.clearInterval(this.updateInterval),this.updateInterval=this.setInterval(function(){e.requestAnimationFrame(e.update)},30)},n.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&"ended"!==e.type||this.clearInterval(this.updateInterval)},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},n.update_=function(e,t){var n=this.player_.liveTracker,i=this.player_.duration();n&&n.isLive()&&(i=this.player_.liveTracker.liveCurrentTime()),this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[Wy(e,i),Wy(i,i)],"{1} of {2}")),this.bar&&this.bar.update(sv(this.el_),t)},n.update=function(t){if(null!==this.el().offsetParent){var n=e.prototype.update.call(this);return this.update_(this.getCurrentTime_(),n),n}},n.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},n.handleEnded=function(e){this.update_(this.player_.duration(),1)},n.getPercent=function(){var e,t=this.getCurrentTime_(),n=this.player_.liveTracker;return n&&n.isLive()?(e=(t-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(e=1)):e=t/this.player_.duration(),e>=1?1:e||0},n.handleMouseDown=function(t){gv(t)&&(t.stopPropagation(),this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),e.prototype.handleMouseDown.call(this,t))},n.handleMouseMove=function(e){if(gv(e)){var t,n=this.calculateDistance(e),i=this.player_.liveTracker;if(i&&i.isLive()){var r=i.seekableStart(),o=i.liveCurrentTime();if((t=r+n*i.liveWindow())>=o&&(t=o),t<=r&&(t=r+.1),t===1/0)return}else(t=n*this.player_.duration())===this.player_.duration()&&(t-=.1);this.player_.currentTime(t)}},n.enable=function(){e.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.show()},n.disable=function(){e.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.hide()},n.handleMouseUp=function(t){e.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying&&jb(this.player_.play())},n.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},n.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},n.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},n.handleKeyDown=function(t){if(fm.a.isEventKey(t,"Space")||fm.a.isEventKey(t,"Enter"))t.preventDefault(),t.stopPropagation(),this.handleAction(t);else if(fm.a.isEventKey(t,"Home"))t.preventDefault(),t.stopPropagation(),this.player_.currentTime(0);else if(fm.a.isEventKey(t,"End"))t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.duration());else if(/^[0-9]$/.test(fm()(t))){t.preventDefault(),t.stopPropagation();var n=10*(fm.a.codes[fm()(t)]-fm.a.codes[0])/100;this.player_.currentTime(this.player_.duration()*n)}else fm.a.isEventKey(t,"PgDn")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.currentTime()-60)):fm.a.isEventKey(t,"PgUp")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.currentTime()+60)):e.prototype.handleKeyDown.call(this,t)},t}(Zy);eT.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},gb||_b||eT.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),sb.registerComponent("SeekBar",eT);var tT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).handleMouseMove=Wv(Hv(R_(i),i.handleMouseMove),25),i.throttledHandleMouseSeek=Wv(Hv(R_(i),i.handleMouseSeek),25),i.enable(),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},n.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var n=t.getChild("mouseTimeDisplay"),i=t.el(),r=sv(i),o=cv(i,e).x;o>1?o=1:o<0&&(o=0),n&&n.update(r,o)}},n.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},n.enabled=function(){return this.enabled_},n.disable=function(){this.children().forEach(function(e){return e.disable&&e.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDown),this.off(this.el_,"mousemove",this.handleMouseMove),this.handleMouseUp(),this.addClass("disabled"),this.enabled_=!1)},n.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDown),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},n.handleMouseDown=function(e){var t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchend",this.handleMouseUp)},n.handleMouseUp=function(e){var t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseUp(e),this.off(t,"mousemove",this.throttledHandleMouseSeek),this.off(t,"touchmove",this.throttledHandleMouseSeek),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},t}(sb);tT.prototype.options_={children:["seekBar"]},sb.registerComponent("ProgressControl",tT);var nT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,["enterpictureinpicture","leavepictureinpicture"],i.handlePictureInPictureChange),sm.a.pictureInPictureEnabled||i.disable(),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-picture-in-picture-control "+e.prototype.buildCSSClass.call(this)},n.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture")},n.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},t}(Vy);nT.prototype.controlText_="Picture-in-Picture",sb.registerComponent("PictureInPictureToggle",nT);var iT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,"fullscreenchange",i.handleFullscreenChange),!1===sm.a[t.fsApi_.fullscreenEnabled]&&i.disable(),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)},n.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},n.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},t}(Vy);iT.prototype.controlText_="Fullscreen",sb.registerComponent("FullscreenToggle",iT);var rT=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})};sb.registerComponent("VolumeLevel",function(e){function t(){return e.apply(this,arguments)||this}return S_(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},t}(sb));var oT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on("slideractive",i.updateLastVolume_),i.on(t,"volumechange",i.updateARIAAttributes),t.ready(function(){return i.updateARIAAttributes()}),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},n.handleMouseDown=function(t){gv(t)&&e.prototype.handleMouseDown.call(this,t)},n.handleMouseMove=function(e){gv(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},n.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},n.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},n.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},n.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},n.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},n.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},n.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},t}(Zy);oT.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},oT.prototype.playerEvent="volumechange",sb.registerComponent("VolumeBar",oT);var aT=function(e){function t(t,n){var i;return void 0===n&&(n={}),n.vertical=n.vertical||!1,(void 0===n.volumeBar||B_(n.volumeBar))&&(n.volumeBar=n.volumeBar||{},n.volumeBar.vertical=n.vertical),i=e.call(this,t,n)||this,rT(R_(i),t),i.throttledHandleMouseMove=Wv(Hv(R_(i),i.handleMouseMove),25),i.on("mousedown",i.handleMouseDown),i.on("touchstart",i.handleMouseDown),i.on(i.volumeBar,["focus","slideractive"],function(){i.volumeBar.addClass("vjs-slider-active"),i.addClass("vjs-slider-active"),i.trigger("slideractive")}),i.on(i.volumeBar,["blur","sliderinactive"],function(){i.volumeBar.removeClass("vjs-slider-active"),i.removeClass("vjs-slider-active"),i.trigger("sliderinactive")}),i}S_(t,e);var n=t.prototype;return n.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},n.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchend",this.handleMouseUp)},n.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},n.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},t}(sb);aT.prototype.options_={children:["volumeBar"]},sb.registerComponent("VolumeControl",aT);var sT=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})},lT=function(e){function t(t,n){var i;return i=e.call(this,t,n)||this,sT(R_(i),t),i.on(t,["loadstart","volumechange"],i.update),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)},n.handleClick=function(e){var t=this.player_.volume(),n=this.player_.lastVolume_();0===t?(this.player_.volume(n<.1?.1:n),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},n.update=function(e){this.updateIcon_(),this.updateControlText_()},n.updateIcon_=function(){var e=this.player_.volume(),t=3;gb&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var n=0;n<4;n++)J_(this.el_,"vjs-vol-"+n);Z_(this.el_,"vjs-vol-"+t)},n.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)},t}(Vy);lT.prototype.controlText_="Mute",sb.registerComponent("MuteToggle",lT);var cT=function(e){function t(t,n){var i;return void 0===n&&(n={}),n.inline=void 0===n.inline||n.inline,(void 0===n.volumeControl||B_(n.volumeControl))&&(n.volumeControl=n.volumeControl||{},n.volumeControl.vertical=!n.inline),(i=e.call(this,t,n)||this).on(t,["loadstart"],i.volumePanelState_),i.on(i.volumeControl,["slideractive"],i.sliderActive_),i.on(i.volumeControl,["sliderinactive"],i.sliderInactive_),i}S_(t,e);var n=t.prototype;return n.sliderActive_=function(){this.addClass("vjs-slider-active")},n.sliderInactive_=function(){this.removeClass("vjs-slider-active")},n.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},n.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},t}(sb);cT.prototype.options_={children:["muteToggle","volumeControl"]},sb.registerComponent("VolumePanel",cT);var uT=function(e){function t(t,n){var i;return i=e.call(this,t,n)||this,n&&(i.menuButton_=n.menuButton),i.focusedChild_=-1,i.on("keydown",i.handleKeyDown),i.boundHandleBlur_=Hv(R_(i),i.handleBlur),i.boundHandleTapClick_=Hv(R_(i),i.handleTapClick),i}S_(t,e);var n=t.prototype;return n.addEventListenerForItem=function(e){e instanceof sb&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},n.removeEventListenerForItem=function(e){e instanceof sb&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},n.removeChild=function(t){"string"==typeof t&&(t=this.getChild(t)),this.removeEventListenerForItem(t),e.prototype.removeChild.call(this,t)},n.addItem=function(e){var t=this.addChild(e);t&&this.addEventListenerForItem(t)},n.createEl=function(){this.contentEl_=Y_(this.options_.contentElType||"ul",{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var t=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),wv(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t},n.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,e.prototype.dispose.call(this)},n.handleBlur=function(e){var t=e.relatedTarget||sm.a.activeElement;if(!this.children().some(function(e){return e.el()===t})){var n=this.menuButton_;n&&n.buttonPressed_&&t!==n.el().firstChild&&n.unpressButton()}},n.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var t=this.children();if(!Array.isArray(t))return;var n=t.filter(function(t){return t.el()===e.target})[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}},n.handleKeyDown=function(e){fm.a.isEventKey(e,"Left")||fm.a.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(fm.a.isEventKey(e,"Right")||fm.a.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},n.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},n.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},n.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].className&&/vjs-menu-title/.test(t[0].className)&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},t}(sb);sb.registerComponent("Menu",uT);var hT=function(e){function t(t,n){var i;void 0===n&&(n={}),(i=e.call(this,t,n)||this).menuButton_=new Vy(t,n),i.menuButton_.controlText(i.controlText_),i.menuButton_.el_.setAttribute("aria-haspopup","true");var r=Vy.prototype.buildCSSClass();return i.menuButton_.el_.className=i.buildCSSClass()+" "+r,i.menuButton_.removeClass("vjs-control"),i.addChild(i.menuButton_),i.update(),i.enabled_=!0,i.on(i.menuButton_,"tap",i.handleClick),i.on(i.menuButton_,"click",i.handleClick),i.on(i.menuButton_,"keydown",i.handleKeyDown),i.on(i.menuButton_,"mouseenter",function(){i.menu.show()}),i.on("keydown",i.handleSubmenuKeyDown),i}S_(t,e);var n=t.prototype;return n.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},n.createMenu=function(){var e=new uT(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=Y_("li",{className:"vjs-menu-title",innerHTML:ob(this.options_.title),tabIndex:-1});this.hideThreshold_+=1;var n=new sb(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(var i=0;i<this.items.length;i++)e.addItem(this.items[i]);return e},n.createItems=function(){},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},n.buildWrapperCSSClass=function(){var t="vjs-menu-button";return"vjs-menu-button "+(t+=!0===this.options_.inline?"-inline":"-popup")+" "+Vy.prototype.buildCSSClass()+" "+e.prototype.buildCSSClass.call(this)},n.buildCSSClass=function(){var t="vjs-menu-button";return"vjs-menu-button "+(t+=!0===this.options_.inline?"-inline":"-popup")+" "+e.prototype.buildCSSClass.call(this)},n.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},n.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},n.focus=function(){this.menuButton_.focus()},n.blur=function(){this.menuButton_.blur()},n.handleKeyDown=function(e){fm.a.isEventKey(e,"Esc")||fm.a.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),fm.a.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(fm.a.isEventKey(e,"Up")||fm.a.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},n.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},n.handleSubmenuKeyDown=function(e){(fm.a.isEventKey(e,"Esc")||fm.a.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),fm.a.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},n.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),gb&&W_())return;this.menu.focus()}},n.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},n.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},n.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},t}(sb);sb.registerComponent("MenuButton",hT);var dT=function(e){function t(t,n){var i,r=n.tracks;if((i=e.call(this,t,n)||this).items.length<=1&&i.hide(),!r)return R_(i);var o=Hv(R_(i),i.update);return r.addEventListener("removetrack",o),r.addEventListener("addtrack",o),i.player_.on("ready",o),i.player_.on("dispose",function(){r.removeEventListener("removetrack",o),r.removeEventListener("addtrack",o)}),i}return S_(t,e),t}(hT);sb.registerComponent("TrackButton",dT);var fT=["Tab","Esc","Up","Down","Right","Left"],pT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).selectable=n.selectable,i.isSelected_=n.selected||!1,i.multiSelectable=n.multiSelectable,i.selected(i.isSelected_),i.el_.setAttribute("role",i.selectable?i.multiSelectable?"menuitemcheckbox":"menuitemradio":"menuitem"),i}S_(t,e);var n=t.prototype;return n.createEl=function(t,n,i){return this.nonIconControl=!0,e.prototype.createEl.call(this,"li",N_({className:"vjs-menu-item",innerHTML:'<span class="vjs-menu-item-text">'+this.localize(this.options_.label)+"</span>",tabIndex:-1},n),i)},n.handleKeyDown=function(t){fT.some(function(e){return fm.a.isEventKey(t,e)})||e.prototype.handleKeyDown.call(this,t)},n.handleClick=function(e){this.selected(!0)},n.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(Ny);sb.registerComponent("MenuItem",pT);var gT=function(e){function t(t,n){var i,r=n.track,o=t.textTracks();n.label=r.label||r.language||"Unknown",n.selected="showing"===r.mode,(i=e.call(this,t,n)||this).track=r,i.kinds=(n.kinds||[n.kind||i.track.kind]).filter(Boolean);var a,s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.handleTracksChange.apply(R_(i),t)},l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.handleSelectedLanguageChange.apply(R_(i),t)};return t.on(["loadstart","texttrackchange"],s),o.addEventListener("change",s),o.addEventListener("selectedlanguagechange",l),i.on("dispose",function(){t.off(["loadstart","texttrackchange"],s),o.removeEventListener("change",s),o.removeEventListener("selectedlanguagechange",l)}),void 0===o.onchange&&i.on(["tap","click"],function(){if("object"!=typeof om.a.Event)try{a=new om.a.Event("change")}catch(e){}a||(a=sm.a.createEvent("Event")).initEvent("change",!0,!0),o.dispatchEvent(a)}),i.handleTracksChange(),i}S_(t,e);var n=t.prototype;return n.handleClick=function(t){var n=this.track,i=this.player_.textTracks();if(e.prototype.handleClick.call(this,t),i)for(var r=0;r<i.length;r++){var o=i[r];-1!==this.kinds.indexOf(o.kind)&&(o===n?"showing"!==o.mode&&(o.mode="showing"):"disabled"!==o.mode&&(o.mode="disabled"))}},n.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},n.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},n.dispose=function(){this.track=null,e.prototype.dispose.call(this)},t}(pT);sb.registerComponent("TextTrackMenuItem",gT);var mT=function(e){function t(t,n){return n.track={player:t,kind:n.kind,kinds:n.kinds,default:!1,mode:"disabled"},n.kinds||(n.kinds=[n.kind]),n.track.label=n.label?n.label:n.kinds.join(" and ")+" off",n.selectable=!0,n.multiSelectable=!1,e.call(this,t,n)||this}S_(t,e);var n=t.prototype;return n.handleTracksChange=function(e){for(var t=this.player().textTracks(),n=!0,i=0,r=t.length;i<r;i++){var o=t[i];if(this.options_.kinds.indexOf(o.kind)>-1&&"showing"===o.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)},n.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),n=!0,i=0,r=t.length;i<r;i++){var o=t[i];if(["captions","descriptions","subtitles"].indexOf(o.kind)>-1&&"showing"===o.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(gT);sb.registerComponent("OffTextTrackMenuItem",mT);var _T=function(e){function t(t,n){return void 0===n&&(n={}),n.tracks=t.textTracks(),e.call(this,t,n)||this}return S_(t,e),t.prototype.createItems=function(e,t){var n;void 0===e&&(e=[]),void 0===t&&(t=gT),this.label_&&(n=this.label_+" off"),e.push(new mT(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;var i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var r=0;r<i.length;r++){var o=i[r];if(this.kinds_.indexOf(o.kind)>-1){var a=new t(this.player_,{track:o,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});a.addClass("vjs-"+o.kind+"-menu-item"),e.push(a)}}return e},t}(dT);sb.registerComponent("TextTrackButton",_T);var vT=function(e){function t(t,n){var i,r=n.track,o=n.cue,a=t.currentTime();return n.selectable=!0,n.multiSelectable=!1,n.label=o.text,n.selected=o.startTime<=a&&a<o.endTime,(i=e.call(this,t,n)||this).track=r,i.cue=o,r.addEventListener("cuechange",Hv(R_(i),i.update)),i}S_(t,e);var n=t.prototype;return n.handleClick=function(t){e.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},n.update=function(e){var t=this.cue,n=this.player_.currentTime();this.selected(t.startTime<=n&&n<t.endTime)},t}(pT);sb.registerComponent("ChaptersTrackMenuItem",vT);var bT=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildWrapperCSSClass.call(this)},n.update=function(t){this.track_&&(!t||"addtrack"!==t.type&&"removetrack"!==t.type)||this.setTrack(this.findChaptersTrack()),e.prototype.update.call(this)},n.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var n=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);n&&n.addEventListener("load",this.updateHandler_)}}},n.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var n=e[t];if(n.kind===this.kind_)return n}},n.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(ob(this.kind_))},n.createMenu=function(){return this.options_.title=this.getMenuCaption(),e.prototype.createMenu.call(this)},n.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var n=0,i=t.length;n<i;n++){var r=new vT(this.player_,{track:this.track_,cue:t[n]});e.push(r)}return e},t}(_T);bT.prototype.kind_="chapters",bT.prototype.controlText_="Chapters",sb.registerComponent("ChaptersButton",bT);var yT=function(e){function t(t,n,i){var r;r=e.call(this,t,n,i)||this;var o=t.textTracks(),a=Hv(R_(r),r.handleTracksChange);return o.addEventListener("change",a),r.on("dispose",function(){o.removeEventListener("change",a)}),r}S_(t,e);var n=t.prototype;return n.handleTracksChange=function(e){for(var t=this.player().textTracks(),n=!1,i=0,r=t.length;i<r;i++){var o=t[i];if(o.kind!==this.kind_&&"showing"===o.mode){n=!0;break}}n?this.disable():this.enable()},n.buildCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(_T);yT.prototype.kind_="descriptions",yT.prototype.controlText_="Descriptions",sb.registerComponent("DescriptionsButton",yT);var TT=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(_T);TT.prototype.kind_="subtitles",TT.prototype.controlText_="Subtitles",sb.registerComponent("SubtitlesButton",TT);var ET=function(e){function t(t,n){var i;return n.track={player:t,kind:n.kind,label:n.kind+" settings",selectable:!1,default:!1,mode:"disabled"},n.selectable=!1,n.name="CaptionSettingsMenuItem",(i=e.call(this,t,n)||this).addClass("vjs-texttrack-settings"),i.controlText(", opens "+n.kind+" settings dialog"),i}return S_(t,e),t.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},t}(gT);sb.registerComponent("CaptionSettingsMenuItem",ET);var xT=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-captions-button "+e.prototype.buildWrapperCSSClass.call(this)},n.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new ET(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t)},t}(_T);xT.prototype.kind_="captions",xT.prototype.controlText_="Captions",sb.registerComponent("CaptionsButton",xT);var CT=function(e){function t(){return e.apply(this,arguments)||this}return S_(t,e),t.prototype.createEl=function(t,n,i){var r='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"captions"===this.options_.track.kind&&(r+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Captions")+"</span>\n      "),e.prototype.createEl.call(this,t,N_({innerHTML:r+="</span>"},n),i)},t}(gT);sb.registerComponent("SubsCapsMenuItem",CT);var ST=function(e){function t(t,n){var i;return void 0===n&&(n={}),(i=e.call(this,t,n)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(i.player_.language_)>-1&&(i.label_="captions"),i.menuButton_.controlText(ob(i.label_)),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildWrapperCSSClass.call(this)},n.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new ET(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t,CT)},t}(_T);ST.prototype.kinds_=["captions","subtitles"],ST.prototype.controlText_="Subtitles",sb.registerComponent("SubsCapsButton",ST);var AT=function(e){function t(t,n){var i,r=n.track,o=t.audioTracks();n.label=r.label||r.language||"Unknown",n.selected=r.enabled,(i=e.call(this,t,n)||this).track=r,i.addClass("vjs-"+r.kind+"-menu-item");var a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i.handleTracksChange.apply(R_(i),t)};return o.addEventListener("change",a),i.on("dispose",function(){o.removeEventListener("change",a)}),i}S_(t,e);var n=t.prototype;return n.createEl=function(t,n,i){var r='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"main-desc"===this.options_.track.kind&&(r+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Descriptions")+"</span>\n      "),e.prototype.createEl.call(this,t,N_({innerHTML:r+="</span>"},n),i)},n.handleClick=function(t){var n=this.player_.audioTracks();e.prototype.handleClick.call(this,t);for(var i=0;i<n.length;i++){var r=n[i];r.enabled=r===this.track}},n.handleTracksChange=function(e){this.selected(this.track.enabled)},t}(pT);sb.registerComponent("AudioTrackMenuItem",AT);var PT=function(e){function t(t,n){return void 0===n&&(n={}),n.tracks=t.audioTracks(),e.call(this,t,n)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-audio-button "+e.prototype.buildWrapperCSSClass.call(this)},n.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),n=0;n<t.length;n++)e.push(new AT(this.player_,{track:t[n],selectable:!0,multiSelectable:!1}));return e},t}(dT);PT.prototype.controlText_="Audio Track",sb.registerComponent("AudioTrackButton",PT);var RT=function(e){function t(t,n){var i,r=n.rate,o=parseFloat(r,10);return n.label=r,n.selected=1===o,n.selectable=!0,n.multiSelectable=!1,(i=e.call(this,t,n)||this).label=r,i.rate=o,i.on(t,"ratechange",i.update),i}S_(t,e);var n=t.prototype;return n.handleClick=function(t){e.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},n.update=function(e){this.selected(this.player().playbackRate()===this.rate)},t}(pT);RT.prototype.contentElType="button",sb.registerComponent("PlaybackRateMenuItem",RT);var MT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).updateVisibility(),i.updateLabel(),i.on(t,"loadstart",i.updateVisibility),i.on(t,"ratechange",i.updateLabel),i}S_(t,e);var n=t.prototype;return n.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelEl_=Y_("div",{className:"vjs-playback-rate-value",innerHTML:"1x"}),t.appendChild(this.labelEl_),t},n.dispose=function(){this.labelEl_=null,e.prototype.dispose.call(this)},n.buildCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildWrapperCSSClass.call(this)},n.createMenu=function(){var e=new uT(this.player()),t=this.playbackRates();if(t)for(var n=t.length-1;n>=0;n--)e.addChild(new RT(this.player(),{rate:t[n]+"x"}));return e},n.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},n.handleClick=function(e){for(var t=this.player().playbackRate(),n=this.playbackRates(),i=n[0],r=0;r<n.length;r++)if(n[r]>t){i=n[r];break}this.player().playbackRate(i)},n.playbackRates=function(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates},n.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},n.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},n.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},t}(hT);MT.prototype.controlText_="Playback Rate",sb.registerComponent("PlaybackRateMenuButton",MT);var OT=function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)},n.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},t}(sb);sb.registerComponent("Spacer",OT),sb.registerComponent("CustomControlSpacer",function(e){function t(){return e.apply(this,arguments)||this}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},n.createEl=function(){var t=e.prototype.createEl.call(this,{className:this.buildCSSClass()});return t.innerHTML="\xa0",t},t}(OT));var wT=function(e){function t(){return e.apply(this,arguments)||this}return S_(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},t}(sb);wT.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},sb.registerComponent("ControlBar",wT);var IT=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).on(t,"error",i.open),i}S_(t,e);var n=t.prototype;return n.buildCSSClass=function(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)},n.content=function(){var e=this.player().error();return e?this.localize(e.message):""},t}(Xb);IT.prototype.options_=ab(Xb.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),sb.registerComponent("ErrorDisplay",IT);var DT=["#000","Black"],LT=["#00F","Blue"],kT=["#0FF","Cyan"],NT=["#0F0","Green"],FT=["#F0F","Magenta"],BT=["#F00","Red"],UT=["#FFF","White"],VT=["#FF0","Yellow"],GT=["1","Opaque"],zT=["0.5","Semi-Transparent"],jT=["0","Transparent"],HT={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[DT,UT,BT,NT,LT,VT,FT,kT]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[GT,zT,jT]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[UT,DT,BT,NT,LT,VT,FT,kT]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(e){return"1.00"===e?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[GT,zT]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[jT,zT,GT]}};function WT(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}HT.windowColor.options=HT.backgroundColor.options,sb.registerComponent("TextTrackSettings",function(e){function t(t,n){var i;return n.temporary=!1,(i=e.call(this,t,n)||this).updateDisplay=Hv(R_(i),i.updateDisplay),i.fill(),i.hasBeenOpened_=i.hasBeenFilled_=!0,i.endDialog=Y_("p",{className:"vjs-control-text",textContent:i.localize("End of dialog window.")}),i.el().appendChild(i.endDialog),i.setDefaults(),void 0===n.persistTextTrackSettings&&(i.options_.persistTextTrackSettings=i.options_.playerOptions.persistTextTrackSettings),i.on(i.$(".vjs-done-button"),"click",function(){i.saveSettings(),i.close()}),i.on(i.$(".vjs-default-button"),"click",function(){i.setDefaults(),i.updateDisplay()}),k_(HT,function(e){i.on(i.$(e.selector),"change",i.updateDisplay)}),i.options_.persistTextTrackSettings&&i.restoreSettings(),i}S_(t,e);var n=t.prototype;return n.dispose=function(){this.endDialog=null,e.prototype.dispose.call(this)},n.createElSelect_=function(e,t,n){var i=this;void 0===t&&(t=""),void 0===n&&(n="label");var r=HT[e],o=r.id.replace("%s",this.id_),a=[t,o].join(" ").trim();return["<"+n+' id="'+o+'" class="'+("label"===n?"vjs-label":"")+'">',this.localize(r.label),"</"+n+">",'<select aria-labelledby="'+a+'">'].concat(r.options.map(function(e){var t=o+"-"+e[1].replace(/\W+/g,"");return['<option id="'+t+'" value="'+e[0]+'" ','aria-labelledby="'+a+" "+t+'">',i.localize(e[1]),"</option>"].join("")})).concat("</select>").join("")},n.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},n.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},n.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},n.createElColors_=function(){return Y_("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},n.createElFont_=function(){return Y_("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},n.createElControls_=function(){var e=this.localize("restore all settings to the default values");return Y_("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},n.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},n.label=function(){return this.localize("Caption Settings Dialog")},n.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},n.buildCSSClass=function(){return e.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},n.getValues=function(){var e,t,n,i=this;return t=function(e,t,n){var r,o=WT((r=i.$(t.selector)).options[r.options.selectedIndex].value,t.parser);return void 0!==o&&(e[n]=o),e},void 0===(n={})&&(n=0),L_(e=HT).reduce(function(n,i){return t(n,e[i],i)},n)},n.setValues=function(e){var t=this;k_(HT,function(n,i){!function(e,t,n){if(t)for(var i=0;i<e.options.length;i++)if(WT(e.options[i].value,n)===t){e.selectedIndex=i;break}}(t.$(n.selector),e[i],n.parser)})},n.setDefaults=function(){var e=this;k_(HT,function(t){var n=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=n})},n.restoreSettings=function(){var e;try{e=JSON.parse(om.a.localStorage.getItem("vjs-text-track-settings"))}catch(t){w_.warn(t)}e&&this.setValues(e)},n.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?om.a.localStorage.setItem("vjs-text-track-settings",JSON.stringify(e)):om.a.localStorage.removeItem("vjs-text-track-settings")}catch(t){w_.warn(t)}}},n.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},n.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,n=e&&e.captionsButton;t?t.focus():n&&n.focus()},t}(Xb)),sb.registerComponent("ResizeManager",function(e){function t(t,n){var i,r=n.ResizeObserver||om.a.ResizeObserver;null===n.ResizeObserver&&(r=!1);var o=ab({createEl:!r,reportTouchActivity:!1},n);return(i=e.call(this,t,o)||this).ResizeObserver=n.ResizeObserver||om.a.ResizeObserver,i.loadListener_=null,i.resizeObserver_=null,i.debouncedHandler_=Xv(function(){i.resizeHandler()},100,!1,R_(i)),r?(i.resizeObserver_=new i.ResizeObserver(i.debouncedHandler_),i.resizeObserver_.observe(t.el())):(i.loadListener_=function(){if(i.el_&&i.el_.contentWindow){var e=i.debouncedHandler_,t=i.unloadListener_=function(){Iv(this,"resize",e),Iv(this,"unload",t),t=null};wv(i.el_.contentWindow,"unload",t),wv(i.el_.contentWindow,"resize",e)}},i.one("load",i.loadListener_)),i}S_(t,e);var n=t.prototype;return n.createEl=function(){return e.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})},n.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},n.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,e.prototype.dispose.call(this)},t}(sb)),sb.registerComponent("LiveTracker",function(e){function t(t,n){var i,r=ab({createEl:!1},n);return(i=e.call(this,t,r)||this).reset_(),i.on(i.player_,"durationchange",i.handleDurationchange),Cb&&"hidden"in sm.a&&"visibilityState"in sm.a&&i.on(sm.a,"visibilitychange",i.handleVisibilityChange),i}S_(t,e);var n=t.prototype;return n.handleVisibilityChange=function(){this.player_.duration()===1/0&&(sm.a.hidden?this.stopTracking():this.startTracking())},n.isBehind_=function(){if(!this.timeupdateSeen_)return!1;var e=this.liveCurrentTime(),t=this.player_.currentTime();return e!==1/0&&e-(2*this.seekableIncrement_+.07)>=t},n.trackLive_=function(){this.pastSeekEnd_=this.pastSeekEnd_;var e=this.player_.seekable();if(e&&e.length){var t=this.seekableEnd();t!==this.lastSeekEnd_&&(this.lastSeekEnd_&&(this.seekableIncrement_=Math.abs(t-this.lastSeekEnd_)),this.pastSeekEnd_=0,this.lastSeekEnd_=t,this.trigger("seekableendchange")),this.pastSeekEnd_=this.pastSeekEnd()+.03,this.isBehind_()!==this.behindLiveEdge()&&(this.behindLiveEdge_=this.isBehind_(),this.trigger("liveedgechange"))}},n.handleDurationchange=function(){this.player_.duration()===1/0?this.startTracking():this.stopTracking()},n.startTracking=function(){var e=this;this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLive_,30),this.trackLive_(),this.on(this.player_,"play",this.trackLive_),this.on(this.player_,"pause",this.trackLive_),this.timeupdateSeen_||(this.one(this.player_,"play",this.handlePlay),this.handleTimeupdate=function(){e.timeupdateSeen_=!0,e.handleTimeupdate=null},this.one(this.player_,"timeupdate",this.handleTimeupdate)))},n.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge)},n.reset_=function(){this.pastSeekEnd_=0,this.lastSeekEnd_=null,this.behindLiveEdge_=null,this.timeupdateSeen_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.seekableIncrement_=12,this.off(this.player_,"play",this.trackLive_),this.off(this.player_,"pause",this.trackLive_),this.off(this.player_,"play",this.handlePlay),this.off(this.player_,"timeupdate",this.seekToLiveEdge),this.handleTimeupdate&&(this.off(this.player_,"timeupdate",this.handleTimeupdate),this.handleTimeupdate=null)},n.stopTracking=function(){this.isTracking()&&this.reset_()},n.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],n=e?e.length:0;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0},n.seekableStart=function(){for(var e=this.player_.seekable(),t=[],n=e?e.length:0;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0},n.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?1/0:e-this.seekableStart()},n.isLive=function(){return this.isTracking()},n.atLiveEdge=function(){return!this.behindLiveEdge()},n.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},n.pastSeekEnd=function(){return this.pastSeekEnd_},n.behindLiveEdge=function(){return this.behindLiveEdge_},n.isTracking=function(){return"number"==typeof this.trackingInterval_},n.seekToLiveEdge=function(){this.atLiveEdge()||(this.player_.currentTime(this.liveCurrentTime()),this.player_.paused()&&this.player_.play())},n.dispose=function(){this.stopTracking(),e.prototype.dispose.call(this)},t}(sb));var XT=function(e){var t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;var n=e.$$("source"),i=[],r="";if(!n.length)return!1;for(var o=0;o<n.length;o++){var a=n[o].src;a&&-1===i.indexOf(a)&&i.push(a)}return!!i.length&&(1===i.length&&(r=i[0]),e.triggerSourceset(r),!0)},YT=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(e){var t=sm.a.createElement(this.nodeName.toLowerCase());t.innerHTML=e;for(var n=sm.a.createDocumentFragment();t.childNodes.length;)n.appendChild(t.childNodes[0]);return this.innerText="",om.a.Element.prototype.appendChild.call(this,n),this.innerHTML}}),KT=function(e,t){for(var n={},i=0;i<e.length&&!((n=Object.getOwnPropertyDescriptor(e[i],t))&&n.set&&n.get);i++);return n.enumerable=!0,n.configurable=!0,n},QT=function(e){var t=e.el();if(!t.resetSourceWatch_){var n={},i=function(e){return KT([e.el(),om.a.HTMLMediaElement.prototype,om.a.Element.prototype,YT],"innerHTML")}(e),r=function(n){return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];var a=n.apply(t,r);return XT(e),a}};["append","appendChild","insertAdjacentHTML"].forEach(function(e){t[e]&&(n[e]=t[e],t[e]=r(n[e]))}),Object.defineProperty(t,"innerHTML",ab(i,{set:r(i.set)})),t.resetSourceWatch_=function(){t.resetSourceWatch_=null,Object.keys(n).forEach(function(e){t[e]=n[e]}),Object.defineProperty(t,"innerHTML",i)},e.one("sourceset",t.resetSourceWatch_)}},qT=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?ly(om.a.Element.prototype.getAttribute.call(this,"src")):""},set:function(e){return om.a.Element.prototype.setAttribute.call(this,"src",e),e}});function ZT(){var e=M_(["Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\n            This may prevent text tracks from loading."]);return ZT=function(){return e},e}var JT=function(e){function t(t,n){var i;i=e.call(this,t,n)||this;var r=t.source,o=!1;if(r&&(i.el_.currentSrc!==r.src||t.tag&&3===t.tag.initNetworkState_)?i.setSource(r):i.handleLateInit_(i.el_),t.enableSourceset&&i.setupSourcesetHandling_(),i.el_.hasChildNodes()){for(var a=i.el_.childNodes,s=a.length,l=[];s--;){var c=a[s];"track"===c.nodeName.toLowerCase()&&(i.featuresNativeTextTracks?(i.remoteTextTrackEls().addTrackElement_(c),i.remoteTextTracks().addTrack(c.track),i.textTracks().addTrack(c.track),o||i.el_.hasAttribute("crossorigin")||!uy(c.src)||(o=!0)):l.push(c))}for(var u=0;u<l.length;u++)i.el_.removeChild(l[u])}return i.proxyNativeTracks_(),i.featuresNativeTextTracks&&o&&w_.warn(cm()(ZT())),i.restoreMetadataTracksInIOSNativePlayer_(),(Rb||fb||bb)&&!0===t.nativeControlsForTouch&&i.setControls(!0),i.proxyWebkitFullscreen_(),i.triggerReady(),i}S_(t,e);var n=t.prototype;return n.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),t.disposeMediaElement(this.el_),this.options_=null,e.prototype.dispose.call(this)},n.setupSourcesetHandling_=function(){!function(e){if(e.featuresSourceset){var t=e.el();if(!t.resetSourceset_){var n=function(e){return KT([e.el(),om.a.HTMLMediaElement.prototype,qT],"src")}(e),i=t.setAttribute,r=t.load;Object.defineProperty(t,"src",ab(n,{set:function(i){var r=n.set.call(t,i);return e.triggerSourceset(t.src),r}})),t.setAttribute=function(n,r){var o=i.call(t,n,r);return/src/i.test(n)&&e.triggerSourceset(t.src),o},t.load=function(){var n=r.call(t);return XT(e)||(e.triggerSourceset(""),QT(e)),n},t.currentSrc?e.triggerSourceset(t.currentSrc):XT(e)||QT(e),t.resetSourceset_=function(){t.resetSourceset_=null,t.load=r,t.setAttribute=i,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()}}}}(this)},n.restoreMetadataTracksInIOSNativePlayer_=function(){var e,t=this.textTracks(),n=function(){e=[];for(var n=0;n<t.length;n++){var i=t[n];"metadata"===i.kind&&e.push({track:i,storedMode:i.mode})}};n(),t.addEventListener("change",n),this.on("dispose",function(){return t.removeEventListener("change",n)});var i=function n(){for(var i=0;i<e.length;i++){var r=e[i];"disabled"===r.track.mode&&r.track.mode!==r.storedMode&&(r.track.mode=r.storedMode)}t.removeEventListener("change",n)};this.on("webkitbeginfullscreen",function(){t.removeEventListener("change",n),t.removeEventListener("change",i),t.addEventListener("change",i)}),this.on("webkitendfullscreen",function(){t.removeEventListener("change",n),t.addEventListener("change",n),t.removeEventListener("change",i)})},n.overrideNative_=function(e,t){var n=this;if(t===this["featuresNative"+e+"Tracks"]){var i=e.toLowerCase();this[i+"TracksListeners_"]&&Object.keys(this[i+"TracksListeners_"]).forEach(function(e){n.el()[i+"Tracks"].removeEventListener(e,n[i+"TracksListeners_"][e])}),this["featuresNative"+e+"Tracks"]=!t,this[i+"TracksListeners_"]=null,this.proxyNativeTracksForType_(i)}},n.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},n.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},n.proxyNativeTracksForType_=function(e){var t=this,n=yy[e],i=this.el()[n.getterName],r=this[n.getterName]();if(this["featuresNative"+n.capitalName+"Tracks"]&&i&&i.addEventListener){var o={change:function(e){r.trigger({type:"change",target:r,currentTarget:r,srcElement:r})},addtrack:function(e){r.addTrack(e.track)},removetrack:function(e){r.removeTrack(e.track)}},a=function(){for(var e=[],t=0;t<r.length;t++){for(var n=!1,o=0;o<i.length;o++)if(i[o]===r[t]){n=!0;break}n||e.push(r[t])}for(;e.length;)r.removeTrack(e.shift())};this[n.getterName+"Listeners_"]=o,Object.keys(o).forEach(function(e){var n=o[e];i.addEventListener(e,n),t.on("dispose",function(t){return i.removeEventListener(e,n)})}),this.on("loadstart",a),this.on("dispose",function(e){return t.off("loadstart",a)})}},n.proxyNativeTracks_=function(){var e=this;yy.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},n.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),t.disposeMediaElement(e),e=n}else{e=sm.a.createElement("video");var i=ab({},this.options_.tag&&tv(this.options_.tag));Rb&&!0===this.options_.nativeControlsForTouch||delete i.controls,ev(e,N_(i,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}void 0!==this.options_.preload&&iv(e,"preload",this.options_.preload);for(var r=["loop","muted","playsinline","autoplay"],o=0;o<r.length;o++){var a=r[o],s=this.options_[a];void 0!==s&&(s?iv(e,a,a):rv(e,a),e[a]=s)}return e},n.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,n=function(){t=!0};this.on("loadstart",n);var i=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",i),void this.ready(function(){this.off("loadstart",n),this.off("loadedmetadata",i),t||this.trigger("loadstart")})}var r=["loadstart"];r.push("loadedmetadata"),e.readyState>=2&&r.push("loadeddata"),e.readyState>=3&&r.push("canplay"),e.readyState>=4&&r.push("canplaythrough"),this.ready(function(){r.forEach(function(e){this.trigger(e)},this)})}},n.setCurrentTime=function(e){try{this.el_.currentTime=e}catch(t){w_(t,"Video is not ready. (Video.js)")}},n.duration=function(){var e=this;return this.el_.duration===1/0&&_b&&Eb&&0===this.el_.currentTime?(this.on("timeupdate",function t(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))}),NaN):this.el_.duration||NaN},n.width=function(){return this.el_.offsetWidth},n.height=function(){return this.el_.offsetHeight},n.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},n=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0}))};this.on("webkitbeginfullscreen",n),this.on("dispose",function(){e.off("webkitbeginfullscreen",n),e.off("webkitendfullscreen",t)})}},n.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=om.a.navigator&&om.a.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},n.enterFullScreen=function(){var e=this.el_;e.paused&&e.networkState<=e.HAVE_METADATA?(this.el_.play(),this.setTimeout(function(){e.pause(),e.webkitEnterFullScreen()},0)):e.webkitEnterFullScreen()},n.exitFullScreen=function(){this.el_.webkitExitFullScreen()},n.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},n.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},n.reset=function(){t.resetMediaElement(this.el_)},n.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},n.setControls=function(e){this.el_.controls=!!e},n.addTextTrack=function(t,n,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(t,n,i):e.prototype.addTextTrack.call(this,t,n,i)},n.createRemoteTextTrack=function(t){if(!this.featuresNativeTextTracks)return e.prototype.createRemoteTextTrack.call(this,t);var n=sm.a.createElement("track");return t.kind&&(n.kind=t.kind),t.label&&(n.label=t.label),(t.language||t.srclang)&&(n.srclang=t.language||t.srclang),t.default&&(n.default=t.default),t.id&&(n.id=t.id),t.src&&(n.src=t.src),n},n.addRemoteTextTrack=function(t,n){var i=e.prototype.addRemoteTextTrack.call(this,t,n);return this.featuresNativeTextTracks&&this.el().appendChild(i),i},n.removeRemoteTextTrack=function(t){if(e.prototype.removeRemoteTextTrack.call(this,t),this.featuresNativeTextTracks)for(var n=this.$$("track"),i=n.length;i--;)t!==n[i]&&t!==n[i].track||this.el().removeChild(n[i])},n.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),om.a.performance&&"function"==typeof om.a.performance.now?e.creationTime=om.a.performance.now():om.a.performance&&om.a.performance.timing&&"number"==typeof om.a.performance.timing.navigationStart&&(e.creationTime=om.a.Date.now()-om.a.performance.timing.navigationStart),e},t}(xy);if(j_()){JT.TEST_VID=sm.a.createElement("video");var $T=sm.a.createElement("track");$T.kind="captions",$T.srclang="en",$T.label="English",JT.TEST_VID.appendChild($T)}JT.isSupported=function(){try{JT.TEST_VID.volume=.5}catch(e){return!1}return!(!JT.TEST_VID||!JT.TEST_VID.canPlayType)},JT.canPlayType=function(e){return JT.TEST_VID.canPlayType(e)},JT.canPlaySource=function(e,t){return JT.canPlayType(e.type)},JT.canControlVolume=function(){try{var e=JT.TEST_VID.volume;return JT.TEST_VID.volume=e/2+.1,e!==JT.TEST_VID.volume}catch(t){return!1}},JT.canMuteVolume=function(){try{var e=JT.TEST_VID.muted;return JT.TEST_VID.muted=!e,JT.TEST_VID.muted?iv(JT.TEST_VID,"muted","muted"):rv(JT.TEST_VID,"muted"),e!==JT.TEST_VID.muted}catch(t){return!1}},JT.canControlPlaybackRate=function(){if(_b&&Eb&&xb<58)return!1;try{var e=JT.TEST_VID.playbackRate;return JT.TEST_VID.playbackRate=e/2+.1,e!==JT.TEST_VID.playbackRate}catch(t){return!1}},JT.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(sm.a.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(sm.a.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(sm.a.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(sm.a.createElement("audio"),"innerHTML",{get:e,set:e})}catch(t){return!1}return!0},JT.supportsNativeTextTracks=function(){return Ab||gb&&Eb},JT.supportsNativeVideoTracks=function(){return!(!JT.TEST_VID||!JT.TEST_VID.videoTracks)},JT.supportsNativeAudioTracks=function(){return!(!JT.TEST_VID||!JT.TEST_VID.audioTracks)},JT.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],JT.prototype.featuresVolumeControl=JT.canControlVolume(),JT.prototype.featuresMuteControl=JT.canMuteVolume(),JT.prototype.featuresPlaybackRate=JT.canControlPlaybackRate(),JT.prototype.featuresSourceset=JT.canOverrideAttributes(),JT.prototype.movingMediaElementInDOM=!gb,JT.prototype.featuresFullscreenResize=!0,JT.prototype.featuresProgressEvents=!0,JT.prototype.featuresTimeupdateEvents=!0,JT.prototype.featuresNativeTextTracks=JT.supportsNativeTextTracks(),JT.prototype.featuresNativeVideoTracks=JT.supportsNativeVideoTracks(),JT.prototype.featuresNativeAudioTracks=JT.supportsNativeAudioTracks();var eE=JT.TEST_VID&&JT.TEST_VID.constructor.prototype.canPlayType,tE=/^application\/(?:x-|vnd\.apple\.)mpegurl/i;function nE(){var e=M_(["\n        Using the tech directly can be dangerous. I hope you know what you're doing.\n        See https://github.com/videojs/video.js/issues/2617 for more info.\n      "]);return nE=function(){return e},e}JT.patchCanPlayType=function(){vb>=4&&!yb&&!Eb&&(JT.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&tE.test(e)?"maybe":eE.call(this,e)})},JT.unpatchCanPlayType=function(){var e=JT.TEST_VID.constructor.prototype.canPlayType;return JT.TEST_VID.constructor.prototype.canPlayType=eE,e},JT.patchCanPlayType(),JT.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},JT.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll("source"),n=t.length;n--;)e.removeChild(t[n]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){JT.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){JT.prototype["set"+ob(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","played","networkState","readyState","videoWidth","videoHeight"].forEach(function(e){JT.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate"].forEach(function(e){JT.prototype["set"+ob(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){JT.prototype[e]=function(){return this.el_[e]()}}),xy.withSourceHandlers(JT),JT.nativeSourceHandler={},JT.nativeSourceHandler.canPlayType=function(e){try{return JT.TEST_VID.canPlayType(e)}catch(t){return""}},JT.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return JT.nativeSourceHandler.canPlayType(e.type);if(e.src){var n=cy(e.src);return JT.nativeSourceHandler.canPlayType("video/"+n)}return""},JT.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},JT.nativeSourceHandler.dispose=function(){},JT.registerSourceHandler(JT.nativeSourceHandler),xy.registerTech("Html5",JT);var iE=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],rE={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},oE=["tiny","xsmall","small","medium","large","xlarge","huge"],aE={};oE.forEach(function(e){var t="x"===e.charAt(0)?"x-"+e.substring(1):e;aE[e]="vjs-layout-"+t});var sE={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},lE=function(e){function t(n,i,r){var o;if(n.id=n.id||i.id||"vjs_video_"+yv(),(i=N_(t.getTagSettings(n),i)).initChildren=!1,i.createEl=!1,i.evented=!1,i.reportTouchActivity=!1,!i.language)if("function"==typeof n.closest){var a=n.closest("[lang]");a&&a.getAttribute&&(i.language=a.getAttribute("lang"))}else for(var s=n;s&&1===s.nodeType;){if(tv(s).hasOwnProperty("lang")){i.language=s.getAttribute("lang");break}s=s.parentNode}if((o=e.call(this,null,i,r)||this).boundDocumentFullscreenChange_=Hv(R_(o),o.documentFullscreenChange_),o.boundFullWindowOnEscKey_=Hv(R_(o),o.fullWindowOnEscKey),o.log=I_(o.id_),o.fsApi_=kb,o.isPosterFromTech_=!1,o.queuedCallbacks_=[],o.isReady_=!1,o.hasStarted_=!1,o.userActive_=!1,!o.options_||!o.options_.techOrder||!o.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(o.tag=n,o.tagAttributes=n&&tv(n),o.language(o.options_.language),i.languages){var l={};Object.getOwnPropertyNames(i.languages).forEach(function(e){l[e.toLowerCase()]=i.languages[e]}),o.languages_=l}else o.languages_=t.prototype.options_.languages;o.resetCache_(),o.poster_=i.poster||"",o.controls_=!!i.controls,n.controls=!1,n.removeAttribute("controls"),o.changingSrc_=!1,o.playCallbacks_=[],o.playTerminatedQueue_=[],n.hasAttribute("autoplay")?o.autoplay(!0):o.autoplay(o.options_.autoplay),i.plugins&&Object.keys(i.plugins).forEach(function(e){if("function"!=typeof o[e])throw new Error('plugin "'+e+'" does not exist')}),o.scrubbing_=!1,o.el_=o.createEl(),nb(R_(o),{eventBusKey:"el_"}),o.fluid_&&o.on("playerreset",o.updateStyleEl_);var c=ab(o.options_);i.plugins&&Object.keys(i.plugins).forEach(function(e){o[e](i.plugins[e])}),o.options_.playerOptions=c,o.middleware_=[],o.initChildren(),o.isAudio("audio"===n.nodeName.toLowerCase()),o.controls()?o.addClass("vjs-controls-enabled"):o.addClass("vjs-controls-disabled"),o.el_.setAttribute("role","region"),o.isAudio()?o.el_.setAttribute("aria-label",o.localize("Audio Player")):o.el_.setAttribute("aria-label",o.localize("Video Player")),o.isAudio()&&o.addClass("vjs-audio"),o.flexNotSupported_()&&o.addClass("vjs-no-flex"),Rb&&o.addClass("vjs-touch-enabled"),gb||o.addClass("vjs-workinghover"),t.players[o.id_]=R_(o);var u=C_.split(".")[0];return o.addClass("vjs-v"+u),o.userActive(!0),o.reportUserActivity(),o.one("play",o.listenForUserActivity_),o.on("stageclick",o.handleStageClick_),o.on("keydown",o.handleKeyDown),o.breakpoints(o.options_.breakpoints),o.responsive(o.options_.responsive),o}S_(t,e);var n=t.prototype;return n.dispose=function(){var n=this;this.trigger("dispose"),this.off("dispose"),Iv(sm.a,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Iv(sm.a,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),t.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),Sy[this.id()]=null,Ey.names.forEach(function(e){var t=n[Ey[e].getterName]();t&&t.off&&t.off()}),e.prototype.dispose.call(this)},n.createEl=function(){var t,n=this.tag,i=this.playerElIngest_=n.parentNode&&n.parentNode.hasAttribute&&n.parentNode.hasAttribute("data-vjs-player"),r="video-js"===this.tag.tagName.toLowerCase();i?t=this.el_=n.parentNode:r||(t=this.el_=e.prototype.createEl.call(this,"div"));var o=tv(n);if(r){for(t=this.el_=n,n=this.tag=sm.a.createElement("video");t.children.length;)n.appendChild(t.firstChild);q_(t,"video-js")||Z_(t,"video-js"),t.appendChild(n),i=this.playerElIngest_=t,Object.keys(t).forEach(function(e){n[e]=t[e]})}if(n.setAttribute("tabindex","-1"),o.tabindex="-1",(Cb||Eb&&Pb)&&(n.setAttribute("role","application"),o.role="application"),n.removeAttribute("width"),n.removeAttribute("height"),"width"in o&&delete o.width,"height"in o&&delete o.height,Object.getOwnPropertyNames(o).forEach(function(e){r&&"class"===e||t.setAttribute(e,o[e]),r&&n.setAttribute(e,o[e])}),n.playerId=n.id,n.id+="_html5_api",n.className="vjs-tech",n.player=t.player=this,this.addClass("vjs-paused"),!0!==om.a.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=zv("vjs-styles-dimensions");var a=mv(".vjs-styles-defaults"),s=mv("head");s.insertBefore(this.styleEl_,a?a.nextSibling:s.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio);for(var l=n.getElementsByTagName("a"),c=0;c<l.length;c++){var u=l.item(c);Z_(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return n.initNetworkState_=n.networkState,n.parentNode&&!i&&n.parentNode.insertBefore(t,n),Q_(n,t),this.children_.unshift(n),this.el_.setAttribute("lang",this.language_),this.el_=t,t},n.width=function(e){return this.dimension("width",e)},n.height=function(e){return this.dimension("height",e)},n.dimension=function(e,t){var n=e+"_";if(void 0===t)return this[n]||0;if(""===t)return this[n]=void 0,void this.updateStyleEl_();var i=parseFloat(t);isNaN(i)?w_.error('Improper value "'+t+'" supplied for for '+e):(this[n]=i,this.updateStyleEl_())},n.fluid=function(e){if(void 0===e)return!!this.fluid_;var t;this.fluid_=!!e,Kv(this)&&this.off("playerreset",this.updateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),Kv(t=function(){this.on("playerreset",this.updateStyleEl_)})?(void 0)():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(void 0))):this.removeClass("vjs-fluid"),this.updateStyleEl_()},n.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},n.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},n.updateStyleEl_=function(){if(!0!==om.a.VIDEOJS_NO_DYNAMIC_STYLE){var e,t,n,i=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),r=i[1]/i[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/r:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*r,n=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(n),jv(this.styleEl_,"\n      ."+n+" {\n        width: "+e+"px;\n        height: "+t+"px;\n      }\n\n      ."+n+".vjs-fluid {\n        padding-top: "+100*r+"%;\n      }\n    ")}else{var o="number"==typeof this.width_?this.width_:this.options_.width,a="number"==typeof this.height_?this.height_:this.options_.height,s=this.tech_&&this.tech_.el();s&&(o>=0&&(s.width=o),a>=0&&(s.height=a))}},n.loadTech_=function(e,t){var n=this;this.tech_&&this.unloadTech_();var i=ob(e),r=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==i&&this.tag&&(xy.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=i,this.isReady_=!1;var o={source:t,autoplay:"string"!=typeof this.autoplay()&&this.autoplay(),nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+r+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Ey.names.forEach(function(e){var t=Ey[e];o[t.getterName]=n[t.privateName]}),N_(o,this.options_[i]),N_(o,this.options_[r]),N_(o,this.options_[e.toLowerCase()]),this.tag&&(o.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(o.startTime=this.cache_.currentTime);var a,s=xy.getTech(e);if(!s)throw new Error("No Tech named '"+i+"' exists! '"+i+"' should be registered using videojs.registerTech()'");this.tech_=new s(o),this.tech_.ready(Hv(this,this.handleTechReady_),!0),a=this.tech_,(this.textTracksJson_||[]).forEach(function(e){var t=a.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(function(e){return t.addCue(e)})}),a.textTracks(),iE.forEach(function(e){n.on(n.tech_,e,n["handleTech"+ob(e)+"_"])}),Object.keys(rE).forEach(function(e){n.on(n.tech_,e,function(t){0===n.tech_.playbackRate()&&n.tech_.seeking()?n.queuedCallbacks_.push({callback:n["handleTech"+rE[e]+"_"].bind(n),event:t}):n["handleTech"+rE[e]+"_"](t)})}),this.on(this.tech_,"loadstart",this.handleTechLoadStart_),this.on(this.tech_,"sourceset",this.handleTechSourceset_),this.on(this.tech_,"waiting",this.handleTechWaiting_),this.on(this.tech_,"ended",this.handleTechEnded_),this.on(this.tech_,"seeking",this.handleTechSeeking_),this.on(this.tech_,"play",this.handleTechPlay_),this.on(this.tech_,"firstplay",this.handleTechFirstPlay_),this.on(this.tech_,"pause",this.handleTechPause_),this.on(this.tech_,"durationchange",this.handleTechDurationChange_),this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_),this.on(this.tech_,"enterpictureinpicture",this.handleTechEnterPictureInPicture_),this.on(this.tech_,"leavepictureinpicture",this.handleTechLeavePictureInPicture_),this.on(this.tech_,"error",this.handleTechError_),this.on(this.tech_,"loadedmetadata",this.updateStyleEl_),this.on(this.tech_,"posterchange",this.handleTechPosterChange_),this.on(this.tech_,"textdata",this.handleTechTextData_),this.on(this.tech_,"ratechange",this.handleTechRateChange_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===i&&this.tag||Q_(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},n.unloadTech_=function(){var e,t,n,i=this;Ey.names.forEach(function(e){var t=Ey[e];i[t.privateName]=i[t.getterName]()}),this.textTracksJson_=(t=(e=this.tech_).$$("track"),n=Array.prototype.map.call(t,function(e){return e.track}),Array.prototype.map.call(t,function(e){var t=Hb(e.track);return e.src&&(t.src=e.src),t}).concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===n.indexOf(e)}).map(Hb))),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},n.tech=function(e){return void 0===e&&w_.warn(cm()(nE())),this.tech_},n.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"mouseup",this.handleTechClick_),this.on(this.tech_,"dblclick",this.handleTechDoubleClick_),this.on(this.tech_,"touchstart",this.handleTechTouchStart_),this.on(this.tech_,"touchmove",this.handleTechTouchMove_),this.on(this.tech_,"touchend",this.handleTechTouchEnd_),this.on(this.tech_,"tap",this.handleTechTap_)},n.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.handleTechTap_),this.off(this.tech_,"touchstart",this.handleTechTouchStart_),this.off(this.tech_,"touchmove",this.handleTechTouchMove_),this.off(this.tech_,"touchend",this.handleTechTouchEnd_),this.off(this.tech_,"mouseup",this.handleTechClick_),this.off(this.tech_,"dblclick",this.handleTechDoubleClick_)},n.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},n.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay())},n.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var n,i=function(){var e=t.muted();t.muted(!0);var n=function(){t.muted(e)};t.playTerminatedQueue_.push(n);var i=t.play();if(zb(i))return i.catch(n)};if("any"===e&&!0!==this.muted()?zb(n=this.play())&&(n=n.catch(i)):n="muted"===e&&!0!==this.muted()?i():this.play(),zb(n))return n.then(function(){t.trigger({type:"autoplay-success",autoplay:e})}).catch(function(n){t.trigger({type:"autoplay-failure",autoplay:e})})}},n.updateSourceCaches_=function(e){void 0===e&&(e="");var t=e,n="";"string"!=typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=function(e,t){if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var n=e.cache_.sources.filter(function(e){return e.src===t});if(n.length)return n[0].type;for(var i=e.$$("source"),r=0;r<i.length;r++){var o=i[r];if(o.type&&o.src&&o.src===t)return o.type}return Dy(t)}(this,t)),this.cache_.source=ab({},e,{src:t,type:n});for(var i=this.cache_.sources.filter(function(e){return e.src&&e.src===t}),r=[],o=this.$$("source"),a=[],s=0;s<o.length;s++){var l=tv(o[s]);r.push(l),l.src&&l.src===t&&a.push(l.src)}a.length&&!i.length?this.cache_.sources=r:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},n.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_){var n=function(e){return t.updateSourceCaches_(e)},i=this.currentSource().src,r=e.src;i&&!/^blob:/.test(i)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==i)&&(n=function(){}),n(r),e.src||this.tech_.one(["sourceset","loadstart"],function e(n){if("sourceset"!==n.type){var i=t.techGet("currentSrc");t.lastSource_.tech=i,t.updateSourceCaches_(i)}t.tech_.off(["sourceset","loadstart"],e)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},n.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},n.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},n.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},n.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var t=this.currentTime();this.on("timeupdate",function n(){t!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",n))})},n.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},n.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},n.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},n.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},n.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},n.handleTechFirstPlay_=function(){this.options_.starttime&&(w_.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},n.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},n.handleTechEnded_=function(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},n.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},n.handleTechClick_=function(e){gv(e)&&this.controls_&&(this.paused()?jb(this.play()):this.pause())},n.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(t){return t.contains(e.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},n.handleTechTap_=function(){this.userActive(!this.userActive())},n.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},n.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},n.handleTechTouchEnd_=function(e){e.preventDefault()},n.handleStageClick_=function(){this.reportUserActivity()},n.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},n.documentFullscreenChange_=function(e){var t=this.el(),n=sm.a[this.fsApi_.fullscreenElement]===t;!n&&t.matches?n=t.matches(":"+this.fsApi_.fullscreen):!n&&t.msMatchesSelector&&(n=t.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(n),!1===this.isFullscreen()&&Iv(sm.a,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.fsApi_.prefixed&&this.trigger("fullscreenchange")},n.handleTechFullscreenChange_=function(e,t){t&&this.isFullscreen(t.isFullscreen),this.trigger("fullscreenchange")},n.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},n.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},n.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},n.handleTechError_=function(){var e=this.tech_.error();this.error(e)},n.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},n.getCache=function(){return this.cache_},n.resetCache_=function(){this.cache_={currentTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],volume:1}},n.techCall_=function(e,t){this.ready(function(){if(e in My)return function(e,t,n,i){return t[n](e.reduce(wy(n),i))}(this.middleware_,this.tech_,e,t);if(e in Oy)return Py(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw w_(n),n}},!0)},n.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Ry)return function(e,t,n){return e.reduceRight(wy(n),t[n]())}(this.middleware_,this.tech_,e);if(e in Oy)return Py(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw w_("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t;if("TypeError"===t.name)throw w_("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t;throw w_(t),t}}},n.play=function(){var e=this,t=this.options_.Promise||om.a.Promise;return t?new t(function(t){e.play_(t)}):this.play_()},n.play_=function(e){var t=this;void 0===e&&(e=jb),this.playCallbacks_.push(e);var n=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!n)return this.waitToPlay_=function(e){t.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(n||!Ab&&!gb||this.load());var i=this.techGet_("play");null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)},n.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})},n.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})},n.pause=function(){this.techCall_("pause")},n.paused=function(){return!1!==this.techGet_("paused")},n.played=function(){return this.techGet_("played")||Ib(0,0)},n.scrubbing=function(e){if(void 0===e)return this.scrubbing_;this.scrubbing_=!!e,e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},n.currentTime=function(e){return void 0!==e?(e<0&&(e=0),void this.techCall_("setCurrentTime",e)):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},n.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?(this.addClass("vjs-live"),this.options_.liveui&&this.player_.liveTracker&&this.addClass("vjs-liveui")):(this.removeClass("vjs-live"),this.removeClass("vjs-liveui")),isNaN(e)||this.trigger("durationchange"))},n.remainingTime=function(){return this.duration()-this.currentTime()},n.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},n.buffered=function(){var e=this.techGet_("buffered");return e&&e.length||(e=Ib(0,0)),e},n.bufferedPercent=function(){return Db(this.buffered(),this.duration())},n.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),n=e.end(e.length-1);return n>t&&(n=t),n},n.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},n.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},n.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},n.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},n.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},n.isFullscreen=function(e){return void 0!==e?(this.isFullscreen_=!!e,void this.toggleFullscreenClass_()):!!this.isFullscreen_},n.requestFullscreen=function(e){var t;this.isFullscreen(!0),this.fsApi_.requestFullscreen?(wv(sm.a,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),jb(this.el_[this.fsApi_.requestFullscreen](t))):this.tech_.supportsFullScreen()?this.techCall_("enterFullScreen"):(this.enterFullWindow(),this.trigger("fullscreenchange"))},n.exitFullscreen=function(){this.isFullscreen(!1),this.fsApi_.requestFullscreen?jb(sm.a[this.fsApi_.exitFullscreen]()):this.tech_.supportsFullScreen()?this.techCall_("exitFullScreen"):(this.exitFullWindow(),this.trigger("fullscreenchange"))},n.enterFullWindow=function(){this.isFullWindow=!0,this.docOrigOverflow=sm.a.documentElement.style.overflow,wv(sm.a,"keydown",this.boundFullWindowOnEscKey_),sm.a.documentElement.style.overflow="hidden",Z_(sm.a.body,"vjs-full-window"),this.trigger("enterFullWindow")},n.fullWindowOnEscKey=function(e){fm.a.isEventKey(e,"Esc")&&(!0===this.isFullscreen()?this.exitFullscreen():this.exitFullWindow())},n.exitFullWindow=function(){this.isFullWindow=!1,Iv(sm.a,"keydown",this.boundFullWindowOnEscKey_),sm.a.documentElement.style.overflow=this.docOrigOverflow,J_(sm.a.body,"vjs-full-window"),this.trigger("exitFullWindow")},n.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},n.requestPictureInPicture=function(){if("pictureInPictureEnabled"in sm.a)return this.techGet_("requestPictureInPicture")},n.exitPictureInPicture=function(){if("pictureInPictureEnabled"in sm.a)return sm.a.exitPictureInPicture()},n.handleKeyDown=function(e){var t,n,i=this.options_.userActions;i&&i.hotkeys&&("input"===(n=(t=this.el_.ownerDocument.activeElement).tagName.toLowerCase())?-1!==["button","checkbox","hidden","radio","reset","submit"].indexOf(t.type):-1===["textarea"].indexOf(n))&&("function"==typeof i.hotkeys?i.hotkeys.call(this,e):this.handleHotkeys(e))},n.handleHotkeys=function(e){var t=this.options_.userActions?this.options_.userActions.hotkeys:{},n=t.fullscreenKey,i=t.muteKey,r=void 0===i?function(e){return fm.a.isEventKey(e,"m")}:i,o=t.playPauseKey,a=void 0===o?function(e){return fm.a.isEventKey(e,"k")||fm.a.isEventKey(e,"Space")}:o;if((void 0===n?function(e){return fm.a.isEventKey(e,"f")}:n).call(this,e)){e.preventDefault(),e.stopPropagation();var s=sb.getComponent("FullscreenToggle");!1!==sm.a[this.fsApi_.fullscreenEnabled]&&s.prototype.handleClick.call(this,e)}else r.call(this,e)?(e.preventDefault(),e.stopPropagation(),sb.getComponent("MuteToggle").prototype.handleClick.call(this,e)):a.call(this,e)&&(e.preventDefault(),e.stopPropagation(),sb.getComponent("PlayToggle").prototype.handleClick.call(this,e))},n.canPlayType=function(e){for(var t,n=0,i=this.options_.techOrder;n<i.length;n++){var r=i[n],o=xy.getTech(r);if(o||(o=sb.getComponent(r)),o){if(o.isSupported()&&(t=o.canPlayType(e)))return t}else w_.error('The "'+r+'" tech is undefined. Skipped browser support check for that tech.')}return""},n.selectSource=function(e){var t,n=this,i=this.options_.techOrder.map(function(e){return[e,xy.getTech(e)]}).filter(function(e){var t=e[0],n=e[1];return n?n.isSupported():(w_.error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),r=function(e,t,n){var i;return e.some(function(e){return t.some(function(t){if(i=n(e,t))return!0})}),i},o=function(e,t){var i=e[0];if(e[1].canPlaySource(t,n.options_[i.toLowerCase()]))return{source:t,tech:i}};return(this.options_.sourceOrder?r(e,i,(t=o,function(e,n){return t(n,e)})):r(i,e,o))||!1},n.src=function(e){var t=this;if(void 0===e)return this.cache_.src||"";var n,i,r,o=function e(t){if(Array.isArray(t)){var n=[];t.forEach(function(t){t=e(t),Array.isArray(t)?n=n.concat(t):F_(t)&&n.push(t)}),t=n}else t="string"==typeof t&&t.trim()?[Ly({src:t})]:F_(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[Ly(t)]:[];return t}(e);o.length?(this.changingSrc_=!0,this.cache_.sources=o,this.updateSourceCaches_(o[0]),i=o[0],r=function(e,n){var i;if(t.middleware_=n,t.cache_.sources=o,t.updateSourceCaches_(e),t.src_(e))return o.length>1?t.src(o.slice(1)):(t.changingSrc_=!1,t.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void t.triggerReady());i=t.tech_,n.forEach(function(e){return e.setTech&&e.setTech(i)})},(n=this).setTimeout(function(){return function e(t,n,i,r,o,a){void 0===t&&(t={}),void 0===n&&(n=[]),void 0===o&&(o=[]),void 0===a&&(a=!1);var s=n[0],l=n.slice(1);if("string"==typeof s)e(t,Cy[s],i,r,o,a);else if(s){var c=function(e,t){var n=Sy[e.id()],i=null;if(null==n)return i=t(e),Sy[e.id()]=[[t,i]],i;for(var r=0;r<n.length;r++){var o=n[r];o[0]===t&&(i=o[1])}return null===i&&(i=t(e),n.push([t,i])),i}(r,s);if(!c.setSource)return o.push(c),e(t,l,i,r,o,a);c.setSource(N_({},t),function(n,s){if(n)return e(t,l,i,r,o,a);o.push(c),e(s,t.type===s.type?l:Cy[s.type],i,r,o,a)})}else l.length?e(t,l,i,r,o,a):a?i(t,o):e(t,Cy["*"],i,r,o,!0)}(i,Cy[i.type],r,n)},1)):this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)},n.src_=function(e){var t,n=this,i=this.selectSource([e]);return!i||(t=this.techName_,ob(i.tech)!==ob(t)?(this.changingSrc_=!0,this.loadTech_(i.tech,i.source),this.tech_.ready(function(){n.changingSrc_=!1}),!1):(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1))},n.load=function(){this.techCall_("load")},n.reset=function(){var e=this,t=this.options_.Promise||om.a.Promise;this.paused()||!t?this.doReset_():jb(this.play().then(function(){return e.doReset_()}))},n.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Kv(this)&&this.trigger("playerreset")},n.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},n.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar,t=e.durationDisplay,n=e.remainingTimeDisplay;t&&t.updateContent(),n&&n.updateContent()},n.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},n.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},n.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},n.currentSource=function(){return this.cache_.source||{}},n.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},n.currentType=function(){return this.currentSource()&&this.currentSource().type||""},n.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},n.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;"string"==typeof e&&/(any|play|muted)/.test(e)?(this.options_.autoplay=e,this.manualAutoplay_(e),t=!1):this.options_.autoplay=!!e,t=void 0===t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)},n.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},n.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},n.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},n.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},n.controls=function(e){if(void 0===e)return!!this.controls_;this.controls_!==(e=!!e)&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},n.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;this.usingNativeControls_!==(e=!!e)&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},n.error=function(e){if(void 0===e)return this.error_||null;if(this.options_.suppressNotSupportedError&&e&&e.message&&e.message===this.localize(this.options_.notSupportedMessage)){var t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Vb(e),this.addClass("vjs-error"),w_.error("(CODE:"+this.error_.code+" "+Vb.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error")},n.reportUserActivity=function(e){this.userActivity_=!0},n.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},n.listenForUserActivity_=function(){var e,t,n,i=Hv(this,this.reportUserActivity);this.on("mousedown",function(){i(),this.clearInterval(e),e=this.setInterval(i,250)}),this.on("mousemove",function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,i())}),this.on("mouseup",function(t){i(),this.clearInterval(e)});var r,o=this.getChild("controlBar");!o||gb||_b||(o.on("mouseenter",function(e){this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout,this.player().options_.inactivityTimeout=0}),o.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",i),this.on("keyup",i),this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(r);var e=this.options_.inactivityTimeout;e<=0||(r=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))}},250)},n.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},n.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},n.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},n.addTextTrack=function(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)},n.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},n.removeRemoteTextTrack=function(e){void 0===e&&(e={});var t=e.track;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)},n.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},n.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},n.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},n.language=function(e){if(void 0===e)return this.language_;this.language_=String(e).toLowerCase()},n.languages=function(){return ab(t.prototype.options_.languages,this.languages_)},n.toJSON=function(){var e=ab(this.options_),t=e.tracks;e.tracks=[];for(var n=0;n<t.length;n++){var i=t[n];(i=ab(i)).player=void 0,e.tracks[n]=i}return e},n.createModal=function(e,t){var n=this;(t=t||{}).content=e||"";var i=new Xb(this,t);return this.addChild(i),i.on("dispose",function(){n.removeChild(i)}),i.open(),i},n.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),n=0;n<oE.length;n++){var i=oE[n];if(t<=this.breakpoints_[i]){if(e===i)return;e&&this.removeClass(aE[e]),this.addClass(aE[i]),this.breakpoint_=i;break}}},n.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},n.breakpoints=function(e){return void 0===e?N_(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=N_({},sE,e),this.updateCurrentBreakpoint_(),N_(this.breakpoints_))},n.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.updateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.updateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},n.currentBreakpoint=function(){return this.breakpoint_},n.currentBreakpointClass=function(){return aE[this.breakpoint_]||""},n.loadMedia=function(e,t){var n=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=ab(e);var i=this.cache_.media,r=i.poster,o=i.src,a=i.textTracks;!i.artwork&&r&&(this.cache_.media.artwork=[{src:r,type:Dy(r)}]),o&&this.src(o),r&&this.poster(r),Array.isArray(a)&&a.forEach(function(e){return n.addRemoteTextTrack(e,!1)}),this.ready(t)}},n.getMedia=function(){if(!this.cache_.media){var e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(e){return{kind:e.kind,label:e.label,language:e.language,src:e.src}})};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:Dy(t.poster)}]),t}return ab(this.cache_.media)},t.getTagSettings=function(e){var t={sources:[],tracks:[]},n=tv(e),i=n["data-setup"];if(q_(e,"vjs-fill")&&(n.fill=!0),q_(e,"vjs-fluid")&&(n.fluid=!0),null!==i){var r=hm()(i||"{}"),o=r[0],a=r[1];o&&w_.error(o),N_(n,a)}if(N_(t,n),e.hasChildNodes())for(var s=e.childNodes,l=0,c=s.length;l<c;l++){var u=s[l],h=u.nodeName.toLowerCase();"source"===h?t.sources.push(tv(u)):"track"===h&&t.tracks.push(tv(u))}return t},n.flexNotSupported_=function(){var e=sm.a.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},t}(sb);Ey.names.forEach(function(e){var t=Ey[e];lE.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),lE.players={};var cE=om.a.navigator;lE.prototype.options_={techOrder:xy.defaultTechOrder_,html5:{},flash:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:cE&&(cE.languages&&cE.languages[0]||cE.userLanguage||cE.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(e){lE.prototype[e]=function(){return this.techGet_(e)}}),iE.forEach(function(e){lE.prototype["handleTech"+ob(e)+"_"]=function(){return this.trigger(e)}}),sb.registerComponent("Player",lE);var uE={},hE=function(e){return uE.hasOwnProperty(e)},dE=function(e){return hE(e)?uE[e]:void 0},fE=function(e,t){e.activePlugins_=e.activePlugins_||{},e.activePlugins_[t]=!0},pE=function(e,t,n){var i=(n?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},gE=function(e,t){return t.prototype.name=e,function(){pE(this,{name:e,plugin:t,instance:null},!0);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var o=P_(t,[this].concat(i));return this[e]=function(){return o},pE(this,o.getEventHash()),o}},mE=function(){function e(t){if(this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,nb(this),delete this.trigger,rb(this,this.constructor.defaultState),fE(t,this.name),this.dispose=Hv(this,this.dispose),t.on("dispose",this.dispose)}var t=e.prototype;return t.version=function(){return this.constructor.VERSION},t.getEventHash=function(e){return void 0===e&&(e={}),e.name=this.name,e.plugin=this.constructor,e.instance=this,e},t.trigger=function(e,t){return void 0===t&&(t={}),Dv(this.eventBusEl_,e,this.getEventHash(t))},t.handleStateChanged=function(e){},t.dispose=function(){var e=this.name,t=this.player;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t.activePlugins_[e]=!1,this.player=this.state=null,t[e]=gE(e,uE[e])},e.isBasic=function(t){var n="string"==typeof t?dE(t):t;return"function"==typeof n&&!e.prototype.isPrototypeOf(n.prototype)},e.registerPlugin=function(t,n){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+typeof t+".");if(hE(t))w_.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(lE.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof n)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+typeof n+".");return uE[t]=n,"plugin"!==t&&(lE.prototype[t]=e.isBasic(n)?function(e,t){var n=function(){pE(this,{name:e,plugin:t,instance:null},!0);var n=t.apply(this,arguments);return fE(this,e),pE(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}(t,n):gE(t,n)),n},e.deregisterPlugin=function(e){if("plugin"===e)throw new Error("Cannot de-register base plugin.");hE(e)&&(delete uE[e],delete lE.prototype[e])},e.getPlugins=function(e){var t;return void 0===e&&(e=Object.keys(uE)),e.forEach(function(e){var n=dE(e);n&&((t=t||{})[e]=n)}),t},e.getPluginVersion=function(e){var t=dE(e);return t&&t.VERSION||""},e}();mE.getPlugin=dE,mE.BASE_PLUGIN_NAME="plugin",mE.registerPlugin("plugin",mE),lE.prototype.usingPlugin=function(e){return!!this.activePlugins_&&!0===this.activePlugins_[e]},lE.prototype.hasPlugin=function(e){return!!hE(e)};var _E=function(e){return 0===e.indexOf("#")?e.slice(1):e};function vE(e,t,n){var i=vE.getPlayer(e);if(i)return t&&w_.warn('Player "'+e+'" is already initialised. Options will not be applied.'),n&&i.ready(n),i;var r="string"==typeof e?mv("#"+_E(e)):e;if(!H_(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");r.ownerDocument.defaultView&&r.ownerDocument.body.contains(r)||w_.warn("The element supplied is not included in the DOM"),t=t||{},vE.hooks("beforesetup").forEach(function(e){var n=e(r,ab(t));F_(n)&&!Array.isArray(n)?t=ab(t,n):w_.error("please return an object in beforesetup hooks")});var o=sb.getComponent("Player");return i=new o(r,t,n),vE.hooks("setup").forEach(function(e){return e(i)}),i}if(vE.hooks_={},vE.hooks=function(e,t){return vE.hooks_[e]=vE.hooks_[e]||[],t&&(vE.hooks_[e]=vE.hooks_[e].concat(t)),vE.hooks_[e]},vE.hook=function(e,t){vE.hooks(e,t)},vE.hookOnce=function(e,t){vE.hooks(e,[].concat(t).map(function(t){return function n(){return vE.removeHook(e,n),t.apply(void 0,arguments)}}))},vE.removeHook=function(e,t){var n=vE.hooks(e).indexOf(t);return!(n<=-1||((vE.hooks_[e]=vE.hooks_[e].slice()).splice(n,1),0))},!0!==om.a.VIDEOJS_NO_DYNAMIC_STYLE&&j_()){var bE=mv(".vjs-styles-defaults");if(!bE){bE=zv("vjs-styles-defaults");var yE=mv("head");yE&&yE.insertBefore(bE,yE.firstChild),jv(bE,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}Vv(1,vE),vE.VERSION=C_,vE.options=lE.prototype.options_,vE.getPlayers=function(){return lE.players},vE.getPlayer=function(e){var t,n=lE.players;if("string"==typeof e){var i=_E(e),r=n[i];if(r)return r;t=mv("#"+i)}else t=e;if(H_(t)){var o=t.player,a=t.playerId;if(o||n[a])return o||n[a]}},vE.getAllPlayers=function(){return Object.keys(lE.players).map(function(e){return lE.players[e]}).filter(Boolean)},vE.players=lE.players,vE.getComponent=sb.getComponent,vE.registerComponent=function(e,t){xy.isTech(t)&&w_.warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),sb.registerComponent.call(sb,e,t)},vE.getTech=xy.getTech,vE.registerTech=xy.registerTech,vE.use=function(e,t){Cy[e]=Cy[e]||[],Cy[e].push(t)},Object.defineProperty(vE,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(vE.middleware,"TERMINATOR",{value:Ay,writeable:!1,enumerable:!0}),vE.browser=Mb,vE.TOUCH_ENABLED=Rb,vE.extend=function(e,t){void 0===t&&(t={});var n=function(){e.apply(this,arguments)},i={};for(var r in"object"==typeof t?(t.constructor!==Object.prototype.constructor&&(n=t.constructor),i=t):"function"==typeof t&&(n=t),function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.super_=t)}(n,e),i)i.hasOwnProperty(r)&&(n.prototype[r]=i[r]);return n},vE.mergeOptions=ab,vE.bind=Hv,vE.registerPlugin=mE.registerPlugin,vE.deregisterPlugin=mE.deregisterPlugin,vE.plugin=function(e,t){return w_.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),mE.registerPlugin(e,t)},vE.getPlugins=mE.getPlugins,vE.getPlugin=mE.getPlugin,vE.getPluginVersion=mE.getPluginVersion,vE.addLanguage=function(e,t){var n;return e=(""+e).toLowerCase(),(vE.options.languages=ab(vE.options.languages,((n={})[e]=t,n)))[e]},vE.log=w_,vE.createLogger=I_,vE.createTimeRange=vE.createTimeRanges=Ib,vE.formatTime=Wy,vE.setFormatTime=function(e){Hy=e},vE.resetFormatTime=function(){Hy=jy},vE.parseUrl=sy,vE.isCrossOrigin=uy,vE.EventTarget=Yv,vE.on=wv,vE.one=Lv,vE.off=Iv,vE.trigger=Dv,vE.xhr=gm.a,vE.TextTrack=py,vE.AudioTrack=gy,vE.VideoTrack=my,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(e){vE[e]=function(){return w_.warn("videojs."+e+"() is deprecated; use videojs.dom."+e+"() instead"),vv[e].apply(null,arguments)}}),vE.computedStyle=U_,vE.dom=vv,vE.url=hy;var TE=function(e,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=bm.a.buildAbsoluteURL(om.a.location.href,e)),bm.a.buildAbsoluteURL(e,t))},EE=function(e,t,n){return e&&n.responseURL&&t!==n.responseURL?n.responseURL:t},xE=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},CE=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),SE=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},AE=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},PE=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},RE=vE.mergeOptions,ME=vE.EventTarget,OE=vE.log,wE=function(e,t){["AUDIO","SUBTITLES"].forEach(function(n){for(var i in e.mediaGroups[n])for(var r in e.mediaGroups[n][i])t(e.mediaGroups[n][i][r],n,i,r)})},IE=function(e,t){var n=RE(e,{}),i=n.playlists[t.uri];if(!i)return null;if(i.segments&&t.segments&&i.segments.length===t.segments.length&&i.endList===t.endList&&i.mediaSequence===t.mediaSequence)return null;var r=RE(i,t);i.segments&&(r.segments=function(e,t,n){var i=t.slice();n=n||0;for(var r=Math.min(e.length,t.length+n),o=n;o<r;o++)i[o-n]=RE(e[o],i[o-n]);return i}(i.segments,t.segments,t.mediaSequence-i.mediaSequence)),r.segments.forEach(function(e){!function(e,t){e.resolvedUri||(e.resolvedUri=TE(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=TE(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=TE(t,e.map.uri))}(e,r.resolvedUri)});for(var o=0;o<n.playlists.length;o++)n.playlists[o].uri===t.uri&&(n.playlists[o]=r);return n.playlists[t.uri]=r,n},DE=function(e){for(var t=e.playlists.length;t--;){var n=e.playlists[t];e.playlists[n.uri]=n,n.resolvedUri=TE(e.uri,n.uri),n.id=t,n.attributes||(n.attributes={},OE.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))}},LE=function(e){wE(e,function(t){t.uri&&(t.resolvedUri=TE(e.uri,t.uri))})},kE=function(e,t){var n=e.segments[e.segments.length-1];return t&&n&&n.duration?1e3*n.duration:500*(e.targetDuration||10)},NE=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xE(this,t);var r=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=i.withCredentials,a=void 0!==o&&o,s=i.handleManifestRedirects,l=void 0!==s&&s;r.srcUrl=e,r.hls_=n,r.withCredentials=a,r.handleManifestRedirects=l;var c=n.options_;if(r.customTagParsers=c&&c.customTagParsers||[],r.customTagMappers=c&&c.customTagMappers||[],!r.srcUrl)throw new Error("A non-empty playlist URL is required");return r.state="HAVE_NOTHING",r.on("mediaupdatetimeout",function(){"HAVE_METADATA"===r.state&&(r.state="HAVE_CURRENT_METADATA",r.request=r.hls_.xhr({uri:TE(r.master.uri,r.media().uri),withCredentials:r.withCredentials},function(e,t){if(r.request)return e?r.playlistRequestError(r.request,r.media().uri,"HAVE_METADATA"):void r.haveMetadata(r.request,r.media().uri)}))}),r}return SE(t,ME),CE(t,[{key:"playlistRequestError",value:function(e,t,n){this.request=null,n&&(this.state=n),this.error={playlist:this.master.playlists[t],status:e.status,message:"HLS playlist request error at URL: "+t+".",responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}},{key:"haveMetadata",value:function(e,t){var n=this;this.request=null,this.state="HAVE_METADATA";var i=new Pm;this.customTagParsers.forEach(function(e){return i.addParser(e)}),this.customTagMappers.forEach(function(e){return i.addTagMapper(e)}),i.push(e.responseText),i.end(),i.manifest.uri=t,i.manifest.attributes=i.manifest.attributes||{};var r=IE(this.master,i.manifest);this.targetDuration=i.manifest.targetDuration,r?(this.master=r,this.media_=this.master.playlists[i.manifest.uri]):this.trigger("playlistunchanged"),this.media().endList||(om.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=om.a.setTimeout(function(){n.trigger("mediaupdatetimeout")},kE(this.media(),!!r))),this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.stopRequest(),om.a.clearTimeout(this.mediaUpdateTimeout),om.a.clearTimeout(this.finalRenditionTimeout)}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"media",value:function(e,t){var n=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}if(om.a.clearTimeout(this.finalRenditionTimeout),t){var i=e.targetDuration/2*1e3||5e3;this.finalRenditionTimeout=om.a.setTimeout(this.media.bind(this,e,!1),i)}else{var r=this.state,o=!this.media_||e.uri!==this.media_.uri;if(this.master.playlists[e.uri].endList)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(o&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(o){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.hls_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},function(t,i){if(n.request){if(e.resolvedUri=EE(n.handleManifestRedirects,e.resolvedUri,i),t)return n.playlistRequestError(n.request,e.uri,r);n.haveMetadata(i,e.uri),n.trigger("HAVE_MASTER"===r?"loadedmetadata":"mediachange")}})}}}},{key:"pause",value:function(){this.stopRequest(),om.a.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.state=this.media_?"HAVE_METADATA":"HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}},{key:"load",value:function(e){var t=this;om.a.clearTimeout(this.mediaUpdateTimeout);var n=this.media();e?this.mediaUpdateTimeout=om.a.setTimeout(function(){return t.load()},n?n.targetDuration/2*1e3:5e3):this.started?this.trigger(n&&!n.endList?"mediaupdatetimeout":"loadedplaylist"):this.start()}},{key:"start",value:function(){var e=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,n){if(e.request){if(e.request=null,t)return e.error={status:n.status,message:"HLS playlist request error at URL: "+e.srcUrl+".",responseText:n.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");var i=new Pm;return e.customTagParsers.forEach(function(e){return i.addParser(e)}),e.customTagMappers.forEach(function(e){return i.addTagMapper(e)}),i.push(n.responseText),i.end(),e.state="HAVE_MASTER",e.srcUrl=EE(e.handleManifestRedirects,e.srcUrl,n),i.manifest.uri=e.srcUrl,i.manifest.playlists?(e.master=i.manifest,DE(e.master),LE(e.master),e.trigger("loadedplaylist"),void(e.request||e.media(i.manifest.playlists[0]))):(e.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:om.a.location.href,playlists:[{uri:e.srcUrl,id:0,resolvedUri:e.srcUrl,attributes:{}}]},e.master.playlists[e.srcUrl]=e.master.playlists[0],e.haveMetadata(n,e.srcUrl),e.trigger("loadedmetadata"))}})}}]),t}(),FE=vE.createTimeRange,BE=function(e,t,n){var i,r;return void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence?0:(i=function(e,t){var n=0,i=t-e.mediaSequence,r=e.segments[i];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;i--;){if(void 0!==(r=e.segments[i]).end)return{result:n+r.end,precise:!0};if(n+=r.duration,void 0!==r.start)return{result:n+r.start,precise:!0}}return{result:n,precise:!1}}(e,t)).precise?i.result:(r=function(e,t){for(var n=0,i=void 0,r=t-e.mediaSequence;r<e.segments.length;r++){if(void 0!==(i=e.segments[r]).start)return{result:i.start-n,precise:!0};if(n+=i.duration,void 0!==i.end)return{result:i.end-n,precise:!0}}return{result:-1,precise:!1}}(e,t)).precise?r.result:i.result+n},UE=function(e,t,n){if(!e)return 0;if("number"!=typeof n&&(n=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return om.a.Infinity}return BE(e,t,n)},VE=function(e,t,n){var i=0;if(t>n){var r=[n,t];t=r[0],n=r[1]}if(t<0){for(var o=t;o<Math.min(0,n);o++)i+=e.targetDuration;t=0}for(var a=t;a<n;a++)i+=e.segments[a].duration;return i},GE=function(e){if(!e.segments.length)return 0;for(var t=e.segments.length-1,n=e.segments[t].duration||e.targetDuration,i=n+2*e.targetDuration;t--&&!((n+=e.segments[t].duration)>=i););return Math.max(0,t)},zE=function(e,t,n){if(!e||!e.segments)return null;if(e.endList)return UE(e);if(null===t)return null;t=t||0;var i=n?GE(e):e.segments.length;return BE(e,e.mediaSequence+i,t)},jE=function(e){return e-Math.floor(e)==0},HE=function(e,t){if(jE(t))return t+.1*e;for(var n=t.toString().split(".")[1].length,i=1;i<=n;i++){var r=Math.pow(10,i),o=t*r;if(jE(o)||i===n)return(o+e)/r}},WE=HE.bind(null,1),XE=HE.bind(null,-1),YE=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},KE=function(e){return e.excludeUntil&&e.excludeUntil===1/0},QE=function(e){var t=YE(e);return!e.disabled&&!t},qE=function(e,t){return t.attributes&&t.attributes[e]},ZE=function(e,t){if(1===e.playlists.length)return!0;var n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(function(e){return!!QE(e)&&(e.attributes.BANDWIDTH||0)<n}).length},JE={duration:UE,seekable:function(e,t){var n=t||0,i=zE(e,t,!0);return null===i?FE():FE(n,i)},safeLiveIndex:GE,getMediaInfoForTime:function(e,t,n,i){var r=void 0,o=e.segments.length,a=t-i;if(a<0){if(n>0)for(r=n-1;r>=0;r--)if((a+=XE(e.segments[r].duration))>0)return{mediaIndex:r,startTime:i-VE(e,n,r)};return{mediaIndex:0,startTime:t}}if(n<0){for(r=n;r<0;r++)if((a-=e.targetDuration)<0)return{mediaIndex:0,startTime:t};n=0}for(r=n;r<o;r++)if((a-=WE(e.segments[r].duration))<0)return{mediaIndex:r,startTime:i+VE(e,n,r)};return{mediaIndex:o-1,startTime:t}},isEnabled:QE,isDisabled:function(e){return e.disabled},isBlacklisted:YE,isIncompatible:KE,playlistEnd:zE,isAes:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},isFmp4:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].map)return!0;return!1},hasAttribute:qE,estimateSegmentRequestTime:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return qE("BANDWIDTH",n)?(e*n.attributes.BANDWIDTH-8*i)/t:NaN},isLowestEnabledRendition:ZE},$E=vE.xhr,ex=vE.mergeOptions,tx=function(){return function e(t,n){t=ex({timeout:45e3},t);var i=e.beforeRequest||vE.Hls.xhr.beforeRequest;if(i&&"function"==typeof i){var r=i(t);r&&(t=r)}var o=$E(t,function(e,t){var i=o.response;!e&&i&&(o.responseTime=Date.now(),o.roundTripTime=o.responseTime-o.requestTime,o.bytesReceived=i.byteLength||i.length,o.bandwidth||(o.bandwidth=Math.floor(o.bytesReceived/o.roundTripTime*8*1e3))),t.headers&&(o.responseHeaders=t.headers),e&&"ETIMEDOUT"===e.code&&(o.timedout=!0),e||o.aborted||200===t.statusCode||206===t.statusCode||0===t.statusCode||(e=new Error("XHR Failed with a response of: "+(o&&(i||o.responseText)))),n(e,o)}),a=o.abort;return o.abort=function(){return o.aborted=!0,a.apply(o,arguments)},o.uri=t.uri,o.requestTime=Date.now(),o}},nx=function(e){var t,n={};return e.byterange&&(n.Range="bytes="+(t=e.byterange).offset+"-"+(t.offset+t.length-1)),n},ix=function(e,t){return e.start(t)+"-"+e.end(t)},rx=function(e,t){var n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},ox=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},ax=function(e){var t={};return Object.keys(e).forEach(function(n){var i=e[n];t[n]=ArrayBuffer.isView(i)?{bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:i}),t},sx=function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},lx=function(e){return e.resolvedUri},cx=function(e){for(var t=Array.prototype.slice.call(e),n="",i=0;i<t.length/16;i++)n+=t.slice(16*i,16*i+16).map(rx).join("")+" "+t.slice(16*i,16*i+16).map(ox).join("")+"\n";return n},ux=Object.freeze({createTransferableMessage:ax,initSegmentId:sx,segmentKeyId:lx,hexDump:cx,tagDump:function(e){return cx(e.bytes)},textRanges:function(e){var t="",n=void 0;for(n=0;n<e.length;n++)t+=ix(e,n)+" ";return t}}),hx=function(e,t){var n=[],i=void 0;if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return vE.createTimeRanges(n)},dx=function(e,t){return hx(e,function(e,n){return e-1/30<=t&&n+1/30>=t})},fx=function(e,t){return hx(e,function(e){return e-1/30>=t})},px=function(e){var t=[];if(!e||!e.length)return"";for(var n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},gx=function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},mx=function(e,t,n){var i=void 0,r=void 0;if(n&&n.cues)for(i=n.cues.length;i--;)(r=n.cues[i]).startTime<=t&&r.endTime>=e&&n.removeCue(r)},_x=function(e){return isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e},vx="undefined"!=typeof window?window:{},bx="undefined"==typeof Symbol?"__target":Symbol(),yx="application/javascript",Tx=vx.BlobBuilder||vx.WebKitBlobBuilder||vx.MozBlobBuilder||vx.MSBlobBuilder,Ex=vx.URL||vx.webkitURL||Ex&&Ex.msURL,xx=vx.Worker;function Cx(e,t){return function(n){var i=this;if(!t)return new xx(e);if(xx&&!n){var r=Rx(t.toString().replace(/^function.+?{/,"").slice(0,-1));return this[bx]=new xx(r),function(e,t){if(e&&t){var n=e.terminate;e.objURL=t,e.terminate=function(){e.objURL&&Ex.revokeObjectURL(e.objURL),n.call(e)}}}(this[bx],r),this[bx]}var o={postMessage:function(e){i.onmessage&&setTimeout(function(){i.onmessage({data:e,target:o})})}};t.call(o),this.postMessage=function(e){setTimeout(function(){o.onmessage({data:e,target:i})})},this.isThisThread=!0}}if(xx){var Sx,Ax=Rx("self.onmessage = function () {}"),Px=new Uint8Array(1);try{(Sx=new xx(Ax)).postMessage(Px,[Px.buffer])}catch(nS){xx=null}finally{Ex.revokeObjectURL(Ax),Sx&&Sx.terminate()}}function Rx(e){try{return Ex.createObjectURL(new Blob([e],{type:yx}))}catch(nS){var t=new Tx;return t.append(e),Ex.createObjectURL(t.getBlob(type))}}var Mx=new Cx("./transmuxer-worker.worker.js",function(e,t){var n=this;!function(){var e,t,i,r,o,a,s,l,c,u,h,d,f,p,g,m,_,v,b,y,T,E,x,C,S,A,P,R,M,O,w,I,D,L,k,N,F,B,U,V,G=Math.pow(2,32)-1;!function(){var e;if(E={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(e in E)E.hasOwnProperty(e)&&(E[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);x=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),S=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),C=new Uint8Array([0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),P=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),R={video:A,audio:P},w=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0]),I=new Uint8Array([0,0,0,0,0,0,0,0]),D=I,L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),k=I,M=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),e=function(e){var t,n,i=[],r=0;for(t=1;t<arguments.length;t++)i.push(arguments[t]);for(t=i.length;t--;)r+=i[t].byteLength;for(n=new Uint8Array(r+8),new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(0,n.byteLength),n.set(e,4),t=0,r=8;t<i.length;t++)n.set(i[t],r),r+=i[t].byteLength;return n},t=function(){return e(E.dinf,e(E.dref,w))},i=function(t){return e(E.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},g=function(t){return e(E.hdlr,R[t])},p=function(t){var n=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(n[12]=t.samplerate>>>24&255,n[13]=t.samplerate>>>16&255,n[14]=t.samplerate>>>8&255,n[15]=255&t.samplerate),e(E.mdhd,n)},f=function(t){return e(E.mdia,p(t),g(t.type),a(t))},o=function(t){return e(E.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},a=function(n){return e(E.minf,"video"===n.type?e(E.vmhd,M):e(E.smhd,O),t(),_(n))},s=function(t,n){for(var i=[],r=n.length;r--;)i[r]=b(n[r]);return e.apply(null,[E.moof,o(t)].concat(i))},l=function(t){for(var n=t.length,i=[];n--;)i[n]=h(t[n]);return e.apply(null,[E.moov,u(4294967295)].concat(i).concat(c(t)))},c=function(t){for(var n=t.length,i=[];n--;)i[n]=y(t[n]);return e.apply(null,[E.mvex].concat(i))},u=function(t){var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e(E.mvhd,n)},m=function(t){var n,i,r=t.samples||[],o=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)o[i+4]=(n=r[i].flags).dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e(E.sdtp,o)},_=function(t){return e(E.stbl,v(t),e(E.stts,k),e(E.stsc,D),e(E.stsz,L),e(E.stco,I))},v=function(t){return e(E.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?N(t):F(t))},N=function(t){var n,i=t.sps||[],r=t.pps||[],o=[],a=[];for(n=0;n<i.length;n++)o.push((65280&i[n].byteLength)>>>8),o.push(255&i[n].byteLength),o=o.concat(Array.prototype.slice.call(i[n]));for(n=0;n<r.length;n++)a.push((65280&r[n].byteLength)>>>8),a.push(255&r[n].byteLength),a=a.concat(Array.prototype.slice.call(r[n]));return e(E.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),e(E.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([i.length]).concat(o).concat([r.length]).concat(a))),e(E.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},F=function(t){return e(E.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),i(t))},d=function(t){var n=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return e(E.tkhd,n)},b=function(t){var n,i,r,o,a,s;return n=e(E.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(t.baseMediaDecodeTime/(G+1)),s=Math.floor(t.baseMediaDecodeTime%(G+1)),i=e(E.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),"audio"===t.type?(r=T(t,92),e(E.traf,n,i,r)):(o=m(t),r=T(t,o.length+92),e(E.traf,n,i,r,o))},h=function(t){return t.duration=t.duration||4294967295,e(E.trak,d(t),f(t))},y=function(t){var n=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(n[n.length-1]=0),e(E.trex,n)},V=function(e,t){var n=0,i=0,r=0,o=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(o=8)),[0,0,n|i|r|o,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},U=function(t,n){var i,r,o,a;for(i=V(r=t.samples||[],n+=20+16*r.length),a=0;a<r.length;a++)i=i.concat([(4278190080&(o=r[a]).duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size,o.flags.isLeading<<2|o.flags.dependsOn,o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,61440&o.flags.degradationPriority,15&o.flags.degradationPriority,(4278190080&o.compositionTimeOffset)>>>24,(16711680&o.compositionTimeOffset)>>>16,(65280&o.compositionTimeOffset)>>>8,255&o.compositionTimeOffset]);return e(E.trun,new Uint8Array(i))},B=function(t,n){var i,r,o,a;for(i=V(r=t.samples||[],n+=20+8*r.length),a=0;a<r.length;a++)i=i.concat([(4278190080&(o=r[a]).duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size]);return e(E.trun,new Uint8Array(i))},T=function(e,t){return"audio"===e.type?B(e,t):U(e,t)};var z,j,H,W,X,Y={ftyp:r=function(){return e(E.ftyp,x,C,x,S)},mdat:function(t){return e(E.mdat,t)},moof:s,moov:l,initSegment:function(e){var t,n=r(),i=l(e);return(t=new Uint8Array(n.byteLength+i.byteLength)).set(n),t.set(i,n.byteLength),t}},K=function(e){return e>>>0};H=function(e){return z(e,["moov","trak"]).reduce(function(e,t){var n,i,r,o;return(n=z(t,["tkhd"])[0])?(r=K(n[i=0===n[0]?12:20]<<24|n[i+1]<<16|n[i+2]<<8|n[i+3]),(o=z(t,["mdia","mdhd"])[0])?(e[r]=K(o[i=0===o[0]?12:20]<<24|o[i+1]<<16|o[i+2]<<8|o[i+3]),e):null):null},{})},W=function(e,t){var n,i,r;return n=z(t,["moof","traf"]),i=[].concat.apply([],n.map(function(t){return z(t,["tfhd"]).map(function(n){var i,r;return i=K(n[4]<<24|n[5]<<16|n[6]<<8|n[7]),r=e[i]||9e4,(z(t,["tfdt"]).map(function(e){var t,n;return t=e[0],n=K(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(n*=Math.pow(2,32),n+=K(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),n})[0]||1/0)/r})})),r=Math.min.apply(null,i),isFinite(r)?r:0},X=function(e){var t=z(e,["moov","trak"]),n=[];return t.forEach(function(e){var t=z(e,["mdia","hdlr"]),i=z(e,["tkhd"]);t.forEach(function(e,t){var r,o,a,s=j(e.subarray(8,12)),l=i[t];"vide"===s&&(o=(r=new DataView(l.buffer,l.byteOffset,l.byteLength)).getUint8(0),a=r.getUint32(0===o?12:20),n.push(a))})}),n};var Q={findBox:z=function(e,t){var n,i,r,o,a,s=[];if(!t.length)return null;for(n=0;n<e.byteLength;)i=K(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),r=j(e.subarray(n+4,n+8)),o=i>1?n+i:e.byteLength,r===t[0]&&(1===t.length?s.push(e.subarray(n+8,o)):(a=z(e.subarray(n+8,o),t.slice(1))).length&&(s=s.concat(a))),n=o;return s},parseType:j=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),(t+=String.fromCharCode(e[2]))+String.fromCharCode(e[3])},timescale:H,startTime:W,videoTrackIds:X},q=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var i;return!!e[t]&&(i=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(i,1),i>-1)},this.trigger=function(t){var n,i,r,o;if(n=e[t])if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(o=[],i=arguments.length,i=1;i<arguments.length;++i)o.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,o)}},this.dispose=function(){e={}}}};q.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),e},q.prototype.push=function(e){this.trigger("data",e)},q.prototype.flush=function(e){this.trigger("done",e)};var Z,J,$,ee,te,ne,ie,re=q,oe=function(e,t){var n={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},ae=[33,16,5,32,164,27],se=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],le=function(e){for(var t=[];e--;)t.push(0);return t},ce={96000:[ae,[227,64],le(154),[56]],88200:[ae,[231],le(170),[56]],64000:[ae,[248,192],le(240),[56]],48000:[ae,[255,192],le(268),[55,148,128],le(54),[112]],44100:[ae,[255,192],le(268),[55,163,128],le(84),[112]],32000:[ae,[255,192],le(268),[55,234],le(226),[112]],24000:[ae,[255,192],le(268),[55,255,128],le(268),[111,112],le(126),[224]],16000:[ae,[255,192],le(268),[55,255,128],le(268),[111,255],le(269),[223,108],le(195),[1,192]],12000:[se,le(268),[3,127,248],le(268),[6,255,240],le(268),[13,255,224],le(268),[27,253,128],le(259),[56]],11025:[se,le(268),[3,127,248],le(268),[6,255,240],le(268),[13,255,224],le(268),[27,255,192],le(268),[55,175,128],le(108),[112]],8000:[se,le(268),[3,121,16],le(47),[7]]},ue=(Z=ce,Object.keys(Z).reduce(function(e,t){return e[t]=new Uint8Array(Z[t].reduce(function(e,t){return e.concat(t)},[])),e},{}));ne=function(e,t){return J(te(e,t))},ie=function(e,t){return $(ee(e),t)},J=function(e){return 9e4*e},$=function(e,t){return e*t},ee=function(e){return e/9e4},te=function(e,t){return e/t};var he=ne,de=ie,fe=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},pe=function(e,t){var n,i=e.minSegmentDts;return t||(i-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=i,n=Math.max(0,n),"audio"===e.type&&(n*=e.samplerate/9e4,n=Math.floor(n)),n},ge=function(e,t){"number"==typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts=void 0===e.minSegmentPts?t.pts:Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts=void 0===e.maxSegmentPts?t.pts:Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts=void 0===e.minSegmentDts?t.dts:Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts=void 0===e.maxSegmentDts?t.dts:Math.max(e.maxSegmentDts,t.dts))},me=function e(){e.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new Te(0,0),new Te(0,1),new Te(1,0),new Te(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("done",this.trigger.bind(this,"done"))},this)};(me.prototype=new re).push=function(e){var t,n,i;if("sei_rbsp"===e.nalUnitType&&4===(t=function(e){for(var t=0,n={payloadType:-1,payloadSize:0},i=0,r=0;t<e.byteLength&&128!==e[t];){for(;255===e[t];)i+=255,t++;for(i+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!n.payload&&4===i){n.payloadType=i,n.payloadSize=r,n.payload=e.subarray(t,t+r);break}t+=r,i=0,r=0}return n}(e.escapedRBSP)).payloadType&&(n=function(e){return 181!==e.payload[0]?null:49!=(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)}(t)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=function(e,t){var n,i,r,o,a=[];if(!(64&t[0]))return a;for(i=31&t[0],n=0;n<i;n++)o={type:3&t[2+(r=3*n)],pts:e},4&t[r+2]&&(o.ccData=t[r+3]<<8|t[r+4],a.push(o));return a}(e.pts,n),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},me.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.ccStreams_.forEach(function(e){e.flush()},this)):this.ccStreams_.forEach(function(e){e.flush()},this)},me.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},me.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},me.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},me.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},me.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)};var _e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ve=function(e){return null===e?"":(e=_e[e]||e,String.fromCharCode(e))},be=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],ye=function(){for(var e=[],t=15;t--;)e.push("");return e},Te=function e(t,n){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=n||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,i,r,o;if((t=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=ye();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=ye();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=ye()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,r))o=ve((i=(3&i)<<8)|r),this[this.mode_](e.pts,o),this.column_++;else if(this.isExtCharacter(i,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),o=ve((i=(3&i)<<8)|r),this[this.mode_](e.pts,o),this.column_++;else if(this.isMidRowCode(i,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&r)&&this.addFormatting(e.pts,["i"]),1==(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,r))this.column_+=3&r;else if(this.isPAC(i,r)){var a=be.indexOf(7968&t);"rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===r&&(r=null),o=ve(i),o+=ve(r),this[this.mode_](e.pts,o),this.column_+=o.length)}else this.lastControlCode_=null}};Te.prototype=new re,Te.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){try{return e.trim()}catch(nS){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},Te.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=ye(),this.nonDisplayed_=ye(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Te.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Te.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Te.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Te.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Te.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Te.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Te.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Te.prototype.isNormalChar=function(e){return e>=32&&e<=127},Te.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=ye(),this.displayed_=ye()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Te.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,n)},Te.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Te.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_];this.nonDisplayed_[this.row_]=n+=t},Te.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_];this.displayed_[this.row_]=n+=t},Te.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<15;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},Te.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_];this.displayed_[this.row_]=n+=t};var Ee={CaptionStream:me,Cea608Stream:Te},xe={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ce=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>4294967296;)e+=8589934592*n;return e},Se=function e(t){var n,i;e.prototype.init.call(this),this.type_=t,this.push=function(e){e.type===this.type_&&(void 0===i&&(i=e.dts),e.dts=Ce(e.dts,i),e.pts=Ce(e.pts,i),n=e.dts,this.trigger("data",e))},this.flush=function(){i=n,this.trigger("done")},this.discontinuity=function(){i=void 0,n=void 0}};Se.prototype=new re;var Ae,Pe=Se,Re=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},Me=function(e,t,n){return decodeURIComponent(Re(e,t,n))},Oe=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},we={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Me(e.data,1,t),e.value=Me(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=Me(e.data,1,t),e.url=Me(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=unescape(Re(e.data,0,t));break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}};(Ae=function(e){var t,n={debug:!(!e||!e.debug),descriptor:e&&e.descriptor},i=0,r=[],o=0;if(Ae.prototype.init.call(this),this.dispatchType=xe.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,a,s,l,c;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(o=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))n.debug&&console.log("Skipping unrecognized metadata packet");else if(r.push(e),o+=e.data.byteLength,1===r.length&&(i=Oe(e.data.subarray(6,10)),i+=10),!(o<i)){for(t={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},c=0;c<i;)t.data.set(r[0].data.subarray(0,i-c),c),c+=r[0].data.byteLength,o-=r[0].data.byteLength,r.shift();a=10,64&t.data[5]&&(a+=4,a+=Oe(t.data.subarray(10,14)),i-=Oe(t.data.subarray(16,20)));do{if((s=Oe(t.data.subarray(a+4,a+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((l={id:String.fromCharCode(t.data[a],t.data[a+1],t.data[a+2],t.data[a+3]),data:t.data.subarray(a+10,a+s+10)}).key=l.id,we[l.id]&&(we[l.id](l),"com.apple.streaming.transportStreamTimestamp"===l.owner)){var u=l.data,h=(1&u[3])<<30|u[4]<<22|u[5]<<14|u[6]<<6|u[7]>>>2;h*=4,l.timeStamp=h+=3&u[7],void 0===t.pts&&void 0===t.dts&&(t.pts=l.timeStamp,t.dts=l.timeStamp),this.trigger("timestamp",l)}t.frames.push(l),a+=10,a+=s}while(a<i);this.trigger("data",t)}}}).prototype=new re;var Ie,De,Le,ke=Ae,Ne=Pe;(Ie=function(){var e=new Uint8Array(188),t=0;Ie.prototype.init.call(this),this.push=function(n){var i,r=0,o=188;for(t?((i=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),i.set(n,t),t=0):i=n;o<i.byteLength;)71!==i[r]||71!==i[o]?(r++,o++):(this.trigger("data",i.subarray(r,o)),r+=188,o+=188);r<i.byteLength&&(e.set(i.subarray(r),0),t=i.byteLength-r)},this.flush=function(){188===t&&71===e[0]&&(this.trigger("data",e),t=0),this.trigger("done")}}).prototype=new re,(De=function(){var e,t,n,i;De.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var r=0;i.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===i.type?t(e.subarray(r),i):n(e.subarray(r),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},n=function(e,t){var n,r;if(1&e[5]){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,r=12+((15&e[10])<<8|e[11]);r<n;){var o=e[r],a=(31&e[r+1])<<8|e[r+2];o===xe.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=a:o===xe.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=a:o===xe.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][a]=o),r+=5+((15&e[r+3])<<8|e[r+4])}t.programMapTable=i.programMapTable}},this.push=function(t){var n={},i=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(i+=t[i]+1),0===n.pid)n.type="pat",e(t.subarray(i),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(i),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,n]):this.processPes_(t,i,n)},this.processPes_=function(e,t,n){n.streamType=n.pid===this.programMapTable.video?xe.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?xe.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new re,De.STREAM_TYPES={h264:27,adts:15},(Le=function(){var e=this,t={data:[],size:0},n={data:[],size:0},i={data:[],size:0},r=function(t,n,i){var r,o,a=new Uint8Array(t.size),s={type:n},l=0,c=0;if(t.data.length&&!(t.size<9)){for(s.trackId=t.data[0].pid,l=0;l<t.data.length;l++)a.set((o=t.data[l]).data,c),c+=o.data.byteLength;var u,h,d;(h=s).packetLength=6+((u=a)[4]<<8|u[5]),h.dataAlignmentIndicator=0!=(4&u[6]),192&(d=u[7])&&(h.pts=(14&u[9])<<27|(255&u[10])<<20|(254&u[11])<<12|(255&u[12])<<5|(254&u[13])>>>3,h.pts*=4,h.pts+=(6&u[13])>>>1,h.dts=h.pts,64&d&&(h.dts=(14&u[14])<<27|(255&u[15])<<20|(254&u[16])<<12|(255&u[17])<<5|(254&u[18])>>>3,h.dts*=4,h.dts+=(6&u[18])>>>1)),h.data=u.subarray(9+u[8]),r="video"===n||s.packetLength<=t.size,(i||r)&&(t.size=0,t.data.length=0),r&&e.trigger("data",s)}};Le.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var e,a;switch(o.streamType){case xe.H264_STREAM_TYPE:case xe.H264_STREAM_TYPE:e=t,a="video";break;case xe.ADTS_STREAM_TYPE:e=n,a="audio";break;case xe.METADATA_STREAM_TYPE:e=i,a="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&r(e,a,!0),e.data.push(o),e.size+=o.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},n=o.programMapTable;null!==n.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.video,codec:"avc",type:"video"}),null!==n.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[o.type]()},this.flush=function(){r(t,"video"),r(n,"audio"),r(i,"timed-metadata"),this.trigger("done")}}).prototype=new re;var Fe={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:Ie,TransportParseStream:De,ElementaryStream:Le,TimestampRolloverStream:Ne,CaptionStream:Ee.CaptionStream,Cea608Stream:Ee.Cea608Stream,MetadataStream:ke};for(var Be in xe)xe.hasOwnProperty(Be)&&(Fe[Be]=xe[Be]);var Ue,Ve=Fe,Ge=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(Ue=function(){var e;Ue.prototype.init.call(this),this.push=function(t){var n,i,r,o,a=0,s=0;if("audio"===t.type)for(e?(i=e,(e=new Uint8Array(i.byteLength+t.data.byteLength)).set(i),e.set(t.data,i.byteLength)):e=t.data;a+5<e.length;)if(255===e[a]&&240==(246&e[a+1])){if(e.byteLength<(n=a+((3&e[a+3])<<11|e[a+4]<<3|(224&e[a+5])>>5)))return;if(this.trigger("data",{pts:t.pts+s*(o=9e4*(r=1024*(1+(3&e[a+6])))/Ge[(60&e[a+2])>>>2]),dts:t.dts+s*o,sampleCount:r,audioobjecttype:1+(e[a+2]>>>6&3),channelcount:(1&e[a+2])<<2|(192&e[a+3])>>>6,samplerate:Ge[(60&e[a+2])>>>2],samplingfrequencyindex:(60&e[a+2])>>>2,samplesize:16,data:e.subarray(a+7+2*(1&~e[a+1]),n)}),e.byteLength===n)return void(e=void 0);s++,e=e.subarray(n)}else a++},this.flush=function(){this.trigger("done")}}).prototype=new re;var ze,je,He,We=Ue,Xe=function(e){var t=e.byteLength,n=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var r=e.byteLength-t,o=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");o.set(e.subarray(r,r+a)),n=new DataView(o.buffer).getUint32(0),i=8*a,t-=a},this.skipBits=function(e){var r;i>e?(n<<=e,i-=e):(e-=i,e-=8*(r=Math.floor(e/8)),t-=r,this.loadWord(),n<<=e,i-=e)},this.readBits=function(e){var r=Math.min(i,e),o=n>>>32-r;return(i-=r)>0?n<<=r:t>0&&this.loadWord(),(r=e-r)>0?o<<r|this.readBits(r):o},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(0!=(n&2147483648>>>e))return n<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(je=function(){var e,t,n=0;je.prototype.init.call(this),this.push=function(i){var r;for(t?((r=new Uint8Array(t.byteLength+i.data.byteLength)).set(t),r.set(i.data,t.byteLength),t=r):t=i.data;n<t.byteLength-3;n++)if(1===t[n+2]){e=n+5;break}for(;e<t.byteLength;)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<t.length);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3}t=t.subarray(n),e-=n,n=0},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")}}).prototype=new re,He={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(ze=function(){var e,t,n,i,r,o,a,s=new je;ze.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,i=e.dts,s.push(e))},s.on("data",function(a){var s={trackId:t,pts:n,dts:i,data:a};switch(31&a[0]){case 5:s.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:s.nalUnitType="sei_rbsp",s.escapedRBSP=r(a.subarray(1));break;case 7:s.nalUnitType="seq_parameter_set_rbsp",s.escapedRBSP=r(a.subarray(1)),s.config=o(s.escapedRBSP);break;case 8:s.nalUnitType="pic_parameter_set_rbsp";break;case 9:s.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",s)}),s.on("done",function(){e.trigger("done")}),this.flush=function(){s.flush()},a=function(e,t){var n,i=8,r=8;for(n=0;n<e;n++)0!==r&&(r=(i+t.readExpGolomb()+256)%256),i=0===r?i:r},r=function(e){for(var t,n,i=e.byteLength,r=[],o=1;o<i-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===r[0]&&(a++,r.shift()),n[o]=e[a];return n},o=function(e){var t,n,i,r,o,s,l,c,u,h,d,f,p,g=0,m=0,_=0,v=0,b=1;if(n=(t=new Xe(e)).readUnsignedByte(),r=t.readUnsignedByte(),i=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),He[n]&&(3===(o=t.readUnsignedExpGolomb())&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(d=3!==o?8:12,p=0;p<d;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),0===(s=t.readUnsignedExpGolomb()))t.readUnsignedExpGolomb();else if(1===s)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),c=t.readUnsignedExpGolomb(),u=t.readUnsignedExpGolomb(),0===(h=t.readBits(1))&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(g=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),_=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(t.readUnsignedByte()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}f&&(b=f[0]/f[1])}return{profileIdc:n,levelIdc:i,profileCompatibility:r,width:Math.ceil((16*(c+1)-2*g-2*m)*b),height:(2-h)*(u+1)*16-2*_-2*v}}}).prototype=new re;var Ye,Ke={H264Stream:ze,NalByteStream:je},Qe=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9];return(16&e[t+5])>>4?n+20:n+10},qe=function(e,t){return 6144&e[t+3]|e[t+4]<<3|(224&e[t+5])>>5};(Ye=function(){var e=new Uint8Array,t=0;Ye.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var i,r,o,a=0,s=0;for(e.length?(o=e.length,(e=new Uint8Array(n.byteLength+o)).set(e.subarray(0,o)),e.set(n,o)):e=n;e.length-s>=3;)if(e[s]!=="I".charCodeAt(0)||e[s+1]!=="D".charCodeAt(0)||e[s+2]!=="3".charCodeAt(0))if(255!=(255&e[s])||240!=(240&e[s+1]))s++;else{if(e.length-s<7)break;if(s+(a=qe(e,s))>e.length)break;r={type:"audio",data:e.subarray(s,s+a),pts:t,dts:t},this.trigger("data",r),s+=a}else{if(e.length-s<10)break;if(s+(a=Qe(e,s))>e.length)break;i={type:"timed-metadata",data:e.subarray(s,s+a)},this.trigger("data",i),s+=a}e=e.length-s>0?e.subarray(s):new Uint8Array}}).prototype=new re;var Ze,Je,$e,et,tt=Ye,nt=Ke.H264Stream,it=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],rt=["width","height","profileIdc","levelIdc","profileCompatibility"],ot=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},at=function(e,t,n,i,r,o){return{start:{dts:e,pts:e+(n-t)},end:{dts:e+(i-t),pts:e+(r-n)},prependedContentDuration:o,baseMediaDecodeTime:e}};(Je=function(e,t){var n=[],i=0,r=0,o=0,a=1/0;t=t||{},Je.prototype.init.call(this),this.push=function(t){ge(e,t),e&&it.forEach(function(n){e[n]=t[n]}),n.push(t)},this.setEarliestDts=function(t){r=t-e.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){o=e},this.flush=function(){var s,l,c,u;0!==n.length?(s=function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))}(n,e,r),e.baseMediaDecodeTime=pe(e,t.keepOriginalTimestamps),function(e,t,n,i){var r,o,a,s,l=0,c=0,u=0;if(t.length&&(r=he(e.baseMediaDecodeTime,e.samplerate),o=Math.ceil(9e4/(e.samplerate/1024)),n&&i&&(l=r-Math.max(n,i),u=(c=Math.floor(l/o))*o),!(c<1||u>45e3))){for((a=ue[e.samplerate])||(a=t[0].data),s=0;s<c;s++)t.splice(s,0,{data:a});e.baseMediaDecodeTime-=Math.floor(de(u,e.samplerate))}}(e,s,o,a),e.samples=function(e){var t,n=[];for(t=0;t<e.length;t++)n.push({size:e[t].data.byteLength,duration:1024});return n}(s),c=Y.mdat(function(e){var t,n,i=0,r=new Uint8Array(function(e){var t,n=0;for(t=0;t<e.length;t++)n+=e[t].data.byteLength;return n}(e));for(t=0;t<e.length;t++)r.set((n=e[t]).data,i),i+=n.data.byteLength;return r}(s)),n=[],l=Y.moof(i,[e]),u=new Uint8Array(l.byteLength+c.byteLength),i++,u.set(l),u.set(c,l.byteLength),fe(e),this.trigger("data",{track:e,boxes:u}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")}}).prototype=new re,(Ze=function(e,t){var n,i,r=0,o=[],a=[];t=t||{},Ze.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){ge(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],rt.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.data,e.pps=[t.data]),o.push(t)},this.flush=function(){for(var n,i,s,l,c,u,h,d=0;o.length&&"access_unit_delimiter_rbsp"!==o[0].nalUnitType;)o.shift();if(0===o.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if((i=function(e){var t,n,i=[],r=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)(n=e[t]).keyFrame?(i.length&&(r.push(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration),(i=[n]).nalCount=n.length,i.byteLength=n.byteLength,i.pts=n.pts,i.dts=n.dts,i.duration=n.duration):(i.duration+=n.duration,i.nalCount+=n.length,i.byteLength+=n.byteLength,i.push(n));return r.length&&i.duration<=0&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration,r.push(i),r}(function(e){var t,n,i=[],r=[];for(i.byteLength=0,t=0;t<e.length;t++)"access_unit_delimiter_rbsp"===(n=e[t]).nalUnitType?(i.length&&(i.duration=n.dts-i.dts,r.push(i)),(i=[n]).byteLength=n.data.byteLength,i.pts=n.pts,i.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(i.keyFrame=!0),i.duration=n.dts-i.dts,i.byteLength+=n.data.byteLength,i.push(n));return r.length&&(!i.duration||i.duration<=0)&&(i.duration=r[r.length-1].duration),r.push(i),r}(o)))[0][0].keyFrame||((n=this.getGopForFusion_(o[0],e))?(d=n.duration,i.unshift(n),i.byteLength+=n.byteLength,i.nalCount+=n.nalCount,i.pts=n.pts,i.dts=n.dts,i.duration+=n.duration):i=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e}(i)),a.length){var f;if(!(f=t.alignGopsAtEnd?this.alignGopsAtEnd_(i):this.alignGopsAtStart_(i)))return this.gopCache_.unshift({gop:i.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),o=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");fe(e),i=f}ge(e,i),e.samples=function(e,t){var n,i,r,o,a=0,s=[];for(n=0;n<e.length;n++)for(o=e[n],i=0;i<o.length;i++)a+=(r=oe(o[i],a)).size,s.push(r);return s}(i),l=Y.mdat(function(e){var t,n,i,r,o,a,s=0,l=new Uint8Array(e.byteLength+4*e.nalCount),c=new DataView(l.buffer);for(t=0;t<e.length;t++)for(r=e[t],n=0;n<r.length;n++)for(o=r[n],i=0;i<o.length;i++)c.setUint32(s,(a=o[i]).data.byteLength),l.set(a.data,s+=4),s+=a.data.byteLength;return l}(i)),e.baseMediaDecodeTime=pe(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",i.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),this.trigger("segmentTimingInfo",at(e.baseMediaDecodeTime,(u=i[0]).dts,u.pts,(h=i[i.length-1]).dts+h.duration,h.pts+h.duration,d)),this.gopCache_.unshift({gop:i.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),o=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),s=Y.moof(r,[e]),c=new Uint8Array(s.byteLength+l.byteLength),r++,c.set(s),c.set(l,s.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){fe(e),n=void 0,i=void 0},this.getGopForFusion_=function(t){var n,i,r,o,a,s=1/0;for(a=0;a<this.gopCache_.length;a++)r=(o=this.gopCache_[a]).gop,e.pps&&ot(e.pps[0],o.pps[0])&&e.sps&&ot(e.sps[0],o.sps[0])&&(r.dts<e.timelineStartInfo.dts||(n=t.dts-r.dts-r.duration)>=-1e4&&n<=45e3&&(!i||s>n)&&(i=o,s=n));return i?i.gop:null},this.alignGopsAtStart_=function(e){var t,n,i,r,o,s,l,c;for(o=e.byteLength,s=e.nalCount,l=e.duration,t=n=0;t<a.length&&n<e.length&&(i=a[t]).pts!==(r=e[n]).pts;)r.pts>i.pts?t++:(n++,o-=r.byteLength,s-=r.nalCount,l-=r.duration);return 0===n?e:n===e.length?null:((c=e.slice(n)).byteLength=o,c.duration=l,c.nalCount=s,c.pts=c[0].pts,c.dts=c[0].dts,c)},this.alignGopsAtEnd_=function(e){var t,n,i,r,o,s,l;for(t=a.length-1,n=e.length-1,o=null,s=!1;t>=0&&n>=0;){if((i=a[t]).pts===(r=e[n]).pts){s=!0;break}i.pts>r.pts?t--:(t===a.length-1&&(o=n),n--)}if(!s&&null===o)return null;if(0===(l=s?n:o))return e;var c=e.slice(l),u=c.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return c.byteLength=u.byteLength,c.duration=u.duration,c.nalCount=u.nalCount,c.pts=c[0].pts,c.dts=c[0].dts,c},this.alignGopsWith=function(e){a=e}}).prototype=new re,(et=function(e,t){this.numberOfTracks=0,this.metadataStream=t,this.remuxTracks=void 0===(e=e||{}).remux||!!e.remux,"boolean"==typeof e.keepOriginalTimestamps&&(this.keepOriginalTimestamps=e.keepOriginalTimestamps),this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,et.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBoxes.push(e.boxes),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track),void("audio"===e.track.type&&(this.audioTrack=e.track)))}}).prototype=new re,et.prototype.flush=function(e){var t,n,i,r,o=0,a={captions:[],captionStreams:{},metadata:[],info:{}},s=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,rt.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,it.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),a.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,i=Y.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(i.byteLength),a.initSegment.set(i),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],o),o+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(t=this.pendingCaptions[r]).startTime=t.startPts,this.keepOriginalTimestamps||(t.startTime-=s),t.startTime/=9e4,t.endTime=t.endPts,this.keepOriginalTimestamps||(t.endTime-=s),t.endTime/=9e4,a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)(n=this.pendingMetadata[r]).cueTime=n.pts,this.keepOriginalTimestamps||(n.cueTime-=s),n.cueTime/=9e4,a.metadata.push(n);a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},($e=function(e){var t,n,i=this,r=!0;$e.prototype.init.call(this),this.baseMediaDecodeTime=(e=e||{}).baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t,t.type="aac",t.metadataStream=new Ve.MetadataStream,t.aacStream=new tt,t.audioTimestampRolloverStream=new Ve.TimestampRolloverStream("audio"),t.timedMetadataTimestampRolloverStream=new Ve.TimestampRolloverStream("timed-metadata"),t.adtsStream=new We,t.coalesceStream=new et(e,t.metadataStream),t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)}),t.aacStream.on("data",function(r){"timed-metadata"!==r.type||t.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:i.baseMediaDecodeTime},codec:"adts",type:"audio"},t.coalesceStream.numberOfTracks++,t.audioSegmentStream=new Je(n,e),t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream))}),t.coalesceStream.on("data",this.trigger.bind(this,"data")),t.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new Ve.MetadataStream,r.packetStream=new Ve.TransportPacketStream,r.parseStream=new Ve.TransportParseStream,r.elementaryStream=new Ve.ElementaryStream,r.videoTimestampRolloverStream=new Ve.TimestampRolloverStream("video"),r.audioTimestampRolloverStream=new Ve.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new Ve.TimestampRolloverStream("timed-metadata"),r.adtsStream=new We,r.h264Stream=new nt,r.captionStream=new Ve.CaptionStream,r.coalesceStream=new et(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream),r.elementaryStream.pipe(r.videoTimestampRolloverStream).pipe(r.h264Stream),r.elementaryStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.elementaryStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(o){var a;if("metadata"===o.type){for(a=o.tracks.length;a--;)t||"video"!==o.tracks[a].type?n||"audio"!==o.tracks[a].type||((n=o.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime):(t=o.tracks[a]).timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime;t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new Ze(t,e),r.videoSegmentStream.on("timelineStartInfo",function(e){n&&(n.timelineStartInfo=e,r.audioSegmentStream.setEarliestDts(e.dts))}),r.videoSegmentStream.on("processedGopsInfo",i.trigger.bind(i,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){n&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),n&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new Je(n,e),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream))}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(i){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=i),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,fe(n),e.keepOriginalTimestamps||(n.timelineStartInfo.baseMediaDecodeTime=i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[],r.videoTimestampRolloverStream.discontinuity()),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,fe(t),r.captionStream.reset(),e.keepOriginalTimestamps||(t.timelineStartInfo.baseMediaDecodeTime=i)),r.timedMetadataTimestampRolloverStream&&r.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(e){if(r){var t=function(e){return e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)}(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new re;var st,lt,ct={Transmuxer:$e,VideoSegmentStream:Ze,AudioSegmentStream:Je,AUDIO_PROPERTIES:it,VIDEO_PROPERTIES:rt,generateVideoSegmentTimingInfo:at},ut=Q.parseType,ht=function(e){return new Date(1e3*e-20828448e5)},dt=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},ft=function(e){var t,n,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[];for(t=0;t+4<e.length;t+=n)if(n=i.getUint32(t),t+=4,n<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[t]&31)}return r},pt={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:st(e.subarray(78,e.byteLength))}},avcC:function(e){var t,n,i,r,o=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},s=31&e[5];for(i=6,r=0;r<s;r++)n=o.getUint16(i),i+=2,a.sps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;for(t=e[i],i++,r=0;r<t;r++)n=o.getUint16(i),i+=2,a.pps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={majorBrand:ut(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;i<e.byteLength;)n.compatibleBrands.push(ut(e.subarray(i,i+4))),i+=4;return n},dinf:function(e){return{boxes:st(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:st(e.subarray(8))}},hdlr:function(e){var t={version:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:ut(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(0===e[n]){n++;break}t.name+=String.fromCharCode(e[n])}return t.name=decodeURIComponent(escape(t.name)),t},mdat:function(e){return{byteLength:e.byteLength,nals:ft(e)}},mdhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===r.version?(r.creationTime=ht(n.getUint32(i+=4)),r.modificationTime=ht(n.getUint32(i+=8)),r.timescale=n.getUint32(i+=4),r.duration=n.getUint32(i+=8)):(r.creationTime=ht(n.getUint32(i)),r.modificationTime=ht(n.getUint32(i+=4)),r.timescale=n.getUint32(i+=4),r.duration=n.getUint32(i+=4)),t=n.getUint16(i+=4),r.language+=String.fromCharCode(96+(t>>10)),r.language+=String.fromCharCode(96+((992&t)>>5)),r.language+=String.fromCharCode(96+(31&t)),r},mdia:function(e){return{boxes:st(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:st(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(n.streamDescriptor=st(e.subarray(28))[0]),n},moof:function(e){return{boxes:st(e)}},moov:function(e){return{boxes:st(e)}},mvex:function(e){return{boxes:st(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(i.creationTime=ht(t.getUint32(n+=4)),i.modificationTime=ht(t.getUint32(n+=8)),i.timescale=t.getUint32(n+=4),i.duration=t.getUint32(n+=8)):(i.creationTime=ht(t.getUint32(n)),i.modificationTime=ht(t.getUint32(n+=4)),i.timescale=t.getUint32(n+=4),i.duration=t.getUint32(n+=4)),i.rate=t.getUint16(n+=4)+t.getUint16(n+2)/16,i.volume=t.getUint8(n+=4)+t.getUint8(n+1)/8,n+=2,n+=2,n+=8,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,i.nextTrackId=t.getUint32(n+=24),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)n.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return n},sidx:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:n.getUint32(4),timescale:n.getUint32(8),earliestPresentationTime:n.getUint32(12),firstOffset:n.getUint32(16)},r=n.getUint16(22);for(t=24;r;t+=12,r--)i.references.push({referenceType:(128&e[t])>>>7,referencedSize:2147483647&n.getUint32(t),subsegmentDuration:n.getUint32(t+4),startsWithSap:!!(128&e[t+8]),sapType:(112&e[t+8])>>>4,sapDeltaTime:268435455&n.getUint32(t+8)});return i},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:st(e)}},stco:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.chunkOffsets.push(n.getUint32(t));return i},stsc:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=n.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;i;t+=12,i--)r.sampleToChunks.push({firstChunk:n.getUint32(t),samplesPerChunk:n.getUint32(t+4),sampleDescriptionIndex:n.getUint32(t+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:st(e.subarray(8))}},stsz:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:n.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)i.entries.push(n.getUint32(t));return i},stts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.timeToSamples.push({sampleCount:n.getUint32(t),sampleDelta:n.getUint32(t+4)});return i},styp:function(e){return pt.ftyp(e)},tfdt:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:e[4]<<24|e[5]<<16|e[6]<<8|e[7]};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),t},tfhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},r=1&i.flags[2],o=2&i.flags[2],a=8&i.flags[2],s=16&i.flags[2],l=32&i.flags[2],c=65536&i.flags[0],u=131072&i.flags[0];return t=8,r&&(t+=4,i.baseDataOffset=n.getUint32(12),t+=4),o&&(i.sampleDescriptionIndex=n.getUint32(t),t+=4),a&&(i.defaultSampleDuration=n.getUint32(t),t+=4),s&&(i.defaultSampleSize=n.getUint32(t),t+=4),l&&(i.defaultSampleFlags=n.getUint32(t)),c&&(i.durationIsEmpty=!0),!r&&u&&(i.baseDataOffsetIsMoof=!0),i},tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(i.creationTime=ht(t.getUint32(n+=4)),i.modificationTime=ht(t.getUint32(n+=8)),i.trackId=t.getUint32(n+=4),n+=4,i.duration=t.getUint32(n+=8)):(i.creationTime=ht(t.getUint32(n)),i.modificationTime=ht(t.getUint32(n+=4)),i.trackId=t.getUint32(n+=4),n+=4,i.duration=t.getUint32(n+=4)),n+=4,i.layer=t.getUint16(n+=8),i.alternateGroup=t.getUint16(n+=2),i.volume=t.getUint8(n+=2)+t.getUint8(n+1)/8,n+=2,n+=2,i.matrix=new Uint32Array(e.subarray(n,n+36)),i.width=t.getUint16(n+=36)+t.getUint16(n+2)/16,i.height=t.getUint16(n+=4)+t.getUint16(n+2)/16,i},traf:function(e){return{boxes:st(e)}},trak:function(e){return{boxes:st(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&n.flags[2],o=4&n.flags[2],a=1&n.flags[1],s=2&n.flags[1],l=4&n.flags[1],c=8&n.flags[1],u=i.getUint32(4),h=8;for(r&&(n.dataOffset=i.getInt32(h),h+=4),o&&u&&(t={flags:dt(e.subarray(h,h+4))},h+=4,a&&(t.duration=i.getUint32(h),h+=4),s&&(t.size=i.getUint32(h),h+=4),c&&(t.compositionTimeOffset=i.getUint32(h),h+=4),n.samples.push(t),u--);u--;)t={},a&&(t.duration=i.getUint32(h),h+=4),s&&(t.size=i.getUint32(h),h+=4),l&&(t.flags=dt(e.subarray(h,h+4)),h+=4),c&&(t.compositionTimeOffset=i.getUint32(h),h+=4),n.samples.push(t);return n},"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}},gt={inspect:st=function(e){for(var t,n,i,r,o,a=0,s=[],l=new ArrayBuffer(e.length),c=new Uint8Array(l),u=0;u<e.length;++u)c[u]=e[u];for(t=new DataView(l);a<e.byteLength;)n=t.getUint32(a),i=ut(e.subarray(a+4,a+8)),(o=(pt[i]||function(e){return{data:e}})(e.subarray(a+8,r=n>1?a+n:e.byteLength))).size=n,o.type=i,s.push(o),a=r;return s},textify:lt=function(e,t){var n;return t=t||0,n=new Array(2*t+1).join(" "),e.map(function(e,i){return n+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=n+"  "+t+": ",r=e[t];if(r instanceof Uint8Array||r instanceof Uint32Array){var o=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return o?1===o.length?i+"<"+o.join("").slice(1)+">":i+"<\n"+o.map(function(e){return n+"  "+e}).join("\n")+"\n"+n+"  >":i+"<>"}return i+JSON.stringify(r,null,2).split("\n").map(function(e,t){return 0===t?e:n+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+lt(e.boxes,t+1):"")}).join("\n")},parseTfdt:pt.tfdt,parseHdlr:pt.hdlr,parseTfhd:pt.tfhd,parseTrun:pt.trun,parseSidx:pt.sidx},mt=function(e){for(var t,n,i=e.byteLength,r=[],o=1;o<i-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(r.push(o+2),o+=2):o++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(o=0;o<t;a++,o++)a===r[0]&&(a++,r.shift()),n[o]=e[a];return n},_t=Ee.CaptionStream,vt=function(e,t){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(n<r.size)return r;n-=r.size}return null},bt=function(e,t){var n=Q.findBox(e,["moof","traf"]),i=Q.findBox(e,["mdat"]),r={},o=[];return i.forEach(function(e,t){o.push({mdat:e,traf:n[t]})}),o.forEach(function(e){var n,i=e.mdat,o=e.traf,a=Q.findBox(o,["tfhd"]),s=gt.parseTfhd(a[0]),l=s.trackId,c=Q.findBox(o,["tfdt"]),u=c.length>0?gt.parseTfdt(c[0]).baseMediaDecodeTime:0,h=Q.findBox(o,["trun"]);t===l&&h.length>0&&(n=function(e,t,n){var i,r,o,a,s=new DataView(e.buffer,e.byteOffset,e.byteLength),l=[];for(r=0;r+4<e.length;r+=o)if(o=s.getUint32(r),r+=4,!(o<=0))switch(31&e[r]){case 6:var c=e.subarray(r+1,r+1+o),u=vt(r,t);i={nalUnitType:"sei_rbsp",size:o,data:c,escapedRBSP:mt(c),trackId:n},u?(i.pts=u.pts,i.dts=u.dts,a=u):(i.pts=a.pts,i.dts=a.dts),l.push(i)}return l}(i,function(e,t,n){var i=t,r=s.defaultSampleDuration||0,o=s.defaultSampleSize||0,a=s.trackId,l=[];return e.forEach(function(e){var t=gt.parseTrun(e).samples;t.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=o),e.trackId=a,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=i+e.compositionTimeOffset,i+=e.duration}),l=l.concat(t)}),l}(h,u),l),r[l]||(r[l]=[]),r[l]=r[l].concat(n))}),r},yt={generator:Y,probe:Q,Transmuxer:ct.Transmuxer,AudioSegmentStream:ct.AudioSegmentStream,VideoSegmentStream:ct.VideoSegmentStream,CaptionParser:function(){var e,t,n,i,r,o=!1;this.isInitialized=function(){return o},this.init=function(){e=new _t,o=!0,e.on("data",function(e){e.startTime=e.startPts/i,e.endTime=e.endPts/i,r.captions.push(e),r.captionStreams[e.stream]=!0})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length||n===e[0]&&i===t[n])},this.parse=function(e,o,a){var s;if(!this.isInitialized())return null;if(!o||!a)return null;if(this.isNewInit(o,a))i=a[n=o[0]];else if(!n||!i)return t.push(e),null;for(;t.length>0;){var l=t.shift();this.parse(l,o,a)}return null!==(s=function(e,t,n){return t?{seiNals:bt(e,t)[t],timescale:n}:null}(e,n,i))&&s.seiNals?(this.pushNals(s.seiNals),this.flushStream(),r):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,i=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}},Tt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Et=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),xt=function(){function e(t,n){Tt(this,e),this.options=n||{},this.self=t,this.init()}return Et(e,[{key:"init",value:function(){var e,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new yt.Transmuxer(this.options),e=this.self,(t=this.transmuxer).on("data",function(t){var n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};var i=t.data;t.data=i.buffer,e.postMessage({action:"data",segment:t,byteOffset:i.byteOffset,byteLength:i.byteLength},[t.data])}),t.captionStream&&t.captionStream.on("data",function(t){e.postMessage({action:"caption",data:t})}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:t})})}},{key:"push",value:function(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(e){this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4*(e.timestampOffset||0)))}},{key:"setAudioAppendStart",value:function(e){this.transmuxer.setAudioAppendStart(Math.ceil(9e4*e.appendStart))}},{key:"flush",value:function(e){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}]),e}();new function(e){e.onmessage=function(t){"init"===t.data.action&&t.data.options?this.messageHandlers=new xt(e,t.data.options):(this.messageHandlers||(this.messageHandlers=new xt(e)),t.data&&t.data.action&&"init"!==t.data.action&&this.messageHandlers[t.data.action]&&this.messageHandlers[t.data.action](t.data))}}(n)}()}),Ox={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},wx=function(e){return e.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)})})},Ix=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n={codecCount:0};return n.codecCount=t.split(",").length,n.codecCount=n.codecCount||2,(e=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(t))&&(n.videoCodec=e[2],n.videoObjectTypeIndicator=e[3]),n.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(t),n.audioProfile=n.audioProfile&&n.audioProfile[2],n},Dx=function(e,t,n){return e+"/"+t+'; codecs="'+n.filter(function(e){return!!e}).join(", ")+'"'},Lx=function(e){return/mp4a\.\d+.\d+/i.test(e)},kx=function(e){return/avc1\.[\da-f]+/i.test(e)},Nx=function(e,t,n){if(null==t||!e.length)return[];var i=Math.ceil(9e4*(t-n+3)),r=void 0;for(r=0;r<e.length&&!(e[r].pts>i);r++);return e.slice(r)},Fx=function(e,t,n){var i=null,r=null,o=0,a=[],s=[];if(!e&&!t)return vE.createTimeRange();if(!e)return t.buffered;if(!t)return e.buffered;if(n)return e.buffered;if(0===e.buffered.length&&0===t.buffered.length)return vE.createTimeRange();for(var l=e.buffered,c=t.buffered,u=l.length;u--;)a.push({time:l.start(u),type:"start"}),a.push({time:l.end(u),type:"end"});for(u=c.length;u--;)a.push({time:c.start(u),type:"start"}),a.push({time:c.end(u),type:"end"});for(a.sort(function(e,t){return e.time-t.time}),u=0;u<a.length;u++)"start"===a[u].type?2==++o&&(i=a[u].time):"end"===a[u].type&&1==--o&&(r=a[u].time),null!==i&&null!==r&&(s.push([i,r]),i=null,r=null);return vE.createTimeRanges(s)},Bx=function(e){function t(e,n){xE(this,t);var i=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,vE.EventTarget));i.timestampOffset_=0,i.pendingBuffers_=[],i.bufferUpdating_=!1,i.mediaSource_=e,i.codecs_=n,i.audioCodec_=null,i.videoCodec_=null,i.audioDisabled_=!1,i.appendAudioInitSegment_=!0,i.gopBuffer_=[],i.timeMapping_=0,i.safeAppend_=vE.browser.IE_VERSION>=11;var r={remux:!1,alignGopsAtEnd:i.safeAppend_};return i.codecs_.forEach(function(e){Lx(e)?i.audioCodec_=e:kx(e)&&(i.videoCodec_=e)}),i.transmuxer_=new Mx,i.transmuxer_.postMessage({action:"init",options:r}),i.transmuxer_.onmessage=function(e){return"data"===e.data.action?i.data_(e):"done"===e.data.action?i.done_(e):"gopInfo"===e.data.action?i.appendGopInfo_(e):"videoSegmentTimingInfo"===e.data.action?i.videoSegmentTimingInfo_(e.data.videoSegmentTimingInfo):void 0},Object.defineProperty(i,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(e){"number"==typeof e&&e>=0&&(this.timestampOffset_=e,this.appendAudioInitSegment_=!0,this.gopBuffer_.length=0,this.timeMapping_=0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e}))}}),Object.defineProperty(i,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(e){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=e),this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=e)}}),Object.defineProperty(i,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}}),Object.defineProperty(i,"buffered",{get:function(){return Fx(this.videoBuffer_,this.audioBuffer_,this.audioDisabled_)}}),i}return SE(t,vE.EventTarget),CE(t,[{key:"data_",value:function(e){var t=e.data.segment;t.data=new Uint8Array(t.data,e.data.byteOffset,e.data.byteLength),t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength),function(e,t,n){var i=t.player_;if(n.captions&&n.captions.length)for(var r in e.inbandTextTracks_||(e.inbandTextTracks_={}),n.captionStreams)if(!e.inbandTextTracks_[r]){i.tech_.trigger({type:"usage",name:"hls-608"});var o=i.textTracks().getTrackById(r);e.inbandTextTracks_[r]=o||i.addRemoteTextTrack({kind:"captions",id:r,label:r},!1).track}n.metadata&&n.metadata.length&&!e.metadataTrack_&&(e.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=n.metadata.dispatchType)}(this,this.mediaSource_,t),this.pendingBuffers_.push(t)}},{key:"done_",value:function(e){"closed"!==this.mediaSource_.readyState?this.processPendingSegments_():this.pendingBuffers_.length=0}},{key:"videoSegmentTimingInfo_",value:function(e){var t={start:{decode:e.start.dts/9e4,presentation:e.start.pts/9e4},end:{decode:e.end.dts/9e4,presentation:e.end.pts/9e4},baseMediaDecodeTime:e.baseMediaDecodeTime/9e4};e.prependedContentDuration&&(t.prependedContentDuration=e.prependedContentDuration/9e4),this.trigger({type:"videoSegmentTimingInfo",videoSegmentTimingInfo:t})}},{key:"createRealSourceBuffers_",value:function(){var e=this,t=["audio","video"];t.forEach(function(n){if(e[n+"Codec_"]&&!e[n+"Buffer_"]){var i=null;e.mediaSource_[n+"Buffer_"]?(i=e.mediaSource_[n+"Buffer_"]).updating=!1:(i=function(t,i){var r=e.mediaSource_.nativeMediaSource_.addSourceBuffer(n+'/mp4;codecs="'+e[n+"Codec_"]+'"'),o=Object.create(null);o.updating=!1,o.realBuffer_=r;var a=function(e){"function"==typeof r[e]?o[e]=function(){return r[e].apply(r,arguments)}:void 0===o[e]&&Object.defineProperty(o,e,{get:function(){return r[e]},set:function(t){return r[e]=t}})};for(var s in r)a(s);return o}(),e.mediaSource_[n+"Buffer_"]=i),e[n+"Buffer_"]=i,["update","updatestart","updateend"].forEach(function(r){i.addEventListener(r,function(){if("audio"!==n||!e.audioDisabled_)return"updateend"===r&&(e[n+"Buffer_"].updating=!1),t.every(function(t){return!("audio"!==t||!e.audioDisabled_)||n===t||!e[t+"Buffer_"]||!e[t+"Buffer_"].updating})?e.trigger(r):void 0})})}})}},{key:"appendBuffer",value:function(e){if(this.bufferUpdating_=!0,this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.videoBuffer_&&this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:Nx(this.gopBuffer_,this.mediaSource_.player_?this.mediaSource_.player_.currentTime():null,this.timeMapping_)}),this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]),this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(e){this.gopBuffer_=function(e,t,n){if(!t.length)return e;if(n)return t.slice();for(var i=t[0].pts,r=0;r<e.length&&!(e[r].pts>=i);r++);return e.slice(0,r).concat(t)}(this.gopBuffer_,e.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(e,t){if(this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(e,t),this.gopBuffer_=function(e,t,n,i){for(var r=Math.ceil(9e4*(t-i)),o=Math.ceil(9e4*(n-i)),a=e.slice(),s=e.length;s--&&!(e[s].pts<=o););if(-1===s)return a;for(var l=s+1;l--&&!(e[l].pts<=r););return l=Math.max(l,0),a.splice(l,s-l+1),a}(this.gopBuffer_,e,t,this.timeMapping_)),!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(e,t)),mx(e,t,this.metadataTrack_),this.inbandTextTracks_)for(var n in this.inbandTextTracks_)mx(e,t,this.inbandTextTracks_[n])}},{key:"processPendingSegments_",value:function(){var e={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};e=this.pendingBuffers_.reduce(function(e,t){var n=t.type,i=t.data,r=t.initSegment;return e[n].segments.push(i),e[n].bytes+=i.byteLength,e[n].initSegment=r,t.captions&&(e.captions=e.captions.concat(t.captions)),t.info&&(e[n].info=t.info),t.metadata&&(e.metadata=e.metadata.concat(t.metadata)),e},e),this.videoBuffer_||this.audioBuffer_||(0===e.video.bytes&&(this.videoCodec_=null),0===e.audio.bytes&&(this.audioCodec_=null),this.createRealSourceBuffers_()),e.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:e.audio.info}),e.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:e.video.info}),this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(e.audio.segments.unshift(e.audio.initSegment),e.audio.bytes+=e.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);var t=!1;this.videoBuffer_&&e.video.bytes?(e.video.segments.unshift(e.video.initSegment),e.video.bytes+=e.video.initSegment.byteLength,this.concatAndAppendSegments_(e.video,this.videoBuffer_)):!this.videoBuffer_||!this.audioDisabled_&&this.audioBuffer_||(t=!0),function(e,t,n){var i=om.a.WebKitDataCue||om.a.VTTCue;if(t&&t.forEach(function(e){this.inbandTextTracks_[e.stream].addCue(new i(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},e),n){var r=_x(e.mediaSource_.duration);if(n.forEach(function(e){var t=e.cueTime+this.timestampOffset;!("number"!=typeof t||om.a.isNaN(t)||t<0)&&t<1/0&&e.frames.forEach(function(e){var n=new i(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,function(e){Object.defineProperties(e.frame,{id:{get:function(){return vE.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return vE.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return vE.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})}(n),this.metadataTrack_.addCue(n)},this)},e),e.metadataTrack_&&e.metadataTrack_.cues&&e.metadataTrack_.cues.length){for(var o=e.metadataTrack_.cues,a=[],s=0;s<o.length;s++)o[s]&&a.push(o[s]);var l=a.reduce(function(e,t){var n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e},{}),c=Object.keys(l).sort(function(e,t){return Number(e)-Number(t)});c.forEach(function(e,t){var n=l[e],i=Number(c[t+1])||r;n.forEach(function(e){e.endTime=i})})}}}(this,e.captions,e.metadata),!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(e.audio,this.audioBuffer_),this.pendingBuffers_.length=0,t&&this.trigger("updateend"),this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(e,t){var n=0,i=void 0;if(e.bytes){i=new Uint8Array(e.bytes),e.segments.forEach(function(e){i.set(e,n),n+=e.byteLength});try{t.updating=!0,t.appendBuffer(i)}catch(r){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:r.message,originalError:r})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort(),!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"}),this.pendingBuffers_.length=0,this.bufferUpdating_=!1}}]),t}(),Ux=function(e){function t(){xE(this,t);var e=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=void 0;for(n in e.nativeMediaSource_=new om.a.MediaSource,e.nativeMediaSource_)n in t.prototype||"function"!=typeof e.nativeMediaSource_[n]||(e[n]=e.nativeMediaSource_[n].bind(e.nativeMediaSource_));return e.duration_=NaN,Object.defineProperty(e,"duration",{get:function(){return this.duration_===1/0?this.duration_:this.nativeMediaSource_.duration},set:function(e){this.duration_=e,e===1/0||(this.nativeMediaSource_.duration=e)}}),Object.defineProperty(e,"seekable",{get:function(){return this.duration_===1/0?vE.createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}}),Object.defineProperty(e,"readyState",{get:function(){return this.nativeMediaSource_.readyState}}),Object.defineProperty(e,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}}),e.sourceBuffers=[],e.activeSourceBuffers_=[],e.updateActiveSourceBuffers_=function(){if(e.activeSourceBuffers_.length=0,1===e.sourceBuffers.length){var t=e.sourceBuffers[0];return t.appendAudioInitSegment_=!0,t.audioDisabled_=!t.audioCodec_,void e.activeSourceBuffers_.push(t)}for(var n=!1,i=!0,r=0;r<e.player_.audioTracks().length;r++){var o=e.player_.audioTracks()[r];if(o.enabled&&"main"!==o.kind){n=!0,i=!1;break}}e.sourceBuffers.forEach(function(t,r){if(t.appendAudioInitSegment_=!0,t.videoCodec_&&t.audioCodec_)t.audioDisabled_=n;else if(t.videoCodec_&&!t.audioCodec_)t.audioDisabled_=!0,i=!1;else if(!t.videoCodec_&&t.audioCodec_&&(t.audioDisabled_=r?i:!i,t.audioDisabled_))return;e.activeSourceBuffers_.push(t)})},e.onPlayerMediachange_=function(){e.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=!0})},e.onHlsReset_=function(){e.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.postMessage({action:"resetCaptions"})})},e.onHlsSegmentTimeMapping_=function(t){e.sourceBuffers.forEach(function(e){return e.timeMapping_=t.mapping})},["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},e),e.on("sourceopen",function(t){var n=sm.a.querySelector('[src="'+e.url_+'"]');n&&(e.player_=vE(n.parentNode),e.player_&&(e.player_.tech_.on("hls-reset",e.onHlsReset_),e.player_.tech_.on("hls-segment-time-mapping",e.onHlsSegmentTimeMapping_),e.player_.audioTracks&&e.player_.audioTracks()&&(e.player_.audioTracks().on("change",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("addtrack",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("removetrack",e.updateActiveSourceBuffers_)),e.player_.on("mediachange",e.onPlayerMediachange_)))}),e.on("sourceended",function(t){for(var n=_x(e.duration),i=0;i<e.sourceBuffers.length;i++){var r=e.sourceBuffers[i],o=r.metadataTrack_&&r.metadataTrack_.cues;o&&o.length&&(o[o.length-1].endTime=n)}}),e.on("sourceclose",function(e){this.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.terminate()}),this.sourceBuffers.length=0,this.player_&&(this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&this.player_.off("mediachange",this.onPlayerMediachange_),this.player_.tech_&&this.player_.tech_.el_&&(this.player_.tech_.off("hls-reset",this.onHlsReset_),this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)))}),e}return SE(t,vE.EventTarget),CE(t,[{key:"addSeekableRange_",value:function(e,t){var n=void 0;if(this.duration!==1/0)throw(n=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity")).name="InvalidStateError",n.code=11,n;(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))&&(this.nativeMediaSource_.duration=t)}},{key:"addSourceBuffer",value:function(e){var t=void 0,n=function(e){var t={type:"",parameters:{}},n=e.trim().split(";");return t.type=n.shift().trim(),n.forEach(function(e){var n=e.trim().split("=");if(n.length>1){var i=n[0].replace(/"/g,"").trim(),r=n[1].replace(/"/g,"").trim();t.parameters[i]=r}}),t}(e);if(/^(video|audio)\/mp2t$/i.test(n.type)){var i=[];n.parameters&&n.parameters.codecs&&(i=n.parameters.codecs.split(","),i=(i=wx(i)).filter(function(e){return Lx(e)||kx(e)})),0===i.length&&(i=["avc1.4d400d","mp4a.40.2"]),t=new Bx(this,i),0!==this.sourceBuffers.length&&(this.sourceBuffers[0].createRealSourceBuffers_(),t.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)}else t=this.nativeMediaSource_.addSourceBuffer(e);return this.sourceBuffers.push(t),t}}]),t}(),Vx=0;vE.mediaSources={};var Gx=function(e,t){var n=vE.mediaSources[e];if(!n)throw new Error("Media Source not found (Video.js)");n.trigger({type:"sourceopen",swfId:t})},zx=function(){return!!om.a.MediaSource&&!!om.a.MediaSource.isTypeSupported&&om.a.MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')},jx=function(){if(this.MediaSource={open:Gx,supportsNativeMediaSources:zx},zx())return new Ux;throw new Error("Cannot use create a virtual MediaSource for this video")};jx.open=Gx,jx.supportsNativeMediaSources=zx;var Hx={createObjectURL:function(e){var t=void 0;return e instanceof Ux?(t=om.a.URL.createObjectURL(e.nativeMediaSource_),e.url_=t,t):e instanceof Ux?(t="blob:vjs-media-source/"+Vx,Vx++,vE.mediaSources[t]=e,t):(t=om.a.URL.createObjectURL(e),e.url_=t,t)}};vE.MediaSource=jx,vE.URL=Hx;var Wx=vE.EventTarget,Xx=vE.mergeOptions,Yx=function(e,t){for(var n=void 0,i=Xx(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod}),r=0;r<t.playlists.length;r++){var o=IE(i,t.playlists[r]);o?i=o:n=!0}return wE(t,function(e,t,r,o){if(e.playlists&&e.playlists.length){var a=e.playlists[0].uri,s=IE(i,e.playlists[0]);s&&((i=s).mediaGroups[t][r][o].playlists[0]=i.playlists[a],n=!1)}}),n?null:i},Kx=function(e){return e.uri+"-"+e.byterange.offset+"-"+(e.byterange.offset+e.byterange.length-1)},Qx=function(e,t){var n,i,r={};for(var o in e){var a=e[o].sidx;if(a){var s=Kx(a);if(!t[s])break;n=t[s].sidxInfo,i=a,(Boolean(!n.map&&!i.map)||Boolean(n.map&&i.map&&n.map.byterange.offset===i.map.byterange.offset&&n.map.byterange.length===i.map.byterange.length))&&n.uri===i.uri&&n.byterange.offset===i.byterange.offset&&n.byterange.length===i.byterange.length&&(r[s]=t[s])}}return r},qx=function(e,t,n,i,r){var o={uri:EE(i.handleManifestRedirects,e.resolvedUri),byterange:e.byterange,playlist:t};return n(vE.mergeOptions(o,{responseType:"arraybuffer",headers:nx(o)}),r)},Zx=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];xE(this,t);var o=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=i.withCredentials,s=void 0!==a&&a,l=i.handleManifestRedirects,c=void 0!==l&&l;if(o.hls_=n,o.withCredentials=s,o.handleManifestRedirects=c,!e)throw new Error("A non-empty playlist URL or playlist is required");return o.on("minimumUpdatePeriod",function(){o.refreshXml_()}),o.on("mediaupdatetimeout",function(){o.refreshMedia_(o.media().uri)}),o.state="HAVE_NOTHING",o.loadedPlaylists_={},"string"==typeof e?(o.srcUrl=e,o.sidxMapping_={},AE(o)):(o.setupChildLoader(r,e),o)}return SE(t,Wx),CE(t,[{key:"setupChildLoader",value:function(e,t){this.masterPlaylistLoader_=e,this.childPlaylist_=t}},{key:"dispose",value:function(){this.stopRequest(),this.loadedPlaylists_={},om.a.clearTimeout(this.minimumUpdatePeriodTimeout_),om.a.clearTimeout(this.mediaRequest_),om.a.clearTimeout(this.mediaUpdateTimeout)}},{key:"hasPendingRequest",value:function(){return this.request||this.mediaRequest_}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"sidxRequestFinished_",value:function(e,t,n,i){var r=this;return function(o,a){if(r.request){if(r.request=null,o)return r.error={status:a.status,message:"DASH playlist request error at URL: "+e.uri,response:a.response,code:2},n&&(r.state=n),r.trigger("error"),i(t,null);var s=new Uint8Array(a.response),l=s_.a.parseSidx(s.subarray(8));return i(t,l)}}}},{key:"media",value:function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var n=this.state;if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}var i=!this.media_||e.uri!==this.media_.uri;if(i&&this.loadedPlaylists_[e.uri]&&this.loadedPlaylists_[e.uri].endList)return this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(i)if(this.media_&&this.trigger("mediachanging"),e.sidx){var r=void 0,o=void 0;this.masterPlaylistLoader_?(r=this.masterPlaylistLoader_.master,o=this.masterPlaylistLoader_.sidxMapping_):(r=this.master,o=this.sidxMapping_);var a=Kx(e.sidx);o[a]={sidxInfo:e.sidx},this.request=qx(e.sidx,e,this.hls_.xhr,{handleManifestRedirects:this.handleManifestRedirects},this.sidxRequestFinished_(e,r,n,function(i,r){if(!i||!r)throw new Error("failed to request sidx");o[a].sidx=r,t.haveMetadata({startingState:n,playlist:i.playlists[e.uri]})}))}else this.mediaRequest_=om.a.setTimeout(this.haveMetadata.bind(this,{startingState:n,playlist:e}),0)}},{key:"haveMetadata",value:function(e){var t=e.startingState,n=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[n.uri]=n,this.mediaRequest_=null,this.refreshMedia_(n.uri),this.trigger("HAVE_MASTER"===t?"loadedmetadata":"mediachange")}},{key:"pause",value:function(){this.stopRequest(),om.a.clearTimeout(this.mediaUpdateTimeout),om.a.clearTimeout(this.minimumUpdatePeriodTimeout_),"HAVE_NOTHING"===this.state&&(this.started=!1)}},{key:"load",value:function(e){var t=this;om.a.clearTimeout(this.mediaUpdateTimeout),om.a.clearTimeout(this.minimumUpdatePeriodTimeout_);var n=this.media();e?this.mediaUpdateTimeout=om.a.setTimeout(function(){return t.load()},n?n.targetDuration/2*1e3:5e3):this.started?this.trigger("loadedplaylist"):this.start()}},{key:"parseMasterXml",value:function(){var e=o_(this.masterXml_,{manifestUri:this.srcUrl,clientOffset:this.clientOffset_,sidxMapping:this.sidxMapping_});e.uri=this.srcUrl;for(var t=0;t<e.playlists.length;t++){var n="placeholder-uri-"+t;e.playlists[t].uri=n,e.playlists[n]=e.playlists[t]}return wE(e,function(t,n,i,r){if(t.playlists&&t.playlists.length){var o="placeholder-uri-"+n+"-"+i+"-"+r;t.playlists[0].uri=o,e.playlists[o]=t.playlists[0]}}),DE(e),LE(e),e}},{key:"start",value:function(){var e=this;this.started=!0,this.masterPlaylistLoader_?this.mediaRequest_=om.a.setTimeout(this.haveMaster_.bind(this),0):this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,n){if(e.request){if(e.request=null,t)return e.error={status:n.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:n.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.masterXml_=n.responseText,e.masterLoaded_=n.responseHeaders&&n.responseHeaders.date?Date.parse(n.responseHeaders.date):Date.now(),e.srcUrl=EE(e.handleManifestRedirects,e.srcUrl,n),e.syncClientServerClock_(e.onClientServerClockSync_.bind(e))}})}},{key:"syncClientServerClock_",value:function(e){var t=this,n=function(e){var t=qm(e,"UTCTiming")[0];if(!t)return null;var n=e_(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return n}(r_(this.masterXml_));return null===n?(this.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===n.method?(this.clientOffset_=n.value-Date.now(),e()):void(this.request=this.hls_.xhr({uri:TE(this.srcUrl,n.value),method:n.method,withCredentials:this.withCredentials},function(i,r){if(t.request){if(i)return t.clientOffset_=t.masterLoaded_-Date.now(),e();var o;o="HEAD"===n.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):t.masterLoaded_:Date.parse(r.responseText),t.clientOffset_=o-Date.now(),e()}}))}},{key:"haveMaster_",value:function(){this.state="HAVE_MASTER",this.mediaRequest_=null,this.masterPlaylistLoader_?this.media_||this.media(this.childPlaylist_):(this.master=this.parseMasterXml(),this.trigger("loadedplaylist"))}},{key:"onClientServerClockSync_",value:function(){var e=this;this.haveMaster_(),this.hasPendingRequest()||this.media_||this.media(this.master.playlists[0]),this.master&&this.master.minimumUpdatePeriod&&(this.minimumUpdatePeriodTimeout_=om.a.setTimeout(function(){e.trigger("minimumUpdatePeriod")},this.master.minimumUpdatePeriod))}},{key:"refreshXml_",value:function(){var e=this;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,n){if(e.request){if(e.request=null,t)return e.error={status:n.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:n.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.masterXml_=n.responseText,e.sidxMapping_=function(t,n,i,r){var o=o_(e.masterXml_,{manifestUri:e.srcUrl,clientOffset:e.clientOffset_}),a=Qx(o.playlists,r);return wE(o,function(e,t,n,i){e.playlists&&e.playlists.length&&(a=Xx(a,Qx(e.playlists,r)))}),a}(0,0,0,e.sidxMapping_);var i=e.parseMasterXml(),r=Yx(e.master,i);if(r){var o=Kx(e.media().sidx);if(e.sidxMapping_[o])e.master=r;else{var a=e.media();e.request=qx(a.sidx,a,e.hls_.xhr,{handleManifestRedirects:e.handleManifestRedirects},e.sidxRequestFinished_(a,i,e.state,function(t,n){if(!t||!n)throw new Error("failed to request sidx on minimumUpdatePeriod");e.sidxMapping_[o].sidx=n,e.minimumUpdatePeriodTimeout_=om.a.setTimeout(function(){e.trigger("minimumUpdatePeriod")},e.master.minimumUpdatePeriod),e.refreshMedia_(e.media().uri)}))}}e.minimumUpdatePeriodTimeout_=om.a.setTimeout(function(){e.trigger("minimumUpdatePeriod")},e.master.minimumUpdatePeriod)}})}},{key:"refreshMedia_",value:function(e){var t=this;if(!e)throw new Error("refreshMedia_ must take a media uri");var n=void 0,i=void 0;this.masterPlaylistLoader_?(n=this.masterPlaylistLoader_.master,i=this.masterPlaylistLoader_.parseMasterXml()):(n=this.master,i=this.parseMasterXml());var r=Yx(n,i);r?(this.masterPlaylistLoader_?this.masterPlaylistLoader_.master=r:this.master=r,this.media_=r.playlists[e]):(this.media_=i.playlists[e],this.trigger("playlistunchanged")),this.media().endList||(this.mediaUpdateTimeout=om.a.setTimeout(function(){t.trigger("mediaupdatetimeout")},kE(this.media(),!!r))),this.trigger("loadedplaylist")}}]),t}(),Jx=function(e){return vE.log.debug?vE.log.debug.bind(vE,"VHS:",e+" >"):function(){}};function $x(){}var eC=function(){function e(t,n,i,r){xE(this,e),this.callbacks_=[],this.pendingCallback_=null,this.timestampOffset_=0,this.mediaSource=t,this.processedAppend_=!1,this.type_=i,this.mimeType_=n,this.logger_=Jx("SourceUpdater["+i+"]["+n+"]"),"closed"===t.readyState?t.addEventListener("sourceopen",this.createSourceBuffer_.bind(this,n,r)):this.createSourceBuffer_(n,r)}return CE(e,[{key:"createSourceBuffer_",value:function(e,t){var n=this;this.sourceBuffer_=this.mediaSource.addSourceBuffer(e),this.logger_("created SourceBuffer"),t&&(t.trigger("sourcebufferadded"),this.mediaSource.sourceBuffers.length<2)?t.on("sourcebufferadded",function(){n.start_()}):this.start_()}},{key:"start_",value:function(){var e=this;this.started_=!0,this.onUpdateendCallback_=function(){var t=e.pendingCallback_;e.pendingCallback_=null,e.sourceBuffer_.removing=!1,e.logger_("buffered ["+px(e.buffered())+"]"),t&&t(),e.runCallback_()},this.sourceBuffer_.addEventListener("updateend",this.onUpdateendCallback_),this.runCallback_()}},{key:"abort",value:function(e){var t=this;this.processedAppend_&&this.queueCallback_(function(){t.sourceBuffer_.abort()},e)}},{key:"appendBuffer",value:function(e,t){var n=this;this.processedAppend_=!0,this.queueCallback_(function(){e.videoSegmentTimingInfoCallback&&n.sourceBuffer_.addEventListener("videoSegmentTimingInfo",e.videoSegmentTimingInfoCallback),n.sourceBuffer_.appendBuffer(e.bytes)},function(){e.videoSegmentTimingInfoCallback&&n.sourceBuffer_.removeEventListener("videoSegmentTimingInfo",e.videoSegmentTimingInfoCallback),t()})}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:vE.createTimeRanges()}},{key:"remove",value:function(e,t){var n=this;this.processedAppend_&&this.queueCallback_(function(){n.logger_("remove ["+e+" => "+t+"]"),n.sourceBuffer_.removing=!0,n.sourceBuffer_.remove(e,t)},arguments.length>2&&void 0!==arguments[2]?arguments[2]:$x)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||!!this.pendingCallback_&&this.pendingCallback_!==$x}},{key:"timestampOffset",value:function(e){var t=this;return void 0!==e&&(this.queueCallback_(function(){t.sourceBuffer_.timestampOffset=e,t.runCallback_()}),this.timestampOffset_=e),this.timestampOffset_}},{key:"queueCallback_",value:function(e,t){this.callbacks_.push([e.bind(this),t]),this.runCallback_()}},{key:"runCallback_",value:function(){var e=void 0;!this.updating()&&this.callbacks_.length&&this.started_&&(e=this.callbacks_.shift(),this.pendingCallback_=e[1],e[0]())}},{key:"dispose",value:function(){var e=this,t=function t(){e.sourceBuffer_&&"open"===e.mediaSource.readyState&&e.sourceBuffer_.abort(),e.sourceBuffer_.removeEventListener("updateend",t)};this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_),this.sourceBuffer_.removing?this.sourceBuffer_.addEventListener("updateend",t):t()}}]),e}(),tC={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},nC=function(e){e.forEach(function(e){e.abort()})},iC=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:-101,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:-102,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:2,xhr:t}:null},rC=function(e,t){var n;return e&&(n=om.a.getComputedStyle(e))?n[t]:""},oC=function(e,t){var n=e.slice();e.sort(function(e,i){var r=t(e,i);return 0===r?n.indexOf(e)-n.indexOf(i):r})},aC=function(e,t){var n=void 0,i=void 0;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),(n=n||om.a.Number.MAX_VALUE)-(i||om.a.Number.MAX_VALUE)},sC=function(e){return"number"==typeof e&&isFinite(e)},lC=function(e){function t(e){xE(this,t);var n=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");return n.bandwidth=e.bandwidth,n.throughput={rate:0,count:0},n.roundTrip=NaN,n.resetStats_(),n.mediaIndex=null,n.hasPlayed_=e.hasPlayed,n.currentTime_=e.currentTime,n.seekable_=e.seekable,n.seeking_=e.seeking,n.duration_=e.duration,n.mediaSource_=e.mediaSource,n.hls_=e.hls,n.loaderType_=e.loaderType,n.startingMedia_=void 0,n.segmentMetadataTrack_=e.segmentMetadataTrack,n.goalBufferLength_=e.goalBufferLength,n.sourceType_=e.sourceType,n.inbandTextTracks_=e.inbandTextTracks,n.state_="INIT",n.checkBufferTimeout_=null,n.error_=void 0,n.currentTimeline_=-1,n.pendingSegment_=null,n.mimeType_=null,n.sourceUpdater_=null,n.xhrOptions_=null,n.activeInitSegmentId_=null,n.initSegments_={},n.cacheEncryptionKeys_=e.cacheEncryptionKeys,n.keyCache_={},n.captionParser_="main"===n.loaderType_?new u_.CaptionParser:null,n.decrypter_=e.decrypter,n.syncController_=e.syncController,n.syncPoint_={segmentIndex:0,time:0},n.syncController_.on("syncinfoupdate",function(){return n.trigger("syncinfoupdate")}),n.mediaSource_.addEventListener("sourceopen",function(){return n.ended_=!1}),n.fetchAtBuffer_=!1,n.logger_=Jx("SegmentLoader["+n.loaderType_+"]"),Object.defineProperty(n,"state",{get:function(){return this.state_},set:function(e){e!==this.state_&&(this.logger_(this.state_+" -> "+e),this.state_=e)}}),n}return SE(t,vE.EventTarget),CE(t,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.state="DISPOSED",this.pause(),this.abort_(),this.sourceUpdater_&&this.sourceUpdater_.dispose(),this.resetStats_(),this.captionParser_&&this.captionParser_.reset()}},{key:"abort",value:function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null}},{key:"error",value:function(e){return void 0!==e&&(this.error_=e),this.pendingSegment_=null,this.error_}},{key:"endOfStream",value:function(){this.ended_=!0,this.pause(),this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():vE.createTimeRanges()}},{key:"initSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var n=sx(e),i=this.initSegments_[n];return t&&!i&&e.bytes&&(this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,timescales:e.timescales,videoTrackIds:e.videoTrackIds}),i||e}},{key:"segmentKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var n=lx(e),i=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!i&&e.bytes&&(this.keyCache_[n]=i={resolvedUri:e.resolvedUri,bytes:e.bytes});var r={resolvedUri:(i||e).resolvedUri};return i&&(r.bytes=i.bytes),r}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){if(this.monitorBuffer_(),this.playlist_){if(this.syncController_.setDateTimeMapping(this.playlist_),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}}},{key:"init_",value:function(){return this.state="READY",this.sourceUpdater_=new eC(this.mediaSource_,this.mimeType_,this.loaderType_,this.sourceBufferEmitter_),this.resetEverything(),this.monitorBuffer_()}},{key:"playlist",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=this.playlist_,i=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.hasPlayed_()||(e.syncInfo={mediaSequence:e.mediaSequence,time:0});var r=null;if(n&&(n.id?r=n.id:n.uri&&(r=n.uri)),this.logger_("playlist update ["+r+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(n&&n.uri===e.uri){var o=e.mediaSequence-n.mediaSequence;this.logger_("live window shift ["+o+"]"),null!==this.mediaIndex&&(this.mediaIndex-=o),i&&(i.mediaIndex-=o,i.mediaIndex>=0&&(i.segment=e.segments[i.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(n,e)}else null!==this.mediaIndex&&this.resyncLoader()}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(om.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(e,t){this.mimeType_||(this.mimeType_=e,this.sourceBufferEmitter_=t,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(e){this.ended_=!1,this.resetLoader(),this.remove(0,this.duration_(),e),this.captionParser_&&this.captionParser_.clearAllCaptions(),this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1,this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null,this.syncPoint_=null,this.abort()}},{key:"remove",value:function(e,t,n){if(this.sourceUpdater_&&this.sourceUpdater_.remove(e,t,n),mx(e,t,this.segmentMetadataTrack_),this.inbandTextTracks_)for(var i in this.inbandTextTracks_)mx(e,t,this.inbandTextTracks_[i])}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&om.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=om.a.setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&om.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=om.a.setTimeout(this.monitorBufferTick_.bind(this),500)}},{key:"fillBuffer_",value:function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);e&&(this.isEndOfStream_(e.mediaIndex)?this.endOfStream():(e.mediaIndex!==this.playlist_.segments.length-1||"ended"!==this.mediaSource_.readyState||this.seeking_())&&(e.timeline!==this.currentTimeline_&&(this.syncController_.reset(),e.timestampOffset=e.startOfSegment,this.captionParser_&&this.captionParser_.clearAllCaptions()),this.loadSegment_(e)))}}},{key:"isEndOfStream_",value:function(e){return function(t,n,i){return!(!t||!n)&&t.endList&&"open"===n.readyState&&e===t.segments.length}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.playlist_,this.mediaSource_)&&!this.sourceUpdater_.updating()}},{key:"checkBuffer_",value:function(e,t,n,i,r,o){var a=0,s=void 0;e.length&&(a=e.end(e.length-1));var l=Math.max(0,a-r);if(!t.segments.length)return null;if(l>=this.goalBufferLength_())return null;if(!i&&l>=1)return null;if(null===o)return n=this.getSyncSegmentCandidate_(t),this.generateSegmentInfo_(t,n,null,!0);if(null!==n){var c=t.segments[n];return this.generateSegmentInfo_(t,n+1,s=c&&c.end?c.end:a,!1)}if(this.fetchAtBuffer_){var u=JE.getMediaInfoForTime(t,a,o.segmentIndex,o.time);n=u.mediaIndex,s=u.startTime}else{var h=JE.getMediaInfoForTime(t,r,o.segmentIndex,o.time);n=h.mediaIndex,s=h.startTime}return this.generateSegmentInfo_(t,n,s,!1)}},{key:"getSyncSegmentCandidate_",value:function(e){var t=this;if(-1===this.currentTimeline_)return 0;var n=e.segments.map(function(e,t){return{timeline:e.timeline,segmentIndex:t}}).filter(function(e){return e.timeline===t.currentTimeline_});return n.length?n[Math.min(n.length-1,1)].segmentIndex:Math.max(e.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(e,t,n,i){if(t<0||t>=e.segments.length)return null;var r=e.segments[t];return{requestId:"segment-loader-"+Math.random(),uri:r.resolvedUri,mediaIndex:t,isSyncRequest:i,startOfSegment:n,playlist:e,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:r.timeline,duration:r.duration,segment:r}}},{key:"abortRequestEarly_",value:function(e){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return!1;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return!1;var t=this.currentTime_(),n=e.bandwidth,i=this.pendingSegment_.duration,r=JE.estimateSegmentRequestTime(i,n,this.playlist_,e.bytesReceived),o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return((e.length?e.end(e.length-1):0)-t)/n}(this.buffered_(),t,this.hls_.tech_.playbackRate())-1;if(r<=o)return!1;var a=function(e){var t=e.currentTime,n=e.bandwidth,i=e.duration,r=e.segmentDuration,o=e.timeUntilRebuffer,a=e.currentTimeline,s=e.syncController,l=e.master.playlists.filter(function(e){return!JE.isIncompatible(e)}),c=l.filter(JE.isEnabled);c.length||(c=l.filter(function(e){return!JE.isDisabled(e)}));var u=c.filter(JE.hasAttribute.bind(null,"BANDWIDTH")).map(function(e){var l=s.getSyncPoint(e,i,a,t)?1:2;return{playlist:e,rebufferingImpact:JE.estimateSegmentRequestTime(r,n,e)*l-o}}),h=u.filter(function(e){return e.rebufferingImpact<=0});return oC(h,function(e,t){return aC(t.playlist,e.playlist)}),h.length?h[0]:(oC(u,function(e,t){return e.rebufferingImpact-t.rebufferingImpact}),u[0]||null)}({master:this.hls_.playlists.master,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:i,timeUntilRebuffer:o,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(a){var s=.5;return o<=1/30&&(s=1),!(!a.playlist||a.playlist.uri===this.playlist_.uri||r-o-a.rebufferingImpact<s||(this.bandwidth=a.playlist.attributes.BANDWIDTH*tC.BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),0))}}},{key:"handleProgress_",value:function(e,t){this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId&&!this.abortRequestEarly_(t.stats)&&this.trigger("progress")}},{key:"loadSegment_",value:function(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),e.abortRequests=function(e,t,n,i,r,o,a){var s=[],l=function(e,t,n){var i=0,r=!1;return function(o,a){if(!r)return o?(r=!0,nC(e),n(o,a)):(i+=1)===e.length?(a.endOfAllRequests=Date.now(),a.encryptedBytes?function(e,t,n){var i;e.addEventListener("message",function i(r){if(r.data.source===t.requestId){e.removeEventListener("message",i);var o=r.data.decrypted;return t.bytes=new Uint8Array(o.bytes,o.byteOffset,o.byteLength),n(null,t)}}),i=t.key.bytes.slice?t.key.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.key.bytes)),e.postMessage(ax({source:t.requestId,encrypted:t.encryptedBytes,key:i,iv:t.key.iv}),[t.encryptedBytes.buffer,i.buffer])}(t,a,n):n(null,a)):void 0}}(s,n,a);if(r.key&&!r.key.bytes){var c=e(vE.mergeOptions(t,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),function(e,t){return function(n,i){var r=i.response,o=iC(n,i);if(o)return t(o,e);if(16!==r.byteLength)return t({status:i.status,message:"Invalid HLS key at URL: "+i.uri,code:2,xhr:i},e);var a=new DataView(r);return e.key.bytes=new Uint32Array([a.getUint32(0),a.getUint32(4),a.getUint32(8),a.getUint32(12)]),t(null,e)}}(r,l));s.push(c)}if(r.map&&!r.map.bytes){var u=e(vE.mergeOptions(t,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:nx(r.map)}),function(e,t,n){return function(i,r){var o=r.response,a=iC(i,r);return a?n(a,e):0===o.byteLength?n({status:r.status,message:"Empty HLS segment content at URL: "+r.uri,code:2,xhr:r},e):(e.map.bytes=new Uint8Array(r.response),t&&!t.isInitialized()&&t.init(),e.map.timescales=c_.a.timescale(e.map.bytes),e.map.videoTrackIds=c_.a.videoTrackIds(e.map.bytes),n(null,e))}}(r,i,l));s.push(u)}var h=e(vE.mergeOptions(t,{uri:r.resolvedUri,responseType:"arraybuffer",headers:nx(r)}),function(e,t,n){return function(i,r){var o=r.response,a=iC(i,r),s=void 0;return a?n(a,e):0===o.byteLength?n({status:r.status,message:"Empty HLS segment content at URL: "+r.uri,code:2,xhr:r},e):(e.stats=function(e){return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}}(r),e.key?e.encryptedBytes=new Uint8Array(r.response):e.bytes=new Uint8Array(r.response),t&&e.map&&e.map.bytes&&(t.isInitialized()||t.init(),(s=t.parse(e.bytes,e.map.videoTrackIds,e.map.timescales))&&s.captions&&(e.captionStreams=s.captionStreams,e.fmp4Captions=s.captions)),n(null,e))}}(r,i,l));return h.addEventListener("progress",function(e,t){return function(n){var i,r,o;return e.stats=vE.mergeOptions(e.stats,(r=(i=n).target,(o={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-r.requestTime||0}).bytesReceived=i.loaded,o.bandwidth=Math.floor(o.bytesReceived/o.roundTripTime*8*1e3),o)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)}}(r,o)),s.push(h),function(){return nC(s)}}(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.captionParser_,this.createSimplifiedSegmentObj_(e),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(e){var t=function(e,t,n){var i;return i=e.length&&e.start(0)>0&&e.start(0)<t?e.start(0):t-30,Math.min(i,t-n)}(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}},{key:"createSimplifiedSegmentObj_",value:function(e){var t=e.segment,n={resolvedUri:t.resolvedUri,byterange:t.byterange,requestId:e.requestId};if(t.key){var i=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);n.key=this.segmentKey(t.key),n.key.iv=i}return t.map&&(n.map=this.initSegment(t.map)),n}},{key:"segmentRequestFinished_",value:function(e,t){if(this.mediaRequests+=1,t.stats&&(this.mediaBytesTransferred+=t.stats.bytesReceived,this.mediaTransferDuration+=t.stats.roundTripTime),this.pendingSegment_){if(t.requestId===this.pendingSegment_.requestId){if(e)return this.pendingSegment_=null,this.state="READY",-102===e.code?void(this.mediaRequestsAborted+=1):(this.pause(),-101===e.code?(this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,void this.trigger("bandwidthupdate")):(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error")));this.bandwidth=t.stats.bandwidth,this.roundTrip=t.stats.roundTripTime,t.map&&(t.map=this.initSegment(t.map,!0)),t.key&&this.segmentKey(t.key,!0),this.processSegmentResponse_(t)}}else this.mediaRequestsAborted+=1}},{key:"processSegmentResponse_",value:function(e){var t=this.pendingSegment_;t.bytes=e.bytes,e.map&&(t.segment.map.bytes=e.map.bytes),t.endOfAllRequests=e.endOfAllRequests,e.fmp4Captions&&(function(e,t,n){for(var i in n)if(!e[i]){t.trigger({type:"usage",name:"hls-608"});var r=t.textTracks().getTrackById(i);e[i]=r||t.addRemoteTextTrack({kind:"captions",id:i,label:i},!1).track}}(this.inbandTextTracks_,this.hls_.tech_,e.captionStreams),function(e){var t=e.inbandTextTracks,n=e.captionArray,i=e.timestampOffset;if(n){var r=window.WebKitDataCue||window.VTTCue;n.forEach(function(e){var n=e.stream,o=e.startTime,a=e.endTime;t[n]&&t[n].addCue(new r(o+=i,a+=i,e.text))})}}({inbandTextTracks:this.inbandTextTracks_,captionArray:e.fmp4Captions,timestampOffset:0}),this.captionParser_&&this.captionParser_.clearParsedCaptions()),this.handleSegment_()}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_){var t=this.pendingSegment_,n=t.segment,i=this.syncController_.probeSegmentInfo(t);void 0===this.startingMedia_&&i&&(i.containsAudio||i.containsVideo)&&(this.startingMedia_={containsAudio:i.containsAudio,containsVideo:i.containsVideo});var r,o,a=(r=this.startingMedia_,o=i,"main"===this.loaderType_&&r&&o?o.containsAudio||o.containsVideo?r.containsVideo&&!o.containsVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!r.containsVideo&&o.containsVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null);if(a)return this.error({message:a,blacklistDuration:1/0}),void this.trigger("error");if(t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");null!==t.timestampOffset&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()&&(this.sourceUpdater_.timestampOffset(t.timestampOffset),this.trigger("timestampoffset"));var s=this.syncController_.mappingForTimeline(t.timeline);if(null!==s&&this.trigger({type:"segmenttimemapping",mapping:s}),this.state="APPENDING",n.map){var l=sx(n.map);if(!this.activeInitSegmentId_||this.activeInitSegmentId_!==l){var c=this.initSegment(n.map);this.sourceUpdater_.appendBuffer({bytes:c.bytes},function(){e.activeInitSegmentId_=l})}}t.byteLength=t.bytes.byteLength,this.mediaSecondsLoaded+="number"==typeof n.start&&"number"==typeof n.end?n.end-n.start:n.duration,this.logger_(function(e){var t=e.segment,n=e.playlist,i=n.mediaSequence,r=n.segments;return["appending ["+e.mediaIndex+"] of ["+i+", "+(i+(void 0===r?[]:r).length)+"] from playlist ["+n.id+"]","["+t.start+" => "+t.end+"] in timeline ["+e.timeline+"]"].join(" ")}(t)),this.sourceUpdater_.appendBuffer({bytes:t.bytes,videoSegmentTimingInfoCallback:this.handleVideoSegmentTimingInfo_.bind(this,t.requestId)},this.handleUpdateEnd_.bind(this))}else this.state="READY"}},{key:"handleVideoSegmentTimingInfo_",value:function(e,t){if(this.pendingSegment_&&e===this.pendingSegment_.requestId){var n=this.pendingSegment_.segment;n.videoTimingInfo||(n.videoTimingInfo={}),n.videoTimingInfo.transmuxerPrependedSeconds=t.videoSegmentTimingInfo.prependedContentDuration||0,n.videoTimingInfo.transmuxedPresentationStart=t.videoSegmentTimingInfo.start.presentation,n.videoTimingInfo.transmuxedPresentationEnd=t.videoSegmentTimingInfo.end.presentation,n.videoTimingInfo.baseMediaDecodeTime=t.videoSegmentTimingInfo.baseMediaDecodeTime}}},{key:"handleUpdateEnd_",value:function(){if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_,t=e.segment,n=null!==this.mediaIndex;this.pendingSegment_=null,this.recordThroughput_(e),this.addSegmentMetadataCue_(e),this.state="READY",this.mediaIndex=e.mediaIndex,this.fetchAtBuffer_=!0,this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate"),t.end&&this.currentTime_()-t.end>3*e.playlist.targetDuration?this.resetEverything():(n&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.isEndOfStream_(e.mediaIndex+1,e.playlist)&&this.endOfStream(),this.paused()||this.monitorBuffer_())}},{key:"recordThroughput_",value:function(e){var t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,i=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(i-t)/++this.throughput.count}},{key:"addSegmentMetadataCue_",value:function(e){if(this.segmentMetadataTrack_){var t=e.segment,n=t.start,i=t.end;if(sC(n)&&sC(i)){mx(n,i,this.segmentMetadataTrack_);var r={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.uri,start:n,end:i},o=new(om.a.WebKitDataCue||om.a.VTTCue)(n,i,JSON.stringify(r));o.value=r,this.segmentMetadataTrack_.addCue(o)}}}}]),t}(),cC=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))},uC=new Uint8Array("\n\n".split("").map(function(e){return e.charCodeAt(0)})),hC=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xE(this,t);var i=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.mediaSource_=null,i.subtitlesTrack_=null,i}return SE(t,lC),CE(t,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return vE.createTimeRanges();var e=this.subtitlesTrack_.cues;return vE.createTimeRanges([[e[0].startTime,e[e.length-1].startTime]])}},{key:"initSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var n=sx(e),i=this.initSegments_[n];if(t&&!i&&e.bytes){var r=new Uint8Array(uC.byteLength+e.bytes.byteLength);r.set(e.bytes),r.set(uC,e.bytes.byteLength),this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return i||e}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}},{key:"track",value:function(e){return void 0===e?this.subtitlesTrack_:(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}},{key:"remove",value:function(e,t){mx(e,t,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var e=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var t=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(t=this.skipEmptySegments_(t)){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline))return this.syncController_.one("timestampoffset",function(){e.state="READY",e.paused()||e.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE");this.loadSegment_(t)}}},{key:"skipEmptySegments_",value:function(e){for(;e&&e.segment.empty;)e=this.generateSegmentInfo_(e.playlist,e.mediaIndex+1,e.startOfSegment+e.duration,e.isSyncRequest);return e}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_&&this.subtitlesTrack_){this.state="APPENDING";var t=this.pendingSegment_,n=t.segment;if("function"!=typeof om.a.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var i=void 0,r=function(){e.subtitlesTrack_.tech_.off("vttjsloaded",i),e.error({message:"Error loading vtt.js"}),e.state="READY",e.pause(),e.trigger("error")};return i=function(){e.subtitlesTrack_.tech_.off("vttjserror",r),e.handleSegment_()},this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",i),void this.subtitlesTrack_.tech_.one("vttjserror",r)}n.requested=!0;try{this.parseVTTCues_(t)}catch(nS){return this.error({message:nS.message}),this.state="READY",this.pause(),this.trigger("error")}if(this.updateTimeMapping_(t,this.syncController_.timelines[t.timeline],this.playlist_),t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");t.byteLength=t.bytes.byteLength,this.mediaSecondsLoaded+=n.duration,t.cues.length&&this.remove(t.cues[0].endTime,t.cues[t.cues.length-1].endTime),t.cues.forEach(function(t){e.subtitlesTrack_.addCue(t)}),this.handleUpdateEnd_()}else this.state="READY"}},{key:"parseVTTCues_",value:function(e){var t=void 0,n=!1;"function"==typeof om.a.TextDecoder?t=new om.a.TextDecoder("utf8"):(t=om.a.WebVTT.StringDecoder(),n=!0);var i=new om.a.WebVTT.Parser(om.a,om.a.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},i.oncue=e.cues.push.bind(e.cues),i.ontimestampmap=function(t){return e.timestampmap=t},i.onparsingerror=function(e){vE.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){var r=e.segment.map.bytes;n&&(r=cC(r)),i.parse(r)}var o=e.bytes;n&&(o=cC(o)),i.parse(o),i.flush()}},{key:"updateTimeMapping_",value:function(e,t,n){var i=e.segment;if(t)if(e.cues.length){var r=e.timestampmap,o=r.MPEGTS/9e4-r.LOCAL+t.mapping;e.cues.forEach(function(e){e.startTime+=o,e.endTime+=o}),n.syncInfo||(n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(e.cues[0].startTime,e.cues[e.cues.length-1].startTime-i.duration)})}else i.empty=!0}}]),t}(),dC=function(e,t){for(var n=e.cues,i=0;i<n.length;i++){var r=n[i];if(t>=r.adStartTime&&t<=r.adEndTime)return r}return null},fC=d_.a.inspect,pC=[{name:"VOD",run:function(e,t,n,i,r){return n!==1/0?{time:0,segmentIndex:0}:null}},{name:"ProgramDateTime",run:function(e,t,n,i,r){if(!e.datetimeToDisplayTime)return null;var o=t.segments||[],a=null,s=null;r=r||0;for(var l=0;l<o.length;l++){var c=o[l];if(c.dateTimeObject){var u=c.dateTimeObject.getTime()/1e3+e.datetimeToDisplayTime,h=Math.abs(r-u);if(null!==s&&(0===h||s<h))break;s=h,a={time:u,segmentIndex:l}}}return a}},{name:"Segment",run:function(e,t,n,i,r){var o=t.segments||[],a=null,s=null;r=r||0;for(var l=0;l<o.length;l++){var c=o[l];if(c.timeline===i&&void 0!==c.start){var u=Math.abs(r-c.start);if(null!==s&&s<u)break;(!a||null===s||s>=u)&&(s=u,a={time:c.start,segmentIndex:l})}}return a}},{name:"Discontinuity",run:function(e,t,n,i,r){var o=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var a=null,s=0;s<t.discontinuityStarts.length;s++){var l=t.discontinuityStarts[s],c=e.discontinuities[t.discontinuitySequence+s+1];if(c){var u=Math.abs(r-c.time);if(null!==a&&a<u)break;(!o||null===a||a>=u)&&(a=u,o={time:c.time,segmentIndex:l})}}return o}},{name:"Playlist",run:function(e,t,n,i,r){return t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence}:null}}],gC=function(e){function t(){xE(this,t);var e=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.inspectCache_=void 0,e.timelines=[],e.discontinuities=[],e.datetimeToDisplayTime=null,e.logger_=Jx("SyncController"),e}return SE(t,vE.EventTarget),CE(t,[{key:"getSyncPoint",value:function(e,t,n,i){var r=this.runStrategies_(e,t,n,i);return r.length?this.selectSyncPoint_(r,{key:"time",value:i}):null}},{key:"getExpiredTime",value:function(e,t){if(!e||!e.segments)return null;var n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;var i=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return i.segmentIndex>0&&(i.time*=-1),Math.abs(i.time+VE(e,i.segmentIndex,0))}},{key:"runStrategies_",value:function(e,t,n,i){for(var r=[],o=0;o<pC.length;o++){var a=pC[o],s=a.run(this,e,t,n,i);s&&(s.strategy=a.name,r.push({strategy:a.name,syncPoint:s}))}return r}},{key:"selectSyncPoint_",value:function(e,t){for(var n=e[0].syncPoint,i=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy,o=1;o<e.length;o++){var a=Math.abs(e[o].syncPoint[t.key]-t.value);a<i&&(i=a,n=e[o].syncPoint,r=e[o].strategy)}return this.logger_("syncPoint for ["+t.key+": "+t.value+"] chosen with strategy ["+r+"]: [time:"+n.time+", segmentIndex:"+n.segmentIndex+"]"),n}},{key:"saveExpiredSegmentInfo",value:function(e,t){for(var n=t.mediaSequence-e.mediaSequence-1;n>=0;n--){var i=e.segments[n];if(i&&void 0!==i.start){t.syncInfo={mediaSequence:e.mediaSequence+n,time:i.start},this.logger_("playlist refresh sync: [time:"+t.syncInfo.time+", mediaSequence: "+t.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function(e){if(!this.datetimeToDisplayTime&&e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var t=e.segments[0].dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(e){var t,n=e.segment,i=e.playlist;return(t=n.map?this.probeMp4Segment_(e):this.probeTsSegment_(e))&&this.calculateSegmentTimeMapping_(e,t)&&(this.saveDiscontinuitySyncInfo_(e),i.syncInfo||(i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:n.start})),t}},{key:"probeMp4Segment_",value:function(e){var t=e.segment,n=c_.a.timescale(t.map.bytes),i=c_.a.startTime(n,e.bytes);return null!==e.timestampOffset&&(e.timestampOffset-=i),{start:i,end:i+t.duration}}},{key:"probeTsSegment_",value:function(e){var t=fC(e.bytes,this.inspectCache_),n=void 0,i=void 0;return t?(t.video&&2===t.video.length?(this.inspectCache_=t.video[1].dts,n=t.video[0].dtsTime,i=t.video[1].dtsTime):t.audio&&2===t.audio.length&&(this.inspectCache_=t.audio[1].dts,n=t.audio[0].dtsTime,i=t.audio[1].dtsTime),{start:n,end:i,containsVideo:t.video&&2===t.video.length,containsAudio:t.audio&&2===t.audio.length}):null}},{key:"timestampOffsetForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].time}},{key:"mappingForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}},{key:"calculateSegmentTimeMapping_",value:function(e,t){var n=e.segment,i=this.timelines[e.timeline];if(null!==e.timestampOffset)this.timelines[e.timeline]=i={time:e.startOfSegment,mapping:e.startOfSegment-t.start},this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": [time: "+i.time+"] [mapping: "+i.mapping+"]"),n.start=e.startOfSegment,n.end=t.end+i.mapping;else{if(!i)return!1;n.start=t.start+i.mapping,n.end=t.end+i.mapping}return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(e){var t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(var i=0;i<t.discontinuityStarts.length;i++){var r,o=t.discontinuityStarts[i],a=t.discontinuitySequence+i+1,s=o-e.mediaIndex,l=Math.abs(s);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>l)r=s<0?n.start-VE(t,e.mediaIndex,o):n.end+VE(t,e.mediaIndex+1,o),this.discontinuities[a]={time:r,accuracy:l}}}}]),t}(),mC=new Cx("./decrypter-worker.worker.js",function(e,t){var n,i,r,o,a,s,l,c,u,h;n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],i=t[4],r=n[4],o=void 0,a=void 0,s=void 0,l=[],c=[],u=void 0,h=void 0,d=void 0,f=void 0,p=void 0;for(o=0;o<256;o++)c[(l[o]=o<<1^283*(o>>7))^o]=o;for(a=s=0;!i[a];a^=u||1,s=c[s]||1)for(i[a]=d=(d=s^s<<1^s<<2^s<<3^s<<4)>>8^255&d^99,r[d]=a,p=16843009*l[h=l[u=l[a]]]^65537*h^257*u^16843008*a,f=257*l[d]^16843008*d,o=0;o<4;o++)t[o][a]=f=f<<24^f>>>8,n[o][d]=p=p<<24^p>>>8;for(o=0;o<5;o++)t[o]=t[o].slice(0),n[o]=n[o].slice(0);return e},a=null,s=function(){function e(t){n(this,e),a||(a=o()),this._tables=[[a[0][0].slice(),a[0][1].slice(),a[0][2].slice(),a[0][3].slice(),a[0][4].slice()],[a[1][0].slice(),a[1][1].slice(),a[1][2].slice(),a[1][3].slice(),a[1][4].slice()]];var i=void 0,r=void 0,s=void 0,l=void 0,c=void 0,u=this._tables[0][4],h=this._tables[1],d=t.length,f=1;if(4!==d&&6!==d&&8!==d)throw new Error("Invalid aes key size");for(l=t.slice(0),this._key=[l,c=[]],i=d;i<4*d+28;i++)s=l[i-1],(i%d==0||8===d&&i%d==4)&&(s=u[s>>>24]<<24^u[s>>16&255]<<16^u[s>>8&255]<<8^u[255&s],i%d==0&&(s=s<<8^s>>>24^f<<24,f=f<<1^283*(f>>7))),l[i]=l[i-d]^s;for(r=0;i;r++,i--)s=l[3&r?i:i-4],c[r]=i<=4||r<4?s:h[0][u[s>>>24]]^h[1][u[s>>16&255]]^h[2][u[s>>8&255]]^h[3][u[255&s]]}return e.prototype.decrypt=function(e,t,n,i,r,o){var a=this._key[1],s=e^a[0],l=i^a[1],c=n^a[2],u=t^a[3],h=void 0,d=void 0,f=void 0,p=a.length/4-2,g=void 0,m=4,_=this._tables[1],v=_[0],b=_[1],y=_[2],T=_[3],E=_[4];for(g=0;g<p;g++)h=v[s>>>24]^b[l>>16&255]^y[c>>8&255]^T[255&u]^a[m],d=v[l>>>24]^b[c>>16&255]^y[u>>8&255]^T[255&s]^a[m+1],f=v[c>>>24]^b[u>>16&255]^y[s>>8&255]^T[255&l]^a[m+2],u=v[u>>>24]^b[s>>16&255]^y[l>>8&255]^T[255&c]^a[m+3],m+=4,s=h,l=d,c=f;for(g=0;g<4;g++)r[(3&-g)+o]=E[s>>>24]<<24^E[l>>16&255]<<16^E[c>>8&255]<<8^E[255&u]^a[m++],h=s,s=l,l=c,c=u,u=h},e}(),l=function(){function e(){n(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1},e.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),o=t.length,a=0;a<o;++a)t[a].apply(this,r)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),c=function(e){function t(){n(this,t);var i=r(this,e.call(this,l));return i.jobs=[],i.delay=1,i.timeout_=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},t.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(l),u=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},h=function(){function e(t,i,r,o){n(this,e);var a=e.STEP,s=new Int32Array(t.buffer),l=new Uint8Array(t.byteLength),h=0;for(this.asyncStream_=new c,this.asyncStream_.push(this.decryptChunk_(s.subarray(h,h+a),i,r,l)),h=a;h<s.length;h+=a)r=new Uint32Array([u(s[h-4]),u(s[h-3]),u(s[h-2]),u(s[h-1])]),this.asyncStream_.push(this.decryptChunk_(s.subarray(h,h+a),i,r,l));this.asyncStream_.push(function(){var e;o(null,(e=l).subarray(0,e.byteLength-e[e.byteLength-1]))})}return e.prototype.decryptChunk_=function(e,t,n,i){return function(){var r=function(e,t,n){var i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),r=new s(Array.prototype.slice.call(t)),o=new Uint8Array(e.byteLength),a=new Int32Array(o.buffer),l=void 0,c=void 0,h=void 0,d=void 0,f=void 0,p=void 0,g=void 0,m=void 0,_=void 0;for(l=n[0],c=n[1],h=n[2],d=n[3],_=0;_<i.length;_+=4)f=u(i[_]),p=u(i[_+1]),g=u(i[_+2]),m=u(i[_+3]),r.decrypt(f,p,g,m,a,_),a[_]=u(a[_]^l),a[_+1]=u(a[_+1]^c),a[_+2]=u(a[_+2]^h),a[_+3]=u(a[_+3]^d),l=f,c=p,h=g,d=m;return o}(e,t,n);i.set(r,e.byteOffset)}},i(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}(),new function(e){e.onmessage=function(t){var n=t.data,i=new Uint8Array(n.encrypted.bytes,n.encrypted.byteOffset,n.encrypted.byteLength),r=new Uint32Array(n.key.bytes,n.key.byteOffset,n.key.byteLength/4),o=new Uint32Array(n.iv.bytes,n.iv.byteOffset,n.iv.byteLength/4);new h(i,r,o,function(t,i){var r,o;e.postMessage((r={source:n.source,decrypted:i},o={},Object.keys(r).forEach(function(e){var t=r[e];o[e]=ArrayBuffer.isView(t)?{bytes:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}:t}),o),[i.buffer])})}}(this)}),_C=function(e){var t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},vC=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},bC=function(e,t){t.activePlaylistLoader=e,e.load()},yC={AUDIO:function(e,t){return function(){var n=t.mediaTypes[e],i=t.blacklistCurrentPlaylist;vC(t.segmentLoaders[e],n);var r=n.activeTrack(),o=n.activeGroup(),a=(o.filter(function(e){return e.default})[0]||o[0]).id,s=n.tracks[a];if(r!==s){for(var l in vE.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),n.tracks)n.tracks[l].enabled=n.tracks[l]===s;n.onTrackChanged()}else i({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(e,t){return function(){var n=t.segmentLoaders[e],i=t.mediaTypes[e];vE.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),vC(n,i);var r=i.activeTrack();r&&(r.mode="disabled"),i.onTrackChanged()}}},TC={AUDIO:function(e,t,n){if(t){var i=n.tech,r=n.requestOptions,o=n.segmentLoaders[e];t.on("loadedmetadata",function(){var e=t.media();o.playlist(e,r),(!i.paused()||e.endList&&"none"!==i.preload())&&o.load()}),t.on("loadedplaylist",function(){o.playlist(t.media(),r),i.paused()||o.load()}),t.on("error",yC[e](e,n))}},SUBTITLES:function(e,t,n){var i=n.tech,r=n.requestOptions,o=n.segmentLoaders[e],a=n.mediaTypes[e];t.on("loadedmetadata",function(){var e=t.media();o.playlist(e,r),o.track(a.activeTrack()),(!i.paused()||e.endList&&"none"!==i.preload())&&o.load()}),t.on("loadedplaylist",function(){o.playlist(t.media(),r),i.paused()||o.load()}),t.on("error",yC[e](e,n))}},EC={AUDIO:function(e,t){var n=t.hls,i=t.sourceType,r=t.segmentLoaders[e],o=t.requestOptions,a=t.master.mediaGroups,s=t.mediaTypes[e],l=s.groups,c=s.tracks,u=t.masterPlaylistLoader;for(var h in a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}}),a[e])for(var d in l[h]||(l[h]=[]),a[e][h]){var f,p=a[e][h][d];if(f=p.resolvedUri?new NE(p.resolvedUri,n,o):p.playlists&&"dash"===i?new Zx(p.playlists[0],n,o,u):null,p=vE.mergeOptions({id:d,playlistLoader:f},p),TC[e](e,p.playlistLoader,t),l[h].push(p),void 0===c[d]){var g=new vE.AudioTrack({id:d,kind:_C(p),enabled:!1,language:p.language,default:p.default,label:d});c[d]=g}}r.on("error",yC[e](e,t))},SUBTITLES:function(e,t){var n=t.tech,i=t.hls,r=t.sourceType,o=t.segmentLoaders[e],a=t.requestOptions,s=t.master.mediaGroups,l=t.mediaTypes[e],c=l.groups,u=l.tracks,h=t.masterPlaylistLoader;for(var d in s[e])for(var f in c[d]||(c[d]=[]),s[e][d])if(!s[e][d][f].forced){var p=s[e][d][f],g=void 0;if("hls"===r?g=new NE(p.resolvedUri,i,a):"dash"===r&&(g=new Zx(p.playlists[0],i,a,h)),p=vE.mergeOptions({id:f,playlistLoader:g},p),TC[e](e,p.playlistLoader,t),c[d].push(p),void 0===u[f]){var m=n.addRemoteTextTrack({id:f,kind:"subtitles",default:p.default&&p.autoselect,language:p.language,label:f},!1).track;u[f]=m}}o.on("error",yC[e](e,t))},"CLOSED-CAPTIONS":function(e,t){var n=t.tech,i=t.master.mediaGroups,r=t.mediaTypes[e],o=r.groups,a=r.tracks;for(var s in i[e])for(var l in o[s]||(o[s]=[]),i[e][s]){var c=i[e][s][l];if(c.instreamId.match(/CC\d/)&&(o[s].push(vE.mergeOptions({id:l},c)),void 0===a[l])){var u=n.addRemoteTextTrack({id:c.instreamId,kind:"captions",default:c.default&&c.autoselect,language:c.language,label:l},!1).track;a[l]=u}}}},xC={AUDIO:function(e,t){return function(){var n=t.mediaTypes[e].tracks;for(var i in n)if(n[i].enabled)return n[i];return null}},SUBTITLES:function(e,t){return function(){var n=t.mediaTypes[e].tracks;for(var i in n)if("showing"===n[i].mode)return n[i];return null}}},CC=function(){var e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:$x,activeTrack:$x,onGroupChanged:$x,onTrackChanged:$x}}),e},SC=void 0,AC=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],PC=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},RC=function(e){function t(e){xE(this,t);var n=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=e.url,r=e.handleManifestRedirects,o=e.withCredentials,a=e.tech,s=e.bandwidth,l=e.externHls,c=e.useCueTags,u=e.blacklistDuration,h=e.enableLowInitialPlaylist,d=e.sourceType,f=e.seekTo,p=e.cacheEncryptionKeys;if(!i)throw new Error("A non-empty playlist URL is required");SC=l,n.withCredentials=o,n.tech_=a,n.hls_=a.hls,n.seekTo_=f,n.sourceType_=d,n.useCueTags_=c,n.blacklistDuration=u,n.enableLowInitialPlaylist=h,n.useCueTags_&&(n.cueTagsTrack_=n.tech_.addTextTrack("metadata","ad-cues"),n.cueTagsTrack_.inBandMetadataTrackDispatchType=""),n.requestOptions_={withCredentials:o,handleManifestRedirects:r,timeout:null},n.mediaTypes_=CC(),n.mediaSource=new vE.MediaSource,n.mediaSource.addEventListener("sourceopen",n.handleSourceOpen_.bind(n)),n.seekable_=vE.createTimeRanges(),n.hasPlayed_=function(){return!1},n.syncController_=new gC(e),n.segmentMetadataTrack_=a.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,n.decrypter_=new mC,n.inbandTextTracks_={};var g={hls:n.hls_,mediaSource:n.mediaSource,currentTime:n.tech_.currentTime.bind(n.tech_),seekable:function(){return n.seekable()},seeking:function(){return n.tech_.seeking()},duration:function(){return n.mediaSource.duration},hasPlayed:function(){return n.hasPlayed_()},goalBufferLength:function(){return n.goalBufferLength()},bandwidth:s,syncController:n.syncController_,decrypter:n.decrypter_,sourceType:n.sourceType_,inbandTextTracks:n.inbandTextTracks_,cacheEncryptionKeys:p};return n.masterPlaylistLoader_="dash"===n.sourceType_?new Zx(i,n.hls_,n.requestOptions_):new NE(i,n.hls_,n.requestOptions_),n.setupMasterPlaylistLoaderListeners_(),n.mainSegmentLoader_=new lC(vE.mergeOptions(g,{segmentMetadataTrack:n.segmentMetadataTrack_,loaderType:"main"}),e),n.audioSegmentLoader_=new lC(vE.mergeOptions(g,{loaderType:"audio"}),e),n.subtitleSegmentLoader_=new hC(vE.mergeOptions(g,{loaderType:"vtt"}),e),n.setupSegmentLoaderListeners_(),AC.forEach(function(e){n[e+"_"]=PC.bind(n,e)}),n.logger_=Jx("MPC"),n.masterPlaylistLoader_.load(),n}return SE(t,vE.EventTarget),CE(t,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=e.masterPlaylistLoader_.media(),n=1.5*t.targetDuration*1e3;e.requestOptions_.timeout=ZE(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?0:n,t.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load()),function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){EC[t](t,e)});var t=e.mediaTypes,n=e.masterPlaylistLoader,i=e.tech,r=e.hls;["AUDIO","SUBTITLES"].forEach(function(n){t[n].activeGroup=function(e,t){return function(n){var i=t.mediaTypes[e].groups,r=t.masterPlaylistLoader.media();if(!r)return null;var o=null;return r.attributes[e]&&(o=i[r.attributes[e]]),o=o||i.main,void 0===n?o:null===n?null:o.filter(function(e){return e.id===n.id})[0]||null}}(n,e),t[n].activeTrack=xC[n](n,e),t[n].onGroupChanged=function(e,t){return function(){var n=t.segmentLoaders,i=n[e],r=n.main,o=t.mediaTypes[e],a=o.activeTrack(),s=o.activeGroup(a),l=o.activePlaylistLoader;vC(i,o),s&&(s.playlistLoader?(i.resyncLoader(),bC(s.playlistLoader,o)):l&&r.resetEverything())}}(n,e),t[n].onTrackChanged=function(e,t){return function(){var n=t.segmentLoaders,i=n[e],r=n.main,o=t.mediaTypes[e],a=o.activeTrack(),s=o.activeGroup(a),l=o.activePlaylistLoader;vC(i,o),s&&(s.playlistLoader?l!==s.playlistLoader?(i.track&&i.track(a),i.resetEverything(),bC(s.playlistLoader,o)):bC(s.playlistLoader,o):r.resetEverything())}}(n,e)});var o=t.AUDIO.activeGroup(),a=(o.filter(function(e){return e.default})[0]||o[0]).id;t.AUDIO.tracks[a].enabled=!0,t.AUDIO.onTrackChanged(),n.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanged()})});var s=function(){t.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"hls-audio-change"})};for(var l in i.audioTracks().addEventListener("change",s),i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",function(){i.audioTracks().removeEventListener("change",s),i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),i.clearTracks("audio"),t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[l])}({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,hls:e.hls_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),t);try{e.setupSourceBuffers_()}catch(nS){return vE.log.warn("Failed to create SourceBuffers",nS),e.mediaSource.endOfStream("decode")}e.setupFirstPlay(),!e.mediaTypes_.AUDIO.activePlaylistLoader||e.mediaTypes_.AUDIO.activePlaylistLoader.media()?e.trigger("selectedinitialmedia"):e.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){e.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){var t=e.masterPlaylistLoader_.media();if(!t){e.excludeUnsupportedVariants_();var n=void 0;return e.enableLowInitialPlaylist&&(n=e.selectInitialPlaylist()),n||(n=e.selectPlaylist()),e.initialMedia_=n,void e.masterPlaylistLoader_.media(e.initialMedia_)}if(e.useCueTags_&&e.updateAdCues_(t),e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.updateDuration(),e.tech_.paused()||(e.mainSegmentLoader_.load(),e.audioSegmentLoader_&&e.audioSegmentLoader_.load()),!t.endList){var i=function(){var t=e.seekable();0!==t.length&&e.mediaSource.addSeekableRange_(t.start(0),t.end(0))};e.duration()!==1/0?e.tech_.one("durationchange",function t(){e.duration()===1/0?i():e.tech_.one("durationchange",t)}):i()}}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var t=e.masterPlaylistLoader_.media(),n=1.5*t.targetDuration*1e3;e.requestOptions_.timeout=ZE(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?0:n,e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=e.masterPlaylistLoader_.media();e.stuckAtPlaylistEnd_(t)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),e.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(e,t){var n=e.mediaGroups||{},i=!0,r=Object.keys(n.AUDIO);for(var o in n.AUDIO)for(var a in n.AUDIO[o])n.AUDIO[o][a].uri||(i=!1);i&&this.tech_.trigger({type:"usage",name:"hls-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"}),SC.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"hls-aes"}),SC.Playlist.isFmp4(t)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"}),r.length&&Object.keys(n.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var t=e.selectPlaylist(),n=e.masterPlaylistLoader_.media(),i=e.tech_.buffered(),r=i.length?i.end(i.length-1)-e.tech_.currentTime():0,o=e.bufferLowWaterLine();(!n.endList||e.duration()<tC.MAX_BUFFER_LOW_WATER_LINE||t.attributes.BANDWIDTH<n.attributes.BANDWIDTH||r>=o)&&e.masterPlaylistLoader_.media(t),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("ended",function(){e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(){e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120)}),this.mainSegmentLoader_.on("reseteverything",function(){e.tech_.trigger("hls-reset")}),this.mainSegmentLoader_.on("segmenttimemapping",function(t){e.tech_.trigger({type:"hls-segment-time-mapping",mapping:t.mapping})}),this.audioSegmentLoader_.on("ended",function(){e.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}},{key:"smoothQualityChange_",value:function(){var e=this.selectPlaylist();e!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(e),this.mainSegmentLoader_.resetLoader())}},{key:"fastQualityChange_",value:function(){var e=this,t=this.selectPlaylist();t!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(t),this.mainSegmentLoader_.resetEverything(function(){e.tech_.setCurrentTime(vE.browser.IE_VERSION||vE.browser.IS_EDGE?e.tech_.currentTime()+.04:e.tech_.currentTime())}))}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.seekTo_(0),this.hasPlayed_()&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.seekTo_(e.end(e.length-1)):void 0}}},{key:"setupFirstPlay",value:function(){var e=this,t=this.masterPlaylistLoader_.media();if(!t||this.tech_.paused()||this.hasPlayed_())return!1;if(!t.endList){var n=this.seekable();if(!n.length)return!1;if(vE.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.seekTo_(n.end(0)),e.hasPlayed_=function(){return!0}}),!1;this.trigger("firstplay"),this.seekTo_(n.end(0))}return this.hasPlayed_=function(){return!0},this.load(),!0}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(nS){return vE.log.warn("Failed to create Source Buffers",nS),this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,function(e){})}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(e=!this.mainSegmentLoader_.startingMedia_||this.mainSegmentLoader_.startingMedia_.containsVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_),e){this.logger_("calling mediaSource.endOfStream()");try{this.mediaSource.endOfStream()}catch(nS){vE.log.warn("Failed to call media source endOfStream",nS)}}}},{key:"stuckAtPlaylistEnd_",value:function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.mediaSource.duration);if(null===t)return!1;var n=SC.Playlist.playlistEnd(e,t),i=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return n-i<=.1;var o=r.end(r.length-1);return o-i<=.1&&n-o<=.1}},{key:"blacklistCurrentPlaylist",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],i=void 0;if(i=t.playlist||this.masterPlaylistLoader_.media(),n=n||t.blacklistDuration||this.blacklistDuration,!i){this.error=t;try{return this.mediaSource.endOfStream("network")}catch(nS){return this.trigger("error")}}var r=1===this.masterPlaylistLoader_.master.playlists.filter(QE).length,o=this.masterPlaylistLoader_.master.playlists;return 1===o.length?(vE.log.warn("Problem encountered with the current HLS playlist. Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(r)):(r&&(vE.log.warn("Removing all playlists from the blacklist because the last rendition is about to be blacklisted."),o.forEach(function(e){e.excludeUntil!==1/0&&delete e.excludeUntil}),this.tech_.trigger("retryplaylist")),i.excludeUntil=Date.now()+1e3*n,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),e=this.selectPlaylist(),vE.log.warn("Problem encountered with the current HLS playlist."+(t.message?" "+t.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(e,r))}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(e){var t=dx(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:SC.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var e=void 0,t=void 0;if(this.masterPlaylistLoader_){var n=this.masterPlaylistLoader_.media();if(n){var i=this.syncController_.getExpiredTime(n,this.mediaSource.duration);if(null!==i&&0!==(e=SC.Playlist.seekable(n,i)).length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(n=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(n,this.mediaSource.duration)))return;if(0===(t=SC.Playlist.seekable(n,i)).length)return}var r=void 0,o=void 0;this.seekable_&&this.seekable_.length&&(r=this.seekable_.end(0),o=this.seekable_.start(0)),this.seekable_=t?t.start(0)>e.end(0)||e.start(0)>t.end(0)?e:vE.createTimeRanges([[t.start(0)>e.start(0)?t.start(0):e.start(0),t.end(0)<e.end(0)?t.end(0):e.end(0)]]):e,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===r&&this.seekable_.start(0)===o||(this.logger_("seekable updated ["+px(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},{key:"updateDuration",value:function(){var e=this,t=this.mediaSource.duration,n=SC.Playlist.duration(this.masterPlaylistLoader_.media()),i=this.tech_.buffered(),r=function t(){e.logger_("Setting duration from "+e.mediaSource.duration+" => "+n);try{e.mediaSource.duration=n}catch(nS){vE.log.warn("Failed to set media source duration",nS)}e.tech_.trigger("durationchange"),e.mediaSource.removeEventListener("sourceopen",t)};i.length>0&&(n=Math.max(n,i.end(i.length-1))),t!==n&&("open"!==this.mediaSource.readyState?this.mediaSource.addEventListener("sourceopen",r):r())}},{key:"dispose",value:function(){var e=this;this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),["AUDIO","SUBTITLES"].forEach(function(t){var n=e.mediaTypes_[t].groups;for(var i in n)n[i].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var e,t=this.masterPlaylistLoader_.media();if(t&&"open"===this.mediaSource.readyState){if((e=function(e,t){var n=function(e){return e.segments&&e.segments.length&&e.segments[0].map?"mp4":"mp2t"}(t),i=function(e){var t=e.attributes||{};return t.CODECS?Ix(t.CODECS):Ox}(t),r=t.attributes||{},o=!0,a=!1;if(!t)return[];if(e.mediaGroups.AUDIO&&r.AUDIO){var s=e.mediaGroups.AUDIO[r.AUDIO];if(s)for(var l in a=!0,o=!1,s)if(!s[l].uri&&!s[l].playlists){o=!0;break}}a&&!i.audioProfile&&(o||(i.audioProfile=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var i in n){var r=n[i];if(r.default&&r.playlists)return Ix(r.playlists[0].attributes.CODECS).audioProfile}return null}(e,r.AUDIO)),i.audioProfile||(vE.log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),i.audioProfile=Ox.audioProfile));var c={};i.videoCodec&&(c.video=""+i.videoCodec+i.videoObjectTypeIndicator),i.audioProfile&&(c.audio="mp4a.40."+i.audioProfile);var u=Dx("audio",n,[c.audio]),h=Dx("video",n,[c.video]),d=Dx("video",n,[c.video,c.audio]);return a?!o&&c.video?[h,u]:o||c.video?[d,u]:[u,u]:c.video?[d]:[u]}(this.masterPlaylistLoader_.master,t)).length<1)return this.error="No compatible SourceBuffer configuration for the variant stream:"+t.resolvedUri,this.mediaSource.endOfStream("decode");this.configureLoaderMimeTypes_(e),this.excludeIncompatibleVariants_(t)}}},{key:"configureLoaderMimeTypes_",value:function(e){var t=e.length>1&&-1===e[0].indexOf(",")&&e[0]!==e[1]?new vE.EventTarget:null;this.mainSegmentLoader_.mimeType(e[0],t),e[1]&&this.audioSegmentLoader_.mimeType(e[1],t)}},{key:"excludeUnsupportedVariants_",value:function(){this.master().playlists.forEach(function(e){var t;e.attributes.CODECS&&om.a.MediaSource&&om.a.MediaSource.isTypeSupported&&!om.a.MediaSource.isTypeSupported('video/mp4; codecs="'+(t=e.attributes.CODECS,t.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return wx([e])[0]}))+'"')&&(e.excludeUntil=1/0)})}},{key:"excludeIncompatibleVariants_",value:function(e){var t=2,n=null,i=void 0;e.attributes.CODECS&&(i=Ix(e.attributes.CODECS),n=i.videoCodec,t=i.codecCount),this.master().playlists.forEach(function(e){var i={codecCount:2,videoCodec:null};e.attributes.CODECS&&(i=Ix(e.attributes.CODECS)),i.codecCount!==t&&(e.excludeUntil=1/0),i.videoCodec!==n&&(e.excludeUntil=1/0)})}},{key:"updateAdCues_",value:function(e){var t=0,n=this.seekable();n.length&&(t=n.start(0)),function(e,t){if(e.segments)for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=void 0,r=0;r<e.segments.length;r++){var o=e.segments[r];if(i||(i=dC(t,n+o.duration/2)),i){if("cueIn"in o){i.endTime=n,i.adEndTime=n,n+=o.duration,i=null;continue}if(n<i.endTime){n+=o.duration;continue}i.endTime+=o.duration}else if("cueOut"in o&&((i=new om.a.VTTCue(n,n+o.duration,o.cueOut)).adStartTime=n,i.adEndTime=n+parseFloat(o.cueOut),t.addCue(i)),"cueOutCont"in o){var a,s,l=o.cueOutCont.split("/").map(parseFloat),c=PE(l,2);a=c[0],s=c[1],(i=new om.a.VTTCue(n,n+o.duration,"")).adStartTime=n-a,i.adEndTime=i.adStartTime+s,t.addCue(i)}n+=o.duration}}(e,this.cueTagsTrack_,t)}},{key:"goalBufferLength",value:function(){var e=this.tech_.currentTime(),t=tC.GOAL_BUFFER_LENGTH,n=tC.GOAL_BUFFER_LENGTH_RATE,i=Math.max(t,tC.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,i)}},{key:"bufferLowWaterLine",value:function(){var e=this.tech_.currentTime(),t=tC.BUFFER_LOW_WATER_LINE,n=tC.BUFFER_LOW_WATER_LINE_RATE,i=Math.max(t,tC.MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,i)}}]),t}(),MC=function e(t,n,i){xE(this,e);var r,o,a,s=t.masterPlaylistController_,l=s[(t.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(s);if(n.attributes.RESOLUTION){var c=n.attributes.RESOLUTION;this.width=c.width,this.height=c.height}this.bandwidth=n.attributes.BANDWIDTH,this.id=i,this.enabled=(r=t.playlists,o=n.uri,a=l,function(e){var t=r.master.playlists[o],n=KE(t),i=QE(t);return void 0===e?i:(e?delete t.disabled:t.disabled=!0,e===i||n||(a(),r.trigger(e?"renditionenabled":"renditiondisabled")),e)})},OC=["seeking","seeked","pause","playing","error"],wC=function(){function e(t){var n=this;xE(this,e),this.tech_=t.tech,this.seekable=t.seekable,this.seekTo=t.seekTo,this.allowSeeksWithinUnsafeLiveWindow=t.allowSeeksWithinUnsafeLiveWindow,this.media=t.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=Jx("PlaybackWatcher"),this.logger_("initialize");var i=function(){return n.monitorCurrentTime_()},r=function(){return n.techWaiting_()},o=function(){return n.cancelTimer_()},a=function(){return n.fixesBadSeeks_()};this.tech_.on("seekablechanged",a),this.tech_.on("waiting",r),this.tech_.on(OC,o),this.tech_.on("canplay",i),this.dispose=function(){n.logger_("dispose"),n.tech_.off("seekablechanged",a),n.tech_.off("waiting",r),n.tech_.off(OC,o),n.tech_.off("canplay",i),n.checkCurrentTimeTimeout_&&om.a.clearTimeout(n.checkCurrentTimeTimeout_),n.cancelTimer_()}}return CE(e,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&om.a.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=om.a.setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+.1>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null}},{key:"fixesBadSeeks_",value:function(){if(!this.tech_.seeking())return!1;var e=this.seekable(),t=this.tech_.currentTime(),n=void 0;return this.afterSeekableWindow_(e,t,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(n=e.end(e.length-1)),this.beforeSeekableWindow_(e,t)&&(n=e.start(0)+.1),void 0!==n&&(this.logger_("Trying to seek outside of seekable at time "+t+" with seekable range "+px(e)+". Seeking to "+n+"."),this.seekTo(n),!0)}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),n=dx(t,e);return n.length&&e+3<=n.end(0)?(this.cancelTimer_(),this.seekTo(e),this.logger_("Stopped at "+e+" while inside a buffered region ["+n.start(0)+" -> "+n.end(0)+"]. Attempting to resume playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}}},{key:"techWaiting_",value:function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var n=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to live point (seekable end) "+n),this.cancelTimer_(),this.seekTo(n),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var i=this.tech_.buffered(),r=fx(i,t);if(this.videoUnderflow_(r,i,t))return this.cancelTimer_(),this.seekTo(t),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;if(r.length>0){var o=r.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+o+", seeking to "+r.start(0)),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*o,t),!0}return!1}},{key:"afterSeekableWindow_",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.length)return!1;var r=e.end(e.length-1)+.1;return!n.endList&&i&&(r=e.end(e.length-1)+3*n.targetDuration),t>r}},{key:"beforeSeekableWindow_",value:function(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-.1)}},{key:"videoUnderflow_",value:function(e,t,n){if(0===e.length){var i=this.gapFromVideoUnderflow_(t,n);if(i)return this.logger_("Encountered a gap in video from "+i.start+" to "+i.end+". Seeking to current time "+n),!0}return!1}},{key:"skipTheGap_",value:function(e){var t=this.tech_.buffered(),n=this.tech_.currentTime(),i=fx(t,n);this.cancelTimer_(),0!==i.length&&n===e&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",i.start(0)),this.seekTo(i.start(0)+1/30),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(e,t){for(var n=function(e){if(e.length<2)return vE.createTimeRanges();for(var t=[],n=1;n<e.length;n++){var i=e.end(n-1),r=e.start(n);t.push([i,r])}return vE.createTimeRanges(t)}(e),i=0;i<n.length;i++){var r=n.start(i),o=n.end(i);if(t-r<4&&t-r>2)return{start:r,end:o}}return null}}]),e}(),IC={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_)}},DC=function(e){!function e(t,n){var i=0,r=0,o=vE.mergeOptions(IC,n);t.ready(function(){t.trigger({type:"usage",name:"hls-error-reload-initialized"})});var a=function(){r&&t.currentTime(r)},s=function(e){null!=e&&(r=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",a),t.src(e),t.trigger({type:"usage",name:"hls-error-reload"}),t.play())},l=function(){if(Date.now()-i<1e3*o.errorInterval)t.trigger({type:"usage",name:"hls-error-reload-canceled"});else{if(o.getSource&&"function"==typeof o.getSource)return i=Date.now(),o.getSource.call(t,s);vE.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},c=function e(){t.off("loadedmetadata",a),t.off("error",l),t.off("dispose",e)};t.on("error",l),t.on("dispose",c),t.reloadSourceOnError=function(n){c(),e(t,n)}}(this,e)};vE.use("*",function(e){return{setSource:function(e,t){t(null,e)},setCurrentTime:function(t){return e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(t),t},play:function(){e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(e.tech_.currentTime())}}});var LC={PlaylistLoader:NE,Playlist:JE,Decrypter:x_,AsyncStream:y_,decrypt:E_,utils:ux,STANDARD_PLAYLIST_SELECTOR:function(){return function(e,t,n,i,r){var o=e.playlists.map(function(e){return{bandwidth:e.attributes.BANDWIDTH||om.a.Number.MAX_VALUE,width:e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,height:e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height,playlist:e}});oC(o,function(e,t){return e.bandwidth-t.bandwidth});var a=(o=o.filter(function(e){return!JE.isIncompatible(e.playlist)})).filter(function(e){return JE.isEnabled(e.playlist)});a.length||(a=o.filter(function(e){return!JE.isDisabled(e.playlist)}));var s=a.filter(function(e){return e.bandwidth*tC.BANDWIDTH_VARIANCE<t}),l=s[s.length-1],c=s.filter(function(e){return e.bandwidth===l.bandwidth})[0];if(!1===r){var u=c||a[0]||o[0];return u?u.playlist:null}var h=s.filter(function(e){return e.width&&e.height});oC(h,function(e,t){return e.width-t.width});var d=h.filter(function(e){return e.width===n&&e.height===i});l=d[d.length-1];var f=d.filter(function(e){return e.bandwidth===l.bandwidth})[0],p=void 0,g=void 0,m=void 0;f||(g=(p=h.filter(function(e){return e.width>n||e.height>i})).filter(function(e){return e.width===p[0].width&&e.height===p[0].height}),l=g[g.length-1],m=g.filter(function(e){return e.bandwidth===l.bandwidth})[0]);var _=m||f||c||a[0]||o[0];return _?_.playlist:null}(this.playlists.master,this.systemBandwidth,parseInt(rC(this.tech_.el(),"width"),10),parseInt(rC(this.tech_.el(),"height"),10),this.limitRenditionByPlayerDimensions)},INITIAL_PLAYLIST_SELECTOR:function(){var e=this.playlists.master.playlists.filter(JE.isEnabled);return oC(e,function(e,t){return aC(e,t)}),e.filter(function(e){return Ix(e.attributes.CODECS).videoCodec})[0]||null},comparePlaylistBandwidth:aC,comparePlaylistResolution:function(e,t){var n=void 0,i=void 0;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),(n=n||om.a.Number.MAX_VALUE)===(i=i||om.a.Number.MAX_VALUE)&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-i},xhr:tx()};["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(e){Object.defineProperty(LC,e,{get:function(){return vE.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),tC[e]},set:function(t){vE.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?vE.log.warn("value of Hls."+e+" must be greater than or equal to 0"):tC[e]=t}})});var kC=function(e){return/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(e)?"hls":/^application\/dash\+xml/i.test(e)?"dash":null},NC=function(e,t){for(var n=t.media(),i=-1,r=0;r<e.length;r++)if(e[r].id===n.uri){i=r;break}e.selectedIndex_=i,e.trigger({selectedIndex:i,type:"change"})};LC.canPlaySource=function(){return vE.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var FC,BC=function(){if(!window.localStorage)return null;var e=window.localStorage.getItem("videojs-vhs");if(!e)return null;try{return JSON.parse(e)}catch(nS){return null}};LC.supportsNativeHls=(FC=sm.a.createElement("video"),!!vE.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(e){return/maybe|probably/i.test(FC.canPlayType(e))})),LC.supportsNativeDash=!!vE.getTech("Html5").isSupported()&&/maybe|probably/i.test(sm.a.createElement("video").canPlayType("application/dash+xml")),LC.supportsTypeNatively=function(e){return"hls"===e?LC.supportsNativeHls:"dash"===e&&LC.supportsNativeDash},LC.isSupported=function(){return vE.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var UC=vE.getComponent("Component"),VC=function(e){function t(e,n,i){xE(this,t);var r=AE(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,i.hls));if(n.options_&&n.options_.playerId){var o=vE(n.options_.playerId);o.hasOwnProperty("hls")||Object.defineProperty(o,"hls",{get:function(){return vE.log.warn("player.hls is deprecated. Use player.tech().hls instead."),n.trigger({type:"usage",name:"hls-player-access"}),r},configurable:!0}),o.vhs=r,o.dash=r,r.player_=o}if(r.tech_=n,r.source_=e,r.stats={},r.setOptions_(),r.options_.overrideNative&&n.overrideNativeAudioTracks&&n.overrideNativeVideoTracks)n.overrideNativeAudioTracks(!0),n.overrideNativeVideoTracks(!0);else if(r.options_.overrideNative&&(n.featuresNativeVideoTracks||n.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return r.on(sm.a,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var t=sm.a.fullscreenElement||sm.a.webkitFullscreenElement||sm.a.mozFullScreenElement||sm.a.msFullscreenElement;t&&t.contains(r.tech_.el())&&r.masterPlaylistController_.smoothQualityChange_()}),r.on(r.tech_,"seeking",function(){0===this.tech_.currentTime()&&this.tech_.player_.loop()&&this.setCurrentTime(0)}),r.on(r.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),r.on(r.tech_,"play",r.play),r}return SE(t,UC),CE(t,[{key:"setOptions_",value:function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=this.options_.handleManifestRedirects||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var t=BC();t&&t.bandwidth&&(this.options_.bandwidth=t.bandwidth,this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),t&&t.throughput&&(this.options_.throughput=t.throughput,this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=tC.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===tC.INITIAL_BANDWIDTH,["withCredentials","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys"].forEach(function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions}},{key:"src",value:function(e,t){var n=this;e&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=LC,this.options_.sourceType=kC(t),this.options_.seekTo=function(e){n.tech_.setCurrentTime(e),n.setCurrentTime(e)},this.masterPlaylistController_=new RC(this.options_),this.playbackWatcher_=new wC(vE.mergeOptions(this.options_,{seekable:function(){return n.seekable()},media:function(){return n.masterPlaylistController_.media()}})),this.masterPlaylistController_.on("error",function(){vE.players[n.tech_.options_.playerId].error(n.masterPlaylistController_.error)}),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):LC.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=LC.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){return Math.floor(1/(1/(this.bandwidth||1)+(this.throughput>0?1/this.throughput:0)))},set:function(){vE.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return n.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return n.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return n.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return n.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return n.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return n.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return n.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return n.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return gx(n.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return n.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return n.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return n.tech_.name_},enumerable:!0},duration:{get:function(){return n.tech_.duration()},enumerable:!0},master:{get:function(){return n.playlists.master},enumerable:!0},playerDimensions:{get:function(){return n.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return gx(n.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return n.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){n.options_.useBandwidthFromLocalStorage&&function(e){if(!window.localStorage)return!1;var t=BC();t=t?vE.mergeOptions(t,e):e;try{window.localStorage.setItem("videojs-vhs",JSON.stringify(t))}catch(nS){return!1}}({bandwidth:n.bandwidth,throughput:Math.round(n.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){var e,t;t=(e=n).playlists,e.representations=function(){return t.master.playlists.filter(function(e){return!KE(e)}).map(function(t,n){return new MC(e,t,t.uri)})},function(e){if("dash"===e.options_.sourceType){var t=vE.players[e.tech_.options_.playerId];if(t.eme){var n=function(e,t,n){if(!e)return e;var i={};for(var r in e)i[r]={audioContentType:'audio/mp4; codecs="'+n.attributes.CODECS+'"',videoContentType:'video/mp4; codecs="'+t.attributes.CODECS+'"'},t.contentProtection&&t.contentProtection[r]&&t.contentProtection[r].pssh&&(i[r].pssh=t.contentProtection[r].pssh),"string"==typeof e[r]&&(i[r].url=e[r]);return vE.mergeOptions(e,i)}(e.source_.keySystems,e.playlists.media(),e.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader.media());n&&(t.currentSource().keySystems=n,t.eme.initializeMediaKeys&&t.eme.initializeMediaKeys())}}}(n)}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.tech_.ready(function(){return n.setupQualityLevels_()}),this.tech_.el()&&this.tech_.src(vE.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var e=this,t=vE.players[this.tech_.options_.playerId];t&&t.qualityLevels&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){var t,n;t=e.qualityLevels_,(n=e).representations().forEach(function(e){t.addQualityLevel(e)}),NC(t,n.playlists)}),this.playlists.on("mediachange",function(){NC(e.qualityLevels_,e.playlists)}))}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.hls&&delete this.tech_.hls,function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}},{key:"convertToProgramTime",value:function(e,t){return function(e){var t=e.playlist,n=e.time,i=void 0===n?void 0:n,r=e.callback;if(!r)throw new Error("getProgramTime: callback must be provided");if(!t||void 0===i)return r({message:"getProgramTime: playlist and time must be provided"});var o=function(e,t){if(!t||!t.segments||0===t.segments.length)return null;for(var n=0,i=void 0,r=0;r<t.segments.length&&!(e<=(n=(i=t.segments[r]).videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration));r++);var o=t.segments[t.segments.length-1];if(o.videoTimingInfo&&o.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>n){if(e>n+.25*o.duration)return null;i=o}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}}(i,t);if(!o)return r({message:"valid programTime was not found"});if("estimate"===o.type)return r({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:o.estimatedStart});var a={mediaSeconds:i},s=function(e,t){if(!t.dateTimeObject)return null;var n=i-(t.videoTimingInfo.transmuxedPresentationStart+t.videoTimingInfo.transmuxerPrependedSeconds);return new Date(t.dateTimeObject.getTime()+1e3*n)}(0,o.segment);return s&&(a.programDateTime=s.toISOString()),r(null,a)}({playlist:this.masterPlaylistController_.media(),time:e,callback:t})}},{key:"seekToProgramTime",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return function e(t){var n=t.programTime,i=t.playlist,r=t.retryCount,o=void 0===r?2:r,a=t.seekTo,s=t.pauseAfterSeek,l=void 0===s||s,c=t.tech,u=t.callback;if(!u)throw new Error("seekToProgramTime: callback must be provided");if(void 0===n||!i||!a)return u({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!i.endList&&!c.hasStarted_)return u({message:"player must be playing a live stream to start buffering"});if(!function(e){if(!e.segments||0===e.segments.length)return!1;for(var t=0;t<e.segments.length;t++)if(!e.segments[t].dateTimeObject)return!1;return!0}(i))return u({message:"programDateTime tags must be provided in the manifest "+i.resolvedUri});var h=function(e,t){var n=void 0;try{n=new Date(e)}catch(nS){return null}if(!t||!t.segments||0===t.segments.length)return null;var i=t.segments[0];if(n<i.dateTimeObject)return null;for(var r=0;r<t.segments.length-1&&(i=t.segments[r],!(n<t.segments[r+1].dateTimeObject));r++);var o,a=t.segments[t.segments.length-1],s=a.dateTimeObject,l=a.videoTimingInfo?(o=a.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:a.duration+.25*a.duration;return n>new Date(s.getTime()+1e3*l)?null:(n>s&&(i=a),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:JE.duration(t,t.mediaSequence+t.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})}(n,i);if(!h)return u({message:n+" was not found in the stream"});var d=h.segment,f=function(e,t){var n=void 0,i=void 0;try{n=new Date(e),i=new Date(t)}catch(nS){}var r=n.getTime();return(i.getTime()-r)/1e3}(d.dateTimeObject,n);if("estimate"===h.type)return 0===o?u({message:n+" is not buffered yet. Try again"}):(a(h.estimatedStart+f),void c.one("seeked",function(){e({programTime:n,playlist:i,retryCount:o-1,seekTo:a,pauseAfterSeek:l,tech:c,callback:u})}));var p=d.start+f;c.one("seeked",function(){return u(null,c.currentTime())}),l&&c.pause(),a(p)}({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:i,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}}]),t}(),GC={name:"videojs-http-streaming",VERSION:"1.10.3",canHandleSource:function(e){var t=vE.mergeOptions(vE.options,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return GC.canPlayType(e.type,t)},handleSource:function(e,t){var n=vE.mergeOptions(vE.options,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});return t.hls=new VC(e,t,n),t.hls.xhr=tx(),t.hls.src(e.src,e.type),t.hls},canPlayType:function(e){var t=vE.mergeOptions(vE.options,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).hls.overrideNative,n=kC(e);return!n||LC.supportsTypeNatively(n)&&!t?"":"maybe"}};void 0!==vE.MediaSource&&void 0!==vE.URL||(vE.MediaSource=jx,vE.URL=Hx),jx.supportsNativeMediaSources()&&vE.getTech("Html5").registerSourceHandler(GC,0),vE.HlsHandler=VC,vE.HlsSourceHandler=GC,vE.Hls=LC,vE.use||vE.registerComponent("Hls",LC),vE.options.hls=vE.options.hls||{},vE.registerPlugin?vE.registerPlugin("reloadSourceOnError",DC):vE.plugin("reloadSourceOnError",DC);var zC=vE,jC=function(){return function(e){var t=this;this.CreateDome=function(e,n){t.dome&&t.DestroyDome(),t.dome=new Xg.PhotoDome(e,n,{resolution:32,size:1e3},t.scene)},this.DestroyDome=function(){t.dome.dispose()},this.AddWidget=function(e,n){var i=Xg.MeshBuilder.CreatePlane("plane",{size:10},t.scene);i.position.z=20,i.rotateAround(new Xg.Vector3(0,0,0),new Xg.Vector3(0,1,0),e),t.widgets.push(i);var r=Zg.AdvancedDynamicTexture.CreateForMesh(i),o=new Zg.StackPanel;o.width=1,o.horizontalAlignment=Zg.Control.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(o),t.widgets.push(o);var a=Zg.Button.CreateSimpleButton("but1","\u4ece\u6b64\u51fa\u53d1");a.width=.5,a.height="200px",a.color="white",a.fontSize=48,a.background="green",a.onPointerUpObservable.add(n),o.addControl(a),t.widgets.push(a)},this.ClearWidgets=function(){var e,n;try{for(var i=l(t.widgets),r=i.next();!r.done;r=i.next())r.value.dispose()}catch(o){e={error:o}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},this.scene=e,this.widgets=new Array}}(),HC=function(){function e(){var e=this;this.index=0,this.nodes=[{id:"node_01",info:{name:"panorama_01",url:"./assets/images/panorama-01.jpg"},transitions:[{url:"./assets/videos/panorama-a.mp4",next:"node_02",radian:1.5}]},{id:"node_02",info:{name:"panorama_02",url:"./assets/images/panorama-02.jpg"},transitions:[{url:"./assets/videos/panorama-b.mp4",next:"node_03",radian:.5},{url:"./assets/videos/panorama-c.mp4",next:"node_05",radian:1.5}]},{id:"node_03",info:{name:"panorama_03",url:"./assets/images/panorama-03.jpg"},transitions:[{url:"./assets/videos/panorama-e.mp4",next:"node_04",radian:0}]},{id:"node_04",info:{name:"panorama_04",url:"./assets/images/panorama-04.jpg"},transitions:[]},{id:"node_05",info:{name:"panorama_05",url:"./assets/images/panorama-05.jpg"},transitions:[{url:"./assets/videos/panorama-d.mp4",next:"node_06",radian:0}]},{id:"node_06",info:{name:"panorama_06",url:"./assets/images/panorama-06.jpg"},transitions:[]}],this.GetCurrentPanorama=function(){return e.nodes[e.index]},this.GotoNext=function(t){e.nodes.map(function(n,i){n.id==t&&(e.index=i)})}}return e.ngInjectableDef=Se({factory:function(){return new e},token:e,providedIn:"root"}),e}(),WC=function(){function e(e){var t=this;this.InitPanorama=function(){var e=new Yg("renderCanvas"),n=new Kg("MainCamera",Xg.Vector3.Zero(),e.GetScene());n.SetTarget(Xg.Vector3.Zero()),n.AttachControl(e.GetCanvas()),e.Animate(),t.panorama=new jC(e.GetScene())},this.InitPlayer=function(){t.player=zC("player",{preload:"auto"})},this.ShowPanorama=function(){var e,n,i=t.service.GetCurrentPanorama();t.panorama.CreateDome(i.info.name,i.info.url),t.panorama.ClearWidgets();var r=function(e){t.panorama.AddWidget(e.radian,function(){t.panorama.DestroyDome(),t.isPlaying=!0,t.PlayVideo(e.url),t.service.GotoNext(e.next)})};try{for(var o=l(i.transitions),a=o.next();!a.done;a=o.next())r(a.value)}catch(s){e={error:s}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},this.PlayVideo=function(e){t.player.src({type:"video/mp4",src:e}),t.player.play(),t.player.on("ended",function(){t.isPlaying=!1,t.ShowPanorama()})},this.service=e}return e.prototype.ngAfterViewInit=function(){this.InitPanorama(),this.InitPlayer(),this.ShowPanorama()},e}(),XC=ti({encapsulation:0,styles:[["#renderCanvas[_ngcontent-%COMP%]{width:100%;height:100%;touch-action:none}video[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;right:0;bottom:0;background-color:#000}.hidden[_ngcontent-%COMP%]{display:none}"]],data:{}});function YC(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-backward",[],null,null,null,Rg,Pg)),fr(1,49152,null,0,Ag,[],null,null),(e()(),Ho(2,0,null,null,3,"canvas",[["id","renderCanvas"]],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(4,278528,null,0,Ls,[Is],{ngClass:[0,"ngClass"]},null),ia(5,{hidden:0}),(e()(),Ho(6,0,null,null,8,"div",[],null,null,null,null,null)),pr(512,null,Is,Ds,[Rn,Mn,un,gn]),fr(8,278528,null,0,Ls,[Is],{ngClass:[0,"ngClass"]},null),ia(9,{hidden:0}),(e()(),Ho(10,0,null,null,4,"video",[["height","264"],["id","player"],["width","640"]],null,null,null,null,null)),(e()(),Ho(11,0,null,null,3,"p",[["class","vjs-no-js"]],null,null,null,null,null)),(e()(),oa(-1,null,[" To view this video please enable JavaScript, and consider upgrading to a web browser that "])),(e()(),Ho(13,0,null,null,1,"a",[["href","https://videojs.com/html5-video-support/"],["target","_blank"]],null,null,null,null,null)),(e()(),oa(-1,null,["supports HTML5 video"]))],function(e,t){var n=t.component,i=e(t,5,0,n.isPlaying);e(t,4,0,i);var r=e(t,9,0,!n.isPlaying);e(t,8,0,r)},null)}function KC(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-panorama",[],null,null,null,YC,XC)),fr(1,4243456,null,0,WC,[HC],null,null)],null,null)}var QC=ji("app-panorama",WC,KC,{},{},[]),qC=ti({encapsulation:0,styles:[[""]],data:{}});function ZC(e){return la(0,[(e()(),Ho(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),fr(1,212992,null,0,bd,[vd,Fn,rn,[8,null],On],null,null)],function(e,t){e(t,1,0)},null)}function JC(e){return la(0,[(e()(),Ho(0,0,null,null,1,"app-root",[],null,null,null,ZC,qC)),fr(1,49152,null,0,ms,[],null,null)],null,null)}var $C=ji("app-root",ms,JC,{},{},[]),eS=function(){return function(){}}(),tS=fs(gs,[ms],function(e){return function(e){for(var t={},n=[],i=!1,r=0;r<e.length;r++){var o=e[r];o.token===Zt&&!0===o.value&&(i=!0),1073741824&o.flags&&n.push(o.token),o.index=r,t[Jn(o.token)]=o}return{factory:null,providersByKey:t,providers:e,modules:n,isRoot:i}}([Li(512,rn,on,[[8,[Hd,Qd,Lg,Vg,Wg,im,QC,tg,sg,hg,Sg,mg,Tg,$C]],[3,rn],sn]),Li(5120,Fo,Vo,[[3,Fo]]),Li(4608,Os,ws,[Fo,[2,Ms]]),Li(5120,Mr,Go,[ao]),Li(5120,Fr,Br,[]),Li(5120,Rn,Bo,[]),Li(5120,Mn,Uo,[]),Li(4608,Uc,Vc,[zs]),Li(6144,Nt,null,[Uc]),Li(4608,Ic,Lc,[]),Li(5120,oc,function(e,t,n,i,r,o,a,s){return[new Oc(e,t,n),new Bc(i),new kc(r,o,a,s)]},[zs,ao,Gr,zs,zs,Ic,jr,[2,Dc]]),Li(4608,ac,ac,[oc,ao]),Li(135680,cc,cc,[zs]),Li(4608,mc,mc,[ac,cc,Fr]),Li(6144,fn,null,[mc]),Li(6144,lc,null,[cc]),Li(4608,go,go,[ao]),Li(5120,rh,Nd,[pd]),Li(4608,xd,xd,[]),Li(6144,Td,null,[xd]),Li(135680,Cd,Cd,[pd,Ir,Zr,je,Td]),Li(4608,Ed,Ed,[]),Li(5120,Sd,wd,[pd,Xs,Ad]),Li(5120,Vd,Ud,[Fd]),Li(5120,zr,function(e){return[e]},[Vd]),Li(4608,Cp,Cp,[]),Li(4608,mf,mf,[]),Li(4608,qd,qd,[]),Li(4608,Mp,Mp,[]),Li(4608,ip,ip,[fn,Gr]),Li(4608,op,op,[rn,ao,je,ip,Co]),Li(4608,sp,sp,[]),Li(4608,Ep,Ep,[fn,op]),Li(4608,Ip,Ip,[]),Li(4608,Ap,Ap,[]),Li(1073742336,Gs,Gs,[]),Li(1024,ut,Kc,[]),Li(1024,bo,function(){return[Md()]},[]),Li(512,Fd,Fd,[je]),Li(1024,kr,function(e,t){return[(n=e,nc("probe",rc),nc("coreTokens",o({},ic,(n||[]).reduce(function(e,t){return e[t.name]=t.token,e},{}))),function(){return rc}),Bd(t)];var n},[[2,bo],Fd]),Li(512,Nr,Nr,[[2,kr]]),Li(131584,Co,Co,[ao,jr,je,ut,rn,Nr]),Li(1073742336,zo,zo,[Co]),Li(1073742336,Qc,Qc,[[3,Qc]]),Li(1024,Pd,Dd,[[3,pd]]),Li(512,Nu,Fu,[]),Li(512,vd,vd,[]),Li(256,Ad,{},[]),Li(1024,bs,Id,[_s,[2,ys],Ad]),Li(512,Ts,Ts,[bs,_s]),Li(512,Zr,Zr,[]),Li(512,Ir,Ro,[Zr,[2,Ao]]),Li(1024,sd,function(){return[[{path:"",component:Wd},{path:"introduction",component:Mg},{path:"location",component:kg},{path:"type",component:Gg},{path:"sandbox",component:$g},{path:"panorama",component:WC}]]},[]),Li(1024,pd,kd,[Co,Nu,vd,Ts,je,Ir,Zr,sd,Ad,[2,cd],[2,od]]),Li(1073742336,Od,Od,[[2,Pd],[2,pd]]),Li(1073742336,eS,eS,[]),Li(1073742336,uf,uf,[]),Li(1073742336,Np,Np,[]),Li(1073742336,pp,pp,[]),Li(1073742336,Sp,Sp,[]),Li(1073742336,cp,cp,[]),Li(1073742336,bf,bf,[]),Li(1073742336,yf,yf,[]),Li(1073742336,Ef,Ef,[]),Li(1073742336,xp,xp,[]),Li(1073742336,Lp,Lp,[]),Li(1073742336,Rp,Rp,[]),Li(1073742336,dp,dp,[]),Li(1073742336,hf,hf,[]),Li(1073742336,Jd,Jd,[]),Li(1073742336,$d,$d,[]),Li(1073742336,Tf,Tf,[]),Li(1073742336,wp,wp,[]),Li(1073742336,sf,sf,[]),Li(1073742336,lf,lf,[]),Li(1073742336,fp,fp,[]),Li(1073742336,Fp,Fp,[]),Li(1073742336,Bp,Bp,[]),Li(1073742336,gs,gs,[]),Li(256,Zt,!0,[]),Li(256,ap,{autoClose:!0},[])])});(function(){if(dt)throw new Error("Cannot enable prod mode after platform setup.");ht=!1})(),Yc().bootstrapModuleFactory(tS).catch(function(e){return console.error(e)})},zn8P:function(e,t){function n(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);